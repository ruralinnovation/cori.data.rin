function xL(t,e){for(var n=0;n<e.length;n++){const a=e[n];if(typeof a!="string"&&!Array.isArray(a)){for(const u in a)if(u!=="default"&&!(u in t)){const d=Object.getOwnPropertyDescriptor(a,u);d&&Object.defineProperty(t,u,d.get?d:{enumerable:!0,get:()=>a[u]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))a(u);new MutationObserver(u=>{for(const d of u)if(d.type==="childList")for(const _ of d.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&a(_)}).observe(document,{childList:!0,subtree:!0});function n(u){const d={};return u.integrity&&(d.integrity=u.integrity),u.referrerPolicy&&(d.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?d.credentials="include":u.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(u){if(u.ep)return;u.ep=!0;const d=n(u);fetch(u.href,d)}})();var $e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function L_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function $M(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function a(){return this instanceof a?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(a){var u=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(n,a,u.get?u:{enumerable:!0,get:function(){return t[a]}})}),n}var WM={exports:{}},xr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Om=Symbol.for("react.element"),bL=Symbol.for("react.portal"),wL=Symbol.for("react.fragment"),EL=Symbol.for("react.strict_mode"),SL=Symbol.for("react.profiler"),TL=Symbol.for("react.provider"),AL=Symbol.for("react.context"),IL=Symbol.for("react.forward_ref"),CL=Symbol.for("react.suspense"),kL=Symbol.for("react.memo"),PL=Symbol.for("react.lazy"),lC=Symbol.iterator;function DL(t){return t===null||typeof t!="object"?null:(t=lC&&t[lC]||t["@@iterator"],typeof t=="function"?t:null)}var GM={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},HM=Object.assign,qM={};function zd(t,e,n){this.props=t,this.context=e,this.refs=qM,this.updater=n||GM}zd.prototype.isReactComponent={};zd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};zd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function ZM(){}ZM.prototype=zd.prototype;function YE(t,e,n){this.props=t,this.context=e,this.refs=qM,this.updater=n||GM}var QE=YE.prototype=new ZM;QE.constructor=YE;HM(QE,zd.prototype);QE.isPureReactComponent=!0;var cC=Array.isArray,KM=Object.prototype.hasOwnProperty,JE={current:null},XM={key:!0,ref:!0,__self:!0,__source:!0};function YM(t,e,n){var a,u={},d=null,_=null;if(e!=null)for(a in e.ref!==void 0&&(_=e.ref),e.key!==void 0&&(d=""+e.key),e)KM.call(e,a)&&!XM.hasOwnProperty(a)&&(u[a]=e[a]);var l=arguments.length-2;if(l===1)u.children=n;else if(1<l){for(var w=Array(l),T=0;T<l;T++)w[T]=arguments[T+2];u.children=w}if(t&&t.defaultProps)for(a in l=t.defaultProps,l)u[a]===void 0&&(u[a]=l[a]);return{$$typeof:Om,type:t,key:d,ref:_,props:u,_owner:JE.current}}function ML(t,e){return{$$typeof:Om,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function eS(t){return typeof t=="object"&&t!==null&&t.$$typeof===Om}function zL(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var uC=/\/+/g;function k1(t,e){return typeof t=="object"&&t!==null&&t.key!=null?zL(""+t.key):e.toString(36)}function Ry(t,e,n,a,u){var d=typeof t;(d==="undefined"||d==="boolean")&&(t=null);var _=!1;if(t===null)_=!0;else switch(d){case"string":case"number":_=!0;break;case"object":switch(t.$$typeof){case Om:case bL:_=!0}}if(_)return _=t,u=u(_),t=a===""?"."+k1(_,0):a,cC(u)?(n="",t!=null&&(n=t.replace(uC,"$&/")+"/"),Ry(u,e,n,"",function(T){return T})):u!=null&&(eS(u)&&(u=ML(u,n+(!u.key||_&&_.key===u.key?"":(""+u.key).replace(uC,"$&/")+"/")+t)),e.push(u)),1;if(_=0,a=a===""?".":a+":",cC(t))for(var l=0;l<t.length;l++){d=t[l];var w=a+k1(d,l);_+=Ry(d,e,n,w,u)}else if(w=DL(t),typeof w=="function")for(t=w.call(t),l=0;!(d=t.next()).done;)d=d.value,w=a+k1(d,l++),_+=Ry(d,e,n,w,u);else if(d==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return _}function Ag(t,e,n){if(t==null)return t;var a=[],u=0;return Ry(t,a,"","",function(d){return e.call(n,d,u++)}),a}function RL(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var eo={current:null},Oy={transition:null},OL={ReactCurrentDispatcher:eo,ReactCurrentBatchConfig:Oy,ReactCurrentOwner:JE};function QM(){throw Error("act(...) is not supported in production builds of React.")}xr.Children={map:Ag,forEach:function(t,e,n){Ag(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Ag(t,function(){e++}),e},toArray:function(t){return Ag(t,function(e){return e})||[]},only:function(t){if(!eS(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};xr.Component=zd;xr.Fragment=wL;xr.Profiler=SL;xr.PureComponent=YE;xr.StrictMode=EL;xr.Suspense=CL;xr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=OL;xr.act=QM;xr.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var a=HM({},t.props),u=t.key,d=t.ref,_=t._owner;if(e!=null){if(e.ref!==void 0&&(d=e.ref,_=JE.current),e.key!==void 0&&(u=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(w in e)KM.call(e,w)&&!XM.hasOwnProperty(w)&&(a[w]=e[w]===void 0&&l!==void 0?l[w]:e[w])}var w=arguments.length-2;if(w===1)a.children=n;else if(1<w){l=Array(w);for(var T=0;T<w;T++)l[T]=arguments[T+2];a.children=l}return{$$typeof:Om,type:t.type,key:u,ref:d,props:a,_owner:_}};xr.createContext=function(t){return t={$$typeof:AL,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:TL,_context:t},t.Consumer=t};xr.createElement=YM;xr.createFactory=function(t){var e=YM.bind(null,t);return e.type=t,e};xr.createRef=function(){return{current:null}};xr.forwardRef=function(t){return{$$typeof:IL,render:t}};xr.isValidElement=eS;xr.lazy=function(t){return{$$typeof:PL,_payload:{_status:-1,_result:t},_init:RL}};xr.memo=function(t,e){return{$$typeof:kL,type:t,compare:e===void 0?null:e}};xr.startTransition=function(t){var e=Oy.transition;Oy.transition={};try{t()}finally{Oy.transition=e}};xr.unstable_act=QM;xr.useCallback=function(t,e){return eo.current.useCallback(t,e)};xr.useContext=function(t){return eo.current.useContext(t)};xr.useDebugValue=function(){};xr.useDeferredValue=function(t){return eo.current.useDeferredValue(t)};xr.useEffect=function(t,e){return eo.current.useEffect(t,e)};xr.useId=function(){return eo.current.useId()};xr.useImperativeHandle=function(t,e,n){return eo.current.useImperativeHandle(t,e,n)};xr.useInsertionEffect=function(t,e){return eo.current.useInsertionEffect(t,e)};xr.useLayoutEffect=function(t,e){return eo.current.useLayoutEffect(t,e)};xr.useMemo=function(t,e){return eo.current.useMemo(t,e)};xr.useReducer=function(t,e,n){return eo.current.useReducer(t,e,n)};xr.useRef=function(t){return eo.current.useRef(t)};xr.useState=function(t){return eo.current.useState(t)};xr.useSyncExternalStore=function(t,e,n){return eo.current.useSyncExternalStore(t,e,n)};xr.useTransition=function(){return eo.current.useTransition()};xr.version="18.3.1";WM.exports=xr;var kt=WM.exports;const P1=L_(kt);var JM={exports:{}},jo={},ez={exports:{}},tz={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(qe,St){var gt=qe.length;qe.push(St);e:for(;0<gt;){var je=gt-1>>>1,et=qe[je];if(0<u(et,St))qe[je]=St,qe[gt]=et,gt=je;else break e}}function n(qe){return qe.length===0?null:qe[0]}function a(qe){if(qe.length===0)return null;var St=qe[0],gt=qe.pop();if(gt!==St){qe[0]=gt;e:for(var je=0,et=qe.length,nt=et>>>1;je<nt;){var it=2*(je+1)-1,ur=qe[it],Xt=it+1,Pr=qe[Xt];if(0>u(ur,gt))Xt<et&&0>u(Pr,ur)?(qe[je]=Pr,qe[Xt]=gt,je=Xt):(qe[je]=ur,qe[it]=gt,je=it);else if(Xt<et&&0>u(Pr,gt))qe[je]=Pr,qe[Xt]=gt,je=Xt;else break e}}return St}function u(qe,St){var gt=qe.sortIndex-St.sortIndex;return gt!==0?gt:qe.id-St.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;t.unstable_now=function(){return d.now()}}else{var _=Date,l=_.now();t.unstable_now=function(){return _.now()-l}}var w=[],T=[],C=1,P=null,z=3,$=!1,U=!1,W=!1,N=typeof setTimeout=="function"?setTimeout:null,V=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function F(qe){for(var St=n(T);St!==null;){if(St.callback===null)a(T);else if(St.startTime<=qe)a(T),St.sortIndex=St.expirationTime,e(w,St);else break;St=n(T)}}function H(qe){if(W=!1,F(qe),!U)if(n(w)!==null)U=!0,Ut(J);else{var St=n(T);St!==null&&cr(H,St.startTime-qe)}}function J(qe,St){U=!1,W&&(W=!1,V(ge),ge=-1),$=!0;var gt=z;try{for(F(St),P=n(w);P!==null&&(!(P.expirationTime>St)||qe&&!Be());){var je=P.callback;if(typeof je=="function"){P.callback=null,z=P.priorityLevel;var et=je(P.expirationTime<=St);St=t.unstable_now(),typeof et=="function"?P.callback=et:P===n(w)&&a(w),F(St)}else a(w);P=n(w)}if(P!==null)var nt=!0;else{var it=n(T);it!==null&&cr(H,it.startTime-St),nt=!1}return nt}finally{P=null,z=gt,$=!1}}var te=!1,se=null,ge=-1,xe=5,Ee=-1;function Be(){return!(t.unstable_now()-Ee<xe)}function Fe(){if(se!==null){var qe=t.unstable_now();Ee=qe;var St=!0;try{St=se(!0,qe)}finally{St?Ve():(te=!1,se=null)}}else te=!1}var Ve;if(typeof R=="function")Ve=function(){R(Fe)};else if(typeof MessageChannel<"u"){var Ct=new MessageChannel,Dt=Ct.port2;Ct.port1.onmessage=Fe,Ve=function(){Dt.postMessage(null)}}else Ve=function(){N(Fe,0)};function Ut(qe){se=qe,te||(te=!0,Ve())}function cr(qe,St){ge=N(function(){qe(t.unstable_now())},St)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(qe){qe.callback=null},t.unstable_continueExecution=function(){U||$||(U=!0,Ut(J))},t.unstable_forceFrameRate=function(qe){0>qe||125<qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):xe=0<qe?Math.floor(1e3/qe):5},t.unstable_getCurrentPriorityLevel=function(){return z},t.unstable_getFirstCallbackNode=function(){return n(w)},t.unstable_next=function(qe){switch(z){case 1:case 2:case 3:var St=3;break;default:St=z}var gt=z;z=St;try{return qe()}finally{z=gt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(qe,St){switch(qe){case 1:case 2:case 3:case 4:case 5:break;default:qe=3}var gt=z;z=qe;try{return St()}finally{z=gt}},t.unstable_scheduleCallback=function(qe,St,gt){var je=t.unstable_now();switch(typeof gt=="object"&&gt!==null?(gt=gt.delay,gt=typeof gt=="number"&&0<gt?je+gt:je):gt=je,qe){case 1:var et=-1;break;case 2:et=250;break;case 5:et=1073741823;break;case 4:et=1e4;break;default:et=5e3}return et=gt+et,qe={id:C++,callback:St,priorityLevel:qe,startTime:gt,expirationTime:et,sortIndex:-1},gt>je?(qe.sortIndex=gt,e(T,qe),n(w)===null&&qe===n(T)&&(W?(V(ge),ge=-1):W=!0,cr(H,gt-je))):(qe.sortIndex=et,e(w,qe),U||$||(U=!0,Ut(J))),qe},t.unstable_shouldYield=Be,t.unstable_wrapCallback=function(qe){var St=z;return function(){var gt=z;z=St;try{return qe.apply(this,arguments)}finally{z=gt}}}})(tz);ez.exports=tz;var FL=ez.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LL=kt,Uo=FL;function yt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var rz=new Set,dm={};function Ou(t,e){Sd(t,e),Sd(t+"Capture",e)}function Sd(t,e){for(dm[t]=e,t=0;t<e.length;t++)rz.add(e[t])}var sl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fw=Object.prototype.hasOwnProperty,BL=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,hC={},dC={};function NL(t){return Fw.call(dC,t)?!0:Fw.call(hC,t)?!1:BL.test(t)?dC[t]=!0:(hC[t]=!0,!1)}function UL(t,e,n,a){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return a?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function jL(t,e,n,a){if(e===null||typeof e>"u"||UL(t,e,n,a))return!0;if(a)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function to(t,e,n,a,u,d,_){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=a,this.attributeNamespace=u,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=d,this.removeEmptyString=_}var Ai={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ai[t]=new to(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ai[e]=new to(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ai[t]=new to(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ai[t]=new to(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ai[t]=new to(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ai[t]=new to(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ai[t]=new to(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ai[t]=new to(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ai[t]=new to(t,5,!1,t.toLowerCase(),null,!1,!1)});var tS=/[\-:]([a-z])/g;function rS(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(tS,rS);Ai[e]=new to(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(tS,rS);Ai[e]=new to(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(tS,rS);Ai[e]=new to(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ai[t]=new to(t,1,!1,t.toLowerCase(),null,!1,!1)});Ai.xlinkHref=new to("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ai[t]=new to(t,1,!1,t.toLowerCase(),null,!0,!0)});function nS(t,e,n,a){var u=Ai.hasOwnProperty(e)?Ai[e]:null;(u!==null?u.type!==0:a||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(jL(e,n,u,a)&&(n=null),a||u===null?NL(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):u.mustUseProperty?t[u.propertyName]=n===null?u.type===3?!1:"":n:(e=u.attributeName,a=u.attributeNamespace,n===null?t.removeAttribute(e):(u=u.type,n=u===3||u===4&&n===!0?"":""+n,a?t.setAttributeNS(a,e,n):t.setAttribute(e,n))))}var hl=LL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ig=Symbol.for("react.element"),td=Symbol.for("react.portal"),rd=Symbol.for("react.fragment"),iS=Symbol.for("react.strict_mode"),Lw=Symbol.for("react.profiler"),nz=Symbol.for("react.provider"),iz=Symbol.for("react.context"),oS=Symbol.for("react.forward_ref"),Bw=Symbol.for("react.suspense"),Nw=Symbol.for("react.suspense_list"),aS=Symbol.for("react.memo"),ec=Symbol.for("react.lazy"),oz=Symbol.for("react.offscreen"),pC=Symbol.iterator;function Af(t){return t===null||typeof t!="object"?null:(t=pC&&t[pC]||t["@@iterator"],typeof t=="function"?t:null)}var Pn=Object.assign,D1;function Yf(t){if(D1===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);D1=e&&e[1]||""}return`
`+D1+t}var M1=!1;function z1(t,e){if(!t||M1)return"";M1=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(T){var a=T}Reflect.construct(t,[],e)}else{try{e.call()}catch(T){a=T}t.call(e.prototype)}else{try{throw Error()}catch(T){a=T}t()}}catch(T){if(T&&a&&typeof T.stack=="string"){for(var u=T.stack.split(`
`),d=a.stack.split(`
`),_=u.length-1,l=d.length-1;1<=_&&0<=l&&u[_]!==d[l];)l--;for(;1<=_&&0<=l;_--,l--)if(u[_]!==d[l]){if(_!==1||l!==1)do if(_--,l--,0>l||u[_]!==d[l]){var w=`
`+u[_].replace(" at new "," at ");return t.displayName&&w.includes("<anonymous>")&&(w=w.replace("<anonymous>",t.displayName)),w}while(1<=_&&0<=l);break}}}finally{M1=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Yf(t):""}function VL(t){switch(t.tag){case 5:return Yf(t.type);case 16:return Yf("Lazy");case 13:return Yf("Suspense");case 19:return Yf("SuspenseList");case 0:case 2:case 15:return t=z1(t.type,!1),t;case 11:return t=z1(t.type.render,!1),t;case 1:return t=z1(t.type,!0),t;default:return""}}function Uw(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case rd:return"Fragment";case td:return"Portal";case Lw:return"Profiler";case iS:return"StrictMode";case Bw:return"Suspense";case Nw:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case iz:return(t.displayName||"Context")+".Consumer";case nz:return(t._context.displayName||"Context")+".Provider";case oS:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case aS:return e=t.displayName||null,e!==null?e:Uw(t.type)||"Memo";case ec:e=t._payload,t=t._init;try{return Uw(t(e))}catch{}}return null}function $L(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Uw(e);case 8:return e===iS?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function gc(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function az(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function WL(t){var e=az(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),a=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var u=n.get,d=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return u.call(this)},set:function(_){a=""+_,d.call(this,_)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(_){a=""+_},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Cg(t){t._valueTracker||(t._valueTracker=WL(t))}function sz(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),a="";return t&&(a=az(t)?t.checked?"true":"false":t.value),t=a,t!==n?(e.setValue(t),!0):!1}function e_(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function jw(t,e){var n=e.checked;return Pn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function fC(t,e){var n=e.defaultValue==null?"":e.defaultValue,a=e.checked!=null?e.checked:e.defaultChecked;n=gc(e.value!=null?e.value:n),t._wrapperState={initialChecked:a,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function lz(t,e){e=e.checked,e!=null&&nS(t,"checked",e,!1)}function Vw(t,e){lz(t,e);var n=gc(e.value),a=e.type;if(n!=null)a==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(a==="submit"||a==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?$w(t,e.type,n):e.hasOwnProperty("defaultValue")&&$w(t,e.type,gc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function mC(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var a=e.type;if(!(a!=="submit"&&a!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function $w(t,e,n){(e!=="number"||e_(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Qf=Array.isArray;function gd(t,e,n,a){if(t=t.options,e){e={};for(var u=0;u<n.length;u++)e["$"+n[u]]=!0;for(n=0;n<t.length;n++)u=e.hasOwnProperty("$"+t[n].value),t[n].selected!==u&&(t[n].selected=u),u&&a&&(t[n].defaultSelected=!0)}else{for(n=""+gc(n),e=null,u=0;u<t.length;u++){if(t[u].value===n){t[u].selected=!0,a&&(t[u].defaultSelected=!0);return}e!==null||t[u].disabled||(e=t[u])}e!==null&&(e.selected=!0)}}function Ww(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(yt(91));return Pn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function gC(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(yt(92));if(Qf(n)){if(1<n.length)throw Error(yt(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:gc(n)}}function cz(t,e){var n=gc(e.value),a=gc(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),a!=null&&(t.defaultValue=""+a)}function yC(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function uz(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Gw(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?uz(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var kg,hz=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,a,u){MSApp.execUnsafeLocalFunction(function(){return t(e,n,a,u)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(kg=kg||document.createElement("div"),kg.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=kg.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function pm(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var tm={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},GL=["Webkit","ms","Moz","O"];Object.keys(tm).forEach(function(t){GL.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),tm[e]=tm[t]})});function dz(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||tm.hasOwnProperty(t)&&tm[t]?(""+e).trim():e+"px"}function pz(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var a=n.indexOf("--")===0,u=dz(n,e[n],a);n==="float"&&(n="cssFloat"),a?t.setProperty(n,u):t[n]=u}}var HL=Pn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Hw(t,e){if(e){if(HL[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(yt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(yt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(yt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(yt(62))}}function qw(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zw=null;function sS(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Kw=null,yd=null,_d=null;function _C(t){if(t=Bm(t)){if(typeof Kw!="function")throw Error(yt(280));var e=t.stateNode;e&&(e=V_(e),Kw(t.stateNode,t.type,e))}}function fz(t){yd?_d?_d.push(t):_d=[t]:yd=t}function mz(){if(yd){var t=yd,e=_d;if(_d=yd=null,_C(t),e)for(t=0;t<e.length;t++)_C(e[t])}}function gz(t,e){return t(e)}function yz(){}var R1=!1;function _z(t,e,n){if(R1)return t(e,n);R1=!0;try{return gz(t,e,n)}finally{R1=!1,(yd!==null||_d!==null)&&(yz(),mz())}}function fm(t,e){var n=t.stateNode;if(n===null)return null;var a=V_(n);if(a===null)return null;n=a[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(t=t.type,a=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!a;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(yt(231,e,typeof n));return n}var Xw=!1;if(sl)try{var If={};Object.defineProperty(If,"passive",{get:function(){Xw=!0}}),window.addEventListener("test",If,If),window.removeEventListener("test",If,If)}catch{Xw=!1}function qL(t,e,n,a,u,d,_,l,w){var T=Array.prototype.slice.call(arguments,3);try{e.apply(n,T)}catch(C){this.onError(C)}}var rm=!1,t_=null,r_=!1,Yw=null,ZL={onError:function(t){rm=!0,t_=t}};function KL(t,e,n,a,u,d,_,l,w){rm=!1,t_=null,qL.apply(ZL,arguments)}function XL(t,e,n,a,u,d,_,l,w){if(KL.apply(this,arguments),rm){if(rm){var T=t_;rm=!1,t_=null}else throw Error(yt(198));r_||(r_=!0,Yw=T)}}function Fu(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function vz(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function vC(t){if(Fu(t)!==t)throw Error(yt(188))}function YL(t){var e=t.alternate;if(!e){if(e=Fu(t),e===null)throw Error(yt(188));return e!==t?null:t}for(var n=t,a=e;;){var u=n.return;if(u===null)break;var d=u.alternate;if(d===null){if(a=u.return,a!==null){n=a;continue}break}if(u.child===d.child){for(d=u.child;d;){if(d===n)return vC(u),t;if(d===a)return vC(u),e;d=d.sibling}throw Error(yt(188))}if(n.return!==a.return)n=u,a=d;else{for(var _=!1,l=u.child;l;){if(l===n){_=!0,n=u,a=d;break}if(l===a){_=!0,a=u,n=d;break}l=l.sibling}if(!_){for(l=d.child;l;){if(l===n){_=!0,n=d,a=u;break}if(l===a){_=!0,a=d,n=u;break}l=l.sibling}if(!_)throw Error(yt(189))}}if(n.alternate!==a)throw Error(yt(190))}if(n.tag!==3)throw Error(yt(188));return n.stateNode.current===n?t:e}function xz(t){return t=YL(t),t!==null?bz(t):null}function bz(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=bz(t);if(e!==null)return e;t=t.sibling}return null}var wz=Uo.unstable_scheduleCallback,xC=Uo.unstable_cancelCallback,QL=Uo.unstable_shouldYield,JL=Uo.unstable_requestPaint,Ln=Uo.unstable_now,eB=Uo.unstable_getCurrentPriorityLevel,lS=Uo.unstable_ImmediatePriority,Ez=Uo.unstable_UserBlockingPriority,n_=Uo.unstable_NormalPriority,tB=Uo.unstable_LowPriority,Sz=Uo.unstable_IdlePriority,B_=null,Ts=null;function rB(t){if(Ts&&typeof Ts.onCommitFiberRoot=="function")try{Ts.onCommitFiberRoot(B_,t,void 0,(t.current.flags&128)===128)}catch{}}var Wa=Math.clz32?Math.clz32:oB,nB=Math.log,iB=Math.LN2;function oB(t){return t>>>=0,t===0?32:31-(nB(t)/iB|0)|0}var Pg=64,Dg=4194304;function Jf(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function i_(t,e){var n=t.pendingLanes;if(n===0)return 0;var a=0,u=t.suspendedLanes,d=t.pingedLanes,_=n&268435455;if(_!==0){var l=_&~u;l!==0?a=Jf(l):(d&=_,d!==0&&(a=Jf(d)))}else _=n&~u,_!==0?a=Jf(_):d!==0&&(a=Jf(d));if(a===0)return 0;if(e!==0&&e!==a&&!(e&u)&&(u=a&-a,d=e&-e,u>=d||u===16&&(d&4194240)!==0))return e;if(a&4&&(a|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=a;0<e;)n=31-Wa(e),u=1<<n,a|=t[n],e&=~u;return a}function aB(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sB(t,e){for(var n=t.suspendedLanes,a=t.pingedLanes,u=t.expirationTimes,d=t.pendingLanes;0<d;){var _=31-Wa(d),l=1<<_,w=u[_];w===-1?(!(l&n)||l&a)&&(u[_]=aB(l,e)):w<=e&&(t.expiredLanes|=l),d&=~l}}function Qw(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Tz(){var t=Pg;return Pg<<=1,!(Pg&4194240)&&(Pg=64),t}function O1(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Fm(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Wa(e),t[e]=n}function lB(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var a=t.eventTimes;for(t=t.expirationTimes;0<n;){var u=31-Wa(n),d=1<<u;e[u]=0,a[u]=-1,t[u]=-1,n&=~d}}function cS(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var a=31-Wa(n),u=1<<a;u&e|t[a]&e&&(t[a]|=e),n&=~u}}var Kr=0;function Az(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Iz,uS,Cz,kz,Pz,Jw=!1,Mg=[],sc=null,lc=null,cc=null,mm=new Map,gm=new Map,rc=[],cB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function bC(t,e){switch(t){case"focusin":case"focusout":sc=null;break;case"dragenter":case"dragleave":lc=null;break;case"mouseover":case"mouseout":cc=null;break;case"pointerover":case"pointerout":mm.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":gm.delete(e.pointerId)}}function Cf(t,e,n,a,u,d){return t===null||t.nativeEvent!==d?(t={blockedOn:e,domEventName:n,eventSystemFlags:a,nativeEvent:d,targetContainers:[u]},e!==null&&(e=Bm(e),e!==null&&uS(e)),t):(t.eventSystemFlags|=a,e=t.targetContainers,u!==null&&e.indexOf(u)===-1&&e.push(u),t)}function uB(t,e,n,a,u){switch(e){case"focusin":return sc=Cf(sc,t,e,n,a,u),!0;case"dragenter":return lc=Cf(lc,t,e,n,a,u),!0;case"mouseover":return cc=Cf(cc,t,e,n,a,u),!0;case"pointerover":var d=u.pointerId;return mm.set(d,Cf(mm.get(d)||null,t,e,n,a,u)),!0;case"gotpointercapture":return d=u.pointerId,gm.set(d,Cf(gm.get(d)||null,t,e,n,a,u)),!0}return!1}function Dz(t){var e=Eu(t.target);if(e!==null){var n=Fu(e);if(n!==null){if(e=n.tag,e===13){if(e=vz(n),e!==null){t.blockedOn=e,Pz(t.priority,function(){Cz(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Fy(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=eE(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var a=new n.constructor(n.type,n);Zw=a,n.target.dispatchEvent(a),Zw=null}else return e=Bm(n),e!==null&&uS(e),t.blockedOn=n,!1;e.shift()}return!0}function wC(t,e,n){Fy(t)&&n.delete(e)}function hB(){Jw=!1,sc!==null&&Fy(sc)&&(sc=null),lc!==null&&Fy(lc)&&(lc=null),cc!==null&&Fy(cc)&&(cc=null),mm.forEach(wC),gm.forEach(wC)}function kf(t,e){t.blockedOn===e&&(t.blockedOn=null,Jw||(Jw=!0,Uo.unstable_scheduleCallback(Uo.unstable_NormalPriority,hB)))}function ym(t){function e(u){return kf(u,t)}if(0<Mg.length){kf(Mg[0],t);for(var n=1;n<Mg.length;n++){var a=Mg[n];a.blockedOn===t&&(a.blockedOn=null)}}for(sc!==null&&kf(sc,t),lc!==null&&kf(lc,t),cc!==null&&kf(cc,t),mm.forEach(e),gm.forEach(e),n=0;n<rc.length;n++)a=rc[n],a.blockedOn===t&&(a.blockedOn=null);for(;0<rc.length&&(n=rc[0],n.blockedOn===null);)Dz(n),n.blockedOn===null&&rc.shift()}var vd=hl.ReactCurrentBatchConfig,o_=!0;function dB(t,e,n,a){var u=Kr,d=vd.transition;vd.transition=null;try{Kr=1,hS(t,e,n,a)}finally{Kr=u,vd.transition=d}}function pB(t,e,n,a){var u=Kr,d=vd.transition;vd.transition=null;try{Kr=4,hS(t,e,n,a)}finally{Kr=u,vd.transition=d}}function hS(t,e,n,a){if(o_){var u=eE(t,e,n,a);if(u===null)G1(t,e,a,a_,n),bC(t,a);else if(uB(u,t,e,n,a))a.stopPropagation();else if(bC(t,a),e&4&&-1<cB.indexOf(t)){for(;u!==null;){var d=Bm(u);if(d!==null&&Iz(d),d=eE(t,e,n,a),d===null&&G1(t,e,a,a_,n),d===u)break;u=d}u!==null&&a.stopPropagation()}else G1(t,e,a,null,n)}}var a_=null;function eE(t,e,n,a){if(a_=null,t=sS(a),t=Eu(t),t!==null)if(e=Fu(t),e===null)t=null;else if(n=e.tag,n===13){if(t=vz(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return a_=t,null}function Mz(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(eB()){case lS:return 1;case Ez:return 4;case n_:case tB:return 16;case Sz:return 536870912;default:return 16}default:return 16}}var ic=null,dS=null,Ly=null;function zz(){if(Ly)return Ly;var t,e=dS,n=e.length,a,u="value"in ic?ic.value:ic.textContent,d=u.length;for(t=0;t<n&&e[t]===u[t];t++);var _=n-t;for(a=1;a<=_&&e[n-a]===u[d-a];a++);return Ly=u.slice(t,1<a?1-a:void 0)}function By(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function zg(){return!0}function EC(){return!1}function Vo(t){function e(n,a,u,d,_){this._reactName=n,this._targetInst=u,this.type=a,this.nativeEvent=d,this.target=_,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(d):d[l]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?zg:EC,this.isPropagationStopped=EC,this}return Pn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=zg)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=zg)},persist:function(){},isPersistent:zg}),e}var Rd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pS=Vo(Rd),Lm=Pn({},Rd,{view:0,detail:0}),fB=Vo(Lm),F1,L1,Pf,N_=Pn({},Lm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fS,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Pf&&(Pf&&t.type==="mousemove"?(F1=t.screenX-Pf.screenX,L1=t.screenY-Pf.screenY):L1=F1=0,Pf=t),F1)},movementY:function(t){return"movementY"in t?t.movementY:L1}}),SC=Vo(N_),mB=Pn({},N_,{dataTransfer:0}),gB=Vo(mB),yB=Pn({},Lm,{relatedTarget:0}),B1=Vo(yB),_B=Pn({},Rd,{animationName:0,elapsedTime:0,pseudoElement:0}),vB=Vo(_B),xB=Pn({},Rd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),bB=Vo(xB),wB=Pn({},Rd,{data:0}),TC=Vo(wB),EB={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},SB={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},TB={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function AB(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=TB[t])?!!e[t]:!1}function fS(){return AB}var IB=Pn({},Lm,{key:function(t){if(t.key){var e=EB[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=By(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?SB[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fS,charCode:function(t){return t.type==="keypress"?By(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?By(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),CB=Vo(IB),kB=Pn({},N_,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),AC=Vo(kB),PB=Pn({},Lm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fS}),DB=Vo(PB),MB=Pn({},Rd,{propertyName:0,elapsedTime:0,pseudoElement:0}),zB=Vo(MB),RB=Pn({},N_,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),OB=Vo(RB),FB=[9,13,27,32],mS=sl&&"CompositionEvent"in window,nm=null;sl&&"documentMode"in document&&(nm=document.documentMode);var LB=sl&&"TextEvent"in window&&!nm,Rz=sl&&(!mS||nm&&8<nm&&11>=nm),IC=String.fromCharCode(32),CC=!1;function Oz(t,e){switch(t){case"keyup":return FB.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fz(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var nd=!1;function BB(t,e){switch(t){case"compositionend":return Fz(e);case"keypress":return e.which!==32?null:(CC=!0,IC);case"textInput":return t=e.data,t===IC&&CC?null:t;default:return null}}function NB(t,e){if(nd)return t==="compositionend"||!mS&&Oz(t,e)?(t=zz(),Ly=dS=ic=null,nd=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Rz&&e.locale!=="ko"?null:e.data;default:return null}}var UB={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kC(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!UB[t.type]:e==="textarea"}function Lz(t,e,n,a){fz(a),e=s_(e,"onChange"),0<e.length&&(n=new pS("onChange","change",null,n,a),t.push({event:n,listeners:e}))}var im=null,_m=null;function jB(t){Zz(t,0)}function U_(t){var e=ad(t);if(sz(e))return t}function VB(t,e){if(t==="change")return e}var Bz=!1;if(sl){var N1;if(sl){var U1="oninput"in document;if(!U1){var PC=document.createElement("div");PC.setAttribute("oninput","return;"),U1=typeof PC.oninput=="function"}N1=U1}else N1=!1;Bz=N1&&(!document.documentMode||9<document.documentMode)}function DC(){im&&(im.detachEvent("onpropertychange",Nz),_m=im=null)}function Nz(t){if(t.propertyName==="value"&&U_(_m)){var e=[];Lz(e,_m,t,sS(t)),_z(jB,e)}}function $B(t,e,n){t==="focusin"?(DC(),im=e,_m=n,im.attachEvent("onpropertychange",Nz)):t==="focusout"&&DC()}function WB(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return U_(_m)}function GB(t,e){if(t==="click")return U_(e)}function HB(t,e){if(t==="input"||t==="change")return U_(e)}function qB(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Za=typeof Object.is=="function"?Object.is:qB;function vm(t,e){if(Za(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),a=Object.keys(e);if(n.length!==a.length)return!1;for(a=0;a<n.length;a++){var u=n[a];if(!Fw.call(e,u)||!Za(t[u],e[u]))return!1}return!0}function MC(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function zC(t,e){var n=MC(t);t=0;for(var a;n;){if(n.nodeType===3){if(a=t+n.textContent.length,t<=e&&a>=e)return{node:n,offset:e-t};t=a}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=MC(n)}}function Uz(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Uz(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function jz(){for(var t=window,e=e_();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=e_(t.document)}return e}function gS(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function ZB(t){var e=jz(),n=t.focusedElem,a=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Uz(n.ownerDocument.documentElement,n)){if(a!==null&&gS(n)){if(e=a.start,t=a.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var u=n.textContent.length,d=Math.min(a.start,u);a=a.end===void 0?d:Math.min(a.end,u),!t.extend&&d>a&&(u=a,a=d,d=u),u=zC(n,d);var _=zC(n,a);u&&_&&(t.rangeCount!==1||t.anchorNode!==u.node||t.anchorOffset!==u.offset||t.focusNode!==_.node||t.focusOffset!==_.offset)&&(e=e.createRange(),e.setStart(u.node,u.offset),t.removeAllRanges(),d>a?(t.addRange(e),t.extend(_.node,_.offset)):(e.setEnd(_.node,_.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var KB=sl&&"documentMode"in document&&11>=document.documentMode,id=null,tE=null,om=null,rE=!1;function RC(t,e,n){var a=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;rE||id==null||id!==e_(a)||(a=id,"selectionStart"in a&&gS(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),om&&vm(om,a)||(om=a,a=s_(tE,"onSelect"),0<a.length&&(e=new pS("onSelect","select",null,e,n),t.push({event:e,listeners:a}),e.target=id)))}function Rg(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var od={animationend:Rg("Animation","AnimationEnd"),animationiteration:Rg("Animation","AnimationIteration"),animationstart:Rg("Animation","AnimationStart"),transitionend:Rg("Transition","TransitionEnd")},j1={},Vz={};sl&&(Vz=document.createElement("div").style,"AnimationEvent"in window||(delete od.animationend.animation,delete od.animationiteration.animation,delete od.animationstart.animation),"TransitionEvent"in window||delete od.transitionend.transition);function j_(t){if(j1[t])return j1[t];if(!od[t])return t;var e=od[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Vz)return j1[t]=e[n];return t}var $z=j_("animationend"),Wz=j_("animationiteration"),Gz=j_("animationstart"),Hz=j_("transitionend"),qz=new Map,OC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xc(t,e){qz.set(t,e),Ou(e,[t])}for(var V1=0;V1<OC.length;V1++){var $1=OC[V1],XB=$1.toLowerCase(),YB=$1[0].toUpperCase()+$1.slice(1);xc(XB,"on"+YB)}xc($z,"onAnimationEnd");xc(Wz,"onAnimationIteration");xc(Gz,"onAnimationStart");xc("dblclick","onDoubleClick");xc("focusin","onFocus");xc("focusout","onBlur");xc(Hz,"onTransitionEnd");Sd("onMouseEnter",["mouseout","mouseover"]);Sd("onMouseLeave",["mouseout","mouseover"]);Sd("onPointerEnter",["pointerout","pointerover"]);Sd("onPointerLeave",["pointerout","pointerover"]);Ou("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ou("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ou("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ou("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ou("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ou("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var em="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),QB=new Set("cancel close invalid load scroll toggle".split(" ").concat(em));function FC(t,e,n){var a=t.type||"unknown-event";t.currentTarget=n,XL(a,e,void 0,t),t.currentTarget=null}function Zz(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var a=t[n],u=a.event;a=a.listeners;e:{var d=void 0;if(e)for(var _=a.length-1;0<=_;_--){var l=a[_],w=l.instance,T=l.currentTarget;if(l=l.listener,w!==d&&u.isPropagationStopped())break e;FC(u,l,T),d=w}else for(_=0;_<a.length;_++){if(l=a[_],w=l.instance,T=l.currentTarget,l=l.listener,w!==d&&u.isPropagationStopped())break e;FC(u,l,T),d=w}}}if(r_)throw t=Yw,r_=!1,Yw=null,t}function hn(t,e){var n=e[sE];n===void 0&&(n=e[sE]=new Set);var a=t+"__bubble";n.has(a)||(Kz(e,t,2,!1),n.add(a))}function W1(t,e,n){var a=0;e&&(a|=4),Kz(n,t,a,e)}var Og="_reactListening"+Math.random().toString(36).slice(2);function xm(t){if(!t[Og]){t[Og]=!0,rz.forEach(function(n){n!=="selectionchange"&&(QB.has(n)||W1(n,!1,t),W1(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Og]||(e[Og]=!0,W1("selectionchange",!1,e))}}function Kz(t,e,n,a){switch(Mz(e)){case 1:var u=dB;break;case 4:u=pB;break;default:u=hS}n=u.bind(null,e,n,t),u=void 0,!Xw||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(u=!0),a?u!==void 0?t.addEventListener(e,n,{capture:!0,passive:u}):t.addEventListener(e,n,!0):u!==void 0?t.addEventListener(e,n,{passive:u}):t.addEventListener(e,n,!1)}function G1(t,e,n,a,u){var d=a;if(!(e&1)&&!(e&2)&&a!==null)e:for(;;){if(a===null)return;var _=a.tag;if(_===3||_===4){var l=a.stateNode.containerInfo;if(l===u||l.nodeType===8&&l.parentNode===u)break;if(_===4)for(_=a.return;_!==null;){var w=_.tag;if((w===3||w===4)&&(w=_.stateNode.containerInfo,w===u||w.nodeType===8&&w.parentNode===u))return;_=_.return}for(;l!==null;){if(_=Eu(l),_===null)return;if(w=_.tag,w===5||w===6){a=d=_;continue e}l=l.parentNode}}a=a.return}_z(function(){var T=d,C=sS(n),P=[];e:{var z=qz.get(t);if(z!==void 0){var $=pS,U=t;switch(t){case"keypress":if(By(n)===0)break e;case"keydown":case"keyup":$=CB;break;case"focusin":U="focus",$=B1;break;case"focusout":U="blur",$=B1;break;case"beforeblur":case"afterblur":$=B1;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$=SC;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$=gB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$=DB;break;case $z:case Wz:case Gz:$=vB;break;case Hz:$=zB;break;case"scroll":$=fB;break;case"wheel":$=OB;break;case"copy":case"cut":case"paste":$=bB;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$=AC}var W=(e&4)!==0,N=!W&&t==="scroll",V=W?z!==null?z+"Capture":null:z;W=[];for(var R=T,F;R!==null;){F=R;var H=F.stateNode;if(F.tag===5&&H!==null&&(F=H,V!==null&&(H=fm(R,V),H!=null&&W.push(bm(R,H,F)))),N)break;R=R.return}0<W.length&&(z=new $(z,U,null,n,C),P.push({event:z,listeners:W}))}}if(!(e&7)){e:{if(z=t==="mouseover"||t==="pointerover",$=t==="mouseout"||t==="pointerout",z&&n!==Zw&&(U=n.relatedTarget||n.fromElement)&&(Eu(U)||U[ll]))break e;if(($||z)&&(z=C.window===C?C:(z=C.ownerDocument)?z.defaultView||z.parentWindow:window,$?(U=n.relatedTarget||n.toElement,$=T,U=U?Eu(U):null,U!==null&&(N=Fu(U),U!==N||U.tag!==5&&U.tag!==6)&&(U=null)):($=null,U=T),$!==U)){if(W=SC,H="onMouseLeave",V="onMouseEnter",R="mouse",(t==="pointerout"||t==="pointerover")&&(W=AC,H="onPointerLeave",V="onPointerEnter",R="pointer"),N=$==null?z:ad($),F=U==null?z:ad(U),z=new W(H,R+"leave",$,n,C),z.target=N,z.relatedTarget=F,H=null,Eu(C)===T&&(W=new W(V,R+"enter",U,n,C),W.target=F,W.relatedTarget=N,H=W),N=H,$&&U)t:{for(W=$,V=U,R=0,F=W;F;F=Uh(F))R++;for(F=0,H=V;H;H=Uh(H))F++;for(;0<R-F;)W=Uh(W),R--;for(;0<F-R;)V=Uh(V),F--;for(;R--;){if(W===V||V!==null&&W===V.alternate)break t;W=Uh(W),V=Uh(V)}W=null}else W=null;$!==null&&LC(P,z,$,W,!1),U!==null&&N!==null&&LC(P,N,U,W,!0)}}e:{if(z=T?ad(T):window,$=z.nodeName&&z.nodeName.toLowerCase(),$==="select"||$==="input"&&z.type==="file")var J=VB;else if(kC(z))if(Bz)J=HB;else{J=WB;var te=$B}else($=z.nodeName)&&$.toLowerCase()==="input"&&(z.type==="checkbox"||z.type==="radio")&&(J=GB);if(J&&(J=J(t,T))){Lz(P,J,n,C);break e}te&&te(t,z,T),t==="focusout"&&(te=z._wrapperState)&&te.controlled&&z.type==="number"&&$w(z,"number",z.value)}switch(te=T?ad(T):window,t){case"focusin":(kC(te)||te.contentEditable==="true")&&(id=te,tE=T,om=null);break;case"focusout":om=tE=id=null;break;case"mousedown":rE=!0;break;case"contextmenu":case"mouseup":case"dragend":rE=!1,RC(P,n,C);break;case"selectionchange":if(KB)break;case"keydown":case"keyup":RC(P,n,C)}var se;if(mS)e:{switch(t){case"compositionstart":var ge="onCompositionStart";break e;case"compositionend":ge="onCompositionEnd";break e;case"compositionupdate":ge="onCompositionUpdate";break e}ge=void 0}else nd?Oz(t,n)&&(ge="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(ge="onCompositionStart");ge&&(Rz&&n.locale!=="ko"&&(nd||ge!=="onCompositionStart"?ge==="onCompositionEnd"&&nd&&(se=zz()):(ic=C,dS="value"in ic?ic.value:ic.textContent,nd=!0)),te=s_(T,ge),0<te.length&&(ge=new TC(ge,t,null,n,C),P.push({event:ge,listeners:te}),se?ge.data=se:(se=Fz(n),se!==null&&(ge.data=se)))),(se=LB?BB(t,n):NB(t,n))&&(T=s_(T,"onBeforeInput"),0<T.length&&(C=new TC("onBeforeInput","beforeinput",null,n,C),P.push({event:C,listeners:T}),C.data=se))}Zz(P,e)})}function bm(t,e,n){return{instance:t,listener:e,currentTarget:n}}function s_(t,e){for(var n=e+"Capture",a=[];t!==null;){var u=t,d=u.stateNode;u.tag===5&&d!==null&&(u=d,d=fm(t,n),d!=null&&a.unshift(bm(t,d,u)),d=fm(t,e),d!=null&&a.push(bm(t,d,u))),t=t.return}return a}function Uh(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function LC(t,e,n,a,u){for(var d=e._reactName,_=[];n!==null&&n!==a;){var l=n,w=l.alternate,T=l.stateNode;if(w!==null&&w===a)break;l.tag===5&&T!==null&&(l=T,u?(w=fm(n,d),w!=null&&_.unshift(bm(n,w,l))):u||(w=fm(n,d),w!=null&&_.push(bm(n,w,l)))),n=n.return}_.length!==0&&t.push({event:e,listeners:_})}var JB=/\r\n?/g,e8=/\u0000|\uFFFD/g;function BC(t){return(typeof t=="string"?t:""+t).replace(JB,`
`).replace(e8,"")}function Fg(t,e,n){if(e=BC(e),BC(t)!==e&&n)throw Error(yt(425))}function l_(){}var nE=null,iE=null;function oE(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var aE=typeof setTimeout=="function"?setTimeout:void 0,t8=typeof clearTimeout=="function"?clearTimeout:void 0,NC=typeof Promise=="function"?Promise:void 0,r8=typeof queueMicrotask=="function"?queueMicrotask:typeof NC<"u"?function(t){return NC.resolve(null).then(t).catch(n8)}:aE;function n8(t){setTimeout(function(){throw t})}function H1(t,e){var n=e,a=0;do{var u=n.nextSibling;if(t.removeChild(n),u&&u.nodeType===8)if(n=u.data,n==="/$"){if(a===0){t.removeChild(u),ym(e);return}a--}else n!=="$"&&n!=="$?"&&n!=="$!"||a++;n=u}while(n);ym(e)}function uc(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function UC(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Od=Math.random().toString(36).slice(2),Es="__reactFiber$"+Od,wm="__reactProps$"+Od,ll="__reactContainer$"+Od,sE="__reactEvents$"+Od,i8="__reactListeners$"+Od,o8="__reactHandles$"+Od;function Eu(t){var e=t[Es];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ll]||n[Es]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=UC(t);t!==null;){if(n=t[Es])return n;t=UC(t)}return e}t=n,n=t.parentNode}return null}function Bm(t){return t=t[Es]||t[ll],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ad(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(yt(33))}function V_(t){return t[wm]||null}var lE=[],sd=-1;function bc(t){return{current:t}}function dn(t){0>sd||(t.current=lE[sd],lE[sd]=null,sd--)}function on(t,e){sd++,lE[sd]=t.current,t.current=e}var yc={},Wi=bc(yc),go=bc(!1),ku=yc;function Td(t,e){var n=t.type.contextTypes;if(!n)return yc;var a=t.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===e)return a.__reactInternalMemoizedMaskedChildContext;var u={},d;for(d in n)u[d]=e[d];return a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=u),u}function yo(t){return t=t.childContextTypes,t!=null}function c_(){dn(go),dn(Wi)}function jC(t,e,n){if(Wi.current!==yc)throw Error(yt(168));on(Wi,e),on(go,n)}function Xz(t,e,n){var a=t.stateNode;if(e=e.childContextTypes,typeof a.getChildContext!="function")return n;a=a.getChildContext();for(var u in a)if(!(u in e))throw Error(yt(108,$L(t)||"Unknown",u));return Pn({},n,a)}function u_(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||yc,ku=Wi.current,on(Wi,t),on(go,go.current),!0}function VC(t,e,n){var a=t.stateNode;if(!a)throw Error(yt(169));n?(t=Xz(t,e,ku),a.__reactInternalMemoizedMergedChildContext=t,dn(go),dn(Wi),on(Wi,t)):dn(go),on(go,n)}var tl=null,$_=!1,q1=!1;function Yz(t){tl===null?tl=[t]:tl.push(t)}function a8(t){$_=!0,Yz(t)}function wc(){if(!q1&&tl!==null){q1=!0;var t=0,e=Kr;try{var n=tl;for(Kr=1;t<n.length;t++){var a=n[t];do a=a(!0);while(a!==null)}tl=null,$_=!1}catch(u){throw tl!==null&&(tl=tl.slice(t+1)),wz(lS,wc),u}finally{Kr=e,q1=!1}}return null}var ld=[],cd=0,h_=null,d_=0,sa=[],la=0,Pu=null,il=1,ol="";function xu(t,e){ld[cd++]=d_,ld[cd++]=h_,h_=t,d_=e}function Qz(t,e,n){sa[la++]=il,sa[la++]=ol,sa[la++]=Pu,Pu=t;var a=il;t=ol;var u=32-Wa(a)-1;a&=~(1<<u),n+=1;var d=32-Wa(e)+u;if(30<d){var _=u-u%5;d=(a&(1<<_)-1).toString(32),a>>=_,u-=_,il=1<<32-Wa(e)+u|n<<u|a,ol=d+t}else il=1<<d|n<<u|a,ol=t}function yS(t){t.return!==null&&(xu(t,1),Qz(t,1,0))}function _S(t){for(;t===h_;)h_=ld[--cd],ld[cd]=null,d_=ld[--cd],ld[cd]=null;for(;t===Pu;)Pu=sa[--la],sa[la]=null,ol=sa[--la],sa[la]=null,il=sa[--la],sa[la]=null}var Bo=null,Lo=null,gn=!1,Va=null;function Jz(t,e){var n=ca(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function $C(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Bo=t,Lo=uc(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Bo=t,Lo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Pu!==null?{id:il,overflow:ol}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ca(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Bo=t,Lo=null,!0):!1;default:return!1}}function cE(t){return(t.mode&1)!==0&&(t.flags&128)===0}function uE(t){if(gn){var e=Lo;if(e){var n=e;if(!$C(t,e)){if(cE(t))throw Error(yt(418));e=uc(n.nextSibling);var a=Bo;e&&$C(t,e)?Jz(a,n):(t.flags=t.flags&-4097|2,gn=!1,Bo=t)}}else{if(cE(t))throw Error(yt(418));t.flags=t.flags&-4097|2,gn=!1,Bo=t}}}function WC(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Bo=t}function Lg(t){if(t!==Bo)return!1;if(!gn)return WC(t),gn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!oE(t.type,t.memoizedProps)),e&&(e=Lo)){if(cE(t))throw e4(),Error(yt(418));for(;e;)Jz(t,e),e=uc(e.nextSibling)}if(WC(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(yt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Lo=uc(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Lo=null}}else Lo=Bo?uc(t.stateNode.nextSibling):null;return!0}function e4(){for(var t=Lo;t;)t=uc(t.nextSibling)}function Ad(){Lo=Bo=null,gn=!1}function vS(t){Va===null?Va=[t]:Va.push(t)}var s8=hl.ReactCurrentBatchConfig;function Df(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(yt(309));var a=n.stateNode}if(!a)throw Error(yt(147,t));var u=a,d=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===d?e.ref:(e=function(_){var l=u.refs;_===null?delete l[d]:l[d]=_},e._stringRef=d,e)}if(typeof t!="string")throw Error(yt(284));if(!n._owner)throw Error(yt(290,t))}return t}function Bg(t,e){throw t=Object.prototype.toString.call(e),Error(yt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function GC(t){var e=t._init;return e(t._payload)}function t4(t){function e(V,R){if(t){var F=V.deletions;F===null?(V.deletions=[R],V.flags|=16):F.push(R)}}function n(V,R){if(!t)return null;for(;R!==null;)e(V,R),R=R.sibling;return null}function a(V,R){for(V=new Map;R!==null;)R.key!==null?V.set(R.key,R):V.set(R.index,R),R=R.sibling;return V}function u(V,R){return V=fc(V,R),V.index=0,V.sibling=null,V}function d(V,R,F){return V.index=F,t?(F=V.alternate,F!==null?(F=F.index,F<R?(V.flags|=2,R):F):(V.flags|=2,R)):(V.flags|=1048576,R)}function _(V){return t&&V.alternate===null&&(V.flags|=2),V}function l(V,R,F,H){return R===null||R.tag!==6?(R=eb(F,V.mode,H),R.return=V,R):(R=u(R,F),R.return=V,R)}function w(V,R,F,H){var J=F.type;return J===rd?C(V,R,F.props.children,H,F.key):R!==null&&(R.elementType===J||typeof J=="object"&&J!==null&&J.$$typeof===ec&&GC(J)===R.type)?(H=u(R,F.props),H.ref=Df(V,R,F),H.return=V,H):(H=Gy(F.type,F.key,F.props,null,V.mode,H),H.ref=Df(V,R,F),H.return=V,H)}function T(V,R,F,H){return R===null||R.tag!==4||R.stateNode.containerInfo!==F.containerInfo||R.stateNode.implementation!==F.implementation?(R=tb(F,V.mode,H),R.return=V,R):(R=u(R,F.children||[]),R.return=V,R)}function C(V,R,F,H,J){return R===null||R.tag!==7?(R=Cu(F,V.mode,H,J),R.return=V,R):(R=u(R,F),R.return=V,R)}function P(V,R,F){if(typeof R=="string"&&R!==""||typeof R=="number")return R=eb(""+R,V.mode,F),R.return=V,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case Ig:return F=Gy(R.type,R.key,R.props,null,V.mode,F),F.ref=Df(V,null,R),F.return=V,F;case td:return R=tb(R,V.mode,F),R.return=V,R;case ec:var H=R._init;return P(V,H(R._payload),F)}if(Qf(R)||Af(R))return R=Cu(R,V.mode,F,null),R.return=V,R;Bg(V,R)}return null}function z(V,R,F,H){var J=R!==null?R.key:null;if(typeof F=="string"&&F!==""||typeof F=="number")return J!==null?null:l(V,R,""+F,H);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case Ig:return F.key===J?w(V,R,F,H):null;case td:return F.key===J?T(V,R,F,H):null;case ec:return J=F._init,z(V,R,J(F._payload),H)}if(Qf(F)||Af(F))return J!==null?null:C(V,R,F,H,null);Bg(V,F)}return null}function $(V,R,F,H,J){if(typeof H=="string"&&H!==""||typeof H=="number")return V=V.get(F)||null,l(R,V,""+H,J);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case Ig:return V=V.get(H.key===null?F:H.key)||null,w(R,V,H,J);case td:return V=V.get(H.key===null?F:H.key)||null,T(R,V,H,J);case ec:var te=H._init;return $(V,R,F,te(H._payload),J)}if(Qf(H)||Af(H))return V=V.get(F)||null,C(R,V,H,J,null);Bg(R,H)}return null}function U(V,R,F,H){for(var J=null,te=null,se=R,ge=R=0,xe=null;se!==null&&ge<F.length;ge++){se.index>ge?(xe=se,se=null):xe=se.sibling;var Ee=z(V,se,F[ge],H);if(Ee===null){se===null&&(se=xe);break}t&&se&&Ee.alternate===null&&e(V,se),R=d(Ee,R,ge),te===null?J=Ee:te.sibling=Ee,te=Ee,se=xe}if(ge===F.length)return n(V,se),gn&&xu(V,ge),J;if(se===null){for(;ge<F.length;ge++)se=P(V,F[ge],H),se!==null&&(R=d(se,R,ge),te===null?J=se:te.sibling=se,te=se);return gn&&xu(V,ge),J}for(se=a(V,se);ge<F.length;ge++)xe=$(se,V,ge,F[ge],H),xe!==null&&(t&&xe.alternate!==null&&se.delete(xe.key===null?ge:xe.key),R=d(xe,R,ge),te===null?J=xe:te.sibling=xe,te=xe);return t&&se.forEach(function(Be){return e(V,Be)}),gn&&xu(V,ge),J}function W(V,R,F,H){var J=Af(F);if(typeof J!="function")throw Error(yt(150));if(F=J.call(F),F==null)throw Error(yt(151));for(var te=J=null,se=R,ge=R=0,xe=null,Ee=F.next();se!==null&&!Ee.done;ge++,Ee=F.next()){se.index>ge?(xe=se,se=null):xe=se.sibling;var Be=z(V,se,Ee.value,H);if(Be===null){se===null&&(se=xe);break}t&&se&&Be.alternate===null&&e(V,se),R=d(Be,R,ge),te===null?J=Be:te.sibling=Be,te=Be,se=xe}if(Ee.done)return n(V,se),gn&&xu(V,ge),J;if(se===null){for(;!Ee.done;ge++,Ee=F.next())Ee=P(V,Ee.value,H),Ee!==null&&(R=d(Ee,R,ge),te===null?J=Ee:te.sibling=Ee,te=Ee);return gn&&xu(V,ge),J}for(se=a(V,se);!Ee.done;ge++,Ee=F.next())Ee=$(se,V,ge,Ee.value,H),Ee!==null&&(t&&Ee.alternate!==null&&se.delete(Ee.key===null?ge:Ee.key),R=d(Ee,R,ge),te===null?J=Ee:te.sibling=Ee,te=Ee);return t&&se.forEach(function(Fe){return e(V,Fe)}),gn&&xu(V,ge),J}function N(V,R,F,H){if(typeof F=="object"&&F!==null&&F.type===rd&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case Ig:e:{for(var J=F.key,te=R;te!==null;){if(te.key===J){if(J=F.type,J===rd){if(te.tag===7){n(V,te.sibling),R=u(te,F.props.children),R.return=V,V=R;break e}}else if(te.elementType===J||typeof J=="object"&&J!==null&&J.$$typeof===ec&&GC(J)===te.type){n(V,te.sibling),R=u(te,F.props),R.ref=Df(V,te,F),R.return=V,V=R;break e}n(V,te);break}else e(V,te);te=te.sibling}F.type===rd?(R=Cu(F.props.children,V.mode,H,F.key),R.return=V,V=R):(H=Gy(F.type,F.key,F.props,null,V.mode,H),H.ref=Df(V,R,F),H.return=V,V=H)}return _(V);case td:e:{for(te=F.key;R!==null;){if(R.key===te)if(R.tag===4&&R.stateNode.containerInfo===F.containerInfo&&R.stateNode.implementation===F.implementation){n(V,R.sibling),R=u(R,F.children||[]),R.return=V,V=R;break e}else{n(V,R);break}else e(V,R);R=R.sibling}R=tb(F,V.mode,H),R.return=V,V=R}return _(V);case ec:return te=F._init,N(V,R,te(F._payload),H)}if(Qf(F))return U(V,R,F,H);if(Af(F))return W(V,R,F,H);Bg(V,F)}return typeof F=="string"&&F!==""||typeof F=="number"?(F=""+F,R!==null&&R.tag===6?(n(V,R.sibling),R=u(R,F),R.return=V,V=R):(n(V,R),R=eb(F,V.mode,H),R.return=V,V=R),_(V)):n(V,R)}return N}var Id=t4(!0),r4=t4(!1),p_=bc(null),f_=null,ud=null,xS=null;function bS(){xS=ud=f_=null}function wS(t){var e=p_.current;dn(p_),t._currentValue=e}function hE(t,e,n){for(;t!==null;){var a=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,a!==null&&(a.childLanes|=e)):a!==null&&(a.childLanes&e)!==e&&(a.childLanes|=e),t===n)break;t=t.return}}function xd(t,e){f_=t,xS=ud=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(mo=!0),t.firstContext=null)}function ha(t){var e=t._currentValue;if(xS!==t)if(t={context:t,memoizedValue:e,next:null},ud===null){if(f_===null)throw Error(yt(308));ud=t,f_.dependencies={lanes:0,firstContext:t}}else ud=ud.next=t;return e}var Su=null;function ES(t){Su===null?Su=[t]:Su.push(t)}function n4(t,e,n,a){var u=e.interleaved;return u===null?(n.next=n,ES(e)):(n.next=u.next,u.next=n),e.interleaved=n,cl(t,a)}function cl(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var tc=!1;function SS(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function i4(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function al(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function hc(t,e,n){var a=t.updateQueue;if(a===null)return null;if(a=a.shared,Dr&2){var u=a.pending;return u===null?e.next=e:(e.next=u.next,u.next=e),a.pending=e,cl(t,n)}return u=a.interleaved,u===null?(e.next=e,ES(a)):(e.next=u.next,u.next=e),a.interleaved=e,cl(t,n)}function Ny(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var a=e.lanes;a&=t.pendingLanes,n|=a,e.lanes=n,cS(t,n)}}function HC(t,e){var n=t.updateQueue,a=t.alternate;if(a!==null&&(a=a.updateQueue,n===a)){var u=null,d=null;if(n=n.firstBaseUpdate,n!==null){do{var _={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};d===null?u=d=_:d=d.next=_,n=n.next}while(n!==null);d===null?u=d=e:d=d.next=e}else u=d=e;n={baseState:a.baseState,firstBaseUpdate:u,lastBaseUpdate:d,shared:a.shared,effects:a.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function m_(t,e,n,a){var u=t.updateQueue;tc=!1;var d=u.firstBaseUpdate,_=u.lastBaseUpdate,l=u.shared.pending;if(l!==null){u.shared.pending=null;var w=l,T=w.next;w.next=null,_===null?d=T:_.next=T,_=w;var C=t.alternate;C!==null&&(C=C.updateQueue,l=C.lastBaseUpdate,l!==_&&(l===null?C.firstBaseUpdate=T:l.next=T,C.lastBaseUpdate=w))}if(d!==null){var P=u.baseState;_=0,C=T=w=null,l=d;do{var z=l.lane,$=l.eventTime;if((a&z)===z){C!==null&&(C=C.next={eventTime:$,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var U=t,W=l;switch(z=e,$=n,W.tag){case 1:if(U=W.payload,typeof U=="function"){P=U.call($,P,z);break e}P=U;break e;case 3:U.flags=U.flags&-65537|128;case 0:if(U=W.payload,z=typeof U=="function"?U.call($,P,z):U,z==null)break e;P=Pn({},P,z);break e;case 2:tc=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,z=u.effects,z===null?u.effects=[l]:z.push(l))}else $={eventTime:$,lane:z,tag:l.tag,payload:l.payload,callback:l.callback,next:null},C===null?(T=C=$,w=P):C=C.next=$,_|=z;if(l=l.next,l===null){if(l=u.shared.pending,l===null)break;z=l,l=z.next,z.next=null,u.lastBaseUpdate=z,u.shared.pending=null}}while(1);if(C===null&&(w=P),u.baseState=w,u.firstBaseUpdate=T,u.lastBaseUpdate=C,e=u.shared.interleaved,e!==null){u=e;do _|=u.lane,u=u.next;while(u!==e)}else d===null&&(u.shared.lanes=0);Mu|=_,t.lanes=_,t.memoizedState=P}}function qC(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var a=t[e],u=a.callback;if(u!==null){if(a.callback=null,a=n,typeof u!="function")throw Error(yt(191,u));u.call(a)}}}var Nm={},As=bc(Nm),Em=bc(Nm),Sm=bc(Nm);function Tu(t){if(t===Nm)throw Error(yt(174));return t}function TS(t,e){switch(on(Sm,e),on(Em,t),on(As,Nm),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Gw(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Gw(e,t)}dn(As),on(As,e)}function Cd(){dn(As),dn(Em),dn(Sm)}function o4(t){Tu(Sm.current);var e=Tu(As.current),n=Gw(e,t.type);e!==n&&(on(Em,t),on(As,n))}function AS(t){Em.current===t&&(dn(As),dn(Em))}var Cn=bc(0);function g_(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Z1=[];function IS(){for(var t=0;t<Z1.length;t++)Z1[t]._workInProgressVersionPrimary=null;Z1.length=0}var Uy=hl.ReactCurrentDispatcher,K1=hl.ReactCurrentBatchConfig,Du=0,kn=null,ii=null,fi=null,y_=!1,am=!1,Tm=0,l8=0;function Fi(){throw Error(yt(321))}function CS(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Za(t[n],e[n]))return!1;return!0}function kS(t,e,n,a,u,d){if(Du=d,kn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Uy.current=t===null||t.memoizedState===null?d8:p8,t=n(a,u),am){d=0;do{if(am=!1,Tm=0,25<=d)throw Error(yt(301));d+=1,fi=ii=null,e.updateQueue=null,Uy.current=f8,t=n(a,u)}while(am)}if(Uy.current=__,e=ii!==null&&ii.next!==null,Du=0,fi=ii=kn=null,y_=!1,e)throw Error(yt(300));return t}function PS(){var t=Tm!==0;return Tm=0,t}function ws(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return fi===null?kn.memoizedState=fi=t:fi=fi.next=t,fi}function da(){if(ii===null){var t=kn.alternate;t=t!==null?t.memoizedState:null}else t=ii.next;var e=fi===null?kn.memoizedState:fi.next;if(e!==null)fi=e,ii=t;else{if(t===null)throw Error(yt(310));ii=t,t={memoizedState:ii.memoizedState,baseState:ii.baseState,baseQueue:ii.baseQueue,queue:ii.queue,next:null},fi===null?kn.memoizedState=fi=t:fi=fi.next=t}return fi}function Am(t,e){return typeof e=="function"?e(t):e}function X1(t){var e=da(),n=e.queue;if(n===null)throw Error(yt(311));n.lastRenderedReducer=t;var a=ii,u=a.baseQueue,d=n.pending;if(d!==null){if(u!==null){var _=u.next;u.next=d.next,d.next=_}a.baseQueue=u=d,n.pending=null}if(u!==null){d=u.next,a=a.baseState;var l=_=null,w=null,T=d;do{var C=T.lane;if((Du&C)===C)w!==null&&(w=w.next={lane:0,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null}),a=T.hasEagerState?T.eagerState:t(a,T.action);else{var P={lane:C,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null};w===null?(l=w=P,_=a):w=w.next=P,kn.lanes|=C,Mu|=C}T=T.next}while(T!==null&&T!==d);w===null?_=a:w.next=l,Za(a,e.memoizedState)||(mo=!0),e.memoizedState=a,e.baseState=_,e.baseQueue=w,n.lastRenderedState=a}if(t=n.interleaved,t!==null){u=t;do d=u.lane,kn.lanes|=d,Mu|=d,u=u.next;while(u!==t)}else u===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Y1(t){var e=da(),n=e.queue;if(n===null)throw Error(yt(311));n.lastRenderedReducer=t;var a=n.dispatch,u=n.pending,d=e.memoizedState;if(u!==null){n.pending=null;var _=u=u.next;do d=t(d,_.action),_=_.next;while(_!==u);Za(d,e.memoizedState)||(mo=!0),e.memoizedState=d,e.baseQueue===null&&(e.baseState=d),n.lastRenderedState=d}return[d,a]}function a4(){}function s4(t,e){var n=kn,a=da(),u=e(),d=!Za(a.memoizedState,u);if(d&&(a.memoizedState=u,mo=!0),a=a.queue,DS(u4.bind(null,n,a,t),[t]),a.getSnapshot!==e||d||fi!==null&&fi.memoizedState.tag&1){if(n.flags|=2048,Im(9,c4.bind(null,n,a,u,e),void 0,null),mi===null)throw Error(yt(349));Du&30||l4(n,e,u)}return u}function l4(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=kn.updateQueue,e===null?(e={lastEffect:null,stores:null},kn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function c4(t,e,n,a){e.value=n,e.getSnapshot=a,h4(e)&&d4(t)}function u4(t,e,n){return n(function(){h4(e)&&d4(t)})}function h4(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Za(t,n)}catch{return!0}}function d4(t){var e=cl(t,1);e!==null&&Ga(e,t,1,-1)}function ZC(t){var e=ws();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Am,lastRenderedState:t},e.queue=t,t=t.dispatch=h8.bind(null,kn,t),[e.memoizedState,t]}function Im(t,e,n,a){return t={tag:t,create:e,destroy:n,deps:a,next:null},e=kn.updateQueue,e===null?(e={lastEffect:null,stores:null},kn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(a=n.next,n.next=t,t.next=a,e.lastEffect=t)),t}function p4(){return da().memoizedState}function jy(t,e,n,a){var u=ws();kn.flags|=t,u.memoizedState=Im(1|e,n,void 0,a===void 0?null:a)}function W_(t,e,n,a){var u=da();a=a===void 0?null:a;var d=void 0;if(ii!==null){var _=ii.memoizedState;if(d=_.destroy,a!==null&&CS(a,_.deps)){u.memoizedState=Im(e,n,d,a);return}}kn.flags|=t,u.memoizedState=Im(1|e,n,d,a)}function KC(t,e){return jy(8390656,8,t,e)}function DS(t,e){return W_(2048,8,t,e)}function f4(t,e){return W_(4,2,t,e)}function m4(t,e){return W_(4,4,t,e)}function g4(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function y4(t,e,n){return n=n!=null?n.concat([t]):null,W_(4,4,g4.bind(null,e,t),n)}function MS(){}function _4(t,e){var n=da();e=e===void 0?null:e;var a=n.memoizedState;return a!==null&&e!==null&&CS(e,a[1])?a[0]:(n.memoizedState=[t,e],t)}function v4(t,e){var n=da();e=e===void 0?null:e;var a=n.memoizedState;return a!==null&&e!==null&&CS(e,a[1])?a[0]:(t=t(),n.memoizedState=[t,e],t)}function x4(t,e,n){return Du&21?(Za(n,e)||(n=Tz(),kn.lanes|=n,Mu|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,mo=!0),t.memoizedState=n)}function c8(t,e){var n=Kr;Kr=n!==0&&4>n?n:4,t(!0);var a=K1.transition;K1.transition={};try{t(!1),e()}finally{Kr=n,K1.transition=a}}function b4(){return da().memoizedState}function u8(t,e,n){var a=pc(t);if(n={lane:a,action:n,hasEagerState:!1,eagerState:null,next:null},w4(t))E4(e,n);else if(n=n4(t,e,n,a),n!==null){var u=Ji();Ga(n,t,a,u),S4(n,e,a)}}function h8(t,e,n){var a=pc(t),u={lane:a,action:n,hasEagerState:!1,eagerState:null,next:null};if(w4(t))E4(e,u);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=e.lastRenderedReducer,d!==null))try{var _=e.lastRenderedState,l=d(_,n);if(u.hasEagerState=!0,u.eagerState=l,Za(l,_)){var w=e.interleaved;w===null?(u.next=u,ES(e)):(u.next=w.next,w.next=u),e.interleaved=u;return}}catch{}finally{}n=n4(t,e,u,a),n!==null&&(u=Ji(),Ga(n,t,a,u),S4(n,e,a))}}function w4(t){var e=t.alternate;return t===kn||e!==null&&e===kn}function E4(t,e){am=y_=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function S4(t,e,n){if(n&4194240){var a=e.lanes;a&=t.pendingLanes,n|=a,e.lanes=n,cS(t,n)}}var __={readContext:ha,useCallback:Fi,useContext:Fi,useEffect:Fi,useImperativeHandle:Fi,useInsertionEffect:Fi,useLayoutEffect:Fi,useMemo:Fi,useReducer:Fi,useRef:Fi,useState:Fi,useDebugValue:Fi,useDeferredValue:Fi,useTransition:Fi,useMutableSource:Fi,useSyncExternalStore:Fi,useId:Fi,unstable_isNewReconciler:!1},d8={readContext:ha,useCallback:function(t,e){return ws().memoizedState=[t,e===void 0?null:e],t},useContext:ha,useEffect:KC,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,jy(4194308,4,g4.bind(null,e,t),n)},useLayoutEffect:function(t,e){return jy(4194308,4,t,e)},useInsertionEffect:function(t,e){return jy(4,2,t,e)},useMemo:function(t,e){var n=ws();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var a=ws();return e=n!==void 0?n(e):e,a.memoizedState=a.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},a.queue=t,t=t.dispatch=u8.bind(null,kn,t),[a.memoizedState,t]},useRef:function(t){var e=ws();return t={current:t},e.memoizedState=t},useState:ZC,useDebugValue:MS,useDeferredValue:function(t){return ws().memoizedState=t},useTransition:function(){var t=ZC(!1),e=t[0];return t=c8.bind(null,t[1]),ws().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var a=kn,u=ws();if(gn){if(n===void 0)throw Error(yt(407));n=n()}else{if(n=e(),mi===null)throw Error(yt(349));Du&30||l4(a,e,n)}u.memoizedState=n;var d={value:n,getSnapshot:e};return u.queue=d,KC(u4.bind(null,a,d,t),[t]),a.flags|=2048,Im(9,c4.bind(null,a,d,n,e),void 0,null),n},useId:function(){var t=ws(),e=mi.identifierPrefix;if(gn){var n=ol,a=il;n=(a&~(1<<32-Wa(a)-1)).toString(32)+n,e=":"+e+"R"+n,n=Tm++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=l8++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},p8={readContext:ha,useCallback:_4,useContext:ha,useEffect:DS,useImperativeHandle:y4,useInsertionEffect:f4,useLayoutEffect:m4,useMemo:v4,useReducer:X1,useRef:p4,useState:function(){return X1(Am)},useDebugValue:MS,useDeferredValue:function(t){var e=da();return x4(e,ii.memoizedState,t)},useTransition:function(){var t=X1(Am)[0],e=da().memoizedState;return[t,e]},useMutableSource:a4,useSyncExternalStore:s4,useId:b4,unstable_isNewReconciler:!1},f8={readContext:ha,useCallback:_4,useContext:ha,useEffect:DS,useImperativeHandle:y4,useInsertionEffect:f4,useLayoutEffect:m4,useMemo:v4,useReducer:Y1,useRef:p4,useState:function(){return Y1(Am)},useDebugValue:MS,useDeferredValue:function(t){var e=da();return ii===null?e.memoizedState=t:x4(e,ii.memoizedState,t)},useTransition:function(){var t=Y1(Am)[0],e=da().memoizedState;return[t,e]},useMutableSource:a4,useSyncExternalStore:s4,useId:b4,unstable_isNewReconciler:!1};function Ua(t,e){if(t&&t.defaultProps){e=Pn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function dE(t,e,n,a){e=t.memoizedState,n=n(a,e),n=n==null?e:Pn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var G_={isMounted:function(t){return(t=t._reactInternals)?Fu(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var a=Ji(),u=pc(t),d=al(a,u);d.payload=e,n!=null&&(d.callback=n),e=hc(t,d,u),e!==null&&(Ga(e,t,u,a),Ny(e,t,u))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var a=Ji(),u=pc(t),d=al(a,u);d.tag=1,d.payload=e,n!=null&&(d.callback=n),e=hc(t,d,u),e!==null&&(Ga(e,t,u,a),Ny(e,t,u))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ji(),a=pc(t),u=al(n,a);u.tag=2,e!=null&&(u.callback=e),e=hc(t,u,a),e!==null&&(Ga(e,t,a,n),Ny(e,t,a))}};function XC(t,e,n,a,u,d,_){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(a,d,_):e.prototype&&e.prototype.isPureReactComponent?!vm(n,a)||!vm(u,d):!0}function T4(t,e,n){var a=!1,u=yc,d=e.contextType;return typeof d=="object"&&d!==null?d=ha(d):(u=yo(e)?ku:Wi.current,a=e.contextTypes,d=(a=a!=null)?Td(t,u):yc),e=new e(n,d),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=G_,t.stateNode=e,e._reactInternals=t,a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=u,t.__reactInternalMemoizedMaskedChildContext=d),e}function YC(t,e,n,a){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,a),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,a),e.state!==t&&G_.enqueueReplaceState(e,e.state,null)}function pE(t,e,n,a){var u=t.stateNode;u.props=n,u.state=t.memoizedState,u.refs={},SS(t);var d=e.contextType;typeof d=="object"&&d!==null?u.context=ha(d):(d=yo(e)?ku:Wi.current,u.context=Td(t,d)),u.state=t.memoizedState,d=e.getDerivedStateFromProps,typeof d=="function"&&(dE(t,e,d,n),u.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(e=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),e!==u.state&&G_.enqueueReplaceState(u,u.state,null),m_(t,n,u,a),u.state=t.memoizedState),typeof u.componentDidMount=="function"&&(t.flags|=4194308)}function kd(t,e){try{var n="",a=e;do n+=VL(a),a=a.return;while(a);var u=n}catch(d){u=`
Error generating stack: `+d.message+`
`+d.stack}return{value:t,source:e,stack:u,digest:null}}function Q1(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function fE(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var m8=typeof WeakMap=="function"?WeakMap:Map;function A4(t,e,n){n=al(-1,n),n.tag=3,n.payload={element:null};var a=e.value;return n.callback=function(){x_||(x_=!0,SE=a),fE(t,e)},n}function I4(t,e,n){n=al(-1,n),n.tag=3;var a=t.type.getDerivedStateFromError;if(typeof a=="function"){var u=e.value;n.payload=function(){return a(u)},n.callback=function(){fE(t,e)}}var d=t.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(n.callback=function(){fE(t,e),typeof a!="function"&&(dc===null?dc=new Set([this]):dc.add(this));var _=e.stack;this.componentDidCatch(e.value,{componentStack:_!==null?_:""})}),n}function QC(t,e,n){var a=t.pingCache;if(a===null){a=t.pingCache=new m8;var u=new Set;a.set(e,u)}else u=a.get(e),u===void 0&&(u=new Set,a.set(e,u));u.has(n)||(u.add(n),t=k8.bind(null,t,e,n),e.then(t,t))}function JC(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function ek(t,e,n,a,u){return t.mode&1?(t.flags|=65536,t.lanes=u,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=al(-1,1),e.tag=2,hc(n,e,1))),n.lanes|=1),t)}var g8=hl.ReactCurrentOwner,mo=!1;function Qi(t,e,n,a){e.child=t===null?r4(e,null,n,a):Id(e,t.child,n,a)}function tk(t,e,n,a,u){n=n.render;var d=e.ref;return xd(e,u),a=kS(t,e,n,a,d,u),n=PS(),t!==null&&!mo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~u,ul(t,e,u)):(gn&&n&&yS(e),e.flags|=1,Qi(t,e,a,u),e.child)}function rk(t,e,n,a,u){if(t===null){var d=n.type;return typeof d=="function"&&!US(d)&&d.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=d,C4(t,e,d,a,u)):(t=Gy(n.type,null,a,e,e.mode,u),t.ref=e.ref,t.return=e,e.child=t)}if(d=t.child,!(t.lanes&u)){var _=d.memoizedProps;if(n=n.compare,n=n!==null?n:vm,n(_,a)&&t.ref===e.ref)return ul(t,e,u)}return e.flags|=1,t=fc(d,a),t.ref=e.ref,t.return=e,e.child=t}function C4(t,e,n,a,u){if(t!==null){var d=t.memoizedProps;if(vm(d,a)&&t.ref===e.ref)if(mo=!1,e.pendingProps=a=d,(t.lanes&u)!==0)t.flags&131072&&(mo=!0);else return e.lanes=t.lanes,ul(t,e,u)}return mE(t,e,n,a,u)}function k4(t,e,n){var a=e.pendingProps,u=a.children,d=t!==null?t.memoizedState:null;if(a.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},on(dd,Fo),Fo|=n;else{if(!(n&1073741824))return t=d!==null?d.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,on(dd,Fo),Fo|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=d!==null?d.baseLanes:n,on(dd,Fo),Fo|=a}else d!==null?(a=d.baseLanes|n,e.memoizedState=null):a=n,on(dd,Fo),Fo|=a;return Qi(t,e,u,n),e.child}function P4(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function mE(t,e,n,a,u){var d=yo(n)?ku:Wi.current;return d=Td(e,d),xd(e,u),n=kS(t,e,n,a,d,u),a=PS(),t!==null&&!mo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~u,ul(t,e,u)):(gn&&a&&yS(e),e.flags|=1,Qi(t,e,n,u),e.child)}function nk(t,e,n,a,u){if(yo(n)){var d=!0;u_(e)}else d=!1;if(xd(e,u),e.stateNode===null)Vy(t,e),T4(e,n,a),pE(e,n,a,u),a=!0;else if(t===null){var _=e.stateNode,l=e.memoizedProps;_.props=l;var w=_.context,T=n.contextType;typeof T=="object"&&T!==null?T=ha(T):(T=yo(n)?ku:Wi.current,T=Td(e,T));var C=n.getDerivedStateFromProps,P=typeof C=="function"||typeof _.getSnapshotBeforeUpdate=="function";P||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(l!==a||w!==T)&&YC(e,_,a,T),tc=!1;var z=e.memoizedState;_.state=z,m_(e,a,_,u),w=e.memoizedState,l!==a||z!==w||go.current||tc?(typeof C=="function"&&(dE(e,n,C,a),w=e.memoizedState),(l=tc||XC(e,n,l,a,z,w,T))?(P||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(e.flags|=4194308)):(typeof _.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=a,e.memoizedState=w),_.props=a,_.state=w,_.context=T,a=l):(typeof _.componentDidMount=="function"&&(e.flags|=4194308),a=!1)}else{_=e.stateNode,i4(t,e),l=e.memoizedProps,T=e.type===e.elementType?l:Ua(e.type,l),_.props=T,P=e.pendingProps,z=_.context,w=n.contextType,typeof w=="object"&&w!==null?w=ha(w):(w=yo(n)?ku:Wi.current,w=Td(e,w));var $=n.getDerivedStateFromProps;(C=typeof $=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(l!==P||z!==w)&&YC(e,_,a,w),tc=!1,z=e.memoizedState,_.state=z,m_(e,a,_,u);var U=e.memoizedState;l!==P||z!==U||go.current||tc?(typeof $=="function"&&(dE(e,n,$,a),U=e.memoizedState),(T=tc||XC(e,n,T,a,z,U,w)||!1)?(C||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(a,U,w),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(a,U,w)),typeof _.componentDidUpdate=="function"&&(e.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof _.componentDidUpdate!="function"||l===t.memoizedProps&&z===t.memoizedState||(e.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&z===t.memoizedState||(e.flags|=1024),e.memoizedProps=a,e.memoizedState=U),_.props=a,_.state=U,_.context=w,a=T):(typeof _.componentDidUpdate!="function"||l===t.memoizedProps&&z===t.memoizedState||(e.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&z===t.memoizedState||(e.flags|=1024),a=!1)}return gE(t,e,n,a,d,u)}function gE(t,e,n,a,u,d){P4(t,e);var _=(e.flags&128)!==0;if(!a&&!_)return u&&VC(e,n,!1),ul(t,e,d);a=e.stateNode,g8.current=e;var l=_&&typeof n.getDerivedStateFromError!="function"?null:a.render();return e.flags|=1,t!==null&&_?(e.child=Id(e,t.child,null,d),e.child=Id(e,null,l,d)):Qi(t,e,l,d),e.memoizedState=a.state,u&&VC(e,n,!0),e.child}function D4(t){var e=t.stateNode;e.pendingContext?jC(t,e.pendingContext,e.pendingContext!==e.context):e.context&&jC(t,e.context,!1),TS(t,e.containerInfo)}function ik(t,e,n,a,u){return Ad(),vS(u),e.flags|=256,Qi(t,e,n,a),e.child}var yE={dehydrated:null,treeContext:null,retryLane:0};function _E(t){return{baseLanes:t,cachePool:null,transitions:null}}function M4(t,e,n){var a=e.pendingProps,u=Cn.current,d=!1,_=(e.flags&128)!==0,l;if((l=_)||(l=t!==null&&t.memoizedState===null?!1:(u&2)!==0),l?(d=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(u|=1),on(Cn,u&1),t===null)return uE(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(_=a.children,t=a.fallback,d?(a=e.mode,d=e.child,_={mode:"hidden",children:_},!(a&1)&&d!==null?(d.childLanes=0,d.pendingProps=_):d=Z_(_,a,0,null),t=Cu(t,a,n,null),d.return=e,t.return=e,d.sibling=t,e.child=d,e.child.memoizedState=_E(n),e.memoizedState=yE,t):zS(e,_));if(u=t.memoizedState,u!==null&&(l=u.dehydrated,l!==null))return y8(t,e,_,a,l,u,n);if(d){d=a.fallback,_=e.mode,u=t.child,l=u.sibling;var w={mode:"hidden",children:a.children};return!(_&1)&&e.child!==u?(a=e.child,a.childLanes=0,a.pendingProps=w,e.deletions=null):(a=fc(u,w),a.subtreeFlags=u.subtreeFlags&14680064),l!==null?d=fc(l,d):(d=Cu(d,_,n,null),d.flags|=2),d.return=e,a.return=e,a.sibling=d,e.child=a,a=d,d=e.child,_=t.child.memoizedState,_=_===null?_E(n):{baseLanes:_.baseLanes|n,cachePool:null,transitions:_.transitions},d.memoizedState=_,d.childLanes=t.childLanes&~n,e.memoizedState=yE,a}return d=t.child,t=d.sibling,a=fc(d,{mode:"visible",children:a.children}),!(e.mode&1)&&(a.lanes=n),a.return=e,a.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=a,e.memoizedState=null,a}function zS(t,e){return e=Z_({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ng(t,e,n,a){return a!==null&&vS(a),Id(e,t.child,null,n),t=zS(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function y8(t,e,n,a,u,d,_){if(n)return e.flags&256?(e.flags&=-257,a=Q1(Error(yt(422))),Ng(t,e,_,a)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(d=a.fallback,u=e.mode,a=Z_({mode:"visible",children:a.children},u,0,null),d=Cu(d,u,_,null),d.flags|=2,a.return=e,d.return=e,a.sibling=d,e.child=a,e.mode&1&&Id(e,t.child,null,_),e.child.memoizedState=_E(_),e.memoizedState=yE,d);if(!(e.mode&1))return Ng(t,e,_,null);if(u.data==="$!"){if(a=u.nextSibling&&u.nextSibling.dataset,a)var l=a.dgst;return a=l,d=Error(yt(419)),a=Q1(d,a,void 0),Ng(t,e,_,a)}if(l=(_&t.childLanes)!==0,mo||l){if(a=mi,a!==null){switch(_&-_){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(a.suspendedLanes|_)?0:u,u!==0&&u!==d.retryLane&&(d.retryLane=u,cl(t,u),Ga(a,t,u,-1))}return NS(),a=Q1(Error(yt(421))),Ng(t,e,_,a)}return u.data==="$?"?(e.flags|=128,e.child=t.child,e=P8.bind(null,t),u._reactRetry=e,null):(t=d.treeContext,Lo=uc(u.nextSibling),Bo=e,gn=!0,Va=null,t!==null&&(sa[la++]=il,sa[la++]=ol,sa[la++]=Pu,il=t.id,ol=t.overflow,Pu=e),e=zS(e,a.children),e.flags|=4096,e)}function ok(t,e,n){t.lanes|=e;var a=t.alternate;a!==null&&(a.lanes|=e),hE(t.return,e,n)}function J1(t,e,n,a,u){var d=t.memoizedState;d===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:a,tail:n,tailMode:u}:(d.isBackwards=e,d.rendering=null,d.renderingStartTime=0,d.last=a,d.tail=n,d.tailMode=u)}function z4(t,e,n){var a=e.pendingProps,u=a.revealOrder,d=a.tail;if(Qi(t,e,a.children,n),a=Cn.current,a&2)a=a&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&ok(t,n,e);else if(t.tag===19)ok(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}a&=1}if(on(Cn,a),!(e.mode&1))e.memoizedState=null;else switch(u){case"forwards":for(n=e.child,u=null;n!==null;)t=n.alternate,t!==null&&g_(t)===null&&(u=n),n=n.sibling;n=u,n===null?(u=e.child,e.child=null):(u=n.sibling,n.sibling=null),J1(e,!1,u,n,d);break;case"backwards":for(n=null,u=e.child,e.child=null;u!==null;){if(t=u.alternate,t!==null&&g_(t)===null){e.child=u;break}t=u.sibling,u.sibling=n,n=u,u=t}J1(e,!0,n,null,d);break;case"together":J1(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Vy(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ul(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Mu|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(yt(153));if(e.child!==null){for(t=e.child,n=fc(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=fc(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function _8(t,e,n){switch(e.tag){case 3:D4(e),Ad();break;case 5:o4(e);break;case 1:yo(e.type)&&u_(e);break;case 4:TS(e,e.stateNode.containerInfo);break;case 10:var a=e.type._context,u=e.memoizedProps.value;on(p_,a._currentValue),a._currentValue=u;break;case 13:if(a=e.memoizedState,a!==null)return a.dehydrated!==null?(on(Cn,Cn.current&1),e.flags|=128,null):n&e.child.childLanes?M4(t,e,n):(on(Cn,Cn.current&1),t=ul(t,e,n),t!==null?t.sibling:null);on(Cn,Cn.current&1);break;case 19:if(a=(n&e.childLanes)!==0,t.flags&128){if(a)return z4(t,e,n);e.flags|=128}if(u=e.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),on(Cn,Cn.current),a)break;return null;case 22:case 23:return e.lanes=0,k4(t,e,n)}return ul(t,e,n)}var R4,vE,O4,F4;R4=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};vE=function(){};O4=function(t,e,n,a){var u=t.memoizedProps;if(u!==a){t=e.stateNode,Tu(As.current);var d=null;switch(n){case"input":u=jw(t,u),a=jw(t,a),d=[];break;case"select":u=Pn({},u,{value:void 0}),a=Pn({},a,{value:void 0}),d=[];break;case"textarea":u=Ww(t,u),a=Ww(t,a),d=[];break;default:typeof u.onClick!="function"&&typeof a.onClick=="function"&&(t.onclick=l_)}Hw(n,a);var _;n=null;for(T in u)if(!a.hasOwnProperty(T)&&u.hasOwnProperty(T)&&u[T]!=null)if(T==="style"){var l=u[T];for(_ in l)l.hasOwnProperty(_)&&(n||(n={}),n[_]="")}else T!=="dangerouslySetInnerHTML"&&T!=="children"&&T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(dm.hasOwnProperty(T)?d||(d=[]):(d=d||[]).push(T,null));for(T in a){var w=a[T];if(l=u!=null?u[T]:void 0,a.hasOwnProperty(T)&&w!==l&&(w!=null||l!=null))if(T==="style")if(l){for(_ in l)!l.hasOwnProperty(_)||w&&w.hasOwnProperty(_)||(n||(n={}),n[_]="");for(_ in w)w.hasOwnProperty(_)&&l[_]!==w[_]&&(n||(n={}),n[_]=w[_])}else n||(d||(d=[]),d.push(T,n)),n=w;else T==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,l=l?l.__html:void 0,w!=null&&l!==w&&(d=d||[]).push(T,w)):T==="children"?typeof w!="string"&&typeof w!="number"||(d=d||[]).push(T,""+w):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&(dm.hasOwnProperty(T)?(w!=null&&T==="onScroll"&&hn("scroll",t),d||l===w||(d=[])):(d=d||[]).push(T,w))}n&&(d=d||[]).push("style",n);var T=d;(e.updateQueue=T)&&(e.flags|=4)}};F4=function(t,e,n,a){n!==a&&(e.flags|=4)};function Mf(t,e){if(!gn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:a.sibling=null}}function Li(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,a=0;if(e)for(var u=t.child;u!==null;)n|=u.lanes|u.childLanes,a|=u.subtreeFlags&14680064,a|=u.flags&14680064,u.return=t,u=u.sibling;else for(u=t.child;u!==null;)n|=u.lanes|u.childLanes,a|=u.subtreeFlags,a|=u.flags,u.return=t,u=u.sibling;return t.subtreeFlags|=a,t.childLanes=n,e}function v8(t,e,n){var a=e.pendingProps;switch(_S(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Li(e),null;case 1:return yo(e.type)&&c_(),Li(e),null;case 3:return a=e.stateNode,Cd(),dn(go),dn(Wi),IS(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(t===null||t.child===null)&&(Lg(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Va!==null&&(IE(Va),Va=null))),vE(t,e),Li(e),null;case 5:AS(e);var u=Tu(Sm.current);if(n=e.type,t!==null&&e.stateNode!=null)O4(t,e,n,a,u),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!a){if(e.stateNode===null)throw Error(yt(166));return Li(e),null}if(t=Tu(As.current),Lg(e)){a=e.stateNode,n=e.type;var d=e.memoizedProps;switch(a[Es]=e,a[wm]=d,t=(e.mode&1)!==0,n){case"dialog":hn("cancel",a),hn("close",a);break;case"iframe":case"object":case"embed":hn("load",a);break;case"video":case"audio":for(u=0;u<em.length;u++)hn(em[u],a);break;case"source":hn("error",a);break;case"img":case"image":case"link":hn("error",a),hn("load",a);break;case"details":hn("toggle",a);break;case"input":fC(a,d),hn("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!d.multiple},hn("invalid",a);break;case"textarea":gC(a,d),hn("invalid",a)}Hw(n,d),u=null;for(var _ in d)if(d.hasOwnProperty(_)){var l=d[_];_==="children"?typeof l=="string"?a.textContent!==l&&(d.suppressHydrationWarning!==!0&&Fg(a.textContent,l,t),u=["children",l]):typeof l=="number"&&a.textContent!==""+l&&(d.suppressHydrationWarning!==!0&&Fg(a.textContent,l,t),u=["children",""+l]):dm.hasOwnProperty(_)&&l!=null&&_==="onScroll"&&hn("scroll",a)}switch(n){case"input":Cg(a),mC(a,d,!0);break;case"textarea":Cg(a),yC(a);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(a.onclick=l_)}a=u,e.updateQueue=a,a!==null&&(e.flags|=4)}else{_=u.nodeType===9?u:u.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=uz(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=_.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof a.is=="string"?t=_.createElement(n,{is:a.is}):(t=_.createElement(n),n==="select"&&(_=t,a.multiple?_.multiple=!0:a.size&&(_.size=a.size))):t=_.createElementNS(t,n),t[Es]=e,t[wm]=a,R4(t,e,!1,!1),e.stateNode=t;e:{switch(_=qw(n,a),n){case"dialog":hn("cancel",t),hn("close",t),u=a;break;case"iframe":case"object":case"embed":hn("load",t),u=a;break;case"video":case"audio":for(u=0;u<em.length;u++)hn(em[u],t);u=a;break;case"source":hn("error",t),u=a;break;case"img":case"image":case"link":hn("error",t),hn("load",t),u=a;break;case"details":hn("toggle",t),u=a;break;case"input":fC(t,a),u=jw(t,a),hn("invalid",t);break;case"option":u=a;break;case"select":t._wrapperState={wasMultiple:!!a.multiple},u=Pn({},a,{value:void 0}),hn("invalid",t);break;case"textarea":gC(t,a),u=Ww(t,a),hn("invalid",t);break;default:u=a}Hw(n,u),l=u;for(d in l)if(l.hasOwnProperty(d)){var w=l[d];d==="style"?pz(t,w):d==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,w!=null&&hz(t,w)):d==="children"?typeof w=="string"?(n!=="textarea"||w!=="")&&pm(t,w):typeof w=="number"&&pm(t,""+w):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(dm.hasOwnProperty(d)?w!=null&&d==="onScroll"&&hn("scroll",t):w!=null&&nS(t,d,w,_))}switch(n){case"input":Cg(t),mC(t,a,!1);break;case"textarea":Cg(t),yC(t);break;case"option":a.value!=null&&t.setAttribute("value",""+gc(a.value));break;case"select":t.multiple=!!a.multiple,d=a.value,d!=null?gd(t,!!a.multiple,d,!1):a.defaultValue!=null&&gd(t,!!a.multiple,a.defaultValue,!0);break;default:typeof u.onClick=="function"&&(t.onclick=l_)}switch(n){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Li(e),null;case 6:if(t&&e.stateNode!=null)F4(t,e,t.memoizedProps,a);else{if(typeof a!="string"&&e.stateNode===null)throw Error(yt(166));if(n=Tu(Sm.current),Tu(As.current),Lg(e)){if(a=e.stateNode,n=e.memoizedProps,a[Es]=e,(d=a.nodeValue!==n)&&(t=Bo,t!==null))switch(t.tag){case 3:Fg(a.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Fg(a.nodeValue,n,(t.mode&1)!==0)}d&&(e.flags|=4)}else a=(n.nodeType===9?n:n.ownerDocument).createTextNode(a),a[Es]=e,e.stateNode=a}return Li(e),null;case 13:if(dn(Cn),a=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(gn&&Lo!==null&&e.mode&1&&!(e.flags&128))e4(),Ad(),e.flags|=98560,d=!1;else if(d=Lg(e),a!==null&&a.dehydrated!==null){if(t===null){if(!d)throw Error(yt(318));if(d=e.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(yt(317));d[Es]=e}else Ad(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Li(e),d=!1}else Va!==null&&(IE(Va),Va=null),d=!0;if(!d)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(a=a!==null,a!==(t!==null&&t.memoizedState!==null)&&a&&(e.child.flags|=8192,e.mode&1&&(t===null||Cn.current&1?oi===0&&(oi=3):NS())),e.updateQueue!==null&&(e.flags|=4),Li(e),null);case 4:return Cd(),vE(t,e),t===null&&xm(e.stateNode.containerInfo),Li(e),null;case 10:return wS(e.type._context),Li(e),null;case 17:return yo(e.type)&&c_(),Li(e),null;case 19:if(dn(Cn),d=e.memoizedState,d===null)return Li(e),null;if(a=(e.flags&128)!==0,_=d.rendering,_===null)if(a)Mf(d,!1);else{if(oi!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(_=g_(t),_!==null){for(e.flags|=128,Mf(d,!1),a=_.updateQueue,a!==null&&(e.updateQueue=a,e.flags|=4),e.subtreeFlags=0,a=n,n=e.child;n!==null;)d=n,t=a,d.flags&=14680066,_=d.alternate,_===null?(d.childLanes=0,d.lanes=t,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=_.childLanes,d.lanes=_.lanes,d.child=_.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=_.memoizedProps,d.memoizedState=_.memoizedState,d.updateQueue=_.updateQueue,d.type=_.type,t=_.dependencies,d.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return on(Cn,Cn.current&1|2),e.child}t=t.sibling}d.tail!==null&&Ln()>Pd&&(e.flags|=128,a=!0,Mf(d,!1),e.lanes=4194304)}else{if(!a)if(t=g_(_),t!==null){if(e.flags|=128,a=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Mf(d,!0),d.tail===null&&d.tailMode==="hidden"&&!_.alternate&&!gn)return Li(e),null}else 2*Ln()-d.renderingStartTime>Pd&&n!==1073741824&&(e.flags|=128,a=!0,Mf(d,!1),e.lanes=4194304);d.isBackwards?(_.sibling=e.child,e.child=_):(n=d.last,n!==null?n.sibling=_:e.child=_,d.last=_)}return d.tail!==null?(e=d.tail,d.rendering=e,d.tail=e.sibling,d.renderingStartTime=Ln(),e.sibling=null,n=Cn.current,on(Cn,a?n&1|2:n&1),e):(Li(e),null);case 22:case 23:return BS(),a=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==a&&(e.flags|=8192),a&&e.mode&1?Fo&1073741824&&(Li(e),e.subtreeFlags&6&&(e.flags|=8192)):Li(e),null;case 24:return null;case 25:return null}throw Error(yt(156,e.tag))}function x8(t,e){switch(_S(e),e.tag){case 1:return yo(e.type)&&c_(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Cd(),dn(go),dn(Wi),IS(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return AS(e),null;case 13:if(dn(Cn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(yt(340));Ad()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return dn(Cn),null;case 4:return Cd(),null;case 10:return wS(e.type._context),null;case 22:case 23:return BS(),null;case 24:return null;default:return null}}var Ug=!1,$i=!1,b8=typeof WeakSet=="function"?WeakSet:Set,Rt=null;function hd(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(a){On(t,e,a)}else n.current=null}function xE(t,e,n){try{n()}catch(a){On(t,e,a)}}var ak=!1;function w8(t,e){if(nE=o_,t=jz(),gS(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var a=n.getSelection&&n.getSelection();if(a&&a.rangeCount!==0){n=a.anchorNode;var u=a.anchorOffset,d=a.focusNode;a=a.focusOffset;try{n.nodeType,d.nodeType}catch{n=null;break e}var _=0,l=-1,w=-1,T=0,C=0,P=t,z=null;t:for(;;){for(var $;P!==n||u!==0&&P.nodeType!==3||(l=_+u),P!==d||a!==0&&P.nodeType!==3||(w=_+a),P.nodeType===3&&(_+=P.nodeValue.length),($=P.firstChild)!==null;)z=P,P=$;for(;;){if(P===t)break t;if(z===n&&++T===u&&(l=_),z===d&&++C===a&&(w=_),($=P.nextSibling)!==null)break;P=z,z=P.parentNode}P=$}n=l===-1||w===-1?null:{start:l,end:w}}else n=null}n=n||{start:0,end:0}}else n=null;for(iE={focusedElem:t,selectionRange:n},o_=!1,Rt=e;Rt!==null;)if(e=Rt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Rt=t;else for(;Rt!==null;){e=Rt;try{var U=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(U!==null){var W=U.memoizedProps,N=U.memoizedState,V=e.stateNode,R=V.getSnapshotBeforeUpdate(e.elementType===e.type?W:Ua(e.type,W),N);V.__reactInternalSnapshotBeforeUpdate=R}break;case 3:var F=e.stateNode.containerInfo;F.nodeType===1?F.textContent="":F.nodeType===9&&F.documentElement&&F.removeChild(F.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(yt(163))}}catch(H){On(e,e.return,H)}if(t=e.sibling,t!==null){t.return=e.return,Rt=t;break}Rt=e.return}return U=ak,ak=!1,U}function sm(t,e,n){var a=e.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var u=a=a.next;do{if((u.tag&t)===t){var d=u.destroy;u.destroy=void 0,d!==void 0&&xE(e,n,d)}u=u.next}while(u!==a)}}function H_(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var a=n.create;n.destroy=a()}n=n.next}while(n!==e)}}function bE(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function L4(t){var e=t.alternate;e!==null&&(t.alternate=null,L4(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Es],delete e[wm],delete e[sE],delete e[i8],delete e[o8])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function B4(t){return t.tag===5||t.tag===3||t.tag===4}function sk(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||B4(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function wE(t,e,n){var a=t.tag;if(a===5||a===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=l_));else if(a!==4&&(t=t.child,t!==null))for(wE(t,e,n),t=t.sibling;t!==null;)wE(t,e,n),t=t.sibling}function EE(t,e,n){var a=t.tag;if(a===5||a===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(a!==4&&(t=t.child,t!==null))for(EE(t,e,n),t=t.sibling;t!==null;)EE(t,e,n),t=t.sibling}var Si=null,ja=!1;function Gl(t,e,n){for(n=n.child;n!==null;)N4(t,e,n),n=n.sibling}function N4(t,e,n){if(Ts&&typeof Ts.onCommitFiberUnmount=="function")try{Ts.onCommitFiberUnmount(B_,n)}catch{}switch(n.tag){case 5:$i||hd(n,e);case 6:var a=Si,u=ja;Si=null,Gl(t,e,n),Si=a,ja=u,Si!==null&&(ja?(t=Si,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Si.removeChild(n.stateNode));break;case 18:Si!==null&&(ja?(t=Si,n=n.stateNode,t.nodeType===8?H1(t.parentNode,n):t.nodeType===1&&H1(t,n),ym(t)):H1(Si,n.stateNode));break;case 4:a=Si,u=ja,Si=n.stateNode.containerInfo,ja=!0,Gl(t,e,n),Si=a,ja=u;break;case 0:case 11:case 14:case 15:if(!$i&&(a=n.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){u=a=a.next;do{var d=u,_=d.destroy;d=d.tag,_!==void 0&&(d&2||d&4)&&xE(n,e,_),u=u.next}while(u!==a)}Gl(t,e,n);break;case 1:if(!$i&&(hd(n,e),a=n.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=n.memoizedProps,a.state=n.memoizedState,a.componentWillUnmount()}catch(l){On(n,e,l)}Gl(t,e,n);break;case 21:Gl(t,e,n);break;case 22:n.mode&1?($i=(a=$i)||n.memoizedState!==null,Gl(t,e,n),$i=a):Gl(t,e,n);break;default:Gl(t,e,n)}}function lk(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new b8),e.forEach(function(a){var u=D8.bind(null,t,a);n.has(a)||(n.add(a),a.then(u,u))})}}function Ba(t,e){var n=e.deletions;if(n!==null)for(var a=0;a<n.length;a++){var u=n[a];try{var d=t,_=e,l=_;e:for(;l!==null;){switch(l.tag){case 5:Si=l.stateNode,ja=!1;break e;case 3:Si=l.stateNode.containerInfo,ja=!0;break e;case 4:Si=l.stateNode.containerInfo,ja=!0;break e}l=l.return}if(Si===null)throw Error(yt(160));N4(d,_,u),Si=null,ja=!1;var w=u.alternate;w!==null&&(w.return=null),u.return=null}catch(T){On(u,e,T)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)U4(e,t),e=e.sibling}function U4(t,e){var n=t.alternate,a=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ba(e,t),hs(t),a&4){try{sm(3,t,t.return),H_(3,t)}catch(W){On(t,t.return,W)}try{sm(5,t,t.return)}catch(W){On(t,t.return,W)}}break;case 1:Ba(e,t),hs(t),a&512&&n!==null&&hd(n,n.return);break;case 5:if(Ba(e,t),hs(t),a&512&&n!==null&&hd(n,n.return),t.flags&32){var u=t.stateNode;try{pm(u,"")}catch(W){On(t,t.return,W)}}if(a&4&&(u=t.stateNode,u!=null)){var d=t.memoizedProps,_=n!==null?n.memoizedProps:d,l=t.type,w=t.updateQueue;if(t.updateQueue=null,w!==null)try{l==="input"&&d.type==="radio"&&d.name!=null&&lz(u,d),qw(l,_);var T=qw(l,d);for(_=0;_<w.length;_+=2){var C=w[_],P=w[_+1];C==="style"?pz(u,P):C==="dangerouslySetInnerHTML"?hz(u,P):C==="children"?pm(u,P):nS(u,C,P,T)}switch(l){case"input":Vw(u,d);break;case"textarea":cz(u,d);break;case"select":var z=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!d.multiple;var $=d.value;$!=null?gd(u,!!d.multiple,$,!1):z!==!!d.multiple&&(d.defaultValue!=null?gd(u,!!d.multiple,d.defaultValue,!0):gd(u,!!d.multiple,d.multiple?[]:"",!1))}u[wm]=d}catch(W){On(t,t.return,W)}}break;case 6:if(Ba(e,t),hs(t),a&4){if(t.stateNode===null)throw Error(yt(162));u=t.stateNode,d=t.memoizedProps;try{u.nodeValue=d}catch(W){On(t,t.return,W)}}break;case 3:if(Ba(e,t),hs(t),a&4&&n!==null&&n.memoizedState.isDehydrated)try{ym(e.containerInfo)}catch(W){On(t,t.return,W)}break;case 4:Ba(e,t),hs(t);break;case 13:Ba(e,t),hs(t),u=t.child,u.flags&8192&&(d=u.memoizedState!==null,u.stateNode.isHidden=d,!d||u.alternate!==null&&u.alternate.memoizedState!==null||(FS=Ln())),a&4&&lk(t);break;case 22:if(C=n!==null&&n.memoizedState!==null,t.mode&1?($i=(T=$i)||C,Ba(e,t),$i=T):Ba(e,t),hs(t),a&8192){if(T=t.memoizedState!==null,(t.stateNode.isHidden=T)&&!C&&t.mode&1)for(Rt=t,C=t.child;C!==null;){for(P=Rt=C;Rt!==null;){switch(z=Rt,$=z.child,z.tag){case 0:case 11:case 14:case 15:sm(4,z,z.return);break;case 1:hd(z,z.return);var U=z.stateNode;if(typeof U.componentWillUnmount=="function"){a=z,n=z.return;try{e=a,U.props=e.memoizedProps,U.state=e.memoizedState,U.componentWillUnmount()}catch(W){On(a,n,W)}}break;case 5:hd(z,z.return);break;case 22:if(z.memoizedState!==null){uk(P);continue}}$!==null?($.return=z,Rt=$):uk(P)}C=C.sibling}e:for(C=null,P=t;;){if(P.tag===5){if(C===null){C=P;try{u=P.stateNode,T?(d=u.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(l=P.stateNode,w=P.memoizedProps.style,_=w!=null&&w.hasOwnProperty("display")?w.display:null,l.style.display=dz("display",_))}catch(W){On(t,t.return,W)}}}else if(P.tag===6){if(C===null)try{P.stateNode.nodeValue=T?"":P.memoizedProps}catch(W){On(t,t.return,W)}}else if((P.tag!==22&&P.tag!==23||P.memoizedState===null||P===t)&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===t)break e;for(;P.sibling===null;){if(P.return===null||P.return===t)break e;C===P&&(C=null),P=P.return}C===P&&(C=null),P.sibling.return=P.return,P=P.sibling}}break;case 19:Ba(e,t),hs(t),a&4&&lk(t);break;case 21:break;default:Ba(e,t),hs(t)}}function hs(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(B4(n)){var a=n;break e}n=n.return}throw Error(yt(160))}switch(a.tag){case 5:var u=a.stateNode;a.flags&32&&(pm(u,""),a.flags&=-33);var d=sk(t);EE(t,d,u);break;case 3:case 4:var _=a.stateNode.containerInfo,l=sk(t);wE(t,l,_);break;default:throw Error(yt(161))}}catch(w){On(t,t.return,w)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function E8(t,e,n){Rt=t,j4(t)}function j4(t,e,n){for(var a=(t.mode&1)!==0;Rt!==null;){var u=Rt,d=u.child;if(u.tag===22&&a){var _=u.memoizedState!==null||Ug;if(!_){var l=u.alternate,w=l!==null&&l.memoizedState!==null||$i;l=Ug;var T=$i;if(Ug=_,($i=w)&&!T)for(Rt=u;Rt!==null;)_=Rt,w=_.child,_.tag===22&&_.memoizedState!==null?hk(u):w!==null?(w.return=_,Rt=w):hk(u);for(;d!==null;)Rt=d,j4(d),d=d.sibling;Rt=u,Ug=l,$i=T}ck(t)}else u.subtreeFlags&8772&&d!==null?(d.return=u,Rt=d):ck(t)}}function ck(t){for(;Rt!==null;){var e=Rt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:$i||H_(5,e);break;case 1:var a=e.stateNode;if(e.flags&4&&!$i)if(n===null)a.componentDidMount();else{var u=e.elementType===e.type?n.memoizedProps:Ua(e.type,n.memoizedProps);a.componentDidUpdate(u,n.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var d=e.updateQueue;d!==null&&qC(e,d,a);break;case 3:var _=e.updateQueue;if(_!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}qC(e,_,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var w=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":w.autoFocus&&n.focus();break;case"img":w.src&&(n.src=w.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var T=e.alternate;if(T!==null){var C=T.memoizedState;if(C!==null){var P=C.dehydrated;P!==null&&ym(P)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(yt(163))}$i||e.flags&512&&bE(e)}catch(z){On(e,e.return,z)}}if(e===t){Rt=null;break}if(n=e.sibling,n!==null){n.return=e.return,Rt=n;break}Rt=e.return}}function uk(t){for(;Rt!==null;){var e=Rt;if(e===t){Rt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Rt=n;break}Rt=e.return}}function hk(t){for(;Rt!==null;){var e=Rt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{H_(4,e)}catch(w){On(e,n,w)}break;case 1:var a=e.stateNode;if(typeof a.componentDidMount=="function"){var u=e.return;try{a.componentDidMount()}catch(w){On(e,u,w)}}var d=e.return;try{bE(e)}catch(w){On(e,d,w)}break;case 5:var _=e.return;try{bE(e)}catch(w){On(e,_,w)}}}catch(w){On(e,e.return,w)}if(e===t){Rt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,Rt=l;break}Rt=e.return}}var S8=Math.ceil,v_=hl.ReactCurrentDispatcher,RS=hl.ReactCurrentOwner,ua=hl.ReactCurrentBatchConfig,Dr=0,mi=null,Kn=null,Ti=0,Fo=0,dd=bc(0),oi=0,Cm=null,Mu=0,q_=0,OS=0,lm=null,fo=null,FS=0,Pd=1/0,el=null,x_=!1,SE=null,dc=null,jg=!1,oc=null,b_=0,cm=0,TE=null,$y=-1,Wy=0;function Ji(){return Dr&6?Ln():$y!==-1?$y:$y=Ln()}function pc(t){return t.mode&1?Dr&2&&Ti!==0?Ti&-Ti:s8.transition!==null?(Wy===0&&(Wy=Tz()),Wy):(t=Kr,t!==0||(t=window.event,t=t===void 0?16:Mz(t.type)),t):1}function Ga(t,e,n,a){if(50<cm)throw cm=0,TE=null,Error(yt(185));Fm(t,n,a),(!(Dr&2)||t!==mi)&&(t===mi&&(!(Dr&2)&&(q_|=n),oi===4&&nc(t,Ti)),_o(t,a),n===1&&Dr===0&&!(e.mode&1)&&(Pd=Ln()+500,$_&&wc()))}function _o(t,e){var n=t.callbackNode;sB(t,e);var a=i_(t,t===mi?Ti:0);if(a===0)n!==null&&xC(n),t.callbackNode=null,t.callbackPriority=0;else if(e=a&-a,t.callbackPriority!==e){if(n!=null&&xC(n),e===1)t.tag===0?a8(dk.bind(null,t)):Yz(dk.bind(null,t)),r8(function(){!(Dr&6)&&wc()}),n=null;else{switch(Az(a)){case 1:n=lS;break;case 4:n=Ez;break;case 16:n=n_;break;case 536870912:n=Sz;break;default:n=n_}n=K4(n,V4.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function V4(t,e){if($y=-1,Wy=0,Dr&6)throw Error(yt(327));var n=t.callbackNode;if(bd()&&t.callbackNode!==n)return null;var a=i_(t,t===mi?Ti:0);if(a===0)return null;if(a&30||a&t.expiredLanes||e)e=w_(t,a);else{e=a;var u=Dr;Dr|=2;var d=W4();(mi!==t||Ti!==e)&&(el=null,Pd=Ln()+500,Iu(t,e));do try{I8();break}catch(l){$4(t,l)}while(1);bS(),v_.current=d,Dr=u,Kn!==null?e=0:(mi=null,Ti=0,e=oi)}if(e!==0){if(e===2&&(u=Qw(t),u!==0&&(a=u,e=AE(t,u))),e===1)throw n=Cm,Iu(t,0),nc(t,a),_o(t,Ln()),n;if(e===6)nc(t,a);else{if(u=t.current.alternate,!(a&30)&&!T8(u)&&(e=w_(t,a),e===2&&(d=Qw(t),d!==0&&(a=d,e=AE(t,d))),e===1))throw n=Cm,Iu(t,0),nc(t,a),_o(t,Ln()),n;switch(t.finishedWork=u,t.finishedLanes=a,e){case 0:case 1:throw Error(yt(345));case 2:bu(t,fo,el);break;case 3:if(nc(t,a),(a&130023424)===a&&(e=FS+500-Ln(),10<e)){if(i_(t,0)!==0)break;if(u=t.suspendedLanes,(u&a)!==a){Ji(),t.pingedLanes|=t.suspendedLanes&u;break}t.timeoutHandle=aE(bu.bind(null,t,fo,el),e);break}bu(t,fo,el);break;case 4:if(nc(t,a),(a&4194240)===a)break;for(e=t.eventTimes,u=-1;0<a;){var _=31-Wa(a);d=1<<_,_=e[_],_>u&&(u=_),a&=~d}if(a=u,a=Ln()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*S8(a/1960))-a,10<a){t.timeoutHandle=aE(bu.bind(null,t,fo,el),a);break}bu(t,fo,el);break;case 5:bu(t,fo,el);break;default:throw Error(yt(329))}}}return _o(t,Ln()),t.callbackNode===n?V4.bind(null,t):null}function AE(t,e){var n=lm;return t.current.memoizedState.isDehydrated&&(Iu(t,e).flags|=256),t=w_(t,e),t!==2&&(e=fo,fo=n,e!==null&&IE(e)),t}function IE(t){fo===null?fo=t:fo.push.apply(fo,t)}function T8(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var a=0;a<n.length;a++){var u=n[a],d=u.getSnapshot;u=u.value;try{if(!Za(d(),u))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function nc(t,e){for(e&=~OS,e&=~q_,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Wa(e),a=1<<n;t[n]=-1,e&=~a}}function dk(t){if(Dr&6)throw Error(yt(327));bd();var e=i_(t,0);if(!(e&1))return _o(t,Ln()),null;var n=w_(t,e);if(t.tag!==0&&n===2){var a=Qw(t);a!==0&&(e=a,n=AE(t,a))}if(n===1)throw n=Cm,Iu(t,0),nc(t,e),_o(t,Ln()),n;if(n===6)throw Error(yt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,bu(t,fo,el),_o(t,Ln()),null}function LS(t,e){var n=Dr;Dr|=1;try{return t(e)}finally{Dr=n,Dr===0&&(Pd=Ln()+500,$_&&wc())}}function zu(t){oc!==null&&oc.tag===0&&!(Dr&6)&&bd();var e=Dr;Dr|=1;var n=ua.transition,a=Kr;try{if(ua.transition=null,Kr=1,t)return t()}finally{Kr=a,ua.transition=n,Dr=e,!(Dr&6)&&wc()}}function BS(){Fo=dd.current,dn(dd)}function Iu(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,t8(n)),Kn!==null)for(n=Kn.return;n!==null;){var a=n;switch(_S(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&c_();break;case 3:Cd(),dn(go),dn(Wi),IS();break;case 5:AS(a);break;case 4:Cd();break;case 13:dn(Cn);break;case 19:dn(Cn);break;case 10:wS(a.type._context);break;case 22:case 23:BS()}n=n.return}if(mi=t,Kn=t=fc(t.current,null),Ti=Fo=e,oi=0,Cm=null,OS=q_=Mu=0,fo=lm=null,Su!==null){for(e=0;e<Su.length;e++)if(n=Su[e],a=n.interleaved,a!==null){n.interleaved=null;var u=a.next,d=n.pending;if(d!==null){var _=d.next;d.next=u,a.next=_}n.pending=a}Su=null}return t}function $4(t,e){do{var n=Kn;try{if(bS(),Uy.current=__,y_){for(var a=kn.memoizedState;a!==null;){var u=a.queue;u!==null&&(u.pending=null),a=a.next}y_=!1}if(Du=0,fi=ii=kn=null,am=!1,Tm=0,RS.current=null,n===null||n.return===null){oi=1,Cm=e,Kn=null;break}e:{var d=t,_=n.return,l=n,w=e;if(e=Ti,l.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){var T=w,C=l,P=C.tag;if(!(C.mode&1)&&(P===0||P===11||P===15)){var z=C.alternate;z?(C.updateQueue=z.updateQueue,C.memoizedState=z.memoizedState,C.lanes=z.lanes):(C.updateQueue=null,C.memoizedState=null)}var $=JC(_);if($!==null){$.flags&=-257,ek($,_,l,d,e),$.mode&1&&QC(d,T,e),e=$,w=T;var U=e.updateQueue;if(U===null){var W=new Set;W.add(w),e.updateQueue=W}else U.add(w);break e}else{if(!(e&1)){QC(d,T,e),NS();break e}w=Error(yt(426))}}else if(gn&&l.mode&1){var N=JC(_);if(N!==null){!(N.flags&65536)&&(N.flags|=256),ek(N,_,l,d,e),vS(kd(w,l));break e}}d=w=kd(w,l),oi!==4&&(oi=2),lm===null?lm=[d]:lm.push(d),d=_;do{switch(d.tag){case 3:d.flags|=65536,e&=-e,d.lanes|=e;var V=A4(d,w,e);HC(d,V);break e;case 1:l=w;var R=d.type,F=d.stateNode;if(!(d.flags&128)&&(typeof R.getDerivedStateFromError=="function"||F!==null&&typeof F.componentDidCatch=="function"&&(dc===null||!dc.has(F)))){d.flags|=65536,e&=-e,d.lanes|=e;var H=I4(d,l,e);HC(d,H);break e}}d=d.return}while(d!==null)}H4(n)}catch(J){e=J,Kn===n&&n!==null&&(Kn=n=n.return);continue}break}while(1)}function W4(){var t=v_.current;return v_.current=__,t===null?__:t}function NS(){(oi===0||oi===3||oi===2)&&(oi=4),mi===null||!(Mu&268435455)&&!(q_&268435455)||nc(mi,Ti)}function w_(t,e){var n=Dr;Dr|=2;var a=W4();(mi!==t||Ti!==e)&&(el=null,Iu(t,e));do try{A8();break}catch(u){$4(t,u)}while(1);if(bS(),Dr=n,v_.current=a,Kn!==null)throw Error(yt(261));return mi=null,Ti=0,oi}function A8(){for(;Kn!==null;)G4(Kn)}function I8(){for(;Kn!==null&&!QL();)G4(Kn)}function G4(t){var e=Z4(t.alternate,t,Fo);t.memoizedProps=t.pendingProps,e===null?H4(t):Kn=e,RS.current=null}function H4(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=x8(n,e),n!==null){n.flags&=32767,Kn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{oi=6,Kn=null;return}}else if(n=v8(n,e,Fo),n!==null){Kn=n;return}if(e=e.sibling,e!==null){Kn=e;return}Kn=e=t}while(e!==null);oi===0&&(oi=5)}function bu(t,e,n){var a=Kr,u=ua.transition;try{ua.transition=null,Kr=1,C8(t,e,n,a)}finally{ua.transition=u,Kr=a}return null}function C8(t,e,n,a){do bd();while(oc!==null);if(Dr&6)throw Error(yt(327));n=t.finishedWork;var u=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(yt(177));t.callbackNode=null,t.callbackPriority=0;var d=n.lanes|n.childLanes;if(lB(t,d),t===mi&&(Kn=mi=null,Ti=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||jg||(jg=!0,K4(n_,function(){return bd(),null})),d=(n.flags&15990)!==0,n.subtreeFlags&15990||d){d=ua.transition,ua.transition=null;var _=Kr;Kr=1;var l=Dr;Dr|=4,RS.current=null,w8(t,n),U4(n,t),ZB(iE),o_=!!nE,iE=nE=null,t.current=n,E8(n),JL(),Dr=l,Kr=_,ua.transition=d}else t.current=n;if(jg&&(jg=!1,oc=t,b_=u),d=t.pendingLanes,d===0&&(dc=null),rB(n.stateNode),_o(t,Ln()),e!==null)for(a=t.onRecoverableError,n=0;n<e.length;n++)u=e[n],a(u.value,{componentStack:u.stack,digest:u.digest});if(x_)throw x_=!1,t=SE,SE=null,t;return b_&1&&t.tag!==0&&bd(),d=t.pendingLanes,d&1?t===TE?cm++:(cm=0,TE=t):cm=0,wc(),null}function bd(){if(oc!==null){var t=Az(b_),e=ua.transition,n=Kr;try{if(ua.transition=null,Kr=16>t?16:t,oc===null)var a=!1;else{if(t=oc,oc=null,b_=0,Dr&6)throw Error(yt(331));var u=Dr;for(Dr|=4,Rt=t.current;Rt!==null;){var d=Rt,_=d.child;if(Rt.flags&16){var l=d.deletions;if(l!==null){for(var w=0;w<l.length;w++){var T=l[w];for(Rt=T;Rt!==null;){var C=Rt;switch(C.tag){case 0:case 11:case 15:sm(8,C,d)}var P=C.child;if(P!==null)P.return=C,Rt=P;else for(;Rt!==null;){C=Rt;var z=C.sibling,$=C.return;if(L4(C),C===T){Rt=null;break}if(z!==null){z.return=$,Rt=z;break}Rt=$}}}var U=d.alternate;if(U!==null){var W=U.child;if(W!==null){U.child=null;do{var N=W.sibling;W.sibling=null,W=N}while(W!==null)}}Rt=d}}if(d.subtreeFlags&2064&&_!==null)_.return=d,Rt=_;else e:for(;Rt!==null;){if(d=Rt,d.flags&2048)switch(d.tag){case 0:case 11:case 15:sm(9,d,d.return)}var V=d.sibling;if(V!==null){V.return=d.return,Rt=V;break e}Rt=d.return}}var R=t.current;for(Rt=R;Rt!==null;){_=Rt;var F=_.child;if(_.subtreeFlags&2064&&F!==null)F.return=_,Rt=F;else e:for(_=R;Rt!==null;){if(l=Rt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:H_(9,l)}}catch(J){On(l,l.return,J)}if(l===_){Rt=null;break e}var H=l.sibling;if(H!==null){H.return=l.return,Rt=H;break e}Rt=l.return}}if(Dr=u,wc(),Ts&&typeof Ts.onPostCommitFiberRoot=="function")try{Ts.onPostCommitFiberRoot(B_,t)}catch{}a=!0}return a}finally{Kr=n,ua.transition=e}}return!1}function pk(t,e,n){e=kd(n,e),e=A4(t,e,1),t=hc(t,e,1),e=Ji(),t!==null&&(Fm(t,1,e),_o(t,e))}function On(t,e,n){if(t.tag===3)pk(t,t,n);else for(;e!==null;){if(e.tag===3){pk(e,t,n);break}else if(e.tag===1){var a=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(dc===null||!dc.has(a))){t=kd(n,t),t=I4(e,t,1),e=hc(e,t,1),t=Ji(),e!==null&&(Fm(e,1,t),_o(e,t));break}}e=e.return}}function k8(t,e,n){var a=t.pingCache;a!==null&&a.delete(e),e=Ji(),t.pingedLanes|=t.suspendedLanes&n,mi===t&&(Ti&n)===n&&(oi===4||oi===3&&(Ti&130023424)===Ti&&500>Ln()-FS?Iu(t,0):OS|=n),_o(t,e)}function q4(t,e){e===0&&(t.mode&1?(e=Dg,Dg<<=1,!(Dg&130023424)&&(Dg=4194304)):e=1);var n=Ji();t=cl(t,e),t!==null&&(Fm(t,e,n),_o(t,n))}function P8(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),q4(t,n)}function D8(t,e){var n=0;switch(t.tag){case 13:var a=t.stateNode,u=t.memoizedState;u!==null&&(n=u.retryLane);break;case 19:a=t.stateNode;break;default:throw Error(yt(314))}a!==null&&a.delete(e),q4(t,n)}var Z4;Z4=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||go.current)mo=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return mo=!1,_8(t,e,n);mo=!!(t.flags&131072)}else mo=!1,gn&&e.flags&1048576&&Qz(e,d_,e.index);switch(e.lanes=0,e.tag){case 2:var a=e.type;Vy(t,e),t=e.pendingProps;var u=Td(e,Wi.current);xd(e,n),u=kS(null,e,a,t,u,n);var d=PS();return e.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,yo(a)?(d=!0,u_(e)):d=!1,e.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,SS(e),u.updater=G_,e.stateNode=u,u._reactInternals=e,pE(e,a,t,n),e=gE(null,e,a,!0,d,n)):(e.tag=0,gn&&d&&yS(e),Qi(null,e,u,n),e=e.child),e;case 16:a=e.elementType;e:{switch(Vy(t,e),t=e.pendingProps,u=a._init,a=u(a._payload),e.type=a,u=e.tag=z8(a),t=Ua(a,t),u){case 0:e=mE(null,e,a,t,n);break e;case 1:e=nk(null,e,a,t,n);break e;case 11:e=tk(null,e,a,t,n);break e;case 14:e=rk(null,e,a,Ua(a.type,t),n);break e}throw Error(yt(306,a,""))}return e;case 0:return a=e.type,u=e.pendingProps,u=e.elementType===a?u:Ua(a,u),mE(t,e,a,u,n);case 1:return a=e.type,u=e.pendingProps,u=e.elementType===a?u:Ua(a,u),nk(t,e,a,u,n);case 3:e:{if(D4(e),t===null)throw Error(yt(387));a=e.pendingProps,d=e.memoizedState,u=d.element,i4(t,e),m_(e,a,null,n);var _=e.memoizedState;if(a=_.element,d.isDehydrated)if(d={element:a,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},e.updateQueue.baseState=d,e.memoizedState=d,e.flags&256){u=kd(Error(yt(423)),e),e=ik(t,e,a,n,u);break e}else if(a!==u){u=kd(Error(yt(424)),e),e=ik(t,e,a,n,u);break e}else for(Lo=uc(e.stateNode.containerInfo.firstChild),Bo=e,gn=!0,Va=null,n=r4(e,null,a,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ad(),a===u){e=ul(t,e,n);break e}Qi(t,e,a,n)}e=e.child}return e;case 5:return o4(e),t===null&&uE(e),a=e.type,u=e.pendingProps,d=t!==null?t.memoizedProps:null,_=u.children,oE(a,u)?_=null:d!==null&&oE(a,d)&&(e.flags|=32),P4(t,e),Qi(t,e,_,n),e.child;case 6:return t===null&&uE(e),null;case 13:return M4(t,e,n);case 4:return TS(e,e.stateNode.containerInfo),a=e.pendingProps,t===null?e.child=Id(e,null,a,n):Qi(t,e,a,n),e.child;case 11:return a=e.type,u=e.pendingProps,u=e.elementType===a?u:Ua(a,u),tk(t,e,a,u,n);case 7:return Qi(t,e,e.pendingProps,n),e.child;case 8:return Qi(t,e,e.pendingProps.children,n),e.child;case 12:return Qi(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(a=e.type._context,u=e.pendingProps,d=e.memoizedProps,_=u.value,on(p_,a._currentValue),a._currentValue=_,d!==null)if(Za(d.value,_)){if(d.children===u.children&&!go.current){e=ul(t,e,n);break e}}else for(d=e.child,d!==null&&(d.return=e);d!==null;){var l=d.dependencies;if(l!==null){_=d.child;for(var w=l.firstContext;w!==null;){if(w.context===a){if(d.tag===1){w=al(-1,n&-n),w.tag=2;var T=d.updateQueue;if(T!==null){T=T.shared;var C=T.pending;C===null?w.next=w:(w.next=C.next,C.next=w),T.pending=w}}d.lanes|=n,w=d.alternate,w!==null&&(w.lanes|=n),hE(d.return,n,e),l.lanes|=n;break}w=w.next}}else if(d.tag===10)_=d.type===e.type?null:d.child;else if(d.tag===18){if(_=d.return,_===null)throw Error(yt(341));_.lanes|=n,l=_.alternate,l!==null&&(l.lanes|=n),hE(_,n,e),_=d.sibling}else _=d.child;if(_!==null)_.return=d;else for(_=d;_!==null;){if(_===e){_=null;break}if(d=_.sibling,d!==null){d.return=_.return,_=d;break}_=_.return}d=_}Qi(t,e,u.children,n),e=e.child}return e;case 9:return u=e.type,a=e.pendingProps.children,xd(e,n),u=ha(u),a=a(u),e.flags|=1,Qi(t,e,a,n),e.child;case 14:return a=e.type,u=Ua(a,e.pendingProps),u=Ua(a.type,u),rk(t,e,a,u,n);case 15:return C4(t,e,e.type,e.pendingProps,n);case 17:return a=e.type,u=e.pendingProps,u=e.elementType===a?u:Ua(a,u),Vy(t,e),e.tag=1,yo(a)?(t=!0,u_(e)):t=!1,xd(e,n),T4(e,a,u),pE(e,a,u,n),gE(null,e,a,!0,t,n);case 19:return z4(t,e,n);case 22:return k4(t,e,n)}throw Error(yt(156,e.tag))};function K4(t,e){return wz(t,e)}function M8(t,e,n,a){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ca(t,e,n,a){return new M8(t,e,n,a)}function US(t){return t=t.prototype,!(!t||!t.isReactComponent)}function z8(t){if(typeof t=="function")return US(t)?1:0;if(t!=null){if(t=t.$$typeof,t===oS)return 11;if(t===aS)return 14}return 2}function fc(t,e){var n=t.alternate;return n===null?(n=ca(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Gy(t,e,n,a,u,d){var _=2;if(a=t,typeof t=="function")US(t)&&(_=1);else if(typeof t=="string")_=5;else e:switch(t){case rd:return Cu(n.children,u,d,e);case iS:_=8,u|=8;break;case Lw:return t=ca(12,n,e,u|2),t.elementType=Lw,t.lanes=d,t;case Bw:return t=ca(13,n,e,u),t.elementType=Bw,t.lanes=d,t;case Nw:return t=ca(19,n,e,u),t.elementType=Nw,t.lanes=d,t;case oz:return Z_(n,u,d,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case nz:_=10;break e;case iz:_=9;break e;case oS:_=11;break e;case aS:_=14;break e;case ec:_=16,a=null;break e}throw Error(yt(130,t==null?t:typeof t,""))}return e=ca(_,n,e,u),e.elementType=t,e.type=a,e.lanes=d,e}function Cu(t,e,n,a){return t=ca(7,t,a,e),t.lanes=n,t}function Z_(t,e,n,a){return t=ca(22,t,a,e),t.elementType=oz,t.lanes=n,t.stateNode={isHidden:!1},t}function eb(t,e,n){return t=ca(6,t,null,e),t.lanes=n,t}function tb(t,e,n){return e=ca(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function R8(t,e,n,a,u){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=O1(0),this.expirationTimes=O1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=O1(0),this.identifierPrefix=a,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function jS(t,e,n,a,u,d,_,l,w){return t=new R8(t,e,n,l,w),e===1?(e=1,d===!0&&(e|=8)):e=0,d=ca(3,null,null,e),t.current=d,d.stateNode=t,d.memoizedState={element:a,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},SS(d),t}function O8(t,e,n){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:td,key:a==null?null:""+a,children:t,containerInfo:e,implementation:n}}function X4(t){if(!t)return yc;t=t._reactInternals;e:{if(Fu(t)!==t||t.tag!==1)throw Error(yt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(yo(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(yt(171))}if(t.tag===1){var n=t.type;if(yo(n))return Xz(t,n,e)}return e}function Y4(t,e,n,a,u,d,_,l,w){return t=jS(n,a,!0,t,u,d,_,l,w),t.context=X4(null),n=t.current,a=Ji(),u=pc(n),d=al(a,u),d.callback=e??null,hc(n,d,u),t.current.lanes=u,Fm(t,u,a),_o(t,a),t}function K_(t,e,n,a){var u=e.current,d=Ji(),_=pc(u);return n=X4(n),e.context===null?e.context=n:e.pendingContext=n,e=al(d,_),e.payload={element:t},a=a===void 0?null:a,a!==null&&(e.callback=a),t=hc(u,e,_),t!==null&&(Ga(t,u,_,d),Ny(t,u,_)),_}function E_(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function fk(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function VS(t,e){fk(t,e),(t=t.alternate)&&fk(t,e)}function F8(){return null}var Q4=typeof reportError=="function"?reportError:function(t){console.error(t)};function $S(t){this._internalRoot=t}X_.prototype.render=$S.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(yt(409));K_(t,e,null,null)};X_.prototype.unmount=$S.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;zu(function(){K_(null,t,null,null)}),e[ll]=null}};function X_(t){this._internalRoot=t}X_.prototype.unstable_scheduleHydration=function(t){if(t){var e=kz();t={blockedOn:null,target:t,priority:e};for(var n=0;n<rc.length&&e!==0&&e<rc[n].priority;n++);rc.splice(n,0,t),n===0&&Dz(t)}};function WS(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Y_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function mk(){}function L8(t,e,n,a,u){if(u){if(typeof a=="function"){var d=a;a=function(){var T=E_(_);d.call(T)}}var _=Y4(e,a,t,0,null,!1,!1,"",mk);return t._reactRootContainer=_,t[ll]=_.current,xm(t.nodeType===8?t.parentNode:t),zu(),_}for(;u=t.lastChild;)t.removeChild(u);if(typeof a=="function"){var l=a;a=function(){var T=E_(w);l.call(T)}}var w=jS(t,0,!1,null,null,!1,!1,"",mk);return t._reactRootContainer=w,t[ll]=w.current,xm(t.nodeType===8?t.parentNode:t),zu(function(){K_(e,w,n,a)}),w}function Q_(t,e,n,a,u){var d=n._reactRootContainer;if(d){var _=d;if(typeof u=="function"){var l=u;u=function(){var w=E_(_);l.call(w)}}K_(e,_,t,u)}else _=L8(n,e,t,u,a);return E_(_)}Iz=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Jf(e.pendingLanes);n!==0&&(cS(e,n|1),_o(e,Ln()),!(Dr&6)&&(Pd=Ln()+500,wc()))}break;case 13:zu(function(){var a=cl(t,1);if(a!==null){var u=Ji();Ga(a,t,1,u)}}),VS(t,1)}};uS=function(t){if(t.tag===13){var e=cl(t,134217728);if(e!==null){var n=Ji();Ga(e,t,134217728,n)}VS(t,134217728)}};Cz=function(t){if(t.tag===13){var e=pc(t),n=cl(t,e);if(n!==null){var a=Ji();Ga(n,t,e,a)}VS(t,e)}};kz=function(){return Kr};Pz=function(t,e){var n=Kr;try{return Kr=t,e()}finally{Kr=n}};Kw=function(t,e,n){switch(e){case"input":if(Vw(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var a=n[e];if(a!==t&&a.form===t.form){var u=V_(a);if(!u)throw Error(yt(90));sz(a),Vw(a,u)}}}break;case"textarea":cz(t,n);break;case"select":e=n.value,e!=null&&gd(t,!!n.multiple,e,!1)}};gz=LS;yz=zu;var B8={usingClientEntryPoint:!1,Events:[Bm,ad,V_,fz,mz,LS]},zf={findFiberByHostInstance:Eu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},N8={bundleType:zf.bundleType,version:zf.version,rendererPackageName:zf.rendererPackageName,rendererConfig:zf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:hl.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=xz(t),t===null?null:t.stateNode},findFiberByHostInstance:zf.findFiberByHostInstance||F8,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Vg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Vg.isDisabled&&Vg.supportsFiber)try{B_=Vg.inject(N8),Ts=Vg}catch{}}jo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B8;jo.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!WS(e))throw Error(yt(200));return O8(t,e,null,n)};jo.createRoot=function(t,e){if(!WS(t))throw Error(yt(299));var n=!1,a="",u=Q4;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(a=e.identifierPrefix),e.onRecoverableError!==void 0&&(u=e.onRecoverableError)),e=jS(t,1,!1,null,null,n,!1,a,u),t[ll]=e.current,xm(t.nodeType===8?t.parentNode:t),new $S(e)};jo.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(yt(188)):(t=Object.keys(t).join(","),Error(yt(268,t)));return t=xz(e),t=t===null?null:t.stateNode,t};jo.flushSync=function(t){return zu(t)};jo.hydrate=function(t,e,n){if(!Y_(e))throw Error(yt(200));return Q_(null,t,e,!0,n)};jo.hydrateRoot=function(t,e,n){if(!WS(t))throw Error(yt(405));var a=n!=null&&n.hydratedSources||null,u=!1,d="",_=Q4;if(n!=null&&(n.unstable_strictMode===!0&&(u=!0),n.identifierPrefix!==void 0&&(d=n.identifierPrefix),n.onRecoverableError!==void 0&&(_=n.onRecoverableError)),e=Y4(e,null,t,1,n??null,u,!1,d,_),t[ll]=e.current,xm(t),a)for(t=0;t<a.length;t++)n=a[t],u=n._getVersion,u=u(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,u]:e.mutableSourceEagerHydrationData.push(n,u);return new X_(e)};jo.render=function(t,e,n){if(!Y_(e))throw Error(yt(200));return Q_(null,t,e,!1,n)};jo.unmountComponentAtNode=function(t){if(!Y_(t))throw Error(yt(40));return t._reactRootContainer?(zu(function(){Q_(null,null,t,!1,function(){t._reactRootContainer=null,t[ll]=null})}),!0):!1};jo.unstable_batchedUpdates=LS;jo.unstable_renderSubtreeIntoContainer=function(t,e,n,a){if(!Y_(n))throw Error(yt(200));if(t==null||t._reactInternals===void 0)throw Error(yt(38));return Q_(t,e,n,!1,a)};jo.version="18.3.1-next-f1338f8080-20240426";function J4(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(J4)}catch(t){console.error(t)}}J4(),JM.exports=jo;var GS=JM.exports,eR,gk=GS;eR=gk.createRoot,gk.hydrateRoot;const U8="Logging",j8="NoHubcallbackProvidedException";var Oo;(function(t){t.DEBUG="DEBUG",t.ERROR="ERROR",t.INFO="INFO",t.WARN="WARN",t.VERBOSE="VERBOSE",t.NONE="NONE"})(Oo||(Oo={}));const yk={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,NONE:6};class Ha{constructor(e,n=Oo.WARN){this.name=e,this.level=n,this._pluggables=[]}_padding(e){return e<10?"0"+e:""+e}_ts(){const e=new Date;return[this._padding(e.getMinutes()),this._padding(e.getSeconds())].join(":")+"."+e.getMilliseconds()}configure(e){return e?(this._config=e,this._config):this._config}_log(e,...n){let a=this.level;Ha.LOG_LEVEL&&(a=Ha.LOG_LEVEL),typeof window<"u"&&window.LOG_LEVEL&&(a=window.LOG_LEVEL);const u=yk[a];if(!(yk[e]>=u))return;let _=console.log.bind(console);e===Oo.ERROR&&console.error&&(_=console.error.bind(console)),e===Oo.WARN&&console.warn&&(_=console.warn.bind(console)),Ha.BIND_ALL_LOG_LEVELS&&(e===Oo.INFO&&console.info&&(_=console.info.bind(console)),e===Oo.DEBUG&&console.debug&&(_=console.debug.bind(console)));const l=`[${e}] ${this._ts()} ${this.name}`;let w="";if(n.length===1&&typeof n[0]=="string")w=`${l} - ${n[0]}`,_(w);else if(n.length===1)w=`${l} ${n[0]}`,_(l,n[0]);else if(typeof n[0]=="string"){let T=n.slice(1);T.length===1&&(T=T[0]),w=`${l} - ${n[0]} ${T}`,_(`${l} - ${n[0]}`,T)}else w=`${l} ${n}`,_(l,n);for(const T of this._pluggables){const C={message:w,timestamp:Date.now()};T.pushLogs([C])}}log(...e){this._log(Oo.INFO,...e)}info(...e){this._log(Oo.INFO,...e)}warn(...e){this._log(Oo.WARN,...e)}error(...e){this._log(Oo.ERROR,...e)}debug(...e){this._log(Oo.DEBUG,...e)}verbose(...e){this._log(Oo.VERBOSE,...e)}addPluggable(e){e&&e.getCategoryName()===U8&&(this._pluggables.push(e),e.configure(this._config))}listPluggables(){return this._pluggables}}Ha.LOG_LEVEL=null;Ha.BIND_ALL_LOG_LEVELS=!1;class Is extends Error{constructor({message:e,name:n,recoverySuggestion:a,underlyingError:u}){super(e),this.name=n,this.underlyingError=u,this.recoverySuggestion=a,this.constructor=Is,Object.setPrototypeOf(this,Is.prototype)}}var km;(function(t){t.NoEndpointId="NoEndpointId",t.PlatformNotSupported="PlatformNotSupported",t.Unknown="Unknown",t.NetworkError="NetworkError"})(km||(km={}));const tR=(t,e=Is)=>(n,a,u)=>{const{message:d,recoverySuggestion:_}=t[a];if(!n)throw new e({name:a,message:u?`${d} ${u}`:d,recoverySuggestion:_})},S_=typeof Symbol<"u"?Symbol("amplify_default"):"@@amplify_default",Rf=new Ha("Hub");class V8{constructor(e){this.listeners=new Map,this.protectedChannels=["core","auth","api","analytics","interactions","pubsub","storage","ui","xr"],this.name=e}_remove(e,n){const a=this.listeners.get(e);if(!a){Rf.warn(`No listeners for ${e}`);return}this.listeners.set(e,[...a.filter(({callback:u})=>u!==n)])}dispatch(e,n,a,u){typeof e=="string"&&this.protectedChannels.indexOf(e)>-1&&(u===S_||Rf.warn(`WARNING: ${e} is protected and dispatching on it can have unintended consequences`));const d={channel:e,payload:{...n},source:a,patternInfo:[]};try{this._toListeners(d)}catch(_){Rf.error(_)}}listen(e,n,a="noname"){let u;if(typeof n!="function")throw new Is({name:j8,message:"No callback supplied to Hub"});u=n;let d=this.listeners.get(e);return d||(d=[],this.listeners.set(e,d)),d.push({name:a,callback:u}),()=>{this._remove(e,u)}}_toListeners(e){const{channel:n,payload:a}=e,u=this.listeners.get(n);u&&u.forEach(d=>{Rf.debug(`Dispatching to ${n} with `,a);try{d.callback(e)}catch(_){Rf.error(_)}})}}const CE=new V8("__default__"),$8=()=>{if(typeof window<"u"&&typeof window.atob=="function")return window.atob;if(typeof atob=="function")return atob;throw new Is({name:"Base64EncoderError",message:"Cannot resolve the `atob` function from the environment."})},W8={convert(t){return $8()(t)}};var rl;(function(t){t.AuthTokenConfigException="AuthTokenConfigException",t.AuthUserPoolAndIdentityPoolException="AuthUserPoolAndIdentityPoolException",t.AuthUserPoolException="AuthUserPoolException",t.InvalidIdentityPoolIdException="InvalidIdentityPoolIdException",t.OAuthNotConfigureException="OAuthNotConfigureException"})(rl||(rl={}));const G8={[rl.AuthTokenConfigException]:{message:"Auth Token Provider not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app."},[rl.AuthUserPoolAndIdentityPoolException]:{message:"Auth UserPool or IdentityPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with UserPoolId and IdentityPoolId."},[rl.AuthUserPoolException]:{message:"Auth UserPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with userPoolId and userPoolClientId."},[rl.InvalidIdentityPoolIdException]:{message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."},[rl.OAuthNotConfigureException]:{message:"oauth param not configured.",recoverySuggestion:"Make sure to call Amplify.configure with oauth parameter in your app."}},rR=tR(G8);function po(t){let e=!0;t?e=!!t.userPoolId&&!!t.userPoolClientId:e=!1,rR(e,rl.AuthUserPoolException)}function Hy(t){const e=!!(t!=null&&t.identityPoolId);rR(e,rl.InvalidIdentityPoolIdException)}function Pm(t){const e=t.split(".");if(e.length!==3)throw new Error("Invalid token");try{const a=e[1].replace(/-/g,"+").replace(/_/g,"/"),u=decodeURIComponent(W8.convert(a).split("").map(_=>`%${`00${_.charCodeAt(0).toString(16)}`.slice(-2)}`).join("")),d=JSON.parse(u);return{toString:()=>t,payload:d}}catch{throw new Error("Invalid token payload")}}const nR=t=>{const e=Reflect.ownKeys(t);for(const n of e){const a=t[n];(a&&typeof a=="object"||typeof a=="function")&&nR(a)}return Object.freeze(t)},H8=new Ha("parseAWSExports"),q8={API_KEY:"apiKey",AWS_IAM:"iam",AMAZON_COGNITO_USER_POOLS:"userPool",OPENID_CONNECT:"oidc",NONE:"none",AWS_LAMBDA:"lambda",LAMBDA:"lambda"},Z8=(t={})=>{var it,ur,Xt,Pr,Yt,si;if(!Object.prototype.hasOwnProperty.call(t,"aws_project_region"))throw new Is({name:"InvalidParameterException",message:"Invalid config parameter.",recoverySuggestion:"Ensure passing the config object imported from  `amplifyconfiguration.json`."});const{aws_appsync_apiKey:e,aws_appsync_authenticationType:n,aws_appsync_graphqlEndpoint:a,aws_appsync_region:u,aws_bots_config:d,aws_cognito_identity_pool_id:_,aws_cognito_sign_up_verification_method:l,aws_cognito_mfa_configuration:w,aws_cognito_mfa_types:T,aws_cognito_password_protection_settings:C,aws_cognito_verification_mechanisms:P,aws_cognito_signup_attributes:z,aws_cognito_social_providers:$,aws_cognito_username_attributes:U,aws_mandatory_sign_in:W,aws_mobile_analytics_app_id:N,aws_mobile_analytics_app_region:V,aws_user_files_s3_bucket:R,aws_user_files_s3_bucket_region:F,aws_user_files_s3_dangerously_connect_to_http_endpoint_for_testing:H,aws_user_pools_id:J,aws_user_pools_web_client_id:te,geo:se,oauth:ge,predictions:xe,aws_cloud_logic_custom:Ee,Notifications:Be,modelIntrospection:Fe}=t,Ve={};N&&(Ve.Analytics={Pinpoint:{appId:N,region:V}});const{InAppMessaging:Ct,Push:Dt}=Be??{};if(Ct!=null&&Ct.AWSPinpoint||Dt!=null&&Dt.AWSPinpoint){if(Ct!=null&&Ct.AWSPinpoint){const{appId:mr,region:Vt}=Ct.AWSPinpoint;Ve.Notifications={InAppMessaging:{Pinpoint:{appId:mr,region:Vt}}}}if(Dt!=null&&Dt.AWSPinpoint){const{appId:mr,region:Vt}=Dt.AWSPinpoint;Ve.Notifications={...Ve.Notifications,PushNotification:{Pinpoint:{appId:mr,region:Vt}}}}}if(Array.isArray(d)&&(Ve.Interactions={LexV1:Object.fromEntries(d.map(mr=>[mr.name,mr]))}),a){const mr=q8[n];mr||H8.debug(`Invalid authentication type ${n}. Falling back to IAM.`),Ve.API={GraphQL:{endpoint:a,apiKey:e,region:u,defaultAuthMode:mr??"iam"}},Fe&&(Ve.API.GraphQL.modelIntrospection=Fe)}const Ut=w?{status:w&&w.toLowerCase(),totpEnabled:(T==null?void 0:T.includes("TOTP"))??!1,smsEnabled:(T==null?void 0:T.includes("SMS"))??!1}:void 0,cr=C?{minLength:C.passwordPolicyMinLength,requireLowercase:((it=C.passwordPolicyCharacters)==null?void 0:it.includes("REQUIRES_LOWERCASE"))??!1,requireUppercase:((ur=C.passwordPolicyCharacters)==null?void 0:ur.includes("REQUIRES_UPPERCASE"))??!1,requireNumbers:((Xt=C.passwordPolicyCharacters)==null?void 0:Xt.includes("REQUIRES_NUMBERS"))??!1,requireSpecialCharacters:((Pr=C.passwordPolicyCharacters)==null?void 0:Pr.includes("REQUIRES_SYMBOLS"))??!1}:void 0,St=Array.from(new Set([...P??[],...z??[]])).reduce((mr,Vt)=>({...mr,[Vt.toLowerCase()]:{required:!0}}),{}),gt=(U==null?void 0:U.includes("EMAIL"))??!1,je=(U==null?void 0:U.includes("PHONE_NUMBER"))??!1;(_||J)&&(Ve.Auth={Cognito:{identityPoolId:_,allowGuestAccess:W!=="enable",signUpVerificationMethod:l,userAttributes:St,userPoolClientId:te,userPoolId:J,mfa:Ut,passwordFormat:cr,loginWith:{username:!(gt||je),email:gt,phone:je}}});const et=ge?Object.keys(ge).length>0:!1,nt=$?$.length>0:!1;if(Ve.Auth&&et&&(Ve.Auth.Cognito.loginWith={...Ve.Auth.Cognito.loginWith,oauth:{...K8(ge),...nt&&{providers:X8($)}}}),R&&(Ve.Storage={S3:{bucket:R,region:F,dangerouslyConnectToHttpEndpointForTesting:H}}),se){const{amazon_location_service:mr}=se;Ve.Geo={LocationService:{maps:mr.maps,geofenceCollections:mr.geofenceCollections,searchIndices:mr.search_indices,region:mr.region}}}if(Ee&&(Ve.API={...Ve.API,REST:Ee.reduce((mr,Vt)=>{const{name:Ii,endpoint:qr,region:pn,service:Tr}=Vt;return{...mr,[Ii]:{endpoint:qr,...Tr?{service:Tr}:void 0,...pn?{region:pn}:void 0}}},{})}),xe){const{VoiceId:mr}=((si=(Yt=xe==null?void 0:xe.convert)==null?void 0:Yt.speechGenerator)==null?void 0:si.defaults)??{};Ve.Predictions=mr?{...xe,convert:{...xe.convert,speechGenerator:{...xe.convert.speechGenerator,defaults:{voiceId:mr}}}}:xe}return Ve},_k=t=>(t==null?void 0:t.split(","))??[],K8=({domain:t,scope:e,redirectSignIn:n,redirectSignOut:a,responseType:u})=>({domain:t,scopes:e,redirectSignIn:_k(n),redirectSignOut:_k(a),responseType:u}),X8=t=>t.map(e=>{const n=e.toLowerCase();return n.charAt(0).toUpperCase()+n.slice(1)}),Y8=Symbol("oauth-listener");function Q8(t){const{version:e}=t;return e?e.startsWith("1"):!1}function J8(t){if(!t)return;const{bucket_name:e,aws_region:n,buckets:a}=t;return{S3:{bucket:e,region:n,buckets:a&&u6(a)}}}function e6(t){if(!t)return;const{user_pool_id:e,user_pool_client_id:n,identity_pool_id:a,password_policy:u,mfa_configuration:d,mfa_methods:_,unauthenticated_identities_enabled:l,oauth:w,username_attributes:T,standard_required_attributes:C}=t,P={Cognito:{userPoolId:e,userPoolClientId:n}};return a&&(P.Cognito={...P.Cognito,identityPoolId:a}),u&&(P.Cognito.passwordFormat={requireLowercase:u.require_lowercase,requireNumbers:u.require_numbers,requireUppercase:u.require_uppercase,requireSpecialCharacters:u.require_symbols,minLength:u.min_length??6}),d&&(P.Cognito.mfa={status:c6(d),smsEnabled:_==null?void 0:_.includes("SMS"),totpEnabled:_==null?void 0:_.includes("TOTP")}),l&&(P.Cognito.allowGuestAccess=l),w&&(P.Cognito.loginWith={oauth:{domain:w.domain,redirectSignIn:w.redirect_sign_in_uri,redirectSignOut:w.redirect_sign_out_uri,responseType:w.response_type==="token"?"token":"code",scopes:w.scopes,providers:l6(w.identity_providers)}}),T&&(P.Cognito.loginWith={...P.Cognito.loginWith,email:T.includes("email"),phone:T.includes("phone_number"),username:T.includes("username")}),C&&(P.Cognito.userAttributes=C.reduce((z,$)=>({...z,[$]:{required:!0}}),{})),P}function t6(t){if(!(t!=null&&t.amazon_pinpoint))return;const{amazon_pinpoint:e}=t;return{Pinpoint:{appId:e.app_id,region:e.aws_region}}}function r6(t){if(!t)return;const{aws_region:e,geofence_collections:n,maps:a,search_indices:u}=t;return{LocationService:{region:e,searchIndices:u,geofenceCollections:n,maps:a}}}function n6(t){if(!t)return;const{aws_region:e,default_authorization_type:n,url:a,api_key:u,model_introspection:d}=t;return{GraphQL:{endpoint:a,defaultAuthMode:s6(n),region:e,apiKey:u,modelIntrospection:d}}}function i6(t){if(!t)return;const{aws_region:e,channels:n,amazon_pinpoint_app_id:a}=t,u=n.includes("IN_APP_MESSAGING"),d=n.includes("APNS")||n.includes("FCM");if(!(u||d))return;const _={};return u&&(_.InAppMessaging={Pinpoint:{appId:a,region:e}}),d&&(_.PushNotification={Pinpoint:{appId:a,region:e}}),_}function o6(t){const e={};return t.storage&&(e.Storage=J8(t.storage)),t.auth&&(e.Auth=e6(t.auth)),t.analytics&&(e.Analytics=t6(t.analytics)),t.geo&&(e.Geo=r6(t.geo)),t.data&&(e.API=n6(t.data)),t.notifications&&(e.Notifications=i6(t.notifications)),e}const a6={AMAZON_COGNITO_USER_POOLS:"userPool",API_KEY:"apiKey",AWS_IAM:"iam",AWS_LAMBDA:"lambda",OPENID_CONNECT:"oidc"};function s6(t){return a6[t]}const vk={GOOGLE:"Google",LOGIN_WITH_AMAZON:"Amazon",FACEBOOK:"Facebook",SIGN_IN_WITH_APPLE:"Apple"};function l6(t=[]){return t.reduce((e,n)=>(vk[n]!==void 0&&e.push(vk[n]),e),[])}function c6(t){return t==="OPTIONAL"?"optional":t==="REQUIRED"?"on":"off"}function u6(t){const e={};return t.forEach(({name:n,bucket_name:a,aws_region:u})=>{if(n in e)throw new Error(`Duplicate friendly name found: ${n}. Name must be unique.`);e[n]={bucketName:a,region:u}}),e}const iR=t=>Object.keys(t).some(e=>e.startsWith("aws_"))?Z8(t):Q8(t)?o6(t):t;function xk({expiresAt:t,clockDrift:e}){return Date.now()+e>t}class h6{configure(e,n){this.authConfig=e,this.authOptions=n}async fetchAuthSession(e={}){var d,_,l,w,T,C;let n,a;const u=await this.getTokens(e);return u?(a=(_=(d=u.accessToken)==null?void 0:d.payload)==null?void 0:_.sub,n=await((w=(l=this.authOptions)==null?void 0:l.credentialsProvider)==null?void 0:w.getCredentialsAndIdentityId({authConfig:this.authConfig,tokens:u,authenticated:!0,forceRefresh:e.forceRefresh}))):n=await((C=(T=this.authOptions)==null?void 0:T.credentialsProvider)==null?void 0:C.getCredentialsAndIdentityId({authConfig:this.authConfig,authenticated:!1,forceRefresh:e.forceRefresh})),{tokens:u,credentials:n==null?void 0:n.credentials,identityId:n==null?void 0:n.identityId,userSub:a}}async clearCredentials(){var e,n;await((n=(e=this.authOptions)==null?void 0:e.credentialsProvider)==null?void 0:n.clearCredentialsAndIdentityId())}async getTokens(e){var n,a;return await((a=(n=this.authOptions)==null?void 0:n.tokenProvider)==null?void 0:a.getTokens(e))??void 0}}const d6=t=>new TextEncoder().encode(t);typeof Buffer<"u"&&Buffer.from;for(let t=0;t<256;t++){let e=t.toString(16).toLowerCase();e.length===1&&(e=`0${e}`)}var Zn;(function(t){t.WebUnknown="0",t.React="1",t.NextJs="2",t.Angular="3",t.VueJs="4",t.Nuxt="5",t.Svelte="6",t.ServerSideUnknown="100",t.ReactSSR="101",t.NextJsSSR="102",t.AngularSSR="103",t.VueJsSSR="104",t.NuxtSSR="105",t.SvelteSSR="106",t.ReactNative="201",t.Expo="202"})(Zn||(Zn={}));var bk;(function(t){t.API="api",t.Auth="auth",t.Analytics="analytics",t.DataStore="datastore",t.Geo="geo",t.InAppMessaging="inappmessaging",t.Interactions="interactions",t.Predictions="predictions",t.PubSub="pubsub",t.PushNotification="pushnotification",t.Storage="storage"})(bk||(bk={}));var wk;(function(t){t.Record="1",t.IdentifyUser="2"})(wk||(wk={}));var Ek;(function(t){t.GraphQl="1",t.Get="2",t.Post="3",t.Put="4",t.Patch="5",t.Del="6",t.Head="7"})(Ek||(Ek={}));var Sk;(function(t){t.SignUp="1",t.ConfirmSignUp="2",t.ResendSignUpCode="3",t.SignIn="4",t.FetchMFAPreference="6",t.UpdateMFAPreference="7",t.SetUpTOTP="10",t.VerifyTOTPSetup="11",t.ConfirmSignIn="12",t.DeleteUserAttributes="15",t.DeleteUser="16",t.UpdateUserAttributes="17",t.FetchUserAttributes="18",t.ConfirmUserAttribute="22",t.SignOut="26",t.UpdatePassword="27",t.ResetPassword="28",t.ConfirmResetPassword="29",t.FederatedSignIn="30",t.RememberDevice="32",t.ForgetDevice="33",t.FetchDevices="34",t.SendUserAttributeVerificationCode="35",t.SignInWithRedirect="36"})(Sk||(Sk={}));var Tk;(function(t){t.Subscribe="1",t.GraphQl="2"})(Tk||(Tk={}));var Ak;(function(t){t.SearchByText="0",t.SearchByCoordinates="1",t.SearchForSuggestions="2",t.SearchByPlaceId="3",t.SaveGeofences="4",t.GetGeofence="5",t.ListGeofences="6",t.DeleteGeofences="7"})(Ak||(Ak={}));var Ik;(function(t){t.SyncMessages="1",t.IdentifyUser="2",t.NotifyMessageInteraction="3"})(Ik||(Ik={}));var Ck;(function(t){t.None="0"})(Ck||(Ck={}));var kk;(function(t){t.Convert="1",t.Identify="2",t.Interpret="3"})(kk||(kk={}));var Pk;(function(t){t.Subscribe="1"})(Pk||(Pk={}));var Dk;(function(t){t.InitializePushNotifications="1",t.IdentifyUser="2"})(Dk||(Dk={}));var Mk;(function(t){t.UploadData="1",t.DownloadData="2",t.List="3",t.Copy="4",t.Remove="5",t.GetProperties="6",t.GetUrl="7"})(Mk||(Mk={}));const J_=()=>typeof global<"u",Fd=()=>typeof window<"u",oR=()=>typeof document<"u",HS=()=>typeof process<"u",Dm=(t,e)=>!!Object.keys(t).find(n=>n.startsWith(e));function p6(){const t=a=>a.startsWith("_react")||a.startsWith("__react"),e=a=>Object.keys(a).find(t),n=()=>Array.from(document.querySelectorAll("[id]"));return oR()&&n().some(e)}function f6(){return HS()&&typeof process.env<"u"&&!!Object.keys(process.env).find(t=>t.includes("react"))}function m6(){return Fd()&&Dm(window,"__VUE")}function g6(){return J_()&&Dm(global,"__VUE")}function y6(){return Fd()&&Dm(window,"__SVELTE")}function _6(){return HS()&&typeof process.env<"u"&&!!Object.keys(process.env).find(t=>t.includes("svelte"))}function v6(){return Fd()&&window.next&&typeof window.next=="object"}function x6(){return J_()&&(Dm(global,"__next")||Dm(global,"__NEXT"))}function b6(){return Fd()&&(window.__NUXT__!==void 0||window.$nuxt!==void 0)}function w6(){return J_()&&typeof global.__NUXT_PATHS__<"u"}function E6(){const t=!!(oR()&&document.querySelector("[ng-version]")),e=!!(Fd()&&typeof window.ng<"u");return t||e}function S6(){var t;return HS()&&typeof process.env=="object"&&((t={}.npm_lifecycle_script)==null?void 0:t.startsWith("ng "))||!1}function T6(){return typeof navigator<"u"&&typeof navigator.product<"u"&&navigator.product==="ReactNative"}function A6(){return J_()&&typeof global.expo<"u"}function I6(){return Fd()}const C6=[{platform:Zn.Expo,detectionMethod:A6},{platform:Zn.ReactNative,detectionMethod:T6},{platform:Zn.NextJs,detectionMethod:v6},{platform:Zn.Nuxt,detectionMethod:b6},{platform:Zn.Angular,detectionMethod:E6},{platform:Zn.React,detectionMethod:p6},{platform:Zn.VueJs,detectionMethod:m6},{platform:Zn.Svelte,detectionMethod:y6},{platform:Zn.WebUnknown,detectionMethod:I6},{platform:Zn.NextJsSSR,detectionMethod:x6},{platform:Zn.NuxtSSR,detectionMethod:w6},{platform:Zn.ReactSSR,detectionMethod:f6},{platform:Zn.VueJsSSR,detectionMethod:g6},{platform:Zn.AngularSSR,detectionMethod:S6},{platform:Zn.SvelteSSR,detectionMethod:_6}];function k6(){var t;return((t=C6.find(e=>e.detectionMethod()))==null?void 0:t.platform)||Zn.ServerSideUnknown}const P6=()=>typeof window<"u"&&typeof window.document<"u";class D6{constructor(){this.oAuthListener=void 0,this.resourcesConfig={},this.libraryOptions={},this.Auth=new h6}configure(e,n){const a=iR(e);this.resourcesConfig=a,n&&(this.libraryOptions=n),this.resourcesConfig=nR(this.resourcesConfig),this.Auth.configure(this.resourcesConfig.Auth,this.libraryOptions.Auth),CE.dispatch("core",{event:"configure",data:this.resourcesConfig},"Configure",S_),this.notifyOAuthListener()}getConfig(){return this.resourcesConfig}[Y8](e){var n,a,u;(a=(n=this.resourcesConfig.Auth)==null?void 0:n.Cognito.loginWith)!=null&&a.oauth?e((u=this.resourcesConfig.Auth)==null?void 0:u.Cognito):this.oAuthListener=e}notifyOAuthListener(){var e,n,a;!((n=(e=this.resourcesConfig.Auth)==null?void 0:e.Cognito.loginWith)!=null&&n.oauth)||!this.oAuthListener||(this.oAuthListener((a=this.resourcesConfig.Auth)==null?void 0:a.Cognito),this.oAuthListener=void 0)}}const Js=new D6,ev=t=>{const{headers:e,statusCode:n}=t;return{...M6(t)?t.$metadata:{},httpStatusCode:n,requestId:e["x-amzn-requestid"]??e["x-amzn-request-id"]??e["x-amz-request-id"],extendedRequestId:e["x-amz-id-2"],cfId:e["x-amz-cf-id"]}},M6=t=>typeof(t==null?void 0:t.$metadata)=="object",Um=async t=>{if(!t||t.statusCode<300)return;const e=await tv(t),a=(_=>{const[l]=_.toString().split(/[,:]+/);return l.includes("#")?l.split("#")[1]:l})(t.headers["x-amzn-errortype"]??e.code??e.__type??"UnknownError"),u=e.message??e.Message??"Unknown error",d=new Error(u);return Object.assign(d,{name:a,$metadata:ev(t)})},tv=async t=>{if(!t.body)throw new Error("Missing response payload");const e=await t.body.json();return Object.assign(e,{$metadata:ev(t)})},qS=(t,e,n,a)=>async(u,d)=>{const _={...a,...u},l=await _.endpointResolver(_,d),w=await e(d,l),T=await t(w,{..._});return n(T)},aR={id:"aws",outputs:{dnsSuffix:"amazonaws.com"},regionRegex:"^(us|eu|ap|sa|ca|me|af)\\-\\w+\\-\\d+$",regions:["aws-global"]},z6={partitions:[aR,{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn"},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:["aws-cn-global"]}]},sR=t=>{const{partitions:e}=z6;for(const{regions:n,outputs:a,regionRegex:u}of e){const d=new RegExp(u);if(n.includes(t)||d.test(t))return a.dnsSuffix}return aR.outputs.dnsSuffix},R6=3,O6=({maxAttempts:t=R6,retryDecider:e,computeDelay:n,abortSignal:a})=>{if(t<1)throw new Error("maxAttempts must be greater than 0");return(u,d)=>async function(l){let w,T=d.attemptsCount??0,C;const P=()=>{if(C)return zk(C,T),C;throw zk(w,T),w};for(;!(a!=null&&a.aborted)&&T<t;){try{C=await u(l),w=void 0}catch(z){w=z,C=void 0}if(T=(d.attemptsCount??0)>T?d.attemptsCount??0:T+1,d.attemptsCount=T,await e(C,w)){if(!(a!=null&&a.aborted)&&T<t){const z=n(T);await F6(z,a)}continue}else return P()}if(a!=null&&a.aborted)throw new Error("Request aborted.");return P()}},F6=(t,e)=>{if(e!=null&&e.aborted)return Promise.resolve();let n,a;const u=new Promise(d=>{a=d,n=setTimeout(d,t)});return e==null||e.addEventListener("abort",function d(_){clearTimeout(n),e==null||e.removeEventListener("abort",d),a()}),u},zk=(t,e)=>{Object.prototype.toString.call(t)==="[object Object]"&&(t.$metadata={...t.$metadata??{},attempts:e})},L6=({userAgentHeader:t="x-amz-user-agent",userAgentValue:e=""})=>n=>async function(u){if(e.trim().length===0)return await n(u);{const d=t.toLowerCase();return u.headers[d]=u.headers[d]?`${u.headers[d]} ${e}`:e,await n(u)}},ZS=(t,e)=>(n,a)=>{const u={};let d=_=>t(_,a);for(let _=e.length-1;_>=0;_--){const l=e[_];d=l(a)(d,u)}return d(n)},rb=t=>{let e;return()=>(e||(e=t()),e)},B6=t=>!["HEAD","GET","DELETE"].includes(t.toUpperCase()),N6=async({url:t,method:e,headers:n,body:a},{abortSignal:u,cache:d,withCrossDomainCredentials:_})=>{var P;let l;try{l=await fetch(t,{method:e,headers:n,body:B6(e)?a:void 0,signal:u,cache:d,credentials:_?"include":"same-origin"})}catch(z){throw z instanceof TypeError?new Is({name:km.NetworkError,message:"A network error has occurred.",underlyingError:z}):z}const w={};(P=l.headers)==null||P.forEach((z,$)=>{w[$.toLowerCase()]=z});const T={statusCode:l.status,headers:w,body:null},C=Object.assign(l.body??{},{text:rb(()=>l.text()),blob:rb(()=>l.blob()),json:rb(()=>l.json())});return{...T,body:C}},lR=ZS(N6,[L6,O6]),U6=5*60*1e3;function j6(t=U6){return a=>{const u=2**a*100+100*Math.random();return u>t?!1:u}}const Rk=5*60*1e3,cR=t=>{const n=j6(Rk)(t);return n===!1?Rk:n},V6=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch","BadRequestException"],$6=t=>!!t&&V6.includes(t),uR=t=>async(e,n)=>{const a=n??await t(e)??void 0,u=(a==null?void 0:a.code)||(a==null?void 0:a.name),d=e==null?void 0:e.statusCode;return q6(n)||H6(d,u)||$6(u)||Z6(d,u)},W6=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException"],G6=["TimeoutError","RequestTimeout","RequestTimeoutException"],H6=(t,e)=>t===429||!!e&&W6.includes(e),q6=t=>(t==null?void 0:t.name)==="Network error",Z6=(t,e)=>!!t&&[500,502,503,504].includes(t)||!!e&&G6.includes(e),kE=URL,K6="6.6.0";let um;const qy=[];let T_=!1;const X6=10,Y6=10,Q6=1e3,hR=()=>{var t;if(!um){if(um=k6(),T_)for(;qy.length;)(t=qy.pop())==null||t();else qy.forEach(e=>{e()});Ok(Zn.ServerSideUnknown,X6),Ok(Zn.WebUnknown,Y6)}return um},J6=t=>{T_||qy.push(t)};function eN(){um=void 0}function Ok(t,e){um===t&&!T_&&setTimeout(()=>{eN(),T_=!0,setTimeout(hR,Q6)},e)}const tN={},rN=(t,e)=>{var n,a;return(a=(n=tN[t])==null?void 0:n[e])==null?void 0:a.additionalDetails},nN="aws-amplify",iN=({category:t,action:e}={})=>{const n=[[nN,K6]];if(t&&n.push([t,e]),n.push(["framework",hR()]),t&&e){const a=rN(t,e);a&&a.forEach(u=>{n.push(u)})}return n},KS=t=>iN(t).map(([a,u])=>a&&u?`${a}/${u}`:a).join(" "),oN="cognito-identity",aN=({region:t})=>({url:new kE(`https://cognito-identity.${t}.${sR(t)}`)}),sN=()=>t=>async function(n){return n.headers["cache-control"]="no-store",t(n)},dR=ZS(lR,[sN]),XS={service:oN,endpointResolver:aN,retryDecider:uR(Um),computeDelay:cR,userAgentValue:KS(),cache:"no-store"};J6(()=>{XS.userAgentValue=KS()});const pR=t=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityService.${t}`}),fR=({url:t},e,n)=>({headers:e,url:t,body:n,method:"POST"}),lN=(t,e)=>{const n=pR("GetId"),a=JSON.stringify(t);return fR(e,n,a)},cN=async t=>{if(t.statusCode>=300)throw await Um(t);return{IdentityId:(await tv(t)).IdentityId,$metadata:ev(t)}},uN=qS(dR,lN,cN,XS),hN=(t,e)=>{const n=pR("GetCredentialsForIdentity"),a=JSON.stringify(t);return fR(e,n,a)},dN=async t=>{if(t.statusCode>=300)throw await Um(t);{const e=await tv(t);return{IdentityId:e.IdentityId,Credentials:pN(e.Credentials),$metadata:ev(t)}}},pN=({AccessKeyId:t,SecretKey:e,SessionToken:n,Expiration:a}={})=>({AccessKeyId:t,SecretKey:e,SessionToken:n,Expiration:a&&new Date(a*1e3)}),Fk=qS(dR,hN,dN,XS);class $g extends Is{constructor(){super({name:km.PlatformNotSupported,message:"Function not supported on current platform"})}}class mR{constructor(e){this.storage=e}async setItem(e,n){if(!this.storage)throw new $g;this.storage.setItem(e,n)}async getItem(e){if(!this.storage)throw new $g;return this.storage.getItem(e)}async removeItem(e){if(!this.storage)throw new $g;this.storage.removeItem(e)}async clear(){if(!this.storage)throw new $g;this.storage.clear()}}class gR{constructor(){this.storage=new Map}get length(){return this.storage.size}key(e){return e>this.length-1?null:Array.from(this.storage.keys())[e]}setItem(e,n){this.storage.set(e,n)}getItem(e){return this.storage.get(e)??null}removeItem(e){this.storage.delete(e)}clear(){this.storage.clear()}}const fN=()=>typeof window<"u"&&window.localStorage?window.localStorage:new gR,mN=()=>typeof window<"u"&&window.sessionStorage?window.sessionStorage:new gR;class gN extends mR{constructor(){super(fN())}}class yN extends mR{constructor(){super(mN())}}/*! js-cookie v3.0.5 | MIT */function Wg(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)t[a]=n[a]}return t}var _N={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function PE(t,e){function n(u,d,_){if(!(typeof document>"u")){_=Wg({},e,_),typeof _.expires=="number"&&(_.expires=new Date(Date.now()+_.expires*864e5)),_.expires&&(_.expires=_.expires.toUTCString()),u=encodeURIComponent(u).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var l="";for(var w in _)_[w]&&(l+="; "+w,_[w]!==!0&&(l+="="+_[w].split(";")[0]));return document.cookie=u+"="+t.write(d,u)+l}}function a(u){if(!(typeof document>"u"||arguments.length&&!u)){for(var d=document.cookie?document.cookie.split("; "):[],_={},l=0;l<d.length;l++){var w=d[l].split("="),T=w.slice(1).join("=");try{var C=decodeURIComponent(w[0]);if(_[C]=t.read(T,C),u===C)break}catch{}}return u?_[u]:_}}return Object.create({set:n,get:a,remove:function(u,d){n(u,"",Wg({},d,{expires:-1}))},withAttributes:function(u){return PE(this.converter,Wg({},this.attributes,u))},withConverter:function(u){return PE(Wg({},this.converter,u),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var Gg=PE(_N,{path:"/"});class Lk{constructor(e={}){const{path:n,domain:a,expires:u,sameSite:d,secure:_}=e;if(this.domain=a,this.path=n||"/",this.expires=Object.prototype.hasOwnProperty.call(e,"expires")?u:365,this.secure=Object.prototype.hasOwnProperty.call(e,"secure")?_:!0,Object.prototype.hasOwnProperty.call(e,"sameSite")){if(!d||!["strict","lax","none"].includes(d))throw new Error('The sameSite value of cookieStorage must be "lax", "strict" or "none".');if(d==="none"&&!this.secure)throw new Error("sameSite = None requires the Secure attribute in latest browser versions.");this.sameSite=d}}async setItem(e,n){Gg.set(e,n,this.getData())}async getItem(e){return Gg.get(e)??null}async removeItem(e){Gg.remove(e,this.getData())}async clear(){const e=Gg.get(),n=Object.keys(e).map(a=>this.removeItem(a));await Promise.all(n)}getData(){return{path:this.path,expires:this.expires,domain:this.domain,secure:this.secure,...this.sameSite&&{sameSite:this.sameSite}}}}const Mm=new gN;new yN;const vN=t=>{let e;return async(...n)=>e||(e=new Promise((a,u)=>{t(...n).then(d=>{a(d)}).catch(d=>{u(d)}).finally(()=>{e=void 0})}),e)};class Dn extends Is{constructor(e){super(e),this.constructor=Dn,Object.setPrototypeOf(this,Dn.prototype)}}function yR(t){if(!t||t.name==="Error"||t instanceof TypeError)throw new Dn({name:km.Unknown,message:"An unknown error has occurred.",underlyingError:t})}const _R="cognito-idp",xN=({region:t})=>{var u;const e=(u=Js.getConfig().Auth)==null?void 0:u.Cognito,n=e==null?void 0:e.userPoolEndpoint,a=new kE(`https://${_R}.${t}.${sR(t)}`);return{url:n?new kE(n):a}},bN=()=>(t,e)=>async function(a){return a.headers["cache-control"]="no-store",t(a)},wN=ZS(lR,[bN]),EN={service:_R,endpointResolver:xN,retryDecider:uR(Um),computeDelay:cR,userAgentValue:KS(),cache:"no-store"},SN=t=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityProviderService.${t}`}),TN=({url:t},e,n)=>({headers:e,url:t,body:n,method:"POST"}),AN=t=>(e,n)=>{const a=SN(t),u=JSON.stringify(e);return TN(n,a,u)},IN=()=>async t=>{if(t.statusCode>=300){const e=await Um(t);throw yR(e),new Dn({name:e.name,message:e.message})}else return await tv(t)},CN=qS(wN,AN("InitiateAuth"),IN(),EN);function kN(t){const e=t==null?void 0:t.split("_")[0];if(!t||t.indexOf("_")<0||!e||typeof e!="string")throw new Dn({name:"InvalidUserPoolId",message:"Invalid user pool id provided."});return e}function DE(t){if(!t||!t.includes(":"))throw new Dn({name:"InvalidIdentityPoolIdException",message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."});return t.split(":")[0]}const vR="UserUnAuthenticatedException",PN="InvalidRedirectException",DN="InvalidAppSchemeException",MN="InvalidPreferredRedirectUrlException";new Dn({name:PN,message:"signInRedirect or signOutRedirect had an invalid format or was not found.",recoverySuggestion:"Please make sure the signIn/Out redirect in your oauth config is valid."});new Dn({name:DN,message:"A valid non-http app scheme was not found in the config.",recoverySuggestion:"Please make sure a valid custom app scheme is present in the config."});new Dn({name:MN,message:"The given preferredRedirectUrl does not match any items in the redirectSignOutUrls array from the config.",recoverySuggestion:"Please make sure a matching preferredRedirectUrl is provided."});const zN="InvalidOriginException";new Dn({name:zN,message:"redirect is coming from a different origin. The oauth flow needs to be initiated from the same origin",recoverySuggestion:"Please call signInWithRedirect from the same origin."});const RN="TokenRefreshException";function ON(t){if(!t||!t.idToken)throw new Dn({name:vR,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."})}const FN=new Dn({name:RN,message:`Token refresh is not supported when authenticated with the 'implicit grant' (token) oauth flow. 
	Please change your oauth configuration to use 'code grant' flow.`,recoverySuggestion:`Please logout and change your Amplify configuration to use "code grant" flow. 
	E.g { responseType: 'code' }`}),LN=new Dn({name:vR,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."});function BN(t){if(jN(t))throw FN;if(!UN(t))throw LN}const NN={inflightOAuth:"inflightOAuth",oauthSignIn:"oauthSignIn",oauthPKCE:"oauthPKCE",oauthState:"oauthState"};function xR(t){return(t==null?void 0:t.accessToken)||(t==null?void 0:t.idToken)}function UN(t){return xR(t)&&(t==null?void 0:t.refreshToken)}function jN(t){return xR(t)&&!(t!=null&&t.refreshToken)}function VN({username:t,userPoolId:e,userPoolClientId:n}){if(typeof window>"u")return;const a=window.AmazonCognitoAdvancedSecurityData;if(typeof a>"u")return;const u=a.getData(t,e,n);return u?{EncodedData:u}:{}}const $N=async({tokens:t,authConfig:e,username:n})=>{var z,$;po(e==null?void 0:e.Cognito);const a=kN(e.Cognito.userPoolId);BN(t);const u=t.refreshToken,d={REFRESH_TOKEN:u};(z=t.deviceMetadata)!=null&&z.deviceKey&&(d.DEVICE_KEY=t.deviceMetadata.deviceKey);const _=VN({username:n,userPoolId:e.Cognito.userPoolId,userPoolClientId:e.Cognito.userPoolClientId}),{AuthenticationResult:l}=await CN({region:a},{ClientId:($=e==null?void 0:e.Cognito)==null?void 0:$.userPoolClientId,AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:d,UserContextData:_}),w=Pm((l==null?void 0:l.AccessToken)??""),T=l!=null&&l.IdToken?Pm(l.IdToken):void 0,{iat:C}=w.payload;if(!C)throw new Dn({name:"iatNotFoundException",message:"iat not found in access token"});const P=C*1e3-new Date().getTime();return{accessToken:w,idToken:T,clockDrift:P,refreshToken:u,username:n}},WN=vN($N),GN={accessToken:"accessToken",idToken:"idToken",oidcProvider:"oidcProvider",clockDrift:"clockDrift",refreshToken:"refreshToken",deviceKey:"deviceKey",randomPasswordKey:"randomPasswordKey",deviceGroupKey:"deviceGroupKey",signInDetails:"signInDetails",oauthMetadata:"oauthMetadata"};var A_;(function(t){t.InvalidAuthTokens="InvalidAuthTokens"})(A_||(A_={}));const HN={[A_.InvalidAuthTokens]:{message:"Invalid tokens.",recoverySuggestion:"Make sure the tokens are valid."}},qN=tR(HN);class ZN{constructor(){this.name="CognitoIdentityServiceProvider"}getKeyValueStorage(){if(!this.keyValueStorage)throw new Dn({name:"KeyValueStorageNotFoundException",message:"KeyValueStorage was not found in TokenStore"});return this.keyValueStorage}setKeyValueStorage(e){this.keyValueStorage=e}setAuthConfig(e){this.authConfig=e}async loadTokens(){try{const e=await this.getAuthKeys(),n=await this.getKeyValueStorage().getItem(e.accessToken);if(!n)throw new Dn({name:"NoSessionFoundException",message:"Auth session was not found. Make sure to call signIn."});const a=Pm(n),u=await this.getKeyValueStorage().getItem(e.idToken),d=u?Pm(u):void 0,_=await this.getKeyValueStorage().getItem(e.refreshToken)??void 0,l=await this.getKeyValueStorage().getItem(e.clockDrift)??"0",w=Number.parseInt(l),T=await this.getKeyValueStorage().getItem(e.signInDetails),C={accessToken:a,idToken:d,refreshToken:_,deviceMetadata:await this.getDeviceMetadata()??void 0,clockDrift:w,username:await this.getLastAuthUser()};return T&&(C.signInDetails=JSON.parse(T)),C}catch{return null}}async storeTokens(e){qN(e!==void 0,A_.InvalidAuthTokens),await this.clearTokens();const n=e.username;await this.getKeyValueStorage().setItem(this.getLastAuthUserKey(),n);const a=await this.getAuthKeys();await this.getKeyValueStorage().setItem(a.accessToken,e.accessToken.toString()),e.idToken&&await this.getKeyValueStorage().setItem(a.idToken,e.idToken.toString()),e.refreshToken&&await this.getKeyValueStorage().setItem(a.refreshToken,e.refreshToken),e.deviceMetadata&&(e.deviceMetadata.deviceKey&&await this.getKeyValueStorage().setItem(a.deviceKey,e.deviceMetadata.deviceKey),e.deviceMetadata.deviceGroupKey&&await this.getKeyValueStorage().setItem(a.deviceGroupKey,e.deviceMetadata.deviceGroupKey),await this.getKeyValueStorage().setItem(a.randomPasswordKey,e.deviceMetadata.randomPassword)),e.signInDetails&&await this.getKeyValueStorage().setItem(a.signInDetails,JSON.stringify(e.signInDetails)),await this.getKeyValueStorage().setItem(a.clockDrift,`${e.clockDrift}`)}async clearTokens(){const e=await this.getAuthKeys();await Promise.all([this.getKeyValueStorage().removeItem(e.accessToken),this.getKeyValueStorage().removeItem(e.idToken),this.getKeyValueStorage().removeItem(e.clockDrift),this.getKeyValueStorage().removeItem(e.refreshToken),this.getKeyValueStorage().removeItem(e.signInDetails),this.getKeyValueStorage().removeItem(this.getLastAuthUserKey()),this.getKeyValueStorage().removeItem(e.oauthMetadata)])}async getDeviceMetadata(e){const n=await this.getAuthKeys(e),a=await this.getKeyValueStorage().getItem(n.deviceKey),u=await this.getKeyValueStorage().getItem(n.deviceGroupKey),d=await this.getKeyValueStorage().getItem(n.randomPasswordKey);return d&&u&&a?{deviceKey:a,deviceGroupKey:u,randomPassword:d}:null}async clearDeviceMetadata(e){const n=await this.getAuthKeys(e);await Promise.all([this.getKeyValueStorage().removeItem(n.deviceKey),this.getKeyValueStorage().removeItem(n.deviceGroupKey),this.getKeyValueStorage().removeItem(n.randomPasswordKey)])}async getAuthKeys(e){var a;po((a=this.authConfig)==null?void 0:a.Cognito);const n=e??await this.getLastAuthUser();return KN(this.name,`${this.authConfig.Cognito.userPoolClientId}.${n}`)}getLastAuthUserKey(){var n;po((n=this.authConfig)==null?void 0:n.Cognito);const e=this.authConfig.Cognito.userPoolClientId;return`${this.name}.${e}.LastAuthUser`}async getLastAuthUser(){return await this.getKeyValueStorage().getItem(this.getLastAuthUserKey())??"username"}async setOAuthMetadata(e){const{oauthMetadata:n}=await this.getAuthKeys();await this.getKeyValueStorage().setItem(n,JSON.stringify(e))}async getOAuthMetadata(){const{oauthMetadata:e}=await this.getAuthKeys(),n=await this.getKeyValueStorage().getItem(e);return n&&JSON.parse(n)}}const KN=(t,e)=>YS(GN)(`${t}`,e);function YS(t){const e=Object.values({...t});return(n,a)=>e.reduce((u,d)=>({...u,[d]:`${n}.${a}.${d}`}),{})}const Bk="amplify-signin-with-hostedUI",ds="CognitoIdentityServiceProvider";class XN{constructor(e){this.keyValueStorage=e}async clearOAuthInflightData(){po(this.cognitoConfig);const e=ps(ds,this.cognitoConfig.userPoolClientId);await Promise.all([this.keyValueStorage.removeItem(e.inflightOAuth),this.keyValueStorage.removeItem(e.oauthPKCE),this.keyValueStorage.removeItem(e.oauthState)])}async clearOAuthData(){po(this.cognitoConfig);const e=ps(ds,this.cognitoConfig.userPoolClientId);return await this.clearOAuthInflightData(),await this.keyValueStorage.removeItem(Bk),this.keyValueStorage.removeItem(e.oauthSignIn)}loadOAuthState(){po(this.cognitoConfig);const e=ps(ds,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(e.oauthState)}storeOAuthState(e){po(this.cognitoConfig);const n=ps(ds,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(n.oauthState,e)}loadPKCE(){po(this.cognitoConfig);const e=ps(ds,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(e.oauthPKCE)}storePKCE(e){po(this.cognitoConfig);const n=ps(ds,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(n.oauthPKCE,e)}setAuthConfig(e){this.cognitoConfig=e}async loadOAuthInFlight(){po(this.cognitoConfig);const e=ps(ds,this.cognitoConfig.userPoolClientId);return await this.keyValueStorage.getItem(e.inflightOAuth)==="true"}async storeOAuthInFlight(e){po(this.cognitoConfig);const n=ps(ds,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(n.inflightOAuth,`${e}`)}async loadOAuthSignIn(){var d;po(this.cognitoConfig);const e=ps(ds,this.cognitoConfig.userPoolClientId),n=await this.keyValueStorage.getItem(Bk),[a,u]=((d=await this.keyValueStorage.getItem(e.oauthSignIn))==null?void 0:d.split(","))??[];return{isOAuthSignIn:a==="true"||n==="true",preferPrivateSession:u==="true"}}async storeOAuthSignIn(e,n=!1){po(this.cognitoConfig);const a=ps(ds,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(a.oauthSignIn,`${e},${n}`)}}const ps=(t,e)=>YS(NN)(t,e),Nk=new XN(Mm),YN=[],QN=t=>{YN.push(t)};class JN{constructor(){this.waitForInflightOAuth=P6()?async()=>{if(await Nk.loadOAuthInFlight())return this.inflightPromise?this.inflightPromise:(this.inflightPromise=new Promise((e,n)=>{QN(e)}),this.inflightPromise)}:async()=>{}}setAuthConfig(e){Nk.setAuthConfig(e.Cognito),this.authConfig=e}setTokenRefresher(e){this.tokenRefresher=e}setAuthTokenStore(e){this.tokenStore=e}getTokenStore(){if(!this.tokenStore)throw new Dn({name:"EmptyTokenStoreException",message:"TokenStore not set"});return this.tokenStore}getTokenRefresher(){if(!this.tokenRefresher)throw new Dn({name:"EmptyTokenRefresherException",message:"TokenRefresher not set"});return this.tokenRefresher}async getTokens(e){var _,l,w,T,C;let n;try{po((_=this.authConfig)==null?void 0:_.Cognito)}catch{return null}await this.waitForInflightOAuth(),this.inflightPromise=void 0,n=await this.getTokenStore().loadTokens();const a=await this.getTokenStore().getLastAuthUser();if(n===null)return null;const u=!!(n!=null&&n.idToken)&&xk({expiresAt:(((w=(l=n.idToken)==null?void 0:l.payload)==null?void 0:w.exp)??0)*1e3,clockDrift:n.clockDrift??0}),d=xk({expiresAt:(((C=(T=n.accessToken)==null?void 0:T.payload)==null?void 0:C.exp)??0)*1e3,clockDrift:n.clockDrift??0});return(e!=null&&e.forceRefresh||u||d)&&(n=await this.refreshTokens({tokens:n,username:a}),n===null)?null:{accessToken:n==null?void 0:n.accessToken,idToken:n==null?void 0:n.idToken,signInDetails:n==null?void 0:n.signInDetails}}async refreshTokens({tokens:e,username:n}){try{const{signInDetails:a}=e,u=await this.getTokenRefresher()({tokens:e,authConfig:this.authConfig,username:n});return u.signInDetails=a,await this.setTokens({tokens:u}),CE.dispatch("auth",{event:"tokenRefresh"},"Auth",S_),u}catch(a){return this.handleErrors(a)}}handleErrors(e){if(yR(e),e.message!=="Network error"&&this.clearTokens(),CE.dispatch("auth",{event:"tokenRefresh_failure",data:{error:e}},"Auth",S_),e.name.startsWith("NotAuthorizedException"))return null;throw e}async setTokens({tokens:e}){return this.getTokenStore().storeTokens(e)}async clearTokens(){return this.getTokenStore().clearTokens()}getDeviceMetadata(e){return this.getTokenStore().getDeviceMetadata(e)}clearDeviceMetadata(e){return this.getTokenStore().clearDeviceMetadata(e)}setOAuthMetadata(e){return this.getTokenStore().setOAuthMetadata(e)}getOAuthMetadata(){return this.getTokenStore().getOAuthMetadata()}}class eU{constructor(){this.authTokenStore=new ZN,this.authTokenStore.setKeyValueStorage(Mm),this.tokenOrchestrator=new JN,this.tokenOrchestrator.setAuthTokenStore(this.authTokenStore),this.tokenOrchestrator.setTokenRefresher(WN)}getTokens({forceRefresh:e}={forceRefresh:!1}){return this.tokenOrchestrator.getTokens({forceRefresh:e})}setKeyValueStorage(e){this.authTokenStore.setKeyValueStorage(e)}setAuthConfig(e){this.authTokenStore.setAuthConfig(e),this.tokenOrchestrator.setAuthConfig(e)}}const Hg=new eU,tU={identityId:"identityId"},rU=new Ha("DefaultIdentityIdStore");class nU{setAuthConfig(e){Hy(e.Cognito),this.authConfig=e,this._authKeys=iU("Cognito",e.Cognito.identityPoolId)}constructor(e){this._authKeys={},this.keyValueStorage=e}async loadIdentityId(){var e;Hy((e=this.authConfig)==null?void 0:e.Cognito);try{if(this._primaryIdentityId)return{id:this._primaryIdentityId,type:"primary"};{const n=await this.keyValueStorage.getItem(this._authKeys.identityId);return n?{id:n,type:"guest"}:null}}catch(n){return rU.log("Error getting stored IdentityId.",n),null}}async storeIdentityId(e){var n;Hy((n=this.authConfig)==null?void 0:n.Cognito),e.type==="guest"?(this.keyValueStorage.setItem(this._authKeys.identityId,e.id),this._primaryIdentityId=void 0):(this._primaryIdentityId=e.id,this.keyValueStorage.removeItem(this._authKeys.identityId))}async clearIdentityId(){this._primaryIdentityId=void 0,await this.keyValueStorage.removeItem(this._authKeys.identityId)}}const iU=(t,e)=>YS(tU)(`com.amplify.${t}`,e);function bR(t){const e=Pm(t).payload.iss,n={};if(!e)throw new Dn({name:"InvalidIdTokenException",message:"Invalid Idtoken."});const a=e.replace(/(^\w+:|^)\/\//,"");return n[a]=t,n}const oU=new Ha("CognitoIdentityIdProvider");async function aU({tokens:t,authConfig:e,identityIdStore:n}){n.setAuthConfig({Cognito:e});let a=await n.loadIdentityId();if(t){if(a&&a.type==="primary")return a.id;{const u=t.idToken?bR(t.idToken.toString()):{},d=await Uk(u,e);a&&a.id===d&&oU.debug(`The guest identity ${a.id} has become the primary identity.`),a={id:d,type:"primary"}}}else{if(a&&a.type==="guest")return a.id;a={id:await Uk({},e),type:"guest"}}return n.storeIdentityId(a),a.id}async function Uk(t,e){const n=e==null?void 0:e.identityPoolId,a=DE(n),u=(await uN({region:a},{IdentityPoolId:n,Logins:t})).IdentityId;if(!u)throw new Dn({name:"GetIdResponseException",message:"Received undefined response from getId operation",recoverySuggestion:"Make sure to pass a valid identityPoolId in the configuration."});return u}const qg=new Ha("CognitoCredentialsProvider"),jk=50*60*1e3;class sU{constructor(e){this._nextCredentialsRefresh=0,this._identityIdStore=e}async clearCredentialsAndIdentityId(){qg.debug("Clearing out credentials and identityId"),this._credentialsAndIdentityId=void 0,await this._identityIdStore.clearIdentityId()}async clearCredentials(){qg.debug("Clearing out in-memory credentials"),this._credentialsAndIdentityId=void 0}async getCredentialsAndIdentityId(e){const n=e.authenticated,{tokens:a}=e,{authConfig:u}=e;try{Hy(u==null?void 0:u.Cognito)}catch{return}if(!n&&!u.Cognito.allowGuestAccess)return;const{forceRefresh:d}=e,_=this.hasTokenChanged(a),l=await aU({tokens:a,authConfig:u.Cognito,identityIdStore:this._identityIdStore});return(d||_)&&this.clearCredentials(),n?(ON(a),this.credsForOIDCTokens(u.Cognito,a,l)):this.getGuestCredentials(l,u.Cognito)}async getGuestCredentials(e,n){if(this._credentialsAndIdentityId&&!this.isPastTTL()&&this._credentialsAndIdentityId.isAuthenticatedCreds===!1)return qg.info("returning stored credentials as they neither past TTL nor expired."),this._credentialsAndIdentityId;this.clearCredentials();const a=DE(n.identityPoolId),u=await Fk({region:a},{IdentityId:e});if(u.Credentials&&u.Credentials.AccessKeyId&&u.Credentials.SecretKey){this._nextCredentialsRefresh=new Date().getTime()+jk;const d={credentials:{accessKeyId:u.Credentials.AccessKeyId,secretAccessKey:u.Credentials.SecretKey,sessionToken:u.Credentials.SessionToken,expiration:u.Credentials.Expiration},identityId:e},_=u.IdentityId;return _&&(d.identityId=_,this._identityIdStore.storeIdentityId({id:_,type:"guest"})),this._credentialsAndIdentityId={...d,isAuthenticatedCreds:!1},d}else throw new Dn({name:"CredentialsNotFoundException",message:"Cognito did not respond with either Credentials, AccessKeyId or SecretKey."})}async credsForOIDCTokens(e,n,a){var l;if(this._credentialsAndIdentityId&&!this.isPastTTL()&&this._credentialsAndIdentityId.isAuthenticatedCreds===!0)return qg.debug("returning stored credentials as they neither past TTL nor expired."),this._credentialsAndIdentityId;this.clearCredentials();const u=n.idToken?bR(n.idToken.toString()):{},d=DE(e.identityPoolId),_=await Fk({region:d},{IdentityId:a,Logins:u});if(_.Credentials&&_.Credentials.AccessKeyId&&_.Credentials.SecretKey){const w={credentials:{accessKeyId:_.Credentials.AccessKeyId,secretAccessKey:_.Credentials.SecretKey,sessionToken:_.Credentials.SessionToken,expiration:_.Credentials.Expiration},identityId:a};this._credentialsAndIdentityId={...w,isAuthenticatedCreds:!0,associatedIdToken:(l=n.idToken)==null?void 0:l.toString()},this._nextCredentialsRefresh=new Date().getTime()+jk;const T=_.IdentityId;return T&&(w.identityId=T,this._identityIdStore.storeIdentityId({id:T,type:"primary"})),w}else throw new Dn({name:"CredentialsException",message:"Cognito did not respond with either Credentials, AccessKeyId or SecretKey."})}isPastTTL(){return this._nextCredentialsRefresh===void 0?!0:this._nextCredentialsRefresh<=Date.now()}hasTokenChanged(e){var n,a;return!!e&&!!((n=this._credentialsAndIdentityId)!=null&&n.associatedIdToken)&&((a=e.idToken)==null?void 0:a.toString())!==this._credentialsAndIdentityId.associatedIdToken}}const lU=new sU(new nU(Mm)),cU={configure(t,e){const n=iR(t);if(!n.Auth){Js.configure(n,e);return}if(e!=null&&e.Auth){Js.configure(n,e);return}if(!Js.libraryOptions.Auth){Hg.setAuthConfig(n.Auth),Hg.setKeyValueStorage(e!=null&&e.ssr?new Lk({sameSite:"lax"}):Mm),Js.configure(n,{...e,Auth:{tokenProvider:Hg,credentialsProvider:lU}});return}if(e){e.ssr!==void 0&&Hg.setKeyValueStorage(e.ssr?new Lk({sameSite:"lax"}):Mm),Js.configure(n,{Auth:Js.libraryOptions.Auth,...e});return}Js.configure(n)},getConfig(){return Js.getConfig()}};/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */var uU={oauth:{domain:"authcori.auth.us-east-1.amazoncognito.com"}},hU="us-east-1",dU="us-east-1_QeA4600FA",pU="5eusi16g0o2q1g1rr5ehgudodm",fU="authcori.auth.us-east-1.amazoncognito.com",mU="us-east-1",gU="us-east-1:2194a76a-fa3d-4c33-999e-e3c4b2b049ee",yU=["EMAIL"],_U=["EMAIL","OPENID"],vU=["EMAIL","OPENID"],xU={passwordPolicyMinLength:8,passwordPolicyCharacters:["REQUIRES_NUMBERS","REQUIRES_LOWERCASE","REQUIRES_UPPERCASE","REQUIRES_SYMBOLS"]},bU="https://bdkxhfgus5dztobic7gvn5ymue.appsync-api.us-east-1.amazonaws.com/graphql",wU="us-east-1",EU="da2-yexc3mow25fc3amaendi4vscuq",SU="API_KEY",TU="AMAZON_COGNITO_USER_POOLS,AWS_IAM",AU={version:1,models:{Todo:{name:"Todo",fields:{id:{name:"id",isArray:!1,type:"ID",isRequired:!0,attributes:[]},content:{name:"content",isArray:!1,type:"String",isRequired:!1,attributes:[]},owner:{name:"owner",isArray:!1,type:"String",isRequired:!1,attributes:[]},createdAt:{name:"createdAt",isArray:!1,type:"AWSDateTime",isRequired:!0,attributes:[]},updatedAt:{name:"updatedAt",isArray:!1,type:"AWSDateTime",isRequired:!0,attributes:[]}},syncable:!0,pluralName:"Todos",attributes:[{type:"model",properties:{}},{type:"key",properties:{fields:["id"]}},{type:"auth",properties:{rules:[{provider:"userPools",ownerField:"owner",allow:"owner",identityClaim:"cognito:username",operations:["create","update","delete","read"]},{allow:"public",operations:["read"]}]}}],primaryKeyInfo:{isCustomPrimaryKey:!1,primaryKeyFieldName:"id",sortKeyFieldNames:[]}}},enums:{},nonModels:{}},IU={Auth:uU,aws_project_region:hU,aws_user_pools_id:dU,aws_user_pools_web_client_id:pU,aws_cognito_domain:fU,aws_cognito_region:mU,aws_cognito_identity_pool_id:gU,aws_cognito_signup_attributes:yU,aws_cognito_username_attributes:_U,aws_cognito_verification_mechanisms:vU,aws_cognito_password_protection_settings:xU,aws_appsync_graphqlEndpoint:bU,aws_appsync_region:wU,aws_appsync_apiKey:EU,aws_appsync_authenticationType:SU,aws_appsync_additionalAuthenticationTypes:TU,modelIntrospection:AU};/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */cU.configure(IU);const CU={domain:void 0,region:void 0,identityPoolId:void 0,userPoolId:void 0,userPoolClientId:void 0};kt.createContext(CU);function wR(t,e){return function(){return t.apply(e,arguments)}}const{toString:kU}=Object.prototype,{getPrototypeOf:QS}=Object,rv=(t=>e=>{const n=kU.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Ka=t=>(t=t.toLowerCase(),e=>rv(e)===t),nv=t=>e=>typeof e===t,{isArray:Ld}=Array,zm=nv("undefined");function PU(t){return t!==null&&!zm(t)&&t.constructor!==null&&!zm(t.constructor)&&No(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const ER=Ka("ArrayBuffer");function DU(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&ER(t.buffer),e}const MU=nv("string"),No=nv("function"),SR=nv("number"),iv=t=>t!==null&&typeof t=="object",zU=t=>t===!0||t===!1,Zy=t=>{if(rv(t)!=="object")return!1;const e=QS(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},RU=Ka("Date"),OU=Ka("File"),FU=Ka("Blob"),LU=Ka("FileList"),BU=t=>iv(t)&&No(t.pipe),NU=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||No(t.append)&&((e=rv(t))==="formdata"||e==="object"&&No(t.toString)&&t.toString()==="[object FormData]"))},UU=Ka("URLSearchParams"),[jU,VU,$U,WU]=["ReadableStream","Request","Response","Headers"].map(Ka),GU=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function jm(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let a,u;if(typeof t!="object"&&(t=[t]),Ld(t))for(a=0,u=t.length;a<u;a++)e.call(null,t[a],a,t);else{const d=n?Object.getOwnPropertyNames(t):Object.keys(t),_=d.length;let l;for(a=0;a<_;a++)l=d[a],e.call(null,t[l],l,t)}}function TR(t,e){e=e.toLowerCase();const n=Object.keys(t);let a=n.length,u;for(;a-- >0;)if(u=n[a],e===u.toLowerCase())return u;return null}const Au=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),AR=t=>!zm(t)&&t!==Au;function ME(){const{caseless:t}=AR(this)&&this||{},e={},n=(a,u)=>{const d=t&&TR(e,u)||u;Zy(e[d])&&Zy(a)?e[d]=ME(e[d],a):Zy(a)?e[d]=ME({},a):Ld(a)?e[d]=a.slice():e[d]=a};for(let a=0,u=arguments.length;a<u;a++)arguments[a]&&jm(arguments[a],n);return e}const HU=(t,e,n,{allOwnKeys:a}={})=>(jm(e,(u,d)=>{n&&No(u)?t[d]=wR(u,n):t[d]=u},{allOwnKeys:a}),t),qU=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),ZU=(t,e,n,a)=>{t.prototype=Object.create(e.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},KU=(t,e,n,a)=>{let u,d,_;const l={};if(e=e||{},t==null)return e;do{for(u=Object.getOwnPropertyNames(t),d=u.length;d-- >0;)_=u[d],(!a||a(_,t,e))&&!l[_]&&(e[_]=t[_],l[_]=!0);t=n!==!1&&QS(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},XU=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const a=t.indexOf(e,n);return a!==-1&&a===n},YU=t=>{if(!t)return null;if(Ld(t))return t;let e=t.length;if(!SR(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},QU=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&QS(Uint8Array)),JU=(t,e)=>{const a=(t&&t[Symbol.iterator]).call(t);let u;for(;(u=a.next())&&!u.done;){const d=u.value;e.call(t,d[0],d[1])}},ej=(t,e)=>{let n;const a=[];for(;(n=t.exec(e))!==null;)a.push(n);return a},tj=Ka("HTMLFormElement"),rj=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,a,u){return a.toUpperCase()+u}),Vk=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),nj=Ka("RegExp"),IR=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),a={};jm(n,(u,d)=>{let _;(_=e(u,d,t))!==!1&&(a[d]=_||u)}),Object.defineProperties(t,a)},ij=t=>{IR(t,(e,n)=>{if(No(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const a=t[n];if(No(a)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},oj=(t,e)=>{const n={},a=u=>{u.forEach(d=>{n[d]=!0})};return Ld(t)?a(t):a(String(t).split(e)),n},aj=()=>{},sj=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,nb="abcdefghijklmnopqrstuvwxyz",$k="0123456789",CR={DIGIT:$k,ALPHA:nb,ALPHA_DIGIT:nb+nb.toUpperCase()+$k},lj=(t=16,e=CR.ALPHA_DIGIT)=>{let n="";const{length:a}=e;for(;t--;)n+=e[Math.random()*a|0];return n};function cj(t){return!!(t&&No(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const uj=t=>{const e=new Array(10),n=(a,u)=>{if(iv(a)){if(e.indexOf(a)>=0)return;if(!("toJSON"in a)){e[u]=a;const d=Ld(a)?[]:{};return jm(a,(_,l)=>{const w=n(_,u+1);!zm(w)&&(d[l]=w)}),e[u]=void 0,d}}return a};return n(t,0)},hj=Ka("AsyncFunction"),dj=t=>t&&(iv(t)||No(t))&&No(t.then)&&No(t.catch),kR=((t,e)=>t?setImmediate:e?((n,a)=>(Au.addEventListener("message",({source:u,data:d})=>{u===Au&&d===n&&a.length&&a.shift()()},!1),u=>{a.push(u),Au.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",No(Au.postMessage)),pj=typeof queueMicrotask<"u"?queueMicrotask.bind(Au):typeof process<"u"&&process.nextTick||kR,Ye={isArray:Ld,isArrayBuffer:ER,isBuffer:PU,isFormData:NU,isArrayBufferView:DU,isString:MU,isNumber:SR,isBoolean:zU,isObject:iv,isPlainObject:Zy,isReadableStream:jU,isRequest:VU,isResponse:$U,isHeaders:WU,isUndefined:zm,isDate:RU,isFile:OU,isBlob:FU,isRegExp:nj,isFunction:No,isStream:BU,isURLSearchParams:UU,isTypedArray:QU,isFileList:LU,forEach:jm,merge:ME,extend:HU,trim:GU,stripBOM:qU,inherits:ZU,toFlatObject:KU,kindOf:rv,kindOfTest:Ka,endsWith:XU,toArray:YU,forEachEntry:JU,matchAll:ej,isHTMLForm:tj,hasOwnProperty:Vk,hasOwnProp:Vk,reduceDescriptors:IR,freezeMethods:ij,toObjectSet:oj,toCamelCase:rj,noop:aj,toFiniteNumber:sj,findKey:TR,global:Au,isContextDefined:AR,ALPHABET:CR,generateString:lj,isSpecCompliantForm:cj,toJSONObject:uj,isAsyncFn:hj,isThenable:dj,setImmediate:kR,asap:pj};function ar(t,e,n,a,u){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),a&&(this.request=a),u&&(this.response=u,this.status=u.status?u.status:null)}Ye.inherits(ar,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ye.toJSONObject(this.config),code:this.code,status:this.status}}});const PR=ar.prototype,DR={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{DR[t]={value:t}});Object.defineProperties(ar,DR);Object.defineProperty(PR,"isAxiosError",{value:!0});ar.from=(t,e,n,a,u,d)=>{const _=Object.create(PR);return Ye.toFlatObject(t,_,function(w){return w!==Error.prototype},l=>l!=="isAxiosError"),ar.call(_,t.message,e,n,a,u),_.cause=t,_.name=t.name,d&&Object.assign(_,d),_};const fj=null;function zE(t){return Ye.isPlainObject(t)||Ye.isArray(t)}function MR(t){return Ye.endsWith(t,"[]")?t.slice(0,-2):t}function Wk(t,e,n){return t?t.concat(e).map(function(u,d){return u=MR(u),!n&&d?"["+u+"]":u}).join(n?".":""):e}function mj(t){return Ye.isArray(t)&&!t.some(zE)}const gj=Ye.toFlatObject(Ye,{},null,function(e){return/^is[A-Z]/.test(e)});function ov(t,e,n){if(!Ye.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=Ye.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(W,N){return!Ye.isUndefined(N[W])});const a=n.metaTokens,u=n.visitor||C,d=n.dots,_=n.indexes,w=(n.Blob||typeof Blob<"u"&&Blob)&&Ye.isSpecCompliantForm(e);if(!Ye.isFunction(u))throw new TypeError("visitor must be a function");function T(U){if(U===null)return"";if(Ye.isDate(U))return U.toISOString();if(!w&&Ye.isBlob(U))throw new ar("Blob is not supported. Use a Buffer instead.");return Ye.isArrayBuffer(U)||Ye.isTypedArray(U)?w&&typeof Blob=="function"?new Blob([U]):Buffer.from(U):U}function C(U,W,N){let V=U;if(U&&!N&&typeof U=="object"){if(Ye.endsWith(W,"{}"))W=a?W:W.slice(0,-2),U=JSON.stringify(U);else if(Ye.isArray(U)&&mj(U)||(Ye.isFileList(U)||Ye.endsWith(W,"[]"))&&(V=Ye.toArray(U)))return W=MR(W),V.forEach(function(F,H){!(Ye.isUndefined(F)||F===null)&&e.append(_===!0?Wk([W],H,d):_===null?W:W+"[]",T(F))}),!1}return zE(U)?!0:(e.append(Wk(N,W,d),T(U)),!1)}const P=[],z=Object.assign(gj,{defaultVisitor:C,convertValue:T,isVisitable:zE});function $(U,W){if(!Ye.isUndefined(U)){if(P.indexOf(U)!==-1)throw Error("Circular reference detected in "+W.join("."));P.push(U),Ye.forEach(U,function(V,R){(!(Ye.isUndefined(V)||V===null)&&u.call(e,V,Ye.isString(R)?R.trim():R,W,z))===!0&&$(V,W?W.concat(R):[R])}),P.pop()}}if(!Ye.isObject(t))throw new TypeError("data must be an object");return $(t),e}function Gk(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(a){return e[a]})}function JS(t,e){this._pairs=[],t&&ov(t,this,e)}const zR=JS.prototype;zR.append=function(e,n){this._pairs.push([e,n])};zR.toString=function(e){const n=e?function(a){return e.call(this,a,Gk)}:Gk;return this._pairs.map(function(u){return n(u[0])+"="+n(u[1])},"").join("&")};function yj(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function RR(t,e,n){if(!e)return t;const a=n&&n.encode||yj,u=n&&n.serialize;let d;if(u?d=u(e,n):d=Ye.isURLSearchParams(e)?e.toString():new JS(e,n).toString(a),d){const _=t.indexOf("#");_!==-1&&(t=t.slice(0,_)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}class _j{constructor(){this.handlers=[]}use(e,n,a){return this.handlers.push({fulfilled:e,rejected:n,synchronous:a?a.synchronous:!1,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ye.forEach(this.handlers,function(a){a!==null&&e(a)})}}const Hk=_j,OR={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},vj=typeof URLSearchParams<"u"?URLSearchParams:JS,xj=typeof FormData<"u"?FormData:null,bj=typeof Blob<"u"?Blob:null,wj={isBrowser:!0,classes:{URLSearchParams:vj,FormData:xj,Blob:bj},protocols:["http","https","file","blob","url","data"]},eT=typeof window<"u"&&typeof document<"u",RE=typeof navigator=="object"&&navigator||void 0,Ej=eT&&(!RE||["ReactNative","NativeScript","NS"].indexOf(RE.product)<0),Sj=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Tj=eT&&window.location.href||"http://localhost",Aj=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:eT,hasStandardBrowserEnv:Ej,hasStandardBrowserWebWorkerEnv:Sj,navigator:RE,origin:Tj},Symbol.toStringTag,{value:"Module"})),vo={...Aj,...wj};function Ij(t,e){return ov(t,new vo.classes.URLSearchParams,Object.assign({visitor:function(n,a,u,d){return vo.isNode&&Ye.isBuffer(n)?(this.append(a,n.toString("base64")),!1):d.defaultVisitor.apply(this,arguments)}},e))}function Cj(t){return Ye.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function kj(t){const e={},n=Object.keys(t);let a;const u=n.length;let d;for(a=0;a<u;a++)d=n[a],e[d]=t[d];return e}function FR(t){function e(n,a,u,d){let _=n[d++];if(_==="__proto__")return!0;const l=Number.isFinite(+_),w=d>=n.length;return _=!_&&Ye.isArray(u)?u.length:_,w?(Ye.hasOwnProp(u,_)?u[_]=[u[_],a]:u[_]=a,!l):((!u[_]||!Ye.isObject(u[_]))&&(u[_]=[]),e(n,a,u[_],d)&&Ye.isArray(u[_])&&(u[_]=kj(u[_])),!l)}if(Ye.isFormData(t)&&Ye.isFunction(t.entries)){const n={};return Ye.forEachEntry(t,(a,u)=>{e(Cj(a),u,n,0)}),n}return null}function Pj(t,e,n){if(Ye.isString(t))try{return(e||JSON.parse)(t),Ye.trim(t)}catch(a){if(a.name!=="SyntaxError")throw a}return(n||JSON.stringify)(t)}const tT={transitional:OR,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const a=n.getContentType()||"",u=a.indexOf("application/json")>-1,d=Ye.isObject(e);if(d&&Ye.isHTMLForm(e)&&(e=new FormData(e)),Ye.isFormData(e))return u?JSON.stringify(FR(e)):e;if(Ye.isArrayBuffer(e)||Ye.isBuffer(e)||Ye.isStream(e)||Ye.isFile(e)||Ye.isBlob(e)||Ye.isReadableStream(e))return e;if(Ye.isArrayBufferView(e))return e.buffer;if(Ye.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(d){if(a.indexOf("application/x-www-form-urlencoded")>-1)return Ij(e,this.formSerializer).toString();if((l=Ye.isFileList(e))||a.indexOf("multipart/form-data")>-1){const w=this.env&&this.env.FormData;return ov(l?{"files[]":e}:e,w&&new w,this.formSerializer)}}return d||u?(n.setContentType("application/json",!1),Pj(e)):e}],transformResponse:[function(e){const n=this.transitional||tT.transitional,a=n&&n.forcedJSONParsing,u=this.responseType==="json";if(Ye.isResponse(e)||Ye.isReadableStream(e))return e;if(e&&Ye.isString(e)&&(a&&!this.responseType||u)){const _=!(n&&n.silentJSONParsing)&&u;try{return JSON.parse(e)}catch(l){if(_)throw l.name==="SyntaxError"?ar.from(l,ar.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:vo.classes.FormData,Blob:vo.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ye.forEach(["delete","get","head","post","put","patch"],t=>{tT.headers[t]={}});const rT=tT,Dj=Ye.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Mj=t=>{const e={};let n,a,u;return t&&t.split(`
`).forEach(function(_){u=_.indexOf(":"),n=_.substring(0,u).trim().toLowerCase(),a=_.substring(u+1).trim(),!(!n||e[n]&&Dj[n])&&(n==="set-cookie"?e[n]?e[n].push(a):e[n]=[a]:e[n]=e[n]?e[n]+", "+a:a)}),e},qk=Symbol("internals");function Of(t){return t&&String(t).trim().toLowerCase()}function Ky(t){return t===!1||t==null?t:Ye.isArray(t)?t.map(Ky):String(t)}function zj(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=n.exec(t);)e[a[1]]=a[2];return e}const Rj=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ib(t,e,n,a,u){if(Ye.isFunction(a))return a.call(this,e,n);if(u&&(e=n),!!Ye.isString(e)){if(Ye.isString(a))return e.indexOf(a)!==-1;if(Ye.isRegExp(a))return a.test(e)}}function Oj(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,a)=>n.toUpperCase()+a)}function Fj(t,e){const n=Ye.toCamelCase(" "+e);["get","set","has"].forEach(a=>{Object.defineProperty(t,a+n,{value:function(u,d,_){return this[a].call(this,e,u,d,_)},configurable:!0})})}class av{constructor(e){e&&this.set(e)}set(e,n,a){const u=this;function d(l,w,T){const C=Of(w);if(!C)throw new Error("header name must be a non-empty string");const P=Ye.findKey(u,C);(!P||u[P]===void 0||T===!0||T===void 0&&u[P]!==!1)&&(u[P||w]=Ky(l))}const _=(l,w)=>Ye.forEach(l,(T,C)=>d(T,C,w));if(Ye.isPlainObject(e)||e instanceof this.constructor)_(e,n);else if(Ye.isString(e)&&(e=e.trim())&&!Rj(e))_(Mj(e),n);else if(Ye.isHeaders(e))for(const[l,w]of e.entries())d(w,l,a);else e!=null&&d(n,e,a);return this}get(e,n){if(e=Of(e),e){const a=Ye.findKey(this,e);if(a){const u=this[a];if(!n)return u;if(n===!0)return zj(u);if(Ye.isFunction(n))return n.call(this,u,a);if(Ye.isRegExp(n))return n.exec(u);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Of(e),e){const a=Ye.findKey(this,e);return!!(a&&this[a]!==void 0&&(!n||ib(this,this[a],a,n)))}return!1}delete(e,n){const a=this;let u=!1;function d(_){if(_=Of(_),_){const l=Ye.findKey(a,_);l&&(!n||ib(a,a[l],l,n))&&(delete a[l],u=!0)}}return Ye.isArray(e)?e.forEach(d):d(e),u}clear(e){const n=Object.keys(this);let a=n.length,u=!1;for(;a--;){const d=n[a];(!e||ib(this,this[d],d,e,!0))&&(delete this[d],u=!0)}return u}normalize(e){const n=this,a={};return Ye.forEach(this,(u,d)=>{const _=Ye.findKey(a,d);if(_){n[_]=Ky(u),delete n[d];return}const l=e?Oj(d):String(d).trim();l!==d&&delete n[d],n[l]=Ky(u),a[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return Ye.forEach(this,(a,u)=>{a!=null&&a!==!1&&(n[u]=e&&Ye.isArray(a)?a.join(", "):a)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const a=new this(e);return n.forEach(u=>a.set(u)),a}static accessor(e){const a=(this[qk]=this[qk]={accessors:{}}).accessors,u=this.prototype;function d(_){const l=Of(_);a[l]||(Fj(u,_),a[l]=!0)}return Ye.isArray(e)?e.forEach(d):d(e),this}}av.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ye.reduceDescriptors(av.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(a){this[n]=a}}});Ye.freezeMethods(av);const qa=av;function ob(t,e){const n=this||rT,a=e||n,u=qa.from(a.headers);let d=a.data;return Ye.forEach(t,function(l){d=l.call(n,d,u.normalize(),e?e.status:void 0)}),u.normalize(),d}function LR(t){return!!(t&&t.__CANCEL__)}function Bd(t,e,n){ar.call(this,t??"canceled",ar.ERR_CANCELED,e,n),this.name="CanceledError"}Ye.inherits(Bd,ar,{__CANCEL__:!0});function BR(t,e,n){const a=n.config.validateStatus;!n.status||!a||a(n.status)?t(n):e(new ar("Request failed with status code "+n.status,[ar.ERR_BAD_REQUEST,ar.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Lj(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Bj(t,e){t=t||10;const n=new Array(t),a=new Array(t);let u=0,d=0,_;return e=e!==void 0?e:1e3,function(w){const T=Date.now(),C=a[d];_||(_=T),n[u]=w,a[u]=T;let P=d,z=0;for(;P!==u;)z+=n[P++],P=P%t;if(u=(u+1)%t,u===d&&(d=(d+1)%t),T-_<e)return;const $=C&&T-C;return $?Math.round(z*1e3/$):void 0}}function Nj(t,e){let n=0,a=1e3/e,u,d;const _=(T,C=Date.now())=>{n=C,u=null,d&&(clearTimeout(d),d=null),t.apply(null,T)};return[(...T)=>{const C=Date.now(),P=C-n;P>=a?_(T,C):(u=T,d||(d=setTimeout(()=>{d=null,_(u)},a-P)))},()=>u&&_(u)]}const I_=(t,e,n=3)=>{let a=0;const u=Bj(50,250);return Nj(d=>{const _=d.loaded,l=d.lengthComputable?d.total:void 0,w=_-a,T=u(w),C=_<=l;a=_;const P={loaded:_,total:l,progress:l?_/l:void 0,bytes:w,rate:T||void 0,estimated:T&&l&&C?(l-_)/T:void 0,event:d,lengthComputable:l!=null,[e?"download":"upload"]:!0};t(P)},n)},Zk=(t,e)=>{const n=t!=null;return[a=>e[0]({lengthComputable:n,total:t,loaded:a}),e[1]]},Kk=t=>(...e)=>Ye.asap(()=>t(...e)),Uj=vo.hasStandardBrowserEnv?function(){const e=vo.navigator&&/(msie|trident)/i.test(vo.navigator.userAgent),n=document.createElement("a");let a;function u(d){let _=d;return e&&(n.setAttribute("href",_),_=n.href),n.setAttribute("href",_),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return a=u(window.location.href),function(_){const l=Ye.isString(_)?u(_):_;return l.protocol===a.protocol&&l.host===a.host}}():function(){return function(){return!0}}(),jj=vo.hasStandardBrowserEnv?{write(t,e,n,a,u,d){const _=[t+"="+encodeURIComponent(e)];Ye.isNumber(n)&&_.push("expires="+new Date(n).toGMTString()),Ye.isString(a)&&_.push("path="+a),Ye.isString(u)&&_.push("domain="+u),d===!0&&_.push("secure"),document.cookie=_.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Vj(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function $j(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function NR(t,e){return t&&!Vj(e)?$j(t,e):e}const Xk=t=>t instanceof qa?{...t}:t;function Ru(t,e){e=e||{};const n={};function a(T,C,P){return Ye.isPlainObject(T)&&Ye.isPlainObject(C)?Ye.merge.call({caseless:P},T,C):Ye.isPlainObject(C)?Ye.merge({},C):Ye.isArray(C)?C.slice():C}function u(T,C,P){if(Ye.isUndefined(C)){if(!Ye.isUndefined(T))return a(void 0,T,P)}else return a(T,C,P)}function d(T,C){if(!Ye.isUndefined(C))return a(void 0,C)}function _(T,C){if(Ye.isUndefined(C)){if(!Ye.isUndefined(T))return a(void 0,T)}else return a(void 0,C)}function l(T,C,P){if(P in e)return a(T,C);if(P in t)return a(void 0,T)}const w={url:d,method:d,data:d,baseURL:_,transformRequest:_,transformResponse:_,paramsSerializer:_,timeout:_,timeoutMessage:_,withCredentials:_,withXSRFToken:_,adapter:_,responseType:_,xsrfCookieName:_,xsrfHeaderName:_,onUploadProgress:_,onDownloadProgress:_,decompress:_,maxContentLength:_,maxBodyLength:_,beforeRedirect:_,transport:_,httpAgent:_,httpsAgent:_,cancelToken:_,socketPath:_,responseEncoding:_,validateStatus:l,headers:(T,C)=>u(Xk(T),Xk(C),!0)};return Ye.forEach(Object.keys(Object.assign({},t,e)),function(C){const P=w[C]||u,z=P(t[C],e[C],C);Ye.isUndefined(z)&&P!==l||(n[C]=z)}),n}const UR=t=>{const e=Ru({},t);let{data:n,withXSRFToken:a,xsrfHeaderName:u,xsrfCookieName:d,headers:_,auth:l}=e;e.headers=_=qa.from(_),e.url=RR(NR(e.baseURL,e.url),t.params,t.paramsSerializer),l&&_.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let w;if(Ye.isFormData(n)){if(vo.hasStandardBrowserEnv||vo.hasStandardBrowserWebWorkerEnv)_.setContentType(void 0);else if((w=_.getContentType())!==!1){const[T,...C]=w?w.split(";").map(P=>P.trim()).filter(Boolean):[];_.setContentType([T||"multipart/form-data",...C].join("; "))}}if(vo.hasStandardBrowserEnv&&(a&&Ye.isFunction(a)&&(a=a(e)),a||a!==!1&&Uj(e.url))){const T=u&&d&&jj.read(d);T&&_.set(u,T)}return e},Wj=typeof XMLHttpRequest<"u",Gj=Wj&&function(t){return new Promise(function(n,a){const u=UR(t);let d=u.data;const _=qa.from(u.headers).normalize();let{responseType:l,onUploadProgress:w,onDownloadProgress:T}=u,C,P,z,$,U;function W(){$&&$(),U&&U(),u.cancelToken&&u.cancelToken.unsubscribe(C),u.signal&&u.signal.removeEventListener("abort",C)}let N=new XMLHttpRequest;N.open(u.method.toUpperCase(),u.url,!0),N.timeout=u.timeout;function V(){if(!N)return;const F=qa.from("getAllResponseHeaders"in N&&N.getAllResponseHeaders()),J={data:!l||l==="text"||l==="json"?N.responseText:N.response,status:N.status,statusText:N.statusText,headers:F,config:t,request:N};BR(function(se){n(se),W()},function(se){a(se),W()},J),N=null}"onloadend"in N?N.onloadend=V:N.onreadystatechange=function(){!N||N.readyState!==4||N.status===0&&!(N.responseURL&&N.responseURL.indexOf("file:")===0)||setTimeout(V)},N.onabort=function(){N&&(a(new ar("Request aborted",ar.ECONNABORTED,t,N)),N=null)},N.onerror=function(){a(new ar("Network Error",ar.ERR_NETWORK,t,N)),N=null},N.ontimeout=function(){let H=u.timeout?"timeout of "+u.timeout+"ms exceeded":"timeout exceeded";const J=u.transitional||OR;u.timeoutErrorMessage&&(H=u.timeoutErrorMessage),a(new ar(H,J.clarifyTimeoutError?ar.ETIMEDOUT:ar.ECONNABORTED,t,N)),N=null},d===void 0&&_.setContentType(null),"setRequestHeader"in N&&Ye.forEach(_.toJSON(),function(H,J){N.setRequestHeader(J,H)}),Ye.isUndefined(u.withCredentials)||(N.withCredentials=!!u.withCredentials),l&&l!=="json"&&(N.responseType=u.responseType),T&&([z,U]=I_(T,!0),N.addEventListener("progress",z)),w&&N.upload&&([P,$]=I_(w),N.upload.addEventListener("progress",P),N.upload.addEventListener("loadend",$)),(u.cancelToken||u.signal)&&(C=F=>{N&&(a(!F||F.type?new Bd(null,t,N):F),N.abort(),N=null)},u.cancelToken&&u.cancelToken.subscribe(C),u.signal&&(u.signal.aborted?C():u.signal.addEventListener("abort",C)));const R=Lj(u.url);if(R&&vo.protocols.indexOf(R)===-1){a(new ar("Unsupported protocol "+R+":",ar.ERR_BAD_REQUEST,t));return}N.send(d||null)})},Hj=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let a=new AbortController,u;const d=function(T){if(!u){u=!0,l();const C=T instanceof Error?T:this.reason;a.abort(C instanceof ar?C:new Bd(C instanceof Error?C.message:C))}};let _=e&&setTimeout(()=>{_=null,d(new ar(`timeout ${e} of ms exceeded`,ar.ETIMEDOUT))},e);const l=()=>{t&&(_&&clearTimeout(_),_=null,t.forEach(T=>{T.unsubscribe?T.unsubscribe(d):T.removeEventListener("abort",d)}),t=null)};t.forEach(T=>T.addEventListener("abort",d));const{signal:w}=a;return w.unsubscribe=()=>Ye.asap(l),w}},qj=Hj,Zj=function*(t,e){let n=t.byteLength;if(!e||n<e){yield t;return}let a=0,u;for(;a<n;)u=a+e,yield t.slice(a,u),a=u},Kj=async function*(t,e){for await(const n of Xj(t))yield*Zj(n,e)},Xj=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:a}=await e.read();if(n)break;yield a}}finally{await e.cancel()}},Yk=(t,e,n,a)=>{const u=Kj(t,e);let d=0,_,l=w=>{_||(_=!0,a&&a(w))};return new ReadableStream({async pull(w){try{const{done:T,value:C}=await u.next();if(T){l(),w.close();return}let P=C.byteLength;if(n){let z=d+=P;n(z)}w.enqueue(new Uint8Array(C))}catch(T){throw l(T),T}},cancel(w){return l(w),u.return()}},{highWaterMark:2})},sv=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",jR=sv&&typeof ReadableStream=="function",Yj=sv&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),VR=(t,...e)=>{try{return!!t(...e)}catch{return!1}},Qj=jR&&VR(()=>{let t=!1;const e=new Request(vo.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),Qk=64*1024,OE=jR&&VR(()=>Ye.isReadableStream(new Response("").body)),C_={stream:OE&&(t=>t.body)};sv&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!C_[e]&&(C_[e]=Ye.isFunction(t[e])?n=>n[e]():(n,a)=>{throw new ar(`Response type '${e}' is not supported`,ar.ERR_NOT_SUPPORT,a)})})})(new Response);const Jj=async t=>{if(t==null)return 0;if(Ye.isBlob(t))return t.size;if(Ye.isSpecCompliantForm(t))return(await new Request(vo.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(Ye.isArrayBufferView(t)||Ye.isArrayBuffer(t))return t.byteLength;if(Ye.isURLSearchParams(t)&&(t=t+""),Ye.isString(t))return(await Yj(t)).byteLength},eV=async(t,e)=>{const n=Ye.toFiniteNumber(t.getContentLength());return n??Jj(e)},tV=sv&&(async t=>{let{url:e,method:n,data:a,signal:u,cancelToken:d,timeout:_,onDownloadProgress:l,onUploadProgress:w,responseType:T,headers:C,withCredentials:P="same-origin",fetchOptions:z}=UR(t);T=T?(T+"").toLowerCase():"text";let $=qj([u,d&&d.toAbortSignal()],_),U;const W=$&&$.unsubscribe&&(()=>{$.unsubscribe()});let N;try{if(w&&Qj&&n!=="get"&&n!=="head"&&(N=await eV(C,a))!==0){let J=new Request(e,{method:"POST",body:a,duplex:"half"}),te;if(Ye.isFormData(a)&&(te=J.headers.get("content-type"))&&C.setContentType(te),J.body){const[se,ge]=Zk(N,I_(Kk(w)));a=Yk(J.body,Qk,se,ge)}}Ye.isString(P)||(P=P?"include":"omit");const V="credentials"in Request.prototype;U=new Request(e,{...z,signal:$,method:n.toUpperCase(),headers:C.normalize().toJSON(),body:a,duplex:"half",credentials:V?P:void 0});let R=await fetch(U);const F=OE&&(T==="stream"||T==="response");if(OE&&(l||F&&W)){const J={};["status","statusText","headers"].forEach(xe=>{J[xe]=R[xe]});const te=Ye.toFiniteNumber(R.headers.get("content-length")),[se,ge]=l&&Zk(te,I_(Kk(l),!0))||[];R=new Response(Yk(R.body,Qk,se,()=>{ge&&ge(),W&&W()}),J)}T=T||"text";let H=await C_[Ye.findKey(C_,T)||"text"](R,t);return!F&&W&&W(),await new Promise((J,te)=>{BR(J,te,{data:H,headers:qa.from(R.headers),status:R.status,statusText:R.statusText,config:t,request:U})})}catch(V){throw W&&W(),V&&V.name==="TypeError"&&/fetch/i.test(V.message)?Object.assign(new ar("Network Error",ar.ERR_NETWORK,t,U),{cause:V.cause||V}):ar.from(V,V&&V.code,t,U)}}),FE={http:fj,xhr:Gj,fetch:tV};Ye.forEach(FE,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const Jk=t=>`- ${t}`,rV=t=>Ye.isFunction(t)||t===null||t===!1,$R={getAdapter:t=>{t=Ye.isArray(t)?t:[t];const{length:e}=t;let n,a;const u={};for(let d=0;d<e;d++){n=t[d];let _;if(a=n,!rV(n)&&(a=FE[(_=String(n)).toLowerCase()],a===void 0))throw new ar(`Unknown adapter '${_}'`);if(a)break;u[_||"#"+d]=a}if(!a){const d=Object.entries(u).map(([l,w])=>`adapter ${l} `+(w===!1?"is not supported by the environment":"is not available in the build"));let _=e?d.length>1?`since :
`+d.map(Jk).join(`
`):" "+Jk(d[0]):"as no adapter specified";throw new ar("There is no suitable adapter to dispatch the request "+_,"ERR_NOT_SUPPORT")}return a},adapters:FE};function ab(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Bd(null,t)}function eP(t){return ab(t),t.headers=qa.from(t.headers),t.data=ob.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),$R.getAdapter(t.adapter||rT.adapter)(t).then(function(a){return ab(t),a.data=ob.call(t,t.transformResponse,a),a.headers=qa.from(a.headers),a},function(a){return LR(a)||(ab(t),a&&a.response&&(a.response.data=ob.call(t,t.transformResponse,a.response),a.response.headers=qa.from(a.response.headers))),Promise.reject(a)})}const WR="1.7.7",nT={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{nT[t]=function(a){return typeof a===t||"a"+(e<1?"n ":" ")+t}});const tP={};nT.transitional=function(e,n,a){function u(d,_){return"[Axios v"+WR+"] Transitional option '"+d+"'"+_+(a?". "+a:"")}return(d,_,l)=>{if(e===!1)throw new ar(u(_," has been removed"+(n?" in "+n:"")),ar.ERR_DEPRECATED);return n&&!tP[_]&&(tP[_]=!0,console.warn(u(_," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(d,_,l):!0}};function nV(t,e,n){if(typeof t!="object")throw new ar("options must be an object",ar.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let u=a.length;for(;u-- >0;){const d=a[u],_=e[d];if(_){const l=t[d],w=l===void 0||_(l,d,t);if(w!==!0)throw new ar("option "+d+" must be "+w,ar.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new ar("Unknown option "+d,ar.ERR_BAD_OPTION)}}const LE={assertOptions:nV,validators:nT},Hl=LE.validators;class k_{constructor(e){this.defaults=e,this.interceptors={request:new Hk,response:new Hk}}async request(e,n){try{return await this._request(e,n)}catch(a){if(a instanceof Error){let u;Error.captureStackTrace?Error.captureStackTrace(u={}):u=new Error;const d=u.stack?u.stack.replace(/^.+\n/,""):"";try{a.stack?d&&!String(a.stack).endsWith(d.replace(/^.+\n.+\n/,""))&&(a.stack+=`
`+d):a.stack=d}catch{}}throw a}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Ru(this.defaults,n);const{transitional:a,paramsSerializer:u,headers:d}=n;a!==void 0&&LE.assertOptions(a,{silentJSONParsing:Hl.transitional(Hl.boolean),forcedJSONParsing:Hl.transitional(Hl.boolean),clarifyTimeoutError:Hl.transitional(Hl.boolean)},!1),u!=null&&(Ye.isFunction(u)?n.paramsSerializer={serialize:u}:LE.assertOptions(u,{encode:Hl.function,serialize:Hl.function},!0)),n.method=(n.method||this.defaults.method||"get").toLowerCase();let _=d&&Ye.merge(d.common,d[n.method]);d&&Ye.forEach(["delete","get","head","post","put","patch","common"],U=>{delete d[U]}),n.headers=qa.concat(_,d);const l=[];let w=!0;this.interceptors.request.forEach(function(W){typeof W.runWhen=="function"&&W.runWhen(n)===!1||(w=w&&W.synchronous,l.unshift(W.fulfilled,W.rejected))});const T=[];this.interceptors.response.forEach(function(W){T.push(W.fulfilled,W.rejected)});let C,P=0,z;if(!w){const U=[eP.bind(this),void 0];for(U.unshift.apply(U,l),U.push.apply(U,T),z=U.length,C=Promise.resolve(n);P<z;)C=C.then(U[P++],U[P++]);return C}z=l.length;let $=n;for(P=0;P<z;){const U=l[P++],W=l[P++];try{$=U($)}catch(N){W.call(this,N);break}}try{C=eP.call(this,$)}catch(U){return Promise.reject(U)}for(P=0,z=T.length;P<z;)C=C.then(T[P++],T[P++]);return C}getUri(e){e=Ru(this.defaults,e);const n=NR(e.baseURL,e.url);return RR(n,e.params,e.paramsSerializer)}}Ye.forEach(["delete","get","head","options"],function(e){k_.prototype[e]=function(n,a){return this.request(Ru(a||{},{method:e,url:n,data:(a||{}).data}))}});Ye.forEach(["post","put","patch"],function(e){function n(a){return function(d,_,l){return this.request(Ru(l||{},{method:e,headers:a?{"Content-Type":"multipart/form-data"}:{},url:d,data:_}))}}k_.prototype[e]=n(),k_.prototype[e+"Form"]=n(!0)});const Xy=k_;class iT{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(d){n=d});const a=this;this.promise.then(u=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](u);a._listeners=null}),this.promise.then=u=>{let d;const _=new Promise(l=>{a.subscribe(l),d=l}).then(u);return _.cancel=function(){a.unsubscribe(d)},_},e(function(d,_,l){a.reason||(a.reason=new Bd(d,_,l),n(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=a=>{e.abort(a)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new iT(function(u){e=u}),cancel:e}}}const iV=iT;function oV(t){return function(n){return t.apply(null,n)}}function aV(t){return Ye.isObject(t)&&t.isAxiosError===!0}const BE={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(BE).forEach(([t,e])=>{BE[e]=t});const sV=BE;function GR(t){const e=new Xy(t),n=wR(Xy.prototype.request,e);return Ye.extend(n,Xy.prototype,e,{allOwnKeys:!0}),Ye.extend(n,e,null,{allOwnKeys:!0}),n.create=function(u){return GR(Ru(t,u))},n}const Xn=GR(rT);Xn.Axios=Xy;Xn.CanceledError=Bd;Xn.CancelToken=iV;Xn.isCancel=LR;Xn.VERSION=WR;Xn.toFormData=ov;Xn.AxiosError=ar;Xn.Cancel=Xn.CanceledError;Xn.all=function(e){return Promise.all(e)};Xn.spread=oV;Xn.isAxiosError=aV;Xn.mergeConfig=Ru;Xn.AxiosHeaders=qa;Xn.formToJSON=t=>FR(Ye.isHTMLForm(t)?new FormData(t):t);Xn.getAdapter=$R.getAdapter;Xn.HttpStatusCode=sV;Xn.default=Xn;const lV=Xn;/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */const pd="https://cori-data-api.ruralinnovation.us/",NE=lV.create({baseURL:pd,headers:{"Content-Type":"application/json"}}),sb={},HR={apiClient:NE,authenticated:!1,authenticated_user:null,autoSignOut:null,baseURL:pd,token:null,data:{get:()=>sb,set:t=>{for(const e in t)t.hasOwnProperty[e]&&(sb[e]=t)}},setData:t=>{for(const e in t)t.hasOwnProperty[e]&&(sb[e]=t)}},qR=kt.createContext(HR);let Zg=!1,rP=!1;function cV(t){const[e,n]=kt.useState(Object.assign(Object.assign({},HR),{baseURL:t.baseURL?t.baseURL:pd,setData:a}));function a(u){const d=e;n(Object.assign(Object.assign({},d),{data:Object.assign(Object.assign({},d.data),u),setData:a}))}return t.baseURL&&t.baseURL.length>0&&NE.interceptors.request.use(u=>(u.baseURL=t.baseURL,console.log("API baseURL updated:",u.baseURL),u),u=>Promise.reject(u)),kt.useEffect(()=>{if(n(Object.assign(Object.assign({},e),{autoSignOut:t.signOut&&typeof t.signOut=="function"?()=>{const{signOut:u}=t;u(),window.alert("Please refresh this session by clicking the browser's reload button!"),window.location=window.location.protocol+"//"+window.location.host+window.location.pathname}:null,baseURL:t.baseURL?t.baseURL:pd})),t.fetchAuthSession){const{fetchAuthSession:u}=t;u().then(_=>{if(!Zg){const l=_.tokens;if(console.log("API tokens:",l),l&&l.hasOwnProperty("idToken")&&(Zg=!0,console.log("API Session is authenticated:",Zg),console.log("API Session config:",_),console.log("idToken:",l.idToken),NE.interceptors.request.use(w=>{const T=l.idToken;return T&&(w.headers.Authorization=`Bearer ${T}`),t.baseURL&&(w.baseURL=t.baseURL),w},w=>Promise.reject(w)),n(Object.assign(Object.assign({},e),{authenticated:!0,autoSignOut:t.signOut&&typeof t.signOut=="function"?()=>{const{signOut:w}=t;w(),window.alert("Please refresh this session by clicking the browser's reload button!"),window.location=window.location.protocol+"//"+window.location.host+window.location.pathname}:null,baseURL:t.baseURL||pd,token:l.idToken})),t.getCurrentUser)){const{getCurrentUser:w}=t;w().then(C=>{rP||(rP=!0,console.log("API User is authenticated:",Zg),console.log("API User:",C),console.log("API User type:",C.constructor.name),n(Object.assign(Object.assign({},e),{authenticated:!0,authenticated_user:C,autoSignOut:t.signOut&&typeof t.signOut=="function"?()=>{const{signOut:P}=t;P(),window.alert("Please refresh this session by clicking the browser's reload button!"),window.location=window.location.protocol+"//"+window.location.host+window.location.pathname}:null,baseURL:t.baseURL||pd,token:l.idToken})))})}}})}},[]),P1.createElement(P1.Fragment,null,P1.createElement(qR.Provider,{value:e},t.children))}const uV="modulepreload",hV=function(t){return"/"+t},nP={},dV=function(e,n,a){if(!n||n.length===0)return e();const u=document.getElementsByTagName("link");return Promise.all(n.map(d=>{if(d=hV(d),d in nP)return;nP[d]=!0;const _=d.endsWith(".css"),l=_?'[rel="stylesheet"]':"";if(!!a)for(let C=u.length-1;C>=0;C--){const P=u[C];if(P.href===d&&(!_||P.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${l}`))return;const T=document.createElement("link");if(T.rel=_?"stylesheet":uV,_||(T.as="script",T.crossOrigin=""),T.href=d,document.head.appendChild(T),_)return new Promise((C,P)=>{T.addEventListener("load",C),T.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${d}`)))})})).then(()=>e()).catch(d=>{const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=d,window.dispatchEvent(_),!_.defaultPrevented)throw d})},pV=kt.createContext(null);function fV(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,a=Array.isArray(t)?t[1]:t?t.y:0,u=Array.isArray(e)?e[0]:e?e.x:0,d=Array.isArray(e)?e[1]:e?e.y:0;return n===u&&a===d}function nl(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!nl(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),a=Object.keys(e);if(n.length!==a.length)return!1;for(const u of n)if(!e.hasOwnProperty(u)||!nl(t[u],e[u]))return!1;return!0}return!1}function mV(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function iP(t,e){if(!t.getProjection)return;const n=t.getProjection(),a=e.getProjection();nl(n,a)||e.setProjection(n)}function oP(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function aP(t,e){const n=e.viewState||e;let a=!1;if("longitude"in n&&"latitude"in n){const u=t.center;t.center=new u.constructor(n.longitude,n.latitude),a=a||u!==t.center}if("zoom"in n){const u=t.zoom;t.zoom=n.zoom,a=a||u!==t.zoom}if("bearing"in n){const u=t.bearing;t.bearing=n.bearing,a=a||u!==t.bearing}if("pitch"in n){const u=t.pitch;t.pitch=n.pitch,a=a||u!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(a=!0,t.padding=n.padding),a}const gV=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function sP(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const a of t.layers)e[a.id]=a;const n=t.layers.map(a=>{let u=null;"interactive"in a&&(u=Object.assign({},a),delete u.interactive);const d=e[a.ref];if(d){u=u||Object.assign({},a),delete u.ref;for(const _ of gV)_ in d&&(u[_]=d[_])}return u||a});return{...t,layers:n}}const lP={version:8,sources:{},layers:[]},cP={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},lb={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},uP={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},yV=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],_V=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Dd{constructor(e,n,a){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=u=>{const d=this.props[uP[u.type]];d?d(u):u.type==="error"&&console.error(u.error)},this._onPointerEvent=u=>{(u.type==="mousemove"||u.type==="mouseout")&&this._updateHover(u);const d=this.props[cP[u.type]];d&&(this.props.interactiveLayerIds&&u.type!=="mouseover"&&u.type!=="mouseout"&&(u.features=this._hoveredFeatures||this._queryRenderedFeatures(u.point)),d(u),delete u.features)},this._onCameraEvent=u=>{if(!this._internalUpdate){const d=this.props[lb[u.type]];d&&d(u)}u.type in this._deferredEvents&&(this._deferredEvents[u.type]=!1)},this._MapClass=e,this.props=n,this._initialize(a)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const a=this._updateSettings(e,n);a&&this._createShadowTransform(this._map);const u=this._updateSize(e),d=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(a||u||d&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const a=Dd.savedMaps.pop();if(!a)return null;const u=a.map,d=u.getContainer();for(n.className=d.className;d.childNodes.length>0;)n.appendChild(d.childNodes[0]);u._container=n;const _=u._resizeObserver;_&&(_.disconnect(),_.observe(n)),a.setProps({...e,styleDiffing:!1}),u.resize();const{initialViewState:l}=e;return l&&(l.bounds?u.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):a._updateViewState(l,!1)),u.isStyleLoaded()?u.fire("load"):u.once("styledata",()=>u.fire("load")),u._update(),a}_initialize(e){const{props:n}=this,{mapStyle:a=lP}=n,u={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||vV()||null,container:e,style:sP(a)},d=u.initialViewState||u.viewState||u;if(Object.assign(u,{center:[d.longitude||0,d.latitude||0],zoom:d.zoom||0,pitch:d.pitch||0,bearing:d.bearing||0}),n.gl){const C=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=C,n.gl)}const _=new this._MapClass(u);d.padding&&_.setPadding(d.padding),n.cursor&&(_.getCanvas().style.cursor=n.cursor),this._createShadowTransform(_);const l=_._render;_._render=C=>{this._inRender=!0,l.call(_,C),this._inRender=!1};const w=_._renderTaskQueue.run;_._renderTaskQueue.run=C=>{w.call(_._renderTaskQueue,C),this._onBeforeRepaint()},_.on("render",()=>this._onAfterRepaint());const T=_.fire;_.fire=this._fireEvent.bind(this,T),_.on("resize",()=>{this._renderTransform.resize(_.transform.width,_.transform.height)}),_.on("styledata",()=>{this._updateStyleComponents(this.props,{}),iP(_.transform,this._renderTransform)}),_.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const C in cP)_.on(C,this._onPointerEvent);for(const C in lb)_.on(C,this._onCameraEvent);for(const C in uP)_.on(C,this._onEvent);this._map=_}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Dd.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=mV(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const a=this._map;if(n.width!==a.transform.width||n.height!==a.transform.height)return a.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const a=this._map,u=this._renderTransform,{zoom:d,pitch:_,bearing:l}=u,w=a.isMoving();w&&(u.cameraElevationReference="sea");const T=aP(u,{...oP(a.transform),...e});if(w&&(u.cameraElevationReference="ground"),T&&n){const C=this._deferredEvents;C.move=!0,C.zoom||(C.zoom=d!==u.zoom),C.rotate||(C.rotate=l!==u.bearing),C.pitch||(C.pitch=_!==u.pitch)}return w||aP(a.transform,e),T}_updateSettings(e,n){const a=this._map;let u=!1;for(const d of yV)if(d in e&&!nl(e[d],n[d])){u=!0;const _=a[`set${d[0].toUpperCase()}${d.slice(1)}`];_==null||_.call(a,e[d])}return u}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:a=lP,styleDiffing:u=!0}=e,d={diff:u};return"localIdeographFontFamily"in e&&(d.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(sP(a),d),!0}return!1}_updateStyleComponents(e,n){const a=this._map;let u=!1;return a.isStyleLoaded()&&("light"in e&&a.setLight&&!nl(e.light,n.light)&&(u=!0,a.setLight(e.light)),"fog"in e&&a.setFog&&!nl(e.fog,n.fog)&&(u=!0,a.setFog(e.fog)),"terrain"in e&&a.setTerrain&&!nl(e.terrain,n.terrain)&&(!e.terrain||a.getSource(e.terrain.source))&&(u=!0,a.setTerrain(e.terrain))),u}_updateHandlers(e,n){var a,u;const d=this._map;let _=!1;for(const l of _V){const w=(a=e[l])!==null&&a!==void 0?a:!0,T=(u=n[l])!==null&&u!==void 0?u:!0;nl(w,T)||(_=!0,w?d[l].enable(w):d[l].disable())}return _}_queryRenderedFeatures(e){const n=this._map,a=n.transform,{interactiveLayerIds:u=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:u.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=a}}_updateHover(e){var n;const{props:a}=this;if(a.interactiveLayerIds&&(a.onMouseMove||a.onMouseEnter||a.onMouseLeave)){const d=e.type,_=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,l=this._queryRenderedFeatures(e.point),w=l.length>0;!w&&_&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,w&&!_&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=d}else this._hoveredFeatures=null}_fireEvent(e,n,a){const u=this._map,d=u.transform,_=typeof n=="string"?n:n.type;return _==="move"&&this._updateViewState(this.props,!1),_ in lb&&(typeof n=="object"&&(n.viewState=oP(d)),this._map.isMoving())?(u.transform=this._renderTransform,e.call(u,n,a),u.transform=d,u):(e.call(u,n,a),u)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const a in this._deferredEvents)this._deferredEvents[a]&&e.fire(a);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{iP(this._renderTransform,n),e.transform=n}}}Dd.savedMaps=[];function vV(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||void 0}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const xV=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function bV(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:a=>{const u=e.transform;e.transform=t.transform;const d=e.project(a);return e.transform=u,d},unproject:a=>{const u=e.transform;e.transform=t.transform;const d=e.unproject(a);return e.transform=u,d},queryTerrainElevation:(a,u)=>{const d=e.transform;e.transform=t.transform;const _=e.queryTerrainElevation(a,u);return e.transform=d,_},queryRenderedFeatures:(a,u)=>{const d=e.transform;e.transform=t.transform;const _=e.queryRenderedFeatures(a,u);return e.transform=d,_}};for(const a of wV(e))!(a in n)&&!xV.includes(a)&&(n[a]=e[a].bind(e));return n}function wV(t){const e=new Set;let n=t;for(;n;){for(const a of Object.getOwnPropertyNames(n))a[0]!=="_"&&typeof t[a]=="function"&&a!=="fire"&&a!=="setEventedParent"&&e.add(a);n=Object.getPrototypeOf(n)}return Array.from(e)}const EV=typeof document<"u"?kt.useLayoutEffect:kt.useEffect,SV=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function TV(t,e){for(const a of SV)a in e&&(t[a]=e[a]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,a=>{a&&console.error(a)},!0)}const lv=kt.createContext(null);function AV(t,e,n){const a=kt.useContext(pV),[u,d]=kt.useState(null),_=kt.useRef(),{current:l}=kt.useRef({mapLib:null,map:null});kt.useEffect(()=>{const C=t.mapLib;let P=!0,z;return Promise.resolve(C||n).then($=>{if(!P)return;if(!$)throw new Error("Invalid mapLib");const U="Map"in $?$:$.default;if(!U.Map)throw new Error("Invalid mapLib");if(TV(U,t),!U.supported||U.supported(t))t.reuseMaps&&(z=Dd.reuse(t,_.current)),z||(z=new Dd(U.Map,t,_.current)),l.map=bV(z),l.mapLib=U,d(z),a==null||a.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}).catch($=>{const{onError:U}=t;U?U({type:"error",target:null,originalEvent:null,error:$}):console.error($)}),()=>{P=!1,z&&(a==null||a.onMapUnmount(t.id),t.reuseMaps?z.recycle():z.destroy())}},[]),EV(()=>{u&&u.setProps(t)}),kt.useImperativeHandle(e,()=>l.map,[u]);const w=kt.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),T={height:"100%"};return kt.createElement("div",{id:t.id,ref:_,style:w},u&&kt.createElement(lv.Provider,{value:l},kt.createElement("div",{"mapboxgl-children":"",style:T},t.children)))}const IV=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Lu(t,e){if(!t||!e)return;const n=t.style;for(const a in e){const u=e[a];Number.isFinite(u)&&!IV.test(a)?n[a]=`${u}px`:n[a]=u}}function CV(t,e){const{map:n,mapLib:a}=kt.useContext(lv),u=kt.useRef({props:t});u.current.props=t;const d=kt.useMemo(()=>{let W=!1;kt.Children.forEach(t.children,R=>{R&&(W=!0)});const N={...t,element:W?document.createElement("div"):null},V=new a.Marker(N);return V.setLngLat([t.longitude,t.latitude]),V.getElement().addEventListener("click",R=>{var F,H;(H=(F=u.current.props).onClick)===null||H===void 0||H.call(F,{type:"click",target:V,originalEvent:R})}),V.on("dragstart",R=>{var F,H;const J=R;J.lngLat=d.getLngLat(),(H=(F=u.current.props).onDragStart)===null||H===void 0||H.call(F,J)}),V.on("drag",R=>{var F,H;const J=R;J.lngLat=d.getLngLat(),(H=(F=u.current.props).onDrag)===null||H===void 0||H.call(F,J)}),V.on("dragend",R=>{var F,H;const J=R;J.lngLat=d.getLngLat(),(H=(F=u.current.props).onDragEnd)===null||H===void 0||H.call(F,J)}),V},[]);kt.useEffect(()=>(d.addTo(n.getMap()),()=>{d.remove()}),[]);const{longitude:_,latitude:l,offset:w,style:T,draggable:C=!1,popup:P=null,rotation:z=0,rotationAlignment:$="auto",pitchAlignment:U="auto"}=t;return kt.useEffect(()=>{Lu(d.getElement(),T)},[T]),kt.useImperativeHandle(e,()=>d,[]),(d.getLngLat().lng!==_||d.getLngLat().lat!==l)&&d.setLngLat([_,l]),w&&!fV(d.getOffset(),w)&&d.setOffset(w),d.isDraggable()!==C&&d.setDraggable(C),d.getRotation()!==z&&d.setRotation(z),d.getRotationAlignment()!==$&&d.setRotationAlignment($),d.getPitchAlignment()!==U&&d.setPitchAlignment(U),d.getPopup()!==P&&d.setPopup(P),GS.createPortal(t.children,d.getElement())}const kV=kt.memo(kt.forwardRef(CV));function hP(t){return new Set(t?t.trim().split(/\s+/):[])}function PV(t,e){const{map:n,mapLib:a}=kt.useContext(lv),u=kt.useMemo(()=>document.createElement("div"),[]),d=kt.useRef({props:t});d.current.props=t;const _=kt.useMemo(()=>{const l={...t},w=new a.Popup(l);return w.setLngLat([t.longitude,t.latitude]),w.once("open",T=>{var C,P;(P=(C=d.current.props).onOpen)===null||P===void 0||P.call(C,T)}),w},[]);if(kt.useEffect(()=>{const l=w=>{var T,C;(C=(T=d.current.props).onClose)===null||C===void 0||C.call(T,w)};return _.on("close",l),_.setDOMContent(u).addTo(n.getMap()),()=>{_.off("close",l),_.isOpen()&&_.remove()}},[]),kt.useEffect(()=>{Lu(_.getElement(),t.style)},[t.style]),kt.useImperativeHandle(e,()=>_,[]),_.isOpen()&&((_.getLngLat().lng!==t.longitude||_.getLngLat().lat!==t.latitude)&&_.setLngLat([t.longitude,t.latitude]),t.offset&&!nl(_.options.offset,t.offset)&&_.setOffset(t.offset),(_.options.anchor!==t.anchor||_.options.maxWidth!==t.maxWidth)&&(_.options.anchor=t.anchor,_.setMaxWidth(t.maxWidth)),_.options.className!==t.className)){const l=hP(_.options.className),w=hP(t.className);for(const T of l)w.has(T)||_.removeClassName(T);for(const T of w)l.has(T)||_.addClassName(T);_.options.className=t.className}return GS.createPortal(t.children,u)}kt.memo(kt.forwardRef(PV));function Nd(t,e,n,a){const u=kt.useContext(lv),d=kt.useMemo(()=>t(u),[]);return kt.useEffect(()=>{const _=a||n||e,l=typeof e=="function"&&typeof n=="function"?e:null,w=typeof n=="function"?n:typeof e=="function"?e:null,{map:T}=u;return T.hasControl(d)||(T.addControl(d,_==null?void 0:_.position),l&&l(u)),()=>{w&&w(u),T.hasControl(d)&&T.removeControl(d)}},[]),d}function DV(t){const e=Nd(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return kt.useEffect(()=>{Lu(e._container,t.style)},[t.style]),null}kt.memo(DV);function MV(t){const e=Nd(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return kt.useEffect(()=>{Lu(e._controlContainer,t.style)},[t.style]),null}kt.memo(MV);function zV(t,e){const n=kt.useRef({props:t}),a=Nd(({mapLib:u})=>{const d=new u.GeolocateControl(t),_=d._setupUI;return d._setupUI=l=>{d._container.hasChildNodes()||_(l)},d.on("geolocate",l=>{var w,T;(T=(w=n.current.props).onGeolocate)===null||T===void 0||T.call(w,l)}),d.on("error",l=>{var w,T;(T=(w=n.current.props).onError)===null||T===void 0||T.call(w,l)}),d.on("outofmaxbounds",l=>{var w,T;(T=(w=n.current.props).onOutOfMaxBounds)===null||T===void 0||T.call(w,l)}),d.on("trackuserlocationstart",l=>{var w,T;(T=(w=n.current.props).onTrackUserLocationStart)===null||T===void 0||T.call(w,l)}),d.on("trackuserlocationend",l=>{var w,T;(T=(w=n.current.props).onTrackUserLocationEnd)===null||T===void 0||T.call(w,l)}),d},{position:t.position});return n.current.props=t,kt.useImperativeHandle(e,()=>a,[]),kt.useEffect(()=>{Lu(a._container,t.style)},[t.style]),null}const RV=kt.memo(kt.forwardRef(zV));function OV(t){const e=Nd(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return kt.useEffect(()=>{Lu(e._container,t.style)},[t.style]),null}const FV=kt.memo(OV);function LV(t){const e=Nd(({mapLib:d})=>new d.ScaleControl(t),{position:t.position}),n=kt.useRef(t),a=n.current;n.current=t;const{style:u}=t;return t.maxWidth!==void 0&&t.maxWidth!==a.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==a.unit&&e.setUnit(t.unit),kt.useEffect(()=>{Lu(e._container,u)},[u]),null}const BV=kt.memo(LV),NV=dV(()=>Promise.resolve().then(()=>y$),void 0),UV=(()=>kt.forwardRef(function(e,n){return AV(e,n,NV)}))(),ZR=kV,jV=FV,VV=RV,$V=BV;var Ud=GV,WV=Object.prototype.hasOwnProperty;function GV(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var a in n)WV.call(n,a)&&(t[a]=n[a])}return t}var KR={exports:{}};(function(t,e){(function(){var n={};t.exports=n,n.simpleFilter=function(a,u){return u.filter(function(d){return n.test(a,d)})},n.test=function(a,u){return n.match(a,u)!==null},n.match=function(a,u,d){d=d||{};var _=0,l=[],w=u.length,T=0,C=0,P=d.pre||"",z=d.post||"",$=d.caseSensitive&&u||u.toLowerCase(),U;a=d.caseSensitive&&a||a.toLowerCase();for(var W=0;W<w;W++)U=u[W],$[W]===a[_]?(U=P+U+z,_+=1,C+=1+C):C=0,T+=C,l[l.length]=U;return _===a.length?(T=$===a?1/0:T,{rendered:l.join(""),score:T}):null},n.filter=function(a,u,d){return!u||u.length===0?[]:typeof a!="string"?u:(d=d||{},u.reduce(function(_,l,w,T){var C=l;d.extract&&(C=d.extract(l));var P=n.match(a,C,d);return P!=null&&(_[_.length]={string:P.rendered,score:P.score,index:w,original:l}),_},[]).sort(function(_,l){var w=l.score-_.score;return w||_.index-l.index}))}})()})(KR);var HV=KR.exports,xo=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};xo.prototype.show=function(){this.element.style.display="block"};xo.prototype.hide=function(){this.element.style.display="none"};xo.prototype.add=function(t){this.items.push(t)};xo.prototype.clear=function(){this.items=[],this.active=0};xo.prototype.isEmpty=function(){return!this.items.length};xo.prototype.isVisible=function(){return this.element.style.display==="block"};xo.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()};xo.prototype.drawItem=function(t,e){var n=document.createElement("li"),a=document.createElement("a");e&&(n.className+=" active"),a.innerHTML=t.string,n.appendChild(a),this.element.appendChild(n),n.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),n.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,t)}).bind(this))};xo.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()};xo.prototype.move=function(t){this.active=t,this.draw()};xo.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};xo.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};xo.prototype.drawError=function(t){var e=document.createElement("li");e.innerHTML=t,this.element.appendChild(e),this.show()};var qV=xo,ZV=Ud,KV=HV,XV=qV,Gi=function(t,e,n){return n=n||{},this.options=ZV({minLength:2,limit:5,filter:!0,hideOnBlur:!0},n),this.el=t,this.data=e||[],this.list=new XV(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(a){this.handleKeyUp(a.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(a){this.handleKeyDown(a)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(a){this.handlePaste(a)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Gi.prototype.handleKeyUp=function(t){t===40||t===38||t===27||t===13||t===9||this.handleInputChange(this.el.value)};Gi.prototype.handleKeyDown=function(t){switch(t.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&t.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Gi.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Gi.prototype.handlePaste=function(t){if(t.clipboardData)this.handleInputChange(t.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(t.target.value)},100)}};Gi.prototype.handleInputChange=function(t){if(this.query=this.normalize(t),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var n=0;n<e.length&&(this.list.add(e[n]),n!==this.options.limit-1);n++);this.list.draw()}).bind(this))};Gi.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Gi.prototype.update=function(t){this.data=t,this.handleKeyUp()};Gi.prototype.clear=function(){this.data=[],this.list.clear()};Gi.prototype.normalize=function(t){return t=t.toLowerCase(),t};Gi.prototype.match=function(t,e){return t.indexOf(e)>-1};Gi.prototype.value=function(t){if(this.selected=t,this.el.value=this.getItemValue(t),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")};Gi.prototype.getCandidates=function(t){var e={pre:"<strong>",post:"</strong>",extract:(function(a){return this.getItemValue(a)}).bind(this)},n;this.options.filter?(n=KV.filter(this.query,this.data,e),n=n.map((function(a){return{original:a.original,string:this.render(a.original,a.string)}}).bind(this))):n=this.data.map((function(a){var u=this.render(a);return{original:a,string:u}}).bind(this)),t(n)};Gi.prototype.getItemValue=function(t){return t};Gi.prototype.render=function(t,e){if(e)return e;for(var n=t.original?this.getItemValue(t.original):this.getItemValue(t),a=this.normalize(n),u=a.lastIndexOf(this.query);u>-1;){var d=u+this.query.length;n=n.slice(0,u)+"<strong>"+n.slice(u,d)+"</strong>"+n.slice(d),u=a.slice(0,u).lastIndexOf(this.query)}return n};Gi.prototype.renderError=function(t){this.list.drawError(t)};var YV=Gi,XR=YV,QV=XR;typeof window<"u"&&(window.Suggestions=XR);var JV="Expected a function",dP=0/0,e7="[object Symbol]",t7=/^\s+|\s+$/g,r7=/^[-+]0x[0-9a-f]+$/i,n7=/^0b[01]+$/i,i7=/^0o[0-7]+$/i,o7=parseInt,a7=typeof $e=="object"&&$e&&$e.Object===Object&&$e,s7=typeof self=="object"&&self&&self.Object===Object&&self,l7=a7||s7||Function("return this")(),c7=Object.prototype,u7=c7.toString,h7=Math.max,d7=Math.min,cb=function(){return l7.Date.now()};function p7(t,e,n){var a,u,d,_,l,w,T=0,C=!1,P=!1,z=!0;if(typeof t!="function")throw new TypeError(JV);e=pP(e)||0,UE(n)&&(C=!!n.leading,P="maxWait"in n,d=P?h7(pP(n.maxWait)||0,e):d,z="trailing"in n?!!n.trailing:z);function $(te){var se=a,ge=u;return a=u=void 0,T=te,_=t.apply(ge,se),_}function U(te){return T=te,l=setTimeout(V,e),C?$(te):_}function W(te){var se=te-w,ge=te-T,xe=e-se;return P?d7(xe,d-ge):xe}function N(te){var se=te-w,ge=te-T;return w===void 0||se>=e||se<0||P&&ge>=d}function V(){var te=cb();if(N(te))return R(te);l=setTimeout(V,W(te))}function R(te){return l=void 0,z&&a?$(te):(a=u=void 0,_)}function F(){l!==void 0&&clearTimeout(l),T=0,a=w=u=l=void 0}function H(){return l===void 0?_:R(cb())}function J(){var te=cb(),se=N(te);if(a=arguments,u=this,w=te,se){if(l===void 0)return U(w);if(P)return l=setTimeout(V,e),$(w)}return l===void 0&&(l=setTimeout(V,e)),_}return J.cancel=F,J.flush=H,J}function UE(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function f7(t){return!!t&&typeof t=="object"}function m7(t){return typeof t=="symbol"||f7(t)&&u7.call(t)==e7}function pP(t){if(typeof t=="number")return t;if(m7(t))return dP;if(UE(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=UE(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(t7,"");var n=n7.test(t);return n||i7.test(t)?o7(t.slice(2),n?2:8):r7.test(t)?dP:+t}var g7=p7,oT={exports:{}},wd=typeof Reflect=="object"?Reflect:null,fP=wd&&typeof wd.apply=="function"?wd.apply:function(e,n,a){return Function.prototype.apply.call(e,n,a)},Yy;wd&&typeof wd.ownKeys=="function"?Yy=wd.ownKeys:Object.getOwnPropertySymbols?Yy=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Yy=function(e){return Object.getOwnPropertyNames(e)};function y7(t){console&&console.warn&&console.warn(t)}var YR=Number.isNaN||function(e){return e!==e};function Jr(){Jr.init.call(this)}oT.exports=Jr;oT.exports.once=b7;Jr.EventEmitter=Jr;Jr.prototype._events=void 0;Jr.prototype._eventsCount=0;Jr.prototype._maxListeners=void 0;var mP=10;function cv(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Jr,"defaultMaxListeners",{enumerable:!0,get:function(){return mP},set:function(t){if(typeof t!="number"||t<0||YR(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");mP=t}});Jr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Jr.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||YR(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function QR(t){return t._maxListeners===void 0?Jr.defaultMaxListeners:t._maxListeners}Jr.prototype.getMaxListeners=function(){return QR(this)};Jr.prototype.emit=function(e){for(var n=[],a=1;a<arguments.length;a++)n.push(arguments[a]);var u=e==="error",d=this._events;if(d!==void 0)u=u&&d.error===void 0;else if(!u)return!1;if(u){var _;if(n.length>0&&(_=n[0]),_ instanceof Error)throw _;var l=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw l.context=_,l}var w=d[e];if(w===void 0)return!1;if(typeof w=="function")fP(w,this,n);else for(var T=w.length,C=n3(w,T),a=0;a<T;++a)fP(C[a],this,n);return!0};function JR(t,e,n,a){var u,d,_;if(cv(n),d=t._events,d===void 0?(d=t._events=Object.create(null),t._eventsCount=0):(d.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),d=t._events),_=d[e]),_===void 0)_=d[e]=n,++t._eventsCount;else if(typeof _=="function"?_=d[e]=a?[n,_]:[_,n]:a?_.unshift(n):_.push(n),u=QR(t),u>0&&_.length>u&&!_.warned){_.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=_.length,y7(l)}return t}Jr.prototype.addListener=function(e,n){return JR(this,e,n,!1)};Jr.prototype.on=Jr.prototype.addListener;Jr.prototype.prependListener=function(e,n){return JR(this,e,n,!0)};function _7(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function e3(t,e,n){var a={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},u=_7.bind(a);return u.listener=n,a.wrapFn=u,u}Jr.prototype.once=function(e,n){return cv(n),this.on(e,e3(this,e,n)),this};Jr.prototype.prependOnceListener=function(e,n){return cv(n),this.prependListener(e,e3(this,e,n)),this};Jr.prototype.removeListener=function(e,n){var a,u,d,_,l;if(cv(n),u=this._events,u===void 0)return this;if(a=u[e],a===void 0)return this;if(a===n||a.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete u[e],u.removeListener&&this.emit("removeListener",e,a.listener||n));else if(typeof a!="function"){for(d=-1,_=a.length-1;_>=0;_--)if(a[_]===n||a[_].listener===n){l=a[_].listener,d=_;break}if(d<0)return this;d===0?a.shift():v7(a,d),a.length===1&&(u[e]=a[0]),u.removeListener!==void 0&&this.emit("removeListener",e,l||n)}return this};Jr.prototype.off=Jr.prototype.removeListener;Jr.prototype.removeAllListeners=function(e){var n,a,u;if(a=this._events,a===void 0)return this;if(a.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):a[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete a[e]),this;if(arguments.length===0){var d=Object.keys(a),_;for(u=0;u<d.length;++u)_=d[u],_!=="removeListener"&&this.removeAllListeners(_);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=a[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(u=n.length-1;u>=0;u--)this.removeListener(e,n[u]);return this};function t3(t,e,n){var a=t._events;if(a===void 0)return[];var u=a[e];return u===void 0?[]:typeof u=="function"?n?[u.listener||u]:[u]:n?x7(u):n3(u,u.length)}Jr.prototype.listeners=function(e){return t3(this,e,!0)};Jr.prototype.rawListeners=function(e){return t3(this,e,!1)};Jr.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):r3.call(t,e)};Jr.prototype.listenerCount=r3;function r3(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Jr.prototype.eventNames=function(){return this._eventsCount>0?Yy(this._events):[]};function n3(t,e){for(var n=new Array(e),a=0;a<e;++a)n[a]=t[a];return n}function v7(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function x7(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function b7(t,e){return new Promise(function(n,a){function u(_){t.removeListener(e,d),a(_)}function d(){typeof t.removeListener=="function"&&t.removeListener("error",u),n([].slice.call(arguments))}i3(t,e,d,{once:!0}),e!=="error"&&w7(t,u,{once:!0})})}function w7(t,e,n){typeof t.on=="function"&&i3(t,"error",e,n)}function i3(t,e,n,a){if(typeof t.on=="function")a.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function u(d){a.once&&t.removeEventListener(e,u),n(d)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var E7=oT.exports,S7={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function T7(t){var e=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return e?{key:e[1],value:e[2]}:null}function A7(t){var e=t.match(/<?([^>]*)>(.*)/);if(!e)return null;var n=e[1],a=e[2].split(";"),u=null,d=a.reduce(function(_,l){var w=T7(l);return w?w.key==="rel"?(u||(u=w.value),_):(_[w.key]=w.value,_):_},{});return u?{url:n,rel:u,params:d}:null}function I7(t){return t?t.split(/,\s*</).reduce(function(e,n){var a=A7(n);if(!a)return e;var u=a.rel.split(/\s+/);return u.forEach(function(d){e[d]||(e[d]={url:a.url,params:a.params})}),e},{}):{}}var C7=I7,k7=C7;function aT(t,e){this.request=t,this.headers=e.headers,this.rawBody=e.body,this.statusCode=e.statusCode;try{this.body=JSON.parse(e.body||"{}")}catch{this.body=e.body}this.links=k7(this.headers.link)}aT.prototype.hasNextPage=function(){return!!this.links.next};aT.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var P7=aT,uv={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},gP=uv;function D7(t){var e=t.type||gP.ERROR_HTTP,n;if(t.body)try{n=JSON.parse(t.body)}catch{n=t.body}else n=null;var a=t.message||null;a||(typeof n=="string"?a=n:n&&typeof n.message=="string"?a=n.message:e===gP.ERROR_REQUEST_ABORTED&&(a="Request aborted")),this.message=a,this.type=e,this.statusCode=t.statusCode||null,this.request=t.request,this.body=n}var M7=D7;function z7(t){var e=t.indexOf(":"),n=t.substring(0,e).trim().toLowerCase(),a=t.substring(e+1).trim();return{name:n,value:a}}function R7(t){var e={};return t&&t.trim().split(/[\r|\n]+/).forEach(function(n){var a=z7(n);e[a.name]=a.value}),e}var O7=R7,F7=P7,yP=M7,ub=uv,L7=O7,P_={};function B7(t){var e=P_[t.id];e&&(e.abort(),delete P_[t.id])}function N7(t,e){return new F7(t,{body:e.response,headers:L7(e.getAllResponseHeaders()),statusCode:e.status})}function _P(t){var e=t.total,n=t.loaded,a=100*n/e;return{total:e,transferred:n,percent:a}}function o3(t,e){return new Promise(function(n,a){e.onprogress=function(_){t.emitter.emit(ub.EVENT_PROGRESS_DOWNLOAD,_P(_))};var u=t.file;u&&(e.upload.onprogress=function(_){t.emitter.emit(ub.EVENT_PROGRESS_UPLOAD,_P(_))}),e.onerror=function(_){a(_)},e.onabort=function(){var _=new yP({request:t,type:ub.ERROR_REQUEST_ABORTED});a(_)},e.onload=function(){if(delete P_[t.id],e.status<200||e.status>=400){var _=new yP({request:t,body:e.response,statusCode:e.status});a(_);return}n(e)};var d=t.body;typeof d=="string"?e.send(d):d?e.send(JSON.stringify(d)):u?e.send(u):e.send(),P_[t.id]=e}).then(function(n){return N7(t,n)})}function a3(t,e){var n=t.url(e),a=new window.XMLHttpRequest;return a.open(t.method,n),Object.keys(t.headers).forEach(function(u){a.setRequestHeader(u,t.headers[u])}),a}function U7(t){return Promise.resolve().then(function(){var e=a3(t,t.client.accessToken);return o3(t,e)})}var j7={browserAbort:B7,sendRequestXhr:o3,browserSend:U7,createRequestXhr:a3},D_={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */D_.exports;(function(t,e){(function(n){var a=e,u=t&&t.exports==a&&t,d=typeof $e=="object"&&$e;(d.global===d||d.window===d)&&(n=d);var _=function(U){this.message=U};_.prototype=new Error,_.prototype.name="InvalidCharacterError";var l=function(U){throw new _(U)},w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",T=/[\t\n\f\r ]/g,C=function(U){U=String(U).replace(T,"");var W=U.length;W%4==0&&(U=U.replace(/==?$/,""),W=U.length),(W%4==1||/[^+a-zA-Z0-9/]/.test(U))&&l("Invalid character: the string to be decoded is not correctly encoded.");for(var N=0,V,R,F="",H=-1;++H<W;)R=w.indexOf(U.charAt(H)),V=N%4?V*64+R:R,N++%4&&(F+=String.fromCharCode(255&V>>(-2*N&6)));return F},P=function(U){U=String(U),/[^\0-\xFF]/.test(U)&&l("The string to be encoded contains characters outside of the Latin1 range.");for(var W=U.length%3,N="",V=-1,R,F,H,J,te=U.length-W;++V<te;)R=U.charCodeAt(V)<<16,F=U.charCodeAt(++V)<<8,H=U.charCodeAt(++V),J=R+F+H,N+=w.charAt(J>>18&63)+w.charAt(J>>12&63)+w.charAt(J>>6&63)+w.charAt(J&63);return W==2?(R=U.charCodeAt(V)<<8,F=U.charCodeAt(++V),J=R+F,N+=w.charAt(J>>10)+w.charAt(J>>4&63)+w.charAt(J<<2&63)+"="):W==1&&(J=U.charCodeAt(V),N+=w.charAt(J>>2)+w.charAt(J<<4&63)+"=="),N},z={encode:P,decode:C,version:"0.1.0"};if(a&&!a.nodeType)if(u)u.exports=z;else for(var $ in z)z.hasOwnProperty($)&&(a[$]=z[$]);else n.base64=z})($e)})(D_,D_.exports);var V7=D_.exports,$7=V7,hb={};function W7(t){if(hb[t])return hb[t];var e=t.split("."),n=e[0],a=e[1];if(!a)throw new Error("Invalid token");var u=G7(a),d={usage:n,user:u.u};return fu(u,"a")&&(d.authorization=u.a),fu(u,"exp")&&(d.expires=u.exp*1e3),fu(u,"iat")&&(d.created=u.iat*1e3),fu(u,"scopes")&&(d.scopes=u.scopes),fu(u,"client")&&(d.client=u.client),fu(u,"ll")&&(d.lastLogin=u.ll),fu(u,"iu")&&(d.impersonator=u.iu),hb[t]=d,d}function G7(t){try{return JSON.parse($7.decode(t))}catch{throw new Error("Invalid token")}}function fu(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var s3=W7,l3={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function a(){}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(n=!1));function u(w,T,C){this.fn=w,this.context=T,this.once=C||!1}function d(w,T,C,P,z){if(typeof C!="function")throw new TypeError("The listener must be a function");var $=new u(C,P||w,z),U=n?n+T:T;return w._events[U]?w._events[U].fn?w._events[U]=[w._events[U],$]:w._events[U].push($):(w._events[U]=$,w._eventsCount++),w}function _(w,T){--w._eventsCount===0?w._events=new a:delete w._events[T]}function l(){this._events=new a,this._eventsCount=0}l.prototype.eventNames=function(){var T=[],C,P;if(this._eventsCount===0)return T;for(P in C=this._events)e.call(C,P)&&T.push(n?P.slice(1):P);return Object.getOwnPropertySymbols?T.concat(Object.getOwnPropertySymbols(C)):T},l.prototype.listeners=function(T){var C=n?n+T:T,P=this._events[C];if(!P)return[];if(P.fn)return[P.fn];for(var z=0,$=P.length,U=new Array($);z<$;z++)U[z]=P[z].fn;return U},l.prototype.listenerCount=function(T){var C=n?n+T:T,P=this._events[C];return P?P.fn?1:P.length:0},l.prototype.emit=function(T,C,P,z,$,U){var W=n?n+T:T;if(!this._events[W])return!1;var N=this._events[W],V=arguments.length,R,F;if(N.fn){switch(N.once&&this.removeListener(T,N.fn,void 0,!0),V){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,C),!0;case 3:return N.fn.call(N.context,C,P),!0;case 4:return N.fn.call(N.context,C,P,z),!0;case 5:return N.fn.call(N.context,C,P,z,$),!0;case 6:return N.fn.call(N.context,C,P,z,$,U),!0}for(F=1,R=new Array(V-1);F<V;F++)R[F-1]=arguments[F];N.fn.apply(N.context,R)}else{var H=N.length,J;for(F=0;F<H;F++)switch(N[F].once&&this.removeListener(T,N[F].fn,void 0,!0),V){case 1:N[F].fn.call(N[F].context);break;case 2:N[F].fn.call(N[F].context,C);break;case 3:N[F].fn.call(N[F].context,C,P);break;case 4:N[F].fn.call(N[F].context,C,P,z);break;default:if(!R)for(J=1,R=new Array(V-1);J<V;J++)R[J-1]=arguments[J];N[F].fn.apply(N[F].context,R)}}return!0},l.prototype.on=function(T,C,P){return d(this,T,C,P,!1)},l.prototype.once=function(T,C,P){return d(this,T,C,P,!0)},l.prototype.removeListener=function(T,C,P,z){var $=n?n+T:T;if(!this._events[$])return this;if(!C)return _(this,$),this;var U=this._events[$];if(U.fn)U.fn===C&&(!z||U.once)&&(!P||U.context===P)&&_(this,$);else{for(var W=0,N=[],V=U.length;W<V;W++)(U[W].fn!==C||z&&!U[W].once||P&&U[W].context!==P)&&N.push(U[W]);N.length?this._events[$]=N.length===1?N[0]:N:_(this,$)}return this},l.prototype.removeAllListeners=function(T){var C;return T?(C=n?n+T:T,this._events[C]&&_(this,C)):(this._events=new a,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=n,l.EventEmitter=l,t.exports=l})(l3);var H7=l3.exports;function q7(t){return t.map(encodeURIComponent).join(",")}function c3(t){return Array.isArray(t)?q7(t):encodeURIComponent(String(t))}function u3(t,e,n){if(n===!1||n===null)return t;var a=/\?/.test(t)?"&":"?",u=encodeURIComponent(e);return n!==void 0&&n!==""&&n!==!0&&(u+="="+c3(n)),""+t+a+u}function Z7(t,e){if(!e)return t;var n=t;return Object.keys(e).forEach(function(a){var u=e[a];u!==void 0&&(Array.isArray(u)&&(u=u.filter(function(d){return d!=null}).join(",")),n=u3(n,a,u))}),n}function K7(t,e){if(!e||t.slice(0,4)==="http")return t;var n=t[0]==="/"?"":"/";return""+e.replace(/\/$/,"")+n+t}function X7(t,e){return e?t.replace(/\/:([a-zA-Z0-9]+)/g,function(n,a){var u=e[a];if(u===void 0)throw new Error("Unspecified route parameter "+a);var d=c3(u);return"/"+d}):t}var Y7={appendQueryObject:Z7,appendQueryParam:u3,prependOrigin:K7,interpolateRouteParams:X7},Q7=s3,sT=Ud,J7=H7,Kg=Y7,vP=uv,e9=1;function _c(t,e){if(!t)throw new Error("MapiRequest requires a client");if(!e||!e.path||!e.method)throw new Error("MapiRequest requires an options object with path and method properties");var n={};e.body&&(n["content-type"]="application/json");var a=sT(n,e.headers),u=Object.keys(a).reduce(function(d,_){return d[_.toLowerCase()]=a[_],d},{});this.id=e9++,this._options=e,this.emitter=new J7,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=e.path,this.method=e.method,this.origin=e.origin||t.origin,this.query=e.query||{},this.params=e.params||{},this.body=e.body||null,this.file=e.file||null,this.encoding=e.encoding||"utf8",this.sendFileAs=e.sendFileAs||null,this.headers=u}_c.prototype.url=function(e){var n=Kg.prependOrigin(this.path,this.origin);n=Kg.appendQueryObject(n,this.query);var a=this.params,u=e??this.client.accessToken;if(u){n=Kg.appendQueryParam(n,"access_token",u);var d=Q7(u).user;a=sT({ownerId:d},a)}return n=Kg.interpolateRouteParams(n,a),n};_c.prototype.send=function(){var e=this;if(e.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return e.sent=!0,e.client.sendRequest(e).then(function(n){return e.response=n,e.emitter.emit(vP.EVENT_RESPONSE,n),n},function(n){throw e.error=n,e.emitter.emit(vP.EVENT_ERROR,n),n})};_c.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};_c.prototype.eachPage=function(e){var n=this;function a(_){function l(){delete n._nextPageRequest;var w=_.nextPage();w&&(n._nextPageRequest=w,d(w))}e(null,_,l)}function u(_){e(_,null,function(){})}function d(_){_.send().then(a,u)}d(this)};_c.prototype.clone=function(){return this._extend()};_c.prototype._extend=function(e){var n=sT(this._options,e);return new _c(this.client,n)};var t9=_c,r9=s3,n9=t9,i9=uv;function h3(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");r9(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||i9.API_ORIGIN}h3.prototype.createRequest=function(e){return new n9(this,e)};var d3=h3,p3=j7,f3=d3;function Md(t){f3.call(this,t)}Md.prototype=Object.create(f3.prototype);Md.prototype.constructor=Md;Md.prototype.sendRequest=p3.browserSend;Md.prototype.abortRequest=p3.browserAbort;function o9(t){return new Md(t)}var m3=o9,a9=m3,s9=a9,l9=Object.prototype.toString,c9=function(t){var e;return l9.call(t)==="[object Object]"&&(e=Object.getPrototypeOf(t),e===null||e===Object.getPrototypeOf({}))},u9=c9,h9=Ud,g3="value",db=`
  `,an={};an.assert=function(t,e){return e=e||{},function(n){var a=vc(t,n);if(a){var u=lT(a,e);throw e.apiName&&(u=e.apiName+": "+u),new Error(u)}}};an.shape=function(e){var n=m9(e);return function(u){var d=vc(an.plainObject,u);if(d)return d;for(var _,l,w=[],T=0;T<n.length;T++)_=n[T].key,l=n[T].value,d=vc(l,u[_]),d&&w.push([_].concat(d));return w.length<2?w[0]:function(C){w=w.map(function($){var U=$[0],W=lT($,C).split(`
`).join(db);return"- "+U+": "+W});var P=C.path.join("."),z=P===g3?"":" of "+P;return"The following properties"+z+" have invalid values:"+db+w.join(db)}}};an.strictShape=function(e){var n=an.shape(e);return function(u){var d=n(u);if(d)return d;var _=Object.keys(u).reduce(function(l,w){return e[w]===void 0&&l.push(w),l},[]);if(_.length!==0)return function(){return"The following keys are invalid: "+_.join(", ")}}};an.arrayOf=function(e){return y3(e)};an.tuple=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return y3(e)};function y3(t){var e=Array.isArray(t),n=function(a){return e?t[a]:t};return function(u){var d=vc(an.plainArray,u);if(d)return d;if(e&&u.length!==t.length)return"an array with "+t.length+" items";for(var _=0;_<u.length;_++)if(d=vc(n(_),u[_]),d)return[_].concat(d)}}an.required=function(e){function n(a){return a==null?function(u){return _3(u,v3(u.path)?"cannot be undefined/null.":"is required.")}:e.apply(this,arguments)}return n.__required=!0,n};an.oneOfType=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(a){var u=e.map(function(d){return vc(d,a)}).filter(Boolean);if(u.length===e.length)return u.every(function(d){return d.length===1&&typeof d[0]=="string"})?d9(u.map(function(d){return d[0]})):u.reduce(function(d,_){return _.length>d.length?_:d})}};an.equal=function(e){return function(a){if(a!==e)return JSON.stringify(e)}};an.oneOf=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),n=e.map(function(a){return an.equal(a)});return an.oneOfType.apply(this,n)};an.range=function(e){var n=e[0],a=e[1];return function(d){var _=vc(an.number,d);if(_||d<n||d>a)return"number between "+n+" & "+a+" (inclusive)"}};an.any=function(){};an.boolean=function(e){if(typeof e!="boolean")return"boolean"};an.number=function(e){if(typeof e!="number")return"number"};an.plainArray=function(e){if(!Array.isArray(e))return"array"};an.plainObject=function(e){if(!u9(e))return"object"};an.string=function(e){if(typeof e!="string")return"string"};an.func=function(e){if(typeof e!="function")return"function"};function vc(t,e){if(!(e==null&&!t.hasOwnProperty("__required"))){var n=t(e);if(n)return Array.isArray(n)?n:[n]}}function lT(t,e){var n=t.length,a=t[n-1],u=t.slice(0,n-1);return u.length===0&&(u=[g3]),e=h9(e,{path:u}),typeof a=="function"?a(e):_3(e,p9(a))}function d9(t){return t.length<2?t[0]:t.length===2?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function p9(t){return"must be "+f9(t)+"."}function f9(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function _3(t,e){var n=v3(t.path),a=t.path.join(".")+" "+e,u=n?"Item at position ":"";return u+a}function v3(t){return typeof t[t.length-1]=="number"||typeof t[0]=="number"}function m9(t){return Object.keys(t||{}).map(function(e){return{key:e,value:t[e]}})}an.validate=vc;an.processMessage=lT;var g9=an,y9=Ud,Ed=g9;function _9(t){if(typeof window<"u")return t instanceof $e.Blob||t instanceof $e.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof t=="string"||t.pipe!==void 0))return"Filename or Readable stream"}function v9(t,e){return Ed.assert(Ed.strictShape(t),e)}function x9(t){var e="date";if(typeof t=="boolean")return e;try{var n=new Date(t);if(n.getTime&&isNaN(n.getTime()))return e}catch{return e}}function b9(t){return Ed.tuple(Ed.number,Ed.number)(t)}var w9=y9(Ed,{file:_9,date:x9,coordinates:b9,assertShape:v9});function E9(t,e){var n=function(a,u){return e.indexOf(a)!==-1&&u!==void 0};return typeof e=="function"&&(n=e),Object.keys(t).filter(function(a){return n(a,t[a])}).reduce(function(a,u){return a[u]=t[u],a},{})}var S9=E9;function T9(t,e){return Object.keys(t).reduce(function(n,a){return n[a]=e(a,t[a]),n},{})}var A9=T9,I9=A9;function C9(t){return I9(t,function(e,n){return typeof n=="boolean"?JSON.stringify(n):n})}var k9=C9,P9=d3,D9=m3;function M9(t){return function(e){var n;P9.prototype.isPrototypeOf(e)?n=e:n=D9(e);var a=Object.create(t);return a.client=n,a}}var z9=M9,x3=Ud,Cr=w9,M_=S9,b3=k9,R9=z9,cT={},w3=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];cT.forwardGeocode=function(t){Cr.assertShape({query:Cr.required(Cr.string),mode:Cr.oneOf("mapbox.places","mapbox.places-permanent"),countries:Cr.arrayOf(Cr.string),proximity:Cr.oneOf(Cr.coordinates,"ip"),types:Cr.arrayOf(Cr.oneOf(w3)),autocomplete:Cr.boolean,bbox:Cr.arrayOf(Cr.number),limit:Cr.number,language:Cr.arrayOf(Cr.string),routing:Cr.boolean,fuzzyMatch:Cr.boolean,worldview:Cr.string})(t),t.mode=t.mode||"mapbox.places";var e=b3(x3({country:t.countries},M_(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:M_(t,["mode","query"]),query:e})};cT.reverseGeocode=function(t){Cr.assertShape({query:Cr.required(Cr.coordinates),mode:Cr.oneOf("mapbox.places","mapbox.places-permanent"),countries:Cr.arrayOf(Cr.string),types:Cr.arrayOf(Cr.oneOf(w3)),bbox:Cr.arrayOf(Cr.number),limit:Cr.number,language:Cr.arrayOf(Cr.string),reverseMode:Cr.oneOf("distance","score"),routing:Cr.boolean,worldview:Cr.string})(t),t.mode=t.mode||"mapbox.places";var e=b3(x3({country:t.countries},M_(t,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:M_(t,["mode","query"]),query:e})};var O9=R9(cT),F9=self.crypto||self.msCrypto,uT="-_",mc=36;for(;mc--;)uT+=mc.toString(36);mc=36;for(;mc---10;)uT+=mc.toString(36).toUpperCase();var L9=function(t){var e="",n=F9.getRandomValues(new Uint8Array(t||21));for(mc=t||21;mc--;)e+=uT[n[mc]&63];return e},B9=L9;function E3(t){this.origin=t.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=t.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=t,this.send=this.send.bind(this),this.countries=t.countries?t.countries.split(","):null,this.types=t.types?t.types.split(","):null,this.bbox=t.bbox?t.bbox:null,this.language=t.language?t.language.split(","):null,this.limit=t.limit?+t.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(t),this.eventQueue=new Array,this.flushInterval=t.flushInterval||1e3,this.maxQueueSize=t.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}E3.prototype={select:function(t,e){var n=this.getSelectedIndex(t,e),a=this.getEventPayload("search.select",e);if(a.resultIndex=n,a.resultPlaceName=t.place_name,a.resultId=t.id,!(n===this.lastSentIndex&&a.queryString===this.lastSentInput||n==-1)&&(this.lastSentIndex=n,this.lastSentInput=a.queryString,!!a.queryString))return this.push(a)},start:function(t){var e=this.getEventPayload("search.start",t);if(e.queryString)return this.push(e)},keyevent:function(t,e){if(t.key&&!(t.metaKey||[9,27,37,39,13,38,40].indexOf(t.keyCode)!==-1)){var n=this.getEventPayload("search.keystroke",e);if(n.lastAction=t.key,!!n.queryString)return this.push(n)}},send:function(t,e){if(!this.enableEventLogging)return e?e():void 0;var n=this.getRequestOptions(t);this.request(n,(function(a){if(a)return this.handleError(a,e);if(e)return e()}).bind(this))},getRequestOptions:function(t){Array.isArray(t)||(t=[t]);var e={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return e},getEventPayload:function(t,e){var n;e.options.proximity?n=[e.options.proximity.longitude,e.options.proximity.latitude]:n=null;var a=e._map?e._map.getZoom():void 0,u={event:t,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:e.options.autocomplete,fuzzyMatch:e.options.fuzzyMatch,proximity:n,limit:e.options.limit,routing:e.options.routing,worldview:e.options.worldview,mapZoom:a,keyboardLocale:this.locale};return t==="search.select"?u.queryString=e.inputString:t!="search.select"&&e._inputEl?u.queryString=e._inputEl.value:u.queryString=e.inputString,u},request:function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(this.readyState==4)return this.status==204?e(null):e(this.statusText)},n.open(t.method,t.host+"/"+t.path,!0);for(var a in t.headers){var u=t.headers[a];n.setRequestHeader(a,u)}n.send(t.body)},handleError:function(t,e){if(e)return e(t)},generateSessionID:function(){return B9()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(t,e){if(e._typeahead){var n=e._typeahead.data,a=t.id,u=n.map(function(_){return _.id}),d=u.indexOf(a);return d}},shouldEnableLogging:function(t){return!(t.enableEventLogging===!1||t.origin&&t.origin.indexOf("api.mapbox.com")==-1||t.localGeocoder||t.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(t,e){this.eventQueue.push(t),(this.eventQueue.length>=this.maxQueueSize||e)&&this.flush()},remove:function(){this.flush()}};var N9=E3,U9={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},j9={placeholder:U9},S3={exports:{}};(function(t){(function(e,n,a){t.exports?t.exports=a():e[n]=a()})($e,"subtag",function(){var e="",n=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function a(w){return w.match(n)||[]}function u(w){return a(w).filter(function(T,C){return T&&C})}function d(w){return w=a(w),{language:w[1]||e,extlang:w[2]||e,script:w[3]||e,region:w[4]||e}}function _(w,T,C){Object.defineProperty(w,T,{value:C,enumerable:!0})}function l(w,T,C){function P(z){return a(z)[w]||e}_(P,"pattern",T),_(d,C,P)}return l(1,/^[a-zA-Z]{2,3}$/,"language"),l(2,/^[a-zA-Z]{3}$/,"extlang"),l(3,/^[a-zA-Z]{4}$/,"script"),l(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),_(d,"split",u),d})})(S3);var V9=S3.exports,$9=QV,W9=g7,wu=Ud,G9=E7.EventEmitter,xP=S7,bP=s9,wP=O9,H9=N9,q9=j9,Z9=V9;const ql={FORWARD:0,LOCAL:1,REVERSE:2};function T3(t){this._eventEmitter=new G9,this.options=wu({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null}T3.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(t){return t.place_name},render:function(t){var e=t.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"}},addTo:function(t){function e(n,a){if(!document.body.contains(a))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const u=n.onAdd();a.appendChild(u)}if(t._controlContainer)t.addControl(this);else if(t instanceof HTMLElement)e(this,t);else if(typeof t=="string"){const n=document.querySelectorAll(t);if(n.length===0)throw new Error("Element ",t,"not found.");if(n.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,n[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(t){if(t&&typeof t!="string"&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=wP(bP({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new H9(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var n=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",W9(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(d){this.eventManager.keyevent(d,this)}).bind(this));var a=document.createElement("div");a.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var u=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(u),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),a.appendChild(this._clearEl),a.appendChild(this._loadingEl),e.appendChild(n),e.appendChild(this._inputEl),e.appendChild(a),this._typeahead=new $9(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),e},createIcon:function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");if(n.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+t),n.setAttribute("viewBox","0 0 18 18"),n.setAttribute("xml:space","preserve"),n.setAttribute("width",18),n.setAttribute("height",18),"innerHTML"in n)n.innerHTML=e;else{var a=document.createElement("div");a.innerHTML="<svg>"+e.valueOf().toString()+"</svg>";var u=a.firstChild,d=u.firstChild;n.appendChild(d)}return n},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(t){var e=(t.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this._geocode(e)},_onKeyDown:function(t){var e=27,n=9;if(t.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();var a=t.target&&t.target.shadowRoot?t.target.shadowRoot.activeElement:t.target,u=a?a.value:"";if(!u)return this.fresh=!0,t.keyCode!==n&&this.clear(t),this._clearEl.style.display="none";t.metaKey||[n,e,37,39,13,38,40].indexOf(t.keyCode)!==-1||a.value.length>=this.options.minLength&&this._geocode(a.value)},_showButton:function(){this._typeahead.selected&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()},_onChange:function(){var t=this._typeahead.selected;if(t&&JSON.stringify(t)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var e;if(t.properties&&xP[t.properties.short_code])e=wu({},this.options.flyTo),this._map&&this._map.fitBounds(xP[t.properties.short_code].bbox,e);else if(t.bbox){var n=t.bbox;e=wu({},this.options.flyTo),this._map&&this._map.fitBounds([[n[0],n[1]],[n[2],n[3]]],e)}else{var a={zoom:this.options.zoom};e=wu({},a,this.options.flyTo),t.center?e.center=t.center:t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&(e.center=t.geometry.coordinates),this._map&&this._map.flyTo(e)}}this.options.marker&&this._mapboxgl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._eventEmitter.emit("result",{result:t}),this.eventManager.select(t,this)}},_requestType:function(t,e){var n;const a=/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;return t.localGeocoderOnly?n=ql.LOCAL:t.reverseGeocode&&a.test(e)?n=ql.REVERSE:n=ql.FORWARD,n},_setupConfig:function(t,e){const n=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],a=/[\s,]+/;var u=this,d=n.reduce(function(l,w){if(u.options[w]===void 0||u.options[w]===null)return l;["countries","types","language"].indexOf(w)>-1?l[w]=u.options[w].split(a):l[w]=u.options[w];const T=typeof u.options[w].longitude=="number"&&typeof u.options[w].latitude=="number";if(w==="proximity"&&T){const C=u.options[w].longitude,P=u.options[w].latitude;l[w]=[C,P]}return l},{});switch(t){case ql.REVERSE:{var _=e.split(a).map(function(l){return parseFloat(l,10)}).reverse();d.types&&d.types[0],d=wu(d,{query:_,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(l){l in d&&delete d[l]})}break;case ql.FORWARD:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(e)&&(e=e.replace(/,/g," ")),d=wu(d,{query:e});break}return d},_geocode:function(t){this.inputString=t,this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:t});const e=this._requestType(this.options,t),n=this._setupConfig(e,t);var a;switch(e){case ql.LOCAL:a=Promise.resolve();break;case ql.FORWARD:a=this.geocoderService.forwardGeocode(n).send();break;case ql.REVERSE:a=this.geocoderService.reverseGeocode(n).send();break}var u=this.options.localGeocoder?this.options.localGeocoder(t)||[]:[],d=[],_=null;return a.catch((function(l){_=l}).bind(this)).then((function(l){this._loadingEl.style.display="none";var w={};return l?l.statusCode=="200"&&(w=l.body,w.request=l.request,w.headers=l.headers):w={type:"FeatureCollection",features:[]},w.config=n,this.fresh&&(this.eventManager.start(this),this.fresh=!1),w.features=w.features?u.concat(w.features):u,this.options.externalGeocoder?(d=this.options.externalGeocoder(t,w.features)||[],d.then(function(T){return w.features=w.features?T.concat(w.features):T,w},function(){return w})):w}).bind(this)).then((function(l){if(_)throw _;this.options.filter&&l.features.length&&(l.features=l.features.filter(this.options.filter)),l.features.length?(this._clearEl.style.display="block",this._eventEmitter.emit("results",l),this._typeahead.update(l.features)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",l))}).bind(this)).catch((function(l){this._loadingEl.style.display="none",u.length&&this.options.localGeocoder||d.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(u)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:u}),this._eventEmitter.emit("error",{error:l})}).bind(this)),a},_clear:function(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(t){this._clear(t),this._inputEl.focus()},_clearOnBlur:function(t){var e=this;t.relatedTarget&&e._clear(t)},_onQueryResult:function(t){var e=t.body;if(e.features.length){var n=e.features[0];this._typeahead.selected=n,this._inputEl.value=n.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(t){return this._geocode(t).then(this._onQueryResult),this},_renderError:function(){var t="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(t)},_renderNoResults:function(){var t="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(t)},_renderMessage:function(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var t=this.options.language.split(",")[0],e=Z9.language(t),n=q9.placeholder[e];if(n)return n}return"Search"},setInput:function(t){return this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&this._geocode(t),this},setProximity:function(t){return this.options.proximity=t,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(t){return t&&typeof t=="function"&&(this._typeahead.render=t),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(t){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=t||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(t){return this.options.zoom=t,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(t){return this.options.flyTo=t,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(t){return this.placeholder=t||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(t){return this.options.bbox=t,this},getCountries:function(){return this.options.countries},setCountries:function(t){return this.options.countries=t,this},getTypes:function(){return this.options.types},setTypes:function(t){return this.options.types=t,this},getMinLength:function(){return this.options.minLength},setMinLength:function(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this},getLimit:function(){return this.options.limit},setLimit:function(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this},getFilter:function(){return this.options.filter},setFilter:function(t){return this.options.filter=t,this},setOrigin:function(t){return this.options.origin=t,this.geocoderService=wP(bP({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAutocomplete:function(t){return this.options.autocomplete=t,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(t){return this.options.fuzzyMatch=t,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(t){return this.options.routing=t,this},getRouting:function(){return this.options.routing},setWorldview:function(t){return this.options.worldview=t,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(t){if(this._map){this._removeMarker();var e={color:"#4668F2"},n=wu({},e,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(n),t.center?this.mapMarker.setLngLat(t.center).addTo(this._map):t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(t,e){return this._eventEmitter.on(t,e),this},off:function(t,e){return this._eventEmitter.removeListener(t,e),this.eventManager.remove(),this}};var K9=T3;const X9=L_(K9);/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */function Y9(t){const[e,n]=kt.useState(null),a=Object.assign({},t),u=Nd(()=>{const d=new X9(Object.assign(Object.assign({},a),{marker:e||!1,accessToken:a.mapboxAccessToken}));return a.onLoading&&d.on("loading",a.onLoading),a.onResults&&d.on("results",a.onResults),a.onResult&&d.on("result",_=>{var l;a.onResult!==void 0&&a.onResult(_);const{result:w}=_,T=w&&(w.center||((l=w.geometry)===null||l===void 0?void 0:l.type)==="Point"&&w.geometry.coordinates);if(T&&a.marker){const C=typeof a.marker=="object"?a.marker:{};n(kt.createElement(ZR,Object.assign({},C,{longitude:T[0],latitude:T[1]})))}else n(null)}),a.onError&&d.on("error",a.onError),d},{position:a.position});return u.hasOwnProperty("_map")&&u._map&&(u.getProximity()!==a.proximity&&a.proximity!==void 0&&u.setProximity(a.proximity),u.getRenderFunction()!==a.render&&a.render!==void 0&&u.setRenderFunction(a.render),u.getLanguage()!==a.language&&a.language!==void 0&&u.setLanguage(a.language),u.getZoom()!==a.zoom&&a.zoom!==void 0&&u.setZoom(a.zoom),u.getFlyTo()!==a.flyTo&&a.flyTo!==void 0&&u.setFlyTo(a.flyTo),u.getPlaceholder()!==a.placeholder&&a.placeholder!==void 0&&u.setPlaceholder(a.placeholder),u.getCountries()!==a.countries&&a.countries!==void 0&&u.setCountries(a.countries),u.getTypes()!==a.types&&a.types!==void 0&&u.setTypes(a.types),u.getMinLength()!==a.minLength&&a.minLength!==void 0&&u.setMinLength(a.minLength),u.getLimit()!==a.limit&&a.limit!==void 0&&u.setLimit(a.limit),u.getFilter()!==a.filter&&a.filter!==void 0&&u.setFilter(a.filter),u.getOrigin()!==a.origin&&a.origin!==void 0&&u.setOrigin(a.origin),u.getAutocomplete()!==a.autocomplete&&a.autocomplete!==void 0&&u.setAutocomplete(a.autocomplete),u.getFuzzyMatch()!==a.fuzzyMatch&&a.fuzzyMatch!==void 0&&u.setFuzzyMatch(a.fuzzyMatch),u.getRouting()!==a.routing&&a.routing!==void 0&&u.setRouting(a.routing),u.getWorldview()!==a.worldview&&a.worldview!==void 0&&u.setWorldview(a.worldview)),e}/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */var Q9=8,J9="LIVE - CORI light basemap - county labels",e$={"mapbox:type":"default","mapbox:origin":"light-v10","mapbox:autocomposite":!0,"mapbox:groups":{"1444855769305.6016":{name:"Tunnels",collapsed:!0},"1444855786460.0557":{name:"Roads",collapsed:!0},"1444855799204.86":{name:"Bridges",collapsed:!0},"1444934295202.7542":{name:"Admin boundaries",collapsed:!1}},"mapbox:sdk-support":{js:"0.54.0",android:"7.4.0",ios:"4.10.0"},"mapbox:uiParadigm":"layers","mapbox:thumb":"data:image/webp;base64,UklGRmAJAABXRUJQVlA4TFQJAAAvO8AOAPX4drZtmWTXts7/wMzUqCCLGZOCMjCzbfx/1jFYYr9m+zeF5Gqx8bj3bozqqoouhWLj6dCYQqn+K1W6Vb1HB+Nn+HqXMatDQowkSVJTM/xwkv+mwu1OF8S2kRxJ7PyjfbMzs6a7+j8Be9jFwDSO7Za6ajtXwy/CHsEeYqSRsWzFQAbkSKlndkzfLGcN0zHLlJYZyNmbaOFmTdM0apq3d+t5Y906dr68rJ16zskdY1kaCWdraPJQE8CKlJazrjk+nrVM2/y0Q8ZpQtFux7BmD3bG8fxnncEJvUfnnPObbeMBsKIKWwJLA5PS8njL3DLP4CPmpnkG4+PxuFaBT22n9wiwUuTNx93WpXE+s4bmwJJyWCFwVAX3SJuMZ8fb5ic/uYKb5qc/HY+XqSvlgEmPIYI91BF5/X6fOW3Hpn0x7BGCGMgOIUVMAPdLSmn8xk/+ddM0zT/NUlqmDDhHT0NSj4pzfDEiNh53M7rOC/ElKUxkESgctcF75jilNBuP35gtU2kUjLo1fQicFbF5v7lCb488VM7WALsaKYd2zVFMDJBTSmn50/F4uY8oH9g2dlja+Pv3HebWDpZz2CAZV8BymTpIaTYb/3SZ9qXU6tvEuVU4hpI2Xye6NVcGNl5gQmAtIFJK47Qcj4/vYUcXT2V/e+hiR0dKjfeJAXNqGGNjZyGHYGhSSrPZcjkbH+83Acwe6dm7BBtfXc6umi7y9rHj4OwwIMkKSw5gmVJqm/FsNhvPlmlc+PcAb+MGLpNvvzvdHEb//8OovHFcQ+Yq/v9FAAPYcsiPFeA6pdTGbLkcz8YpXVyWKaW1nwkYRs7diBfOOr8KN/XMr5rQ0a5ZP9bB2pgIyCgcIBlYpJT6JqXl+HicUjv5Y0rp+jbBBm1ktlJfyo4HjVCu55uvNWTWNgGEcRjHAhvXJeOfjmep/JFd4HvbAxzyF3Odt55noJNjJLBCyEgTLJk6peO0PB7PlmVLsAG10hVYoHr+7tb9Xnc+Gq9LkmUp5EAAOaWOWc5mhcmkYAH+9Y69oGxQ5rm+/blu2ZcnO8ieP+xiF/UnHn5CsSdvpGRwWo4fz5bj8QTIKdUqxA4DhjDSXN3bt/Ha18gPbdnClr2jx9/+C/GJd2vFG1e2C6uWywDw0KQAUNdOEHYNtdW/9Ppr//pCNFKyMNiw+I5lm+I8GpNlnQuACwNyDES2sNDdYzNgTqQqy4CycbYlyn/fGMJR56jXN5Bxl/k8lnLsCjmL/zgc0lfHoSnKIiaEXOZssAXrI0t7EE3HQLYenf4V9p3x7Le+duJxX2Uu4IN6w2A8AvZRYLMfBfv7gOs6f/4Qh9THjV3bkxx+9L5vzc/c983rz+06z4+BKDFWCKySTMgGEOW5ydRzy6pCJj76rcn68b9LrtNns3fqsW0A+cjYLlkRkjH3+nFcfyKbqtCX7v4vzs98Z5ulUMGaHrGvbYdldC/acUDMI+ogY9183D4xWa0atXp1Br1lYw5HKnGOiHB2CO/nHtr6vCTlx0cmz3Gsv3eHObHhVctqJNe877Ab7FbtEc2e1A6XKBS5tkS5X360Y9aVjhVZn9gJGwSNx7N9/c6ZCgLgO3R6exWZUku4tlww9q0U0NLnbVRPI7tw57hOOqLMqjr1TIaJXRYSZIVsii+vgOg4skLzlWTD3c//qfA+yp242/sFnDDP4So+huswWBjmlsucf4/xnfEEj8BG783+2+m1R/Cwpne5evS5sQcLGVuteLpeZ7t/G9xbff0Z2zLAfWyKHbTUtLDN0QHWoN5OvctX2717l9Pva6cXffKx4bCViTpG+tVNnNTa5To8WwdB2UMAAw2Zon5/ALs1zbroWo0Y4X6velAf1fMDOyYxtTE8CTd9B3XbZaOa7TodvmY9vT4jvkIrjFmfqvz74xFhs1bO88CeoLNJpRweGiaO6s0RMyD5SJu+O73drb1VV6tOo9aXe3UGdR4CQ54G9w7T69Pt06SzDDx8Hqf1kXqv+rVsSi2rSZ6bubRsjXZYAOrTBwatmpl3mvaI2tXLv/+bbsw9QFv16qXf50bdXd7OZbV7/XOnV6/3p9ml79Y1ZDzSwgXLPLmji9aluLFNAQ9oAxZdfaknii934lsv8XK2bcAjuF9Pr6/O5W/1a0BhTB523M/AWetlA3tmaFOmXUO5w1i2AQLY0+L3n6c4MEOlxchsfJZ6hhtxcSoAnriA7AlgABsJMGZOcfFHk+sMho1j6TdNfOzUi6rwNkXLqsFl2GDLMjmA36dexbYL3nzu+M2J8ZIFfPpBwZZCtilmwEVh+P79qDeifhpzKNl4Pvdv2mupHWSAAUPx+47wnrFx4b4NBocBs4uqJf0XpTady3fw3Mhy/nZW2/5EGHBYVRgb3IEpWqZ0BlsZA7aFW5fuMyencAAHhvuQ8ye+/fD/fvUw4/vvtso8oiDLYLhPX08oOgYl4u6xhubkBMIc/hqo+UQYYmWxr3MIq5CJN2mq5wDKOdew+XfldefSRoX6NZKV69dHAMXLeD/AddTuqU85SNTfH1s4fAR07k8ekrXJlWXqeDtMNhXYR0F5VQKOHGHxcnyJ79kMC/ousDIHp7Zm2CMaCsbK1psuubIKWlaZrZyzye1oO4cmYwCZty45t7eYTIB/AiMHWlV+U9yrjE3k/E/yv9chv6lqOrXQ2oyrr1lzZ8DyAuNQR28WDBhTqMAR7/7MEACWb5ubKeJ7VUxdW8haAAK7otSADZji39Rd2pUKxPyjO8HTp+AHDmFccMG5BLBsF7xYrOIWzjJtvVtw/sKHF/sLgL9vCYxs4YKHZh8Zm1U1nZqa/PTXBuwdMiLP7OLgrULXSAaBsYRs38GW/rtgyWyMlV9EMSMdAKtGqu7Td3BzPBgxAOrjqKZ0wj16DETYvrZc31VRqj24OoBzp4u7vpT7zvk4OqBEuT4seAG4DFeWbLQ+9ZJclv13AxI8+yvIA/qFKR+AwSIfCVAFYJdAoG99F0uAASJ+7Xi5EzjuZk6s0hOYTLCZqwIsl4NhOjk0QLgQkevcYqaLo5VxjzyzJ/ltOJTB8wgDqICNVX3/cUwBt5OcFdkG/4OAbDbok6v49AOAgnrQJKaTmMi5qmKxcLBaev4vkeePDFjAp+cUg2cm51YN1WMoN56HKE4rgx0vnz19+Fc/ub79ZLILKw5pa4UxHOSSqQE="},t$=[-72.26808525539167,43.37747275058169],r$=10.873762090608595,n$=0,i$=2,o$={composite:{url:"mapbox://mapbox.mapbox-terrain-v2,mapbox.mapbox-streets-v8,ruralinno.2pv0vm2z,ruralinno.3v9y79ly,ruralinno.5639ssfg,ruralinno.c504wkuy,ruralinno.7stpbs93,ruralinno.cwz2k5qc,ruralinno.1joudpqe",type:"vector"}},a$="mapbox://sprites/ruralinno/cl010e7b7001p15pe3l0306hv/68n9slz9mfbus83an19oqbf32",s$="mapbox://fonts/ruralinno/{fontstack}/{range}.pbf",l$=[{id:"land",type:"background",layout:{},paint:{"background-color":"hsl(55, 0%, 100%)"}},{id:"landcover",type:"fill",source:"composite","source-layer":"landcover",maxzoom:7,layout:{},paint:{"fill-color":"hsl(0, 0%, 100%)","fill-opacity":["interpolate",["exponential",1.5],["zoom"],2,.1,7,0],"fill-antialias":!1}},{id:"national-park",type:"fill",source:"composite","source-layer":"landuse_overlay",minzoom:5,filter:["==",["get","class"],"national_park"],layout:{},paint:{"fill-color":"hsla(150, 6%, 93%, 0.63)","fill-opacity":["interpolate",["linear"],["zoom"],5,0,6,.5]}},{id:"landuse",type:"fill",source:"composite","source-layer":"landuse",minzoom:5,filter:["match",["get","class"],["park","airport","glacier","pitch","sand"],!0,!1],layout:{},paint:{"fill-opacity":["interpolate",["linear"],["zoom"],5,0,6,["match",["get","class"],"glacier",.5,1]],"fill-color":"hsl(150, 0%, 100%)"}},{id:"water-shadow",type:"fill",source:"composite","source-layer":"water",layout:{},paint:{"fill-translate-anchor":"viewport","fill-translate":["interpolate",["exponential",1.2],["zoom"],7,["literal",[0,0]],16,["literal",[-1,-1]]],"fill-color":"hsl(185, 7%, 73%)"}},{id:"waterway",type:"line",source:"composite","source-layer":"waterway",minzoom:8,layout:{"line-cap":["step",["zoom"],"butt",11,"round"],"line-join":"round"},paint:{"line-color":"hsl(187, 9%, 81%)","line-width":["interpolate",["exponential",1.3],["zoom"],9,["match",["get","class"],["canal","river"],.1,0],20,["match",["get","class"],["canal","river"],8,3]],"line-opacity":["interpolate",["linear"],["zoom"],8,0,8.5,1]}},{id:"water",type:"fill",source:"composite","source-layer":"water",layout:{},paint:{"fill-color":"#cad2d3","fill-opacity":.5}},{id:"hillshade",type:"fill",source:"composite","source-layer":"hillshade",minzoom:6,layout:{},paint:{"fill-color":["match",["get","class"],"shadow","hsl(0, 0%, 35%)","hsl(0, 0%, 100%)"],"fill-opacity":["interpolate",["linear"],["zoom"],12,["match",["get","level"],[67,56],.02,[89,78],.01,.015],15,0]}},{id:"land-structure-polygon",type:"fill",source:"composite","source-layer":"structure",minzoom:21.1,filter:["all",["==",["geometry-type"],"Polygon"],["==",["get","class"],"land"]],layout:{},paint:{"fill-color":"hsl(156, 20%, 95%)"}},{id:"land-structure-line",type:"line",source:"composite","source-layer":"structure",minzoom:13,filter:["all",["==",["geometry-type"],"LineString"],["==",["get","class"],"land"]],layout:{"line-cap":"round"},paint:{"line-width":["interpolate",["exponential",1.99],["zoom"],14,.75,20,40],"line-color":"hsl(156, 20%, 95%)"}},{id:"aeroway-polygon",type:"fill",source:"composite","source-layer":"aeroway",minzoom:11,filter:["all",["==",["geometry-type"],"Polygon"],["match",["get","type"],["runway","taxiway","helipad"],!0,!1]],layout:{},paint:{"fill-opacity":["interpolate",["linear"],["zoom"],11,0,11.5,1],"fill-color":"hsl(0, 0%, 97%)"}},{id:"aeroway-line",type:"line",source:"composite","source-layer":"aeroway",minzoom:9,filter:["==",["geometry-type"],"LineString"],layout:{},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],9,["match",["get","type"],"runway",1,.5],18,["match",["get","type"],"runway",80,20]],"line-color":"hsl(0, 0%, 97%)"}},{id:"building-outline",type:"line",source:"composite","source-layer":"building",minzoom:15,filter:["all",["!=",["get","type"],"building:part"],["==",["get","underground"],"false"]],layout:{},paint:{"line-color":"hsl(55, 3%, 87%)","line-width":["interpolate",["exponential",1.5],["zoom"],15,.75,20,3],"line-opacity":["interpolate",["linear"],["zoom"],15,0,16,1]}},{id:"building",type:"fill",source:"composite","source-layer":"building",minzoom:15,filter:["all",["!=",["get","type"],"building:part"],["==",["get","underground"],"false"]],layout:{},paint:{"fill-outline-color":"hsl(55, 3%, 87%)","fill-opacity":["interpolate",["linear"],["zoom"],15,0,16,1],"fill-color":"hsl(55, 5%, 91%)"}},{id:"tunnel-street-minor-low",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(185, 7%, 88%)","line-opacity":["step",["zoom"],1,14,0]}},{id:"tunnel-street-minor-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(185, 12%, 89%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-opacity":["step",["zoom"],0,14,1],"line-dasharray":[3,3]}},{id:"tunnel-primary-secondary-tertiary-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,["match",["get","class"],"primary",1,.75],18,2],"line-color":"hsl(185, 12%, 89%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,.1],18,["match",["get","class"],"primary",32,26]],"line-dasharray":[3,3]}},{id:"tunnel-major-link-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(185, 12%, 89%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-dasharray":[3,3]}},{id:"tunnel-motorway-trunk-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(185, 12%, 89%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-dasharray":[3,3]}},{id:"tunnel-construction",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"construction"],["==",["geometry-type"],"LineString"]],layout:{},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,18],"line-color":"hsl(187, 7%, 88%)","line-dasharray":["step",["zoom"],["literal",[.4,.8]],15,["literal",[.3,.6]],16,["literal",[.2,.3]],17,["literal",[.2,.25]],18,["literal",[.15,.15]]]}},{id:"tunnel-path",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"path"],["!=",["get","type"],"steps"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,18,4],"line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[1,.5]]],"line-color":"hsl(0, 0%, 85%)"}},{id:"tunnel-steps",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"steps"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,16,1.6,18,6],"line-color":"hsl(0, 0%, 85%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[.3,.3]]]}},{id:"tunnel-major-link",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(187, 7%, 88%)"}},{id:"tunnel-pedestrian",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"pedestrian"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,18,12],"line-color":"hsl(187, 7%, 88%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.5,.4]],16,["literal",[1,.2]]]}},{id:"tunnel-street-minor",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(187, 7%, 88%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"tunnel-primary-secondary-tertiary",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,.1],18,["match",["get","class"],"primary",32,26]],"line-color":"hsl(187, 7%, 88%)"}},{id:"tunnel-motorway-trunk",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":"hsl(187, 7%, 88%)"}},{id:"road-pedestrian-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"pedestrian"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,14.5],"line-color":"hsl(156, 12%, 92%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"road-minor-low",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["step",["zoom"],["==",["get","class"],"track"],14,["match",["get","class"],["track","secondary_link","tertiary_link","service"],!0,!1]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,["match",["get","class"],"track",1,.5],18,12],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],1,14,0]}},{id:"road-street-low",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:11,filter:["all",["match",["get","class"],["street","street_limited","primary_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],1,14,0]}},{id:"road-minor-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["step",["zoom"],["==",["get","class"],"track"],14,["match",["get","class"],["track","secondary_link","tertiary_link","service"],!0,!1]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],14,["match",["get","class"],"track",1,.5],18,12],"line-opacity":["step",["zoom"],0,14,1]}},{id:"road-street-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:11,filter:["all",["match",["get","class"],["street","street_limited","primary_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-opacity":["step",["zoom"],0,14,1]}},{id:"road-secondary-tertiary-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:9.3,filter:["all",["match",["get","class"],["secondary","tertiary"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,.75,18,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.1,18,26]}},{id:"road-primary-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:9.9,filter:["all",["==",["get","class"],"primary"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32]}},{id:"road-major-link-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:10,filter:["all",["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-opacity":["step",["zoom"],0,11,1]}},{id:"road-motorway-trunk-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:8.5,filter:["all",["match",["get","class"],["motorway","trunk"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-opacity":["step",["zoom"],["match",["get","class"],"motorway",1,0],6,1]}},{id:"road-construction",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","class"],"construction"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,18],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[.4,.8]],15,["literal",[.3,.6]],16,["literal",[.2,.3]],17,["literal",[.2,.25]],18,["literal",[.15,.15]]]}},{id:"road-path",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"path"],["step",["zoom"],["!",["match",["get","type"],["steps","sidewalk","crossing"],!0,!1]],16,["!=",["get","type"],"steps"]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],13,.5,14,1,15,1,18,4],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[1,.5]]]}},{id:"road-steps",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","type"],"steps"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,16,1.6,18,6],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[.3,.3]]]}},{id:"road-major-link",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:10,filter:["all",["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(0, 0%, 100%)"}},{id:"road-pedestrian",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"pedestrian"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,18,12],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.5,.4]],16,["literal",[1,.2]]]}},{id:"road-minor",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["step",["zoom"],["==",["get","class"],"track"],14,["match",["get","class"],["track","secondary_link","tertiary_link","service"],!0,!1]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,["match",["get","class"],"track",1,.5],18,12],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"road-street",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:11,filter:["all",["match",["get","class"],["street","street_limited","primary_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"road-secondary-tertiary",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",filter:["all",["match",["get","class"],["secondary","tertiary"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.1,18,22],"line-color":"hsl(0, 0%, 100%)"}},{id:"road-primary",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:9,filter:["all",["==",["get","class"],"primary"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":"#f6eac1","line-opacity":["interpolate",["linear"],["zoom"],6,0,8,["match",["get","class"],["trunk"],.2,0],16,["match",["get","class"],["trunk"],1,.81]]}},{id:"road-motorway-trunk",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:8,filter:["all",["match",["get","class"],["motorway","trunk"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.5,18,32],"line-color":["match",["get","class"],["motorway"],"hsl(26, 100%, 68%)","#f2d163"],"line-opacity":["interpolate",["linear"],["zoom"],6,["match",["get","class"],["trunk"],.3,0],8,.4,18,.7]}},{id:"road-rail",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["match",["get","class"],["major_rail","minor_rail"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,20,1],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-pedestrian-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"pedestrian"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,14.5],"line-opacity":["step",["zoom"],0,14,1],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-street-minor-low",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],1,14,0]}},{id:"bridge-street-minor-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-opacity":["step",["zoom"],0,14,1],"line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-primary-secondary-tertiary-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,["match",["get","class"],"primary",1,.75],18,2],"line-opacity":["step",["zoom"],0,10,1],"line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,.1],18,["match",["get","class"],"primary",32,26]],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-major-link-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-motorway-trunk-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway","trunk"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-construction",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"construction"],["==",["geometry-type"],"LineString"]],layout:{},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,18],"line-dasharray":["step",["zoom"],["literal",[.4,.8]],15,["literal",[.3,.6]],16,["literal",[.2,.3]],17,["literal",[.2,.25]],18,["literal",[.15,.15]]],"line-color":"hsl(156, 0%, 100%)"}},{id:"bridge-path",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"path"],["!=",["get","type"],"steps"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,18,4],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[1,.5]]]}},{id:"bridge-steps",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","type"],"steps"],["==",["get","structure"],"bridge"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,16,1.6,18,6],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[.3,.3]]]}},{id:"bridge-major-link",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(0, 0%, 100%)"}},{id:"bridge-pedestrian",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"pedestrian"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,18,12],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.5,.4]],16,["literal",[1,.2]]]}},{id:"bridge-street-minor",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"bridge-primary-secondary-tertiary",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,.1],18,["match",["get","class"],"primary",32,26]],"line-color":"hsl(0, 0%, 100%)"}},{id:"bridge-motorway-trunk",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway","trunk"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":"hsl(0, 0%, 100%)"}},{id:"bridge-rail",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["major_rail","minor_rail"],!0,!1]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,20,1],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-major-link-2-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18]}},{id:"bridge-motorway-trunk-2-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32]}},{id:"bridge-major-link-2",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(0, 0%, 100%)"}},{id:"bridge-motorway-trunk-2",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":"hsl(0, 0%, 100%)"}},{id:"admin-1-boundary-bg",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",filter:["all",["==",["get","admin_level"],1],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"bevel"},paint:{"line-blur":["interpolate",["linear"],["zoom"],3,0,8,3],"line-width":["interpolate",["linear"],["zoom"],7,3.75,12,5.5],"line-opacity":["interpolate",["linear"],["zoom"],7,0,8,.75],"line-dasharray":[1,0],"line-translate":[0,0],"line-color":"hsl(0, 0%, 84%)"}},{id:"admin-0-boundary-bg",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",minzoom:1,filter:["all",["==",["get","admin_level"],0],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],paint:{"line-width":["interpolate",["linear"],["zoom"],3,3.5,10,8],"line-color":"hsl(0, 0%, 84%)","line-opacity":["interpolate",["linear"],["zoom"],3,0,4,.5],"line-translate":[0,0],"line-blur":["interpolate",["linear"],["zoom"],3,0,10,2]}},{id:"admin-1-boundary",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",filter:["all",["==",["get","admin_level"],1],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":["interpolate",["linear"],["zoom"],7,.75,12,1.5],"line-opacity":["interpolate",["linear"],["zoom"],2,0,3,1],"line-color":["interpolate",["linear"],["zoom"],3,"hsl(0, 0%, 80%)",7,"hsl(0, 0%, 70%)"]}},{id:"admin-0-boundary",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",minzoom:1,filter:["all",["==",["get","admin_level"],0],["==",["get","disputed"],"false"],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"hsl(0, 0%, 62%)","line-width":["interpolate",["linear"],["zoom"],3,.5,10,2]}},{id:"admin-0-boundary-disputed",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",minzoom:1,filter:["all",["==",["get","disputed"],"true"],["==",["get","admin_level"],0],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"round"},paint:{"line-dasharray":[1.5,1.5],"line-color":"hsl(0, 0%, 62%)","line-width":["interpolate",["linear"],["zoom"],3,.5,10,2]}},{id:"county_border",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"attr_county_labels_pg-155yvu",minzoom:6,maxzoom:12,paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,9,1.7,18,2],"line-color":"hsl(0, 0%, 59%)","line-opacity":["interpolate",["linear"],["zoom"],5,.2,9,.5,18,1]}},{id:"cousub_border",type:"line",source:"composite","source-layer":"attr_cousub_labels_less_pl-9lemol",minzoom:8,maxzoom:14,layout:{},paint:{"line-color":"hsl(0, 3%, 38%)","line-width":["interpolate",["linear"],["zoom"],0,1,6,1,22,1],"line-opacity":["interpolate",["linear"],["zoom"],7,.1,18,.2]}},{id:"place_border",type:"line",source:"composite","source-layer":"attr_place_labels_less_pl-0n1bxr",minzoom:8,maxzoom:14,paint:{"line-color":"hsla(0, 0%, 58%, 0.62)","line-dasharray":[3,2]}},{id:"road-label",type:"symbol",source:"composite","source-layer":"road",minzoom:10,filter:["step",["zoom"],["match",["get","class"],["motorway","trunk","primary","secondary","tertiary"],!0,!1],12,["match",["get","class"],["motorway","trunk","primary","secondary","tertiary","pedestrian","street","street_limited"],!0,!1],15,["match",["get","class"],["ferry","golf","path"],!1,!0]],layout:{"text-size":["interpolate",["linear"],["zoom"],10,["match",["get","class"],["motorway","trunk","primary","secondary","tertiary"],10,["motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","pedestrian","street","street_limited"],9,6.5],18,["match",["get","class"],["motorway","trunk","primary","secondary","tertiary"],16,["motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","pedestrian","street","street_limited"],14,13]],"text-max-angle":30,"text-font":["DIN Offc Pro Regular","Arial Unicode MS Regular"],"symbol-placement":"line","text-padding":1,"text-rotation-alignment":"map","text-pitch-alignment":"viewport","text-field":["coalesce",["get","name_en"],["get","name"]],"text-letter-spacing":.01},paint:{"text-color":"hsl(0, 0%, 42%)","text-halo-color":["match",["get","class"],["motorway","trunk"],"hsla(0, 0%, 100%, 0.75)","hsl(0, 0%, 100%)"],"text-halo-blur":1,"text-halo-width":.1}},{id:"waterway-label",type:"symbol",source:"composite","source-layer":"natural_label",minzoom:13,filter:["all",["match",["get","class"],["canal","river","stream"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"text-max-angle":30,"symbol-spacing":["interpolate",["linear",1],["zoom"],15,250,17,400],"text-size":["interpolate",["linear"],["zoom"],13,12,18,16],"symbol-placement":"line","text-pitch-alignment":"viewport","text-field":["coalesce",["get","name_en"],["get","name"]]},paint:{"text-color":"hsl(187, 7%, 51%)"}},{id:"natural-line-label",type:"symbol",source:"composite","source-layer":"natural_label",minzoom:4,filter:["all",["match",["get","class"],["glacier","landform"],!0,!1],["==",["geometry-type"],"LineString"],["<=",["get","filterrank"],1]],layout:{"text-size":["step",["zoom"],["step",["get","sizerank"],18,5,12],17,["step",["get","sizerank"],18,13,12]],"text-max-angle":30,"text-field":["coalesce",["get","name_en"],["get","name"]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"symbol-placement":"line-center","text-pitch-alignment":"viewport"},paint:{"text-halo-width":.5,"text-halo-color":"hsl(0, 0%, 100%)","text-halo-blur":.5,"text-color":"hsl(0, 0%, 42%)"}},{id:"natural-point-label",type:"symbol",source:"composite","source-layer":"natural_label",minzoom:4,filter:["all",["match",["get","class"],["dock","glacier","landform","water_feature","wetland"],!0,!1],["==",["geometry-type"],"Point"],["<=",["get","filterrank"],1]],layout:{"text-size":["step",["zoom"],["step",["get","sizerank"],18,5,12],17,["step",["get","sizerank"],18,13,12]],"text-field":["coalesce",["get","name_en"],["get","name"]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"text-offset":["literal",[0,0]]},paint:{"text-color":"hsl(0, 0%, 42%)","text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":.5,"text-halo-blur":.5}},{id:"water-line-label",type:"symbol",source:"composite","source-layer":"natural_label",filter:["all",["match",["get","class"],["bay","ocean","reservoir","sea","water"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"text-size":["interpolate",["linear"],["zoom"],7,["step",["get","sizerank"],24,6,18,12,12],10,["step",["get","sizerank"],18,9,12],18,["step",["get","sizerank"],18,9,16]],"text-max-angle":30,"text-letter-spacing":["match",["get","class"],"ocean",.25,["sea","bay"],.15,0],"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"symbol-placement":"line-center","text-pitch-alignment":"viewport","text-field":["coalesce",["get","name_en"],["get","name"]]},paint:{"text-color":"hsl(187, 7%, 51%)"}},{id:"water-point-label",type:"symbol",source:"composite","source-layer":"natural_label",filter:["all",["match",["get","class"],["bay","ocean","reservoir","sea","water"],!0,!1],["==",["geometry-type"],"Point"]],layout:{"text-line-height":1.3,"text-size":["interpolate",["linear"],["zoom"],7,["step",["get","sizerank"],24,6,18,12,12],10,["step",["get","sizerank"],18,9,12]],"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"text-field":["coalesce",["get","name_en"],["get","name"]],"text-letter-spacing":["match",["get","class"],"ocean",.25,["bay","sea"],.15,.01],"text-max-width":["match",["get","class"],"ocean",4,"sea",5,["bay","water"],7,10]},paint:{"text-color":"hsl(187, 7%, 51%)"}},{id:"poi-label",type:"symbol",source:"composite","source-layer":"poi_label",minzoom:6,filter:["<=",["get","filterrank"],1],layout:{"text-size":["step",["zoom"],["step",["get","sizerank"],18,5,12],17,["step",["get","sizerank"],18,13,12]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"text-field":["coalesce",["get","name_en"],["get","name"]]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":.1,"text-halo-blur":.5,"text-color":["step",["zoom"],["step",["get","sizerank"],"hsl(0, 0%, 66%)",5,"hsl(230, 0%, 56%)"],17,["step",["get","sizerank"],"hsl(0, 0%, 66%)",13,"hsl(0, 0%, 56%)"]]}},{id:"airport-label",type:"symbol",source:"composite","source-layer":"airport_label",minzoom:8,layout:{"text-line-height":1.1,"text-size":["step",["get","sizerank"],18,9,12],"icon-image":["step",["get","sizerank"],["concat",["get","maki"],"-15"],9,["concat",["get","maki"],"-11"]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],visibility:"none","text-offset":[0,.75],"text-rotation-alignment":"viewport","text-anchor":"top","text-field":["step",["get","sizerank"],["coalesce",["get","name_en"],["get","name"]],15,["get","ref"]],"text-letter-spacing":.01,"text-max-width":9},paint:{"text-color":"hsla(0, 0%, 42%, 0)","text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-opacity":0}},{id:"settlement-subdivision-label",type:"symbol",source:"composite","source-layer":"place_label",minzoom:10,maxzoom:15,filter:["all",["==",["get","class"],"settlement_subdivision"],["<=",["get","filterrank"],4]],layout:{"text-field":["coalesce",["get","name_en"],["get","name"]],"text-transform":"uppercase","text-font":["DIN Offc Pro Regular","Arial Unicode MS Regular"],"text-letter-spacing":["match",["get","type"],"suburb",.15,.1],"text-max-width":7,"text-padding":3,"text-size":["interpolate",["cubic-bezier",.5,0,1,1],["zoom"],11,["match",["get","type"],"suburb",11,10.5],15,["match",["get","type"],"suburb",17,16]],visibility:"none"},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-color":"hsl(0, 0%, 62%)","text-halo-blur":.5,"text-halo-width":.1}},{id:"state-label",type:"symbol",source:"composite","source-layer":"place_label",minzoom:3,maxzoom:9,filter:["==",["get","class"],"state"],layout:{"text-size":["interpolate",["cubic-bezier",.85,.7,.65,1],["zoom"],4,["step",["get","symbolrank"],10,6,9.5,7,9],9,["step",["get","symbolrank"],24,6,18,7,14]],"text-transform":"uppercase","text-font":["DIN Offc Pro Bold","Arial Unicode MS Bold"],"text-field":["step",["zoom"],["step",["get","symbolrank"],["coalesce",["get","name_en"],["get","name"]],5,["coalesce",["get","abbr"],["get","name_en"],["get","name"]]],5,["coalesce",["get","name_en"],["get","name"]]],"text-letter-spacing":.15,"text-max-width":6},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-color":"hsl(0, 0%, 66%)","text-halo-width":.1}},{id:"county_label",type:"symbol",source:"composite","source-layer":"attr_county_labels-5i5o0f",minzoom:7.5,maxzoom:14,layout:{"text-field":["step",["zoom"],["upcase",["to-string",["get","name"]]],6,["upcase",["to-string",["get","name"]]],10,["upcase",["to-string",["get","namelsad"]]],22,["upcase",["to-string",["get","namelsad"]]]],"text-font":["step",["zoom"],["literal",["Open Sans Regular","Arial Unicode MS Regular"]],6,["literal",["Montserrat Medium","Arial Unicode MS Regular"]],8,["literal",["Montserrat Medium","Arial Unicode MS Regular"]],11,["literal",["Montserrat Medium","Arial Unicode MS Regular"]],22,["literal",["Montserrat Medium","Arial Unicode MS Regular"]]],"text-size":["interpolate",["linear"],["zoom"],0,0,6,6,6.5,10,7.5,14,9,30,11,75,14,85],"text-allow-overlap":["step",["zoom"],!1,5,!1,10,!1,11,!0],"text-max-width":5,"text-ignore-placement":["step",["zoom"],!1,6,!1,9,!0,12,!0,22,!0]},paint:{"text-color":"hsl(0, 0%, 48%)","text-opacity":["interpolate",["linear"],["zoom"],6.49999,1,6.5,.7,8,.3,11,.1,16,.05]}},{id:"cousub_label",type:"symbol",source:"composite","source-layer":"attr_cousub_labels_plus_pt-0kx5lj",minzoom:9,layout:{"text-field":["upcase",["get","display_name"]],"text-size":["interpolate",["linear"],["zoom"],7.9,0,8,8,9,10,14,30],"text-max-width":5,"text-line-height":1.1,visibility:"none"},paint:{"text-color":"hsla(0, 0%, 31%, 0.76)","text-halo-width":10,"text-halo-color":"hsl(0, 0%, 100%)"}},{id:"place-label new",type:"symbol",source:"composite","source-layer":"rural_places-4rf4i9",minzoom:9,filter:["match",["get","census_boundary_year"],[2020],!0,!1],layout:{"text-line-height":1.1,"text-size":["interpolate",["cubic-bezier",.2,0,.9,1],["zoom"],3,["step",["get","symbolrank"],12,9,11,10,10.5,12,9.5,14,8.5,16,6.5,17,4],15,["step",["get","symbolrank"],28,9,26,10,23,11,21,12,20,13,19,15,17]],"icon-image":["case",["==",["get","capital"],2],"border-dot-13",["step",["get","symbolrank"],"dot-11",9,"dot-10",11,"dot-9"]],"text-font":["Montserrat Medium","Arial Unicode MS Regular"],"text-justify":["step",["zoom"],["match",["get","text_anchor"],["left","bottom-left","top-left"],"left",["right","bottom-right","top-right"],"right","center"],8,"center"],visibility:"none","text-offset":["step",["zoom"],["match",["get","capital"],2,["match",["get","text_anchor"],"bottom",["literal",[0,-.3]],"bottom-left",["literal",[.3,-.1]],"left",["literal",[.45,.1]],"top-left",["literal",[.3,.1]],"top",["literal",[0,.3]],"top-right",["literal",[-.3,.1]],"right",["literal",[-.45,0]],"bottom-right",["literal",[-.3,-.1]],["literal",[0,-.3]]],["match",["get","text_anchor"],"bottom",["literal",[0,-.25]],"bottom-left",["literal",[.2,-.05]],"left",["literal",[.4,.05]],"top-left",["literal",[.2,.05]],"top",["literal",[0,.25]],"top-right",["literal",[-.2,.05]],"right",["literal",[-.4,.05]],"bottom-right",["literal",[-.2,-.05]],["literal",[0,-.25]]]],8,["literal",[0,0]]],"text-anchor":["step",["zoom"],["get","text_anchor"],8,"center"],"text-field":["coalesce",["get","NAME"]],"text-max-width":7},paint:{"text-color":["step",["get","symbolrank"],"hsl(0, 2%, 61%)",11,"hsl(0, 1%, 68%)",16,"hsl(0, 1%, 75%)"],"text-halo-color":"hsl(0, 0%, 100%)","icon-opacity":["step",["zoom"],1,8,0],"text-halo-blur":1,"text-halo-width":.1}},{id:"settlement-label",type:"symbol",source:"composite","source-layer":"place_label",maxzoom:10.76,filter:["all",["<=",["get","filterrank"],3],["==",["get","class"],"settlement"],["step",["zoom"],!0,12,[">=",["get","symbolrank"],11],13,[">=",["get","symbolrank"],12]]],layout:{"text-line-height":1.1,"text-size":["interpolate",["cubic-bezier",.2,0,.9,1],["zoom"],3,["step",["get","symbolrank"],12,9,11,10,10.5,12,9.5,14,8.5,16,6.5,17,4],15,["step",["get","symbolrank"],28,9,26,10,23,11,21,12,20,13,19,15,17]],"icon-image":["case",["==",["get","capital"],2],"border-dot-13",["step",["get","symbolrank"],"dot-11",9,"dot-10",11,"dot-9"]],"text-font":["step",["zoom"],["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]],8,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],11,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],10,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],12,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],11,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],13,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],12,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],15,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],13,["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]]],"text-justify":["step",["zoom"],["match",["get","text_anchor"],["left","bottom-left","top-left"],"left",["right","bottom-right","top-right"],"right","center"],8,"center"],"text-offset":["step",["zoom"],["match",["get","capital"],2,["match",["get","text_anchor"],"bottom",["literal",[0,-.3]],"bottom-left",["literal",[.3,-.1]],"left",["literal",[.45,.1]],"top-left",["literal",[.3,.1]],"top",["literal",[0,.3]],"top-right",["literal",[-.3,.1]],"right",["literal",[-.45,0]],"bottom-right",["literal",[-.3,-.1]],["literal",[0,-.3]]],["match",["get","text_anchor"],"bottom",["literal",[0,-.25]],"bottom-left",["literal",[.2,-.05]],"left",["literal",[.4,.05]],"top-left",["literal",[.2,.05]],"top",["literal",[0,.25]],"top-right",["literal",[-.2,.05]],"right",["literal",[-.4,.05]],"bottom-right",["literal",[-.2,-.05]],["literal",[0,-.25]]]],8,["literal",[0,0]]],"text-anchor":["step",["zoom"],["get","text_anchor"],8,"center"],"text-field":["coalesce",["get","name_en"],["get","name"]],"text-max-width":7},paint:{"text-color":["step",["get","symbolrank"],"hsl(0, 0%, 42%)",11,"hsl(0, 0%, 55%)",16,"hsl(0, 0%, 62%)"],"text-halo-color":"hsl(0, 0%, 100%)","icon-opacity":["step",["zoom"],1,8,0],"text-halo-blur":1,"text-halo-width":.1}},{id:"wwb2s-places_lat_lon",type:"symbol",source:"composite","source-layer":"places_lat_lon-awryh9",minzoom:10.75,maxzoom:20,filter:["all",[">=",["get","pop"],101],[">",["get","pct_rural"],0],["step",["zoom"],!0,13,[">=",["get","symbolrank"],11],14,[">=",["get","symbolrank"],13]]],layout:{"text-line-height":1.1,"text-size":["step",["get","symbolrank"],20,9,18,10,16,11,14,12,12],"icon-image":["case",["==",["get","capital"],2],"border-dot-13",["step",["get","symbolrank"],"dot-11",9,"dot-10",11,"dot-9"]],"text-font":["step",["zoom"],["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]],8,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],11,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],10,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],12,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],11,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],13,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],12,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],15,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],13,["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]]],"text-justify":["step",["zoom"],["match",["get","text_anchor"],["left","bottom-left","top-left"],"left",["right","bottom-right","top-right"],"right","center"],8,"center"],"text-offset":["step",["zoom"],["match",["get","capital"],2,["match",["get","text_anchor"],"bottom",["literal",[0,-.3]],"bottom-left",["literal",[.3,-.1]],"left",["literal",[.45,.1]],"top-left",["literal",[.3,.1]],"top",["literal",[0,.3]],"top-right",["literal",[-.3,.1]],"right",["literal",[-.45,0]],"bottom-right",["literal",[-.3,-.1]],["literal",[0,-.3]]],["match",["get","text_anchor"],"bottom",["literal",[0,-.25]],"bottom-left",["literal",[.2,-.05]],"left",["literal",[.4,.05]],"top-left",["literal",[.2,.05]],"top",["literal",[0,.25]],"top-right",["literal",[-.2,.05]],"right",["literal",[-.4,.05]],"bottom-right",["literal",[-.2,-.05]],["literal",[0,-.25]]]],8,["literal",[0,0]]],"text-anchor":["step",["zoom"],["get","text_anchor"],8,"center"],"text-field":["coalesce",["get","NAME"],["get","name"]],"text-max-width":7},paint:{"text-halo-color":"hsl(0, 0%, 100%)","icon-opacity":["step",["zoom"],1,8,0],"text-halo-blur":1,"text-halo-width":.1,"text-color":["interpolate",["linear"],["zoom"],0,"hsl(0, 0%, 62%)",22,"#000000"],"text-opacity":["interpolate",["linear"],["zoom"],7,0,9,.97,22,1]}},{id:"custom-pattern",type:"fill",source:"composite","source-layer":"attr_county_labels_pg-155yvu",minzoom:6,layout:{visibility:"none"},paint:{"fill-color":"hsla(303, 73%, 74%, 0.66)","fill-pattern":"stripe-4"}}],c$="2022-02-24T13:16:14.872Z",u$="2024-07-11T16:18:50.102Z",h$="cl010e7b7001p15pe3l0306hv",d$="ruralinno",p$="private",f$=!1,m$={version:Q9,name:J9,metadata:e$,center:t$,zoom:r$,bearing:n$,pitch:i$,sources:o$,sprite:a$,glyphs:s$,layers:l$,created:c$,modified:u$,id:h$,owner:d$,visibility:p$,protected:!1,draft:f$};/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */Object.assign({},m$);var A3={exports:{}};(function(t,e){(function(n,a){t.exports=a()})($e,function(){var n,a,u;function d(l,w){if(!n)n=w;else if(!a)a=w;else{var T="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",C={};n(C),u=w(C),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}d(["exports"],function(l){var w=typeof self<"u"?self:{},T="2.15.0";let C;const P={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{C=i}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!P.API_URL)return null;try{const i=new URL(P.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},z={supported:!1,testSupport:function(i){!W&&U&&(N?V(i):$=i)}};let $,U,W=!1,N=!1;function V(i){const r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,U),i.isContextLost())return;z.supported=!0}catch{}i.deleteTexture(r),W=!0}w.document&&(U=w.document.createElement("img"),U.onload=function(){$&&V($),$=null,N=!0},U.onerror=function(){W=!0,$=null},U.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const R="01";function F(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var H=J;function J(i,r,o,c){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=r,this.p2x=o,this.p2y=c}J.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,r){if(r===void 0&&(r=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,c=0;c<8;c++){var p=this.sampleCurveX(o)-i;if(Math.abs(p)<r)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=p/m}var y=0,x=1;for(o=i,c=0;c<20&&(p=this.sampleCurveX(o),!(Math.abs(p-i)<r));c++)i>p?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(i,r){return this.sampleCurveY(this.solveCurveX(i,r))}};var te=F(H),se=ge;function ge(i,r){this.x=i,this.y=r}ge.prototype={clone:function(){return new ge(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,r){return this.clone()._rotateAround(i,r)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var r=i.x-this.x,o=i.y-this.y;return r*r+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,r){return Math.atan2(this.x*r-this.y*i,this.x*i+this.y*r)},_matMult:function(i){var r=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=r,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var r=Math.cos(i),o=Math.sin(i),c=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=c,this},_rotateAround:function(i,r){var o=Math.cos(i),c=Math.sin(i),p=r.y+c*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-c*(this.y-r.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ge.convert=function(i){return i instanceof ge?i:Array.isArray(i)?new ge(i[0],i[1]):i};var xe=F(se);const Ee=Math.PI/180,Be=180/Math.PI;function Fe(i){return i*Ee}function Ve(i){return i*Be}const Ct=[[0,0],[1,0],[1,1],[0,1]];function Dt(i){if(i<=0)return 0;if(i>=1)return 1;const r=i*i,o=r*i;return 4*(i<.5?o:3*(i-r)+o-.75)}function Ut(i,r,o,c){const p=new te(i,r,o,c);return function(m){return p.solve(m)}}const cr=Ut(.25,.1,.25,1);function qe(i,r,o){return Math.min(o,Math.max(r,i))}function St(i,r,o){return(o=qe((o-i)/(r-i),0,1))*o*(3-2*o)}function gt(i,r,o){const c=o-r,p=((i-r)%c+c)%c+r;return p===r?o:p}function je(i,r,o){if(!i.length)return o(null,[]);let c=i.length;const p=new Array(i.length);let m=null;i.forEach((y,x)=>{r(y,(E,S)=>{E&&(m=E),p[x]=S,--c==0&&o(m,p)})})}function et(i){const r=[];for(const o in i)r.push(i[o]);return r}function nt(i,...r){for(const o of r)for(const c in o)i[c]=o[c];return i}let it=1;function ur(){return it++}function Xt(){return function i(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Pr(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Yt(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function si(i,r){i.forEach(o=>{r[o]&&(r[o]=r[o].bind(r))})}function mr(i,r){return i.indexOf(r,i.length-r.length)!==-1}function Vt(i,r,o){const c={};for(const p in i)c[p]=r.call(o||this,i[p],p,i);return c}function Ii(i,r,o){const c={};for(const p in i)r.call(o||this,i[p],p,i)&&(c[p]=i[p]);return c}function qr(i){return Array.isArray(i)?i.map(qr):typeof i=="object"&&i?Vt(i,qr):i}const pn={};function Tr(i){pn[i]||(typeof console<"u"&&console.warn(i),pn[i]=!0)}function Bn(i,r,o){return(o.y-i.y)*(r.x-i.x)>(r.y-i.y)*(o.x-i.x)}function ma(i){let r=0;for(let o,c,p=0,m=i.length,y=m-1;p<m;y=p++)o=i[p],c=i[y],r+=(c.x-o.x)*(o.y+c.y);return r}function yi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Yn(i){const r={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,c,p,m)=>{const y=p||m;return r[c]=!y||y.toLowerCase(),""}),r["max-age"]){const o=parseInt(r["max-age"],10);isNaN(o)?delete r["max-age"]:r["max-age"]=o}return r}let bo=null;function Nn(i){if(bo==null){const r=i.navigator?i.navigator.userAgent:null;bo=!!i.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return bo}function Un(i){try{const r=w[i];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function Qn(i,r){return[i[4*r],i[4*r+1],i[4*r+2],i[4*r+3]]}const wo="mapbox-tiles";let Ps=500,Eo=50,jn,Wo;function Qa(){try{return w.caches}catch{}}function Go(){Qa()&&!jn&&(jn=w.caches.open(wo))}function Hi(i){const r=i.indexOf("?");if(r<0)return i;const o=function(p){const m=p.indexOf("?");return m>0?p.slice(m+1).split("&"):[]}(i),c=o.filter(p=>{const m=p.split("=");return m[0]==="language"||m[0]==="worldview"});return c.length?`${i.slice(0,r)}?${c.join("&")}`:i.slice(0,r)}let So=1/0;const ga={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ga);class To extends Error{constructor(r,o,c){o===401&&Pe(c)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=o,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ho=yi()?()=>self.worker&&self.worker.referrer:()=>(w.location.protocol==="blob:"?w.parent:w).location.href,ya=function(i,r){if(!(/^file:/.test(o=i.url)||/^file:/.test(Ho())&&!/^\w+:/.test(o))){if(w.fetch&&w.Request&&w.AbortController&&w.Request.prototype.hasOwnProperty("signal"))return function(c,p){const m=new w.AbortController,y=new w.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Ho(),referrerPolicy:c.referrerPolicy,signal:m.signal});let x=!1,E=!1;const S=(k=y.url).indexOf("sku=")>0&&Pe(k);var k;c.type==="json"&&y.headers.set("Accept","application/json");const M=(j,G,K)=>{if(E)return;if(j&&j.message!=="SecurityError"&&Tr(j.toString()),G&&K)return O(G);const ee=Date.now();w.fetch(y).then(le=>{if(le.ok){const me=S?le.clone():null;return O(le,me,ee)}return p(new To(le.statusText,le.status,c.url))}).catch(le=>{le.name!=="AbortError"&&p(new Error(`${le.message} ${c.url}`))})},O=(j,G,K)=>{(c.type==="arrayBuffer"?j.arrayBuffer():c.type==="json"?j.json():j.text()).then(ee=>{E||(G&&K&&function(le,me,ce){if(Go(),!jn)return;const pe={status:me.status,statusText:me.statusText,headers:new w.Headers};me.headers.forEach((Oe,Me)=>pe.headers.set(Me,Oe));const _e=Yn(me.headers.get("Cache-Control")||"");if(_e["no-store"])return;_e["max-age"]&&pe.headers.set("Expires",new Date(ce+1e3*_e["max-age"]).toUTCString());const ye=pe.headers.get("Expires");ye&&(new Date(ye).getTime()-ce<42e4||function(Oe,Me){if(Wo===void 0)try{new Response(new ReadableStream),Wo=!0}catch{Wo=!1}Wo?Me(Oe.body):Oe.blob().then(Me)}(me,Oe=>{const Me=new w.Response(Oe,pe);Go(),jn&&jn.then(He=>He.put(Hi(le.url),Me)).catch(He=>Tr(He.message))}))}(y,G,K),x=!0,p(null,ee,j.headers.get("Cache-Control"),j.headers.get("Expires")))}).catch(ee=>{E||p(new Error(ee.message))})};return S?function(j,G){if(Go(),!jn)return G(null);const K=Hi(j.url);jn.then(ee=>{ee.match(K).then(le=>{const me=function(ce){if(!ce)return!1;const pe=new Date(ce.headers.get("Expires")||0),_e=Yn(ce.headers.get("Cache-Control")||"");return pe>Date.now()&&!_e["no-cache"]}(le);ee.delete(K),me&&ee.put(K,le.clone()),G(null,le,me)}).catch(G)}).catch(G)}(y,M):M(null,null),{cancel:()=>{E=!0,x||m.abort()}}}(i,r);if(yi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,r,void 0,!0)}var o;return function(c,p){const m=new w.XMLHttpRequest;m.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const y in c.headers)m.setRequestHeader(y,c.headers[y]);return c.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=c.credentials==="include",m.onerror=()=>{p(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let y=m.response;if(c.type==="json")try{y=JSON.parse(m.response)}catch(x){return p(x)}p(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else p(new To(m.statusText,m.status,c.url))},m.send(c.body),{cancel:()=>m.abort()}}(i,r)},Ja=function(i,r){return ya(nt(i,{type:"arrayBuffer"}),r)};function Ds(i){const r=w.document.createElement("a");return r.href=i,r.protocol===w.document.location.protocol&&r.host===w.document.location.host}const fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let X,Y;X=[],Y=0;const de=function(i,r){if(z.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Y>=P.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:i,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return X.push(m),m}Y++;let o=!1;const c=()=>{if(!o)for(o=!0,Y--;X.length&&Y<P.MAX_PARALLEL_IMAGE_REQUESTS;){const m=X.shift(),{requestParameters:y,callback:x,cancelled:E}=m;E||(m.cancel=de(y,x).cancel)}},p=Ja(i,(m,y,x,E)=>{c(),m?r(m):y&&(w.createImageBitmap?function(S,k){const M=new w.Blob([new Uint8Array(S)],{type:"image/png"});w.createImageBitmap(M).then(O=>{k(null,O)}).catch(O=>{k(new Error(`Could not load image because of ${O.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(S,k)=>r(S,k,x,E)):function(S,k){const M=new w.Image,O=w.URL;M.onload=()=>{k(null,M),O.revokeObjectURL(M.src),M.onload=null,w.requestAnimationFrame(()=>{M.src=fe})},M.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new w.Blob([new Uint8Array(S)],{type:"image/png"});M.src=S.byteLength?O.createObjectURL(j):fe}(y,(S,k)=>r(S,k,x,E)))});return{cancel:()=>{p.cancel(),c()}}},ve="NO_ACCESS_TOKEN";function Ae(i){return i.indexOf("mapbox:")===0}function Pe(i){return P.API_URL_REGEX.test(i)}function ke(i){return P.API_CDN_URL_REGEX.test(i)}function Te(i){return P.API_STYLE_REGEX.test(i)&&!Le(i)}function Le(i){return P.API_SPRITE_REGEX.test(i)}const dt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function mt(i){const r=i.match(dt);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function ct(i){const r=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${r}`}const Ft="mapbox.eventData";function jt(i){if(!i)return null;const r=i.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(w.atob(r[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Wt{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const o=jt(P.ACCESS_TOKEN);let c="";return c=o&&o.u?w.btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(p,m)=>String.fromCharCode(+("0x"+m)))):P.ACCESS_TOKEN||"",r?`${Ft}.${r}:${c}`:`${Ft}:${c}`}fetchEventData(){const r=Un("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{const p=w.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));const m=w.localStorage.getItem(c);m&&(this.anonId=m)}catch{Tr("Unable to read from LocalStorage")}}saveEventData(){const r=Un("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{w.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&w.localStorage.setItem(o,JSON.stringify(this.eventData))}catch{Tr("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,o,c,p){if(!P.EVENTS_URL)return;const m=mt(P.EVENTS_URL);m.params.push(`access_token=${p||P.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(r).toISOString()},x=o?nt(y,o):y,E={url:ct(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=function(S,k){return ya(nt(S,{method:"POST"}),k)}(E,S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(p)})}queueRequest(r,o){this.queue.push(r),this.processRequests(o)}}const Qt=new class extends Wt{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,r){P.EVENTS_URL&&P.ACCESS_TOKEN&&Array.isArray(i)&&i.some(o=>Ae(o)||Pe(o))&&this.queueRequest(Date.now(),r)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=jt(P.ACCESS_TOKEN),o=r?r.u:P.ACCESS_TOKEN;let c=o!==this.eventData.tokenU;Yt(this.anonId)||(this.anonId=Xt(),c=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),y=new Date(p),x=(p-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||m.getDate()!==y.getDate()}else c=!0;c?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:R,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=p,this.eventData.tokenU=o)},i):this.processRequests()}},or=Qt.postTurnstileEvent.bind(Qt),en=new class extends Wt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,r,o,c){this.skuToken=r,this.errorCb=c,P.EVENTS_URL&&(o||P.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(ve)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:o}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Yt(this.anonId)||(this.anonId=Xt()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:R,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},i))}},yn=en.postMapLoadEvent.bind(en),li=new class extends Wt{constructor(){super("gljs.performance")}postPerformanceEvent(i,r){P.EVENTS_URL&&(i||P.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:o}=this.queue.shift(),c=function(p){const m=w.performance.getEntriesByType("resource"),y=w.performance.getEntriesByType("mark"),x=function(O){const j={};if(O){for(const G in O)if(G!=="other")for(const K of O[G]){const ee=`${G}ResolveRangeMin`,le=`${G}ResolveRangeMax`,me=`${G}RequestCount`,ce=`${G}RequestCachedCount`;j[ee]=Math.min(j[ee]||1/0,K.startTime),j[le]=Math.max(j[le]||-1/0,K.responseEnd);const pe=_e=>{j[_e]===void 0&&(j[_e]=0),++j[_e]};K.transferSize!==void 0&&K.transferSize===0&&pe(ce),pe(me)}}return j}(function(O,j){const G={};if(O)for(const K of O){const ee=j(K);G[ee]===void 0&&(G[ee]=[]),G[ee].push(K)}return G}(m,t0)),E=w.devicePixelRatio,S=w.navigator.connection||w.navigator.mozConnection||w.navigator.webkitConnection,k={counters:[],metadata:[],attributes:[]},M=(O,j,G)=>{G!=null&&O.push({name:j,value:G.toString()})};for(const O in x)M(k.counters,O,x[O]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(M(k.counters,"interactionRangeMin",p.interactionRange[0]),M(k.counters,"interactionRangeMax",p.interactionRange[1])),y)for(const O of Object.keys(ml)){const j=ml[O],G=y.find(K=>K.name===j);G&&M(k.counters,j,G.startTime)}return M(k.counters,"visibilityHidden",p.visibilityHidden),M(k.attributes,"style",function(O){if(O)for(const j of O){const G=j.name.split("?")[0];if(Te(G)){const K=G.split("/").slice(-2);if(K.length===2)return`mapbox://styles/${K[0]}/${K[1]}`}}}(m)),M(k.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),M(k.attributes,"fogEnabled",p.fogEnabled?"true":"false"),M(k.attributes,"projection",p.projection),M(k.attributes,"zoom",p.zoom),M(k.metadata,"devicePixelRatio",E),M(k.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),M(k.metadata,"navigatorUserAgent",w.navigator.userAgent),M(k.metadata,"screenWidth",w.screen.width),M(k.metadata,"screenHeight",w.screen.height),M(k.metadata,"windowWidth",w.innerWidth),M(k.metadata,"windowHeight",w.innerHeight),M(k.metadata,"mapWidth",p.width/E),M(k.metadata,"mapHeight",p.height/E),M(k.metadata,"webglRenderer",p.renderer),M(k.metadata,"webglVendor",p.vendor),M(k.metadata,"sdkVersion",T),M(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(o);for(const p of c.metadata);for(const p of c.counters);for(const p of c.attributes);this.postEvent(r,c,()=>{},i)}},zn=li.postPerformanceEvent.bind(li),qo=new class extends Wt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,r,o,c){if(!P.API_URL||!P.SESSION_PATH)return;const p=mt(P.API_URL+P.SESSION_PATH);p.params.push(`sku=${r||""}`),p.params.push(`access_token=${c||P.ACCESS_TOKEN||""}`);const m={url:ct(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(y,x){return ya(nt(y,{method:"GET"}),x)}(m,y=>{this.pendingRequest=null,o(y),this.saveEventData(),this.processRequests(c)})}getSessionAPI(i,r,o,c){this.skuToken=r,this.errorCb=c,P.SESSION_PATH&&P.API_URL&&(o||P.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(ve)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:o}=this.queue.shift();r&&this.success[r]||this.getSession(o,this.skuToken,c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},i)}},Vn=qo.getSessionAPI.bind(qo),_i=new Set,ml={create:"create",load:"load",fullLoad:"fullLoad"},Xv={mark(i){w.performance.mark(i)},measure(i,r,o){w.performance.measure(i,r,o)}};function t0(i){const r=i.name.split("?")[0];return ke(r)&&r.includes("mapbox-gl.js")?"javascript":ke(r)&&r.includes("mapbox-gl.css")?"css":function(o){return P.API_FONTS_REGEX.test(o)}(r)?"fontRange":Le(r)?"sprite":Te(r)?"style":function(o){return P.API_TILEJSON_REGEX.test(o)}(r)?"tilejson":"other"}const br=w.performance;function Zd(i){const r=i?i.url.toString():void 0;return br.getEntriesByName(r)}let Ic,Kd,$u,Zo;const _a={now:()=>$u!==void 0?$u:w.performance.now(),setNow(i){$u=i},restoreNow(){$u=void 0},frame(i){const r=w.requestAnimationFrame(i);return{cancel:()=>w.cancelAnimationFrame(r)}},getImageData(i,r=0){const{width:o,height:c}=i;Zo||(Zo=w.document.createElement("canvas"));const p=Zo.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(o>Zo.width||c>Zo.height)&&(Zo.width=o,Zo.height=c),p.clearRect(-r,-r,o+2*r,c+2*r),p.drawImage(i,0,0,o,c),p.getImageData(-r,-r,o+2*r,c+2*r)},resolveURL:i=>(Ic||(Ic=w.document.createElement("a")),Ic.href=i,Ic.href),get devicePixelRatio(){return w.devicePixelRatio},get prefersReducedMotion(){return!!w.matchMedia&&(Kd==null&&(Kd=w.matchMedia("(prefers-reduced-motion: reduce)")),Kd.matches)}};function Xd(i,r,o){o[i]&&o[i].indexOf(r)!==-1||(o[i]=o[i]||[],o[i].push(r))}function Yd(i,r,o){if(o&&o[i]){const c=o[i].indexOf(r);c!==-1&&o[i].splice(c,1)}}class Ms{constructor(r,o={}){nt(this,o),this.type=r}}class va extends Ms{constructor(r,o={}){super("error",nt({error:r},o))}}class Cc{on(r,o){return this._listeners=this._listeners||{},Xd(r,o,this._listeners),this}off(r,o){return Yd(r,o,this._listeners),Yd(r,o,this._oneTimeListeners),this}once(r,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Xd(r,o,this._oneTimeListeners),this):new Promise(c=>this.once(r,c))}fire(r,o){typeof r=="string"&&(r=new Ms(r,o||{}));const c=r.type;if(this.listens(c)){r.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of p)x.call(this,r);const m=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of m)Yd(c,x,this._oneTimeListeners),x.call(this,r);const y=this._eventedParent;y&&(nt(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(r))}else r instanceof va&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,o){return this._eventedParent=r,this._eventedParentData=o,this}}var Ge=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function xa(i,...r){for(const o of r)for(const c in o)i[c]=o[c];return i}function _n(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function $n(i){if(Array.isArray(i))return i.map($n);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const r={};for(const o in i)r[o]=$n(i[o]);return r}return _n(i)}class r0 extends Error{constructor(r,o){super(o),this.message=o,this.key=r}}var Ko=r0;class Qd{constructor(r,o=[]){this.parent=r,this.bindings={};for(const[c,p]of o)this.bindings[c]=p}concat(r){return new Qd(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var n0=Qd;const gl={kind:"null"},bt={kind:"number"},ir={kind:"string"},tr={kind:"boolean"},qi={kind:"color"},Ao={kind:"object"},rr={kind:"value"},Zi={kind:"collator"},kc={kind:"formatted"},zs={kind:"resolvedImage"};function ro(i,r){return{kind:"array",itemType:i,N:r}}function Xr(i){if(i.kind==="array"){const r=Xr(i.itemType);return typeof i.N=="number"?`array<${r}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${r}>`}return i.kind}const i0=[gl,bt,ir,tr,qi,kc,Ao,ro(rr),zs];function ba(i,r){if(r.kind==="error")return null;if(i.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!ba(i.itemType,r.itemType))&&(typeof i.N!="number"||i.N===r.N))return null}else{if(i.kind===r.kind)return null;if(i.kind==="value"){for(const o of i0)if(!ba(o,r))return null}}return`Expected ${Xr(i)} but found ${Xr(r)} instead.`}function Pc(i,r){return r.some(o=>o.kind===i.kind)}function Dc(i,r){return r.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}var Jd,o0={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Mc(i){return(i=Math.round(i))<0?0:i>255?255:i}function zc(i){return Mc(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function Wu(i){return(r=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:r>1?1:r;var r}function yl(i,r,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(r-i)*o*6:2*o<1?r:3*o<2?i+(r-i)*(2/3-o)*6:i}try{Jd={}.parseCSSColor=function(i){var r,o=i.replace(/ /g,"").toLowerCase();if(o in o0)return o0[o].slice();if(o[0]==="#")return o.length===4?(r=parseInt(o.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:o.length===7&&(r=parseInt(o.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var c=o.indexOf("("),p=o.indexOf(")");if(c!==-1&&p+1===o.length){var m=o.substr(0,c),y=o.substr(c+1,p-(c+1)).split(","),x=1;switch(m){case"rgba":if(y.length!==4)return null;x=Wu(y.pop());case"rgb":return y.length!==3?null:[zc(y[0]),zc(y[1]),zc(y[2]),x];case"hsla":if(y.length!==4)return null;x=Wu(y.pop());case"hsl":if(y.length!==3)return null;var E=(parseFloat(y[0])%360+360)%360/360,S=Wu(y[1]),k=Wu(y[2]),M=k<=.5?k*(S+1):k+S-k*S,O=2*k-M;return[Mc(255*yl(O,M,E+1/3)),Mc(255*yl(O,M,E)),Mc(255*yl(O,M,E-1/3)),x];default:return null}}return null}}catch{}class Ci{constructor(r,o,c,p=1){this.r=r,this.g=o,this.b=c,this.a=p}static parse(r){if(!r)return;if(r instanceof Ci)return r;if(typeof r!="string")return;const o=Jd(r);return o?new Ci(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[r,o,c,p]=this.toArray();return`rgba(${Math.round(r)},${Math.round(o)},${Math.round(c)},${p})`}toArray(){const{r,g:o,b:c,a:p}=this;return p===0?[0,0,0,0]:[255*r/p,255*o/p,255*c/p,p]}toArray01(){const{r,g:o,b:c,a:p}=this;return p===0?[0,0,0,0]:[r/p,o/p,c/p,p]}toArray01PremultipliedAlpha(){const{r,g:o,b:c,a:p}=this;return[r,o,c,p]}}Ci.black=new Ci(0,0,0,1),Ci.white=new Ci(1,1,1,1),Ci.transparent=new Ci(0,0,0,0),Ci.red=new Ci(1,0,0,1),Ci.blue=new Ci(0,0,1,1);var fn=Ci;class ep{constructor(r,o,c){this.sensitivity=r?o?"variant":"case":o?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,o){return this.collator.compare(r,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class tp{constructor(r,o,c,p,m){this.text=r.normalize?r.normalize():r,this.image=o,this.scale=c,this.fontStack=p,this.textColor=m}}class ki{constructor(r){this.sections=r}static fromString(r){return new ki([new tp(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof ki?r:ki.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const o of this.sections){if(o.image){r.push(["image",o.image.name]);continue}r.push(o.text);const c={};o.fontStack&&(c["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(c["font-scale"]=o.scale),o.textColor&&(c["text-color"]=["rgba"].concat(o.textColor.toArray())),r.push(c)}return r}}class no{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new no({name:r,available:!1}):null}serialize(){return["image",this.name]}}function a0(i,r,o,c){return typeof i=="number"&&i>=0&&i<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof o=="number"&&o>=0&&o<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[i,r,o,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[i,r,o,c]:[i,r,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rc(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof fn||i instanceof ep||i instanceof ki||i instanceof no)return!0;if(Array.isArray(i)){for(const r of i)if(!Rc(r))return!1;return!0}if(typeof i=="object"){for(const r in i)if(!Rc(i[r]))return!1;return!0}return!1}function ln(i){if(i===null)return gl;if(typeof i=="string")return ir;if(typeof i=="boolean")return tr;if(typeof i=="number")return bt;if(i instanceof fn)return qi;if(i instanceof ep)return Zi;if(i instanceof ki)return kc;if(i instanceof no)return zs;if(Array.isArray(i)){const r=i.length;let o;for(const c of i){const p=ln(c);if(o){if(o===p)continue;o=rr;break}o=p}return ro(o||rr,r)}return Ao}function Oc(i){const r=typeof i;return i===null?"":r==="string"||r==="number"||r==="boolean"?String(i):i instanceof fn||i instanceof ki||i instanceof no?i.toString():JSON.stringify(i)}class rp{constructor(r,o){this.type=r,this.value=o}static parse(r,o){if(r.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Rc(r[1]))return o.error("invalid value");const c=r[1];let p=ln(c);const m=o.expectedType;return p.kind!=="array"||p.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(p=m),new rp(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof fn?["rgba"].concat(this.value.toArray()):this.value instanceof ki?this.value.serialize():this.value}}var Rs=rp,Jn=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const np={string:ir,number:bt,boolean:tr,object:Ao};class ip{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let c,p=1;const m=r[0];if(m==="array"){let x,E;if(r.length>2){const S=r[1];if(typeof S!="string"||!(S in np)||S==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);x=np[S],p++}else x=rr;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return o.error('The length argument to "array" must be a positive integer literal',2);E=r[2],p++}c=ro(x,E)}else c=np[m];const y=[];for(;p<r.length;p++){const x=o.parse(r[p],p,rr);if(!x)return null;y.push(x)}return new ip(c,y)}evaluate(r){for(let o=0;o<this.args.length;o++){const c=this.args[o].evaluate(r);if(!ba(this.type,ln(c)))return c;if(o===this.args.length-1)throw new Jn(`Expected value to be of type ${Xr(this.type)}, but found ${Xr(ln(c))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,o=[r.kind];if(r.kind==="array"){const c=r.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){o.push(c.kind);const p=r.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(c=>c.serialize()))}}var wa=ip;class es{constructor(r){this.type=kc,this.sections=r}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const c=r[1];if(!Array.isArray(c)&&typeof c=="object")return o.error("First argument must be an image or text section.");const p=[];let m=!1;for(let y=1;y<=r.length-1;++y){const x=r[y];if(m&&typeof x=="object"&&!Array.isArray(x)){m=!1;let E=null;if(x["font-scale"]&&(E=o.parse(x["font-scale"],1,bt),!E))return null;let S=null;if(x["text-font"]&&(S=o.parse(x["text-font"],1,ro(ir)),!S))return null;let k=null;if(x["text-color"]&&(k=o.parse(x["text-color"],1,qi),!k))return null;const M=p[p.length-1];M.scale=E,M.font=S,M.textColor=k}else{const E=o.parse(r[y],1,rr);if(!E)return null;const S=E.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new es(p)}evaluate(r){return new ki(this.sections.map(o=>{const c=o.content.evaluate(r);return ln(c)===zs?new tp("",c,null,null,null):new tp(Oc(c),null,o.scale?o.scale.evaluate(r):null,o.font?o.font.evaluate(r).join(","):null,o.textColor?o.textColor.evaluate(r):null)}))}eachChild(r){for(const o of this.sections)r(o.content),o.scale&&r(o.scale),o.font&&r(o.font),o.textColor&&r(o.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const o of this.sections){r.push(o.content.serialize());const c={};o.scale&&(c["font-scale"]=o.scale.serialize()),o.font&&(c["text-font"]=o.font.serialize()),o.textColor&&(c["text-color"]=o.textColor.serialize()),r.push(c)}return r}}class Gu{constructor(r){this.type=zs,this.input=r}static parse(r,o){if(r.length!==2)return o.error("Expected two arguments.");const c=o.parse(r[1],1,ir);return c?new Gu(c):o.error("No image name provided.")}evaluate(r){const o=this.input.evaluate(r),c=no.fromString(o);return c&&r.availableImages&&(c.available=r.availableImages.indexOf(o)>-1),c}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Yv={"to-boolean":tr,"to-color":qi,"to-number":bt,"to-string":ir};class op{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const c=r[0];if((c==="to-boolean"||c==="to-string")&&r.length!==2)return o.error("Expected one argument.");const p=Yv[c],m=[];for(let y=1;y<r.length;y++){const x=o.parse(r[y],y,rr);if(!x)return null;m.push(x)}return new op(p,m)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let o,c;for(const p of this.args){if(o=p.evaluate(r),c=null,o instanceof fn)return o;if(typeof o=="string"){const m=r.parseColor(o);if(m)return m}else if(Array.isArray(o)&&(c=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:a0(o[0],o[1],o[2],o[3]),!c))return new fn(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Jn(c||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const c of this.args){if(o=c.evaluate(r),o===null)return 0;const p=Number(o);if(!isNaN(p))return p}throw new Jn(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?ki.fromString(Oc(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?no.fromString(Oc(this.args[0].evaluate(r))):Oc(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new es([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Gu(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(o=>{r.push(o.serialize())}),r}}var _l=op;const Xo=["Unknown","Point","LineString","Polygon"];var ap=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Xo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:o,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*r-i[0])+this.featureDistanceData.bearing[1]*(c*r-i[1])}return 0}parseColor(i){let r=this._parseColorCache[i];return r||(r=this._parseColorCache[i]=fn.parse(i)),r}};class Os{constructor(r,o,c,p){this.name=r,this.type=o,this._evaluate=c,this.args=p}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,o){const c=r[0],p=Os.definitions[c];if(!p)return o.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(p)?p[0]:p.type,y=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,x=y.filter(([S])=>!Array.isArray(S)||S.length===r.length-1);let E=null;for(const[S,k]of x){E=new dp(o.registry,o.path,null,o.scope);const M=[];let O=!1;for(let j=1;j<r.length;j++){const G=r[j],K=Array.isArray(S)?S[j-1]:S.type,ee=E.parse(G,1+M.length,K);if(!ee){O=!0;break}M.push(ee)}if(!O)if(Array.isArray(S)&&S.length!==M.length)E.error(`Expected ${S.length} arguments, but found ${M.length} instead.`);else{for(let j=0;j<M.length;j++){const G=Array.isArray(S)?S[j]:S.type,K=M[j];E.concat(j+1).checkSubtype(G,K.type)}if(E.errors.length===0)return new Os(c,m,k,M)}}if(x.length===1)o.errors.push(...E.errors);else{const S=(x.length?x:y).map(([M])=>{return O=M,Array.isArray(O)?`(${O.map(Xr).join(", ")})`:`(${Xr(O.type)}...)`;var O}).join(" | "),k=[];for(let M=1;M<r.length;M++){const O=o.parse(r[M],1+k.length);if(!O)return null;k.push(Xr(O.type))}o.error(`Expected arguments of type ${S}, but found (${k.join(", ")}) instead.`)}return null}static register(r,o){Os.definitions=o;for(const c in o)r[c]=Os}}var Ea=Os;class Fc{constructor(r,o,c){this.type=Zi,this.locale=c,this.caseSensitive=r,this.diacriticSensitive=o}static parse(r,o){if(r.length!==2)return o.error("Expected one argument.");const c=r[1];if(typeof c!="object"||Array.isArray(c))return o.error("Collator options argument must be an object.");const p=o.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,tr);if(!p)return null;const m=o.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,tr);if(!m)return null;let y=null;return c.locale&&(y=o.parse(c.locale,1,ir),!y)?null:new Fc(p,m,y)}evaluate(r){return new ep(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const Sa=8192;function Hu(i,r){i[0]=Math.min(i[0],r[0]),i[1]=Math.min(i[1],r[1]),i[2]=Math.max(i[2],r[0]),i[3]=Math.max(i[3],r[1])}function vl(i,r){return!(i[0]<=r[0]||i[2]>=r[2]||i[1]<=r[1]||i[3]>=r[3])}function Lc(i,r){const o=(180+i[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(o*p*Sa),Math.round(c*p*Sa)]}function s0(i,r,o){const c=i[0]-r[0],p=i[1]-r[1],m=i[0]-o[0],y=i[1]-o[1];return c*y-m*p==0&&c*m<=0&&p*y<=0}function qu(i,r){let o=!1;for(let y=0,x=r.length;y<x;y++){const E=r[y];for(let S=0,k=E.length;S<k-1;S++){if(s0(i,E[S],E[S+1]))return!1;(p=E[S])[1]>(c=i)[1]!=(m=E[S+1])[1]>c[1]&&c[0]<(m[0]-p[0])*(c[1]-p[1])/(m[1]-p[1])+p[0]&&(o=!o)}}var c,p,m;return o}function sp(i,r){for(let o=0;o<r.length;o++)if(qu(i,r[o]))return!0;return!1}function lp(i,r,o,c){const p=c[0]-o[0],m=c[1]-o[1],y=(i[0]-o[0])*m-p*(i[1]-o[1]),x=(r[0]-o[0])*m-p*(r[1]-o[1]);return y>0&&x<0||y<0&&x>0}function xl(i,r,o){for(const S of o)for(let k=0;k<S.length-1;++k)if((x=[(y=S[k+1])[0]-(m=S[k])[0],y[1]-m[1]])[0]*(E=[(p=r)[0]-(c=i)[0],p[1]-c[1]])[1]-x[1]*E[0]!=0&&lp(c,p,m,y)&&lp(m,y,c,p))return!0;var c,p,m,y,x,E;return!1}function wr(i,r){for(let o=0;o<i.length;++o)if(!qu(i[o],r))return!1;for(let o=0;o<i.length-1;++o)if(xl(i[o],i[o+1],r))return!1;return!0}function Qv(i,r){for(let o=0;o<r.length;o++)if(wr(i,r[o]))return!0;return!1}function cp(i,r,o){const c=[];for(let p=0;p<i.length;p++){const m=[];for(let y=0;y<i[p].length;y++){const x=Lc(i[p][y],o);Hu(r,x),m.push(x)}c.push(m)}return c}function l0(i,r,o){const c=[];for(let p=0;p<i.length;p++){const m=cp(i[p],r,o);c.push(m)}return c}function up(i,r,o,c){if(i[0]<o[0]||i[0]>o[2]){const p=.5*c;let m=i[0]-o[0]>p?-c:o[0]-i[0]>p?c:0;m===0&&(m=i[0]-o[2]>p?-c:o[2]-i[0]>p?c:0),i[0]+=m}Hu(r,i)}function c0(i,r,o,c){const p=Math.pow(2,c.z)*Sa,m=[c.x*Sa,c.y*Sa],y=[];if(!i)return y;for(const x of i)for(const E of x){const S=[E.x+m[0],E.y+m[1]];up(S,r,o,p),y.push(S)}return y}function hp(i,r,o,c){const p=Math.pow(2,c.z)*Sa,m=[c.x*Sa,c.y*Sa],y=[];if(!i)return y;for(const E of i){const S=[];for(const k of E){const M=[k.x+m[0],k.y+m[1]];Hu(r,M),S.push(M)}y.push(S)}if(r[2]-r[0]<=p/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of y)for(const S of E)up(S,r,o,p)}var x;return y}class bl{constructor(r,o){this.type=tr,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Rc(r[1])){const c=r[1];if(c.type==="FeatureCollection")for(let p=0;p<c.features.length;++p){const m=c.features[p].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new bl(c,c.features[p].geometry)}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new bl(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new bl(c,c)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(o,c){const p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if(c.type==="Polygon"){const x=cp(c.coordinates,m,y),E=c0(o.geometry(),p,m,y);if(!vl(p,m))return!1;for(const S of E)if(!qu(S,x))return!1}if(c.type==="MultiPolygon"){const x=l0(c.coordinates,m,y),E=c0(o.geometry(),p,m,y);if(!vl(p,m))return!1;for(const S of E)if(!sp(S,x))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(o,c){const p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if(c.type==="Polygon"){const x=cp(c.coordinates,m,y),E=hp(o.geometry(),p,m,y);if(!vl(p,m))return!1;for(const S of E)if(!wr(S,x))return!1}if(c.type==="MultiPolygon"){const x=l0(c.coordinates,m,y),E=hp(o.geometry(),p,m,y);if(!vl(p,m))return!1;for(const S of E)if(!Qv(S,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Zu=bl;function wl(i){if(i instanceof Ea&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Zu)return!1;let r=!0;return i.eachChild(o=>{r&&!wl(o)&&(r=!1)}),r}function Ta(i){if(i instanceof Ea&&i.name==="feature-state")return!1;let r=!0;return i.eachChild(o=>{r&&!Ta(o)&&(r=!1)}),r}function Fs(i,r){if(i instanceof Ea&&r.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(c=>{o&&!Fs(c,r)&&(o=!1)}),o}class Ku{constructor(r,o){this.type=o.type,this.name=r,this.boundExpression=o}static parse(r,o){if(r.length!==2||typeof r[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const c=r[1];return o.scope.has(c)?new Ku(c,o.scope.get(c)):o.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var u0=Ku;class Bc{constructor(r,o=[],c,p=new n0,m=[]){this.registry=r,this.path=o,this.key=o.map(y=>`[${y}]`).join(""),this.scope=p,this.errors=m,this.expectedType=c}parse(r,o,c,p,m={}){return o?this.concat(o,c,p)._parse(r,m):this._parse(r,m)}_parse(r,o){function c(p,m,y){return y==="assert"?new wa(m,[p]):y==="coerce"?new _l(m,[p]):p}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=r[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[p];if(m){let y=m.parse(r,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,E=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||E.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string"){if(this.checkSubtype(x,E))return null}else y=c(y,x,o.typeAnnotation||"coerce");else y=c(y,x,o.typeAnnotation||"assert")}if(!(y instanceof Rs)&&y.type.kind!=="resolvedImage"&&pp(y)){const x=new ap;try{y=new Rs(y.type,y.evaluate(x))}catch(E){return this.error(E.message),null}}return y}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,o,c){const p=typeof r=="number"?this.path.concat(r):this.path,m=c?this.scope.concat(c):this.scope;return new Bc(this.registry,p,o||null,m,this.errors)}error(r,...o){const c=`${this.key}${o.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ko(c,r))}checkSubtype(r,o){const c=ba(r,o);return c&&this.error(c),c}}var dp=Bc;function pp(i){if(i instanceof u0)return pp(i.boundExpression);if(i instanceof Ea&&i.name==="error"||i instanceof Fc||i instanceof Zu)return!1;const r=i instanceof _l||i instanceof wa;let o=!0;return i.eachChild(c=>{o=r?o&&pp(c):o&&c instanceof Rs}),!!o&&wl(i)&&Fs(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Xu(i,r){const o=i.length-1;let c,p,m=0,y=o,x=0;for(;m<=y;)if(x=Math.floor((m+y)/2),c=i[x],p=i[x+1],c<=r){if(x===o||r<p)return x;m=x+1}else{if(!(c>r))throw new Jn("Input is not a number.");y=x-1}return 0}class Yu{constructor(r,o,c){this.type=r,this.input=o,this.labels=[],this.outputs=[];for(const[p,m]of c)this.labels.push(p),this.outputs.push(m)}static parse(r,o){if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");const c=o.parse(r[1],1,bt);if(!c)return null;const p=[];let m=null;o.expectedType&&o.expectedType.kind!=="value"&&(m=o.expectedType);for(let y=1;y<r.length;y+=2){const x=y===1?-1/0:r[y],E=r[y+1],S=y,k=y+1;if(typeof x!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(p.length&&p[p.length-1][0]>=x)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const M=o.parse(E,k,m);if(!M)return null;m=m||M.type,p.push([x,M])}return new Yu(m,c,p)}evaluate(r){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(r);const p=this.input.evaluate(r);if(p<=o[0])return c[0].evaluate(r);const m=o.length;return p>=o[m-1]?c[m-1].evaluate(r):c[Xu(o,p)].evaluate(r)}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&r.push(this.labels[o]),r.push(this.outputs[o].serialize());return r}}var fp=Yu;function dr(i,r,o){return i*(1-o)+r*o}var Nc=Object.freeze({__proto__:null,array:function(i,r,o){return i.map((c,p)=>dr(c,r[p],o))},color:function(i,r,o){return new fn(dr(i.r,r.r,o),dr(i.g,r.g,o),dr(i.b,r.b,o),dr(i.a,r.a,o))},number:dr});const h0=.95047,mp=1.08883,d0=4/29,Ls=6/29,gp=3*Ls*Ls,Jv=Ls*Ls*Ls,ex=Math.PI/180,tx=180/Math.PI;function yp(i){return i>Jv?Math.pow(i,1/3):i/gp+d0}function _p(i){return i>Ls?i*i*i:gp*(i-d0)}function vp(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Qu(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function p0(i){const r=Qu(i.r),o=Qu(i.g),c=Qu(i.b),p=yp((.4124564*r+.3575761*o+.1804375*c)/h0),m=yp((.2126729*r+.7151522*o+.072175*c)/1);return{l:116*m-16,a:500*(p-m),b:200*(m-yp((.0193339*r+.119192*o+.9503041*c)/mp)),alpha:i.a}}function f0(i){let r=(i.l+16)/116,o=isNaN(i.a)?r:r+i.a/500,c=isNaN(i.b)?r:r-i.b/200;return r=1*_p(r),o=h0*_p(o),c=mp*_p(c),new fn(vp(3.2404542*o-1.5371385*r-.4985314*c),vp(-.969266*o+1.8760108*r+.041556*c),vp(.0556434*o-.2040259*r+1.0572252*c),i.alpha)}function rx(i,r,o){const c=r-i;return i+o*(c>180||c<-180?c-360*Math.round(c/360):c)}const Uc={forward:p0,reverse:f0,interpolate:function(i,r,o){return{l:dr(i.l,r.l,o),a:dr(i.a,r.a,o),b:dr(i.b,r.b,o),alpha:dr(i.alpha,r.alpha,o)}}},El={forward:function(i){const{l:r,a:o,b:c}=p0(i),p=Math.atan2(c,o)*tx;return{h:p<0?p+360:p,c:Math.sqrt(o*o+c*c),l:r,alpha:i.a}},reverse:function(i){const r=i.h*ex,o=i.c;return f0({l:i.l,a:Math.cos(r)*o,b:Math.sin(r)*o,alpha:i.alpha})},interpolate:function(i,r,o){return{h:rx(i.h,r.h,o),c:dr(i.c,r.c,o),l:dr(i.l,r.l,o),alpha:dr(i.alpha,r.alpha,o)}}};var xp=Object.freeze({__proto__:null,hcl:El,lab:Uc});class jc{constructor(r,o,c,p,m){this.type=r,this.operator=o,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[y,x]of m)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(r,o,c,p){let m=0;if(r.name==="exponential")m=bp(o,r.base,c,p);else if(r.name==="linear")m=bp(o,1,c,p);else if(r.name==="cubic-bezier"){const y=r.controlPoints;m=new te(y[0],y[1],y[2],y[3]).solve(bp(o,1,c,p))}return m}static parse(r,o){let[c,p,m,...y]=r;if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const S=p[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if(p[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const S=p.slice(1);if(S.length!==4||S.some(k=>typeof k!="number"||k<0||k>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:S}}}if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(m=o.parse(m,2,bt),!m)return null;const x=[];let E=null;c==="interpolate-hcl"||c==="interpolate-lab"?E=qi:o.expectedType&&o.expectedType.kind!=="value"&&(E=o.expectedType);for(let S=0;S<y.length;S+=2){const k=y[S],M=y[S+1],O=S+3,j=S+4;if(typeof k!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(x.length&&x[x.length-1][0]>=k)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const G=o.parse(M,j,E);if(!G)return null;E=E||G.type,x.push([k,G])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new jc(E,c,p,m,x):o.error(`Type ${Xr(E)} is not interpolatable.`)}evaluate(r){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(r);const p=this.input.evaluate(r);if(p<=o[0])return c[0].evaluate(r);const m=o.length;if(p>=o[m-1])return c[m-1].evaluate(r);const y=Xu(o,p),x=jc.interpolationFactor(this.interpolation,p,o[y],o[y+1]),E=c[y].evaluate(r),S=c[y+1].evaluate(r);return this.operator==="interpolate"?Nc[this.type.kind.toLowerCase()](E,S,x):this.operator==="interpolate-hcl"?El.reverse(El.interpolate(El.forward(E),El.forward(S),x)):Uc.reverse(Uc.interpolate(Uc.forward(E),Uc.forward(S),x))}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,r,this.input.serialize()];for(let c=0;c<this.labels.length;c++)o.push(this.labels[c],this.outputs[c].serialize());return o}}function bp(i,r,o,c){const p=c-o,m=i-o;return p===0?0:r===1?m/p:(Math.pow(r,m)-1)/(Math.pow(r,p)-1)}var Yo=jc;class Ju{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expectected at least one argument.");let c=null;const p=o.expectedType;p&&p.kind!=="value"&&(c=p);const m=[];for(const x of r.slice(1)){const E=o.parse(x,1+m.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,m.push(E)}const y=p&&m.some(x=>ba(p,x.type));return new Ju(y?rr:c,m)}evaluate(r){let o,c=null,p=0;for(const m of this.args){if(p++,c=m.evaluate(r),c&&c instanceof no&&!c.available&&(o||(o=c),c=null,p===this.args.length))return o;if(c!==null)break}return c}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(o=>{r.push(o.serialize())}),r}}var wp=Ju;class eh{constructor(r,o){this.type=o.type,this.bindings=[].concat(r),this.result=o}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const o of this.bindings)r(o[1]);r(this.result)}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const c=[];for(let m=1;m<r.length-1;m+=2){const y=r[m];if(typeof y!="string")return o.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=o.parse(r[m+1],m+1);if(!x)return null;c.push([y,x])}const p=o.parse(r[r.length-1],r.length-1,o.expectedType,c);return p?new eh(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[o,c]of this.bindings)r.push(o,c.serialize());return r.push(this.result.serialize()),r}}var m0=eh;class Ep{constructor(r,o,c){this.type=r,this.index=o,this.input=c}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=o.parse(r[1],1,bt),p=o.parse(r[2],2,ro(o.expectedType||rr));return c&&p?new Ep(p.type.itemType,c,p):null}evaluate(r){const o=this.index.evaluate(r),c=this.input.evaluate(r);if(o<0)throw new Jn(`Array index out of bounds: ${o} < 0.`);if(o>=c.length)throw new Jn(`Array index out of bounds: ${o} > ${c.length-1}.`);if(o!==Math.floor(o))throw new Jn(`Array index must be an integer, but found ${o} instead.`);return c[o]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var nx=Ep;class Sp{constructor(r,o){this.type=tr,this.needle=r,this.haystack=o}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=o.parse(r[1],1,rr),p=o.parse(r[2],2,rr);return c&&p?Pc(c.type,[tr,ir,bt,gl,rr])?new Sp(c,p):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xr(c.type)} instead`):null}evaluate(r){const o=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(c==null)return!1;if(!Dc(o,["boolean","string","number","null"]))throw new Jn(`Expected first argument to be of type boolean, string, number or null, but found ${Xr(ln(o))} instead.`);if(!Dc(c,["string","array"]))throw new Jn(`Expected second argument to be of type array or string, but found ${Xr(ln(c))} instead.`);return c.indexOf(o)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var th=Sp;class Vc{constructor(r,o,c){this.type=bt,this.needle=r,this.haystack=o,this.fromIndex=c}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=o.parse(r[1],1,rr),p=o.parse(r[2],2,rr);if(!c||!p)return null;if(!Pc(c.type,[tr,ir,bt,gl,rr]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xr(c.type)} instead`);if(r.length===4){const m=o.parse(r[3],3,bt);return m?new Vc(c,p,m):null}return new Vc(c,p)}evaluate(r){const o=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!Dc(o,["boolean","string","number","null"]))throw new Jn(`Expected first argument to be of type boolean, string, number or null, but found ${Xr(ln(o))} instead.`);if(!Dc(c,["string","array"]))throw new Jn(`Expected second argument to be of type array or string, but found ${Xr(ln(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(r);return c.indexOf(o,p)}return c.indexOf(o)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var g0=Vc;class Tp{constructor(r,o,c,p,m,y){this.inputType=r,this.type=o,this.input=c,this.cases=p,this.outputs=m,this.otherwise=y}static parse(r,o){if(r.length<5)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return o.error("Expected an even number of arguments.");let c,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const m={},y=[];for(let S=2;S<r.length-1;S+=2){let k=r[S];const M=r[S+1];Array.isArray(k)||(k=[k]);const O=o.concat(S);if(k.length===0)return O.error("Expected at least one branch label.");for(const G of k){if(typeof G!="number"&&typeof G!="string")return O.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return O.error("Numeric branch labels must be integer values.");if(c){if(O.checkSubtype(c,ln(G)))return null}else c=ln(G);if(m[String(G)]!==void 0)return O.error("Branch labels must be unique.");m[String(G)]=y.length}const j=o.parse(M,S,p);if(!j)return null;p=p||j.type,y.push(j)}const x=o.parse(r[1],1,rr);if(!x)return null;const E=o.parse(r[r.length-1],r.length-1,p);return E?x.type.kind!=="value"&&o.concat(1).checkSubtype(c,x.type)?null:new Tp(c,p,x,m,y,E):null}evaluate(r){const o=this.input.evaluate(r);return(ln(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),c=[],p={};for(const y of o){const x=p[this.cases[y]];x===void 0?(p[this.cases[y]]=c.length,c.push([this.cases[y],[y]])):c[x][1].push(y)}const m=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,x]of c)r.push(x.length===1?m(x[0]):x.map(m)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}var ix=Tp;class Ap{constructor(r,o,c){this.type=r,this.branches=o,this.otherwise=c}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return o.error("Expected an odd number of arguments.");let c;o.expectedType&&o.expectedType.kind!=="value"&&(c=o.expectedType);const p=[];for(let y=1;y<r.length-1;y+=2){const x=o.parse(r[y],y,tr);if(!x)return null;const E=o.parse(r[y+1],y+1,c);if(!E)return null;p.push([x,E]),c=c||E.type}const m=o.parse(r[r.length-1],r.length-1,c);return m?new Ap(c,p,m):null}evaluate(r){for(const[o,c]of this.branches)if(o.evaluate(r))return c.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[o,c]of this.branches)r(o),r(c);r(this.otherwise)}outputDefined(){return this.branches.every(([r,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(o=>{r.push(o.serialize())}),r}}var y0=Ap;class $c{constructor(r,o,c,p){this.type=r,this.input=o,this.beginIndex=c,this.endIndex=p}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=o.parse(r[1],1,rr),p=o.parse(r[2],2,bt);if(!c||!p)return null;if(!Pc(c.type,[ro(rr),ir,rr]))return o.error(`Expected first argument to be of type array or string, but found ${Xr(c.type)} instead`);if(r.length===4){const m=o.parse(r[3],3,bt);return m?new $c(c.type,c,p,m):null}return new $c(c.type,c,p)}evaluate(r){const o=this.input.evaluate(r),c=this.beginIndex.evaluate(r);if(!Dc(o,["string","array"]))throw new Jn(`Expected first argument to be of type array or string, but found ${Xr(ln(o))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(r);return o.slice(c,p)}return o.slice(c)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var _0=$c;function rh(i,r){return i==="=="||i==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function v0(i,r,o,c){return c.compare(r,o)===0}function Sl(i,r,o){const c=i!=="=="&&i!=="!=";return class I3{constructor(m,y,x){this.type=tr,this.lhs=m,this.rhs=y,this.collator=x,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const x=m[0];let E=y.parse(m[1],1,rr);if(!E)return null;if(!rh(x,E.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${Xr(E.type)}'.`);let S=y.parse(m[2],2,rr);if(!S)return null;if(!rh(x,S.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${Xr(S.type)}'.`);if(E.type.kind!==S.type.kind&&E.type.kind!=="value"&&S.type.kind!=="value")return y.error(`Cannot compare types '${Xr(E.type)}' and '${Xr(S.type)}'.`);c&&(E.type.kind==="value"&&S.type.kind!=="value"?E=new wa(S.type,[E]):E.type.kind!=="value"&&S.type.kind==="value"&&(S=new wa(E.type,[S])));let k=null;if(m.length===4){if(E.type.kind!=="string"&&S.type.kind!=="string"&&E.type.kind!=="value"&&S.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(k=y.parse(m[3],3,Zi),!k)return null}return new I3(E,S,k)}evaluate(m){const y=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(c&&this.hasUntypedArgument){const E=ln(y),S=ln(x);if(E.kind!==S.kind||E.kind!=="string"&&E.kind!=="number")throw new Jn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${E.kind}, ${S.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=ln(y),S=ln(x);if(E.kind!=="string"||S.kind!=="string")return r(m,y,x)}return this.collator?o(m,y,x,this.collator.evaluate(m)):r(m,y,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[i];return this.eachChild(y=>{m.push(y.serialize())}),m}}}const ox=Sl("==",function(i,r,o){return r===o},v0),ax=Sl("!=",function(i,r,o){return r!==o},function(i,r,o,c){return!v0(0,r,o,c)}),sx=Sl("<",function(i,r,o){return r<o},function(i,r,o,c){return c.compare(r,o)<0}),lx=Sl(">",function(i,r,o){return r>o},function(i,r,o,c){return c.compare(r,o)>0}),cx=Sl("<=",function(i,r,o){return r<=o},function(i,r,o,c){return c.compare(r,o)<=0}),x0=Sl(">=",function(i,r,o){return r>=o},function(i,r,o,c){return c.compare(r,o)>=0});class nh{constructor(r,o,c,p,m,y){this.type=ir,this.number=r,this.locale=o,this.currency=c,this.unit=p,this.minFractionDigits=m,this.maxFractionDigits=y}static parse(r,o){if(r.length!==3)return o.error("Expected two arguments.");const c=o.parse(r[1],1,bt);if(!c)return null;const p=r[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");let m=null;if(p.locale&&(m=o.parse(p.locale,1,ir),!m))return null;let y=null;if(p.currency&&(y=o.parse(p.currency,1,ir),!y))return null;let x=null;if(p.unit&&(x=o.parse(p.unit,1,ir),!x))return null;let E=null;if(p["min-fraction-digits"]&&(E=o.parse(p["min-fraction-digits"],1,bt),!E))return null;let S=null;return p["max-fraction-digits"]&&(S=o.parse(p["max-fraction-digits"],1,bt),!S)?null:new nh(c,m,y,x,E,S)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Tl{constructor(r){this.type=bt,this.input=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const c=o.parse(r[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Xr(c.type)} instead.`):new Tl(c):null}evaluate(r){const o=this.input.evaluate(r);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Jn(`Expected value to be of type string or array, but found ${Xr(ln(o))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(o=>{r.push(o.serialize())}),r}}const b0={"==":ox,"!=":ax,">":lx,"<":sx,">=":x0,"<=":cx,array:wa,at:nx,boolean:wa,case:y0,coalesce:wp,collator:Fc,format:es,image:Gu,in:th,"index-of":g0,interpolate:Yo,"interpolate-hcl":Yo,"interpolate-lab":Yo,length:Tl,let:m0,literal:Rs,match:ix,number:wa,"number-format":nh,object:wa,slice:_0,step:fp,string:wa,"to-boolean":_l,"to-color":_l,"to-number":_l,"to-string":_l,var:u0,within:Zu};function w0(i,[r,o,c,p]){r=r.evaluate(i),o=o.evaluate(i),c=c.evaluate(i);const m=p?p.evaluate(i):1,y=a0(r,o,c,m);if(y)throw new Jn(y);return new fn(r/255*m,o/255*m,c/255*m,m)}function Aa(i,r){return i in r}function ih(i,r){const o=r[i];return o===void 0?null:o}function io(i){return{type:i}}Ea.register(b0,{error:[{kind:"error"},[ir],(i,[r])=>{throw new Jn(r.evaluate(i))}],typeof:[ir,[rr],(i,[r])=>Xr(ln(r.evaluate(i)))],"to-rgba":[ro(bt,4),[qi],(i,[r])=>r.evaluate(i).toArray()],rgb:[qi,[bt,bt,bt],w0],rgba:[qi,[bt,bt,bt,bt],w0],has:{type:tr,overloads:[[[ir],(i,[r])=>Aa(r.evaluate(i),i.properties())],[[ir,Ao],(i,[r,o])=>Aa(r.evaluate(i),o.evaluate(i))]]},get:{type:rr,overloads:[[[ir],(i,[r])=>ih(r.evaluate(i),i.properties())],[[ir,Ao],(i,[r,o])=>ih(r.evaluate(i),o.evaluate(i))]]},"feature-state":[rr,[ir],(i,[r])=>ih(r.evaluate(i),i.featureState||{})],properties:[Ao,[],i=>i.properties()],"geometry-type":[ir,[],i=>i.geometryType()],id:[rr,[],i=>i.id()],zoom:[bt,[],i=>i.globals.zoom],pitch:[bt,[],i=>i.globals.pitch||0],"distance-from-center":[bt,[],i=>i.distanceFromCenter()],"heatmap-density":[bt,[],i=>i.globals.heatmapDensity||0],"line-progress":[bt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[bt,[],i=>i.globals.skyRadialProgress||0],accumulated:[rr,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[bt,io(bt),(i,r)=>{let o=0;for(const c of r)o+=c.evaluate(i);return o}],"*":[bt,io(bt),(i,r)=>{let o=1;for(const c of r)o*=c.evaluate(i);return o}],"-":{type:bt,overloads:[[[bt,bt],(i,[r,o])=>r.evaluate(i)-o.evaluate(i)],[[bt],(i,[r])=>-r.evaluate(i)]]},"/":[bt,[bt,bt],(i,[r,o])=>r.evaluate(i)/o.evaluate(i)],"%":[bt,[bt,bt],(i,[r,o])=>r.evaluate(i)%o.evaluate(i)],ln2:[bt,[],()=>Math.LN2],pi:[bt,[],()=>Math.PI],e:[bt,[],()=>Math.E],"^":[bt,[bt,bt],(i,[r,o])=>Math.pow(r.evaluate(i),o.evaluate(i))],sqrt:[bt,[bt],(i,[r])=>Math.sqrt(r.evaluate(i))],log10:[bt,[bt],(i,[r])=>Math.log(r.evaluate(i))/Math.LN10],ln:[bt,[bt],(i,[r])=>Math.log(r.evaluate(i))],log2:[bt,[bt],(i,[r])=>Math.log(r.evaluate(i))/Math.LN2],sin:[bt,[bt],(i,[r])=>Math.sin(r.evaluate(i))],cos:[bt,[bt],(i,[r])=>Math.cos(r.evaluate(i))],tan:[bt,[bt],(i,[r])=>Math.tan(r.evaluate(i))],asin:[bt,[bt],(i,[r])=>Math.asin(r.evaluate(i))],acos:[bt,[bt],(i,[r])=>Math.acos(r.evaluate(i))],atan:[bt,[bt],(i,[r])=>Math.atan(r.evaluate(i))],min:[bt,io(bt),(i,r)=>Math.min(...r.map(o=>o.evaluate(i)))],max:[bt,io(bt),(i,r)=>Math.max(...r.map(o=>o.evaluate(i)))],abs:[bt,[bt],(i,[r])=>Math.abs(r.evaluate(i))],round:[bt,[bt],(i,[r])=>{const o=r.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[bt,[bt],(i,[r])=>Math.floor(r.evaluate(i))],ceil:[bt,[bt],(i,[r])=>Math.ceil(r.evaluate(i))],"filter-==":[tr,[ir,rr],(i,[r,o])=>i.properties()[r.value]===o.value],"filter-id-==":[tr,[rr],(i,[r])=>i.id()===r.value],"filter-type-==":[tr,[ir],(i,[r])=>i.geometryType()===r.value],"filter-<":[tr,[ir,rr],(i,[r,o])=>{const c=i.properties()[r.value],p=o.value;return typeof c==typeof p&&c<p}],"filter-id-<":[tr,[rr],(i,[r])=>{const o=i.id(),c=r.value;return typeof o==typeof c&&o<c}],"filter->":[tr,[ir,rr],(i,[r,o])=>{const c=i.properties()[r.value],p=o.value;return typeof c==typeof p&&c>p}],"filter-id->":[tr,[rr],(i,[r])=>{const o=i.id(),c=r.value;return typeof o==typeof c&&o>c}],"filter-<=":[tr,[ir,rr],(i,[r,o])=>{const c=i.properties()[r.value],p=o.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[tr,[rr],(i,[r])=>{const o=i.id(),c=r.value;return typeof o==typeof c&&o<=c}],"filter->=":[tr,[ir,rr],(i,[r,o])=>{const c=i.properties()[r.value],p=o.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[tr,[rr],(i,[r])=>{const o=i.id(),c=r.value;return typeof o==typeof c&&o>=c}],"filter-has":[tr,[rr],(i,[r])=>r.value in i.properties()],"filter-has-id":[tr,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[tr,[ro(ir)],(i,[r])=>r.value.indexOf(i.geometryType())>=0],"filter-id-in":[tr,[ro(rr)],(i,[r])=>r.value.indexOf(i.id())>=0],"filter-in-small":[tr,[ir,ro(rr)],(i,[r,o])=>o.value.indexOf(i.properties()[r.value])>=0],"filter-in-large":[tr,[ir,ro(rr)],(i,[r,o])=>function(c,p,m,y){for(;m<=y;){const x=m+y>>1;if(p[x]===c)return!0;p[x]>c?y=x-1:m=x+1}return!1}(i.properties()[r.value],o.value,0,o.value.length-1)],all:{type:tr,overloads:[[[tr,tr],(i,[r,o])=>r.evaluate(i)&&o.evaluate(i)],[io(tr),(i,r)=>{for(const o of r)if(!o.evaluate(i))return!1;return!0}]]},any:{type:tr,overloads:[[[tr,tr],(i,[r,o])=>r.evaluate(i)||o.evaluate(i)],[io(tr),(i,r)=>{for(const o of r)if(o.evaluate(i))return!0;return!1}]]},"!":[tr,[tr],(i,[r])=>!r.evaluate(i)],"is-supported-script":[tr,[ir],(i,[r])=>{const o=i.globals&&i.globals.isSupportedScript;return!o||o(r.evaluate(i))}],upcase:[ir,[ir],(i,[r])=>r.evaluate(i).toUpperCase()],downcase:[ir,[ir],(i,[r])=>r.evaluate(i).toLowerCase()],concat:[ir,io(rr),(i,r)=>r.map(o=>Oc(o.evaluate(i))).join("")],"resolved-locale":[ir,[Zi],(i,[r])=>r.evaluate(i).resolvedLocale()]});var Wc=b0;function E0(i){return{result:"success",value:i}}function Bs(i){return{result:"error",value:i}}function Al(i){return i["property-type"]==="data-driven"}function oh(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function ah(i){return!!i.expression&&i.expression.interpolated}function pr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Gc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function S0(i){return i}function sh(i,r){const o=r.type==="color",c=i.stops&&typeof i.stops[0][0]=="object",p=c||!(c||i.property!==void 0),m=i.type||(ah(r)?"exponential":"interval");if(o&&((i=xa({},i)).stops&&(i.stops=i.stops.map(S=>[S[0],fn.parse(S[1])])),i.default=fn.parse(i.default?i.default:r.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!xp[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let y,x,E;if(m==="exponential")y=Ia;else if(m==="interval")y=lh;else if(m==="categorical"){y=T0,x=Object.create(null);for(const S of i.stops)x[S[0]]=S[1];E=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);y=A0}if(c){const S={},k=[];for(let j=0;j<i.stops.length;j++){const G=i.stops[j],K=G[0].zoom;S[K]===void 0&&(S[K]={zoom:K,type:i.type,property:i.property,default:i.default,stops:[]},k.push(K)),S[K].stops.push([G[0].value,G[1]])}const M=[];for(const j of k)M.push([S[j].zoom,sh(S[j],r)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:Yo.interpolationFactor.bind(void 0,O),zoomStops:M.map(j=>j[0]),evaluate:({zoom:j},G)=>Ia({stops:M,base:i.base},r,j).evaluate(j,G)}}if(p){const S=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Yo.interpolationFactor.bind(void 0,S),zoomStops:i.stops.map(k=>k[0]),evaluate:({zoom:k})=>y(i,r,k,x,E)}}return{kind:"source",evaluate(S,k){const M=k&&k.properties?k.properties[i.property]:void 0;return M===void 0?Il(i.default,r.default):y(i,r,M,x,E)}}}function Il(i,r,o){return i!==void 0?i:r!==void 0?r:o!==void 0?o:void 0}function T0(i,r,o,c,p){return Il(typeof o===p?c[o]:void 0,i.default,r.default)}function lh(i,r,o){if(pr(o)!=="number")return Il(i.default,r.default);const c=i.stops.length;if(c===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[c-1][0])return i.stops[c-1][1];const p=Xu(i.stops.map(m=>m[0]),o);return i.stops[p][1]}function Ia(i,r,o){const c=i.base!==void 0?i.base:1;if(pr(o)!=="number")return Il(i.default,r.default);const p=i.stops.length;if(p===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[p-1][0])return i.stops[p-1][1];const m=Xu(i.stops.map(k=>k[0]),o),y=function(k,M,O,j){const G=j-O,K=k-O;return G===0?0:M===1?K/G:(Math.pow(M,K)-1)/(Math.pow(M,G)-1)}(o,c,i.stops[m][0],i.stops[m+1][0]),x=i.stops[m][1],E=i.stops[m+1][1];let S=Nc[r.type]||S0;if(i.colorSpace&&i.colorSpace!=="rgb"){const k=xp[i.colorSpace];S=(M,O)=>k.reverse(k.interpolate(k.forward(M),k.forward(O),y))}return typeof x.evaluate=="function"?{evaluate(...k){const M=x.evaluate.apply(void 0,k),O=E.evaluate.apply(void 0,k);if(M!==void 0&&O!==void 0)return S(M,O,y)}}:S(x,E,y)}function A0(i,r,o){return r.type==="color"?o=fn.parse(o):r.type==="formatted"?o=ki.fromString(o.toString()):r.type==="resolvedImage"?o=no.fromString(o.toString()):pr(o)===r.type||r.type==="enum"&&r.values[o]||(o=void 0),Il(o,i.default,r.default)}class ch{constructor(r,o){this.expression=r,this._warningHistory={},this._evaluator=new ap,this._defaultValue=o?function(c){return c.type==="color"&&(Gc(c.default)||Array.isArray(c.default))?new fn(0,0,0,0):c.type==="color"?fn.parse(c.default)||null:c.default===void 0?null:c.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(r,o,c,p,m,y,x,E){return this._evaluator.globals=r,this._evaluator.feature=o,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,o,c,p,m,y,x,E){this._evaluator.globals=r,this._evaluator.feature=o||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Jn(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function Cl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Wc}function kl(i,r){const o=new dp(Wc,[],r?function(p){const m={color:qi,string:ir,number:bt,enum:ir,boolean:tr,formatted:kc,resolvedImage:zs};return p.type==="array"?ro(m[p.value]||rr,p.length):m[p.type]}(r):void 0),c=o.parse(i,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?E0(new ch(c,r)):Bs(o.errors)}class Ip{constructor(r,o){this.kind=r,this._styleExpression=o,this.isStateDependent=r!=="constant"&&!Ta(o.expression)}evaluateWithoutErrorHandling(r,o,c,p,m,y){return this._styleExpression.evaluateWithoutErrorHandling(r,o,c,p,m,y)}evaluate(r,o,c,p,m,y){return this._styleExpression.evaluate(r,o,c,p,m,y)}}class Hc{constructor(r,o,c,p){this.kind=r,this.zoomStops=c,this._styleExpression=o,this.isStateDependent=r!=="camera"&&!Ta(o.expression),this.interpolationType=p}evaluateWithoutErrorHandling(r,o,c,p,m,y){return this._styleExpression.evaluateWithoutErrorHandling(r,o,c,p,m,y)}evaluate(r,o,c,p,m,y){return this._styleExpression.evaluate(r,o,c,p,m,y)}interpolationFactor(r,o,c){return this.interpolationType?Yo.interpolationFactor(this.interpolationType,r,o,c):0}}function qc(i,r){if((i=kl(i,r)).result==="error")return i;const o=i.value.expression,c=wl(o);if(!c&&!Al(r))return Bs([new Ko("","data expressions not supported")]);const p=Fs(o,["zoom","pitch","distance-from-center"]);if(!p&&!oh(r))return Bs([new Ko("","zoom expressions not supported")]);const m=hh(o);return m||p?m instanceof Ko?Bs([m]):m instanceof Yo&&!ah(r)?Bs([new Ko("",'"interpolate" expressions cannot be used with this property')]):E0(m?new Hc(c?"camera":"composite",i.value,m.labels,m instanceof Yo?m.interpolation:void 0):new Ip(c?"constant":"source",i.value)):Bs([new Ko("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class uh{constructor(r,o){this._parameters=r,this._specification=o,xa(this,sh(this._parameters,this._specification))}static deserialize(r){return new uh(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function hh(i){let r=null;if(i instanceof m0)r=hh(i.result);else if(i instanceof wp){for(const o of i.args)if(r=hh(o),r)break}else(i instanceof fp||i instanceof Yo)&&i.input instanceof Ea&&i.input.name==="zoom"&&(r=i);return r instanceof Ko||i.eachChild(o=>{const c=hh(o);c instanceof Ko?r=c:!r&&c?r=new Ko("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&c&&r!==c&&(r=new Ko("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class Et{constructor(r,o,c,p){this.message=(r?`${r}: `:"")+c,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)}}function Io(i){const r=i.key,o=i.value,c=i.valueSpec||{},p=i.objectElementValidators||{},m=i.style,y=i.styleSpec;let x=[];const E=pr(o);if(E!=="object")return[new Et(r,o,`object expected, ${E} found`)];for(const S in o){const k=S.split(".")[0];let M;p[k]?M=p[k]:c[k]?M=ci:p["*"]?M=p["*"]:c["*"]&&(M=ci),M?x=x.concat(M({key:(r&&`${r}.`)+S,value:o[S],valueSpec:c[k]||c["*"],style:m,styleSpec:y,object:o,objectKey:S},o)):x.push(new Et(r,o[S],`unknown property "${S}"`))}for(const S in c)p[S]||c[S].required&&c[S].default===void 0&&o[S]===void 0&&x.push(new Et(r,o,`missing required property "${S}"`));return x}function I0(i){const r=i.value,o=i.valueSpec,c=i.style,p=i.styleSpec,m=i.key,y=i.arrayElementValidator||ci;if(pr(r)!=="array")return[new Et(m,r,`array expected, ${pr(r)} found`)];if(o.length&&r.length!==o.length)return[new Et(m,r,`array length ${o.length} expected, length ${r.length} found`)];if(o["min-length"]&&r.length<o["min-length"])return[new Et(m,r,`array length at least ${o["min-length"]} expected, length ${r.length} found`)];let x={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};p.$version<7&&(x.function=o.function),pr(o.value)==="object"&&(x=o.value);let E=[];for(let S=0;S<r.length;S++)E=E.concat(y({array:r,arrayIndex:S,value:r[S],valueSpec:x,style:c,styleSpec:p,key:`${m}[${S}]`}));return E}function Zc(i){const r=i.key,o=i.value,c=i.valueSpec;let p=pr(o);if(p==="number"&&o!=o&&(p="NaN"),p!=="number")return[new Et(r,o,`number expected, ${p} found`)];if("minimum"in c){let m=c.minimum;if(pr(c.minimum)==="array"&&(m=c.minimum[i.arrayIndex]),o<m)return[new Et(r,o,`${o} is less than the minimum value ${m}`)]}if("maximum"in c){let m=c.maximum;if(pr(c.maximum)==="array"&&(m=c.maximum[i.arrayIndex]),o>m)return[new Et(r,o,`${o} is greater than the maximum value ${m}`)]}return[]}function Kc(i){const r=i.valueSpec,o=_n(i.value.type);let c,p,m,y={};const x=o!=="categorical"&&i.value.property===void 0,E=!x,S=pr(i.value.stops)==="array"&&pr(i.value.stops[0])==="array"&&pr(i.value.stops[0][0])==="object",k=Io({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(j){if(o==="identity")return[new Et(j.key,j.value,'identity function may not have a "stops" property')];let G=[];const K=j.value;return G=G.concat(I0({key:j.key,value:K,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:M})),pr(K)==="array"&&K.length===0&&G.push(new Et(j.key,K,"array must have at least one stop")),G},default:function(j){return ci({key:j.key,value:j.value,valueSpec:r,style:j.style,styleSpec:j.styleSpec})}}});return o==="identity"&&x&&k.push(new Et(i.key,i.value,'missing required property "property"')),o==="identity"||i.value.stops||k.push(new Et(i.key,i.value,'missing required property "stops"')),o==="exponential"&&i.valueSpec.expression&&!ah(i.valueSpec)&&k.push(new Et(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(E&&!Al(i.valueSpec)?k.push(new Et(i.key,i.value,"property functions not supported")):x&&!oh(i.valueSpec)&&k.push(new Et(i.key,i.value,"zoom functions not supported"))),o!=="categorical"&&!S||i.value.property!==void 0||k.push(new Et(i.key,i.value,'"property" property is required')),k;function M(j){let G=[];const K=j.value,ee=j.key;if(pr(K)!=="array")return[new Et(ee,K,`array expected, ${pr(K)} found`)];if(K.length!==2)return[new Et(ee,K,`array length 2 expected, length ${K.length} found`)];if(S){if(pr(K[0])!=="object")return[new Et(ee,K,`object expected, ${pr(K[0])} found`)];if(K[0].zoom===void 0)return[new Et(ee,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new Et(ee,K,"object stop key must have value")];const le=_n(K[0].zoom);if(typeof le!="number")return[new Et(ee,K[0].zoom,"stop zoom values must be numbers")];if(m&&m>le)return[new Et(ee,K[0].zoom,"stop zoom values must appear in ascending order")];le!==m&&(m=le,p=void 0,y={}),G=G.concat(Io({key:`${ee}[0]`,value:K[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:Zc,value:O}}))}else G=G.concat(O({key:`${ee}[0]`,value:K[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},K));return Cl($n(K[1]))?G.concat([new Et(`${ee}[1]`,K[1],"expressions are not allowed in function stops.")]):G.concat(ci({key:`${ee}[1]`,value:K[1],valueSpec:r,style:j.style,styleSpec:j.styleSpec}))}function O(j,G){const K=pr(j.value),ee=_n(j.value),le=j.value!==null?j.value:G;if(c){if(K!==c)return[new Et(j.key,le,`${K} stop domain type must match previous stop domain type ${c}`)]}else c=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new Et(j.key,le,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&o!=="categorical"){let me=`number expected, ${K} found`;return Al(r)&&o===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Et(j.key,le,me)]}return o!=="categorical"||K!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?o!=="categorical"&&K==="number"&&typeof ee=="number"&&typeof p=="number"&&p!==void 0&&ee<p?[new Et(j.key,le,"stop domain values must appear in ascending order")]:(p=ee,o==="categorical"&&ee in y?[new Et(j.key,le,"stop domain values must be unique")]:(y[ee]=!0,[])):[new Et(j.key,le,`integer expected, found ${String(ee)}`)]}}function Wn(i){const r=(i.expressionContext==="property"?qc:kl)($n(i.value),i.valueSpec);if(r.result==="error")return r.value.map(c=>new Et(`${i.key}${c.key}`,i.value,c.message));const o=r.value.expression||r.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!o.outputDefined())return[new Et(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ta(o))return[new Et(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return Xc(o,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Fs(o,["zoom","feature-state"]))return[new Et(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!wl(o))return[new Et(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xc(i,r){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const p of r.valueSpec.expression.parameters)o.delete(p);if(o.size===0)return[];const c=[];return i instanceof Ea&&o.has(i.name)?[new Et(r.key,r.value,`["${i.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(i.eachChild(p=>{c.push(...Xc(p,r))}),c)}function dh(i){const r=i.key,o=i.value,c=i.valueSpec,p=[];return Array.isArray(c.values)?c.values.indexOf(_n(o))===-1&&p.push(new Et(r,o,`expected one of [${c.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(c.values).indexOf(_n(o))===-1&&p.push(new Et(r,o,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(o)} found`)),p}function Cp(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const r of i.slice(1))if(!Cp(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function ph(i,r="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Cp(i)||(i=Dl(i));const o=i;let c=!0;try{c=function(S){if(!Pl(S))return S;let k=$n(S);return fh(k),k=C0(k),k}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}const p=Ge[`filter_${r}`],m=kl(c,p);let y=null;if(m.result==="error")throw new Error(m.value.map(S=>`${S.key}: ${S.message}`).join(", "));y=(S,k,M)=>m.value.evaluate(S,k,{},M);let x=null,E=null;if(c!==o){const S=kl(o,p);if(S.result==="error")throw new Error(S.value.map(k=>`${k.key}: ${k.message}`).join(", "));x=(k,M,O,j,G)=>S.value.evaluate(k,M,{},O,void 0,void 0,j,G),E=!wl(S.value.expression)}return{filter:y,dynamicFilter:x||void 0,needGeometry:k0(c),needFeature:!!E}}function C0(i){if(!Array.isArray(i))return i;const r=function(o){if(kp.has(o[0])){for(let c=1;c<o.length;c++)if(Pl(o[c]))return!0}return o}(i);return r===!0?r:r.map(o=>C0(o))}function fh(i){let r=!1;const o=[];if(i[0]==="case"){for(let c=1;c<i.length-1;c+=2)r=r||Pl(i[c]),o.push(i[c+1]);o.push(i[i.length-1])}else if(i[0]==="match"){r=r||Pl(i[1]);for(let c=2;c<i.length-1;c+=2)o.push(i[c+1]);o.push(i[i.length-1])}else if(i[0]==="step"){r=r||Pl(i[1]);for(let c=1;c<i.length-1;c+=2)o.push(i[c+1])}r&&(i.length=0,i.push("any",...o));for(let c=1;c<i.length;c++)fh(i[c])}function Pl(i){if(!Array.isArray(i))return!1;if((r=i[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let o=1;o<i.length;o++)if(Pl(i[o]))return!0;return!1}const kp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ux(i,r){return i<r?-1:i>r?1:0}function k0(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let r=1;r<i.length;r++)if(k0(i[r]))return!0;return!1}function Dl(i){if(!i)return!0;const r=i[0];return i.length<=1?r!=="any":r==="=="?Pp(i[1],i[2],"=="):r==="!="?mh(Pp(i[1],i[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Pp(i[1],i[2],r):r==="any"?(o=i.slice(1),["any"].concat(o.map(Dl))):r==="all"?["all"].concat(i.slice(1).map(Dl)):r==="none"?["all"].concat(i.slice(1).map(Dl).map(mh)):r==="in"?Dp(i[1],i.slice(2)):r==="!in"?mh(Dp(i[1],i.slice(2))):r==="has"?Mp(i[1]):r==="!has"?mh(Mp(i[1])):r!=="within"||i;var o}function Pp(i,r,o){switch(i){case"$type":return[`filter-type-${o}`,r];case"$id":return[`filter-id-${o}`,r];default:return[`filter-${o}`,i,r]}}function Dp(i,r){if(r.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(o=>typeof o!=typeof r[0])?["filter-in-large",i,["literal",r.sort(ux)]]:["filter-in-small",i,["literal",r]]}}function Mp(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function mh(i){return["!",i]}function Yc(i){return Cp($n(i.value))?Wn(xa({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Qc(i)}function Qc(i){const r=i.value,o=i.key;if(pr(r)!=="array")return[new Et(o,r,`array expected, ${pr(r)} found`)];const c=i.styleSpec;let p,m=[];if(r.length<1)return[new Et(o,r,"filter array must have at least 1 element")];switch(m=m.concat(dh({key:`${o}[0]`,value:r[0],valueSpec:c.filter_operator,style:i.style,styleSpec:i.styleSpec})),_n(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&_n(r[1])==="$type"&&m.push(new Et(o,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&m.push(new Et(o,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(p=pr(r[1]),p!=="string"&&m.push(new Et(`${o}[1]`,r[1],`string expected, ${p} found`)));for(let y=2;y<r.length;y++)p=pr(r[y]),_n(r[1])==="$type"?m=m.concat(dh({key:`${o}[${y}]`,value:r[y],valueSpec:c.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&m.push(new Et(`${o}[${y}]`,r[y],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let y=1;y<r.length;y++)m=m.concat(Qc({key:`${o}[${y}]`,value:r[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=pr(r[1]),r.length!==2?m.push(new Et(o,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="string"&&m.push(new Et(`${o}[1]`,r[1],`string expected, ${p} found`));break;case"within":p=pr(r[1]),r.length!==2?m.push(new Et(o,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="object"&&m.push(new Et(`${o}[1]`,r[1],`object expected, ${p} found`))}return m}function zp(i,r){const o=i.key,c=i.style,p=i.styleSpec,m=i.value,y=i.objectKey,x=p[`${r}_${i.layerType}`];if(!x)return[];const E=y.match(/^(.*)-transition$/);if(r==="paint"&&E&&x[E[1]]&&x[E[1]].transition)return ci({key:o,value:m,valueSpec:p.transition,style:c,styleSpec:p});const S=i.valueSpec||x[y];if(!S)return[new Et(o,m,`unknown property "${y}"`)];let k;if(pr(m)==="string"&&Al(S)&&!S.tokens&&(k=/^{([^}]+)}$/.exec(m))){const O=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new Et(o,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: ${O}.`)]}const M=[];return i.layerType==="symbol"&&(y==="text-field"&&c&&!c.glyphs&&M.push(new Et(o,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Gc($n(m))&&_n(m.type)==="identity"&&M.push(new Et(o,m,'"text-font" does not support identity functions'))),M.concat(ci({key:i.key,value:m,valueSpec:S,style:c,styleSpec:p,expressionContext:"property",propertyType:r,propertyKey:y}))}function P0(i){return zp(i,"paint")}function Rp(i){return zp(i,"layout")}function D0(i){let r=[];const o=i.value,c=i.key,p=i.style,m=i.styleSpec;o.type||o.ref||r.push(new Et(c,o,'either "type" or "ref" is required'));let y=_n(o.type);const x=_n(o.ref);if(o.id){const E=_n(o.id);for(let S=0;S<i.arrayIndex;S++){const k=p.layers[S];_n(k.id)===E&&r.push(new Et(c,o.id,`duplicate layer id "${o.id}", previously used at line ${k.id.__line__}`))}}if("ref"in o){let E;["type","source","source-layer","filter","layout"].forEach(S=>{S in o&&r.push(new Et(c,o[S],`"${S}" is prohibited for ref layers`))}),p.layers.forEach(S=>{_n(S.id)===x&&(E=S)}),E?E.ref?r.push(new Et(c,o.ref,"ref cannot reference another ref layer")):y=_n(E.type):typeof x=="string"&&r.push(new Et(c,o.ref,`ref layer "${x}" not found`))}else if(y!=="background"&&y!=="sky")if(o.source){const E=p.sources&&p.sources[o.source],S=E&&_n(E.type);E?S==="vector"&&y==="raster"?r.push(new Et(c,o.source,`layer "${o.id}" requires a raster source`)):S==="raster"&&y!=="raster"?r.push(new Et(c,o.source,`layer "${o.id}" requires a vector source`)):S!=="vector"||o["source-layer"]?S==="raster-dem"&&y!=="hillshade"?r.push(new Et(c,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||S==="geojson"&&E.lineMetrics||r.push(new Et(c,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Et(c,o,`layer "${o.id}" must specify a "source-layer"`)):r.push(new Et(c,o.source,`source "${o.source}" not found`))}else r.push(new Et(c,o,'missing required property "source"'));return r=r.concat(Io({key:c,value:o,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ci({key:`${c}.type`,value:o.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,object:o,objectKey:"type"}),filter:E=>Yc(xa({layerType:y},E)),layout:E=>Io({layer:o,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":S=>Rp(xa({layerType:y},S))}}),paint:E=>Io({layer:o,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":S=>P0(xa({layerType:y},S))}})}})),r}function ts(i){const r=i.value,o=i.key,c=pr(r);return c!=="string"?[new Et(o,r,`string expected, ${c} found`)]:[]}const M0={promoteId:function({key:i,value:r}){if(pr(r)==="string")return ts({key:i,value:r});{const o=[];for(const c in r)o.push(...ts({key:`${i}.${c}`,value:r[c]}));return o}}};function z0(i){const r=i.value,o=i.key,c=i.styleSpec,p=i.style;if(!r.type)return[new Et(o,r,'"type" is required')];const m=_n(r.type);let y;switch(m){case"vector":case"raster":case"raster-dem":return y=Io({key:o,value:r,valueSpec:c[`source_${m.replace("-","_")}`],style:i.style,styleSpec:c,objectElementValidators:M0}),y;case"geojson":if(y=Io({key:o,value:r,valueSpec:c.source_geojson,style:p,styleSpec:c,objectElementValidators:M0}),r.cluster)for(const x in r.clusterProperties){const[E,S]=r.clusterProperties[x],k=typeof E=="string"?[E,["accumulated"],["get",x]]:E;y.push(...Wn({key:`${o}.${x}.map`,value:S,expressionContext:"cluster-map"})),y.push(...Wn({key:`${o}.${x}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return y;case"video":return Io({key:o,value:r,valueSpec:c.source_video,style:p,styleSpec:c});case"image":return Io({key:o,value:r,valueSpec:c.source_image,style:p,styleSpec:c});case"canvas":return[new Et(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return dh({key:`${o}.type`,value:r.type,valueSpec:{values:hx(c)},style:p,styleSpec:c})}}function hx(i){return i.source.reduce((r,o)=>{const c=i[o];return c.type.type==="enum"&&(r=r.concat(Object.keys(c.type.values))),r},[])}function R0(i){const r=i.value,o=i.styleSpec,c=o.light,p=i.style;let m=[];const y=pr(r);if(r===void 0)return m;if(y!=="object")return m=m.concat([new Et("light",r,`object expected, ${y} found`)]),m;for(const x in r){const E=x.match(/^(.*)-transition$/);m=m.concat(E&&c[E[1]]&&c[E[1]].transition?ci({key:x,value:r[x],valueSpec:o.transition,style:p,styleSpec:o}):c[x]?ci({key:x,value:r[x],valueSpec:c[x],style:p,styleSpec:o}):[new Et(x,r[x],`unknown property "${x}"`)])}return m}function Op(i){const r=i.value,o=i.key,c=i.style,p=i.styleSpec,m=p.terrain;let y=[];const x=pr(r);if(r===void 0)return y;if(x!=="object")return y=y.concat([new Et("terrain",r,`object expected, ${x} found`)]),y;for(const E in r){const S=E.match(/^(.*)-transition$/);y=y.concat(S&&m[S[1]]&&m[S[1]].transition?ci({key:E,value:r[E],valueSpec:p.transition,style:c,styleSpec:p}):m[E]?ci({key:E,value:r[E],valueSpec:m[E],style:c,styleSpec:p}):[new Et(E,r[E],`unknown property "${E}"`)])}if(r.source){const E=c.sources&&c.sources[r.source],S=E&&_n(E.type);E?S!=="raster-dem"&&y.push(new Et(o,r.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):y.push(new Et(o,r.source,`source "${r.source}" not found`))}else y.push(new Et(o,r,'terrain is missing required property "source"'));return y}function O0(i){const r=i.value,o=i.style,c=i.styleSpec,p=c.fog;let m=[];const y=pr(r);if(r===void 0)return m;if(y!=="object")return m=m.concat([new Et("fog",r,`object expected, ${y} found`)]),m;for(const x in r){const E=x.match(/^(.*)-transition$/);m=m.concat(E&&p[E[1]]&&p[E[1]].transition?ci({key:x,value:r[x],valueSpec:c.transition,style:o,styleSpec:c}):p[x]?ci({key:x,value:r[x],valueSpec:p[x],style:o,styleSpec:c}):[new Et(x,r[x],`unknown property "${x}"`)])}return m}const F0={"*":()=>[],array:I0,boolean:function(i){const r=i.value,o=i.key,c=pr(r);return c!=="boolean"?[new Et(o,r,`boolean expected, ${c} found`)]:[]},number:Zc,color:function(i){const r=i.key,o=i.value,c=pr(o);return c!=="string"?[new Et(r,o,`color expected, ${c} found`)]:Jd(o)===null?[new Et(r,o,`color expected, "${o}" found`)]:[]},enum:dh,filter:Yc,function:Kc,layer:D0,object:Io,source:z0,light:R0,terrain:Op,fog:O0,string:ts,formatted:function(i){return ts(i).length===0?[]:Wn(i)},resolvedImage:function(i){return ts(i).length===0?[]:Wn(i)},projection:function(i){const r=i.value,o=i.styleSpec,c=o.projection,p=i.style;let m=[];const y=pr(r);if(y==="object")for(const x in r)m=m.concat(ci({key:x,value:r[x],valueSpec:c[x],style:p,styleSpec:o}));else y!=="string"&&(m=m.concat([new Et("projection",r,`object or string expected, ${y} found`)]));return m}};function ci(i){const r=i.value,o=i.valueSpec,c=i.styleSpec;return o.expression&&Gc(_n(r))?Kc(i):o.expression&&Cl($n(r))?Wn(i):o.type&&F0[o.type]?F0[o.type](i):Io(xa({},i,{valueSpec:o.type?c[o.type]:o}))}function dx(i){const r=i.value,o=i.key,c=ts(i);return c.length||(r.indexOf("{fontstack}")===-1&&c.push(new Et(o,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&c.push(new Et(o,r,'"glyphs" url must include a "{range}" token'))),c}function L0(i,r=Ge){return oo(ci({key:"",value:i,valueSpec:r.$root,styleSpec:r,style:i,objectElementValidators:{glyphs:dx,"*":()=>[]}}))}const px=i=>oo(P0(i)),fx=i=>oo(Rp(i));function oo(i){return i.slice().sort((r,o)=>r.line&&o.line?r.line-o.line:0)}function B0(i,r){let o=!1;if(r&&r.length)for(const c of r)i.fire(new va(new Error(c.message))),o=!0;return o}var mx=Qo,Co=3;function Qo(i,r,o){var c=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var p=new Int32Array(this.arrayBuffer);i=p[0],this.d=(r=p[1])+2*(o=p[2]);for(var m=0;m<this.d*this.d;m++){var y=p[Co+m],x=p[Co+m+1];c.push(y===x?null:p.subarray(y,x))}var E=p[Co+c.length+1];this.keys=p.subarray(p[Co+c.length],E),this.bboxes=p.subarray(E),this.insert=this._insertReadonly}else{this.d=r+2*o;for(var S=0;S<this.d*this.d;S++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=i,this.padding=o,this.scale=r/i,this.uid=0;var k=o/r*i;this.min=-k,this.max=i+k}Qo.prototype.insert=function(i,r,o,c,p){this._forEachCell(r,o,c,p,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(p)},Qo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Qo.prototype._insertCell=function(i,r,o,c,p,m){this.cells[p].push(m)},Qo.prototype.query=function(i,r,o,c,p){var m=this.min,y=this.max;if(i<=m&&r<=m&&y<=o&&y<=c&&!p)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(i,r,o,c,this._queryCell,x,{},p),x},Qo.prototype._queryCell=function(i,r,o,c,p,m,y,x){var E=this.cells[p];if(E!==null)for(var S=this.keys,k=this.bboxes,M=0;M<E.length;M++){var O=E[M];if(y[O]===void 0){var j=4*O;(x?x(k[j+0],k[j+1],k[j+2],k[j+3]):i<=k[j+2]&&r<=k[j+3]&&o>=k[j+0]&&c>=k[j+1])?(y[O]=!0,m.push(S[O])):y[O]=!1}}},Qo.prototype._forEachCell=function(i,r,o,c,p,m,y,x){for(var E=this._convertToCellCoord(i),S=this._convertToCellCoord(r),k=this._convertToCellCoord(o),M=this._convertToCellCoord(c),O=E;O<=k;O++)for(var j=S;j<=M;j++){var G=this.d*j+O;if((!x||x(this._convertFromCellCoord(O),this._convertFromCellCoord(j),this._convertFromCellCoord(O+1),this._convertFromCellCoord(j+1)))&&p.call(this,i,r,o,c,G,m,y,x))return}},Qo.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Qo.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Qo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,r=Co+this.cells.length+1+1,o=0,c=0;c<this.cells.length;c++)o+=this.cells[c].length;var p=new Int32Array(r+o+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var m=r,y=0;y<i.length;y++){var x=i[y];p[Co+y]=m,p.set(x,m),m+=x.length}return p[Co+i.length]=m,p.set(this.keys,m),p[Co+i.length+1]=m+=this.keys.length,p.set(this.bboxes,m),m+=this.bboxes.length,p.buffer};var Ns=F(mx);const gh={};function Tt(i,r,o={}){Object.defineProperty(i,"_classRegistryKey",{value:r,writeable:!1}),gh[r]={klass:i,omit:o.omit||[]}}Tt(Object,"Object"),Ns.serialize=function(i,r){const o=i.toArrayBuffer();return r&&r.push(o),{buffer:o}},Ns.deserialize=function(i){return new Ns(i.buffer)},Object.defineProperty(Ns,"name",{value:"Grid"}),Tt(Ns,"Grid"),Tt(fn,"Color"),Tt(Error,"Error"),Tt(To,"AJAXError"),Tt(no,"ResolvedImage"),Tt(uh,"StylePropertyFunction"),Tt(ch,"StyleExpression",{omit:["_evaluator"]}),Tt(Hc,"ZoomDependentExpression"),Tt(Ip,"ZoomConstantExpression"),Tt(Ea,"CompoundExpression",{omit:["_evaluate"]});for(const i in Wc)gh[Wc[i]._classRegistryKey]||Tt(Wc[i],`Expression${i}`);function Fp(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Lp(i){return w.ImageBitmap&&i instanceof w.ImageBitmap}function Ml(i,r){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Fp(i)||Lp(i))return r&&r.push(i),i;if(ArrayBuffer.isView(i)){const o=i;return r&&r.push(o.buffer),o}if(i instanceof w.ImageData)return r&&r.push(i.data.buffer),i;if(Array.isArray(i)){const o=[];for(const c of i)o.push(Ml(c,r));return o}if(typeof i=="object"){const o=i.constructor,c=o._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const p=o.serialize?o.serialize(i,r):{};if(!o.serialize){for(const m in i)i.hasOwnProperty(m)&&(gh[c].omit.indexOf(m)>=0||(p[m]=Ml(i[m],r)));i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof i)}function Us(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Fp(i)||Lp(i)||ArrayBuffer.isView(i)||i instanceof w.ImageData)return i;if(Array.isArray(i))return i.map(Us);if(typeof i=="object"){const r=i.$name||"Object",{klass:o}=gh[r];if(!o)throw new Error(`can't deserialize unregistered class ${r}`);if(o.deserialize)return o.deserialize(i);const c=Object.create(o.prototype);for(const p of Object.keys(i))p!=="$name"&&(c[p]=Us(i[p]));return c}throw new Error("can't deserialize object of type "+typeof i)}const xt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Bp(i){for(const r of i)if(Np(r.charCodeAt(0)))return!0;return!1}function gx(i){for(const r of i)if(!N0(r.charCodeAt(0)))return!1;return!0}function N0(i){return!(xt.Arabic(i)||xt["Arabic Supplement"](i)||xt["Arabic Extended-A"](i)||xt["Arabic Presentation Forms-A"](i)||xt["Arabic Presentation Forms-B"](i))}function Np(i){return!(i!==746&&i!==747&&(i<4352||!(xt["Bopomofo Extended"](i)||xt.Bopomofo(i)||xt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||xt["CJK Compatibility Ideographs"](i)||xt["CJK Compatibility"](i)||xt["CJK Radicals Supplement"](i)||xt["CJK Strokes"](i)||!(!xt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||xt["CJK Unified Ideographs Extension A"](i)||xt["CJK Unified Ideographs"](i)||xt["Enclosed CJK Letters and Months"](i)||xt["Hangul Compatibility Jamo"](i)||xt["Hangul Jamo Extended-A"](i)||xt["Hangul Jamo Extended-B"](i)||xt["Hangul Jamo"](i)||xt["Hangul Syllables"](i)||xt.Hiragana(i)||xt["Ideographic Description Characters"](i)||xt.Kanbun(i)||xt["Kangxi Radicals"](i)||xt["Katakana Phonetic Extensions"](i)||xt.Katakana(i)&&i!==12540||!(!xt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!xt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||xt["Unified Canadian Aboriginal Syllabics"](i)||xt["Unified Canadian Aboriginal Syllabics Extended"](i)||xt["Vertical Forms"](i)||xt["Yijing Hexagram Symbols"](i)||xt["Yi Syllables"](i)||xt["Yi Radicals"](i))))}function U0(i){return!(Np(i)||function(r){return!!(xt["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||xt["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||xt["Letterlike Symbols"](r)||xt["Number Forms"](r)||xt["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||xt["Control Pictures"](r)&&r!==9251||xt["Optical Character Recognition"](r)||xt["Enclosed Alphanumerics"](r)||xt["Geometric Shapes"](r)||xt["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||xt["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||xt["CJK Symbols and Punctuation"](r)||xt.Katakana(r)||xt["Private Use Area"](r)||xt["CJK Compatibility Forms"](r)||xt["Small Form Variants"](r)||xt["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(i))}function j0(i){return i>=1424&&i<=2303||xt["Arabic Presentation Forms-A"](i)||xt["Arabic Presentation Forms-B"](i)}function yx(i,r){return!(!r&&j0(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||xt.Khmer(i))}function _x(i){for(const r of i)if(j0(r.charCodeAt(0)))return!0;return!1}const Up="deferred",jp="loading",Vp="loaded";let zl=null,f="unavailable",s=null;const h=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(f="error"),zl&&zl(i)};function g(){v.fire(new Ms("pluginStateChange",{pluginStatus:f,pluginURL:s}))}const v=new Cc,b=function(){return f},A=function(){if(f!==Up||!s)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");f=jp,g(),s&&Ja({url:s},i=>{i?h(i):(f=Vp,g())})},I={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>f===Vp||I.applyArabicShaping!=null,isLoading:()=>f===jp,setState(i){f=i.pluginStatus,s=i.pluginURL},isParsed:()=>I.applyArabicShaping!=null&&I.processBidirectionalText!=null&&I.processStyledBidirectionalText!=null,getPluginURL:()=>s};class D{constructor(r,o){this.zoom=r,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return function(o,c){for(const p of o)if(!yx(p.charCodeAt(0),c))return!1;return!0}(r,I.isLoaded())}}class B{constructor(r,o){this.property=r,this.value=o,this.expression=function(c,p){if(Gc(c))return new uh(c,p);if(Cl(c)){const m=qc(c,p);if(m.result==="error")throw new Error(m.value.map(y=>`${y.key}: ${y.message}`).join(", "));return m.value}{let m=c;return typeof c=="string"&&p.type==="color"&&(m=fn.parse(c)),{kind:"constant",evaluate:()=>m}}}(o===void 0?r.specification.default:o,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,o,c){return this.property.possiblyEvaluate(this,r,o,c)}}class L{constructor(r){this.property=r,this.value=new B(r,void 0)}transitioned(r,o){return new Q(this.property,this.value,o,nt({},r.transition,this.transition),r.now)}untransitioned(){return new Q(this.property,this.value,null,{},0)}}class q{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return qr(this._values[r].value.value)}setValue(r,o){this._values.hasOwnProperty(r)||(this._values[r]=new L(this._values[r].property)),this._values[r].value=new B(this._values[r].property,o===null?void 0:qr(o))}getTransition(r){return qr(this._values[r].transition)}setTransition(r,o){this._values.hasOwnProperty(r)||(this._values[r]=new L(this._values[r].property)),this._values[r].transition=qr(o)||void 0}serialize(){const r={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(r[o]=c);const p=this.getTransition(o);p!==void 0&&(r[`${o}-transition`]=p)}return r}transitioned(r,o){const c=new ne(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(r,o._values[p]);return c}untransitioned(){const r=new ne(this._properties);for(const o of Object.keys(this._values))r._values[o]=this._values[o].untransitioned();return r}}class Q{constructor(r,o,c,p,m){const y=p.delay||0,x=p.duration||0;m=m||0,this.property=r,this.value=o,this.begin=m+y,this.end=this.begin+x,r.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(r,o,c){const p=r.now||0,m=this.value.possiblyEvaluate(r,o,c),y=this.prior;if(y){if(p>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(p<this.begin)return y.possiblyEvaluate(r,o,c);{const x=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,o,c),m,Dt(x))}}return m}}class ne{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,o,c){const p=new ae(this._properties);for(const m of Object.keys(this._values))p._values[m]=this._values[m].possiblyEvaluate(r,o,c);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class oe{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return qr(this._values[r].value)}setValue(r,o){this._values[r]=new B(this._values[r].property,o===null?void 0:qr(o))}serialize(){const r={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(r[o]=c)}return r}possiblyEvaluate(r,o,c){const p=new ae(this._properties);for(const m of Object.keys(this._values))p._values[m]=this._values[m].possiblyEvaluate(r,o,c);return p}}class ie{constructor(r,o,c){this.property=r,this.value=o,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,o,c,p){return this.property.evaluate(this.value,this.parameters,r,o,c,p)}}class ae{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Z{constructor(r){this.specification=r}possiblyEvaluate(r,o){return r.expression.evaluate(o)}interpolate(r,o,c){const p=Nc[this.specification.type];return p?p(r,o,c):r}}class re{constructor(r,o){this.specification=r,this.overrides=o}possiblyEvaluate(r,o,c,p){return new ie(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(o,null,{},c,p)}:r.expression,o)}interpolate(r,o,c){if(r.value.kind!=="constant"||o.value.kind!=="constant")return r;if(r.value.value===void 0||o.value.value===void 0)return new ie(this,{kind:"constant",value:void 0},r.parameters);const p=Nc[this.specification.type];return p?new ie(this,{kind:"constant",value:p(r.value.value,o.value.value,c)},r.parameters):r}evaluate(r,o,c,p,m,y){return r.kind==="constant"?r.value:r.evaluate(o,c,p,m,y)}}class ue{constructor(r){this.specification=r}possiblyEvaluate(r,o,c,p){return!!r.expression.evaluate(o,null,{},c,p)}interpolate(){return!1}}class he{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new D(0,{});for(const c in r){const p=r[c];p.specification.overridable&&this.overridableProperties.push(c);const m=this.defaultPropertyValues[c]=new B(p,void 0),y=this.defaultTransitionablePropertyValues[c]=new L(p);this.defaultTransitioningPropertyValues[c]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=m.possiblyEvaluate(o)}}}function be(i,r){return 256*(i=qe(Math.floor(i),0,255))+qe(Math.floor(r),0,255)}Tt(re,"DataDrivenProperty"),Tt(Z,"DataConstantProperty"),Tt(ue,"ColorRampProperty");const Se={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class we{constructor(r,o){this._structArray=r,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ce{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,o){return r._trim(),o&&(r.isTransferred=!0,o.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const o=Object.create(this.prototype);return o.arrayBuffer=r.arrayBuffer,o.length=r.length,o.capacity=r.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ie(i,r=1){let o=0,c=0;return{members:i.map(p=>{const m=Se[p.type].BYTES_PER_ELEMENT,y=o=Re(o,Math.max(r,m)),x=p.components||1;return c=Math.max(c,m),o+=m*x,{name:p.name,type:p.type,components:x,offset:y}}),size:Re(o,Math.max(c,r)),alignment:r}}function Re(i,r){return Math.ceil(i/r)*r}class st extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o){const c=this.length;return this.resize(c+1),this.emplace(c,r,o)}emplace(r,o,c){const p=2*r;return this.int16[p+0]=o,this.int16[p+1]=c,r}}st.prototype.bytesPerElement=4,Tt(st,"StructArrayLayout2i4");class De extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,c){const p=this.length;return this.resize(p+1),this.emplace(p,r,o,c)}emplace(r,o,c,p){const m=3*r;return this.int16[m+0]=o,this.int16[m+1]=c,this.int16[m+2]=p,r}}De.prototype.bytesPerElement=6,Tt(De,"StructArrayLayout3i6");class Ke extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,c,p)}emplace(r,o,c,p,m){const y=4*r;return this.int16[y+0]=o,this.int16[y+1]=c,this.int16[y+2]=p,this.int16[y+3]=m,r}}Ke.prototype.bytesPerElement=8,Tt(Ke,"StructArrayLayout4i8");class Ne extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,c,p,m,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,c,p,m,y,x)}emplace(r,o,c,p,m,y,x,E){const S=6*r,k=12*r,M=3*r;return this.int16[S+0]=o,this.int16[S+1]=c,this.uint8[k+4]=p,this.uint8[k+5]=m,this.uint8[k+6]=y,this.uint8[k+7]=x,this.float32[M+2]=E,r}}Ne.prototype.bytesPerElement=12,Tt(Ne,"StructArrayLayout2i4ub1f12");class at extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,c,p)}emplace(r,o,c,p,m){const y=4*r;return this.float32[y+0]=o,this.float32[y+1]=c,this.float32[y+2]=p,this.float32[y+3]=m,r}}at.prototype.bytesPerElement=16,Tt(at,"StructArrayLayout4f16");class ze extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,c,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,o,c,p,m)}emplace(r,o,c,p,m,y){const x=6*r,E=3*r;return this.uint16[x+0]=o,this.uint16[x+1]=c,this.uint16[x+2]=p,this.uint16[x+3]=m,this.float32[E+2]=y,r}}ze.prototype.bytesPerElement=12,Tt(ze,"StructArrayLayout4ui1f12");class Ze extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,c,p)}emplace(r,o,c,p,m){const y=4*r;return this.uint16[y+0]=o,this.uint16[y+1]=c,this.uint16[y+2]=p,this.uint16[y+3]=m,r}}Ze.prototype.bytesPerElement=8,Tt(Ze,"StructArrayLayout4ui8");class ut extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,c,p,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,o,c,p,m,y)}emplace(r,o,c,p,m,y,x){const E=6*r;return this.int16[E+0]=o,this.int16[E+1]=c,this.int16[E+2]=p,this.int16[E+3]=m,this.int16[E+4]=y,this.int16[E+5]=x,r}}ut.prototype.bytesPerElement=12,Tt(ut,"StructArrayLayout6i12");class tt extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,c,p,m,y,x,E,S,k,M,O){const j=this.length;return this.resize(j+1),this.emplace(j,r,o,c,p,m,y,x,E,S,k,M,O)}emplace(r,o,c,p,m,y,x,E,S,k,M,O,j){const G=12*r;return this.int16[G+0]=o,this.int16[G+1]=c,this.int16[G+2]=p,this.int16[G+3]=m,this.uint16[G+4]=y,this.uint16[G+5]=x,this.uint16[G+6]=E,this.uint16[G+7]=S,this.int16[G+8]=k,this.int16[G+9]=M,this.int16[G+10]=O,this.int16[G+11]=j,r}}tt.prototype.bytesPerElement=24,Tt(tt,"StructArrayLayout4i4ui4i24");class ht extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,c,p,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,o,c,p,m,y)}emplace(r,o,c,p,m,y,x){const E=10*r,S=5*r;return this.int16[E+0]=o,this.int16[E+1]=c,this.int16[E+2]=p,this.float32[S+2]=m,this.float32[S+3]=y,this.float32[S+4]=x,r}}ht.prototype.bytesPerElement=20,Tt(ht,"StructArrayLayout3i3f20");class Mt extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint32[1*r+0]=o,r}}Mt.prototype.bytesPerElement=4,Tt(Mt,"StructArrayLayout1ul4");class $t extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,c,p,m,y,x,E,S,k,M,O,j){const G=this.length;return this.resize(G+1),this.emplace(G,r,o,c,p,m,y,x,E,S,k,M,O,j)}emplace(r,o,c,p,m,y,x,E,S,k,M,O,j,G){const K=20*r,ee=10*r;return this.int16[K+0]=o,this.int16[K+1]=c,this.int16[K+2]=p,this.int16[K+3]=m,this.int16[K+4]=y,this.float32[ee+3]=x,this.float32[ee+4]=E,this.float32[ee+5]=S,this.float32[ee+6]=k,this.int16[K+14]=M,this.uint32[ee+8]=O,this.uint16[K+18]=j,this.uint16[K+19]=G,r}}$t.prototype.bytesPerElement=40,Tt($t,"StructArrayLayout5i4f1i1ul2ui40");class At extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,c,p,m,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,c,p,m,y,x)}emplace(r,o,c,p,m,y,x,E){const S=8*r;return this.int16[S+0]=o,this.int16[S+1]=c,this.int16[S+2]=p,this.int16[S+4]=m,this.int16[S+5]=y,this.int16[S+6]=x,this.int16[S+7]=E,r}}At.prototype.bytesPerElement=16,Tt(At,"StructArrayLayout3i2i2i16");class Lt extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,c,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,o,c,p,m)}emplace(r,o,c,p,m,y){const x=4*r,E=8*r;return this.float32[x+0]=o,this.float32[x+1]=c,this.float32[x+2]=p,this.int16[E+6]=m,this.int16[E+7]=y,r}}Lt.prototype.bytesPerElement=16,Tt(Lt,"StructArrayLayout2f1f2i16");class nr extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,c,p)}emplace(r,o,c,p,m){const y=12*r,x=3*r;return this.uint8[y+0]=o,this.uint8[y+1]=c,this.float32[x+1]=p,this.float32[x+2]=m,r}}nr.prototype.bytesPerElement=12,Tt(nr,"StructArrayLayout2ub2f12");class er extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,c){const p=this.length;return this.resize(p+1),this.emplace(p,r,o,c)}emplace(r,o,c,p){const m=3*r;return this.float32[m+0]=o,this.float32[m+1]=c,this.float32[m+2]=p,r}}er.prototype.bytesPerElement=12,Tt(er,"StructArrayLayout3f12");class Pt extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,c){const p=this.length;return this.resize(p+1),this.emplace(p,r,o,c)}emplace(r,o,c,p){const m=3*r;return this.uint16[m+0]=o,this.uint16[m+1]=c,this.uint16[m+2]=p,r}}Pt.prototype.bytesPerElement=6,Tt(Pt,"StructArrayLayout3ui6");class Ar extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,o,c,p,m,y,x,E,S,k,M,O,j,G,K,ee,le,me,ce,pe,_e){const ye=this.length;return this.resize(ye+1),this.emplace(ye,r,o,c,p,m,y,x,E,S,k,M,O,j,G,K,ee,le,me,ce,pe,_e)}emplace(r,o,c,p,m,y,x,E,S,k,M,O,j,G,K,ee,le,me,ce,pe,_e,ye){const Oe=30*r,Me=15*r,He=60*r;return this.int16[Oe+0]=o,this.int16[Oe+1]=c,this.int16[Oe+2]=p,this.float32[Me+2]=m,this.float32[Me+3]=y,this.uint16[Oe+8]=x,this.uint16[Oe+9]=E,this.uint32[Me+5]=S,this.uint32[Me+6]=k,this.uint32[Me+7]=M,this.uint16[Oe+16]=O,this.uint16[Oe+17]=j,this.uint16[Oe+18]=G,this.float32[Me+10]=K,this.float32[Me+11]=ee,this.uint8[He+48]=le,this.uint8[He+49]=me,this.uint8[He+50]=ce,this.uint32[Me+13]=pe,this.int16[Oe+28]=_e,this.uint8[He+58]=ye,r}}Ar.prototype.bytesPerElement=60,Tt(Ar,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Mr extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,o,c,p,m,y,x,E,S,k,M,O,j,G,K,ee,le,me,ce,pe,_e,ye,Oe,Me,He,lt,Ue,Qe,Je,ot){const pt=this.length;return this.resize(pt+1),this.emplace(pt,r,o,c,p,m,y,x,E,S,k,M,O,j,G,K,ee,le,me,ce,pe,_e,ye,Oe,Me,He,lt,Ue,Qe,Je,ot)}emplace(r,o,c,p,m,y,x,E,S,k,M,O,j,G,K,ee,le,me,ce,pe,_e,ye,Oe,Me,He,lt,Ue,Qe,Je,ot,pt){const We=38*r,_t=19*r;return this.int16[We+0]=o,this.int16[We+1]=c,this.int16[We+2]=p,this.float32[_t+2]=m,this.float32[_t+3]=y,this.int16[We+8]=x,this.int16[We+9]=E,this.int16[We+10]=S,this.int16[We+11]=k,this.int16[We+12]=M,this.int16[We+13]=O,this.uint16[We+14]=j,this.uint16[We+15]=G,this.uint16[We+16]=K,this.uint16[We+17]=ee,this.uint16[We+18]=le,this.uint16[We+19]=me,this.uint16[We+20]=ce,this.uint16[We+21]=pe,this.uint16[We+22]=_e,this.uint16[We+23]=ye,this.uint16[We+24]=Oe,this.uint16[We+25]=Me,this.uint16[We+26]=He,this.uint16[We+27]=lt,this.uint16[We+28]=Ue,this.uint32[_t+15]=Qe,this.float32[_t+16]=Je,this.float32[_t+17]=ot,this.float32[_t+18]=pt,r}}Mr.prototype.bytesPerElement=76,Tt(Mr,"StructArrayLayout3i2f6i15ui1ul3f76");class zr extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.float32[1*r+0]=o,r}}zr.prototype.bytesPerElement=4,Tt(zr,"StructArrayLayout1f4");class Rr extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,c,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,o,c,p,m)}emplace(r,o,c,p,m,y){const x=5*r;return this.float32[x+0]=o,this.float32[x+1]=c,this.float32[x+2]=p,this.float32[x+3]=m,this.float32[x+4]=y,r}}Rr.prototype.bytesPerElement=20,Tt(Rr,"StructArrayLayout5f20");class ui extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,c,p)}emplace(r,o,c,p,m){const y=6*r;return this.uint32[3*r+0]=o,this.uint16[y+2]=c,this.uint16[y+3]=p,this.uint16[y+4]=m,r}}ui.prototype.bytesPerElement=12,Tt(ui,"StructArrayLayout1ul3ui12");class Gn extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o){const c=this.length;return this.resize(c+1),this.emplace(c,r,o)}emplace(r,o,c){const p=2*r;return this.uint16[p+0]=o,this.uint16[p+1]=c,r}}Gn.prototype.bytesPerElement=4,Tt(Gn,"StructArrayLayout2ui4");class ao extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint16[1*r+0]=o,r}}ao.prototype.bytesPerElement=2,Tt(ao,"StructArrayLayout1ui2");class Jo extends Ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o){const c=this.length;return this.resize(c+1),this.emplace(c,r,o)}emplace(r,o,c){const p=2*r;return this.float32[p+0]=o,this.float32[p+1]=c,r}}Jo.prototype.bytesPerElement=8,Tt(Jo,"StructArrayLayout2f8");class Yr extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Yr.prototype.size=40;class Or extends $t{get(r){return new Yr(this,r)}}Tt(Or,"CollisionBoxArray");class gr extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}gr.prototype.size=60;class vn extends Ar{get(r){return new gr(this,r)}}Tt(vn,"PlacedSymbolArray");class vi extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}vi.prototype.size=76;class Zr extends Mr{get(r){return new vi(this,r)}}Tt(Zr,"SymbolInstanceArray");class Pi extends zr{getoffsetX(r){return this.float32[1*r+0]}}Tt(Pi,"GlyphOffsetArray");class yh extends st{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}Tt(yh,"SymbolLineVertexArray");class js extends we{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}js.prototype.size=12;class Jc extends ui{get(r){return new js(this,r)}}Tt(Jc,"FeatureIndexArray");class Ca extends Gn{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}Tt(Ca,"FillExtrusionCentroidArray");const rs=Ie([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Vs=Ie([{name:"a_dash",components:4,type:"Uint16"}]);var _h={exports:{}},eu={exports:{}};eu.exports=function(i,r){var o,c,p,m,y,x,E,S;for(c=i.length-(o=3&i.length),p=r,y=3432918353,x=461845907,S=0;S<c;)E=255&i.charCodeAt(S)|(255&i.charCodeAt(++S))<<8|(255&i.charCodeAt(++S))<<16|(255&i.charCodeAt(++S))<<24,++S,p=27492+(65535&(m=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(E=0,o){case 3:E^=(255&i.charCodeAt(S+2))<<16;case 2:E^=(255&i.charCodeAt(S+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(S)))*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*x+(((E>>>16)*x&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var $p=eu.exports,MA={exports:{}};MA.exports=function(i,r){for(var o,c=i.length,p=r^c,m=0;c>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(o>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++m;switch(c){case 3:p^=(255&i.charCodeAt(m+2))<<16;case 2:p^=(255&i.charCodeAt(m+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(m)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var zA=$p,HO=MA.exports;_h.exports=zA,_h.exports.murmur3=zA,_h.exports.murmur2=HO;var vx=F(_h.exports);class V0{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,o,c,p){this.ids.push(RA(r)),this.positions.push(o,c,p)}getPositions(r){const o=RA(r);let c=0,p=this.ids.length-1;for(;c<p;){const y=c+p>>1;this.ids[y]>=o?p=y:c=y+1}const m=[];for(;this.ids[c]===o;)m.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return m}static serialize(r,o){const c=new Float64Array(r.ids),p=new Uint32Array(r.positions);return xx(c,p,0,c.length-1),o&&o.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(r){const o=new V0;return o.ids=r.ids,o.positions=r.positions,o.indexed=!0,o}}function RA(i){const r=+i;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:vx(String(i))}function xx(i,r,o,c){for(;o<c;){const p=i[o+c>>1];let m=o-1,y=c+1;for(;;){do m++;while(i[m]<p);do y--;while(i[y]>p);if(m>=y)break;$0(i,m,y),$0(r,3*m,3*y),$0(r,3*m+1,3*y+1),$0(r,3*m+2,3*y+2)}y-o<c-y?(xx(i,r,o,y),o=y+1):(xx(i,r,y+1,c),c=y)}}function $0(i,r,o){const c=i[r];i[r]=i[o],i[o]=c}Tt(V0,"FeaturePositionMap");class $s{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,o),this.initialized=!0),!!this.location}}class W0 extends $s{constructor(r){super(r),this.current=0}set(r,o,c){this.fetchUniformLocation(r,o)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class OA extends $s{constructor(r){super(r),this.current=[0,0,0,0]}set(r,o,c){this.fetchUniformLocation(r,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class FA extends $s{constructor(r){super(r),this.current=fn.transparent}set(r,o,c){this.fetchUniformLocation(r,o)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const qO=new Float32Array(16),ZO=new Float32Array(9),KO=new Float32Array(4);function bx(i){return[be(255*i.r,255*i.g),be(255*i.b,255*i.a)]}class Wp{constructor(r,o,c){this.value=r,this.uniformNames=o.map(p=>`u_${p}`),this.type=c}setUniform(r,o,c,p,m){o.set(r,m,p.constantOr(this.value))}getBinding(r,o){return this.type==="color"?new FA(r):new W0(r)}}class vh{constructor(r,o){this.uniformNames=o.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,o,c,p,m){const y=m==="u_pattern"||m==="u_dash"?this.pattern:m==="u_pixel_ratio"?this.pixelRatio:null;y&&o.set(r,m,y)}getBinding(r,o){return o==="u_pattern"||o==="u_dash"?new OA(r):new W0(r)}}class Ws{constructor(r,o,c,p){this.expression=r,this.type=c,this.maxValue=0,this.paintVertexAttributes=o.map(m=>({name:`a_${m}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(r,o,c,p,m,y){const x=this.paintVertexArray.length,E=this.expression.evaluate(new D(0),o,{},m,p,y);this.paintVertexArray.resize(r),this._setPaintValue(x,r,E)}updatePaintArray(r,o,c,p,m){const y=this.expression.evaluate({zoom:0},c,p,void 0,m);this._setPaintValue(r,o,y)}_setPaintValue(r,o,c){if(this.type==="color"){const p=bx(c);for(let m=r;m<o;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=r;p<o;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ka{constructor(r,o,c,p,m,y){this.expression=r,this.uniformNames=o.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=p,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=o.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,o,c,p,m,y){const x=this.expression.evaluate(new D(this.zoom),o,{},m,p,y),E=this.expression.evaluate(new D(this.zoom+1),o,{},m,p,y),S=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(S,r,x,E)}updatePaintArray(r,o,c,p,m){const y=this.expression.evaluate({zoom:this.zoom},c,p,void 0,m),x=this.expression.evaluate({zoom:this.zoom+1},c,p,void 0,m);this._setPaintValue(r,o,y,x)}_setPaintValue(r,o,c,p){if(this.type==="color"){const m=bx(c),y=bx(p);for(let x=r;x<o;x++)this.paintVertexArray.emplace(x,m[0],m[1],y[0],y[1])}else{for(let m=r;m<o;m++)this.paintVertexArray.emplace(m,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,o,c,p,m){const y=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=qe(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);o.set(r,m,x)}getBinding(r,o){return new W0(r)}}class Rl{constructor(r,o,c,p,m){this.expression=r,this.layerId=m,this.paintVertexAttributes=(c==="array"?Vs:rs).members;for(let y=0;y<o.length;++y);this.paintVertexArray=new p}populatePaintArray(r,o,c){const p=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(p,r,o.patterns&&o.patterns[this.layerId],c)}updatePaintArray(r,o,c,p,m,y){this._setPaintValues(r,o,c.patterns&&c.patterns[this.layerId],y)}_setPaintValues(r,o,c,p){if(!p||!c)return;const m=p[c];if(!m)return;const{tl:y,br:x,pixelRatio:E}=m;for(let S=r;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],x[0],x[1],E)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ol{constructor(r,o,c=()=>!0){this.binders={},this._buffers=[];const p=[];for(const m in r.paint._values){if(!c(m))continue;const y=r.paint.get(m);if(!(y instanceof ie&&Al(y.property.specification)))continue;const x=YO(m,r.type),E=y.value,S=y.property.specification.type,k=!!y.property.useIntegerZoom,M=m==="line-dasharray"||m.endsWith("pattern"),O=m==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(E.kind!=="constant"||O)if(E.kind==="source"||O||M){const j=LA(m,S,"source");this.binders[m]=M?new Rl(E,x,S,j,r.id):new Ws(E,x,S,j),p.push(`/a_${m}`)}else{const j=LA(m,S,"composite");this.binders[m]=new ka(E,x,S,k,o,j),p.push(`/z_${m}`)}else this.binders[m]=M?new vh(E.value,x):new Wp(E.value,x,S),p.push(`/u_${m}`)}this.cacheKey=p.sort().join("")}getMaxValue(r){const o=this.binders[r];return o instanceof Ws||o instanceof ka?o.maxValue:0}populatePaintArrays(r,o,c,p,m,y){for(const x in this.binders){const E=this.binders[x];(E instanceof Ws||E instanceof ka||E instanceof Rl)&&E.populatePaintArray(r,o,c,p,m,y)}}setConstantPatternPositions(r){for(const o in this.binders){const c=this.binders[o];c instanceof vh&&c.setConstantPatternPositions(r)}}updatePaintArrays(r,o,c,p,m,y){let x=!1;for(const E in r){const S=o.getPositions(E);for(const k of S){const M=c.feature(k.index);for(const O in this.binders){const j=this.binders[O];if((j instanceof Ws||j instanceof ka||j instanceof Rl)&&j.expression.isStateDependent===!0){const G=p.paint.get(O);j.expression=G.value,j.updatePaintArray(k.start,k.end,M,r[E],m,y),x=!0}}}}return x}defines(){const r=[];for(const o in this.binders){const c=this.binders[o];(c instanceof Wp||c instanceof vh)&&r.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return r}getBinderAttributes(){const r=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof Ws||c instanceof ka||c instanceof Rl)for(let p=0;p<c.paintVertexAttributes.length;p++)r.push(c.paintVertexAttributes[p].name)}return r}getBinderUniforms(){const r=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof Wp||c instanceof vh||c instanceof ka)for(const p of c.uniformNames)r.push(p)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const o=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Wp||p instanceof vh||p instanceof ka)for(const m of p.uniformNames)o.push({name:m,property:c,binding:p.getBinding(r,m)})}return o}setUniforms(r,o,c,p,m){for(const{name:y,property:x,binding:E}of c)this.binders[x].setUniform(r,E,m,p.get(x),y)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const o=this.binders[r];(o instanceof Ws||o instanceof ka||o instanceof Rl)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(r){for(const o in this.binders){const c=this.binders[o];(c instanceof Ws||c instanceof ka||c instanceof Rl)&&c.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const o=this.binders[r];(o instanceof Ws||o instanceof ka||o instanceof Rl)&&o.destroy()}}}class tu{constructor(r,o,c=()=>!0){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new Ol(p,o,c);this.needsUpload=!1,this._featureMap=new V0,this._bufferOffset=0}populatePaintArrays(r,o,c,p,m,y,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(r,o,p,m,y,x);o.id!==void 0&&this._featureMap.add(o.id,c,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,o,c,p,m){for(const y of c)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,o,y,p,m)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const XO={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function YO(i,r){return XO[i]||[i.replace(`${r}-`,"").replace(/-/g,"_")]}const QO={"line-pattern":{source:ze,composite:ze},"fill-pattern":{source:ze,composite:ze},"fill-extrusion-pattern":{source:ze,composite:ze},"line-dasharray":{source:Ze,composite:Ze}},JO={color:{source:Jo,composite:at},number:{source:zr,composite:Jo}};function LA(i,r,o){const c=QO[i];return c&&c[o]||JO[r][o]}Tt(Wp,"ConstantBinder"),Tt(vh,"PatternConstantBinder"),Tt(Ws,"SourceExpressionBinder"),Tt(Rl,"PatternCompositeBinder"),Tt(ka,"CompositeExpressionBinder"),Tt(Ol,"ProgramConfiguration",{omit:["_buffers"]}),Tt(tu,"ProgramConfigurationSet");const BA="-transition";class Pa extends Cc{constructor(r,o){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),o.layout&&(this._unevaluatedLayout=new oe(o.layout)),o.paint)){this._transitionablePaint=new q(o.paint);for(const c in r.paint)this.setPaintProperty(c,r.paint[c],{validate:!1});for(const c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ae(o.paint)}}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,o,c={}){o!=null&&this._validate(fx,`layers.${this.id}.layout.${r}`,r,o,c)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,o):this.visibility=o)}getPaintProperty(r){return mr(r,BA)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,o,c={}){if(o!=null&&this._validate(px,`layers.${this.id}.paint.${r}`,r,o,c))return!1;if(mr(r,BA))return this._transitionablePaint.setTransition(r.slice(0,-11),o||void 0),!1;{const p=this._transitionablePaint._values[r],m=p.value.isDataDriven(),y=p.value;this._transitionablePaint.setValue(r,o),this._handleSpecialPaintPropertyUpdate(r);const x=this._transitionablePaint._values[r].value,E=x.isDataDriven(),S=mr(r,"pattern")||r==="line-dasharray";return E||m||S||this._handleOverridablePaintPropertyUpdate(r,y,x)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,o,c){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,o)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Ii(r,(o,c)=>!(o===void 0||c==="layout"&&!Object.keys(o).length||c==="paint"&&!Object.keys(o).length))}_validate(r,o,c,p,m={}){return(!m||m.validate!==!1)&&B0(this,r.call(L0,{key:o,layerType:this.type,objectKey:c,value:p,styleSpec:Ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const o=this.paint.get(r);if(o instanceof ie&&Al(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ph(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const e5=Ie([{name:"a_pos",components:2,type:"Int16"}],4),t5=Ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xn{constructor(r=[]){this.segments=r}prepareSegment(r,o,c,p){let m=this.segments[this.segments.length-1];return r>xn.MAX_VERTEX_ARRAY_LENGTH&&Tr(`Max vertices per segment is ${xn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!m||m.vertexLength+r>xn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==p)&&(m={vertexOffset:o.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},p!==void 0&&(m.sortKey=p),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const r of this.segments)for(const o in r.vaos)r.vaos[o].destroy()}static simpleSegment(r,o,c,p){return new xn([{vertexOffset:r,primitiveOffset:o,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}xn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tt(xn,"SegmentVector");var Ot=8192;class Fl{constructor(r,o){r&&(o?this.setSouthWest(r).setNorthEast(o):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Fr?new Fr(r.lng,r.lat):Fr.convert(r),this}setSouthWest(r){return this._sw=r instanceof Fr?new Fr(r.lng,r.lat):Fr.convert(r),this}extend(r){const o=this._sw,c=this._ne;let p,m;if(r instanceof Fr)p=r,m=r;else{if(!(r instanceof Fl))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Fl.convert(r)):this.extend(Fr.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(Fr.convert(r)):this;if(p=r._sw,m=r._ne,!p||!m)return this}return o||c?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),c.lng=Math.max(m.lng,c.lng),c.lat=Math.max(m.lat,c.lat)):(this._sw=new Fr(p.lng,p.lat),this._ne=new Fr(m.lng,m.lat)),this}getCenter(){return new Fr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Fr(this.getWest(),this.getNorth())}getSouthEast(){return new Fr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:o,lat:c}=Fr.convert(r);let p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(r){return!r||r instanceof Fl?r:new Fl(r)}}var G0=1e-6,so=typeof Float32Array<"u"?Float32Array:Array;function NA(){var i=new so(9);return so!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function UA(i,r,o){var c=r[0],p=r[1],m=r[2],y=r[3],x=r[4],E=r[5],S=r[6],k=r[7],M=r[8],O=o[0],j=o[1],G=o[2],K=o[3],ee=o[4],le=o[5],me=o[6],ce=o[7],pe=o[8];return i[0]=O*c+j*y+G*S,i[1]=O*p+j*x+G*k,i[2]=O*m+j*E+G*M,i[3]=K*c+ee*y+le*S,i[4]=K*p+ee*x+le*k,i[5]=K*m+ee*E+le*M,i[6]=me*c+ce*y+pe*S,i[7]=me*p+ce*x+pe*k,i[8]=me*m+ce*E+pe*M,i}function Da(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function wx(i,r){var o=r[0],c=r[1],p=r[2],m=r[3],y=r[4],x=r[5],E=r[6],S=r[7],k=r[8],M=r[9],O=r[10],j=r[11],G=r[12],K=r[13],ee=r[14],le=r[15],me=o*x-c*y,ce=o*E-p*y,pe=o*S-m*y,_e=c*E-p*x,ye=c*S-m*x,Oe=p*S-m*E,Me=k*K-M*G,He=k*ee-O*G,lt=k*le-j*G,Ue=M*ee-O*K,Qe=M*le-j*K,Je=O*le-j*ee,ot=me*Je-ce*Qe+pe*Ue+_e*lt-ye*He+Oe*Me;return ot?(i[0]=(x*Je-E*Qe+S*Ue)*(ot=1/ot),i[1]=(p*Qe-c*Je-m*Ue)*ot,i[2]=(K*Oe-ee*ye+le*_e)*ot,i[3]=(O*ye-M*Oe-j*_e)*ot,i[4]=(E*lt-y*Je-S*He)*ot,i[5]=(o*Je-p*lt+m*He)*ot,i[6]=(ee*pe-G*Oe-le*ce)*ot,i[7]=(k*Oe-O*pe+j*ce)*ot,i[8]=(y*Qe-x*lt+S*Me)*ot,i[9]=(c*lt-o*Qe-m*Me)*ot,i[10]=(G*ye-K*pe+le*me)*ot,i[11]=(M*pe-k*ye-j*me)*ot,i[12]=(x*He-y*Ue-E*Me)*ot,i[13]=(o*Ue-c*He+p*Me)*ot,i[14]=(K*ce-G*_e-ee*me)*ot,i[15]=(k*_e-M*ce+O*me)*ot,i):null}function ru(i,r,o){var c=r[0],p=r[1],m=r[2],y=r[3],x=r[4],E=r[5],S=r[6],k=r[7],M=r[8],O=r[9],j=r[10],G=r[11],K=r[12],ee=r[13],le=r[14],me=r[15],ce=o[0],pe=o[1],_e=o[2],ye=o[3];return i[0]=ce*c+pe*x+_e*M+ye*K,i[1]=ce*p+pe*E+_e*O+ye*ee,i[2]=ce*m+pe*S+_e*j+ye*le,i[3]=ce*y+pe*k+_e*G+ye*me,i[4]=(ce=o[4])*c+(pe=o[5])*x+(_e=o[6])*M+(ye=o[7])*K,i[5]=ce*p+pe*E+_e*O+ye*ee,i[6]=ce*m+pe*S+_e*j+ye*le,i[7]=ce*y+pe*k+_e*G+ye*me,i[8]=(ce=o[8])*c+(pe=o[9])*x+(_e=o[10])*M+(ye=o[11])*K,i[9]=ce*p+pe*E+_e*O+ye*ee,i[10]=ce*m+pe*S+_e*j+ye*le,i[11]=ce*y+pe*k+_e*G+ye*me,i[12]=(ce=o[12])*c+(pe=o[13])*x+(_e=o[14])*M+(ye=o[15])*K,i[13]=ce*p+pe*E+_e*O+ye*ee,i[14]=ce*m+pe*S+_e*j+ye*le,i[15]=ce*y+pe*k+_e*G+ye*me,i}function Gp(i,r,o){var c,p,m,y,x,E,S,k,M,O,j,G,K=o[0],ee=o[1],le=o[2];return r===i?(i[12]=r[0]*K+r[4]*ee+r[8]*le+r[12],i[13]=r[1]*K+r[5]*ee+r[9]*le+r[13],i[14]=r[2]*K+r[6]*ee+r[10]*le+r[14],i[15]=r[3]*K+r[7]*ee+r[11]*le+r[15]):(p=r[1],m=r[2],y=r[3],x=r[4],E=r[5],S=r[6],k=r[7],M=r[8],O=r[9],j=r[10],G=r[11],i[0]=c=r[0],i[1]=p,i[2]=m,i[3]=y,i[4]=x,i[5]=E,i[6]=S,i[7]=k,i[8]=M,i[9]=O,i[10]=j,i[11]=G,i[12]=c*K+x*ee+M*le+r[12],i[13]=p*K+E*ee+O*le+r[13],i[14]=m*K+S*ee+j*le+r[14],i[15]=y*K+k*ee+G*le+r[15]),i}function nu(i,r,o){var c=o[0],p=o[1],m=o[2];return i[0]=r[0]*c,i[1]=r[1]*c,i[2]=r[2]*c,i[3]=r[3]*c,i[4]=r[4]*p,i[5]=r[5]*p,i[6]=r[6]*p,i[7]=r[7]*p,i[8]=r[8]*m,i[9]=r[9]*m,i[10]=r[10]*m,i[11]=r[11]*m,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i}function Ex(i,r,o){var c=Math.sin(o),p=Math.cos(o),m=r[4],y=r[5],x=r[6],E=r[7],S=r[8],k=r[9],M=r[10],O=r[11];return r!==i&&(i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[4]=m*p+S*c,i[5]=y*p+k*c,i[6]=x*p+M*c,i[7]=E*p+O*c,i[8]=S*p-m*c,i[9]=k*p-y*c,i[10]=M*p-x*c,i[11]=O*p-E*c,i}function H0(i,r,o){var c=Math.sin(o),p=Math.cos(o),m=r[0],y=r[1],x=r[2],E=r[3],S=r[8],k=r[9],M=r[10],O=r[11];return r!==i&&(i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=m*p-S*c,i[1]=y*p-k*c,i[2]=x*p-M*c,i[3]=E*p-O*c,i[8]=m*c+S*p,i[9]=y*c+k*p,i[10]=x*c+M*p,i[11]=E*c+O*p,i}function jA(i,r){return i[0]=r[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=r[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function VA(i,r,o){var c,p,m,y=o[0],x=o[1],E=o[2],S=Math.hypot(y,x,E);return S<G0?null:(y*=S=1/S,x*=S,E*=S,c=Math.sin(r),p=Math.cos(r),i[0]=y*y*(m=1-p)+p,i[1]=x*y*m+E*c,i[2]=E*y*m-x*c,i[3]=0,i[4]=y*x*m-E*c,i[5]=x*x*m+p,i[6]=E*x*m+y*c,i[7]=0,i[8]=y*E*m+x*c,i[9]=x*E*m-y*c,i[10]=E*E*m+p,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,r=arguments.length;r--;)i+=arguments[r]*arguments[r];return Math.sqrt(i)});var r5=ru;function Sx(){var i=new so(3);return so!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function $A(i){var r=new so(3);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r}function Hp(i){return Math.hypot(i[0],i[1],i[2])}function xh(i,r,o){var c=new so(3);return c[0]=i,c[1]=r,c[2]=o,c}function Gs(i,r,o){return i[0]=r[0]+o[0],i[1]=r[1]+o[1],i[2]=r[2]+o[2],i}function Tx(i,r,o){return i[0]=r[0]-o[0],i[1]=r[1]-o[1],i[2]=r[2]-o[2],i}function WA(i,r,o){return i[0]=r[0]*o[0],i[1]=r[1]*o[1],i[2]=r[2]*o[2],i}function qp(i,r,o){return i[0]=Math.min(r[0],o[0]),i[1]=Math.min(r[1],o[1]),i[2]=Math.min(r[2],o[2]),i}function Zp(i,r,o){return i[0]=Math.max(r[0],o[0]),i[1]=Math.max(r[1],o[1]),i[2]=Math.max(r[2],o[2]),i}function ko(i,r,o){return i[0]=r[0]*o,i[1]=r[1]*o,i[2]=r[2]*o,i}function Kp(i,r,o,c){return i[0]=r[0]+o[0]*c,i[1]=r[1]+o[1]*c,i[2]=r[2]+o[2]*c,i}function Di(i,r){var o=r[0],c=r[1],p=r[2],m=o*o+c*c+p*p;return m>0&&(m=1/Math.sqrt(m)),i[0]=r[0]*m,i[1]=r[1]*m,i[2]=r[2]*m,i}function ea(i,r){return i[0]*r[0]+i[1]*r[1]+i[2]*r[2]}function Ax(i,r,o){var c=r[0],p=r[1],m=r[2],y=o[0],x=o[1],E=o[2];return i[0]=p*E-m*x,i[1]=m*y-c*E,i[2]=c*x-p*y,i}function mn(i,r,o){var c=r[0],p=r[1],m=r[2],y=o[3]*c+o[7]*p+o[11]*m+o[15];return i[0]=(o[0]*c+o[4]*p+o[8]*m+o[12])/(y=y||1),i[1]=(o[1]*c+o[5]*p+o[9]*m+o[13])/y,i[2]=(o[2]*c+o[6]*p+o[10]*m+o[14])/y,i}function GA(i,r,o){var c=o[0],p=o[1],m=o[2],y=r[0],x=r[1],E=r[2],S=p*E-m*x,k=m*y-c*E,M=c*x-p*y,O=p*M-m*k,j=m*S-c*M,G=c*k-p*S,K=2*o[3];return k*=K,M*=K,j*=2,G*=2,i[0]=y+(S*=K)+(O*=2),i[1]=x+k+j,i[2]=E+M+G,i}var Xp,Ma=Tx,n5=WA,i5=Hp;function HA(i,r,o){return i[0]=r[0]*o,i[1]=r[1]*o,i[2]=r[2]*o,i[3]=r[3]*o,i}function qA(i,r){var o=r[0],c=r[1],p=r[2],m=r[3],y=o*o+c*c+p*p+m*m;return y>0&&(y=1/Math.sqrt(y)),i[0]=o*y,i[1]=c*y,i[2]=p*y,i[3]=m*y,i}function iu(i,r,o){var c=r[0],p=r[1],m=r[2],y=r[3];return i[0]=o[0]*c+o[4]*p+o[8]*m+o[12]*y,i[1]=o[1]*c+o[5]*p+o[9]*m+o[13]*y,i[2]=o[2]*c+o[6]*p+o[10]*m+o[14]*y,i[3]=o[3]*c+o[7]*p+o[11]*m+o[15]*y,i}function ZA(){var i=new so(4);return so!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function KA(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function XA(i,r,o){o*=.5;var c=r[0],p=r[1],m=r[2],y=r[3],x=Math.sin(o),E=Math.cos(o);return i[0]=c*E+y*x,i[1]=p*E+m*x,i[2]=m*E-p*x,i[3]=y*E-c*x,i}function YA(i,r,o){o*=.5;var c=r[0],p=r[1],m=r[2],y=r[3],x=Math.sin(o),E=Math.cos(o);return i[0]=c*E-m*x,i[1]=p*E+y*x,i[2]=m*E+c*x,i[3]=y*E-p*x,i}Sx(),Xp=new so(4),so!=Float32Array&&(Xp[0]=0,Xp[1]=0,Xp[2]=0,Xp[3]=0);var o5=qA;Sx(),xh(1,0,0),xh(0,1,0),ZA(),ZA(),NA();const a5=Ie([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:QA}=a5,JA=Ie([{name:"a_pos_3",components:3,type:"Int16"}]);var Yp=Ie([{name:"a_pos",type:"Int16",components:2}]);class Ix{constructor(r,o){this.pos=r,this.dir=o}intersectsPlane(r,o,c){const p=ea(o,this.dir);if(Math.abs(p)<1e-6)return!1;const m=((r[0]-this.pos[0])*o[0]+(r[1]-this.pos[1])*o[1]+(r[2]-this.pos[2])*o[2])/p;return c[0]=this.pos[0]+this.dir[0]*m,c[1]=this.pos[1]+this.dir[1]*m,c[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(r,o,c){if(function(j,G){var K=j[0],ee=j[1],le=j[2],me=G[0],ce=G[1],pe=G[2];return Math.abs(K-me)<=G0*Math.max(1,Math.abs(K),Math.abs(me))&&Math.abs(ee-ce)<=G0*Math.max(1,Math.abs(ee),Math.abs(ce))&&Math.abs(le-pe)<=G0*Math.max(1,Math.abs(le),Math.abs(pe))}(this.pos,r)||o===0)return c[0]=c[1]=c[2]=0,!1;const[p,m,y]=this.dir,x=this.pos[0]-r[0],E=this.pos[1]-r[1],S=this.pos[2]-r[2],k=p*p+m*m+y*y,M=2*(x*p+E*m+S*y),O=M*M-4*k*(x*x+E*E+S*S-o*o);if(O<0){const j=Math.max(-M/2,0),G=x+p*j,K=E+m*j,ee=S+y*j,le=Math.hypot(G,K,ee);return c[0]=G*o/le,c[1]=K*o/le,c[2]=ee*o/le,!1}{const j=(-M-Math.sqrt(O))/(2*k);if(j<0){const G=Math.hypot(x,E,S);return c[0]=x*o/G,c[1]=E*o/G,c[2]=S*o/G,!1}return c[0]=x+p*j,c[1]=E+m*j,c[2]=S+y*j,!0}}}class Cx{constructor(r,o,c,p,m){this.TL=r,this.TR=o,this.BR=c,this.BL=p,this.horizon=m}static fromInvProjectionMatrix(r,o,c){const p=[-1,1,1],m=[1,1,1],y=[1,-1,1],x=[-1,-1,1],E=mn(p,p,r),S=mn(m,m,r),k=mn(y,y,r),M=mn(x,x,r);return new Cx(E,S,k,M,o/c)}}class kx{constructor(r,o){this.points=r,this.planes=o}static fromInvProjectionMatrix(r,o,c,p){const m=Math.pow(2,c),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const S=iu([],E,r),k=1/S[3]/o*m;return function(M,O,j){return M[0]=O[0]*j[0],M[1]=O[1]*j[1],M[2]=O[2]*j[2],M[3]=O[3]*j[3],M}(S,S,[k,k,p?1/S[3]:k,k])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const S=Di([],Ax([],Ma([],y[E[0]],y[E[1]]),Ma([],y[E[2]],y[E[1]]))),k=-ea(S,y[E[1]]);return S.concat(k)});return new kx(y,x)}}class Mi{static fromPoints(r){const o=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const p of r)qp(o,o,p),Zp(c,c,p);return new Mi(o,c)}static applyTransform(r,o){const c=r.getCorners();for(let p=0;p<c.length;++p)mn(c[p],c[p],o);return Mi.fromPoints(c)}constructor(r,o){this.min=r,this.max=o,this.center=ko([],Gs([],this.min,this.max),.5)}quadrant(r){const o=[r%2==0,r<2],c=$A(this.min),p=$A(this.max);for(let m=0;m<o.length;m++)c[m]=o[m]?this.min[m]:this.center[m],p[m]=o[m]?this.center[m]:this.max[m];return p[2]=this.max[2],new Mi(c,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,o=this.max;return[[r[0],r[1],r[2]],[o[0],r[1],r[2]],[o[0],o[1],r[2]],[r[0],o[1],r[2]],[r[0],r[1],o[2]],[o[0],r[1],o[2]],[o[0],o[1],o[2]],[r[0],o[1],o[2]]]}intersects(r){const o=this.getCorners();let c=!0;for(let p=0;p<r.planes.length;p++){const m=r.planes[p];let y=0;for(let x=0;x<o.length;x++)y+=ea(m,o[x])+m[3]>=0;if(y===0)return 0;y!==o.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let m=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let x=0;x<r.points.length;x++){const E=r.points[x][p]-this.min[p];m=Math.min(m,E),y=Math.max(y,E)}if(y<0||m>this.max[p]-this.min[p])return 0}return 1}}const Px=5,e2=6,ns=Ot/Math.PI/2,s5=16383,ou=64,Qp=[ou,32,16],ta=-ns,ra=ns,l5=[new Mi([ta,ta,ta],[ra,ra,ra]),new Mi([ta,ta,ta],[0,0,ra]),new Mi([0,ta,ta],[ra,0,ra]),new Mi([ta,0,ta],[0,ra,ra]),new Mi([0,0,ta],[ra,ra,ra])];function q0(i){return i*ns/tf}function t2(i,r,o,c=!0){const p=ko([],i._camera.position,i.worldSize),m=[r,o,1,1];iu(m,m,i.pixelMatrixInverse),HA(m,m,1/m[3]);const y=Di([],Ma([],m,p)),x=i.globeMatrix,E=[x[12],x[13],x[14]],S=Ma([],E,p),k=Hp(S),M=Di([],S),O=i.worldSize/(2*Math.PI),j=ea(M,y),G=Math.asin(O/k);if(G<Math.acos(j)){if(!c)return null;const lt=[],Ue=[];ko(lt,y,k/j),Di(Ue,Ma(Ue,lt,S)),Di(y,Gs(y,S,ko(y,Ue,Math.tan(G)*k)))}const K=[];new Ix(p,y).closestPointOnSphere(E,O,K);const ee=Di([],Qn(x,0)),le=Di([],Qn(x,1)),me=Di([],Qn(x,2)),ce=ea(ee,K),pe=ea(le,K),_e=ea(me,K),ye=Ve(Math.asin(-pe/O));let Oe=Ve(Math.atan2(ce,_e));Oe=i.center.lng+function(lt,Ue){const Qe=(Ue-lt+180)%360-180;return Qe<-180?Qe+360:Qe}(i.center.lng,Oe);const Me=os(Oe),He=qe(as(ye),0,1);return new Sh(Me,He)}class c5{constructor(r,o,c){this.a=Ma([],r,c),this.b=Ma([],o,c),this.center=c;const p=Di([],this.a),m=Di([],this.b);this.angle=Math.acos(ea(p,m))}}function Dx(i,r){if(i.angle===0)return null;let o;return o=i.a[r]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[r]/i.a[r]/Math.sin(i.angle)-1/Math.tan(i.angle)),o<0||o>1?null:function(c,p,m,y){const x=Math.sin(m);return c*(Math.sin((1-y)*m)/x)+p*(Math.sin(y*m)/x)}(i.a[r],i.b[r],i.angle,qe(o,0,1))+i.center[r]}function is(i){if(i.z<=1)return l5[i.z+2*i.y+i.x];const r=Mx(Z0(i));return Mi.fromPoints(r)}function au(i,r,o){return ko(i,i,1-o),Kp(i,i,r,o)}function r2(i,r){const o=Eh(r.zoom);if(o===0)return is(i);const c=Z0(i),p=Mx(c),m=os(c.getWest())*r.worldSize,y=os(c.getEast())*r.worldSize,x=as(c.getNorth())*r.worldSize,E=as(c.getSouth())*r.worldSize,S=[m,x,0],k=[y,x,0],M=[m,E,0],O=[y,E,0],j=wx([],r.globeMatrix);return mn(S,S,j),mn(k,k,j),mn(M,M,j),mn(O,O,j),p[0]=au(p[0],M,o),p[1]=au(p[1],O,o),p[2]=au(p[2],k,o),p[3]=au(p[3],S,o),Mi.fromPoints(p)}function n2(i,r,o){for(const c of i)mn(c,c,r),ko(c,c,o)}function u5(i,r,o){const c=r/i.worldSize,p=i.globeMatrix;if(o.z<=1){const Me=is(o).getCorners();return n2(Me,p,c),Mi.fromPoints(Me)}const m=Z0(o),y=Mx(m);n2(y,p,c);const x=Number.MAX_VALUE,E=[-x,-x,-x],S=[x,x,x];if(m.contains(i.center)){for(const lt of y)qp(S,S,lt),Zp(E,E,lt);E[2]=0;const Me=i.point,He=[Me.x*c,Me.y*c,0];return qp(S,S,He),Zp(E,E,He),new Mi(S,E)}const k=[p[12]*c,p[13]*c,p[14]*c],M=m.getCenter(),O=qe(i.center.lat,-di,di),j=qe(M.lat,-di,di),G=os(i.center.lng),K=as(O);let ee=G-os(M.lng);const le=K-as(j);ee>.5?ee-=1:ee<-.5&&(ee+=1);let me=0;Math.abs(ee)>Math.abs(le)?me=ee>=0?1:3:(me=le>=0?0:2,Kp(k,k,[p[4]*c,p[5]*c,p[6]*c],-Math.sin(Fe(le>=0?m.getSouth():m.getNorth()))*ns));const ce=y[me],pe=y[(me+1)%4],_e=new c5(ce,pe,k),ye=[Dx(_e,0)||ce[0],Dx(_e,1)||ce[1],Dx(_e,2)||ce[2]],Oe=Eh(i.zoom);if(Oe>0){const Me=function({x:lt,y:Ue,z:Qe},Je,ot,pt,We){const _t=1/(1<<Qe);let It=lt*_t,vt=It+_t,Gt=Ue*_t,ft=Gt+_t,zt=0;const Ht=(It+vt)/2-pt;return Ht>.5?zt=-1:Ht<-.5&&(zt=1),It=((It+zt)*Je-(pt*=Je))*ot+pt,vt=((vt+zt)*Je-pt)*ot+pt,Gt=(Gt*Je-(We*=Je))*ot+We,ft=(ft*Je-We)*ot+We,[[It,ft,0],[vt,ft,0],[vt,Gt,0],[It,Gt,0]]}(o,r,i._pixelsPerMercatorPixel,G,K);for(let lt=0;lt<y.length;lt++)au(y[lt],Me[lt],Oe);const He=Gs([],Me[me],Me[(me+1)%4]);ko(He,He,.5),au(ye,He,Oe)}for(const Me of y)qp(S,S,Me),Zp(E,E,Me);return S[2]=Math.min(ce[2],pe[2]),qp(S,S,ye),Zp(E,E,ye),new Mi(S,E)}function Z0({x:i,y:r,z:o}){const c=1/(1<<o),p=new Fr(Po(i*c),hi((r+1)*c)),m=new Fr(Po((i+1)*c),hi(r*c));return new Fl(p,m)}function Mx(i){const r=Fe(i.getNorth()),o=Fe(i.getSouth()),c=Math.cos(r),p=Math.cos(o),m=Math.sin(r),y=Math.sin(o),x=i.getWest(),E=i.getEast();return[bh(p,y,x),bh(p,y,E),bh(c,m,E),bh(c,m,x)]}function bh(i,r,o,c=ns){return o=Fe(o),[i*Math.sin(o)*c,-r*c,i*Math.cos(o)*c]}function wh(i,r,o){return bh(Math.cos(Fe(i)),Math.sin(Fe(i)),r,o)}function Jp(i,r,o,c){const p=1<<o.z,m=(i/Ot+o.x)/p;return wh(hi((r/Ot+o.y)/p),Po(m),c)}function K0({min:i,max:r}){return s5/Math.max(r[0]-i[0],r[1]-i[1],r[2]-i[2])}const i2=new Float64Array(16);function ef(i){const r=K0(i),o=jA(i2,[r,r,r]);return Gp(o,o,((c=[])[0]=-(p=i.min)[0],c[1]=-p[1],c[2]=-p[2],c));var c,p}function zx(i){const r=(c=i.min,(o=i2)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=c[0],o[13]=c[1],o[14]=c[2],o[15]=1,o);var o,c;const p=1/K0(i);return nu(r,r,[p,p,p])}function o2(i,r,o,c,p){const m=function(E){const S=Ot/(2*Math.PI);return E/(2*Math.PI)/S}(o),y=[i,r,-o/(2*Math.PI)],x=Da(new Float64Array(16));return Gp(x,x,y),nu(x,x,[m,m,m]),Ex(x,x,Fe(-p)),H0(x,x,Fe(-c)),x}function Eh(i){return St(Px,e2,i)}function a2(i,r){const o=wh(r.lat,r.lng),c=function(G){const K=wh(G._center.lat,G._center.lng);let ee=Ax([],xh(0,1,0),K);const le=VA([],-G.angle,K);ee=mn(ee,ee,le),VA(le,-G._pitch,ee);const me=Di([],K);return ko(me,me,q0(G.cameraToCenterDistance/G.pixelsPerMeter)),mn(me,me,le),Gs([],K,me)}(i);return y=(p=Tx([],c,o))[0],x=p[1],E=p[2],S=(m=o)[0],k=m[1],M=m[2],j=(O=Math.sqrt(y*y+x*x+E*E)*Math.sqrt(S*S+k*k+M*M))&&ea(p,m)/O,Math.acos(Math.min(Math.max(j,-1),1));var p,m,y,x,E,S,k,M,O,j}function Rx(i,r){return a2(i,r)>Math.PI/2*1.01}const s2=Fe(85),h5=Math.cos(s2),d5=Math.sin(s2),tf=63710088e-1,l2=2*Math.PI*tf;class Ll{constructor(r,o){if(isNaN(r)||isNaN(o))throw new Error(`Invalid LngLat object: (${r}, ${o})`);if(this.lng=+r,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ll(gt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const o=Math.PI/180,c=this.lat*o,p=r.lat*o,m=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((r.lng-this.lng)*o);return tf*Math.acos(Math.min(m,1))}toBounds(r=0){const o=360*r/40075017,c=o/Math.cos(Math.PI/180*this.lat);return new Fl(new Ll(this.lng-c,this.lat-o),new Ll(this.lng+c,this.lat+o))}toEcef(r){const o=q0(r);return wh(this.lat,this.lng,ns+o)}static convert(r){if(r instanceof Ll)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Ll(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Ll(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Fr=Ll;function Ox(i){return l2*Math.cos(i*Math.PI/180)}function os(i){return(180+i)/360}function as(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function za(i,r){return i/Ox(r)}function Po(i){return 360*i-180}function hi(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function c2(i,r){return i*Ox(hi(r))}const di=85.051129;function u2(i){return 1/Math.cos(i*Math.PI/180)}class Sh{constructor(r,o,c=0){this.x=+r,this.y=+o,this.z=+c}static fromLngLat(r,o=0){const c=Fr.convert(r);return new Sh(os(c.lng),as(c.lat),za(o,c.lat))}toLngLat(){return new Fr(Po(this.x),hi(this.y))}toAltitude(){return c2(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/l2*u2(hi(this.y))}}function Fx(i,r,o,c,p,m,y,x,E){const S=(r+c)/2,k=(o+p)/2,M=new xe(S,k);x(M),function(O,j,G,K,ee,le){const me=G-ee,ce=K-le;return Math.abs((K-j)*me-(G-O)*ce)/Math.hypot(me,ce)}(M.x,M.y,m.x,m.y,y.x,y.y)>=E?(Fx(i,r,o,S,k,m,M,x,E),Fx(i,S,k,c,p,M,y,x,E)):i.push(y)}function h2(i,r,o){let c=i[0],p=c.x,m=c.y;r(c);const y=[c];for(let x=1;x<i.length;x++){const E=i[x],{x:S,y:k}=E;r(E),Fx(y,p,m,S,k,c,E,r,o),p=S,m=k,c=E}return y}function Lx(i,r,o,c){if(c(r,o)){const p=r.add(o)._mult(.5);Lx(i,r,p,c),Lx(i,p,o,c)}else i.push(o)}function p5(i,r){let o=i[0];const c=[o];for(let p=1;p<i.length;p++){const m=i[p];Lx(c,o,m,r),o=m}return c}const Bx=Math.pow(2,14)-1,d2=-Bx-1;function f5(i,r){const o=Math.round(i.x*r),c=Math.round(i.y*r);return i.x=qe(o,d2,Bx),i.y=qe(c,d2,Bx),(o<i.x||o>i.x+1||c<i.y||c>i.y+1)&&Tr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Hs(i,r,o){const c=i.loadGeometry(),p=i.extent,m=Ot/p;if(r&&o&&o.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:x,x:E,y:S,projection:k}=o,M=O=>{const j=Po((r.x+O.x/p)/y),G=hi((r.y+O.y/p)/y),K=k.project(j,G);O.x=(K.x*x-E)*p,O.y=(K.y*x-S)*p};for(let O=0;O<c.length;O++)if(i.type!==1)c[O]=h2(c[O],M,1);else{const j=[];for(const G of c[O])G.x<0||G.x>=p||G.y<0||G.y>=p||(M(G),j.push(G));c[O]=j}}for(const y of c)for(const x of y)f5(x,m);return c}function su(i,r){return{type:i.type,id:i.id,properties:i.properties,geometry:r?Hs(i):[]}}function X0(i,r,o,c,p){i.emplaceBack(2*r+(c+1)/2,2*o+(p+1)/2)}function Y0(i,r,o){i.emplaceBack(r.x,r.y,r.z,o[0]*16384,o[1]*16384,o[2]*16384)}class Nx{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new st,this.indexArray=new Pt,this.segments=new xn,this.programConfigurations=new tu(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(r,o,c,p){const m=this.layers[0],y=[];let x=null;m.type==="circle"&&(x=m.layout.get("circle-sort-key"));for(const{feature:S,id:k,index:M,sourceLayerIndex:O}of r){const j=this.layers[0]._featureFilter.needGeometry,G=su(S,j);if(!this.layers[0]._featureFilter.filter(new D(this.zoom),G,c))continue;const K=x?x.evaluate(G,{},c):void 0,ee={id:k,properties:S.properties,type:S.type,sourceLayerIndex:O,index:M,geometry:j?G.geometry:Hs(S,c,p),patterns:{},sortKey:K};y.push(ee)}x&&y.sort((S,k)=>S.sortKey-k.sortKey);let E=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new ut,E=p.projection);for(const S of y){const{geometry:k,index:M,sourceLayerIndex:O}=S,j=r[M].feature;this.addFeature(S,k,M,o.availableImages,c,E),o.featureIndex.insert(j,k,M,O,this.index)}}update(r,o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,e5.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,t5.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,o,c,p,m,y){for(const x of o)for(const E of x){const S=E.x,k=E.y;if(S<0||S>=Ot||k<0||k>=Ot)continue;if(y){const j=y.projectTilePoint(S,k,m),G=y.upVector(m,S,k),K=this.globeExtVertexArray;Y0(K,j,G),Y0(K,j,G),Y0(K,j,G),Y0(K,j,G)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),O=M.vertexLength;X0(this.layoutVertexArray,S,k,-1,-1),X0(this.layoutVertexArray,S,k,1,-1),X0(this.layoutVertexArray,S,k,1,1),X0(this.layoutVertexArray,S,k,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,{},p,m)}}function p2(i,r){for(let o=0;o<i.length;o++)if(lu(r,i[o]))return!0;for(let o=0;o<r.length;o++)if(lu(i,r[o]))return!0;return!!Ux(i,r)}function m5(i,r,o){return!!lu(i,r)||!!jx(r,i,o)}function f2(i,r){if(i.length===1)return g2(r,i[0]);for(let o=0;o<r.length;o++){const c=r[o];for(let p=0;p<c.length;p++)if(lu(i,c[p]))return!0}for(let o=0;o<i.length;o++)if(g2(r,i[o]))return!0;for(let o=0;o<r.length;o++)if(Ux(i,r[o]))return!0;return!1}function g5(i,r,o){if(i.length>1){if(Ux(i,r))return!0;for(let c=0;c<r.length;c++)if(jx(r[c],i,o))return!0}for(let c=0;c<i.length;c++)if(jx(i[c],r,o))return!0;return!1}function Ux(i,r){if(i.length===0||r.length===0)return!1;for(let o=0;o<i.length-1;o++){const c=i[o],p=i[o+1];for(let m=0;m<r.length-1;m++)if(y5(c,p,r[m],r[m+1]))return!0}return!1}function y5(i,r,o,c){return Bn(i,o,c)!==Bn(r,o,c)&&Bn(i,r,o)!==Bn(i,r,c)}function jx(i,r,o){const c=o*o;if(r.length===1)return i.distSqr(r[0])<c;for(let p=1;p<r.length;p++)if(m2(i,r[p-1],r[p])<c)return!0;return!1}function m2(i,r,o){const c=r.distSqr(o);if(c===0)return i.distSqr(r);const p=((i.x-r.x)*(o.x-r.x)+(i.y-r.y)*(o.y-r.y))/c;return i.distSqr(p<0?r:p>1?o:o.sub(r)._mult(p)._add(r))}function g2(i,r){let o,c,p,m=!1;for(let y=0;y<i.length;y++){o=i[y];for(let x=0,E=o.length-1;x<o.length;E=x++)c=o[x],p=o[E],c.y>r.y!=p.y>r.y&&r.x<(p.x-c.x)*(r.y-c.y)/(p.y-c.y)+c.x&&(m=!m)}return m}function lu(i,r){let o=!1;for(let c=0,p=i.length-1;c<i.length;p=c++){const m=i[c],y=i[p];m.y>r.y!=y.y>r.y&&r.x<(y.x-m.x)*(r.y-m.y)/(y.y-m.y)+m.x&&(o=!o)}return o}function y2(i,r,o,c,p){for(const y of i)if(r<=y.x&&o<=y.y&&c>=y.x&&p>=y.y)return!0;const m=[new xe(r,o),new xe(r,p),new xe(c,p),new xe(c,o)];if(i.length>2){for(const y of m)if(lu(i,y))return!0}for(let y=0;y<i.length-1;y++)if(_5(i[y],i[y+1],m))return!0;return!1}function _5(i,r,o){const c=o[0],p=o[2];if(i.x<c.x&&r.x<c.x||i.x>p.x&&r.x>p.x||i.y<c.y&&r.y<c.y||i.y>p.y&&r.y>p.y)return!1;const m=Bn(i,r,o[0]);return m!==Bn(i,r,o[1])||m!==Bn(i,r,o[2])||m!==Bn(i,r,o[3])}function Th(i,r,o){const c=r.paint.get(i).value;return c.kind==="constant"?c.value:o.programConfigurations.get(r.id).getMaxValue(i)}function Q0(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function _2(i,r,o,c,p){if(!r[0]&&!r[1])return i;const m=xe.convert(r)._mult(p);o==="viewport"&&m._rotate(-c);const y=[];for(let x=0;x<i.length;x++)y.push(i[x].sub(m));return y}function v2(i,r,o,c){const p=xe.convert(i)._mult(c);return r==="viewport"&&p._rotate(-o),p}Tt(Nx,"CircleBucket",{omit:["layers"]});const v5=new he({"circle-sort-key":new re(Ge.layout_circle["circle-sort-key"])});var x5={paint:new he({"circle-radius":new re(Ge.paint_circle["circle-radius"]),"circle-color":new re(Ge.paint_circle["circle-color"]),"circle-blur":new re(Ge.paint_circle["circle-blur"]),"circle-opacity":new re(Ge.paint_circle["circle-opacity"]),"circle-translate":new Z(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Z(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Z(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Z(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new re(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new re(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new re(Ge.paint_circle["circle-stroke-opacity"])}),layout:v5};function x2(i,r,o,c,p,m,y,x,E){if(m&&i.queryGeometry.isAboveHorizon)return!1;m&&(E*=i.pixelToTileUnitsFactor);const S=i.tileID.canonical,k=o.projection.upVectorScale(S,o.center.lat,o.worldSize).metersToTile;for(const M of r)for(const O of M){const j=O.add(x),G=p&&o.elevation?o.elevation.exaggeration()*p.getElevationAt(j.x,j.y,!0):0,K=o.projection.projectTilePoint(j.x,j.y,S);if(G>0){const ce=o.projection.upVector(S,j.x,j.y);K.x+=ce[0]*k*G,K.y+=ce[1]*k*G,K.z+=ce[2]*k*G}const ee=m?j:b5(K.x,K.y,K.z,c),le=m?i.tilespaceRays.map(ce=>E5(ce,G)):i.queryGeometry.screenGeometry,me=iu([],[K.x,K.y,K.z,1],c);if(!y&&m?E*=me[3]/o.cameraToCenterDistance:y&&!m&&(E*=o.cameraToCenterDistance/me[3]),m){const ce=hi((O.y/Ot+S.y)/(1<<S.z));E/=o.projection.pixelsPerMeter(ce,1)/za(1,ce)}if(m5(le,ee,E))return!0}return!1}function b5(i,r,o,c){const p=iu([],[i,r,o,1],c);return new xe(p[0]/p[3],p[1]/p[3])}const b2=xh(0,0,0),w5=xh(0,0,1);function E5(i,r){const o=Sx();return b2[2]=r,i.intersectsPlane(b2,w5,o),new xe(o[0],o[1])}class w2 extends Nx{}function E2(i,{width:r,height:o},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*o*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(r*o*c);return i.width=r,i.height=o,i.data=p,i}function S2(i,r,o){const{width:c,height:p}=r;c===i.width&&p===i.height||(Vx(i,r,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,c),height:Math.min(i.height,p)},o),i.width=c,i.height=p,i.data=r.data)}function Vx(i,r,o,c,p,m){if(p.width===0||p.height===0)return r;if(p.width>i.width||p.height>i.height||o.x>i.width-p.width||o.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||c.x>r.width-p.width||c.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,x=r.data;for(let E=0;E<p.height;E++){const S=((o.y+E)*i.width+o.x)*m,k=((c.y+E)*r.width+c.x)*m;for(let M=0;M<p.width*m;M++)x[k+M]=y[S+M]}return r}Tt(w2,"HeatmapBucket",{omit:["layers"]});class qs{constructor(r,o){E2(this,r,1,o)}resize(r){S2(this,new qs(r),1)}clone(){return new qs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,c,p,m){Vx(r,o,c,p,m,1)}}class lo{constructor(r,o){E2(this,r,4,o)}resize(r){S2(this,new lo(r),4)}replace(r,o){o?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,c,p,m){Vx(r,o,c,p,m,4)}}Tt(qs,"AlphaImage"),Tt(lo,"RGBAImage");var S5={paint:new he({"heatmap-radius":new re(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new re(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Z(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ue(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Z(Ge.paint_heatmap["heatmap-opacity"])})};function $x(i){const r={},o=i.resolution||256,c=i.clips?i.clips.length:1,p=i.image||new lo({width:o,height:c}),m=(y,x,E)=>{r[i.evaluationKey]=E;const S=i.expression.evaluate(r);p.data[y+x+0]=Math.floor(255*S.r/S.a),p.data[y+x+1]=Math.floor(255*S.g/S.a),p.data[y+x+2]=Math.floor(255*S.b/S.a),p.data[y+x+3]=Math.floor(255*S.a)};if(i.clips)for(let y=0,x=0;y<c;++y,x+=4*o)for(let E=0,S=0;E<o;E++,S+=4){const k=E/(o-1),{start:M,end:O}=i.clips[y];m(x,S,M*(1-k)+O*k)}else for(let y=0,x=0;y<o;y++,x+=4)m(0,x,y/(o-1));return p}var T5={paint:new he({"hillshade-illumination-direction":new Z(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Z(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Z(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Z(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Z(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Z(Ge.paint_hillshade["hillshade-accent-color"])})};const A5=Ie([{name:"a_pos",components:2,type:"Int16"}],4),{members:I5}=A5;var Wx={exports:{}};function J0(i,r,o){o=o||2;var c,p,m,y,x,E,S,k=r&&r.length,M=k?r[0]*o:i.length,O=T2(i,0,M,o,!0),j=[];if(!O||O.next===O.prev)return j;if(k&&(O=function(K,ee,le,me){var ce,pe,_e,ye=[];for(ce=0,pe=ee.length;ce<pe;ce++)(_e=T2(K,ee[ce]*me,ce<pe-1?ee[ce+1]*me:K.length,me,!1))===_e.next&&(_e.steiner=!0),ye.push(O5(_e));for(ye.sort(M5),ce=0;ce<ye.length;ce++)le=z5(ye[ce],le);return le}(i,r,O,o)),i.length>80*o){c=m=i[0],p=y=i[1];for(var G=o;G<M;G+=o)(x=i[G])<c&&(c=x),(E=i[G+1])<p&&(p=E),x>m&&(m=x),E>y&&(y=E);S=(S=Math.max(m-c,y-p))!==0?32767/S:0}return rf(O,j,o,c,p,S,0),j}function T2(i,r,o,c,p){var m,y;if(p===qx(i,r,o,c)>0)for(m=r;m<o;m+=c)y=C2(m,i[m],i[m+1],y);else for(m=o-c;m>=r;m-=c)y=C2(m,i[m],i[m+1],y);return y&&eg(y,y.next)&&(of(y),y=y.next),y}function cu(i,r){if(!i)return i;r||(r=i);var o,c=i;do if(o=!1,c.steiner||!eg(c,c.next)&&bn(c.prev,c,c.next)!==0)c=c.next;else{if(of(c),(c=r=c.prev)===c.next)break;o=!0}while(o||c!==r);return r}function rf(i,r,o,c,p,m,y){if(i){!y&&m&&function(k,M,O,j){var G=k;do G.z===0&&(G.z=Gx(G.x,G.y,M,O,j)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==k);G.prevZ.nextZ=null,G.prevZ=null,function(K){var ee,le,me,ce,pe,_e,ye,Oe,Me=1;do{for(le=K,K=null,pe=null,_e=0;le;){for(_e++,me=le,ye=0,ee=0;ee<Me&&(ye++,me=me.nextZ);ee++);for(Oe=Me;ye>0||Oe>0&&me;)ye!==0&&(Oe===0||!me||le.z<=me.z)?(ce=le,le=le.nextZ,ye--):(ce=me,me=me.nextZ,Oe--),pe?pe.nextZ=ce:K=ce,ce.prevZ=pe,pe=ce;le=me}pe.nextZ=null,Me*=2}while(_e>1)}(G)}(i,c,p,m);for(var x,E,S=i;i.prev!==i.next;)if(x=i.prev,E=i.next,m?k5(i,c,p,m):C5(i))r.push(x.i/o|0),r.push(i.i/o|0),r.push(E.i/o|0),of(i),i=E.next,S=E.next;else if((i=E)===S){y?y===1?rf(i=P5(cu(i),r,o),r,o,c,p,m,2):y===2&&D5(i,r,o,c,p,m):rf(cu(i),r,o,c,p,m,1);break}}}function C5(i){var r=i.prev,o=i,c=i.next;if(bn(r,o,c)>=0)return!1;for(var p=r.x,m=o.x,y=c.x,x=r.y,E=o.y,S=c.y,k=p<m?p<y?p:y:m<y?m:y,M=x<E?x<S?x:S:E<S?E:S,O=p>m?p>y?p:y:m>y?m:y,j=x>E?x>S?x:S:E>S?E:S,G=c.next;G!==r;){if(G.x>=k&&G.x<=O&&G.y>=M&&G.y<=j&&Ah(p,x,m,E,y,S,G.x,G.y)&&bn(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function k5(i,r,o,c){var p=i.prev,m=i,y=i.next;if(bn(p,m,y)>=0)return!1;for(var x=p.x,E=m.x,S=y.x,k=p.y,M=m.y,O=y.y,j=x<E?x<S?x:S:E<S?E:S,G=k<M?k<O?k:O:M<O?M:O,K=x>E?x>S?x:S:E>S?E:S,ee=k>M?k>O?k:O:M>O?M:O,le=Gx(j,G,r,o,c),me=Gx(K,ee,r,o,c),ce=i.prevZ,pe=i.nextZ;ce&&ce.z>=le&&pe&&pe.z<=me;){if(ce.x>=j&&ce.x<=K&&ce.y>=G&&ce.y<=ee&&ce!==p&&ce!==y&&Ah(x,k,E,M,S,O,ce.x,ce.y)&&bn(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,pe.x>=j&&pe.x<=K&&pe.y>=G&&pe.y<=ee&&pe!==p&&pe!==y&&Ah(x,k,E,M,S,O,pe.x,pe.y)&&bn(pe.prev,pe,pe.next)>=0))return!1;pe=pe.nextZ}for(;ce&&ce.z>=le;){if(ce.x>=j&&ce.x<=K&&ce.y>=G&&ce.y<=ee&&ce!==p&&ce!==y&&Ah(x,k,E,M,S,O,ce.x,ce.y)&&bn(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;pe&&pe.z<=me;){if(pe.x>=j&&pe.x<=K&&pe.y>=G&&pe.y<=ee&&pe!==p&&pe!==y&&Ah(x,k,E,M,S,O,pe.x,pe.y)&&bn(pe.prev,pe,pe.next)>=0)return!1;pe=pe.nextZ}return!0}function P5(i,r,o){var c=i;do{var p=c.prev,m=c.next.next;!eg(p,m)&&A2(p,c,c.next,m)&&nf(p,m)&&nf(m,p)&&(r.push(p.i/o|0),r.push(c.i/o|0),r.push(m.i/o|0),of(c),of(c.next),c=i=m),c=c.next}while(c!==i);return cu(c)}function D5(i,r,o,c,p,m){var y=i;do{for(var x=y.next.next;x!==y.prev;){if(y.i!==x.i&&F5(y,x)){var E=I2(y,x);return y=cu(y,y.next),E=cu(E,E.next),rf(y,r,o,c,p,m,0),void rf(E,r,o,c,p,m,0)}x=x.next}y=y.next}while(y!==i)}function M5(i,r){return i.x-r.x}function z5(i,r){var o=function(p,m){var y,x=m,E=p.x,S=p.y,k=-1/0;do{if(S<=x.y&&S>=x.next.y&&x.next.y!==x.y){var M=x.x+(S-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(M<=E&&M>k&&(k=M,y=x.x<x.next.x?x:x.next,M===E))return y}x=x.next}while(x!==m);if(!y)return null;var O,j=y,G=y.x,K=y.y,ee=1/0;x=y;do E>=x.x&&x.x>=G&&E!==x.x&&Ah(S<K?E:k,S,G,K,S<K?k:E,S,x.x,x.y)&&(O=Math.abs(S-x.y)/(E-x.x),nf(x,p)&&(O<ee||O===ee&&(x.x>y.x||x.x===y.x&&R5(y,x)))&&(y=x,ee=O)),x=x.next;while(x!==j);return y}(i,r);if(!o)return r;var c=I2(o,i);return cu(c,c.next),cu(o,o.next)}function R5(i,r){return bn(i.prev,i,r.prev)<0&&bn(r.next,i,i.next)<0}function Gx(i,r,o,c,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-o)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-c)*p|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function O5(i){var r=i,o=i;do(r.x<o.x||r.x===o.x&&r.y<o.y)&&(o=r),r=r.next;while(r!==i);return o}function Ah(i,r,o,c,p,m,y,x){return(p-y)*(r-x)>=(i-y)*(m-x)&&(i-y)*(c-x)>=(o-y)*(r-x)&&(o-y)*(m-x)>=(p-y)*(c-x)}function F5(i,r){return i.next.i!==r.i&&i.prev.i!==r.i&&!function(o,c){var p=o;do{if(p.i!==o.i&&p.next.i!==o.i&&p.i!==c.i&&p.next.i!==c.i&&A2(p,p.next,o,c))return!0;p=p.next}while(p!==o);return!1}(i,r)&&(nf(i,r)&&nf(r,i)&&function(o,c){var p=o,m=!1,y=(o.x+c.x)/2,x=(o.y+c.y)/2;do p.y>x!=p.next.y>x&&p.next.y!==p.y&&y<(p.next.x-p.x)*(x-p.y)/(p.next.y-p.y)+p.x&&(m=!m),p=p.next;while(p!==o);return m}(i,r)&&(bn(i.prev,i,r.prev)||bn(i,r.prev,r))||eg(i,r)&&bn(i.prev,i,i.next)>0&&bn(r.prev,r,r.next)>0)}function bn(i,r,o){return(r.y-i.y)*(o.x-r.x)-(r.x-i.x)*(o.y-r.y)}function eg(i,r){return i.x===r.x&&i.y===r.y}function A2(i,r,o,c){var p=rg(bn(i,r,o)),m=rg(bn(i,r,c)),y=rg(bn(o,c,i)),x=rg(bn(o,c,r));return p!==m&&y!==x||!(p!==0||!tg(i,o,r))||!(m!==0||!tg(i,c,r))||!(y!==0||!tg(o,i,c))||!(x!==0||!tg(o,r,c))}function tg(i,r,o){return r.x<=Math.max(i.x,o.x)&&r.x>=Math.min(i.x,o.x)&&r.y<=Math.max(i.y,o.y)&&r.y>=Math.min(i.y,o.y)}function rg(i){return i>0?1:i<0?-1:0}function nf(i,r){return bn(i.prev,i,i.next)<0?bn(i,r,i.next)>=0&&bn(i,i.prev,r)>=0:bn(i,r,i.prev)<0||bn(i,i.next,r)<0}function I2(i,r){var o=new Hx(i.i,i.x,i.y),c=new Hx(r.i,r.x,r.y),p=i.next,m=r.prev;return i.next=r,r.prev=i,o.next=p,p.prev=o,c.next=o,o.prev=c,m.next=c,c.prev=m,c}function C2(i,r,o,c){var p=new Hx(i,r,o);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function of(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Hx(i,r,o){this.i=i,this.x=r,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qx(i,r,o,c){for(var p=0,m=r,y=o-c;m<o;m+=c)p+=(i[y]-i[m])*(i[m+1]+i[y+1]),y=m;return p}Wx.exports=J0,Wx.exports.default=J0,J0.deviation=function(i,r,o,c){var p=r&&r.length,m=Math.abs(qx(i,0,p?r[0]*o:i.length,o));if(p)for(var y=0,x=r.length;y<x;y++)m-=Math.abs(qx(i,r[y]*o,y<x-1?r[y+1]*o:i.length,o));var E=0;for(y=0;y<c.length;y+=3){var S=c[y]*o,k=c[y+1]*o,M=c[y+2]*o;E+=Math.abs((i[S]-i[M])*(i[k+1]-i[S+1])-(i[S]-i[k])*(i[M+1]-i[S+1]))}return m===0&&E===0?0:Math.abs((E-m)/m)},J0.flatten=function(i){for(var r=i[0][0].length,o={vertices:[],holes:[],dimensions:r},c=0,p=0;p<i.length;p++){for(var m=0;m<i[p].length;m++)for(var y=0;y<r;y++)o.vertices.push(i[p][m][y]);p>0&&o.holes.push(c+=i[p-1].length)}return o};var Zx=F(Wx.exports);function L5(i,r,o,c,p){k2(i,r,o||0,c||i.length-1,p||B5)}function k2(i,r,o,c,p){for(;c>o;){if(c-o>600){var m=c-o+1,y=r-o+1,x=Math.log(m),E=.5*Math.exp(2*x/3),S=.5*Math.sqrt(x*E*(m-E)/m)*(y-m/2<0?-1:1);k2(i,r,Math.max(o,Math.floor(r-y*E/m+S)),Math.min(c,Math.floor(r+(m-y)*E/m+S)),p)}var k=i[r],M=o,O=c;for(af(i,o,r),p(i[c],k)>0&&af(i,o,c);M<O;){for(af(i,M,O),M++,O--;p(i[M],k)<0;)M++;for(;p(i[O],k)>0;)O--}p(i[o],k)===0?af(i,o,O):af(i,++O,c),O<=r&&(o=O+1),r<=O&&(c=O-1)}}function af(i,r,o){var c=i[r];i[r]=i[o],i[o]=c}function B5(i,r){return i<r?-1:i>r?1:0}function Kx(i,r){const o=i.length;if(o<=1)return[i];const c=[];let p,m;for(let y=0;y<o;y++){const x=ma(i[y]);x!==0&&(i[y].area=Math.abs(x),m===void 0&&(m=x<0),m===x<0?(p&&c.push(p),p=[i[y]]):p.push(i[y]))}if(p&&c.push(p),r>1)for(let y=0;y<c.length;y++)c[y].length<=r||(L5(c[y],r,1,c[y].length-1,N5),c[y]=c[y].slice(0,r));return c}function N5(i,r){return r.area-i.area}function Xx(i,r,o){const c=o.patternDependencies;let p=!1;for(const m of r){const y=m.paint.get(`${i}-pattern`);y.isConstant()||(p=!0);const x=y.constantOr(null);x&&(p=!0,c[x]=!0)}return p}function Yx(i,r,o,c,p){const m=p.patternDependencies;for(const y of r){const x=y.paint.get(`${i}-pattern`).value;if(x.kind!=="constant"){let E=x.evaluate({zoom:c},o,{},p.availableImages);E=E&&E.name?E.name:E,m[E]=!0,o.patterns[y.id]=E}}return o}class ng{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new st,this.indexArray=new Pt,this.indexArray2=new Gn,this.programConfigurations=new tu(r.layers,r.zoom),this.segments=new xn,this.segments2=new xn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=r.projection}populate(r,o,c,p){this.hasPattern=Xx("fill",this.layers,o);const m=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:x,id:E,index:S,sourceLayerIndex:k}of r){const M=this.layers[0]._featureFilter.needGeometry,O=su(x,M);if(!this.layers[0]._featureFilter.filter(new D(this.zoom),O,c))continue;const j=m?m.evaluate(O,{},c,o.availableImages):void 0,G={id:E,properties:x.properties,type:x.type,sourceLayerIndex:k,index:S,geometry:M?O.geometry:Hs(x,c,p),patterns:{},sortKey:j};y.push(G)}m&&y.sort((x,E)=>x.sortKey-E.sortKey);for(const x of y){const{geometry:E,index:S,sourceLayerIndex:k}=x;if(this.hasPattern){const M=Yx("fill",this.layers,x,this.zoom,o);this.patternFeatures.push(M)}else this.addFeature(x,E,S,c,{},o.availableImages);o.featureIndex.insert(r[S].feature,E,S,k,this.index)}}update(r,o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,c,p)}addFeatures(r,o,c,p,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,o,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,I5),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,o,c,p,m,y=[]){for(const x of Kx(o,500)){let E=0;for(const G of x)E+=G.length;const S=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),k=S.vertexLength,M=[],O=[];for(const G of x){if(G.length===0)continue;G!==x[0]&&O.push(M.length/2);const K=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),ee=K.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(ee+G.length-1,ee),M.push(G[0].x),M.push(G[0].y);for(let le=1;le<G.length;le++)this.layoutVertexArray.emplaceBack(G[le].x,G[le].y),this.indexArray2.emplaceBack(ee+le-1,ee+le),M.push(G[le].x),M.push(G[le].y);K.vertexLength+=G.length,K.primitiveLength+=G.length}const j=Zx(M,O);for(let G=0;G<j.length;G+=3)this.indexArray.emplaceBack(k+j[G],k+j[G+1],k+j[G+2]);S.vertexLength+=E,S.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,m,y,p)}}Tt(ng,"FillBucket",{omit:["layers","patternFeatures"]});const U5=new he({"fill-sort-key":new re(Ge.layout_fill["fill-sort-key"])});var j5={paint:new he({"fill-antialias":new Z(Ge.paint_fill["fill-antialias"]),"fill-opacity":new re(Ge.paint_fill["fill-opacity"]),"fill-color":new re(Ge.paint_fill["fill-color"]),"fill-outline-color":new re(Ge.paint_fill["fill-outline-color"]),"fill-translate":new Z(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Z(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new re(Ge.paint_fill["fill-pattern"])}),layout:U5};const V5=Ie([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),$5=Ie([{name:"a_centroid_pos",components:2,type:"Uint16"}]),W5=Ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:G5}=V5;var ig={},H5=se,P2=Ih;function Ih(i,r,o,c,p){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=c,this._values=p,i.readFields(q5,this,r)}function q5(i,r,o){i==1?r.id=o.readVarint():i==2?function(c,p){for(var m=c.readVarint()+c.pos;c.pos<m;){var y=p._keys[c.readVarint()],x=p._values[c.readVarint()];p.properties[y]=x}}(o,r):i==3?r.type=o.readVarint():i==4&&(r._geometry=o.pos)}function Z5(i){for(var r,o,c=0,p=0,m=i.length,y=m-1;p<m;y=p++)c+=((o=i[y]).x-(r=i[p]).x)*(r.y+o.y);return c}Ih.types=["Unknown","Point","LineString","Polygon"],Ih.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var r,o=i.readVarint()+i.pos,c=1,p=0,m=0,y=0,x=[];i.pos<o;){if(p<=0){var E=i.readVarint();c=7&E,p=E>>3}if(p--,c===1||c===2)m+=i.readSVarint(),y+=i.readSVarint(),c===1&&(r&&x.push(r),r=[]),r.push(new H5(m,y));else{if(c!==7)throw new Error("unknown command "+c);r&&r.push(r[0].clone())}}return r&&x.push(r),x},Ih.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var r=i.readVarint()+i.pos,o=1,c=0,p=0,m=0,y=1/0,x=-1/0,E=1/0,S=-1/0;i.pos<r;){if(c<=0){var k=i.readVarint();o=7&k,c=k>>3}if(c--,o===1||o===2)(p+=i.readSVarint())<y&&(y=p),p>x&&(x=p),(m+=i.readSVarint())<E&&(E=m),m>S&&(S=m);else if(o!==7)throw new Error("unknown command "+o)}return[y,E,x,S]},Ih.prototype.toGeoJSON=function(i,r,o){var c,p,m=this.extent*Math.pow(2,o),y=this.extent*i,x=this.extent*r,E=this.loadGeometry(),S=Ih.types[this.type];function k(j){for(var G=0;G<j.length;G++){var K=j[G];j[G]=[360*(K.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(c=0;c<E.length;c++)M[c]=E[c][0];k(E=M);break;case 2:for(c=0;c<E.length;c++)k(E[c]);break;case 3:for(E=function(j){var G=j.length;if(G<=1)return[j];for(var K,ee,le=[],me=0;me<G;me++){var ce=Z5(j[me]);ce!==0&&(ee===void 0&&(ee=ce<0),ee===ce<0?(K&&le.push(K),K=[j[me]]):K.push(j[me]))}return K&&le.push(K),le}(E),c=0;c<E.length;c++)for(p=0;p<E[c].length;p++)k(E[c][p])}E.length===1?E=E[0]:S="Multi"+S;var O={type:"Feature",geometry:{type:S,coordinates:E},properties:this.properties};return"id"in this&&(O.id=this.id),O};var K5=P2,D2=M2;function M2(i,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(X5,this,r),this.length=this._features.length}function X5(i,r,o){i===15?r.version=o.readVarint():i===1?r.name=o.readString():i===5?r.extent=o.readVarint():i===2?r._features.push(o.pos):i===3?r._keys.push(o.readString()):i===4&&r._values.push(function(c){for(var p=null,m=c.readVarint()+c.pos;c.pos<m;){var y=c.readVarint()>>3;p=y===1?c.readString():y===2?c.readFloat():y===3?c.readDouble():y===4?c.readVarint64():y===5?c.readVarint():y===6?c.readSVarint():y===7?c.readBoolean():null}return p}(o))}M2.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var r=this._pbf.readVarint()+this._pbf.pos;return new K5(this._pbf,r,this.extent,this._keys,this._values)};var Y5=D2;function Q5(i,r,o){if(i===3){var c=new Y5(o,o.readVarint()+o.pos);c.length&&(r[c.name]=c)}}var Qx=ig.VectorTile=function(i,r){this.layers=i.readFields(Q5,{},r)},og=ig.VectorTileFeature=P2;function ag(i,r,o,c){const p=[],m=c===0?(y,x,E,S,k,M)=>{y.push(new xe(M,E+(M-x)/(S-x)*(k-E)))}:(y,x,E,S,k,M)=>{y.push(new xe(x+(M-E)/(k-E)*(S-x),M))};for(const y of i){const x=[];for(const E of y){if(E.length<=2)continue;const S=[];for(let O=0;O<E.length-1;O++){const j=E[O].x,G=E[O].y,K=E[O+1].x,ee=E[O+1].y,le=c===0?j:G,me=c===0?K:ee;le<r?me>r&&m(S,j,G,K,ee,r):le>o?me<o&&m(S,j,G,K,ee,o):S.push(E[O]),me<r&&le>=r&&m(S,j,G,K,ee,r),me>o&&le<=o&&m(S,j,G,K,ee,o)}let k=E[E.length-1];const M=c===0?k.x:k.y;M>=r&&M<=o&&S.push(k),S.length&&(k=S[S.length-1],S[0].x===k.x&&S[0].y===k.y||S.push(S[0]),x.push(S))}x.length&&p.push(x)}return p}ig.VectorTileLayer=D2;const J5=og.types,eF=Math.pow(2,13);function sf(i,r,o,c,p,m,y,x){i.emplaceBack((r<<1)+y,(o<<1)+m,(Math.floor(c*eF)<<1)+p,Math.round(x))}function lf(i,r,o){i.emplaceBack(r.x,r.y,r.z,o[0]*16384,o[1]*16384,o[2]*16384)}class z2{constructor(){this.acc=new xe(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new xe(r.x,r.y),this.max=new xe(r.x,r.y))}append(r,o){this.currentPolyCount.edges++,this.acc._add(r);const c=this.min,p=this.max;r.x<c.x?c.x=r.x:r.x>p.x&&(p.x=r.x),r.y<c.y?c.y=r.y:r.y>p.y&&(p.y=r.y),((r.x===0||r.x===Ot)&&r.x===o.x)!=((r.y===0||r.y===Ot)&&r.y===o.y)&&this.processBorderOverlap(r,o),o.x<0!=r.x<0&&this.addBorderIntersection(0,dr(o.y,r.y,(0-o.x)/(r.x-o.x))),o.x>Ot!=r.x>Ot&&this.addBorderIntersection(1,dr(o.y,r.y,(Ot-o.x)/(r.x-o.x))),o.y<0!=r.y<0&&this.addBorderIntersection(2,dr(o.x,r.x,(0-o.y)/(r.y-o.y))),o.y>Ot!=r.y>Ot&&this.addBorderIntersection(3,dr(o.x,r.x,(Ot-o.y)/(r.y-o.y)))}addBorderIntersection(r,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[r];o<c[0]&&(c[0]=o),o>c[1]&&(c[1]=o)}processBorderOverlap(r,o){if(r.x===o.x){if(r.y===o.y)return;const c=r.x===0?0:1;this.addBorderIntersection(c,o.y),this.addBorderIntersection(c,r.y)}else{const c=r.y===0?2:3;this.addBorderIntersection(c,o.x),this.addBorderIntersection(c,r.x)}}centroid(){const r=this.polyCount.reduce((o,c)=>o+c.edges,0);return r!==0?this.acc.div(r)._round():new xe(0,0)}span(){return new xe(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,o)=>r+ +(o[0]!==Number.MAX_VALUE),0)}}class cf{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.id),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new Ke,this.centroidVertexArray=new Ca,this.indexArray=new Pt,this.programConfigurations=new tu(r.layers,r.zoom),this.segments=new xn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.enableTerrain=r.enableTerrain}populate(r,o,c,p){this.features=[],this.hasPattern=Xx("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const y=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*y/(y*y+1)/Ot/(1<<m.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:m,id:y,index:x,sourceLayerIndex:E}of r){const S=this.layers[0]._featureFilter.needGeometry,k=su(m,S);if(!this.layers[0]._featureFilter.filter(new D(this.zoom),k,c))continue;const M={id:y,sourceLayerIndex:E,index:x,geometry:S?k.geometry:Hs(m,c,p),properties:m.properties,type:m.type,patterns:{}},O=this.layoutVertexArray.length;this.hasPattern?this.features.push(Yx("fill-extrusion",this.layers,M,this.zoom,o)):this.addFeature(M,M.geometry,x,c,{},o.availableImages,p),o.featureIndex.insert(m,M.geometry,x,E,this.index,O)}this.sortBorders()}addFeatures(r,o,c,p,m){for(const y of this.features){const{geometry:x}=y;this.addFeature(y,x,y.index,o,c,p,m)}this.sortBorders()}update(r,o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,G5),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,W5.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,$5.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,o,c,p,m,y,x){const E=[new xe(0,0),new xe(Ot,Ot)],S=x.projection,k=S.name==="globe",M=this.enableTerrain&&!k?new z2:null,O=J5[r.type]==="Polygon";k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ut);const j=Kx(o,500);for(let le=j.length-1;le>=0;le--){const me=j[le];(me.length===0||(G=me[0]).every(ce=>ce.x<=0)||G.every(ce=>ce.x>=Ot)||G.every(ce=>ce.y<=0)||G.every(ce=>ce.y>=Ot))&&j.splice(le,1)}var G;let K;if(k)K=U2(j,E,p);else{K=[];for(const le of j)K.push({polygon:le,bounds:E})}const ee=O?this.edgeRadius:0;for(const{polygon:le,bounds:me}of K){let ce=0,pe=0;for(const ye of le)O&&!ye[0].equals(ye[ye.length-1])&&ye.push(ye[0]),pe+=O?ye.length-1:ye.length;const _e=this.segments.prepareSegment((O?5:4)*pe,this.layoutVertexArray,this.indexArray);if(O){const ye=[],Oe=[];ce=_e.vertexLength;for(const He of le){let lt,Ue;He.length&&He!==le[0]&&Oe.push(ye.length/2),lt=He[1].sub(He[0])._perp()._unit();for(let Qe=1;Qe<He.length;Qe++){const Je=He[Qe],ot=He[Qe===He.length-1?1:Qe+1];let{x:pt,y:We}=Je;if(ee){Ue=ot.sub(Je)._perp()._unit();const _t=lt.add(Ue)._unit(),It=ee*Math.min(4,1/(lt.x*_t.x+lt.y*_t.y));pt+=It*_t.x,We+=It*_t.y,lt=Ue}sf(this.layoutVertexArray,pt,We,0,0,1,1,0),_e.vertexLength++,ye.push(Je.x,Je.y),k&&lf(this.layoutVertexExtArray,S.projectTilePoint(pt,We,p),S.upVector(p,pt,We))}}const Me=Zx(ye,Oe);for(let He=0;He<Me.length;He+=3)this.indexArray.emplaceBack(ce+Me[He],ce+Me[He+2],ce+Me[He+1]),_e.primitiveLength++}for(const ye of le){M&&ye.length&&M.startRing(ye[0]);let Oe,Me,He,lt=ye.length>4&&L2(ye[ye.length-2],ye[0],ye[1]),Ue=ee?tF(ye[ye.length-2],ye[0],ye[1],ee):0;Me=ye[1].sub(ye[0])._perp()._unit();let Qe=!0;for(let Je=1,ot=0;Je<ye.length;Je++){let pt=ye[Je-1],We=ye[Je];const _t=ye[Je===ye.length-1?1:Je+1];if(M&&O&&M.currentPolyCount.top++,F2(We,pt,me)){ee&&(Me=_t.sub(We)._perp()._unit(),Qe=!Qe);continue}M&&M.append(We,pt);const It=We.sub(pt)._perp(),vt=It.x/(Math.abs(It.x)+Math.abs(It.y)),Gt=It.y>0?1:0,ft=pt.dist(We);if(ot+ft>32768&&(ot=0),ee){He=_t.sub(We)._perp()._unit();let qt=O2(pt,We,_t,R2(Me,He),ee);isNaN(qt)&&(qt=0);const Bt=We.sub(pt)._unit();pt=pt.add(Bt.mult(Ue))._round(),We=We.add(Bt.mult(-qt))._round(),Ue=qt,Me=He}const zt=_e.vertexLength,Ht=ye.length>4&&L2(pt,We,_t);let fr=B2(ot,lt,Qe);if(sf(this.layoutVertexArray,pt.x,pt.y,vt,Gt,0,0,fr),sf(this.layoutVertexArray,pt.x,pt.y,vt,Gt,0,1,fr),ot+=ft,fr=B2(ot,Ht,!Qe),lt=Ht,sf(this.layoutVertexArray,We.x,We.y,vt,Gt,0,0,fr),sf(this.layoutVertexArray,We.x,We.y,vt,Gt,0,1,fr),_e.vertexLength+=4,this.indexArray.emplaceBack(zt+0,zt+1,zt+2),this.indexArray.emplaceBack(zt+1,zt+3,zt+2),_e.primitiveLength+=2,ee){const qt=ce+(Je===1?ye.length-2:Je-2),Bt=Je===1?ce:qt+1;if(this.indexArray.emplaceBack(zt+1,qt,zt+3),this.indexArray.emplaceBack(qt,Bt,zt+3),_e.primitiveLength+=2,Oe===void 0&&(Oe=zt),!F2(_t,ye[Je],me)){const Hr=Je===ye.length-1?Oe:_e.vertexLength;this.indexArray.emplaceBack(zt+2,zt+3,Hr),this.indexArray.emplaceBack(zt+3,Hr+1,Hr),this.indexArray.emplaceBack(zt+3,Bt,Hr+1),_e.primitiveLength+=3}Qe=!Qe}if(k){const qt=this.layoutVertexExtArray,Bt=S.projectTilePoint(pt.x,pt.y,p),Hr=S.projectTilePoint(We.x,We.y,p),Zt=S.upVector(p,pt.x,pt.y),Kt=S.upVector(p,We.x,We.y);lf(qt,Bt,Zt),lf(qt,Bt,Zt),lf(qt,Hr,Kt),lf(qt,Hr,Kt)}}O&&(ce+=ye.length-1)}}if(M&&M.polyCount.length>0){if(M.borders){M.vertexArrayOffset=this.centroidVertexArray.length;const le=M.borders,me=this.featuresOnBorder.push(M)-1;for(let ce=0;ce<4;ce++)le[ce][0]!==Number.MAX_VALUE&&this.borders[ce].push(me)}this.encodeCentroid(M.borders?void 0:M.centroid(),M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,m,y,p)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((o,c)=>this.featuresOnBorder[o].borders[r][0]-this.featuresOnBorder[c].borders[r][0])}encodeCentroid(r,o,c=!0){let p,m;if(r)if(r.y!==0){const x=o.span()._mult(this.tileToMeter);p=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(x.x/10)),m=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else p=Math.ceil(7*(r.x+450)),m=0;else p=0,m=+c;let y=c?this.centroidVertexArray.length:o.vertexArrayOffset;for(const x of o.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(y++,p,m);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(y++,0,m),this.centroidVertexArray.emplace(y++,p,m)}}}function R2(i,r){const o=i.add(r)._unit();return i.x*o.x+i.y*o.y}function tF(i,r,o,c){const p=r.sub(i)._perp()._unit(),m=o.sub(r)._perp()._unit();return O2(i,r,o,R2(p,m),c)}function O2(i,r,o,c,p){const m=Math.sqrt(1-c*c);return Math.min(i.dist(r)/3,r.dist(o)/3,p*m/c)}function F2(i,r,o){return i.x<o[0].x&&r.x<o[0].x||i.x>o[1].x&&r.x>o[1].x||i.y<o[0].y&&r.y<o[0].y||i.y>o[1].y&&r.y>o[1].y}function L2(i,r,o){if(i.x<0||i.x>=Ot||r.x<0||r.x>=Ot||o.x<0||o.x>=Ot)return!1;const c=o.sub(r),p=c.perp(),m=i.sub(r);return(c.x*m.x+c.y*m.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(m.x*m.x+m.y*m.y))>-.866&&p.x*m.x+p.y*m.y<0}function B2(i,r,o){const c=r?2|i:-3&i;return o?1|c:-2&c}function N2(){const i=Math.PI/32,r=Math.tan(i),o=tf;return o*Math.sqrt(1+2*r*r)-o}function U2(i,r,o){const c=1<<o.z,p=Po(o.x/c),m=Po((o.x+1)/c),y=hi(o.y/c),x=hi((o.y+1)/c);return function(E,S,k,M,O=0,j){const G=[];if(!E.length||!k||!M)return G;const K=(ye,Oe)=>{for(const Me of ye)G.push({polygon:Me,bounds:Oe})},ee=Math.ceil(Math.log2(k)),le=Math.ceil(Math.log2(M)),me=ee-le,ce=[];for(let ye=0;ye<Math.abs(me);ye++)ce.push(me>0?0:1);for(let ye=0;ye<Math.min(ee,le);ye++)ce.push(0),ce.push(1);let pe=E;if(pe=ag(pe,S[0].y-O,S[1].y+O,1),pe=ag(pe,S[0].x-O,S[1].x+O,0),!pe.length)return G;const _e=[];for(ce.length?_e.push({polygons:pe,bounds:S,depth:0}):K(pe,S);_e.length;){const ye=_e.pop(),Oe=ye.depth,Me=ce[Oe],He=ye.bounds[0],lt=ye.bounds[1],Ue=Me===0?He.x:He.y,Qe=Me===0?lt.x:lt.y,Je=j?j(Me,Ue,Qe):.5*(Ue+Qe),ot=ag(ye.polygons,Ue-O,Je+O,Me),pt=ag(ye.polygons,Je-O,Qe+O,Me);if(ot.length){const We=[He,new xe(Me===0?Je:lt.x,Me===1?Je:lt.y)];ce.length>Oe+1?_e.push({polygons:ot,bounds:We,depth:Oe+1}):K(ot,We)}if(pt.length){const We=[new xe(Me===0?Je:He.x,Me===1?Je:He.y),lt];ce.length>Oe+1?_e.push({polygons:pt,bounds:We,depth:Oe+1}):K(pt,We)}}return G}(i,r,Math.ceil((m-p)/11.25),Math.ceil((y-x)/11.25),1,(E,S,k)=>{if(E===0)return .5*(S+k);{const M=hi((o.y+S/Ot)/c);return(as(.5*(hi((o.y+k/Ot)/c)+M))*c-o.y)*Ot}})}Tt(cf,"FillExtrusionBucket",{omit:["layers","features"]}),Tt(z2,"PartMetadata");const rF=new he({"fill-extrusion-edge-radius":new Z(Ge["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var nF={paint:new he({"fill-extrusion-opacity":new Z(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new re(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Z(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Z(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new re(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new re(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new re(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Z(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Z(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Z(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Z(Ge["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:rF};function j2(i,r,o){var c=2*Math.PI*6378137/256/Math.pow(2,o);return[i*c-2*Math.PI*6378137/2,r*c-2*Math.PI*6378137/2]}class sg{constructor(r,o,c){this.z=r,this.x=o,this.y=c,this.key=uf(0,r,r,o,c)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,o){const c=function(m,y,x){var E=j2(256*m,256*(y=Math.pow(2,x)-y-1),x),S=j2(256*(m+1),256*(y+1),x);return E[0]+","+E[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),p=function(m,y,x){let E,S="";for(let k=m;k>0;k--)E=1<<k-1,S+=(y&E?1:0)+(x&E?2:0);return S}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class V2{constructor(r,o){this.wrap=r,this.canonical=o,this.key=uf(r,o.z,o.z,o.x,o.y)}}class zi{constructor(r,o,c,p,m){this.overscaledZ=r,this.wrap=o,this.canonical=new sg(c,+p,+m),this.key=o===0&&r===c?this.canonical.key:uf(o,r,c,p,m)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const o=this.canonical.z-r;return r>this.canonical.z?new zi(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zi(r,this.wrap,r,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(r,o=!0){if(this.overscaledZ===r&&o)return this.key;if(r>this.canonical.z)return uf(this.wrap*+o,r,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-r;return uf(this.wrap*+o,r,r,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const o=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>o&&r.canonical.y===this.canonical.y>>o}children(r){if(this.overscaledZ>=r)return[new zi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new zi(o,this.wrap,o,c,p),new zi(o,this.wrap,o,c+1,p),new zi(o,this.wrap,o,c,p+1),new zi(o,this.wrap,o,c+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new zi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new zi(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new V2(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function uf(i,r,o,c,p){const m=1<<Math.min(o,22);let y=m*(p%m)+c%m;return i&&o<22&&(y+=m*m*((i<0?-2*i-1:2*i)%(1<<2*(22-o)))),16*(32*y+o)+(r-o)}Tt(sg,"CanonicalTileID"),Tt(zi,"OverscaledTileID",{omit:["projMatrix"]});class Ch extends xe{constructor(r,o,c){super(r,o),this.z=c}}function hf(i,r){return i.x*r.x+i.y*r.y}function $2(i,r){if(i.length===1){let o=0;const c=r[o++];let p;for(;!p||c.equals(p);)if(p=r[o++],!p)return 1/0;for(;o<r.length;o++){const m=r[o],y=i[0],x=p.sub(c),E=m.sub(c),S=y.sub(c),k=hf(x,x),M=hf(x,E),O=hf(E,E),j=hf(S,x),G=hf(S,E),K=k*O-M*M,ee=(O*j-M*G)/K,le=(k*G-M*j)/K,me=c.z*(1-ee-le)+p.z*ee+m.z*le;if(isFinite(me))return me}return 1/0}{let o=1/0;for(const c of r)o=Math.min(o,c.z);return o}}function W2(i,r,o,c,p,m,y,x){const E=y*p.getElevationAt(i,r,!0,!0),S=m[0]!==0,k=S?m[1]===0?y*(m[0]/7-450):y*function(M,O,j){const G=Math.floor(O[0]/8),K=Math.floor(O[1]/8),ee=10*(O[0]-8*G),le=10*(O[1]-8*K),me=M.getElevationAt(G,K,!0,!0),ce=M.getMeterToDEM(j),pe=Math.floor(.5*(ee*ce-1)),_e=Math.floor(.5*(le*ce-1)),ye=M.tileCoordToPixel(G,K),Oe=2*pe+1,Me=2*_e+1,He=function(pt,We,_t,It,vt){return[pt.getElevationAtPixel(We,_t,!0),pt.getElevationAtPixel(We+vt,_t,!0),pt.getElevationAtPixel(We,_t+vt,!0),pt.getElevationAtPixel(We+It,_t+vt,!0)]}(M,ye.x-pe,ye.y-_e,Oe,Me),lt=Math.abs(He[0]-He[1]),Ue=Math.abs(He[2]-He[3]),Qe=Math.abs(He[0]-He[2])+Math.abs(He[1]-He[3]),Je=Math.min(.25,.5*ce*(lt+Ue)/Oe),ot=Math.min(.25,.5*ce*Qe/Me);return me+Math.max(Je*ee,ot*le)}(p,m,x):E;return{base:E+(o===0)?-1:o,top:S?Math.max(k+c,E+o+2):E+c}}const iF=Ie([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:oF}=iF,aF=Ie([{name:"a_packed",components:4,type:"Float32"}]),{members:sF}=aF,lF=og.types,cF=Math.cos(Math.PI/180*37.5);class lg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Ne,this.layoutVertexArray2=new at,this.indexArray=new Pt,this.programConfigurations=new tu(r.layers,r.zoom),this.segments=new xn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(r,o,c,p){this.hasPattern=Xx("line",this.layers,o);const m=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:k,id:M,index:O,sourceLayerIndex:j}of r){const G=this.layers[0]._featureFilter.needGeometry,K=su(k,G);if(!this.layers[0]._featureFilter.filter(new D(this.zoom),K,c))continue;const ee=m?m.evaluate(K,{},c):void 0,le={id:M,properties:k.properties,type:k.type,sourceLayerIndex:j,index:O,geometry:G?K.geometry:Hs(k,c,p),patterns:{},sortKey:ee};y.push(le)}m&&y.sort((k,M)=>k.sortKey-M.sortKey);const{lineAtlas:x,featureIndex:E}=o,S=this.addConstantDashes(x);for(const k of y){const{geometry:M,index:O,sourceLayerIndex:j}=k;if(S&&this.addFeatureDashes(k,x),this.hasPattern){const G=Yx("line",this.layers,k,this.zoom,o);this.patternFeatures.push(G)}else this.addFeature(k,M,O,c,x.positions,o.availableImages);E.insert(r[O].feature,M,O,j,this.index)}}addConstantDashes(r){let o=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if(p.kind!=="constant"||m.kind!=="constant")o=!0;else{const y=m.value,x=p.value;if(!x)continue;r.addDash(x,y)}}return o}addFeatureDashes(r,o){const c=this.zoom;for(const p of this.layers){const m=p.paint.get("line-dasharray").value,y=p.layout.get("line-cap").value;if(m.kind==="constant"&&y.kind==="constant")continue;let x,E;if(m.kind==="constant"){if(x=m.value,!x)continue}else x=m.evaluate({zoom:c},r);E=y.kind==="constant"?y.value:y.evaluate({zoom:c},r),o.addDash(x,E),r.patterns[p.id]=o.getKey(x,E)}}update(r,o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,c,p)}addFeatures(r,o,c,p,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,o,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,sF)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,oF),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,o,c,p,m,y){const x=this.layers[0].layout,E=x.get("line-join").evaluate(r,{}),S=x.get("line-cap").evaluate(r,{}),k=x.get("line-miter-limit"),M=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const O of o)this.addLine(O,r,E,S,k,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,m,y,p)}addLine(r,o,c,p,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<r.length-1;le++)this.totalDistance+=r[le].dist(r[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=lF[o.type]==="Polygon";let E=r.length;for(;E>=2&&r[E-1].equals(r[E-2]);)E--;let S=0;for(;S<E-1&&r[S].equals(r[S+1]);)S++;if(E<(x?3:2))return;c==="bevel"&&(m=1.05);const k=this.overscaling<=16?15*Ot/(512*this.overscaling):0,M=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let O,j,G,K,ee;this.e1=this.e2=-1,x&&(O=r[E-2],ee=r[S].sub(O)._unit()._perp());for(let le=S;le<E;le++){if(G=le===E-1?x?r[S+1]:void 0:r[le+1],G&&r[le].equals(G))continue;ee&&(K=ee),O&&(j=O),O=r[le],ee=G?G.sub(O)._unit()._perp():K,K=K||ee;let me=K.add(ee);me.x===0&&me.y===0||me._unit();const ce=K.x*ee.x+K.y*ee.y,pe=me.x*ee.x+me.y*ee.y,_e=pe!==0?1/pe:1/0,ye=2*Math.sqrt(2-2*pe),Oe=pe<cF&&j&&G,Me=K.x*ee.y-K.y*ee.x>0;if(Oe&&le>S){const Ue=O.dist(j);if(Ue>2*k){const Qe=O.sub(O.sub(j)._mult(k/Ue)._round());this.updateDistance(j,Qe),this.addCurrentVertex(Qe,K,0,0,M),j=Qe}}const He=j&&G;let lt=He?c:x?"butt":p;if(He&&lt==="round"&&(_e<y?lt="miter":_e<=2&&(lt="fakeround")),lt==="miter"&&_e>m&&(lt="bevel"),lt==="bevel"&&(_e>2&&(lt="flipbevel"),_e<m&&(lt="miter")),j&&this.updateDistance(j,O),lt==="miter")me._mult(_e),this.addCurrentVertex(O,me,0,0,M);else if(lt==="flipbevel"){if(_e>100)me=ee.mult(-1);else{const Ue=_e*K.add(ee).mag()/K.sub(ee).mag();me._perp()._mult(Ue*(Me?-1:1))}this.addCurrentVertex(O,me,0,0,M),this.addCurrentVertex(O,me.mult(-1),0,0,M)}else if(lt==="bevel"||lt==="fakeround"){const Ue=-Math.sqrt(_e*_e-1),Qe=Me?Ue:0,Je=Me?0:Ue;if(j&&this.addCurrentVertex(O,K,Qe,Je,M),lt==="fakeround"){const ot=Math.round(180*ye/Math.PI/20);for(let pt=1;pt<ot;pt++){let We=pt/ot;if(We!==.5){const It=We-.5;We+=We*It*(We-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*It*It+(.848013+ce*(.215638*ce-1.06021)))}const _t=ee.sub(K)._mult(We)._add(K)._unit()._mult(Me?-1:1);this.addHalfVertex(O,_t.x,_t.y,!1,Me,0,M)}}G&&this.addCurrentVertex(O,ee,-Qe,-Je,M)}else if(lt==="butt")this.addCurrentVertex(O,me,0,0,M);else if(lt==="square"){const Ue=j?1:-1;j||this.addCurrentVertex(O,me,Ue,Ue,M),this.addCurrentVertex(O,me,0,0,M),j&&this.addCurrentVertex(O,me,Ue,Ue,M)}else lt==="round"&&(j&&(this.addCurrentVertex(O,K,0,0,M),this.addCurrentVertex(O,K,1,1,M,!0)),G&&(this.addCurrentVertex(O,ee,-1,-1,M,!0),this.addCurrentVertex(O,ee,0,0,M)));if(Oe&&le<E-1){const Ue=O.dist(G);if(Ue>2*k){const Qe=O.add(G.sub(O)._mult(k/Ue)._round());this.updateDistance(O,Qe),this.addCurrentVertex(Qe,ee,0,0,M),O=Qe}}}}addCurrentVertex(r,o,c,p,m,y=!1){const x=o.y*p-o.x,E=-o.y-o.x*p;this.addHalfVertex(r,o.x+o.y*c,o.y-o.x*c,y,!1,c,m),this.addHalfVertex(r,x,E,y,!0,-p,m)}addHalfVertex({x:r,y:o},c,p,m,y,x,E){this.layoutVertexArray.emplaceBack((r<<1)+(m?1:0),(o<<1)+(y?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),E.primitiveLength++),y?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,o){this.distance+=r.dist(o),this.updateScaledDistance()}}Tt(lg,"LineBucket",{omit:["layers","patternFeatures"]});const uF=new he({"line-cap":new re(Ge.layout_line["line-cap"]),"line-join":new re(Ge.layout_line["line-join"]),"line-miter-limit":new Z(Ge.layout_line["line-miter-limit"]),"line-round-limit":new Z(Ge.layout_line["line-round-limit"]),"line-sort-key":new re(Ge.layout_line["line-sort-key"])});var G2={paint:new he({"line-opacity":new re(Ge.paint_line["line-opacity"]),"line-color":new re(Ge.paint_line["line-color"]),"line-translate":new Z(Ge.paint_line["line-translate"]),"line-translate-anchor":new Z(Ge.paint_line["line-translate-anchor"]),"line-width":new re(Ge.paint_line["line-width"]),"line-gap-width":new re(Ge.paint_line["line-gap-width"]),"line-offset":new re(Ge.paint_line["line-offset"]),"line-blur":new re(Ge.paint_line["line-blur"]),"line-dasharray":new re(Ge.paint_line["line-dasharray"]),"line-pattern":new re(Ge.paint_line["line-pattern"]),"line-gradient":new ue(Ge.paint_line["line-gradient"]),"line-trim-offset":new Z(Ge.paint_line["line-trim-offset"])}),layout:uF};const H2=new class extends re{possiblyEvaluate(i,r){return r=new D(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(i,r)}evaluate(i,r,o,c){return r=nt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(i,r,o,c)}}(G2.paint.properties["line-width"].specification);function q2(i,r){return r>0?r+2*i:i}H2.useIntegerZoom=!0;const hF=Ie([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),dF=Ie([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),pF=Ie([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ie([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const fF=Ie([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),mF=Ie([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Z2=Ie([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),gF=Ie([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ie([{name:"triangle",components:3,type:"Uint16"}]),Ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ie([{type:"Float32",name:"offsetX"}]),Ie([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ei=24;const Ra=128;function Jx(i,r){const{expression:o}=r;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new D(i+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=o;let m=0;for(;m<c.length&&c[m]<=i;)m++;m=Math.max(0,m-1);let y=m;for(;y<c.length&&c[y]<i+1;)y++;y=Math.min(c.length-1,y);const x=c[m],E=c[y];return o.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:x,maxZoom:E,minSize:o.evaluate(new D(x)),maxSize:o.evaluate(new D(E)),interpolationType:p}}}function cg(i,{uSize:r,uSizeT:o},{lowerSize:c,upperSize:p}){return i.kind==="source"?c/Ra:i.kind==="composite"?dr(c/Ra,p/Ra,o):r}function kh(i,r){let o=0,c=0;if(i.kind==="constant")c=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:m,maxZoom:y}=i,x=p?qe(Yo.interpolationFactor(p,r,m,y),0,1):0;i.kind==="camera"?c=dr(i.minSize,i.maxSize,x):o=x}return{uSizeT:o,uSize:c}}var yF=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ra,evaluateSizeForFeature:cg,evaluateSizeForZoom:kh,getSizeData:Jx});function _F(i,r,o){return i.sections.forEach(c=>{c.text=function(p,m,y){const x=m.layout.get("text-transform").evaluate(y,{});return x==="uppercase"?p=p.toLocaleUpperCase():x==="lowercase"&&(p=p.toLocaleLowerCase()),I.applyArabicShaping&&(p=I.applyArabicShaping(p)),p}(c.text,r,o)}),i}const df={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function vF(i){return i==="︶"||i==="﹈"||i==="︸"||i==="﹄"||i==="﹂"||i==="︾"||i==="︼"||i==="︺"||i==="︘"||i==="﹀"||i==="︐"||i==="︓"||i==="︔"||i==="｀"||i==="￣"||i==="︑"||i==="︒"}function xF(i){return i==="︵"||i==="﹇"||i==="︷"||i==="﹃"||i==="﹁"||i==="︽"||i==="︻"||i==="︹"||i==="︗"||i==="︿"}var K2=jr,X2=function(i,r,o,c,p){var m,y,x=8*p-c-1,E=(1<<x)-1,S=E>>1,k=-7,M=o?p-1:0,O=o?-1:1,j=i[r+M];for(M+=O,m=j&(1<<-k)-1,j>>=-k,k+=x;k>0;m=256*m+i[r+M],M+=O,k-=8);for(y=m&(1<<-k)-1,m>>=-k,k+=c;k>0;y=256*y+i[r+M],M+=O,k-=8);if(m===0)m=1-S;else{if(m===E)return y?NaN:1/0*(j?-1:1);y+=Math.pow(2,c),m-=S}return(j?-1:1)*y*Math.pow(2,m-c)},Y2=function(i,r,o,c,p,m){var y,x,E,S=8*m-p-1,k=(1<<S)-1,M=k>>1,O=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=c?0:m-1,G=c?1:-1,K=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(x=isNaN(r)?1:0,y=k):(y=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-y))<1&&(y--,E*=2),(r+=y+M>=1?O/E:O*Math.pow(2,1-M))*E>=2&&(y++,E/=2),y+M>=k?(x=0,y=k):y+M>=1?(x=(r*E-1)*Math.pow(2,p),y+=M):(x=r*Math.pow(2,M-1)*Math.pow(2,p),y=0));p>=8;i[o+j]=255&x,j+=G,x/=256,p-=8);for(y=y<<p|x,S+=p;S>0;i[o+j]=255&y,j+=G,y/=256,S-=8);i[o+j-G]|=128*K};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function jr(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}jr.Varint=0,jr.Fixed64=1,jr.Bytes=2,jr.Fixed32=5;var e1=4294967296,Q2=1/e1,J2=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Zs(i){return i.type===jr.Bytes?i.readVarint()+i.pos:i.pos+1}function Ph(i,r,o){return o?4294967296*r+(i>>>0):4294967296*(r>>>0)+(i>>>0)}function eI(i,r,o){var c=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));o.realloc(c);for(var p=o.pos-1;p>=i;p--)o.buf[p+c]=o.buf[p]}function bF(i,r){for(var o=0;o<i.length;o++)r.writeVarint(i[o])}function wF(i,r){for(var o=0;o<i.length;o++)r.writeSVarint(i[o])}function EF(i,r){for(var o=0;o<i.length;o++)r.writeFloat(i[o])}function SF(i,r){for(var o=0;o<i.length;o++)r.writeDouble(i[o])}function TF(i,r){for(var o=0;o<i.length;o++)r.writeBoolean(i[o])}function AF(i,r){for(var o=0;o<i.length;o++)r.writeFixed32(i[o])}function IF(i,r){for(var o=0;o<i.length;o++)r.writeSFixed32(i[o])}function CF(i,r){for(var o=0;o<i.length;o++)r.writeFixed64(i[o])}function kF(i,r){for(var o=0;o<i.length;o++)r.writeSFixed64(i[o])}function ug(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16)+16777216*i[r+3]}function Dh(i,r,o){i[o]=r,i[o+1]=r>>>8,i[o+2]=r>>>16,i[o+3]=r>>>24}function tI(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16)+(i[r+3]<<24)}jr.prototype={destroy:function(){this.buf=null},readFields:function(i,r,o){for(o=o||this.length;this.pos<o;){var c=this.readVarint(),p=c>>3,m=this.pos;this.type=7&c,i(p,r,this),this.pos===m&&this.skip(c)}return r},readMessage:function(i,r){return this.readFields(i,r,this.readVarint()+this.pos)},readFixed32:function(){var i=ug(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=tI(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=ug(this.buf,this.pos)+ug(this.buf,this.pos+4)*e1;return this.pos+=8,i},readSFixed64:function(){var i=ug(this.buf,this.pos)+tI(this.buf,this.pos+4)*e1;return this.pos+=8,i},readFloat:function(){var i=X2(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=X2(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var r,o,c=this.buf;return r=127&(o=c[this.pos++]),o<128?r:(r|=(127&(o=c[this.pos++]))<<7,o<128?r:(r|=(127&(o=c[this.pos++]))<<14,o<128?r:(r|=(127&(o=c[this.pos++]))<<21,o<128?r:function(p,m,y){var x,E,S=y.buf;if(x=(112&(E=S[y.pos++]))>>4,E<128||(x|=(127&(E=S[y.pos++]))<<3,E<128)||(x|=(127&(E=S[y.pos++]))<<10,E<128)||(x|=(127&(E=S[y.pos++]))<<17,E<128)||(x|=(127&(E=S[y.pos++]))<<24,E<128)||(x|=(1&(E=S[y.pos++]))<<31,E<128))return Ph(p,x,m);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(o=c[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,r=this.pos;return this.pos=i,i-r>=12&&J2?function(o,c,p){return J2.decode(o.subarray(c,p))}(this.buf,r,i):function(o,c,p){for(var m="",y=c;y<p;){var x,E,S,k=o[y],M=null,O=k>239?4:k>223?3:k>191?2:1;if(y+O>p)break;O===1?k<128&&(M=k):O===2?(192&(x=o[y+1]))==128&&(M=(31&k)<<6|63&x)<=127&&(M=null):O===3?(E=o[y+2],(192&(x=o[y+1]))==128&&(192&E)==128&&((M=(15&k)<<12|(63&x)<<6|63&E)<=2047||M>=55296&&M<=57343)&&(M=null)):O===4&&(E=o[y+2],S=o[y+3],(192&(x=o[y+1]))==128&&(192&E)==128&&(192&S)==128&&((M=(15&k)<<18|(63&x)<<12|(63&E)<<6|63&S)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,O=1):M>65535&&(M-=65536,m+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),m+=String.fromCharCode(M),y+=O}return m}(this.buf,r,i)},readBytes:function(){var i=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,i);return this.pos=i,r},readPackedVarint:function(i,r){if(this.type!==jr.Bytes)return i.push(this.readVarint(r));var o=Zs(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(r));return i},readPackedSVarint:function(i){if(this.type!==jr.Bytes)return i.push(this.readSVarint());var r=Zs(this);for(i=i||[];this.pos<r;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==jr.Bytes)return i.push(this.readBoolean());var r=Zs(this);for(i=i||[];this.pos<r;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==jr.Bytes)return i.push(this.readFloat());var r=Zs(this);for(i=i||[];this.pos<r;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==jr.Bytes)return i.push(this.readDouble());var r=Zs(this);for(i=i||[];this.pos<r;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==jr.Bytes)return i.push(this.readFixed32());var r=Zs(this);for(i=i||[];this.pos<r;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==jr.Bytes)return i.push(this.readSFixed32());var r=Zs(this);for(i=i||[];this.pos<r;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==jr.Bytes)return i.push(this.readFixed64());var r=Zs(this);for(i=i||[];this.pos<r;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==jr.Bytes)return i.push(this.readSFixed64());var r=Zs(this);for(i=i||[];this.pos<r;)i.push(this.readSFixed64());return i},skip:function(i){var r=7&i;if(r===jr.Varint)for(;this.buf[this.pos++]>127;);else if(r===jr.Bytes)this.pos=this.readVarint()+this.pos;else if(r===jr.Fixed32)this.pos+=4;else{if(r!==jr.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(i,r){this.writeVarint(i<<3|r)},realloc:function(i){for(var r=this.length||16;r<this.pos+i;)r*=2;if(r!==this.length){var o=new Uint8Array(r);o.set(this.buf),this.buf=o,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Dh(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Dh(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Dh(this.buf,-1&i,this.pos),Dh(this.buf,Math.floor(i*Q2),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Dh(this.buf,-1&i,this.pos),Dh(this.buf,Math.floor(i*Q2),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(r,o){var c,p;if(r>=0?(c=r%4294967296|0,p=r/4294967296|0):(p=~(-r/4294967296),4294967295^(c=~(-r%4294967296))?c=c+1|0:(c=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(m,y,x){x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7)}(c,0,o),function(m,y){var x=(7&m)<<4;y.buf[y.pos++]|=x|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(p,o)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var r=this.pos;this.pos=function(c,p,m){for(var y,x,E=0;E<p.length;E++){if((y=p.charCodeAt(E))>55295&&y<57344){if(!x){y>56319||E+1===p.length?(c[m++]=239,c[m++]=191,c[m++]=189):x=y;continue}if(y<56320){c[m++]=239,c[m++]=191,c[m++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(c[m++]=239,c[m++]=191,c[m++]=189,x=null);y<128?c[m++]=y:(y<2048?c[m++]=y>>6|192:(y<65536?c[m++]=y>>12|224:(c[m++]=y>>18|240,c[m++]=y>>12&63|128),c[m++]=y>>6&63|128),c[m++]=63&y|128)}return m}(this.buf,i,this.pos);var o=this.pos-r;o>=128&&eI(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),Y2(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Y2(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var r=i.length;this.writeVarint(r),this.realloc(r);for(var o=0;o<r;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,r){this.pos++;var o=this.pos;i(r,this);var c=this.pos-o;c>=128&&eI(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeMessage:function(i,r,o){this.writeTag(i,jr.Bytes),this.writeRawMessage(r,o)},writePackedVarint:function(i,r){r.length&&this.writeMessage(i,bF,r)},writePackedSVarint:function(i,r){r.length&&this.writeMessage(i,wF,r)},writePackedBoolean:function(i,r){r.length&&this.writeMessage(i,TF,r)},writePackedFloat:function(i,r){r.length&&this.writeMessage(i,EF,r)},writePackedDouble:function(i,r){r.length&&this.writeMessage(i,SF,r)},writePackedFixed32:function(i,r){r.length&&this.writeMessage(i,AF,r)},writePackedSFixed32:function(i,r){r.length&&this.writeMessage(i,IF,r)},writePackedFixed64:function(i,r){r.length&&this.writeMessage(i,CF,r)},writePackedSFixed64:function(i,r){r.length&&this.writeMessage(i,kF,r)},writeBytesField:function(i,r){this.writeTag(i,jr.Bytes),this.writeBytes(r)},writeFixed32Field:function(i,r){this.writeTag(i,jr.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(i,r){this.writeTag(i,jr.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(i,r){this.writeTag(i,jr.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(i,r){this.writeTag(i,jr.Fixed64),this.writeSFixed64(r)},writeVarintField:function(i,r){this.writeTag(i,jr.Varint),this.writeVarint(r)},writeSVarintField:function(i,r){this.writeTag(i,jr.Varint),this.writeSVarint(r)},writeStringField:function(i,r){this.writeTag(i,jr.Bytes),this.writeString(r)},writeFloatField:function(i,r){this.writeTag(i,jr.Fixed32),this.writeFloat(r)},writeDoubleField:function(i,r){this.writeTag(i,jr.Fixed64),this.writeDouble(r)},writeBooleanField:function(i,r){this.writeVarintField(i,!!r)}};var hg=F(K2);const t1=3;function PF(i,r,o){r.glyphs=[],i===1&&o.readMessage(DF,r)}function DF(i,r,o){if(i===3){const{id:c,bitmap:p,width:m,height:y,left:x,top:E,advance:S}=o.readMessage(MF,{});r.glyphs.push({id:c,bitmap:new qs({width:m+2*t1,height:y+2*t1},p),metrics:{width:m,height:y,left:x,top:E,advance:S}})}else i===4?r.ascender=o.readSVarint():i===5&&(r.descender=o.readSVarint())}function MF(i,r,o){i===1?r.id=o.readVarint():i===2?r.bitmap=o.readBytes():i===3?r.width=o.readVarint():i===4?r.height=o.readVarint():i===5?r.left=o.readSVarint():i===6?r.top=o.readSVarint():i===7&&(r.advance=o.readVarint())}const rI=t1;function r1(i){let r=0,o=0;for(const y of i)r+=y.w*y.h,o=Math.max(o,y.w);i.sort((y,x)=>x.h-y.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),o),h:1/0}];let p=0,m=0;for(const y of i)for(let x=c.length-1;x>=0;x--){const E=c[x];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,m=Math.max(m,y.y+y.h),p=Math.max(p,y.x+y.w),y.w===E.w&&y.h===E.h){const S=c.pop();x<c.length&&(c[x]=S)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(c.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:p,h:m,fill:r/(p*m)||0}}const Ki=1;class n1{constructor(r,{pixelRatio:o,version:c,stretchX:p,stretchY:m,content:y}){this.paddedRect=r,this.pixelRatio=o,this.stretchX=p,this.stretchY=m,this.content=y,this.version=c}get tl(){return[this.paddedRect.x+Ki,this.paddedRect.y+Ki]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ki,this.paddedRect.y+this.paddedRect.h-Ki]}get displaySize(){return[(this.paddedRect.w-2*Ki)/this.pixelRatio,(this.paddedRect.h-2*Ki)/this.pixelRatio]}}class nI{constructor(r,o){const c={},p={};this.haveRenderCallbacks=[];const m=[];this.addImages(r,c,m),this.addImages(o,p,m);const{w:y,h:x}=r1(m),E=new lo({width:y||1,height:x||1});for(const S in r){const k=r[S],M=c[S].paddedRect;lo.copy(k.data,E,{x:0,y:0},{x:M.x+Ki,y:M.y+Ki},k.data)}for(const S in o){const k=o[S],M=p[S].paddedRect,O=M.x+Ki,j=M.y+Ki,G=k.data.width,K=k.data.height;lo.copy(k.data,E,{x:0,y:0},{x:O,y:j},k.data),lo.copy(k.data,E,{x:0,y:K-1},{x:O,y:j-1},{width:G,height:1}),lo.copy(k.data,E,{x:0,y:0},{x:O,y:j+K},{width:G,height:1}),lo.copy(k.data,E,{x:G-1,y:0},{x:O-1,y:j},{width:1,height:K}),lo.copy(k.data,E,{x:0,y:0},{x:O+G,y:j},{width:1,height:K})}this.image=E,this.iconPositions=c,this.patternPositions=p}addImages(r,o,c){for(const p in r){const m=r[p],y={x:0,y:0,w:m.data.width+2*Ki,h:m.data.height+2*Ki};c.push(y),o[p]=new n1(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(r,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>r.hasImage(c)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in r.updatedImages)this.patchUpdatedImage(this.iconPositions[c],r.getImage(c),o),this.patchUpdatedImage(this.patternPositions[c],r.getImage(c),o)}patchUpdatedImage(r,o,c){if(!r||!o||r.version===o.version)return;r.version=o.version;const[p,m]=r.tl;c.update(o.data,void 0,{x:p,y:m})}}Tt(n1,"ImagePosition"),Tt(nI,"ImageAtlas");const Do={horizontal:1,vertical:2,horizontalOnly:3},iI=-17;class pf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,o){const c=new pf;return c.scale=r||1,c.fontStack=o,c}static forImage(r){const o=new pf;return o.imageName=r,o}}class Mh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,o){const c=new Mh;for(let p=0;p<r.sections.length;p++){const m=r.sections[p];m.image?c.addImageSection(m):c.addTextSection(m,o)}return c}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(o,c){let p="";for(let m=0;m<o.length;m++){const y=o.charCodeAt(m+1)||null,x=o.charCodeAt(m-1)||null;p+=!c&&(y&&U0(y)&&!df[o[m+1]]||x&&U0(x)&&!df[o[m-1]])||!df[o[m]]?o[m]:df[o[m]]}return p}(this.text,r)}trim(){let r=0;for(let c=0;c<this.text.length&&dg[this.text.charCodeAt(c)];c++)r++;let o=this.text.length;for(let c=this.text.length-1;c>=0&&c>=r&&dg[this.text.charCodeAt(c)];c--)o--;this.text=this.text.substring(r,o),this.sectionIndex=this.sectionIndex.slice(r,o)}substring(r,o){const c=new Mh;return c.text=this.text.substring(r,o),c.sectionIndex=this.sectionIndex.slice(r,o),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,o)=>Math.max(r,this.sections[o].scale),0)}addTextSection(r,o){this.text+=r.text,this.sections.push(pf.forText(r.scale,r.fontStack||o));const c=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(c)}addImageSection(r){const o=r.image?r.image.name:"";if(o.length===0)return void Tr("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(pf.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Tr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function i1(i,r,o,c,p,m,y,x,E,S,k,M,O,j,G){const K=Mh.fromFeature(i,p);M===Do.vertical&&K.verticalizePunctuation(O);let ee=[];const le=function(ye,Oe,Me,He,lt,Ue){if(!ye)return[];const Qe=[],Je=function(_t,It,vt,Gt,ft,zt){let Ht=0;for(let fr=0;fr<_t.length();fr++){const qt=_t.getSection(fr);Ht+=oI(_t.getCharCode(fr),qt,Gt,ft,It,zt)}return Ht/Math.max(1,Math.ceil(Ht/vt))}(ye,Oe,Me,He,lt,Ue),ot=ye.text.indexOf("​")>=0;let pt=0;for(let _t=0;_t<ye.length();_t++){const It=ye.getSection(_t),vt=ye.getCharCode(_t);if(dg[vt]||(pt+=oI(vt,It,He,lt,Oe,Ue)),_t<ye.length()-1){const Gt=!((We=vt)<11904||!(xt["Bopomofo Extended"](We)||xt.Bopomofo(We)||xt["CJK Compatibility Forms"](We)||xt["CJK Compatibility Ideographs"](We)||xt["CJK Compatibility"](We)||xt["CJK Radicals Supplement"](We)||xt["CJK Strokes"](We)||xt["CJK Symbols and Punctuation"](We)||xt["CJK Unified Ideographs Extension A"](We)||xt["CJK Unified Ideographs"](We)||xt["Enclosed CJK Letters and Months"](We)||xt["Halfwidth and Fullwidth Forms"](We)||xt.Hiragana(We)||xt["Ideographic Description Characters"](We)||xt["Kangxi Radicals"](We)||xt["Katakana Phonetic Extensions"](We)||xt.Katakana(We)||xt["Vertical Forms"](We)||xt["Yi Radicals"](We)||xt["Yi Syllables"](We)));(zF[vt]||Gt||It.imageName)&&Qe.push(sI(_t+1,pt,Je,Qe,RF(vt,ye.getCharCode(_t+1),Gt&&ot),!1))}}var We;return lI(sI(ye.length(),pt,Je,Qe,0,!0))}(K,S,m,r,c,j),{processBidirectionalText:me,processStyledBidirectionalText:ce}=I;if(me&&K.sections.length===1){const ye=me(K.toString(),le);for(const Oe of ye){const Me=new Mh;Me.text=Oe,Me.sections=K.sections;for(let He=0;He<Oe.length;He++)Me.sectionIndex.push(0);ee.push(Me)}}else if(ce){const ye=ce(K.text,K.sectionIndex,le);for(const Oe of ye){const Me=new Mh;Me.text=Oe[0],Me.sectionIndex=Oe[1],Me.sections=K.sections,ee.push(Me)}}else ee=function(ye,Oe){const Me=[],He=ye.text;let lt=0;for(const Ue of Oe)Me.push(ye.substring(lt,Ue)),lt=Ue;return lt<He.length&&Me.push(ye.substring(lt,He.length)),Me}(K,le);const pe=[],_e={positionedLines:pe,text:K.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ye,Oe,Me,He,lt,Ue,Qe,Je,ot,pt,We,_t){let It=0,vt=0,Gt=0;const ft=Je==="right"?1:Je==="left"?0:.5;let zt=!1;for(const Zt of lt){const Kt=Zt.getSections();for(const Lr of Kt){if(Lr.imageName)continue;const Vr=Oe[Lr.fontStack];if(Vr&&(zt=Vr.ascender!==void 0&&Vr.descender!==void 0,!zt))break}if(!zt)break}let Ht=0;for(const Zt of lt){Zt.trim();const Kt=Zt.getMaxScale(),Lr=(Kt-1)*ei,Vr={positionedGlyphs:[],lineOffset:0};ye.positionedLines[Ht]=Vr;const $r=Vr.positionedGlyphs;let Br=0;if(!Zt.length()){vt+=Ue,++Ht;continue}let tn=0,cn=0;for(let Nr=0;Nr<Zt.length();Nr++){const Rn=Zt.getSection(Nr),En=Zt.getSectionIndex(Nr),nn=Zt.getCharCode(Nr);let yr=Rn.scale,Sn=null,Wr=null,Ri=null,Tn=ei,ti=0;const Hn=!(ot===Do.horizontal||!We&&!Np(nn)||We&&(dg[nn]||(fr=nn,xt.Arabic(fr)||xt["Arabic Supplement"](fr)||xt["Arabic Extended-A"](fr)||xt["Arabic Presentation Forms-A"](fr)||xt["Arabic Presentation Forms-B"](fr))));if(Rn.imageName){const Oi=He[Rn.imageName];if(!Oi)continue;Ri=Rn.imageName,ye.iconsInText=ye.iconsInText||!0,Wr=Oi.paddedRect;const qn=Oi.displaySize;yr=yr*ei/_t,Sn={width:qn[0],height:qn[1],left:Ki,top:-rI,advance:Hn?qn[1]:qn[0],localGlyph:!1},ti=zt?-Sn.height*yr:iI+Kt*ei-qn[1]*yr,Tn=Sn.advance;const La=(Hn?qn[0]:qn[1])*yr-ei*Kt;La>0&&La>Br&&(Br=La)}else{const Oi=Me[Rn.fontStack];if(!Oi)continue;Oi[nn]&&(Wr=Oi[nn]);const qn=Oe[Rn.fontStack];if(!qn)continue;const La=qn.glyphs[nn];if(!La)continue;if(Sn=La.metrics,Tn=nn!==8203?ei:0,zt){const Nh=qn.ascender!==void 0?Math.abs(qn.ascender):0,Ef=qn.descender!==void 0?Math.abs(qn.descender):0,Sf=(Nh+Ef)*yr;tn<Sf&&(tn=Sf,cn=(Nh-Ef)/2*yr),ti=-Nh*yr}else ti=iI+(Kt-yr)*ei}Hn?(ye.verticalizable=!0,$r.push({glyph:nn,imageName:Ri,x:It,y:vt+ti,vertical:Hn,scale:yr,localGlyph:Sn.localGlyph,fontStack:Rn.fontStack,sectionIndex:En,metrics:Sn,rect:Wr}),It+=Tn*yr+pt):($r.push({glyph:nn,imageName:Ri,x:It,y:vt+ti,vertical:Hn,scale:yr,localGlyph:Sn.localGlyph,fontStack:Rn.fontStack,sectionIndex:En,metrics:Sn,rect:Wr}),It+=Sn.advance*yr+pt)}$r.length!==0&&(Gt=Math.max(It-pt,Gt),zt?cI($r,ft,Br,cn,Ue*Kt/2):cI($r,ft,Br,0,Ue/2)),It=0;const wn=Ue*Kt+Br;Vr.lineOffset=Math.max(Br,Lr),vt+=wn,++Ht}var fr;const qt=vt,{horizontalAlign:Bt,verticalAlign:Hr}=o1(Qe);(function(Zt,Kt,Lr,Vr,$r,Br){const tn=(Kt-Lr)*$r,cn=-Br*Vr;for(const wn of Zt)for(const Nr of wn.positionedGlyphs)Nr.x+=tn,Nr.y+=cn})(ye.positionedLines,ft,Bt,Hr,Gt,qt),ye.top+=-Hr*qt,ye.bottom=ye.top+qt,ye.left+=-Bt*Gt,ye.right=ye.left+Gt,ye.hasBaseline=zt}(_e,r,o,c,ee,y,x,E,M,S,O,G),!function(ye){for(const Oe of ye)if(Oe.positionedGlyphs.length!==0)return!1;return!0}(pe)&&_e}const dg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zF={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function oI(i,r,o,c,p,m){if(r.imageName){const y=c[r.imageName];return y?y.displaySize[0]*r.scale*ei/m+p:0}{const y=o[r.fontStack],x=y&&y.glyphs[i];return x?x.metrics.advance*r.scale+p:0}}function aI(i,r,o,c){const p=Math.pow(i-r,2);return c?i<r?p/2:2*p:p+Math.abs(o)*o}function RF(i,r,o){let c=0;return i===10&&(c-=1e4),o&&(c+=150),i!==40&&i!==65288||(c+=50),r!==41&&r!==65289||(c+=50),c}function sI(i,r,o,c,p,m){let y=null,x=aI(r,o,p,m);for(const E of c){const S=aI(r-E.x,o,p,m)+E.badness;S<=x&&(y=E,x=S)}return{index:i,x:r,priorBreak:y,badness:x}}function lI(i){return i?lI(i.priorBreak).concat(i.index):[]}function o1(i){let r=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:r,verticalAlign:o}}function cI(i,r,o,c,p){if(!(r||o||c||p))return;const m=i.length-1,y=i[m],x=(y.x+y.metrics.advance*y.scale)*r;for(let E=0;E<=m;E++)i[E].x-=x,i[E].y+=o+c+p}function OF(i,r,o){const{horizontalAlign:c,verticalAlign:p}=o1(o),m=r[0]-i.displaySize[0]*c,y=r[1]-i.displaySize[1]*p;return{image:i,top:y,bottom:y+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function uI(i,r,o,c,p,m){const y=i.image;let x;if(y.content){const ee=y.content,le=y.pixelRatio||1;x=[ee[0]/le,ee[1]/le,y.displaySize[0]-ee[2]/le,y.displaySize[1]-ee[3]/le]}const E=r.left*m,S=r.right*m;let k,M,O,j;o==="width"||o==="both"?(j=p[0]+E-c[3],M=p[0]+S+c[1]):(j=p[0]+(E+S-y.displaySize[0])/2,M=j+y.displaySize[0]);const G=r.top*m,K=r.bottom*m;return o==="height"||o==="both"?(k=p[1]+G-c[0],O=p[1]+K+c[2]):(k=p[1]+(G+K-y.displaySize[1])/2,O=k+y.displaySize[1]),{image:y,top:k,right:M,bottom:O,left:j,collisionPadding:x}}class Ks extends xe{constructor(r,o,c,p,m){super(r,o),this.angle=p,this.z=c,m!==void 0&&(this.segment=m)}clone(){return new Ks(this.x,this.y,this.z,this.angle,this.segment)}}function hI(i,r,o,c,p){if(r.segment===void 0)return!0;let m=r,y=r.segment+1,x=0;for(;x>-o/2;){if(y--,y<0)return!1;x-=i[y].dist(m),m=i[y]}x+=i[y].dist(i[y+1]),y++;const E=[];let S=0;for(;x<o/2;){const k=i[y],M=i[y+1];if(!M)return!1;let O=i[y-1].angleTo(k)-k.angleTo(M);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:O}),S+=O;x-E[0].distance>c;)S-=E.shift().angleDelta;if(S>p)return!1;y++,x+=k.dist(M)}return!0}function dI(i){let r=0;for(let o=0;o<i.length-1;o++)r+=i[o].dist(i[o+1]);return r}function pI(i,r,o){return i?.6*r*o:0}function fI(i,r){return Math.max(i?i.right-i.left:0,r?r.right-r.left:0)}function FF(i,r,o,c,p,m){const y=pI(o,p,m),x=fI(o,c)*m;let E=0;const S=dI(i)/2;for(let k=0;k<i.length-1;k++){const M=i[k],O=i[k+1],j=M.dist(O);if(E+j>S){const G=(S-E)/j,K=dr(M.x,O.x,G),ee=dr(M.y,O.y,G),le=new Ks(K,ee,0,O.angleTo(M),k);return!y||hI(i,le,x,y,r)?le:void 0}E+=j}}function LF(i,r,o,c,p,m,y,x,E){const S=pI(c,m,y),k=fI(c,p),M=k*y,O=i[0].x===0||i[0].x===E||i[0].y===0||i[0].y===E;return r-M<r/4&&(r=M+r/4),mI(i,O?r/2*x%r:(k/2+2*m)*y*x%r,r,S,o,M,O,!1,E)}function mI(i,r,o,c,p,m,y,x,E){const S=m/2,k=dI(i);let M=0,O=r-o,j=[];for(let G=0;G<i.length-1;G++){const K=i[G],ee=i[G+1],le=K.dist(ee),me=ee.angleTo(K);for(;O+o<M+le;){O+=o;const ce=(O-M)/le,pe=dr(K.x,ee.x,ce),_e=dr(K.y,ee.y,ce);if(pe>=0&&pe<E&&_e>=0&&_e<E&&O-S>=0&&O+S<=k){const ye=new Ks(pe,_e,0,me,G);ye._round(),c&&!hI(i,ye,m,c,p)||j.push(ye)}}M+=le}return x||j.length||y||(j=mI(i,M/2,o,c,p,m,y,!0,E)),j}function gI(i,r,o,c,p){const m=[];for(let y=0;y<i.length;y++){const x=i[y];let E;for(let S=0;S<x.length-1;S++){let k=x[S],M=x[S+1];k.x<r&&M.x<r||(k.x<r?k=new xe(r,k.y+(r-k.x)/(M.x-k.x)*(M.y-k.y))._round():M.x<r&&(M=new xe(r,k.y+(r-k.x)/(M.x-k.x)*(M.y-k.y))._round()),k.y<o&&M.y<o||(k.y<o?k=new xe(k.x+(o-k.y)/(M.y-k.y)*(M.x-k.x),o)._round():M.y<o&&(M=new xe(k.x+(o-k.y)/(M.y-k.y)*(M.x-k.x),o)._round()),k.x>=c&&M.x>=c||(k.x>=c?k=new xe(c,k.y+(c-k.x)/(M.x-k.x)*(M.y-k.y))._round():M.x>=c&&(M=new xe(c,k.y+(c-k.x)/(M.x-k.x)*(M.y-k.y))._round()),k.y>=p&&M.y>=p||(k.y>=p?k=new xe(k.x+(p-k.y)/(M.y-k.y)*(M.x-k.x),p)._round():M.y>=p&&(M=new xe(k.x+(p-k.y)/(M.y-k.y)*(M.x-k.x),p)._round()),E&&k.equals(E[E.length-1])||(E=[k],m.push(E)),E.push(M)))))}}return m}Tt(Ks,"Anchor");const ff=1e20;function yI(i,r,o,c,p,m,y,x,E){for(let S=r;S<r+c;S++)_I(i,o*m+S,m,p,y,x,E);for(let S=o;S<o+p;S++)_I(i,S*m+r,1,c,y,x,E)}function _I(i,r,o,c,p,m,y){m[0]=0,y[0]=-ff,y[1]=ff,p[0]=i[r];for(let x=1,E=0,S=0;x<c;x++){p[x]=i[r+x*o];const k=x*x;do{const M=m[E];S=(p[x]-p[M]+k-M*M)/(x-M)/2}while(S<=y[E]&&--E>-1);E++,m[E]=x,y[E]=S,y[E+1]=ff}for(let x=0,E=0;x<c;x++){for(;y[E+1]<x;)E++;const S=m[E],k=x-S;i[r+x*o]=p[S]+k*k}}const Oa=2,a1={none:0,ideographs:1,all:2};class zh{constructor(r,o,c){this.requestManager=r,this.localGlyphMode=o,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,o){const c=[];for(const p in r)for(const m of r[p])c.push({stack:p,id:m});je(c,({stack:p,id:m},y)=>{let x=this.entries[p];x||(x=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[m];if(E!==void 0)return void y(null,{stack:p,id:m,glyph:E});if(E=this._tinySDF(x,p,m),E)return x.glyphs[m]=E,void y(null,{stack:p,id:m,glyph:E});const S=Math.floor(m/256);if(256*S>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[S])return void y(null,{stack:p,id:m,glyph:E});let k=x.requests[S];k||(k=x.requests[S]=[],zh.loadGlyphRange(p,S,this.url,this.requestManager,(M,O)=>{if(O){x.ascender=O.ascender,x.descender=O.descender;for(const j in O.glyphs)this._doesCharSupportLocalGlyph(+j)||(x.glyphs[+j]=O.glyphs[+j]);x.ranges[S]=!0}for(const j of k)j(M,O);delete x.requests[S]})),k.push((M,O)=>{M?y(M):O&&y(null,{stack:p,id:m,glyph:O.glyphs[m]||null})})},(p,m)=>{if(p)o(p);else if(m){const y={};for(const{stack:x,id:E,glyph:S}of m)y[x]===void 0&&(y[x]={}),y[x].glyphs===void 0&&(y[x].glyphs={}),y[x].glyphs[E]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;o(null,y)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==a1.none&&(this.localGlyphMode===a1.all?!!this.localFontFamily:!!this.localFontFamily&&(xt["CJK Unified Ideographs"](r)||xt["Hangul Syllables"](r)||xt.Hiragana(r)||xt.Katakana(r)||xt["CJK Symbols and Punctuation"](r)))}_tinySDF(r,o,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let m=r.tinySDF;if(!m){let K="400";/bold/i.test(o)?K="900":/medium/i.test(o)?K="500":/light/i.test(o)&&(K="200"),m=r.tinySDF=new zh.TinySDF({fontFamily:p,fontWeight:K,fontSize:24*Oa,buffer:3*Oa,radius:8*Oa}),m.fontWeight=K}if(this.localGlyphs[m.fontWeight][c])return this.localGlyphs[m.fontWeight][c];const y=String.fromCharCode(c),{data:x,width:E,height:S,glyphWidth:k,glyphHeight:M,glyphLeft:O,glyphTop:j,glyphAdvance:G}=m.draw(y);return this.localGlyphs[m.fontWeight][c]={id:c,bitmap:new qs({width:E,height:S},x),metrics:{width:k/Oa,height:M/Oa,left:O/Oa,top:j/Oa-27,advance:G/Oa,localGlyph:!0}}}}zh.loadGlyphRange=function(i,r,o,c,p){const m=256*r,y=m+255,x=c.transformRequest(c.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",`${m}-${y}`),ga.Glyphs);Ja(x,(E,S)=>{if(E)p(E);else if(S){const k={},M=function(O){return new hg(O).readFields(PF,{})}(S);for(const O of M.glyphs)k[O.id]=O;p(null,{glyphs:k,ascender:M.ascender,descender:M.descender})}})},zh.TinySDF=class{constructor({fontSize:i=24,buffer:r=3,radius:o=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=r,this.cutoff=c,this.radius=o;const x=this.size=i+4*r,E=this._createCanvas(x),S=this.ctx=E.getContext("2d",{willReadFrequently:!0});S.font=`${y} ${m} ${i}px ${p}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(i){const r=document.createElement("canvas");return r.width=r.height=i,r}draw(i){const{width:r,actualBoundingBoxAscent:o,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:m}=this.ctx.measureText(i),y=Math.ceil(o),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-p))),E=Math.min(this.size-this.buffer,y+Math.ceil(c)),S=x+2*this.buffer,k=E+2*this.buffer,M=Math.max(S*k,0),O=new Uint8ClampedArray(M),j={data:O,width:S,height:k,glyphWidth:x,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(x===0||E===0)return j;const{ctx:G,buffer:K,gridInner:ee,gridOuter:le}=this;G.clearRect(K,K,x,E),G.fillText(i,K,K+y);const me=G.getImageData(K,K,x,E);le.fill(ff,0,M),ee.fill(0,0,M);for(let ce=0;ce<E;ce++)for(let pe=0;pe<x;pe++){const _e=me.data[4*(ce*x+pe)+3]/255;if(_e===0)continue;const ye=(ce+K)*S+pe+K;if(_e===1)le[ye]=0,ee[ye]=ff;else{const Oe=.5-_e;le[ye]=Oe>0?Oe*Oe:0,ee[ye]=Oe<0?Oe*Oe:0}}yI(le,0,0,S,k,S,this.f,this.v,this.z),yI(ee,K,K,x,E,S,this.f,this.v,this.z);for(let ce=0;ce<M;ce++){const pe=Math.sqrt(le[ce])-Math.sqrt(ee[ce]);O[ce]=Math.round(255-255*(pe/this.radius+this.cutoff))}return j}};const Rh=Ki;function vI(i,r,o,c){const p=[],m=i.image,y=m.pixelRatio,x=m.paddedRect.w-2*Rh,E=m.paddedRect.h-2*Rh,S=i.right-i.left,k=i.bottom-i.top,M=m.stretchX||[[0,x]],O=m.stretchY||[[0,E]],j=(Ue,Qe)=>Ue+Qe[1]-Qe[0],G=M.reduce(j,0),K=O.reduce(j,0),ee=x-G,le=E-K;let me=0,ce=G,pe=0,_e=K,ye=0,Oe=ee,Me=0,He=le;if(m.content&&c){const Ue=m.content;me=pg(M,0,Ue[0]),pe=pg(O,0,Ue[1]),ce=pg(M,Ue[0],Ue[2]),_e=pg(O,Ue[1],Ue[3]),ye=Ue[0]-me,Me=Ue[1]-pe,Oe=Ue[2]-Ue[0]-ce,He=Ue[3]-Ue[1]-_e}const lt=(Ue,Qe,Je,ot)=>{const pt=fg(Ue.stretch-me,ce,S,i.left),We=mg(Ue.fixed-ye,Oe,Ue.stretch,G),_t=fg(Qe.stretch-pe,_e,k,i.top),It=mg(Qe.fixed-Me,He,Qe.stretch,K),vt=fg(Je.stretch-me,ce,S,i.left),Gt=mg(Je.fixed-ye,Oe,Je.stretch,G),ft=fg(ot.stretch-pe,_e,k,i.top),zt=mg(ot.fixed-Me,He,ot.stretch,K),Ht=new xe(pt,_t),fr=new xe(vt,_t),qt=new xe(vt,ft),Bt=new xe(pt,ft),Hr=new xe(We/y,It/y),Zt=new xe(Gt/y,zt/y),Kt=r*Math.PI/180;if(Kt){const $r=Math.sin(Kt),Br=Math.cos(Kt),tn=[Br,-$r,$r,Br];Ht._matMult(tn),fr._matMult(tn),Bt._matMult(tn),qt._matMult(tn)}const Lr=Ue.stretch+Ue.fixed,Vr=Qe.stretch+Qe.fixed;return{tl:Ht,tr:fr,bl:Bt,br:qt,tex:{x:m.paddedRect.x+Rh+Lr,y:m.paddedRect.y+Rh+Vr,w:Je.stretch+Je.fixed-Lr,h:ot.stretch+ot.fixed-Vr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hr,pixelOffsetBR:Zt,minFontScaleX:Oe/y/S,minFontScaleY:He/y/k,isSDF:o}};if(c&&(m.stretchX||m.stretchY)){const Ue=xI(M,ee,G),Qe=xI(O,le,K);for(let Je=0;Je<Ue.length-1;Je++){const ot=Ue[Je],pt=Ue[Je+1];for(let We=0;We<Qe.length-1;We++)p.push(lt(ot,Qe[We],pt,Qe[We+1]))}}else p.push(lt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return p}function pg(i,r,o){let c=0;for(const p of i)c+=Math.max(r,Math.min(o,p[1]))-Math.max(r,Math.min(o,p[0]));return c}function xI(i,r,o){const c=[{fixed:-Rh,stretch:0}];for(const[p,m]of i){const y=c[c.length-1];c.push({fixed:p-y.stretch,stretch:y.stretch}),c.push({fixed:p-y.stretch,stretch:y.stretch+(m-p)})}return c.push({fixed:r+Rh,stretch:o}),c}function fg(i,r,o,c){return i/r*o+c}function mg(i,r,o,c){return i-r*o/c}function BF(i,r,o,c){const p=r+i.positionedLines[c].lineOffset;return c===0?o+p/2:o+(p+(r+i.positionedLines[c-1].lineOffset))/2}class NF{constructor(r=[],o=UF){if(this.data=r,this.length=this.data.length,this.compare=o,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:o,compare:c}=this,p=o[r];for(;r>0;){const m=r-1>>1,y=o[m];if(c(p,y)>=0)break;o[r]=y,r=m}o[r]=p}_down(r){const{data:o,compare:c}=this,p=this.length>>1,m=o[r];for(;r<p;){let y=1+(r<<1),x=o[y];const E=y+1;if(E<this.length&&c(o[E],x)<0&&(y=E,x=o[E]),c(x,m)>=0)break;o[r]=x,r=y}o[r]=m}}function UF(i,r){return i<r?-1:i>r?1:0}function jF(i,r=1,o=!1){let c=1/0,p=1/0,m=-1/0,y=-1/0;const x=i[0];for(let j=0;j<x.length;j++){const G=x[j];(!j||G.x<c)&&(c=G.x),(!j||G.y<p)&&(p=G.y),(!j||G.x>m)&&(m=G.x),(!j||G.y>y)&&(y=G.y)}const E=Math.min(m-c,y-p);let S=E/2;const k=new NF([],VF);if(E===0)return new xe(c,p);for(let j=c;j<m;j+=E)for(let G=p;G<y;G+=E)k.push(new Oh(j+S,G+S,S,i));let M=function(j){let G=0,K=0,ee=0;const le=j[0];for(let me=0,ce=le.length,pe=ce-1;me<ce;pe=me++){const _e=le[me],ye=le[pe],Oe=_e.x*ye.y-ye.x*_e.y;K+=(_e.x+ye.x)*Oe,ee+=(_e.y+ye.y)*Oe,G+=3*Oe}return new Oh(K/G,ee/G,0,j)}(i),O=k.length;for(;k.length;){const j=k.pop();(j.d>M.d||!M.d)&&(M=j,o&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,O)),j.max-M.d<=r||(S=j.h/2,k.push(new Oh(j.p.x-S,j.p.y-S,S,i)),k.push(new Oh(j.p.x+S,j.p.y-S,S,i)),k.push(new Oh(j.p.x-S,j.p.y+S,S,i)),k.push(new Oh(j.p.x+S,j.p.y+S,S,i)),O+=4)}return o&&(console.log(`num probes: ${O}`),console.log(`best distance: ${M.d}`)),M.p}function VF(i,r){return r.max-i.max}class Oh{constructor(r,o,c,p){this.p=new xe(r,o),this.h=c,this.d=function(m,y){let x=!1,E=1/0;for(let S=0;S<y.length;S++){const k=y[S];for(let M=0,O=k.length,j=O-1;M<O;j=M++){const G=k[M],K=k[j];G.y>m.y!=K.y>m.y&&m.x<(K.x-G.x)*(m.y-G.y)/(K.y-G.y)+G.x&&(x=!x),E=Math.min(E,m2(m,G,K))}}return(x?1:-1)*Math.sqrt(E)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Fh=7,s1=Number.POSITIVE_INFINITY,$F=Math.sqrt(2);function bI(i,[r,o]){let c=0,p=0;if(o===s1){r<0&&(r=0);const m=r/$F;switch(i){case"top-right":case"top-left":p=m-Fh;break;case"bottom-right":case"bottom-left":p=-m+Fh;break;case"bottom":p=-r+Fh;break;case"top":p=r-Fh}switch(i){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=r;break;case"right":c=-r}}else{switch(r=Math.abs(r),o=Math.abs(o),i){case"top-right":case"top-left":case"top":p=o-Fh;break;case"bottom-right":case"bottom-left":case"bottom":p=-o+Fh}switch(i){case"top-right":case"bottom-right":case"right":c=-r;break;case"top-left":case"bottom-left":case"left":c=r}}return[c,p]}function WF(i,r,o,c,p,m,y,x,E,S){i.createArrays(),i.tilePixelRatio=Ot/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const k=i.layers[0].layout,M=i.layers[0]._unevaluatedLayout._values,O={};if(i.textSizeData.kind==="composite"){const{minZoom:K,maxZoom:ee}=i.textSizeData;O.compositeTextSizes=[M["text-size"].possiblyEvaluate(new D(K),x),M["text-size"].possiblyEvaluate(new D(ee),x)]}if(i.iconSizeData.kind==="composite"){const{minZoom:K,maxZoom:ee}=i.iconSizeData;O.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new D(K),x),M["icon-size"].possiblyEvaluate(new D(ee),x)]}O.layoutTextSize=M["text-size"].possiblyEvaluate(new D(E+1),x),O.layoutIconSize=M["icon-size"].possiblyEvaluate(new D(E+1),x),O.textMaxSize=M["text-size"].possiblyEvaluate(new D(18),x);const j=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",G=k.get("text-size");for(const K of i.features){const ee=k.get("text-font").evaluate(K,{},x).join(","),le=G.evaluate(K,{},x),me=O.layoutTextSize.evaluate(K,{},x),ce=(O.layoutIconSize.evaluate(K,{},x),{horizontal:{},vertical:void 0}),pe=K.text;let _e,ye=[0,0];if(pe){const He=pe.toString(),lt=k.get("text-letter-spacing").evaluate(K,{},x)*ei,Ue=k.get("text-line-height").evaluate(K,{},x)*ei,Qe=gx(He)?lt:0,Je=k.get("text-anchor").evaluate(K,{},x),ot=k.get("text-variable-anchor");if(!ot){const vt=k.get("text-radial-offset").evaluate(K,{},x);ye=vt?bI(Je,[vt*ei,s1]):k.get("text-offset").evaluate(K,{},x).map(Gt=>Gt*ei)}let pt=j?"center":k.get("text-justify").evaluate(K,{},x);const We=k.get("symbol-placement")==="point",_t=We?k.get("text-max-width").evaluate(K,{},x)*ei:1/0,It=vt=>{i.allowVerticalPlacement&&Bp(He)&&(ce.vertical=i1(pe,r,o,p,ee,_t,Ue,Je,vt,Qe,ye,Do.vertical,!0,me,le))};if(!j&&ot){const vt=pt==="auto"?ot.map(ft=>l1(ft)):[pt];let Gt=!1;for(let ft=0;ft<vt.length;ft++){const zt=vt[ft];if(!ce.horizontal[zt])if(Gt)ce.horizontal[zt]=ce.horizontal[0];else{const Ht=i1(pe,r,o,p,ee,_t,Ue,"center",zt,Qe,ye,Do.horizontal,!1,me,le);Ht&&(ce.horizontal[zt]=Ht,Gt=Ht.positionedLines.length===1)}}It("left")}else{if(pt==="auto"&&(pt=l1(Je)),We||k.get("text-writing-mode").indexOf("horizontal")>=0||!Bp(He)){const vt=i1(pe,r,o,p,ee,_t,Ue,Je,pt,Qe,ye,Do.horizontal,!1,me,le);vt&&(ce.horizontal[pt]=vt)}It(We?"left":pt)}}let Oe=!1;if(K.icon&&K.icon.name){const He=c[K.icon.name];He&&(_e=OF(p[K.icon.name],k.get("icon-offset").evaluate(K,{},x),k.get("icon-anchor").evaluate(K,{},x)),Oe=He.sdf,i.sdfIcons===void 0?i.sdfIcons=He.sdf:i.sdfIcons!==He.sdf&&Tr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==i.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Me=EI(ce.horizontal)||ce.vertical;i.iconsInText||(i.iconsInText=!!Me&&Me.iconsInText),(Me||_e)&&GF(i,K,ce,_e,c,O,me,0,ye,Oe,y,x,S)}m&&i.generateCollisionDebugBuffers(E,i.collisionBoxArray)}function l1(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function GF(i,r,o,c,p,m,y,x,E,S,k,M,O){let j=m.textMaxSize.evaluate(r,{},M);j===void 0&&(j=y);const G=i.layers[0].layout,K=G.get("icon-offset").evaluate(r,{},M),ee=EI(o.horizontal)||o.vertical,le=O.name==="globe",me=ei,ce=y/me,pe=i.tilePixelRatio*j/me,_e=(Je=i.overscaling,i.zoom>18&&Je>2&&(Je>>=1),Math.max(Ot/(512*Je),1)*G.get("symbol-spacing")),ye=G.get("text-padding")*i.tilePixelRatio,Oe=G.get("icon-padding")*i.tilePixelRatio,Me=Fe(G.get("text-max-angle")),He=G.get("text-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",lt=G.get("icon-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",Ue=G.get("symbol-placement"),Qe=_e/2;var Je;const ot=G.get("icon-text-fit");let pt;c&&ot!=="none"&&(i.allowVerticalPlacement&&o.vertical&&(pt=uI(c,o.vertical,ot,G.get("icon-text-fit-padding"),K,ce)),ee&&(c=uI(c,ee,ot,G.get("icon-text-fit-padding"),K,ce)));const We=(_t,It,vt)=>{if(It.x<0||It.x>=Ot||It.y<0||It.y>=Ot)return;let Gt=null;if(le){const{x:ft,y:zt,z:Ht}=O.projectTilePoint(It.x,It.y,vt);Gt={anchor:new Ks(ft,zt,Ht,0,void 0),up:O.upVector(vt,It.x,It.y)}}(function(ft,zt,Ht,fr,qt,Bt,Hr,Zt,Kt,Lr,Vr,$r,Br,tn,cn,wn,Nr,Rn,En,nn,yr,Sn,Wr,Ri,Tn){const ti=ft.addToLineVertexArray(zt,fr);let Hn,Oi,qn,La,Nh,Ef,Sf,rC=0,nC=0,iC=0,oC=0,E1=-1,S1=-1;const us={};let aC=vx("");const du=Ht?Ht.anchor:zt;let T1=0,A1=0;if(Kt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[T1,A1]=Kt.layout.get("text-offset").evaluate(yr,{},Tn).map(co=>co*ei):(T1=Kt.layout.get("text-radial-offset").evaluate(yr,{},Tn)*ei,A1=s1),ft.allowVerticalPlacement&&qt.vertical){const co=qt.vertical;if(cn)Ef=c1(co),Zt&&(Sf=c1(Zt));else{const uo=Kt.layout.get("text-rotate").evaluate(yr,{},Tn)+90;qn=gg(Lr,du,zt,Vr,$r,Br,co,tn,uo,wn),Zt&&(La=gg(Lr,du,zt,Vr,$r,Br,Zt,Rn,uo))}}if(Bt){const co=Kt.layout.get("icon-rotate").evaluate(yr,{},Tn),uo=Kt.layout.get("icon-text-fit")!=="none",Tf=vI(Bt,co,Wr,uo),C1=Zt?vI(Zt,co,Wr,uo):void 0;Oi=gg(Lr,du,zt,Vr,$r,Br,Bt,Rn,co),rC=4*Tf.length;const sC=ft.iconSizeData;let pu=null;sC.kind==="source"?(pu=[Ra*Kt.layout.get("icon-size").evaluate(yr,{},Tn)],pu[0]>Bl&&Tr(`${ft.layerIds[0]}: Value for "icon-size" is >= ${mf}. Reduce your "icon-size".`)):sC.kind==="composite"&&(pu=[Ra*Sn.compositeIconSizes[0].evaluate(yr,{},Tn),Ra*Sn.compositeIconSizes[1].evaluate(yr,{},Tn)],(pu[0]>Bl||pu[1]>Bl)&&Tr(`${ft.layerIds[0]}: Value for "icon-size" is >= ${mf}. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,Tf,pu,nn,En,yr,!1,Ht,zt,ti.lineStartIndex,ti.lineLength,-1,Ri,Tn),E1=ft.icon.placedSymbolArray.length-1,C1&&(nC=4*C1.length,ft.addSymbols(ft.icon,C1,pu,nn,En,yr,Do.vertical,Ht,zt,ti.lineStartIndex,ti.lineLength,-1,Ri,Tn),S1=ft.icon.placedSymbolArray.length-1)}for(const co in qt.horizontal){const uo=qt.horizontal[co];Hn||(aC=vx(uo.text),cn?Nh=c1(uo):Hn=gg(Lr,du,zt,Vr,$r,Br,uo,tn,Kt.layout.get("text-rotate").evaluate(yr,{},Tn),wn));const Tf=uo.positionedLines.length===1;if(iC+=wI(ft,Ht,zt,uo,Hr,Kt,cn,yr,wn,ti,qt.vertical?Do.horizontal:Do.horizontalOnly,Tf?Object.keys(qt.horizontal):[co],us,E1,Sn,Ri,Tn),Tf)break}qt.vertical&&(oC+=wI(ft,Ht,zt,qt.vertical,Hr,Kt,cn,yr,wn,ti,Do.vertical,["vertical"],us,S1,Sn,Ri,Tn));let Wl=-1;const I1=(co,uo)=>co?Math.max(co,uo):uo;Wl=I1(Nh,Wl),Wl=I1(Ef,Wl),Wl=I1(Sf,Wl);const vL=Wl>-1?1:0;ft.glyphOffsetArray.length>=Ul.MAX_GLYPHS&&Tr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yr.sortKey!==void 0&&ft.addToSortKeyRanges(ft.symbolInstances.length,yr.sortKey),ft.symbolInstances.emplaceBack(du.x,du.y,du.z,zt.x,zt.y,us.right>=0?us.right:-1,us.center>=0?us.center:-1,us.left>=0?us.left:-1,us.vertical>=0?us.vertical:-1,E1,S1,aC,Hn!==void 0?Hn:ft.collisionBoxArray.length,Hn!==void 0?Hn+1:ft.collisionBoxArray.length,qn!==void 0?qn:ft.collisionBoxArray.length,qn!==void 0?qn+1:ft.collisionBoxArray.length,Oi!==void 0?Oi:ft.collisionBoxArray.length,Oi!==void 0?Oi+1:ft.collisionBoxArray.length,La||ft.collisionBoxArray.length,La?La+1:ft.collisionBoxArray.length,Vr,iC,oC,rC,nC,vL,0,T1,A1,Wl)})(i,It,Gt,_t,o,c,p,pt,i.layers[0],i.collisionBoxArray,r.index,r.sourceLayerIndex,i.index,ye,He,E,0,Oe,lt,K,r,m,S,k,M)};if(Ue==="line")for(const _t of gI(r.geometry,0,0,Ot,Ot)){const It=LF(_t,_e,Me,o.vertical||ee,c,me,pe,i.overscaling,Ot);for(const vt of It)ee&&HF(i,ee.text,Qe,vt)||We(_t,vt,M)}else if(Ue==="line-center"){for(const _t of r.geometry)if(_t.length>1){const It=FF(_t,Me,o.vertical||ee,c,me,pe);It&&We(_t,It,M)}}else if(r.type==="Polygon")for(const _t of Kx(r.geometry,0)){const It=jF(_t,16);We(_t[0],new Ks(It.x,It.y,0,0,void 0),M)}else if(r.type==="LineString")for(const _t of r.geometry)We(_t,new Ks(_t[0].x,_t[0].y,0,0,void 0),M);else if(r.type==="Point")for(const _t of r.geometry)for(const It of _t)We([It],new Ks(It.x,It.y,0,0,void 0),M)}const mf=255,Bl=mf*Ra;function wI(i,r,o,c,p,m,y,x,E,S,k,M,O,j,G,K,ee){const le=function(pe,_e,ye,Oe,Me,He,lt,Ue){const Qe=[];if(_e.positionedLines.length===0)return Qe;const Je=Oe.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,ot=function(vt){const Gt=vt[0],ft=vt[1],zt=Gt*ft;return zt>0?[Gt,-ft]:zt<0?[-Gt,ft]:Gt===0?[ft,Gt]:[ft,-Gt]}(ye);let pt=Math.abs(_e.top-_e.bottom);for(const vt of _e.positionedLines)pt-=vt.lineOffset;const We=_e.positionedLines.length,_t=pt/We;let It=_e.top-ye[1];for(let vt=0;vt<We;++vt){const Gt=_e.positionedLines[vt];It=BF(_e,_t,It,vt);for(const ft of Gt.positionedGlyphs){if(!ft.rect)continue;const zt=ft.rect||{};let Ht=rI+1,fr=!0,qt=1,Bt=0;if(ft.imageName){const Wr=lt[ft.imageName];if(!Wr)continue;if(Wr.sdf){Tr("SDF images are not supported in formatted text and will be ignored.");continue}fr=!1,qt=Wr.pixelRatio,Ht=Ki/qt}const Hr=(Me||Ue)&&ft.vertical,Zt=ft.metrics.advance*ft.scale/2,Kt=ft.metrics,Lr=ft.rect;if(Lr===null)continue;Ue&&_e.verticalizable&&(Bt=ft.imageName?Zt-ft.metrics.width*ft.scale/2:0);const Vr=Me?[ft.x+Zt,ft.y]:[0,0];let $r=[0,0],Br=[0,0],tn=!1;Me||(Hr?(Br=[ft.x+Zt+ot[0],ft.y+ot[1]-Bt],tn=!0):$r=[ft.x+Zt+ye[0],ft.y+ye[1]-Bt]);const cn=Lr.w*ft.scale/(qt*(ft.localGlyph?Oa:1)),wn=Lr.h*ft.scale/(qt*(ft.localGlyph?Oa:1));let Nr,Rn,En,nn;if(Hr){const Wr=ft.y-It,Ri=new xe(-Zt,Zt-Wr),Tn=-Math.PI/2,ti=new xe(...Br);Nr=new xe(-Zt+$r[0],$r[1]),Nr._rotateAround(Tn,Ri)._add(ti),Nr.x+=-Wr+Zt,Nr.y-=(Kt.left-Ht)*ft.scale;const Hn=ft.imageName?Kt.advance*ft.scale:ei*ft.scale,Oi=String.fromCharCode(ft.glyph);vF(Oi)?Nr.x+=(1-Ht)*ft.scale:xF(Oi)?Nr.x+=Hn-Kt.height*ft.scale+(-Ht-1)*ft.scale:Nr.x+=ft.imageName||Kt.width+2*Ht===Lr.w&&Kt.height+2*Ht===Lr.h?(Hn-wn)/2:(Hn-(Kt.height+2*Ht)*ft.scale)/2,Rn=new xe(Nr.x,Nr.y-cn),En=new xe(Nr.x+wn,Nr.y),nn=new xe(Nr.x+wn,Nr.y-cn)}else{const Wr=(Kt.left-Ht)*ft.scale-Zt+$r[0],Ri=(-Kt.top-Ht)*ft.scale+$r[1],Tn=Wr+cn,ti=Ri+wn;Nr=new xe(Wr,Ri),Rn=new xe(Tn,Ri),En=new xe(Wr,ti),nn=new xe(Tn,ti)}if(Je){let Wr;Wr=Me?new xe(0,0):tn?new xe(ot[0],ot[1]):new xe(ye[0],ye[1]),Nr._rotateAround(Je,Wr),Rn._rotateAround(Je,Wr),En._rotateAround(Je,Wr),nn._rotateAround(Je,Wr)}const yr=new xe(0,0),Sn=new xe(0,0);Qe.push({tl:Nr,tr:Rn,bl:En,br:nn,tex:zt,writingMode:_e.writingMode,glyphOffset:Vr,sectionIndex:ft.sectionIndex,isSDF:fr,pixelOffsetTL:yr,pixelOffsetBR:Sn,minFontScaleX:0,minFontScaleY:0})}}return Qe}(0,c,E,m,y,x,p,i.allowVerticalPlacement),me=i.textSizeData;let ce=null;me.kind==="source"?(ce=[Ra*m.layout.get("text-size").evaluate(x,{},ee)],ce[0]>Bl&&Tr(`${i.layerIds[0]}: Value for "text-size" is >= ${mf}. Reduce your "text-size".`)):me.kind==="composite"&&(ce=[Ra*G.compositeTextSizes[0].evaluate(x,{},ee),Ra*G.compositeTextSizes[1].evaluate(x,{},ee)],(ce[0]>Bl||ce[1]>Bl)&&Tr(`${i.layerIds[0]}: Value for "text-size" is >= ${mf}. Reduce your "text-size".`)),i.addSymbols(i.text,le,ce,E,y,x,k,r,o,S.lineStartIndex,S.lineLength,j,K,ee);for(const pe of M)O[pe]=i.text.placedSymbolArray.length-1;return 4*le.length}function EI(i){for(const r in i)return i[r];return null}function gg(i,r,o,c,p,m,y,x,E,S){let k=y.top,M=y.bottom,O=y.left,j=y.right;const G=y.collisionPadding;if(G&&(O-=G[0],k-=G[1],j+=G[2],M+=G[3]),E){const K=new xe(O,k),ee=new xe(j,k),le=new xe(O,M),me=new xe(j,M),ce=Fe(E);let pe=new xe(0,0);S&&(pe=new xe(S[0],S[1])),K._rotateAround(ce,pe),ee._rotateAround(ce,pe),le._rotateAround(ce,pe),me._rotateAround(ce,pe),O=Math.min(K.x,ee.x,le.x,me.x),j=Math.max(K.x,ee.x,le.x,me.x),k=Math.min(K.y,ee.y,le.y,me.y),M=Math.max(K.y,ee.y,le.y,me.y)}return i.emplaceBack(r.x,r.y,r.z,o.x,o.y,O,k,j,M,x,c,p,m),i.length-1}function c1(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const r=i.bottom-i.top;return r>0?Math.max(10,r):null}function HF(i,r,o,c){const p=i.compareText;if(r in p){const m=p[r];for(let y=m.length-1;y>=0;y--)if(c.dist(m[y])<o)return!0}else p[r]=[];return p[r].push(c),!1}function SI(i,r){const o=i.fovAboveCenter,c=i.elevation?i.elevation.getMinElevationBelowMSL()*r:0,p=(i._camera.position[2]*i.worldSize-c)/Math.cos(i._pitch),m=Math.sin(o)*p/Math.sin(Math.max(Math.PI/2-i._pitch-o,.01)),y=Math.sin(i._pitch)*m+p;return Math.min(1.01*y,p*(1/i._horizonShift))}function uu(i,r){if(!r.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:r};const o=Math.pow(2,-i.z),c=i.x*o,p=(i.x+1)*o,m=i.y*o,y=(i.y+1)*o,x=Po(c),E=Po(p),S=hi(m),k=hi(y),M=r.project(x,S),O=r.project(E,S),j=r.project(E,k),G=r.project(x,k);let K=Math.min(M.x,O.x,j.x,G.x),ee=Math.min(M.y,O.y,j.y,G.y),le=Math.max(M.x,O.x,j.x,G.x),me=Math.max(M.y,O.y,j.y,G.y);const ce=o/16;function pe(ye,Oe,Me,He,lt,Ue){const Qe=(Me+lt)/2,Je=(He+Ue)/2,ot=r.project(Po(Qe),hi(Je)),pt=Math.max(0,K-ot.x,ee-ot.y,ot.x-le,ot.y-me);K=Math.min(K,ot.x),le=Math.max(le,ot.x),ee=Math.min(ee,ot.y),me=Math.max(me,ot.y),pt>ce&&(pe(ye,ot,Me,He,Qe,Je),pe(ot,Oe,Qe,Je,lt,Ue))}pe(M,O,c,m,p,m),pe(O,j,p,m,p,y),pe(j,G,p,y,c,y),pe(G,M,c,y,c,m),K-=ce,ee-=ce,le+=ce,me+=ce;const _e=1/Math.max(le-K,me-ee);return{scale:_e,x:K*_e,y:ee*_e,x2:le*_e,y2:me*_e,projection:r}}const qF=Da(new Float32Array(16));class Nl{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,o){return{x:0,y:0,z:0}}unproject(r,o){return new Fr(0,0)}projectTilePoint(r,o,c){return{x:r,y:o,z:0}}locationPoint(r,o,c=!0){return r._coordinatePoint(r.locationCoordinate(o),c)}pixelsPerMeter(r,o){return za(1,r)*o}pixelSpaceConversion(r,o,c){return 1}farthestPixelDistance(r){return SI(r,r.pixelsPerMeter)}pointCoordinate(r,o,c,p){const m=r.horizonLineFromTop(!1),y=new xe(o,Math.max(m,c));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,p))}pointCoordinate3D(r,o,c){const p=new xe(o,c);if(r.elevation)return r.elevation.pointCoordinate(p);{const m=this.pointCoordinate(r,p.x,p.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(r,o){if(r.elevation)return!this.pointCoordinate3D(r,o.x,o.y);const c=r.horizonLineFromTop();return o.y<c}createInversionMatrix(r,o){return qF}createTileMatrix(r,o,c){let p,m,y;const x=c.canonical,E=Da(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=uu(x,this);p=1,m=S.x+c.wrap*S.scale,y=S.y,nu(E,E,[p/S.scale,p/S.scale,r.pixelsPerMeter/o])}else p=o/r.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*c.wrap)*p,y=x.y*p;return Gp(E,E,[m,y,0]),nu(E,E,[p/Ot,p/Ot,1]),E}upVector(r,o,c){return[0,0,1]}upVectorScale(r,o,c){return{metersToTile:1}}}class ZF extends Nl{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[o,c]=this.parallels=r.parallels||[29.5,45.5],p=Math.sin(Fe(o));this.n=(p+Math.sin(Fe(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(r,o){const{n:c,c:p,r0:m}=this,y=Fe(r-this.center[0]),x=Fe(o),E=Math.sqrt(p-2*c*Math.sin(x))/c;return{x:E*Math.sin(y*c),y:E*Math.cos(y*c)-m,z:0}}unproject(r,o){const{n:c,c:p,r0:m}=this,y=m+o;let x=Math.atan2(r,Math.abs(y))*Math.sign(y);y*c<0&&(x-=Math.PI*Math.sign(r)*Math.sign(y));const E=Fe(this.center[0])*c;x=gt(x,-Math.PI-E,Math.PI-E);const S=qe(Ve(x/c)+this.center[0],-180,180),k=Math.asin(qe((p-(r*r+y*y)*c*c)/(2*c),-1,1)),M=qe(Ve(k),-di,di);return new Fr(S,M)}}const gf=1.340264,yf=-.081106,_f=893e-6,vf=.003796,yg=Math.sqrt(3)/2;class KF extends Nl{project(r,o){o=o/180*Math.PI,r=r/180*Math.PI;const c=Math.asin(yg*Math.sin(o)),p=c*c,m=p*p*p;return{x:.5*(r*Math.cos(c)/(yg*(gf+3*yf*p+m*(7*_f+9*vf*p)))/Math.PI+.5),y:1-.5*(c*(gf+yf*p+m*(_f+vf*p))/Math.PI+1),z:0}}unproject(r,o){r=(2*r-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,p=c*c,m=p*p*p;for(let k,M,O,j=0;j<12&&(M=c*(gf+yf*p+m*(_f+vf*p))-o,O=gf+3*yf*p+m*(7*_f+9*vf*p),k=M/O,c=qe(c-k,-Math.PI/3,Math.PI/3),p=c*c,m=p*p*p,!(Math.abs(k)<1e-12));++j);const y=yg*r*(gf+3*yf*p+m*(7*_f+9*vf*p))/Math.cos(c),x=Math.asin(Math.sin(c)/yg),E=qe(180*y/Math.PI,-180,180),S=qe(180*x/Math.PI,-di,di);return new Fr(E,S)}}class XF extends Nl{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,o){return{x:.5+r/360,y:.5-o/360,z:0}}unproject(r,o){const c=360*(r-.5),p=qe(360*(.5-o),-di,di);return new Fr(c,p)}}const Lh=Math.PI/2;function _g(i){return Math.tan((Lh+i)/2)}class YF extends Nl{constructor(r){super(r),this.center=r.center||[0,30];const[o,c]=this.parallels=r.parallels||[30,30];let p=Fe(o),m=Fe(c);this.southernCenter=p+m<0,this.southernCenter&&(p=-p,m=-m);const y=Math.cos(p),x=_g(p);this.n=p===m?Math.sin(p):Math.log(y/Math.cos(m))/Math.log(_g(m)/x),this.f=y*Math.pow(_g(p),this.n)/this.n}project(r,o){o=Fe(o),this.southernCenter&&(o=-o),r=Fe(r-this.center[0]);const c=1e-6,{n:p,f:m}=this;m>0?o<-Lh+c&&(o=-Lh+c):o>Lh-c&&(o=Lh-c);const y=m/Math.pow(_g(o),p);let x=y*Math.sin(p*r),E=m-y*Math.cos(p*r);return x=.5*(x/Math.PI+.5),E=.5*(E/Math.PI+.5),{x,y:this.southernCenter?E:1-E,z:0}}unproject(r,o){r=(2*r-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:c,f:p}=this,m=p-o,y=Math.sign(m),x=Math.sign(c)*Math.sqrt(r*r+m*m);let E=Math.atan2(r,Math.abs(m))*y;m*c<0&&(E-=Math.PI*Math.sign(r)*y);const S=qe(Ve(E/c)+this.center[0],-180,180),k=qe(Ve(2*Math.atan(Math.pow(p/x,1/c))-Lh),-di,di);return new Fr(S,this.southernCenter?-k:k)}}class TI extends Nl{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,o){return{x:os(r),y:as(o),z:0}}unproject(r,o){const c=Po(r),p=hi(o);return new Fr(c,p)}}const AI=Fe(di);class QF extends Nl{project(r,o){const c=(o=Fe(o))*o,p=c*c;return{x:.5*((r=Fe(r))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(r,o){r=(2*r-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,p=25,m=0,y=c*c;do{y=c*c;const S=y*y;m=(c*(1.007226+y*(.015085+S*(.028874*y-.044475-.005916*S)))-o)/(1.007226+y*(.045255+S*(.259866*y-.311325-.005916*11*S))),c=qe(c-m,-AI,AI)}while(Math.abs(m)>1e-6&&--p>0);y=c*c;const x=qe(Ve(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=Ve(c);return new Fr(x,E)}}const II=Fe(di);class JF extends Nl{project(r,o){o=Fe(o),r=Fe(r);const c=Math.cos(o),p=2/Math.PI,m=Math.acos(c*Math.cos(r/2)),y=Math.sin(m)/m,x=.5*(r*p+2*c*Math.sin(r/2)/y)||0,E=.5*(o+Math.sin(o)/y)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(r,o){let c=r=(2*r-.5)*Math.PI,p=o=(2*(1-o)-1)*Math.PI,m=25;const y=1e-6;let x=0,E=0;do{const S=Math.cos(p),k=Math.sin(p),M=2*k*S,O=k*k,j=S*S,G=Math.cos(c/2),K=Math.sin(c/2),ee=2*G*K,le=K*K,me=1-j*G*G,ce=me?1/me:0,pe=me?Math.acos(S*G)*Math.sqrt(1/me):0,_e=.5*(2*pe*S*K+2*c/Math.PI)-r,ye=.5*(pe*k+p)-o,Oe=.5*ce*(j*le+pe*S*G*O)+1/Math.PI,Me=ce*(ee*M/4-pe*k*K),He=.125*ce*(M*K-pe*k*j*ee),lt=.5*ce*(O*G+pe*le*S)+.5,Ue=Me*He-lt*Oe;x=(ye*Me-_e*lt)/Ue,E=(_e*He-ye*Oe)/Ue,c=qe(c-x,-Math.PI,Math.PI),p=qe(p-E,-II,II)}while((Math.abs(x)>y||Math.abs(E)>y)&&--m>0);return new Fr(Ve(c),Ve(p))}}class CI extends Nl{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Fe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,o){const{scale:c,cosPhi:p}=this;return{x:Fe(r)*p*c+.5,y:-Math.sin(Fe(o))/p*c+.5,z:0}}unproject(r,o){const{scale:c,cosPhi:p}=this,m=-(o-.5)/c,y=qe(Ve((r-.5)/c)/p,-180,180),x=Math.asin(qe(m*p,-1,1)),E=qe(Ve(x),-di,di);return new Fr(y,E)}}class eL extends TI{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,o,c){const p=Jp(r,o,c);return mn(p,p,ef(is(c))),{x:p[0],y:p[1],z:p[2]}}locationPoint(r,o){const c=wh(o.lat,o.lng),p=Di([],c),m=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(o),r._centerAltitude):r._centerAltitude;Kp(c,c,p,za(1,0)*Ot*m);const y=Da(new Float64Array(16));return ru(y,r.pixelMatrix,r.globeMatrix),mn(c,c,y),new xe(c[0],c[1])}pixelsPerMeter(r,o){return za(1,0)*o}pixelSpaceConversion(r,o,c){const p=za(1,r)*o,m=dr(za(1,45)*o,p,c);return this.pixelsPerMeter(r,o)/m}createTileMatrix(r,o,c){const p=zx(is(c.canonical));return ru(new Float64Array(16),r.globeMatrix,p)}createInversionMatrix(r,o){const{center:c}=r,p=ef(is(o));return H0(p,p,Fe(c.lng)),Ex(p,p,Fe(c.lat)),nu(p,p,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(r,o,c,p){return t2(r,o,c,!0)||new Sh(0,0)}pointCoordinate3D(r,o,c){const p=this.pointCoordinate(r,o,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(r,o){return!t2(r,o.x,o.y,!1)}farthestPixelDistance(r){const o=function(p,m){const y=p.cameraToCenterDistance,x=p._centerAltitude*m,E=p._camera,S=p._camera.forward(),k=Gs([],ko([],S,-y),[0,0,x]),M=p.worldSize/(2*Math.PI),O=[0,0,-M],j=p.width/p.height,G=Math.tan(p.fovAboveCenter),K=ko([],E.up(),G),ee=ko([],E.right(),G*j),le=Di([],Gs([],Gs([],S,K),ee)),me=[];let ce;if(new Ix(k,le).closestPointOnSphere(O,M,me)){const pe=Gs([],me,O),_e=Ma([],pe,k);ce=Math.cos(p.fovAboveCenter)*Hp(_e)}else{const pe=Ma([],k,O),_e=Ma([],O,k);Di(_e,_e);const ye=Hp(pe)-M;ce=Math.sqrt(ye*(ye+2*M));const Oe=Math.acos(ce/(M+ye))-Math.acos(ea(S,_e));ce*=Math.cos(Oe)}return 1.01*ce}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),c=Eh(r.zoom);if(c>0){const p=SI(r,za(1,r.center.lat)*r.worldSize),m=r.worldSize/(2*Math.PI),y=Math.max(r.width,r.height)/r.worldSize*Math.PI;return dr(o,p+m*(1-Math.cos(y)),Math.pow(c,10))}return o}upVector(r,o,c){return Jp(o,c,r,1)}upVectorScale(r){return{metersToTile:q0(K0(is(r)))}}}function kI(i){const r=i.parallels,o=!!r&&Math.abs(r[0]+r[1])<.01;switch(i.name){case"mercator":return new TI(i);case"equirectangular":return new XF(i);case"naturalEarth":return new QF(i);case"equalEarth":return new KF(i);case"winkelTripel":return new JF(i);case"albers":return o?new CI(i):new ZF(i);case"lambertConformalConic":return o?new CI(i):new YF(i);case"globe":return new eL(i)}throw new Error(`Invalid projection name: ${i.name}`)}const tL=og.types,rL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vg(i,r,o,c,p,m,y,x,E,S,k,M,O){const j=x?Math.min(Bl,Math.round(x[0])):0,G=x?Math.min(Bl,Math.round(x[1])):0;i.emplaceBack(r,o,Math.round(32*c),Math.round(32*p),m,y,(j<<1)+(E?1:0),G,16*S,16*k,256*M,256*O)}function xg(i,r,o,c,p,m,y){i.emplaceBack(r,o,c,p,m,y)}function bg(i,r,o,c,p){i.emplaceBack(r,o,c,p),i.emplaceBack(r,o,c,p),i.emplaceBack(r,o,c,p),i.emplaceBack(r,o,c,p)}function nL(i){for(const r of i.sections)if(_x(r.text))return!0;return!1}class u1{constructor(r){this.layoutVertexArray=new tt,this.indexArray=new Pt,this.programConfigurations=r,this.segments=new xn,this.dynamicLayoutVertexArray=new at,this.opacityVertexArray=new Mt,this.placedSymbolArray=new vn,this.globeExtVertexArray=new ht}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,o,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,hF.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,pF.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,rL,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,dF.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Tt(u1,"SymbolBuffers");class h1{constructor(r,o,c){this.layoutVertexArray=new r,this.layoutAttributes=o,this.indexArray=new c,this.segments=new xn,this.collisionVertexArray=new nr,this.collisionVertexArrayExt=new er}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,fF.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,mF.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Tt(h1,"CollisionBuffers");class Ul{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(y=>y.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Da([]),this.placementViewportMatrix=Da([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jx(this.zoom,o["text-size"]),this.iconSizeData=Jx(this.zoom,o["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),m=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(y=>Do[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new u1(new tu(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new u1(new tu(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new Pi,this.lineVertexArray=new yh,this.symbolInstances=new Zr}calculateGlyphDependencies(r,o,c,p,m){for(let y=0;y<r.length;y++)if(o[r.charCodeAt(y)]=!0,p&&m){const x=df[r.charAt(y)];x&&(o[x.charCodeAt(0)]=!0)}}populate(r,o,c,p){const m=this.layers[0],y=m.layout,x=this.projection.name==="globe",E=y.get("text-font"),S=y.get("text-field"),k=y.get("icon-image"),M=(S.value.kind!=="constant"||S.value.value instanceof ki&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),O=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,j=y.get("symbol-sort-key");if(this.features=[],!M&&!O)return;const G=o.iconDependencies,K=o.glyphDependencies,ee=o.availableImages,le=new D(this.zoom);for(const{feature:me,id:ce,index:pe,sourceLayerIndex:_e}of r){const ye=m._featureFilter.needGeometry,Oe=su(me,ye);if(!m._featureFilter.filter(le,Oe,c))continue;if(ye||(Oe.geometry=Hs(me,c,p)),x&&me.type!==1&&c.z<=5){const Ue=Oe.geometry,Qe=.98078528056,Je=(ot,pt)=>ea(Jp(ot.x,ot.y,c,1),Jp(pt.x,pt.y,c,1))<Qe;for(let ot=0;ot<Ue.length;ot++)Ue[ot]=p5(Ue[ot],Je)}let Me,He;if(M){const Ue=m.getValueAndResolveTokens("text-field",Oe,c,ee),Qe=ki.factory(Ue);nL(Qe)&&(this.hasRTLText=!0),(!this.hasRTLText||b()==="unavailable"||this.hasRTLText&&I.isParsed())&&(Me=_F(Qe,m,Oe))}if(O){const Ue=m.getValueAndResolveTokens("icon-image",Oe,c,ee);He=Ue instanceof no?Ue:no.fromString(Ue)}if(!Me&&!He)continue;const lt=this.sortFeaturesByKey?j.evaluate(Oe,{},c):void 0;if(this.features.push({id:ce,text:Me,icon:He,index:pe,sourceLayerIndex:_e,geometry:Oe.geometry,properties:me.properties,type:tL[me.type],sortKey:lt}),He&&(G[He.name]=!0),Me){const Ue=E.evaluate(Oe,{},c).join(","),Qe=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Do.vertical)>=0;for(const Je of Me.sections)if(Je.image)G[Je.image.name]=!0;else{const ot=Bp(Me.toString()),pt=Je.fontStack||Ue,We=K[pt]=K[pt]||{};this.calculateGlyphDependencies(Je.text,We,Qe,this.allowVerticalPlacement,ot)}}}y.get("symbol-placement")==="line"&&(this.features=function(me){const ce={},pe={},_e=[];let ye=0;function Oe(Ue){_e.push(me[Ue]),ye++}function Me(Ue,Qe,Je){const ot=pe[Ue];return delete pe[Ue],pe[Qe]=ot,_e[ot].geometry[0].pop(),_e[ot].geometry[0]=_e[ot].geometry[0].concat(Je[0]),ot}function He(Ue,Qe,Je){const ot=ce[Qe];return delete ce[Qe],ce[Ue]=ot,_e[ot].geometry[0].shift(),_e[ot].geometry[0]=Je[0].concat(_e[ot].geometry[0]),ot}function lt(Ue,Qe,Je){const ot=Je?Qe[0][Qe[0].length-1]:Qe[0][0];return`${Ue}:${ot.x}:${ot.y}`}for(let Ue=0;Ue<me.length;Ue++){const Qe=me[Ue],Je=Qe.geometry,ot=Qe.text?Qe.text.toString():null;if(!ot){Oe(Ue);continue}const pt=lt(ot,Je),We=lt(ot,Je,!0);if(pt in pe&&We in ce&&pe[pt]!==ce[We]){const _t=He(pt,We,Je),It=Me(pt,We,_e[_t].geometry);delete ce[pt],delete pe[We],pe[lt(ot,_e[It].geometry,!0)]=It,_e[_t].geometry=null}else pt in pe?Me(pt,We,Je):We in ce?He(pt,We,Je):(Oe(Ue),ce[pt]=ye-1,pe[We]=ye-1)}return _e.filter(Ue=>Ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,ce)=>me.sortKey-ce.sortKey)}update(r,o,c,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,o,this.layers,c,p),this.icon.programConfigurations.updatePaintArrays(r,o,this.layers,c,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=kI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,o){const c=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:p,y:m}of o)this.lineVertexArray.emplaceBack(p,m);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(r,o,c,p,m,y,x,E,S,k,M,O,j,G){const K=r.indexArray,ee=r.layoutVertexArray,le=r.globeExtVertexArray,me=r.segments.prepareSegment(4*o.length,ee,K,this.canOverlap?y.sortKey:void 0),ce=this.glyphOffsetArray.length,pe=me.vertexLength,_e=this.allowVerticalPlacement&&x===Do.vertical?Math.PI/2:0,ye=y.text&&y.text.sections;for(let Me=0;Me<o.length;Me++){const{tl:He,tr:lt,bl:Ue,br:Qe,tex:Je,pixelOffsetTL:ot,pixelOffsetBR:pt,minFontScaleX:We,minFontScaleY:_t,glyphOffset:It,isSDF:vt,sectionIndex:Gt}=o[Me],ft=me.vertexLength,zt=It[1];if(vg(ee,S.x,S.y,He.x,zt+He.y,Je.x,Je.y,c,vt,ot.x,ot.y,We,_t),vg(ee,S.x,S.y,lt.x,zt+lt.y,Je.x+Je.w,Je.y,c,vt,pt.x,ot.y,We,_t),vg(ee,S.x,S.y,Ue.x,zt+Ue.y,Je.x,Je.y+Je.h,c,vt,ot.x,pt.y,We,_t),vg(ee,S.x,S.y,Qe.x,zt+Qe.y,Je.x+Je.w,Je.y+Je.h,c,vt,pt.x,pt.y,We,_t),E){const{x:Ht,y:fr,z:qt}=E.anchor,[Bt,Hr,Zt]=E.up;xg(le,Ht,fr,qt,Bt,Hr,Zt),xg(le,Ht,fr,qt,Bt,Hr,Zt),xg(le,Ht,fr,qt,Bt,Hr,Zt),xg(le,Ht,fr,qt,Bt,Hr,Zt),bg(r.dynamicLayoutVertexArray,Ht,fr,qt,_e)}else bg(r.dynamicLayoutVertexArray,S.x,S.y,S.z,_e);K.emplaceBack(ft,ft+1,ft+2),K.emplaceBack(ft+1,ft+2,ft+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(It[0]),Me!==o.length-1&&Gt===o[Me+1].sectionIndex||r.programConfigurations.populatePaintArrays(ee.length,y,y.index,{},j,G,ye&&ye[Gt])}const Oe=E?E.anchor:S;r.placedSymbolArray.emplaceBack(Oe.x,Oe.y,Oe.z,S.x,S.y,ce,this.glyphOffsetArray.length-ce,pe,k,M,S.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],x,0,!1,0,O,0)}_commitLayoutVertex(r,o,c,p,m,y,x){r.emplaceBack(o,c,p,m,y,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,o,c,p,m,y,x){const E=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),S=E.vertexLength,k=x.tileAnchorX,M=x.tileAnchorY;for(let j=0;j<4;j++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(o,-r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(o,r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(o,r.padding,r.padding),c.collisionVertexArrayExt.emplaceBack(o,-r.padding,r.padding),this._commitLayoutVertex(c.layoutVertexArray,p,m,y,k,M,new xe(r.x1,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,m,y,k,M,new xe(r.x2,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,m,y,k,M,new xe(r.x2,r.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,m,y,k,M,new xe(r.x1,r.y2)),E.vertexLength+=4;const O=c.indexArray;O.emplaceBack(S,S+1),O.emplaceBack(S+1,S+2),O.emplaceBack(S+2,S+3),O.emplaceBack(S+3,S),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,o,c,p,m,y){for(let x=p;x<m;x++){const E=c.get(x),S=this.getSymbolInstanceTextSize(r,y,o,x);this._addCollisionDebugVertices(E,S,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,o,c,p,m,y){for(let x=p;x<m;x++){const E=c.get(x),S=this.getSymbolInstanceIconSize(r,o,y.placedIconSymbolIndex);this._addCollisionDebugVertices(E,S,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new h1(At,Z2.members,Gn),this.iconCollisionBox=new h1(At,Z2.members,Gn);const c=kh(this.iconSizeData,r),p=kh(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(p,r,o,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(p,r,o,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,r,o,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,r,o,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(r,o,c,p){const m=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:p),y=cg(this.textSizeData,r,m)/ei;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,o,c){const p=this.icon.placedSymbolArray.get(c),m=cg(this.iconSizeData,r,p);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(r,o,c){r.emplaceBack(o,-c,-c),r.emplaceBack(o,c,-c),r.emplaceBack(o,c,c),r.emplaceBack(o,-c,c)}_updateTextDebugCollisionBoxes(r,o,c,p,m,y){for(let x=p;x<m;x++){const E=c.get(x),S=this.getSymbolInstanceTextSize(r,y,o,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,E.padding)}}_updateIconDebugCollisionBoxes(r,o,c,p,m,y){for(let x=p;x<m;x++){const E=c.get(x),S=this.getSymbolInstanceIconSize(r,o,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,E.padding)}}updateCollisionDebugBuffers(r,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=kh(this.iconSizeData,r),p=kh(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(p,r,o,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(p,r,o,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(c,r,o,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,r,o,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,o,c,p,m,y,x,E,S){const k={};if(o<c){const{x1:M,y1:O,x2:j,y2:G,padding:K,projectedAnchorX:ee,projectedAnchorY:le,projectedAnchorZ:me,tileAnchorX:ce,tileAnchorY:pe,featureIndex:_e}=r.get(o);k.textBox={x1:M,y1:O,x2:j,y2:G,padding:K,projectedAnchorX:ee,projectedAnchorY:le,projectedAnchorZ:me,tileAnchorX:ce,tileAnchorY:pe},k.textFeatureIndex=_e}if(p<m){const{x1:M,y1:O,x2:j,y2:G,padding:K,projectedAnchorX:ee,projectedAnchorY:le,projectedAnchorZ:me,tileAnchorX:ce,tileAnchorY:pe,featureIndex:_e}=r.get(p);k.verticalTextBox={x1:M,y1:O,x2:j,y2:G,padding:K,projectedAnchorX:ee,projectedAnchorY:le,projectedAnchorZ:me,tileAnchorX:ce,tileAnchorY:pe},k.verticalTextFeatureIndex=_e}if(y<x){const{x1:M,y1:O,x2:j,y2:G,padding:K,projectedAnchorX:ee,projectedAnchorY:le,projectedAnchorZ:me,tileAnchorX:ce,tileAnchorY:pe,featureIndex:_e}=r.get(y);k.iconBox={x1:M,y1:O,x2:j,y2:G,padding:K,projectedAnchorX:ee,projectedAnchorY:le,projectedAnchorZ:me,tileAnchorX:ce,tileAnchorY:pe},k.iconFeatureIndex=_e}if(E<S){const{x1:M,y1:O,x2:j,y2:G,padding:K,projectedAnchorX:ee,projectedAnchorY:le,projectedAnchorZ:me,tileAnchorX:ce,tileAnchorY:pe,featureIndex:_e}=r.get(E);k.verticalIconBox={x1:M,y1:O,x2:j,y2:G,padding:K,projectedAnchorX:ee,projectedAnchorY:le,projectedAnchorZ:me,tileAnchorX:ce,tileAnchorY:pe},k.verticalIconFeatureIndex=_e}return k}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,o){const c=r.placedSymbolArray.get(o),p=c.vertexStartIndex+4*c.numGlyphs;for(let m=c.vertexStartIndex;m<p;m+=4)r.indexArray.emplaceBack(m,m+1,m+2),r.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(r),c=Math.cos(r),p=[],m=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const E=this.symbolInstances.get(x);p.push(0|Math.round(o*E.tileAnchorX+c*E.tileAnchorY)),m.push(E.featureIndex)}return y.sort((x,E)=>p[x]-p[E]||m[E]-m[x]),y}addToSortKeyRanges(r,o){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===o?c.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const c=this.symbolInstances.get(o);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:S}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&y!==m&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Tt(Ul,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ul.MAX_GLYPHS=65535,Ul.addDynamicAttributes=bg;const iL=new he({"symbol-placement":new Z(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Z(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Z(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new re(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Z(Ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Z(Ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Z(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Z(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Z(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new re(Ge.layout_symbol["icon-size"]),"icon-text-fit":new Z(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Z(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new re(Ge.layout_symbol["icon-image"]),"icon-rotate":new re(Ge.layout_symbol["icon-rotate"]),"icon-padding":new Z(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Z(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new re(Ge.layout_symbol["icon-offset"]),"icon-anchor":new re(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Z(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Z(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Z(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new re(Ge.layout_symbol["text-field"]),"text-font":new re(Ge.layout_symbol["text-font"]),"text-size":new re(Ge.layout_symbol["text-size"]),"text-max-width":new re(Ge.layout_symbol["text-max-width"]),"text-line-height":new re(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new re(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new re(Ge.layout_symbol["text-justify"]),"text-radial-offset":new re(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Z(Ge.layout_symbol["text-variable-anchor"]),"text-anchor":new re(Ge.layout_symbol["text-anchor"]),"text-max-angle":new Z(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Z(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new re(Ge.layout_symbol["text-rotate"]),"text-padding":new Z(Ge.layout_symbol["text-padding"]),"text-keep-upright":new Z(Ge.layout_symbol["text-keep-upright"]),"text-transform":new re(Ge.layout_symbol["text-transform"]),"text-offset":new re(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new Z(Ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Z(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new Z(Ge.layout_symbol["text-optional"])});var d1={paint:new he({"icon-opacity":new re(Ge.paint_symbol["icon-opacity"]),"icon-color":new re(Ge.paint_symbol["icon-color"]),"icon-halo-color":new re(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new re(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new re(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Z(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Z(Ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new re(Ge.paint_symbol["text-opacity"]),"text-color":new re(Ge.paint_symbol["text-color"],{runtimeType:qi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new re(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new re(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new re(Ge.paint_symbol["text-halo-blur"]),"text-translate":new Z(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new Z(Ge.paint_symbol["text-translate-anchor"])}),layout:iL};class PI{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:gl,this.defaultValue=r}evaluate(r){if(r.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(r.formattedSection))return o.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tt(PI,"FormatSectionOverride",{omit:["defaultValue"]});class wg extends Pa{constructor(r){super(r,d1)}recalculate(r,o){super.recalculate(r,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const m of c)p.indexOf(m)<0&&p.push(m);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,o,c,p){const m=this.layout.get(r).evaluate(o,{},c,p),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||Cl(y.value)||!m?m:function(x,E){return E.replace(/{([^{}]+)}/g,(S,k)=>k in x?String(x[k]):"")}(o.properties,m)}createBucket(r){return new Ul(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of d1.paint.overridableProperties){if(!wg.hasPaintOverride(this.layout,r))continue;const o=this.paint.get(r),c=new PI(o),p=new ch(c,o.property.specification);let m=null;m=o.value.kind==="constant"||o.value.kind==="source"?new Ip("source",p):new Hc("composite",p,o.value.zoomStops,o.value._interpolationType),this.paint._values[r]=new ie(o.property,m,o.parameters)}}_handleOverridablePaintPropertyUpdate(r,o,c){return!(!this.layout||o.isDataDriven()||c.isDataDriven())&&wg.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,o){const c=r.get("text-field"),p=d1.paint.properties[o];let m=!1;const y=x=>{for(const E of x)if(p.overrides&&p.overrides.hasOverride(E))return void(m=!0)};if(c.value.kind==="constant"&&c.value.value instanceof ki)y(c.value.value.sections);else if(c.value.kind==="source"){const x=S=>{m||(S instanceof Rs&&ln(S.value)===kc?y(S.value.sections):S instanceof es?y(S.sections):S.eachChild(x))},E=c.value;E._styleExpression&&x(E._styleExpression.expression)}return m}getProgramConfiguration(r){return new Ol(this,r)}}var oL={paint:new he({"background-color":new Z(Ge.paint_background["background-color"]),"background-pattern":new Z(Ge.paint_background["background-pattern"]),"background-opacity":new Z(Ge.paint_background["background-opacity"])})},aL={paint:new he({"raster-opacity":new Z(Ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Z(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Z(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Z(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Z(Ge.paint_raster["raster-saturation"]),"raster-contrast":new Z(Ge.paint_raster["raster-contrast"]),"raster-resampling":new Z(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Z(Ge.paint_raster["raster-fade-duration"])})};class sL extends Pa{constructor(r){super(r,{}),this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var lL={paint:new he({"sky-type":new Z(Ge.paint_sky["sky-type"]),"sky-atmosphere-sun":new Z(Ge.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Z(Ge.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Z(Ge.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Z(Ge.paint_sky["sky-gradient-radius"]),"sky-gradient":new ue(Ge.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Z(Ge.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Z(Ge.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Z(Ge.paint_sky["sky-opacity"])})};function p1(i,r,o){const c=[0,0,1],p=KA([]);return YA(p,p,o?-Fe(i)+Math.PI:Fe(i)),XA(p,p,-Fe(r)),GA(c,c,p),Di(c,c)}const cL={circle:class extends Pa{constructor(i){super(i,x5)}createBucket(i){return new Nx(i)}queryRadius(i){const r=i;return Th("circle-radius",this,r)+Th("circle-stroke-width",this,r)+Q0(this.paint.get("circle-translate"))}queryIntersectsFeature(i,r,o,c,p,m,y,x){const E=v2(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o);return x2(i,c,m,y,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,S)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Ol(this,i)}},heatmap:class extends Pa{createBucket(i){return new w2(i)}constructor(i){super(i,S5),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$x({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Th("heatmap-radius",this,i)}queryIntersectsFeature(i,r,o,c,p,m,y,x){const E=this.paint.get("heatmap-radius").evaluate(r,o);return x2(i,c,m,y,x,!0,!0,new xe(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Ol(this,i)}},hillshade:class extends Pa{constructor(i){super(i,T5)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Pa{constructor(i){super(i,j5)}getProgramIds(){const i=this.paint.get("fill-pattern"),r=i&&i.constantOr(1),o=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getProgramConfiguration(i){return new Ol(this,i)}recalculate(i,r){super.recalculate(i,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new ng(i)}queryRadius(){return Q0(this.paint.get("fill-translate"))}queryIntersectsFeature(i,r,o,c,p,m){return!i.queryGeometry.isAboveHorizon&&f2(_2(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Pa{constructor(i){super(i,nF)}createBucket(i){return new cf(i)}queryRadius(){return Q0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Ol(this,i)}queryIntersectsFeature(i,r,o,c,p,m,y,x,E){const S=v2(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(r,o),M=this.paint.get("fill-extrusion-base").evaluate(r,o),O=[0,0],j=x&&m.elevation,G=m.elevation?m.elevation.exaggeration():1,K=i.tile.getBucket(this);if(j&&K instanceof cf){const pe=K.centroidVertexArray,_e=E+1;_e<pe.length&&(O[0]=pe.geta_centroid_pos0(_e),O[1]=pe.geta_centroid_pos1(_e))}if(O[0]===0&&O[1]===1)return!1;m.projection.name==="globe"&&(c=U2([c],[new xe(0,0),new xe(Ot,Ot)],i.tileID.canonical).map(pe=>pe.polygon).flat());const ee=j?x:null,[le,me]=function(pe,_e,ye,Oe,Me,He,lt,Ue,Qe,Je,ot){return pe.projection.name==="globe"?function(pt,We,_t,It,vt,Gt,ft,zt,Ht,fr,qt){const Bt=[],Hr=[],Zt=pt.projection.upVectorScale(qt,pt.center.lat,pt.worldSize).metersToTile,Kt=[0,0,0,1],Lr=[0,0,0,1],Vr=(Br,tn,cn,wn)=>{Br[0]=tn,Br[1]=cn,Br[2]=wn,Br[3]=1},$r=N2();_t>0&&(_t+=$r),It+=$r;for(const Br of We){const tn=[],cn=[];for(const wn of Br){const Nr=wn.x+vt.x,Rn=wn.y+vt.y,En=pt.projection.projectTilePoint(Nr,Rn,qt),nn=pt.projection.upVector(qt,wn.x,wn.y);let yr=_t,Sn=It;if(ft){const Wr=W2(Nr,Rn,_t,It,ft,zt,Ht,fr);yr+=Wr.base,Sn+=Wr.top}_t!==0?Vr(Kt,En.x+nn[0]*Zt*yr,En.y+nn[1]*Zt*yr,En.z+nn[2]*Zt*yr):Vr(Kt,En.x,En.y,En.z),Vr(Lr,En.x+nn[0]*Zt*Sn,En.y+nn[1]*Zt*Sn,En.z+nn[2]*Zt*Sn),mn(Kt,Kt,Gt),mn(Lr,Lr,Gt),tn.push(new Ch(Kt[0],Kt[1],Kt[2])),cn.push(new Ch(Lr[0],Lr[1],Lr[2]))}Bt.push(tn),Hr.push(cn)}return[Bt,Hr]}(pe,_e,ye,Oe,Me,He,lt,Ue,Qe,Je,ot):lt?function(pt,We,_t,It,vt,Gt,ft,zt,Ht){const fr=[],qt=[],Bt=[0,0,0,1];for(const Hr of pt){const Zt=[],Kt=[];for(const Lr of Hr){const Vr=Lr.x+It.x,$r=Lr.y+It.y,Br=W2(Vr,$r,We,_t,Gt,ft,zt,Ht);Bt[0]=Vr,Bt[1]=$r,Bt[2]=Br.base,Bt[3]=1,iu(Bt,Bt,vt),Bt[3]=Math.max(Bt[3],1e-5);const tn=new Ch(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);Bt[0]=Vr,Bt[1]=$r,Bt[2]=Br.top,Bt[3]=1,iu(Bt,Bt,vt),Bt[3]=Math.max(Bt[3],1e-5);const cn=new Ch(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);Zt.push(tn),Kt.push(cn)}fr.push(Zt),qt.push(Kt)}return[fr,qt]}(_e,ye,Oe,Me,He,lt,Ue,Qe,Je):function(pt,We,_t,It,vt){const Gt=[],ft=[],zt=vt[8]*We,Ht=vt[9]*We,fr=vt[10]*We,qt=vt[11]*We,Bt=vt[8]*_t,Hr=vt[9]*_t,Zt=vt[10]*_t,Kt=vt[11]*_t;for(const Lr of pt){const Vr=[],$r=[];for(const Br of Lr){const tn=Br.x+It.x,cn=Br.y+It.y,wn=vt[0]*tn+vt[4]*cn+vt[12],Nr=vt[1]*tn+vt[5]*cn+vt[13],Rn=vt[2]*tn+vt[6]*cn+vt[14],En=vt[3]*tn+vt[7]*cn+vt[15],nn=wn+zt,yr=Nr+Ht,Sn=Rn+fr,Wr=Math.max(En+qt,1e-5),Ri=wn+Bt,Tn=Nr+Hr,ti=Rn+Zt,Hn=Math.max(En+Kt,1e-5);Vr.push(new Ch(nn/Wr,yr/Wr,Sn/Wr)),$r.push(new Ch(Ri/Hn,Tn/Hn,ti/Hn))}Gt.push(Vr),ft.push($r)}return[Gt,ft]}(_e,ye,Oe,Me,He)}(m,c,M,k,S,y,ee,O,G,m.center.lat,i.tileID.canonical),ce=i.queryGeometry;return function(pe,_e,ye){let Oe=1/0;f2(ye,_e)&&(Oe=$2(ye,_e[0]));for(let Me=0;Me<_e.length;Me++){const He=_e[Me],lt=pe[Me];for(let Ue=0;Ue<He.length-1;Ue++){const Qe=He[Ue],Je=[Qe,He[Ue+1],lt[Ue+1],lt[Ue],Qe];p2(ye,Je)&&(Oe=Math.min(Oe,$2(ye,Je)))}}return Oe!==1/0&&Oe}(le,me,ce.isPointQuery()?ce.screenBounds:ce.screenGeometry)}},line:class extends Pa{constructor(i){super(i,G2),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof fp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,r){super.recalculate(i,r),this.paint._values["line-floorwidth"]=H2.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new lg(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Ol(this,i)}queryRadius(i){const r=i,o=q2(Th("line-width",this,r),Th("line-gap-width",this,r)),c=Th("line-offset",this,r);return o/2+Math.abs(c)+Q0(this.paint.get("line-translate"))}queryIntersectsFeature(i,r,o,c,p,m){if(i.queryGeometry.isAboveHorizon)return!1;const y=_2(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),x=i.pixelToTileUnitsFactor/2*q2(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),E=this.paint.get("line-offset").evaluate(r,o);return E&&(c=function(S,k){const M=[],O=new xe(0,0);for(let j=0;j<S.length;j++){const G=S[j],K=[];for(let ee=0;ee<G.length;ee++){const le=G[ee],me=G[ee+1],ce=ee===0?O:le.sub(G[ee-1])._unit()._perp(),pe=ee===G.length-1?O:me.sub(le)._unit()._perp(),_e=ce._add(pe)._unit();_e._mult(1/(_e.x*pe.x+_e.y*pe.y)),K.push(_e._mult(k)._add(le))}M.push(K)}return M}(c,E*i.pixelToTileUnitsFactor)),function(S,k,M){for(let O=0;O<k.length;O++){const j=k[O];if(S.length>=3){for(let G=0;G<j.length;G++)if(lu(S,j[G]))return!0}if(g5(S,j,M))return!0}return!1}(y,c,x)}isTileClipped(){return!0}},symbol:wg,background:class extends Pa{constructor(i){super(i,oL)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Pa{constructor(i){super(i,aL)}getProgramIds(){return["raster"]}},sky:class extends Pa{constructor(i){super(i,lL),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$x({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(i,r){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),p=!c,m=i.style.light,y=m.properties.get("position");return p&&m.properties.get("anchor")==="viewport"&&Tr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?p1(y.azimuthal,90-y.polar,r):p1(c[0],90-c[1],r)}const o=this.paint.get("sky-gradient-center");return p1(o[0],90-o[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class xf{constructor(r,o,c,p){this.context=r,this.format=c,this.texture=r.gl.createTexture(),this.update(o,p)}update(r,o,c){const{width:p,height:m}=r,{context:y}=this,{gl:x}=y,{HTMLImageElement:E,HTMLCanvasElement:S,HTMLVideoElement:k,ImageData:M,ImageBitmap:O}=w;if(x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!o||o.premultiply!==!1)),c||this.size&&this.size[0]===p&&this.size[1]===m){const{x:j,y:G}=c||{x:0,y:0};r instanceof E||r instanceof S||r instanceof k||r instanceof M||O&&r instanceof O?x.texSubImage2D(x.TEXTURE_2D,0,j,G,x.RGBA,x.UNSIGNED_BYTE,r):x.texSubImage2D(x.TEXTURE_2D,0,j,G,p,m,x.RGBA,x.UNSIGNED_BYTE,r.data)}else this.size=[p,m],r instanceof E||r instanceof S||r instanceof k||r instanceof M||O&&r instanceof O?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,r):x.texImage2D(x.TEXTURE_2D,0,this.format,p,m,0,this.format,x.UNSIGNED_BYTE,r.data);this.useMipmap=!!(o&&o.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(r,o){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?r===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:r),this.filter=r),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class uL{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class hL{constructor(){this.tasks={},this.taskQueue=[],si(["process"],this),this.invoker=new uL(this.process),this.nextId=0}add(r,o){const c=this.nextId++,p=function({type:m,isSymbolTile:y,zoom:x}){return x=x||0,m==="message"?0:m!=="maybePrepare"||y?m!=="parseTile"||y?m==="parseTile"&&y?300-x:m==="maybePrepare"&&y?400-x:500:200-x:100-x}(o);if(p===0){yi();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:r,metadata:o,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){yi();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const o=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let r=null,o=1/0;for(let p=0;p<this.taskQueue.length;p++){const m=this.tasks[this.taskQueue[p]];m.priority<o&&(o=m.priority,r=p)}if(r===null)return null;const c=this.taskQueue[r];return this.taskQueue.splice(r,1),c}remove(){this.invoker.remove()}}class DI{constructor(r){this._stringToNumber={},this._numberToString=[];for(let o=0;o<r.length;o++){const c=r[o];this._stringToNumber[c]=o,this._numberToString[o]=c}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const dL=["tile","layer","source","sourceLayer","state"];class MI{constructor(r,o,c,p,m){this.type="Feature",this._vectorTileFeature=r,this._z=o,this._x=c,this._y=p,this.properties=r.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(r.id=this.id);for(const o of dL)this[o]!==void 0&&(r[o]=this[o]);return r}}const na=32,ss=33,jl=new Uint16Array(8184);for(let i=0;i<2046;i++){let r=i+2,o=0,c=0,p=0,m=0,y=0,x=0;for(1&r?p=m=y=na:o=c=x=na;(r>>=1)>1;){const S=o+p>>1,k=c+m>>1;1&r?(p=o,m=c,o=y,c=x):(o=p,c=m,p=y,m=x),y=S,x=k}const E=4*i;jl[E+0]=o,jl[E+1]=c,jl[E+2]=p,jl[E+3]=m}const ls=new Uint16Array(2178),Vl=new Uint8Array(1089),Eg=new Uint16Array(1089);function zI(i){return i===0?-.03125:i===32?.03125:0}var RI=Ie([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const OI={type:2,extent:Ot,loadGeometry:()=>[[new xe(0,0),new xe(Ot+1,0),new xe(Ot+1,Ot+1),new xe(0,Ot+1),new xe(0,0)]]};class f1{constructor(r,o,c,p,m){this.tileID=r,this.uid=ur(),this.uses=0,this.tileSize=o,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(r){const o=r+this.timeAdded;o<_a.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=uu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,o,c){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(p,m){const y={};if(!m)return y;for(const x of p){const E=x.layerIds.map(S=>m.getLayer(S)).filter(Boolean);if(E.length!==0){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(S=>E.filter(k=>k.id===S)[0]));for(const S of E)y[S.id]=x}}return y}(r.buckets,o.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const m=this.buckets[p];if(m instanceof Ul){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const m=this.buckets[p];if(m instanceof Ul&&m.hasRTLText){this.hasRTLText=!0,I.isLoading()||I.isLoaded()||b()!=="deferred"||A();break}}this.queryPadding=0;for(const p in this.buckets){const m=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(p).queryRadius(m))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Or}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(r)}const o=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new xf(r,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new xf(r,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new xf(r,this.lineAtlas.image,o.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,o,c,p,m,y,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:x,transform:y,params:m,tileTransform:this.tileTransform},r,o,c):{}}querySourceFeatures(r,o){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),m=o?o.sourceLayer:"",y=p._geojsonTileLayer||p[m];if(!y)return;const x=ph(o&&o.filter),{z:E,x:S,y:k}=this.tileID.canonical,M={z:E,x:S,y:k};for(let O=0;O<y.length;O++){const j=y.feature(O);if(x.needGeometry){const ee=su(j,!0);if(!x.filter(new D(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!x.filter(new D(this.tileID.overscaledZ),j))continue;const G=c.getId(j,m),K=new MI(j,E,S,k,G);K.tile=M,r.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const o=this.expirationTime;if(r.cacheControl){const c=Yn(r.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(o)if(this.expirationTime<o)p=!0;else{const m=this.expirationTime-o;m?this.expirationTime=c+Math.max(m,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0||!o)return;const c=this.latestFeatureIndex.loadVTLayers(),p=o.style.listImages();for(const m in this.buckets){if(!o.style.hasLayer(m))continue;const y=this.buckets[m],x=y.layers[0].sourceLayer||"_geojsonTileLayer",E=c[x],S=r[x];if(!E||!S||Object.keys(S).length===0)continue;if(y.update(S,E,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof lg||y instanceof ng){const M=o.style._getSourceCache(y.layers[0].source);o._terrain&&o._terrain.enabled&&M&&y.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(M.id,this.tileID)}const k=o&&o.style&&o.style.getLayer(m);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_a.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=_a.now()+r}setTexture(r,o){const c=o.context,p=c.gl;this.texture=this.texture||o.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new xf(c,r,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(r,o){const c={};for(const p of o)c[p]=!0;this.dependencies[r]=c}hasDependency(r,o){for(const c of r){const p=this.dependencies[c];if(p){for(const m of o)if(p[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const c=Hs(OI,this.tileID.canonical,this.tileTransform)[0],p=new st,m=new ao;for(let y=0;y<c.length;y++){const{x,y:E}=c[y];p.emplaceBack(x,E),m.emplaceBack(y)}m.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(m),this._tileDebugBuffer=r.createVertexBuffer(p,Yp.members),this._tileDebugSegments=xn.simpleSegment(0,0,p.length,m.length)}_makeTileBoundsBuffers(r,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const c=Hs(OI,this.tileID.canonical,this.tileTransform)[0];let p,m;if(this.isRaster){const y=function(x,E){const S=uu(x,E),k=Math.pow(2,x.z);for(let ee=0;ee<ss;ee++)for(let le=0;le<ss;le++){const me=Po((x.x+(le+zI(le))/na)/k),ce=hi((x.y+(ee+zI(ee))/na)/k),pe=E.project(me,ce),_e=ee*ss+le;ls[2*_e+0]=Math.round((pe.x*S.scale-S.x)*Ot),ls[2*_e+1]=Math.round((pe.y*S.scale-S.y)*Ot)}Vl.fill(0),Eg.fill(0);for(let ee=2045;ee>=0;ee--){const le=4*ee,me=jl[le+0],ce=jl[le+1],pe=jl[le+2],_e=jl[le+3],ye=me+pe>>1,Oe=ce+_e>>1,Me=ye+Oe-ce,He=Oe+me-ye,lt=ce*ss+me,Ue=_e*ss+pe,Qe=Oe*ss+ye,Je=Math.hypot((ls[2*lt+0]+ls[2*Ue+0])/2-ls[2*Qe+0],(ls[2*lt+1]+ls[2*Ue+1])/2-ls[2*Qe+1])>=16;Vl[Qe]=Vl[Qe]||(Je?1:0),ee<1022&&(Vl[Qe]=Vl[Qe]||Vl[(ce+He>>1)*ss+(me+Me>>1)]||Vl[(_e+He>>1)*ss+(pe+Me>>1)])}const M=new Ke,O=new Pt;let j=0;function G(ee,le){const me=le*ss+ee;return Eg[me]===0&&(M.emplaceBack(ls[2*me+0],ls[2*me+1],ee*Ot/na,le*Ot/na),Eg[me]=++j),Eg[me]-1}function K(ee,le,me,ce,pe,_e){const ye=ee+me>>1,Oe=le+ce>>1;if(Math.abs(ee-pe)+Math.abs(le-_e)>1&&Vl[Oe*ss+ye])K(pe,_e,ee,le,ye,Oe),K(me,ce,pe,_e,ye,Oe);else{const Me=G(ee,le),He=G(me,ce),lt=G(pe,_e);O.emplaceBack(Me,He,lt)}}return K(0,0,na,na,na,0),K(na,na,0,0,0,na),{vertices:M,indices:O}}(this.tileID.canonical,o);p=y.vertices,m=y.indices}else{p=new Ke,m=new Pt;for(const{x,y:E}of c)p.emplaceBack(x,E,0,0);const y=Zx(p.int16,void 0,4);for(let x=0;x<y.length;x+=3)m.emplaceBack(y[x],y[x+1],y[x+2])}this._tileBoundsBuffer=r.createVertexBuffer(p,RI.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(m),this._tileBoundsSegments=xn.simpleSegment(0,0,p.length,m.length)}_makeGlobeTileDebugBuffers(r,o){const c=o.projection;if(!c||c.name!=="globe"||o.freezeTileCoverage)return;const p=this.tileID.canonical,m=ef(r2(p,o)),y=Eh(o.zoom);let x;y>0&&(x=wx(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,p,o,m,x,y),this._makeGlobeTileDebugTextBuffer(r,p,o,m,x,y)}_globePoint(r,o,c,p,m,y,x){let E=Jp(r,o,c);if(y){const S=1<<c.z,k=os(p.center.lng),M=as(p.center.lat),O=(c.x+.5)/S-k;let j=0;O>.5?j=-1:O<-.5&&(j=1);let G=(r/Ot+c.x)/S+j,K=(o/Ot+c.y)/S;G=(G-k)*p._pixelsPerMercatorPixel+k,K=(K-M)*p._pixelsPerMercatorPixel+M;const ee=[G*p.worldSize,K*p.worldSize,0];mn(ee,ee,y),E=au(E,ee,x)}return mn(E,E,m)}_makeGlobeTileDebugBorderBuffer(r,o,c,p,m,y){const x=new st,E=new ao,S=new De,k=(O,j,G,K,ee)=>{const le=(G-O)/(ee-1),me=(K-j)/(ee-1),ce=x.length;for(let pe=0;pe<ee;pe++){const _e=O+pe*le,ye=j+pe*me;x.emplaceBack(_e,ye);const Oe=this._globePoint(_e,ye,o,c,p,m,y);S.emplaceBack(Oe[0],Oe[1],Oe[2]),E.emplaceBack(ce+pe)}},M=Ot;k(0,0,M,0,16),k(M,0,M,M,16),k(M,M,0,M,16),k(0,M,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(E),this._tileDebugBuffer=r.createVertexBuffer(x,Yp.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(S,JA.members),this._tileDebugSegments=xn.simpleSegment(0,0,x.length,E.length)}_makeGlobeTileDebugTextBuffer(r,o,c,p,m,y){const x=Ot/4,E=new st,S=new Pt,k=new De,M=25;S.reserve(32),E.reserve(M),k.reserve(M);const O=(j,G)=>M*j+G;for(let j=0;j<M;j++){const G=j*x;for(let K=0;K<M;K++){const ee=K*x;E.emplaceBack(ee,G);const le=this._globePoint(ee,G,o,c,p,m,y);k.emplaceBack(le[0],le[1],le[2])}}for(let j=0;j<4;j++)for(let G=0;G<4;G++){const K=O(j,G),ee=O(j,G+1),le=O(j+1,G),me=O(j+1,G+1);S.emplaceBack(K,ee,le),S.emplaceBack(le,ee,me)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(S),this._tileDebugTextBuffer=r.createVertexBuffer(E,Yp.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(k,JA.members),this._tileDebugTextSegments=xn.simpleSegment(0,0,M,32)}}class pL{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,o,c){const p=String(o);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},nt(this.stateChanges[r][p],c),this.deletedStates[r]===null){this.deletedStates[r]={};for(const m in this.state[r])m!==p&&(this.deletedStates[r][m]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][p]===null){this.deletedStates[r][p]={};for(const m in this.state[r][p])c[m]||(this.deletedStates[r][p][m]=null)}else for(const m in c)this.deletedStates[r]&&this.deletedStates[r][p]&&this.deletedStates[r][p][m]===null&&delete this.deletedStates[r][p][m]}removeFeatureState(r,o,c){if(this.deletedStates[r]===null)return;const p=String(o);if(this.deletedStates[r]=this.deletedStates[r]||{},c&&o!==void 0)this.deletedStates[r][p]!==null&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][c]=null);else if(o!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][p])for(c in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][c]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,o){const c=String(o),p=nt({},(this.state[r]||{})[c],(this.stateChanges[r]||{})[c]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const m=this.deletedStates[r][o];if(m===null)return{};for(const y in m)delete p[y]}return p}initializeTileState(r,o){r.setFeatureState(this.state,o)}coalesceChanges(r,o){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const m={};for(const y in this.stateChanges[p])this.state[p][y]||(this.state[p][y]={}),nt(this.state[p][y],this.stateChanges[p][y]),m[y]=this.state[p][y];c[p]=m}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const m={};if(this.deletedStates[p]===null)for(const y in this.state[p])m[y]={},this.state[p][y]={};else for(const y in this.deletedStates[p]){if(this.deletedStates[p][y]===null)this.state[p][y]={};else if(this.state[p][y])for(const x of Object.keys(this.deletedStates[p][y]))delete this.state[p][y][x];m[y]=this.state[p][y]}c[p]=c[p]||{},nt(c[p],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const p in r)r[p].setFeatureState(c,o)}}class FI{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,o){const c=this.toIdx(r,o);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(r,o){return this.leaves[this.toIdx(r,o)]}toIdx(r,o){return o*this.size+r}}function LI(i,r,o,c){let p=0,m=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(c[y])<1e-15){if(o[y]<i[y]||o[y]>r[y])return null}else{const x=1/c[y];let E=(i[y]-o[y])*x,S=(r[y]-o[y])*x;if(E>S){const k=E;E=S,S=k}if(E>p&&(p=E),S<m&&(m=S),p>m)return null}return p}function BI(i,r,o,c,p,m,y,x,E,S,k){const M=c-i,O=p-r,j=m-o,G=y-i,K=x-r,ee=E-o,le=k[1]*ee-k[2]*K,me=k[2]*G-k[0]*ee,ce=k[0]*K-k[1]*G,pe=M*le+O*me+j*ce;if(Math.abs(pe)<1e-15)return null;const _e=1/pe,ye=S[0]-i,Oe=S[1]-r,Me=S[2]-o,He=(ye*le+Oe*me+Me*ce)*_e;if(He<0||He>1)return null;const lt=Oe*j-Me*O,Ue=Me*M-ye*j,Qe=ye*O-Oe*M,Je=(k[0]*lt+k[1]*Ue+k[2]*Qe)*_e;return Je<0||He+Je>1?null:(G*lt+K*Ue+ee*Qe)*_e}function NI(i,r,o){return(i-r)/(o-r)}function UI(i,r,o,c,p,m,y,x,E){const S=1<<o,k=m-c,M=y-p,O=(i+1)/S*k+c,j=(r+0)/S*M+p,G=(r+1)/S*M+p;x[0]=(i+0)/S*k+c,x[1]=j,E[0]=O,E[1]=G}class jI{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(m){const y=Math.ceil(Math.log2(m.dim/8)),x=[];let E=Math.ceil(Math.pow(2,y));const S=1/E,k=(j,G,K,ee,le)=>{const me=ee?1:0,ce=(j+1)*K-me,pe=G*K,_e=(G+1)*K-me;le[0]=j*K,le[1]=pe,le[2]=ce,le[3]=_e};let M=new FI(E);const O=[];for(let j=0;j<E*E;j++){k(j%E,Math.floor(j/E),S,!1,O);const G=$l(O[0],O[1],m),K=$l(O[2],O[1],m),ee=$l(O[2],O[3],m),le=$l(O[0],O[3],m);M.minimums.push(Math.min(G,K,ee,le)),M.maximums.push(Math.max(G,K,ee,le)),M.leaves.push(1)}for(x.push(M),E/=2;E>=1;E/=2){const j=x[x.length-1];M=new FI(E);for(let G=0;G<E*E;G++){k(G%E,Math.floor(G/E),2,!0,O);const K=j.getElevation(O[0],O[1]),ee=j.getElevation(O[2],O[1]),le=j.getElevation(O[2],O[3]),me=j.getElevation(O[0],O[3]),ce=j.isLeaf(O[0],O[1]),pe=j.isLeaf(O[2],O[1]),_e=j.isLeaf(O[2],O[3]),ye=j.isLeaf(O[0],O[3]),Oe=Math.min(K.min,ee.min,le.min,me.min),Me=Math.max(K.max,ee.max,le.max,me.max),He=ce&&pe&&_e&&ye;M.maximums.push(Me),M.minimums.push(Oe),M.leaves.push(Me-Oe<=5&&He?1:0)}x.push(M)}return x}(this.dem),c=o.length-1,p=o[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(o,0,0,c,0)}raycastRoot(r,o,c,p,m,y,x=1){return LI([r,o,-100],[c,p,this.maximums[0]*x],m,y)}raycast(r,o,c,p,m,y,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,o,c,p,m,y,x);if(E==null)return null;const S=[],k=[],M=[],O=[],j=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;j.length>0;){const{idx:G,t:K,nodex:ee,nodey:le,depth:me}=j.pop();if(this.leaves[G]){UI(ee,le,me,r,o,c,p,M,O);const pe=1<<me,_e=(ee+0)/pe,ye=(ee+1)/pe,Oe=(le+0)/pe,Me=(le+1)/pe,He=$l(_e,Oe,this.dem)*x,lt=$l(ye,Oe,this.dem)*x,Ue=$l(ye,Me,this.dem)*x,Qe=$l(_e,Me,this.dem)*x,Je=BI(M[0],M[1],He,O[0],M[1],lt,O[0],O[1],Ue,m,y),ot=BI(O[0],O[1],Ue,M[0],O[1],Qe,M[0],M[1],He,m,y),pt=Math.min(Je!==null?Je:Number.MAX_VALUE,ot!==null?ot:Number.MAX_VALUE);if(pt!==Number.MAX_VALUE)return pt;{const We=Kp([],m,y,K);if(VI(He,lt,Qe,Ue,NI(We[0],M[0],O[0]),NI(We[1],M[1],O[1]))>=We[2])return K}continue}let ce=0;for(let pe=0;pe<this._siblingOffset.length;pe++){UI((ee<<1)+this._siblingOffset[pe][0],(le<<1)+this._siblingOffset[pe][1],me+1,r,o,c,p,M,O),M[2]=-100,O[2]=this.maximums[this.childOffsets[G]+pe]*x;const _e=LI(M,O,m,y);if(_e!=null){const ye=_e;S[pe]=ye;let Oe=!1;for(let Me=0;Me<ce&&!Oe;Me++)ye>=S[k[Me]]&&(k.splice(Me,0,pe),Oe=!0);Oe||(k[ce]=pe),ce++}}for(let pe=0;pe<ce;pe++){const _e=k[pe];j.push({idx:this.childOffsets[G]+_e,t:S[_e],nodex:(ee<<1)+this._siblingOffset[_e][0],nodey:(le<<1)+this._siblingOffset[_e][1],depth:me+1})}}return null}_addNode(r,o,c){return this.minimums.push(r),this.maximums.push(o),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(r,o,c,p,m){if(r[p].isLeaf(o,c)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const y=p-1,x=r[y];let E=0,S=0;for(let k=0;k<this._siblingOffset.length;k++){const M=2*o+this._siblingOffset[k][0],O=2*c+this._siblingOffset[k][1],j=x.getElevation(M,O),G=x.isLeaf(M,O),K=this._addNode(j.min,j.max,G);G&&(E|=1<<k),S||(S=K)}for(let k=0;k<this._siblingOffset.length;k++)E&1<<k||this._construct(r,2*o+this._siblingOffset[k][0],2*c+this._siblingOffset[k][1],y,S+k)}}function VI(i,r,o,c,p,m){return dr(dr(i,o,m),dr(r,c,m),p)}function $l(i,r,o){const c=o.dim,p=qe(i*c-.5,0,c-1),m=qe(r*c-.5,0,c-1),y=Math.floor(p),x=Math.floor(m),E=Math.min(y+1,c-1),S=Math.min(x+1,c-1);return VI(o.get(y,x),o.get(E,x),o.get(y,S),o.get(E,S),p-y,m-x)}const $I={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function fL(i,r,o){return(256*i*256+256*r+o)/10-1e4}function mL(i,r,o){return 256*i+r+o/256-32768}class Sg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,o,c,p=!1,m=!1){if(this.uid=r,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return Tr(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const y=this.dim=o.height-2,x=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.encoding=c||"mapbox",this.borderReady=p,!p){for(let E=0;E<y;E++)x[this._idx(-1,E)]=x[this._idx(0,E)],x[this._idx(y,E)]=x[this._idx(y-1,E)],x[this._idx(E,-1)]=x[this._idx(E,0)],x[this._idx(E,y)]=x[this._idx(E,y-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(y,-1)]=x[this._idx(y-1,0)],x[this._idx(-1,y)]=x[this._idx(0,y-1)],x[this._idx(y,y)]=x[this._idx(y-1,y-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new jI(this)}get(r,o,c=!1){c&&(r=qe(r,-1,this.dim),o=qe(o,-1,this.dim));const p=4*this._idx(r,o);return(this.encoding==="terrarium"?mL:fL)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(r){return $I[r]}get unpackVector(){return $I[this.encoding]}_idx(r,o){if(r<-1||r>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(r+1)}static pack(r,o){const c=[0,0,0,0],p=Sg.getUnpackVector(o);let m=Math.floor((r+p[3])/p[2]);return c[2]=m%256,m=Math.floor(m/256),c[1]=m%256,m=Math.floor(m/256),c[0]=m,c}getPixels(){return new lo({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,o,c){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=o*this.dim,m=o*this.dim+this.dim,y=c*this.dim,x=c*this.dim+this.dim;switch(o){case-1:p=m-1;break;case 1:m=p+1}switch(c){case-1:y=x-1;break;case 1:x=y+1}const E=-o*this.dim,S=-c*this.dim;for(let k=y;k<x;k++)for(let M=p;M<m;M++){const O=4*this._idx(M,k),j=4*this._idx(M+E,k+S);this.pixels[O+0]=r.pixels[j+0],this.pixels[O+1]=r.pixels[j+1],this.pixels[O+2]=r.pixels[j+2],this.pixels[O+3]=r.pixels[j+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Tt(Sg,"DEMData"),Tt(jI,"DemMinMaxQuadTree",{omit:["dem"]});class gL{constructor(r,o){this.max=r,this.onRemove=o,this.reset()}reset(){for(const r in this.data)for(const o of this.data[r])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(r,o,c){const p=r.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const m={value:o,timeout:void 0};if(c!==void 0&&(m.timeout=setTimeout(()=>{this.remove(r,m)},c)),this.data[p].push(m),this.order.push(p),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const o=this.data[r].shift();return o.timeout&&clearTimeout(o.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),o.value}getByKey(r){const o=this.data[r];return o?o[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,o){if(!this.has(r))return this;const c=r.wrapped().key,p=o===void 0?0:this.data[c].indexOf(o),m=this.data[c][p];return this.data[c].splice(p,1),m.timeout&&clearTimeout(m.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(r){const o=[];for(const c in this.data)for(const p of this.data[c])r(p.value)||o.push(p);for(const c of o)this.remove(c.value.tileID,c)}}class Bh{constructor(r,o,c){this.func=r,this.mask=o,this.range=c}}Bh.ReadOnly=!1,Bh.ReadWrite=!0,Bh.disabled=new Bh(519,Bh.ReadOnly,[0,1]);const m1=7680;class g1{constructor(r,o,c,p,m,y){this.test=r,this.ref=o,this.mask=c,this.fail=p,this.depthFail=m,this.pass=y}}g1.disabled=new g1({func:519,mask:0},0,0,m1,m1,m1);class cs{constructor(r,o,c){this.blendFunction=r,this.blendColor=o,this.mask=c}}cs.Replace=[1,0],cs.disabled=new cs(cs.Replace,fn.transparent,[!1,!1,!1,!1]),cs.unblended=new cs(cs.Replace,fn.transparent,[!0,!0,!0,!0]),cs.alphaBlended=new cs([1,771],fn.transparent,[!0,!0,!0,!0]);const y1=1029,_1=2305;class Fa{constructor(r,o,c){this.enable=r,this.mode=o,this.frontFace=c}}Fa.disabled=new Fa(!1,y1,_1),Fa.backCCW=new Fa(!0,y1,_1),Fa.backCW=new Fa(!0,y1,2304),Fa.frontCW=new Fa(!0,1028,2304),Fa.frontCCW=new Fa(!0,1028,_1);class hu extends Cc{constructor(r,o,c){super(),this.id=r,this._onlySymbols=c,o.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new gL(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new pL,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const o=this._tiles[r];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,o){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,o)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const c=this._tiles[o];c.upload(r),c.prepare(this.map.style.imageManager)}}getIds(){return et(this._tiles).map(r=>r.tileID).sort(WI).map(r=>r.key)}getRenderableIds(r){const o=[];for(const c in this._tiles)this._isIdRenderable(+c,r)&&o.push(this._tiles[c]);return r?o.sort((c,p)=>{const m=c.tileID,y=p.tileID,x=new xe(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new xe(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-y.overscaledZ||E.y-x.y||E.x-x.x}).map(c=>c.tileID.key):o.map(c=>c.tileID).sort(WI).map(c=>c.key)}hasRenderableParent(r){const o=this.findLoadedParent(r,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(r,o){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(o||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,o){const c=this._tiles[r];c&&(c.state!=="loading"&&(c.state=o),this._loadTile(c,this._tileLoaded.bind(this,c,r,o)))}_tileLoaded(r,o,c,p){if(p)if(r.state="errored",p.status!==404)this._source.fire(new va(p,{tile:r}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=_a.now(),c==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(o,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Ms("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const o=this.getRenderableIds();for(let p=0;p<o.length;p++){const m=o[p];if(r.neighboringTiles&&r.neighboringTiles[m]){const y=this.getTileByID(m);c(r,y),c(y,r)}}function c(p,m){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let y=m.tileID.canonical.x-p.tileID.canonical.x;const x=m.tileID.canonical.y-p.tileID.canonical.y,E=Math.pow(2,p.tileID.canonical.z),S=m.tileID.key;y===0&&x===0||Math.abs(x)>1||(Math.abs(y)>1&&(Math.abs(y+E)===1?y+=E:Math.abs(y-E)===1&&(y-=E)),m.dem&&p.dem&&(p.dem.backfillBorder(m.dem,y,x),p.neighboringTiles&&p.neighboringTiles[S]&&(p.neighboringTiles[S].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,o,c,p){for(const m in this._tiles){let y=this._tiles[m];if(p[m]||!y.hasData()||y.tileID.overscaledZ<=o||y.tileID.overscaledZ>c)continue;let x=y.tileID;for(;y&&y.tileID.overscaledZ>o+1;){const S=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[S.key],y&&y.hasData()&&(x=S)}let E=x;for(;E.overscaledZ>o;)if(E=E.scaledTo(E.overscaledZ-1),r[E.key]){p[x.key]=x;break}}}findLoadedParent(r,o){if(r.key in this._loadedParentTiles){const c=this._loadedParentTiles[r.key];return c&&c.tileID.overscaledZ>=o?c:null}for(let c=r.overscaledZ-1;c>=o;c--){const p=r.scaledTo(c),m=this._getLoadedTile(p);if(m)return m}}_getLoadedTile(r){const o=this._tiles[r.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,o){o=o||this._source.tileSize;const c=Math.ceil(r.width/o)+1,p=Math.ceil(r.height/o)+1,m=Math.floor(c*p*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(r){const o=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,o){const c={};for(const p in this._tiles){const m=this._tiles[p];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+o),c[m.tileID.key]=m}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(r,o,c){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let p;this.updateCacheSize(r,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new zi(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(p=r.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(x=>this._source.hasTile(x)))):p=[];const m=this._updateRetainedTiles(p);if(GI(this._source.type)&&p.length!==0){const x={},E={},S=Object.keys(m);for(const M of S){const O=m[M],j=this._tiles[M];if(!j||j.fadeEndTime&&j.fadeEndTime<=_a.now())continue;const G=this.findLoadedParent(O,Math.max(O.overscaledZ-hu.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),x[G.tileID.key]=G.tileID),E[M]=O}const k=p[p.length-1].overscaledZ;for(const M in this._tiles){const O=this._tiles[M];if(m[M]||!O.hasData())continue;let j=O.tileID;for(;j.overscaledZ>k;){j=j.scaledTo(j.overscaledZ-1);const G=this._tiles[j.key];if(G&&G.hasData()&&E[j.key]){m[M]=O.tileID;break}}}for(const M in x)m[M]||(this._coveredTiles[M]=!0,m[M]=x[M])}for(const x in m)this._tiles[x].clearFadeHold();const y=function(x,E){const S=[];for(const k in x)k in E||S.push(k);return S}(this._tiles,m);for(const x of y){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const o={};if(r.length===0)return o;const c={},p=r.reduce((S,k)=>Math.min(S,k.overscaledZ),1/0),m=r[0].overscaledZ,y=Math.max(m-hu.maxOverzooming,this._source.minzoom),x=Math.max(m+hu.maxUnderzooming,this._source.minzoom),E={};for(const S of r){const k=this._addTile(S);o[S.key]=S,k.hasData()||p<this._source.maxzoom&&(E[S.key]=S)}this._retainLoadedChildren(E,p,x,o);for(const S of r){let k=this._tiles[S.key];if(k.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const O=S.children(this._source.maxzoom)[0],j=this.getTile(O);if(j&&j.hasData()){o[O.key]=O;continue}}else{const O=S.children(this._source.maxzoom);if(o[O[0].key]&&o[O[1].key]&&o[O[2].key]&&o[O[3].key])continue}let M=k.wasRequested();for(let O=S.overscaledZ-1;O>=y;--O){const j=S.scaledTo(O);if(c[j.key]||(c[j.key]=!0,k=this.getTile(j),!k&&M&&(k=this._addTile(j)),k&&(o[j.key]=j,M=k.wasRequested(),k.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const o=[];let c,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}o.push(p.key);const m=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(m),c)break;p=m}for(const m of o)this._loadedParentTiles[m]=c}}_addTile(r){let o=this._tiles[r.key];if(o)return o;o=this._cache.getAndRemove(r),o&&(this._setTileReloadTimer(r.key,o),o.tileID=r,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,o)));const c=!!o;if(!c){const p=this.map?this.map.painter:null;o=new f1(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,r.key,o.state))}return o?(o.uses++,this._tiles[r.key]=o,c||this._source.fire(new Ms("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(r,o){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const c=o.getExpiryTimeout();c&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},c))}_removeTile(r){const o=this._tiles[r];o&&(o.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,o,c){const p=[],m=this.transform;if(!m)return p;const y=m.projection.name==="globe",x=os(m.center.lng);for(const E in this._tiles){const S=this._tiles[E];if(c&&S.clearQueryDebugViz(),S.holdingForFade())continue;let k;if(y){const M=S.tileID.canonical;if(M.z===0){const O=[Math.abs(qe(x,...bf(M,-1))-x),Math.abs(qe(x,...bf(M,1))-x)];k=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(qe(x,...bf(M,-1))-x),Math.abs(qe(x,...bf(M,0))-x),Math.abs(qe(x,...bf(M,1))-x)];k=[O.indexOf(Math.min(...O))-1]}}else k=[0];for(const M of k){const O=r.containsTile(S,m,o,M);O&&p.push(O)}}return p}getVisibleCoordinates(r){const o=this.getRenderableIds(r).map(c=>this._tiles[c].tileID);for(const c of o)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(GI(this._source.type))for(const r in this._tiles){const o=this._tiles[r];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=_a.now())return!0}return!1}setFeatureState(r,o,c){this._state.updateState(r=r||"_geojsonTileLayer",o,c)}removeFeatureState(r,o,c){this._state.removeFeatureState(r=r||"_geojsonTileLayer",o,c)}getFeatureState(r,o){return this._state.getState(r=r||"_geojsonTileLayer",o)}setDependencies(r,o,c){const p=this._tiles[r];p&&p.setDependencies(o,c)}reloadTilesForDependencies(r,o){for(const c in this._tiles)this._tiles[c].hasDependency(r,o)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(r,o))}_preloadTiles(r,o){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(r,o))};return void this._source.on("data",x)}const c=new Map,p=Array.isArray(r)?r:[r],m=this.map.painter.terrain,y=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const x of p){const E=x.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of E)c.set(S.key,S);this.usedForTerrain&&x.updateElevation(!1)}je(Array.from(c.values()),(x,E)=>{const S=new f1(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,k=>{this._source.type==="raster-dem"&&S.dem&&this._backfillDEM(S),E(k,S)})},o)}}function WI(i,r){const o=Math.abs(2*i.wrap)-+(i.wrap<0),c=Math.abs(2*r.wrap)-+(r.wrap<0);return i.overscaledZ-r.overscaledZ||c-o||r.canonical.y-i.canonical.y||r.canonical.x-i.canonical.x}function GI(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function bf(i,r){const o=1<<i.z;return[i.x/o+r,(i.x+1)/o+r]}hu.maxOverzooming=10,hu.maxUnderzooming=3;class Tg{constructor(r,o,c){this._demTile=r,this._dem=this._demTile.dem,this._scale=o,this._offset=c}static create(r,o,c){const p=c||r.findDEMTileFor(o);if(!p||!p.dem)return;const m=p.dem,y=p.tileID,x=1<<o.canonical.z-y.canonical.z;return new Tg(p,p.tileSize/Ot/x,[(o.canonical.x/x-y.canonical.x)*m.dim,(o.canonical.y/x-y.canonical.y)*m.dim])}tileCoordToPixel(r,o){const c=o*this._scale+this._offset[1],p=Math.floor(r*this._scale+this._offset[0]),m=Math.floor(c);return new xe(p,m)}getElevationAt(r,o,c,p){const m=r*this._scale+this._offset[0],y=o*this._scale+this._offset[1],x=Math.floor(m),E=Math.floor(y),S=this._dem;return p=!!p,c?dr(dr(S.get(x,E,p),S.get(x,E+1,p),y-E),dr(S.get(x+1,E,p),S.get(x+1,E+1,p),y-E),m-x):S.get(x,E,p)}getElevationAtPixel(r,o,c){return this._dem.get(r,o,!!c)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*za(1,r)*this._dem.stride}}class HI{constructor(r,o){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Ns(Ot,16,0),this.featureIndexArray=new Jc,this.promoteId=o}insert(r,o,c,p,m,y=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,m,y);const E=this.grid;for(let S=0;S<o.length;S++){const k=o[S],M=[1/0,1/0,-1/0,-1/0];for(let O=0;O<k.length;O++){const j=k[O];M[0]=Math.min(M[0],j.x),M[1]=Math.min(M[1],j.y),M[2]=Math.max(M[2],j.x),M[3]=Math.max(M[3],j.y)}M[0]<Ot&&M[1]<Ot&&M[2]>=0&&M[3]>=0&&E.insert(x,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Qx(new hg(this.rawTileData)).layers,this.sourceLayerCoder=new DI(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,o,c,p){this.loadVTLayers();const m=r.params||{},y=ph(m.filter),x=r.tileResult,E=r.transform,S=x.bufferedTilespaceBounds,k=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(G,K,ee,le)=>y2(x.bufferedTilespaceGeometry,G,K,ee,le));k.sort(yL);let M=null;E.elevation&&k.length>0&&(M=Tg.create(E.elevation,this.tileID));const O={};let j;for(let G=0;G<k.length;G++){const K=k[G];if(K===j)continue;j=K;const ee=this.featureIndexArray.get(K);let le=null;this.loadMatchingFeature(O,ee,y,m.layers,m.availableImages,o,c,p,(me,ce,pe,_e=0)=>(le||(le=Hs(me,this.tileID.canonical,r.tileTransform)),ce.queryIntersectsFeature(x,me,pe,le,this.z,r.transform,r.pixelPosMatrix,M,_e)))}return O}loadMatchingFeature(r,o,c,p,m,y,x,E,S){const{featureIndex:k,bucketIndex:M,sourceLayerIndex:O,layoutVertexArrayOffset:j}=o,G=this.bucketLayerIDs[M];if(p&&!function(me,ce){for(let pe=0;pe<me.length;pe++)if(ce.indexOf(me[pe])>=0)return!0;return!1}(p,G))return;const K=this.sourceLayerCoder.decode(O),ee=this.vtLayers[K].feature(k);if(c.needGeometry){const me=su(ee,!0);if(!c.filter(new D(this.tileID.overscaledZ),me,this.tileID.canonical))return}else if(!c.filter(new D(this.tileID.overscaledZ),ee))return;const le=this.getId(ee,K);for(let me=0;me<G.length;me++){const ce=G[me];if(p&&p.indexOf(ce)<0)continue;const pe=y[ce];if(!pe)continue;let _e={};le!==void 0&&E&&(_e=E.getState(pe.sourceLayer||"_geojsonTileLayer",le));const ye=nt({},x[ce]);ye.paint=qI(ye.paint,pe.paint,ee,_e,m),ye.layout=qI(ye.layout,pe.layout,ee,_e,m);const Oe=!S||S(ee,pe,_e,j);if(!Oe)continue;const Me=new MI(ee,this.z,this.x,this.y,le);Me.layer=ye;let He=r[ce];He===void 0&&(He=r[ce]=[]),He.push({featureIndex:k,feature:Me,intersectionZ:Oe})}}lookupSymbolFeatures(r,o,c,p,m,y,x,E){const S={};this.loadVTLayers();const k=ph(m);for(const M of r)this.loadMatchingFeature(S,{bucketIndex:c,sourceLayerIndex:p,featureIndex:M,layoutVertexArrayOffset:0},k,y,x,E,o);return S}loadFeature(r){const{featureIndex:o,sourceLayerIndex:c}=r;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),m=this.vtFeatures[p];if(m[o])return m[o];const y=this.vtLayers[p].feature(o);return m[o]=y,y}hasLayer(r){for(const o of this.bucketLayerIDs)for(const c of o)if(r===c)return!0;return!1}getId(r,o){let c=r.id;if(this.promoteId){const p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];p!=null&&(c=r.properties[p]),typeof c=="boolean"&&(c=Number(c))}return c}}function qI(i,r,o,c,p){return Vt(i,(m,y)=>{const x=r instanceof ae?r.get(y):null;return x&&x.evaluate?x.evaluate(o,c,p):x})}function yL(i,r){return r-i}Tt(HI,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class ZI{constructor(r,o){this.width=r,this.height=o,this.nextRow=0,this.image=new qs({width:r,height:o}),this.positions={},this.uploaded=!1}getDash(r,o){const c=this.getKey(r,o);return this.positions[c]}trim(){const r=this.width,o=this.height=Pr(this.nextRow);this.image.resize({width:r,height:o})}getKey(r,o){return r.join(",")+o}getDashRanges(r,o,c){const p=[];let m=r.length%2==1?-r[r.length-1]*c:0,y=r[0]*c,x=!0;p.push({left:m,right:y,isDash:x,zeroLength:r[0]===0});let E=r[0];for(let S=1;S<r.length;S++){x=!x;const k=r[S];m=E*c,E+=k,y=E*c,p.push({left:m,right:y,isDash:x,zeroLength:k===0})}return p}addRoundDash(r,o,c){const p=o/2;for(let m=-c;m<=c;m++){const y=this.width*(this.nextRow+c+m);let x=0,E=r[x];for(let S=0;S<this.width;S++){S/E.right>1&&(E=r[++x]);const k=Math.abs(S-E.left),M=Math.abs(S-E.right),O=Math.min(k,M);let j;const G=m/c*(p+1);if(E.isDash){const K=p-Math.abs(G);j=Math.sqrt(O*O+K*K)}else j=p-Math.sqrt(O*O+G*G);this.image.data[y+S]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(r,o){for(let E=r.length-1;E>=0;--E){const S=r[E],k=r[E+1];S.zeroLength?r.splice(E,1):k&&k.isDash===S.isDash&&(k.left=S.left,r.splice(E,1))}const c=r[0],p=r[r.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const m=this.width*this.nextRow;let y=0,x=r[y];for(let E=0;E<this.width;E++){E/x.right>1&&(x=r[++y]);const S=Math.abs(E-x.left),k=Math.abs(E-x.right),M=Math.min(S,k);this.image.data[m+E]=Math.max(0,Math.min(255,(x.isDash?M:-M)+o+128))}}addDash(r,o){const c=this.getKey(r,o);if(this.positions[c])return this.positions[c];const p=o==="round",m=p?7:0,y=2*m+1;if(this.nextRow+y>this.height)return Tr("LineAtlas out of space"),null;r.length===0&&r.push(1);let x=0;for(let k=0;k<r.length;k++)r[k]<0&&(Tr("Negative value is found in line dasharray, replacing values with 0"),r[k]=0),x+=r[k];if(x!==0){const k=this.width/x,M=this.getDashRanges(r,this.width,k);p?this.addRoundDash(M,k,m):this.addRegularDash(M,o==="square"?.5*k:0)}const E=this.nextRow+m;this.nextRow+=y;const S={tl:[E,m],br:[x,0]};return this.positions[c]=S,S}}Tt(ZI,"LineAtlas");const KI=1*Oa;class XI{constructor(r){const o={},c=[];for(const x in r){const E=r[x],S=o[x]={};for(const k in E.glyphs){const M=E.glyphs[+k];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const O=M.metrics.localGlyph?KI:1,j={x:0,y:0,w:M.bitmap.width+2*O,h:M.bitmap.height+2*O};c.push(j),S[k]=j}}const{w:p,h:m}=r1(c),y=new qs({width:p||1,height:m||1});for(const x in r){const E=r[x];for(const S in E.glyphs){const k=E.glyphs[+S];if(!k||k.bitmap.width===0||k.bitmap.height===0)continue;const M=o[x][S],O=k.metrics.localGlyph?KI:1;qs.copy(k.bitmap,y,{x:0,y:0},{x:M.x+O,y:M.y+O},k.bitmap)}}this.image=y,this.positions=o}}Tt(XI,"GlyphAtlas");class _L{constructor(r){this.tileID=new zi(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=uu(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,o,c,p,m){this.status="parsing",this.data=r,this.collisionBoxArray=new Or;const y=new DI(Object.keys(r.layers).sort()),x=new HI(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},S=new ZI(256,256),k={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:c},M=o.familiesBySource[this.source];for(const _e in M){const ye=r.layers[_e];if(!ye)continue;let Oe=!1,Me=!1;for(const Ue of M[_e])Ue[0].type==="symbol"?Oe=!0:Me=!0;if(this.isSymbolTile===!0&&!Oe||this.isSymbolTile===!1&&!Me)continue;ye.version===1&&Tr(`Vector tile source "${this.source}" layer "${_e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const He=y.encode(_e),lt=[];for(let Ue=0;Ue<ye.length;Ue++){const Qe=ye.feature(Ue),Je=x.getId(Qe,_e);lt.push({feature:Qe,id:Je,index:Ue,sourceLayerIndex:He})}for(const Ue of M[_e]){const Qe=Ue[0];this.isSymbolTile!==void 0&&Qe.type==="symbol"!==this.isSymbolTile||Qe.minzoom&&this.zoom<Math.floor(Qe.minzoom)||Qe.maxzoom&&this.zoom>=Qe.maxzoom||Qe.visibility!=="none"&&(v1(Ue,this.zoom,c),(E[Qe.id]=Qe.createBucket({index:x.bucketLayerIDs.length,layers:Ue,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:He,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(lt,k,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Ue.map(Je=>Je.id)))}}let O,j,G,K;S.trim();const ee={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},le=()=>{if(O)return m(O);if(j&&G&&K){const _e=new XI(j),ye=new nI(G,K);for(const Oe in E){const Me=E[Oe];Me instanceof Ul?(v1(Me.layers,this.zoom,c),WF(Me,j,_e.positions,G,ye.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):Me.hasPattern&&(Me instanceof lg||Me instanceof ng||Me instanceof cf)&&(v1(Me.layers,this.zoom,c),Me.addFeatures(k,this.tileID.canonical,ye.patternPositions,c,this.tileTransform))}this.status="done",m(null,{buckets:et(E).filter(Oe=>!Oe.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_e.image,lineAtlas:S,imageAtlas:ye,glyphMap:this.returnDependencies?j:null,iconMap:this.returnDependencies?G:null,glyphPositions:this.returnDependencies?_e.positions:null})}},me=Vt(k.glyphDependencies,_e=>Object.keys(_e).map(Number));Object.keys(me).length?p.send("getGlyphs",{uid:this.uid,stacks:me},(_e,ye)=>{O||(O=_e,j=ye,le())},void 0,!1,ee):j={};const ce=Object.keys(k.iconDependencies);ce.length?p.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"icons"},(_e,ye)=>{O||(O=_e,G=ye,le())},void 0,!1,ee):G={};const pe=Object.keys(k.patternDependencies);pe.length?p.send("getImages",{icons:pe,source:this.source,tileID:this.tileID,type:"patterns"},(_e,ye)=>{O||(O=_e,K=ye,le())},void 0,!1,ee):K={},le()}}function v1(i,r,o){const c=new D(r);for(const p of i)p.recalculate(c,o)}class YI{constructor(r){this.entries={},this.scheduler=r}request(r,o,c,p){const m=this.entries[r]=this.entries[r]||{callbacks:[]};if(m.result){const[y,x]=m.result;return this.scheduler?this.scheduler.add(()=>{p(y,x)},o):p(y,x),()=>{}}return m.callbacks.push(p),m.cancel||(m.cancel=c((y,x)=>{m.result=[y,x];for(const E of m.callbacks)this.scheduler?this.scheduler.add(()=>{E(y,x)},o):E(y,x);setTimeout(()=>delete this.entries[r],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(y=>y!==p),m.callbacks.length||(m.cancel(),delete this.entries[r]))}}}function QI(i,r,o){const c=JSON.stringify(i.request);return i.data&&(this.deduped.entries[c]={result:[null,i.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},p=>{const m=Ja(i.request,(y,x,E,S)=>{y?p(y):x&&p(null,{vectorTile:o?void 0:new Qx(new hg(x)),rawData:x,cacheControl:E,expires:S})});return()=>{m.cancel(),p()}},r)}const JI=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class x1{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,c]=new Uint8Array(r,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const m=JI[15&c];if(!m)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(r,2,1),[x]=new Uint32Array(r,4,1);return new x1(x,y,m,r)}constructor(r,o=64,c=Float64Array,p){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=c,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const m=JI.indexOf(this.ArrayType),y=2*r*this.ArrayType.BYTES_PER_ELEMENT,x=r*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-x%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+x+E,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+y+x+E),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+x+E,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=r)}add(r,o){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=r,this.coords[this._pos++]=o,c}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return b1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,o,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:x}=this,E=[0,m.length-1,0],S=[];for(;E.length;){const k=E.pop()||0,M=E.pop()||0,O=E.pop()||0;if(M-O<=x){for(let ee=O;ee<=M;ee++){const le=y[2*ee],me=y[2*ee+1];le>=r&&le<=c&&me>=o&&me<=p&&S.push(m[ee])}continue}const j=O+M>>1,G=y[2*j],K=y[2*j+1];G>=r&&G<=c&&K>=o&&K<=p&&S.push(m[j]),(k===0?r<=G:o<=K)&&(E.push(O),E.push(j-1),E.push(1-k)),(k===0?c>=G:p>=K)&&(E.push(j+1),E.push(M),E.push(1-k))}return S}within(r,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:y}=this,x=[0,p.length-1,0],E=[],S=c*c;for(;x.length;){const k=x.pop()||0,M=x.pop()||0,O=x.pop()||0;if(M-O<=y){for(let ee=O;ee<=M;ee++)tC(m[2*ee],m[2*ee+1],r,o)<=S&&E.push(p[ee]);continue}const j=O+M>>1,G=m[2*j],K=m[2*j+1];tC(G,K,r,o)<=S&&E.push(p[j]),(k===0?r-c<=G:o-c<=K)&&(x.push(O),x.push(j-1),x.push(1-k)),(k===0?r+c>=G:o+c>=K)&&(x.push(j+1),x.push(M),x.push(1-k))}return E}}function b1(i,r,o,c,p,m){if(p-c<=o)return;const y=c+p>>1;eC(i,r,y,c,p,m),b1(i,r,o,c,y-1,1-m),b1(i,r,o,y+1,p,1-m)}function eC(i,r,o,c,p,m){for(;p>c;){if(p-c>600){const S=p-c+1,k=o-c+1,M=Math.log(S),O=.5*Math.exp(2*M/3),j=.5*Math.sqrt(M*O*(S-O)/S)*(k-S/2<0?-1:1);eC(i,r,o,Math.max(c,Math.floor(o-k*O/S+j)),Math.min(p,Math.floor(o+(S-k)*O/S+j)),m)}const y=r[2*o+m];let x=c,E=p;for(wf(i,r,c,o),r[2*p+m]>y&&wf(i,r,c,p);x<E;){for(wf(i,r,x,E),x++,E--;r[2*x+m]<y;)x++;for(;r[2*E+m]>y;)E--}r[2*c+m]===y?wf(i,r,c,E):(E++,wf(i,r,E,p)),E<=o&&(c=E+1),o<=E&&(p=E-1)}}function wf(i,r,o,c){w1(i,o,c),w1(r,2*o,2*c),w1(r,2*o+1,2*c+1)}function w1(i,r,o){const c=i[r];i[r]=i[o],i[o]=c}function tC(i,r,o,c){const p=i-o,m=r-c;return p*p+m*m}l.ARRAY_TYPE=so,l.AUTH_ERR_MSG=ve,l.Aabb=Mi,l.Actor=class{constructor(i,r,o){this.target=i,this.parent=r,this.mapId=o,this.callbacks={},this.cancelCallbacks={},si(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=yi()?i:w,this.scheduler=new hL}send(i,r,o,c,p=!1,m){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=m,this.callbacks[y]=o);const x=Nn(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:i,hasCallback:!!o,targetMapId:c,mustQueue:p,sourceMapId:this.mapId,data:Ml(r,x)},x),{cancel:()=>{o&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(i){const r=i.data,o=r.id;if(o&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const c=this.cancelCallbacks[o];delete this.cancelCallbacks[o],c&&c.cancel()}else if(r.mustQueue||yi()){const c=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add(()=>this.processTask(o,r),c&&c.metadata||{type:"message"})}else this.processTask(o,r)}processTask(i,r){if(r.type==="<response>"){const o=this.callbacks[i];delete this.callbacks[i],o&&(r.error?o(Us(r.error)):o(null,Us(r.data)))}else{const o=Nn(this.globalScope)?void 0:[],c=r.hasCallback?(m,y)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:m?Ml(m):null,data:Ml(y,o)},o)}:m=>{},p=Us(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,p,c);else if(this.parent.getWorkerSource){const m=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,m[0],p.source)[m[1]](p,c)}else c(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=sg,l.Color=fn,l.ColorMode=cs,l.CullFaceMode=Fa,l.DEMData=Sg,l.DataConstantProperty=Z,l.DedupedRequest=YI,l.DepthMode=Bh,l.EXTENT=Ot,l.Elevation=class{isDataAvailableAtPoint(i){const r=this._source();if(this.isUsingMockSource()||!r||i.y<0||i.y>1)return!1;const o=r.getSource().maxzoom,c=1<<o,p=Math.floor(i.x),m=Math.floor((i.x-p)*c),y=Math.floor(i.y*c),x=this.findDEMTileFor(new zi(o,p,o,m,y));return!(!x||!x.dem)}getAtPointOrZero(i,r=0){return this.getAtPoint(i,r)||0}getAtPoint(i,r,o=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const c=this._source();if(!c||i.y<0||i.y>1)return r;const p=c.getSource().maxzoom,m=1<<p,y=Math.floor(i.x),x=i.x-y,E=new zi(p,y,p,Math.floor(x*m),Math.floor(i.y*m)),S=this.findDEMTileFor(E);if(!S||!S.dem)return r;const k=S.dem,M=1<<S.tileID.canonical.z,O=(x*M-S.tileID.canonical.x)*k.dim,j=(i.y*M-S.tileID.canonical.y)*k.dim,G=Math.floor(O),K=Math.floor(j);return(o?this.exaggeration():1)*dr(dr(k.get(G,K),k.get(G,K+1),j-K),dr(k.get(G+1,K),k.get(G+1,K+1),j-K),O-G)}getAtTileOffset(i,r,o){const c=1<<i.canonical.z;return this.getAtPointOrZero(new Sh(i.wrap+(i.canonical.x+r/Ot)/c,(i.canonical.y+o/Ot)/c))}getAtTileOffsetFunc(i,r,o,c){return p=>{const m=this.getAtTileOffset(i,p.x,p.y),y=c.upVector(i.canonical,p.x,p.y);return ko(y,y,m*c.upVectorScale(i.canonical,r,o).metersToTile),y}}getForTilePoints(i,r,o,c){if(this.isUsingMockSource())return!1;const p=Tg.create(this,i,c);return!!p&&(r.forEach(m=>{m[2]=this.exaggeration()*p.getElevationAt(m[0],m[1],o)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(i);if(!r||!r.dem)return null;const o=r.dem.tree,c=r.tileID,p=1<<i.canonical.z-c.canonical.z;let m=i.canonical.x/p-c.canonical.x,y=i.canonical.y/p-c.canonical.y,x=0;for(let E=0;E<i.canonical.z-c.canonical.z&&!o.leaves[x];E++){m*=2,y*=2;const S=2*Math.floor(y)+Math.floor(m);x=o.childOffsets[x]+S,m%=1,y%=1}return{min:this.exaggeration()*o.minimums[x],max:this.exaggeration()*o.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,r,o){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=va,l.EvaluationParameters=D,l.Event=Ms,l.Evented=Cc,l.FillExtrusionBucket=cf,l.Frustum=kx,l.FrustumCorners=Cx,l.GLOBE_RADIUS=ns,l.GLOBE_SCALE_MATCH_LATITUDE=45,l.GLOBE_ZOOM_THRESHOLD_MAX=e2,l.GLOBE_ZOOM_THRESHOLD_MIN=Px,l.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_fillGridMeshWithLods(i,r){const o=new st,c=new Pt,p=[],m=i+1+2,y=r[0]+1,x=r[0]+1+(1+r.length),E=(S,k,M)=>{let O=S===m-1?S-2:S===0?S:S-1;return O+=M?24575:0,[O,k]};for(let S=0;S<m;++S)o.emplaceBack(...E(S,0,!0));for(let S=0;S<y;++S)for(let k=0;k<m;++k)o.emplaceBack(...E(k,S,(k===0||k===m-1)&&!0));for(let S=0;S<r.length;++S){const k=r[S];for(let M=0;M<m;++M)o.emplaceBack(...E(M,k,!0))}for(let S=0;S<r.length;++S){const k=c.length,M=r[S]+1+2,O=new Pt;for(let K=0;K<M-1;K++){const ee=K===M-2,le=ee?m*(x-r.length+S-K):m;for(let me=0;me<m-1;me++){const ce=K*m+me;K===0||ee||me===0||me===m-2?(O.emplaceBack(ce+1,ce,ce+le),O.emplaceBack(ce+le,ce+le+1,ce+1)):(c.emplaceBack(ce+1,ce,ce+le),c.emplaceBack(ce+le,ce+le+1,ce+1))}}const j=xn.simpleSegment(0,k,o.length,c.length-k);for(let K=0;K<O.uint16.length;K+=3)c.emplaceBack(O.uint16[K],O.uint16[K+1],O.uint16[K+2]);const G=xn.simpleSegment(0,k,o.length,c.length-k);p.push({withoutSkirts:j,withSkirts:G})}return{vertices:o,indices:c,segments:p}}_createGrid(i){const r=this._fillGridMeshWithLods(ou,Qp);this._gridSegments=r.segments,this._gridBuffer=i.createVertexBuffer(r.vertices,Yp.members),this._gridIndexBuffer=i.createIndexBuffer(r.indices,!0)}_createPoles(i){const r=new Pt;for(let p=0;p<=ou;p++)r.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=i.createIndexBuffer(r,!0);const o=new Rr,c=new Rr;this._poleSegments=[];for(let p=0,m=0;p<Px;p++){const y=360/(1<<p);o.emplaceBack(0,-ns,0,.5,0),c.emplaceBack(0,-ns,0,.5,1);for(let x=0;x<=ou;x++){const E=x/ou,S=dr(0,y,E),[k,M,O]=bh(h5,d5,S,ns);o.emplaceBack(k,M,O,E,0),c.emplaceBack(k,M,O,E,1)}this._poleSegments.push(xn.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(o,QA,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(c,QA,!1)}getGridBuffers(i,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,r){if(!this._wireframeSegments){const o=new Gn,c=ou,p=c+1+2,m=1;this._wireframeSegments=[];for(let y=0,x=0;y<Qp.length;y++){const E=Qp[y];for(let k=m;k<E+m;k++)for(let M=m;M<c+m;M++){const O=k*p+M;o.emplaceBack(O,O+1),o.emplaceBack(O,O+p),o.emplaceBack(O,O+p+1)}const S=E*c*3;this._wireframeSegments.push(xn.simpleSegment(0,x,(E+1)*p,S)),x+=S}this._wireframeIndexBuffer=i.createIndexBuffer(o)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},l.GlyphManager=zh,l.ImagePosition=n1,l.KDBush=x1,l.LivePerformanceUtils=Xv,l.LngLat=Fr,l.LngLatBounds=Fl,l.LocalGlyphMode=a1,l.MAX_MERCATOR_LATITUDE=di,l.MercatorCoordinate=Sh,l.ONE_EM=ei,l.OverscaledTileID=zi,l.PerformanceMarkers=ml,l.Point=xe,l.Properties=he,l.RGBAImage=lo,l.Ray=Ix,l.RequestManager=class{constructor(i,r,o){this._transformRequestFn=i,this._customAccessToken=r,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const i=function(){let r="";for(let o=0;o<10;o++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",R,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,r){return this._transformRequestFn&&this._transformRequestFn(i,r)||{url:i}}normalizeStyleURL(i,r){if(!Ae(i))return i;const o=mt(i);return o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||r)}normalizeGlyphsURL(i,r){if(!Ae(i))return i;const o=mt(i);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||r)}normalizeSourceURL(i,r,o,c){if(!Ae(i))return i;const p=mt(i);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),o&&p.params.push(`language=${o}`),c&&p.params.push(`worldview=${c}`),this._makeAPIURL(p,this._customAccessToken||r)}normalizeSpriteURL(i,r,o,c){const p=mt(i);return Ae(i)?(p.path=`/styles/v1${p.path}/sprite${r}${o}`,this._makeAPIURL(p,this._customAccessToken||c)):(p.path+=`${r}${o}`,ct(p))}normalizeTileURL(i,r,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Ae(i))return i;const c=mt(i);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||o&&c.authority!=="raster"&&o===512?"@2x":""}${z.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${P.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${P.TILE_URL_VERSION}${c.path}`);const p=this._customAccessToken||function(m){for(const y of m){const x=y.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(c.params)||P.ACCESS_TOKEN;return P.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,p)}canonicalizeTileURL(i,r){const o=mt(i);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return i;let c="mapbox://";o.path.match(/^\/raster\/v1\//)?c+=`raster/${o.path.replace(`/${P.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${o.path.replace(`/${P.TILE_URL_VERSION}/`,"")}`;let p=o.params;return r&&(p=p.filter(m=>!m.match(/^access_token=/))),p.length&&(c+=`?${p.join("&")}`),c}canonicalizeTileset(i,r){const o=!!r&&Ae(r),c=[];for(const p of i.tiles||[])Pe(p)?c.push(this.canonicalizeTileURL(p,o)):c.push(p);return c}_makeAPIURL(i,r){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=mt(P.API_URL);if(i.protocol=c.protocol,i.authority=c.authority,i.protocol==="http"){const p=i.params.indexOf("secure");p>=0&&i.params.splice(p,1)}if(c.path!=="/"&&(i.path=`${c.path}${i.path}`),!P.REQUIRE_ACCESS_TOKEN)return ct(i);if(r=r||P.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return i.params=i.params.filter(p=>p.indexOf("access_token")===-1),i.params.push(`access_token=${r||""}`),ct(i)}},l.ResourceType=ga,l.SegmentVector=xn,l.SourceCache=hu,l.StencilMode=g1,l.StructArrayLayout1ui2=ao,l.StructArrayLayout2f1f2i16=Lt,l.StructArrayLayout2i4=st,l.StructArrayLayout2ui4=Gn,l.StructArrayLayout3f12=er,l.StructArrayLayout3ui6=Pt,l.StructArrayLayout4i8=Ke,l.StructArrayLayout5f20=Rr,l.Texture=xf,l.Tile=f1,l.Transitionable=q,l.Uniform1f=W0,l.Uniform1i=class extends $s{constructor(i){super(i),this.current=0}set(i,r,o){this.fetchUniformLocation(i,r)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},l.Uniform2f=class extends $s{constructor(i){super(i),this.current=[0,0]}set(i,r,o){this.fetchUniformLocation(i,r)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}},l.Uniform3f=class extends $s{constructor(i){super(i),this.current=[0,0,0]}set(i,r,o){this.fetchUniformLocation(i,r)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}},l.Uniform4f=OA,l.UniformColor=FA,l.UniformMatrix2f=class extends $s{constructor(i){super(i),this.current=KO}set(i,r,o){if(this.fetchUniformLocation(i,r)){for(let c=0;c<4;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}},l.UniformMatrix3f=class extends $s{constructor(i){super(i),this.current=ZO}set(i,r,o){if(this.fetchUniformLocation(i,r)){for(let c=0;c<9;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},l.UniformMatrix4f=class extends $s{constructor(i){super(i),this.current=qO}set(i,r,o){if(this.fetchUniformLocation(i,r)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let c=1;c<16;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}},l.UnwrappedTileID=V2,l.ValidationError=Et,l.VectorTileFeature=og,l.VectorTileWorkerSource=class extends Cc{constructor(i,r,o,c,p){super(),this.actor=i,this.layerIndex=r,this.availableImages=o,this.loadVectorData=p||QI,this.loading={},this.loaded={},this.deduped=new YI(i.scheduler),this.isSpriteLoaded=c,this.scheduler=i.scheduler}loadTile(i,r){const o=i.uid,c=i&&i.request,p=c&&c.collectResourceTiming,m=this.loading[o]=new _L(i);m.abort=this.loadVectorData(i,(y,x)=>{const E=!this.loading[o];if(delete this.loading[o],E||y||!x)return m.status="done",E||(this.loaded[o]=m),r(y);const S=x.rawData,k={};x.expires&&(k.expires=x.expires),x.cacheControl&&(k.cacheControl=x.cacheControl),m.vectorTile=x.vectorTile||new Qx(new hg(S));const M=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(O,j)=>{if(O||!j)return r(O);const G={};if(p){const K=Zd(c);K.length>0&&(G.resourceTiming=JSON.parse(JSON.stringify(K)))}r(null,nt({rawTileData:S.slice(0)},j,k,G))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[o]=m})}reloadTile(i,r){const o=this.loaded,c=i.uid,p=this;if(o&&o[c]){const m=o[c];m.showCollisionBoxes=i.showCollisionBoxes,m.enableTerrain=!!i.enableTerrain,m.projection=i.projection,m.tileTransform=uu(i.tileID.canonical,i.projection);const y=(x,E)=>{const S=m.reloadCallback;S&&(delete m.reloadCallback,m.parse(m.vectorTile,p.layerIndex,this.availableImages,p.actor,S)),r(x,E)};m.status==="parsing"?m.reloadCallback=y:m.status==="done"&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(i,r){const o=i.uid,c=this.loading[o];c&&(c.abort&&c.abort(),delete this.loading[o]),r()}removeTile(i,r){const o=this.loaded,c=i.uid;o&&o[c]&&delete o[c],r()}},l.WritingMode=Do,l.ZoomDependentExpression=Hc,l.add=Gs,l.addDynamicAttributes=bg,l.adjoint=function(i,r){var o=r[0],c=r[1],p=r[2],m=r[3],y=r[4],x=r[5],E=r[6],S=r[7],k=r[8];return i[0]=y*k-x*S,i[1]=p*S-c*k,i[2]=c*x-p*y,i[3]=x*E-m*k,i[4]=o*k-p*E,i[5]=p*m-o*x,i[6]=m*S-y*E,i[7]=c*E-o*S,i[8]=o*y-c*m,i},l.asyncAll=je,l.bezier=Ut,l.bindAll=si,l.boundsAttributes=RI,l.bufferConvexPolygon=function(i,r){const o=[];for(let c=0;c<i.length;c++){const p=gt(c-1,-1,i.length-1),m=gt(c+1,-1,i.length-1),y=i[c],x=i[m],E=i[p].sub(y).unit(),S=x.sub(y).unit(),k=S.angleWithSep(E.x,E.y),M=E.add(S).unit().mult(-1*r/Math.sin(k/2));o.push(y.add(M))}return o},l.cacheEntryPossiblyAdded=function(i){So++,So>Eo&&(i.getActor().send("enforceCacheSizeLimit",Ps),So=0)},l.calculateGlobeLabelMatrix=function(i,r){const{x:o,y:c}=i.point,p=o2(o,c,i.worldSize/i._pixelsPerMercatorPixel,0,0);return ru(p,p,zx(is(r)))},l.calculateGlobeMatrix=function(i){const{x:r,y:o}=i.point,{lng:c,lat:p}=i._center;return o2(r,o,i.worldSize,c,p)},l.calculateGlobeMercatorMatrix=function(i){const r=i.pixelsPerMeter,o=r/za(1,i.center.lat),c=Da(new Float64Array(16));return Gp(c,c,[i.point.x,i.point.y,0]),nu(c,c,[o,o,r]),Float32Array.from(c)},l.circumferenceAtLatitude=Ox,l.clamp=qe,l.clearTileCache=function(i){if(!Qa())return;const r=w.caches.delete(wo);i&&r.catch(i).then(()=>i())},l.clipLine=gI,l.clone=function(i){var r=new so(16);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],r},l.clone$1=qr,l.collisionCircleLayout=gF,l.config=P,l.conjugate=function(i,r){return i[0]=-r[0],i[1]=-r[1],i[2]=-r[2],i[3]=r[3],i},l.create=function(){var i=new so(16);return so!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},l.create$1=NA,l.createExpression=kl,l.createLayout=Ie,l.createStyleLayer=function(i){return i.type==="custom"?new sL(i):new cL[i.type](i)},l.cross=Ax,l.degToRad=Fe,l.distance=function(i,r){return Math.hypot(r[0]-i[0],r[1]-i[1],r[2]-i[2])},l.div=function(i,r,o){return i[0]=r[0]/o[0],i[1]=r[1]/o[1],i[2]=r[2]/o[2],i},l.dot=ea,l.earthRadius=tf,l.ease=cr,l.easeCubicInOut=Dt,l.ecefToLatLng=function([i,r,o]){const c=Math.hypot(i,r,o),p=Math.atan2(i,o),m=.5*Math.PI-Math.acos(-r/c);return new Fr(Ve(p),Ve(m))},l.emitValidationErrors=B0,l.endsWith=mr,l.enforceCacheSizeLimit=function(i){Go(),jn&&jn.then(r=>{r.keys().then(o=>{for(let c=0;c<o.length-i;c++)r.delete(o[c])})})},l.evaluateSizeForFeature=cg,l.evaluateSizeForZoom=kh,l.evaluateVariableOffset=bI,l.evented=v,l.exactEquals=function(i,r){return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]&&i[3]===r[3]},l.exactEquals$1=function(i,r){return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]},l.exported=_a,l.exported$1=z,l.extend=nt,l.extend$1=xa,l.fillExtrusionHeightLift=N2,l.filterObject=Ii,l.fromMat4=function(i,r){return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[4],i[4]=r[5],i[5]=r[6],i[6]=r[8],i[7]=r[9],i[8]=r[10],i},l.fromQuat=function(i,r){var o=r[0],c=r[1],p=r[2],m=r[3],y=o+o,x=c+c,E=p+p,S=o*y,k=c*y,M=c*x,O=p*y,j=p*x,G=p*E,K=m*y,ee=m*x,le=m*E;return i[0]=1-M-G,i[1]=k+le,i[2]=O-ee,i[3]=0,i[4]=k-le,i[5]=1-S-G,i[6]=j+K,i[7]=0,i[8]=O+ee,i[9]=j-K,i[10]=1-S-M,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},l.fromRotation=function(i,r){var o=Math.sin(r),c=Math.cos(r);return i[0]=c,i[1]=o,i[2]=0,i[3]=-o,i[4]=c,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},l.fromScaling=jA,l.furthestTileCorner=function(i){const r=Math.round((i+45+360)%360/90)%4;return Ct[r]},l.getAABBPointSquareDist=function(i,r,o){let c=0;for(let p=0;p<2;++p){const m=o?o[p]:0;i[p]>m&&(c+=(i[p]-m)*(i[p]-m)),r[p]<m&&(c+=(m-r[p])*(m-r[p]))}return c},l.getAnchorAlignment=o1,l.getAnchorJustification=l1,l.getBounds=function(i){let r=1/0,o=1/0,c=-1/0,p=-1/0;for(const m of i)r=Math.min(r,m.x),o=Math.min(o,m.y),c=Math.max(c,m.x),p=Math.max(p,m.y);return{min:new xe(r,o),max:new xe(c,p)}},l.getColumn=Qn,l.getDefaultExportFromCjs=F,l.getGridMatrix=function(i,r,o,c){const p=r.getNorth(),m=r.getSouth(),y=r.getWest(),x=r.getEast(),E=1<<i.z,S=x-y,k=p-m,M=S/ou,O=-k/Qp[o],j=[0,M,0,O,0,0,p,y,0];if(i.z>0){const G=180/c;UA(j,j,[G/S+1,0,0,0,G/k+1,0,-.5*G/M,.5*G/O,1])}return j[2]=E,j[5]=i.x,j[8]=i.y,j},l.getImage=de,l.getJSON=function(i,r){return ya(nt(i,{type:"json"}),r)},l.getLatitudinalLod=function(i){const r=di-5;i=qe(i,-r,r)/r*90;const o=Math.pow(Math.abs(Math.sin(Fe(i))),3);return Math.round(o*(Qp.length-1))},l.getMapSessionAPI=Vn,l.getPerformanceMeasurement=Zd,l.getProjection=kI,l.getRTLTextPluginStatus=b,l.getReferrer=Ho,l.getTilePoint=function(i,{x:r,y:o},c=0){return new xe(((r-c)*i.scale-i.x)*Ot,(o*i.scale-i.y)*Ot)},l.getTileVec3=function(i,r,o=0){return xh(((r.x-o)*i.scale-i.x)*Ot,(r.y*i.scale-i.y)*Ot,c2(r.z,r.y))},l.getVideo=function(i,r){const o=w.document.createElement("video");o.muted=!0,o.onloadstart=function(){r(null,o)};for(let c=0;c<i.length;c++){const p=w.document.createElement("source");Ds(i[c])||(o.crossOrigin="Anonymous"),p.src=i[c],o.appendChild(p)}return{cancel:()=>{}}},l.globeCenterToScreenPoint=function(i){const r=[0,0,0],o=Da(new Float64Array(16));return ru(o,i.pixelMatrix,i.globeMatrix),mn(r,r,o),new xe(r[0],r[1])},l.globeDenormalizeECEF=zx,l.globeECEFOrigin=function(i,r){const o=[0,0,0];return mn(o,o,ef(is(r.canonical))),mn(o,o,i),o},l.globeMetersToEcef=q0,l.globeNormalizeECEF=ef,l.globePixelsToTileUnits=function(i,r){return Ot/(512*Math.pow(2,i))*K0(is(r))},l.globePoleMatrixForTile=function(i,r,o){const c=Da(new Float64Array(16)),p=(r/(1<<i)-.5)*Math.PI*2;return H0(c,o.globeMatrix,p),Float32Array.from(c)},l.globeTileBounds=is,l.globeTiltAtLngLat=a2,l.globeToMercatorTransition=Eh,l.globeUseCustomAntiAliasing=function(i,r,o){const c=Eh(o.zoom),p=i.style.map._antialias,m=!!r.extStandardDerivatives,y=r.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return c===0&&!p&&!y&&m},l.identity=Da,l.identity$1=KA,l.invert=wx,l.isFullscreen=function(){return!!w.document.fullscreenElement||!!w.document.webkitFullscreenElement},l.isLngLatBehindGlobe=Rx,l.isMapAuthenticated=function(i){return _i.has(i)},l.isMapboxURL=Ae,l.isSafariWithAntialiasingBug=function(i){const r=i.navigator?i.navigator.userAgent:null;return!!Nn(i)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},l.latFromMercatorY=hi,l.latLngToECEF=wh,l.len=i5,l.length=Hp,l.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},l.lngFromMercatorX=Po,l.loadVectorTile=QI,l.makeRequest=ya,l.mapValue=function(i,r,o,c,p){return qe((i-r)/(o-r)*(p-c)+c,c,p)},l.mercatorScale=u2,l.mercatorXfromLng=os,l.mercatorYfromLat=as,l.mercatorZfromAltitude=za,l.mul=r5,l.mul$1=n5,l.multiply=ru,l.multiply$1=UA,l.multiply$2=WA,l.nextPowerOfTwo=Pr,l.normalize=Di,l.normalize$1=o5,l.normalize$2=qA,l.number=dr,l.ortho=function(i,r,o,c,p,m,y){var x=1/(r-o),E=1/(c-p),S=1/(m-y);return i[0]=-2*x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*E,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*S,i[11]=0,i[12]=(r+o)*x,i[13]=(p+c)*E,i[14]=(y+m)*S,i[15]=1,i},l.pbf=K2,l.perspective=function(i,r,o,c,p){var m,y=1/Math.tan(r/2);return i[0]=y/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+c)*(m=1/(c-p)),i[14]=2*p*c*m):(i[10]=-1,i[14]=-2*c),i},l.pick=function(i,r){const o={};for(let c=0;c<r.length;c++){const p=r[c];p in i&&(o[p]=i[p])}return o},l.plugin=I,l.pointGeometry=se,l.polesInViewport=function(i){const r=Da(new Float64Array(16));ru(r,i.pixelMatrix,i.globeMatrix);const o=[0,ta,0],c=[0,ra,0];return mn(o,o,r),mn(c,c,r),[o[0]>0&&o[0]<=i.width&&o[1]>0&&o[1]<=i.height&&!Rx(i,new Fr(i.center.lat,90)),c[0]>0&&c[0]<=i.width&&c[1]>0&&c[1]<=i.height&&!Rx(i,new Fr(i.center.lat,-90))]},l.polygonContainsPoint=lu,l.polygonIntersectsBox=y2,l.polygonIntersectsPolygon=p2,l.polygonizeBounds=function(i,r,o=0,c=!0){const p=new xe(o,o),m=i.sub(p),y=r.add(p),x=[m,new xe(y.x,m.y),y,new xe(m.x,y.y)];return c&&x.push(m.clone()),x},l.posAttributes=Yp,l.postMapLoadEvent=yn,l.postPerformanceEvent=zn,l.postTurnstileEvent=or,l.potpack=r1,l.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},l.radToDeg=Ve,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(i){return i({pluginStatus:f,pluginURL:s}),v.on("pluginStateChange",i),i},l.removeAuthState=function(i){_i.delete(i)},l.renderColorRamp=$x,l.resample=h2,l.rotateX=Ex,l.rotateX$1=XA,l.rotateY=H0,l.rotateY$1=YA,l.rotateZ=function(i,r,o){var c=Math.sin(o),p=Math.cos(o),m=r[0],y=r[1],x=r[2],E=r[3],S=r[4],k=r[5],M=r[6],O=r[7];return r!==i&&(i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=m*p+S*c,i[1]=y*p+k*c,i[2]=x*p+M*c,i[3]=E*p+O*c,i[4]=S*p-m*c,i[5]=k*p-y*c,i[6]=M*p-x*c,i[7]=O*p-E*c,i},l.rotateZ$1=function(i,r,o){o*=.5;var c=r[0],p=r[1],m=r[2],y=r[3],x=Math.sin(o),E=Math.cos(o);return i[0]=c*E+p*x,i[1]=p*E-c*x,i[2]=m*E+y*x,i[3]=y*E-m*x,i},l.scale=nu,l.scale$1=HA,l.scale$2=ko,l.scaleAndAdd=Kp,l.set=function(i,r,o,c){return i[0]=r,i[1]=o,i[2]=c,i},l.setCacheLimits=function(i,r){Ps=i,Eo=r},l.setColumn=function(i,r,o){i[4*r+0]=o[0],i[4*r+1]=o[1],i[4*r+2]=o[2],i[4*r+3]=o[3]},l.setRTLTextPlugin=function(i,r,o=!1){if(f===Up||f===jp||f===Vp)throw new Error("setRTLTextPlugin cannot be called multiple times.");s=_a.resolveURL(i),f=Up,zl=r,g(),o||A()},l.smoothstep=St,l.spec=Ge,l.squaredLength=function(i){var r=i[0],o=i[1],c=i[2];return r*r+o*o+c*c},l.storeAuthState=function(i,r){r?_i.add(i):_i.delete(i)},l.sub=Ma,l.subtract=Tx,l.symbolSize=yF,l.tileAABB=function(i,r,o,c,p,m,y,x,E){if(E.name==="globe")return u5(i,r,new sg(o,c,p));const S=uu({z:o,x:c,y:p},E);return new Mi([(m+S.x/S.scale)*r,r*(S.y/S.scale),y],[(m+S.x2/S.scale)*r,r*(S.y2/S.scale),x])},l.tileCornersToBounds=Z0,l.tileTransform=uu,l.transformMat3=function(i,r,o){var c=r[0],p=r[1],m=r[2];return i[0]=c*o[0]+p*o[3]+m*o[6],i[1]=c*o[1]+p*o[4]+m*o[7],i[2]=c*o[2]+p*o[5]+m*o[8],i},l.transformMat4=mn,l.transformMat4$1=iu,l.transformQuat=GA,l.transitionTileAABBinECEF=r2,l.translate=Gp,l.transpose=function(i,r){if(i===r){var o=r[1],c=r[2],p=r[5];i[1]=r[3],i[2]=r[6],i[3]=o,i[5]=r[7],i[6]=c,i[7]=p}else i[0]=r[0],i[1]=r[3],i[2]=r[6],i[3]=r[1],i[4]=r[4],i[5]=r[7],i[6]=r[2],i[7]=r[5],i[8]=r[8];return i},l.triggerPluginCompletionEvent=h,l.uniqueId=ur,l.updateGlobeVertexNormal=function(i,r,o,c,p){const m=5*r+2;i.float32[m+0]=o,i.float32[m+1]=c,i.float32[m+2]=p},l.validateCustomStyleLayer=function(i){const r=[],o=i.id;return o===void 0&&r.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&r.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&r.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),r},l.validateFilter=i=>oo(Yc(i)),l.validateFog=i=>oo(O0(i)),l.validateLayer=i=>oo(D0(i)),l.validateLight=i=>oo(R0(i)),l.validateSource=i=>oo(z0(i)),l.validateStyle=L0,l.validateTerrain=i=>oo(Op(i)),l.values=et,l.vectorTile=ig,l.version=T,l.warnOnce=Tr,l.window=w,l.wrap=gt}),d(["./shared"],function(l){function w(fe){if(typeof fe=="number"||typeof fe=="boolean"||typeof fe=="string"||fe==null)return JSON.stringify(fe);if(Array.isArray(fe)){let Y="[";for(const de of fe)Y+=`${w(de)},`;return`${Y}]`}let X="{";for(const Y of Object.keys(fe).sort())X+=`${Y}:${w(fe[Y])},`;return`${X}}`}function T(fe){let X="";for(const Y of l.refProperties)X+=`/${w(fe[Y])}`;return X}class C{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,Y){for(const ve of X)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=l.createStyleLayer(ve)).compileFilter(),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(const ve of Y)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const de=function(ve,Ae){const Pe={};for(let Te=0;Te<ve.length;Te++){const Le=Ae&&Ae[ve[Te].id]||T(ve[Te]);Ae&&(Ae[ve[Te].id]=Le);let dt=Pe[Le];dt||(dt=Pe[Le]=[]),dt.push(ve[Te])}const ke=[];for(const Te in Pe)ke.push(Pe[Te]);return ke}(l.values(this._layerConfigs),this.keyCache);for(const ve of de){const Ae=ve.map(mt=>this._layers[mt.id]),Pe=Ae[0];if(Pe.visibility==="none")continue;const ke=Pe.source||"";let Te=this.familiesBySource[ke];Te||(Te=this.familiesBySource[ke]={});const Le=Pe.sourceLayer||"_geojsonTileLayer";let dt=Te[Le];dt||(dt=Te[Le]=[]),dt.push(Ae)}}}class P{loadTile(X,Y){const{uid:de,encoding:ve,rawImageData:Ae,padding:Pe,buildQuadTree:ke}=X,Te=l.window.ImageBitmap&&Ae instanceof l.window.ImageBitmap?this.getImageData(Ae,Pe):Ae;Y(null,new l.DEMData(de,Te,ve,Pe<1,ke))}getImageData(X,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const de=this.offscreenCanvasContext.getImageData(-Y,-Y,X.width+2*Y,X.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}function z(fe,X){if(fe.length!==0){$(fe[0],X);for(var Y=1;Y<fe.length;Y++)$(fe[Y],!X)}}function $(fe,X){for(var Y=0,de=0,ve=0,Ae=fe.length,Pe=Ae-1;ve<Ae;Pe=ve++){var ke=(fe[ve][0]-fe[Pe][0])*(fe[Pe][1]+fe[ve][1]),Te=Y+ke;de+=Math.abs(Y)>=Math.abs(ke)?Y-Te+ke:ke-Te+Y,Y=Te}Y+de>=0!=!!X&&fe.reverse()}var U=l.getDefaultExportFromCjs(function fe(X,Y){var de,ve=X&&X.type;if(ve==="FeatureCollection")for(de=0;de<X.features.length;de++)fe(X.features[de],Y);else if(ve==="GeometryCollection")for(de=0;de<X.geometries.length;de++)fe(X.geometries[de],Y);else if(ve==="Feature")fe(X.geometry,Y);else if(ve==="Polygon")z(X.coordinates,Y);else if(ve==="MultiPolygon")for(de=0;de<X.coordinates.length;de++)z(X.coordinates[de],Y);return X});const W=l.VectorTileFeature.prototype.toGeoJSON;var N={exports:{}},V=l.pointGeometry,R=l.vectorTile.VectorTileFeature,F=H;function H(fe,X){this.options=X||{},this.features=fe,this.length=fe.length}function J(fe,X){this.id=typeof fe.id=="number"?fe.id:void 0,this.type=fe.type,this.rawGeometry=fe.type===1?[fe.geometry]:fe.geometry,this.properties=fe.tags,this.extent=X||4096}H.prototype.feature=function(fe){return new J(this.features[fe],this.options.extent)},J.prototype.loadGeometry=function(){var fe=this.rawGeometry;this.geometry=[];for(var X=0;X<fe.length;X++){for(var Y=fe[X],de=[],ve=0;ve<Y.length;ve++)de.push(new V(Y[ve][0],Y[ve][1]));this.geometry.push(de)}return this.geometry},J.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var fe=this.geometry,X=1/0,Y=-1/0,de=1/0,ve=-1/0,Ae=0;Ae<fe.length;Ae++)for(var Pe=fe[Ae],ke=0;ke<Pe.length;ke++){var Te=Pe[ke];X=Math.min(X,Te.x),Y=Math.max(Y,Te.x),de=Math.min(de,Te.y),ve=Math.max(ve,Te.y)}return[X,de,Y,ve]},J.prototype.toGeoJSON=R.prototype.toGeoJSON;var te=l.pbf,se=F;function ge(fe){var X=new te;return function(Y,de){for(var ve in Y.layers)de.writeMessage(3,xe,Y.layers[ve])}(fe,X),X.finish()}function xe(fe,X){var Y;X.writeVarintField(15,fe.version||1),X.writeStringField(1,fe.name||""),X.writeVarintField(5,fe.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<fe.length;Y++)de.feature=fe.feature(Y),X.writeMessage(2,Ee,de);var ve=de.keys;for(Y=0;Y<ve.length;Y++)X.writeStringField(3,ve[Y]);var Ae=de.values;for(Y=0;Y<Ae.length;Y++)X.writeMessage(4,Dt,Ae[Y])}function Ee(fe,X){var Y=fe.feature;Y.id!==void 0&&X.writeVarintField(1,Y.id),X.writeMessage(2,Be,fe),X.writeVarintField(3,Y.type),X.writeMessage(4,Ct,Y)}function Be(fe,X){var Y=fe.feature,de=fe.keys,ve=fe.values,Ae=fe.keycache,Pe=fe.valuecache;for(var ke in Y.properties){var Te=Y.properties[ke],Le=Ae[ke];if(Te!==null){Le===void 0&&(de.push(ke),Ae[ke]=Le=de.length-1),X.writeVarint(Le);var dt=typeof Te;dt!=="string"&&dt!=="boolean"&&dt!=="number"&&(Te=JSON.stringify(Te));var mt=dt+":"+Te,ct=Pe[mt];ct===void 0&&(ve.push(Te),Pe[mt]=ct=ve.length-1),X.writeVarint(ct)}}}function Fe(fe,X){return(X<<3)+(7&fe)}function Ve(fe){return fe<<1^fe>>31}function Ct(fe,X){for(var Y=fe.loadGeometry(),de=fe.type,ve=0,Ae=0,Pe=Y.length,ke=0;ke<Pe;ke++){var Te=Y[ke],Le=1;de===1&&(Le=Te.length),X.writeVarint(Fe(1,Le));for(var dt=de===3?Te.length-1:Te.length,mt=0;mt<dt;mt++){mt===1&&de!==1&&X.writeVarint(Fe(2,dt-1));var ct=Te[mt].x-ve,Ft=Te[mt].y-Ae;X.writeVarint(Ve(ct)),X.writeVarint(Ve(Ft)),ve+=ct,Ae+=Ft}de===3&&X.writeVarint(Fe(7,1))}}function Dt(fe,X){var Y=typeof fe;Y==="string"?X.writeStringField(1,fe):Y==="boolean"?X.writeBooleanField(7,fe):Y==="number"&&(fe%1!=0?X.writeDoubleField(3,fe):fe<0?X.writeSVarintField(6,fe):X.writeVarintField(5,fe))}N.exports=ge,N.exports.fromVectorTileJs=ge,N.exports.fromGeojsonVt=function(fe,X){X=X||{};var Y={};for(var de in fe)Y[de]=new se(fe[de].features,X),Y[de].name=de,Y[de].version=X.version,Y[de].extent=X.extent;return ge({layers:Y})},N.exports.GeoJSONWrapper=se;var Ut=l.getDefaultExportFromCjs(N.exports);const cr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:fe=>fe},qe=Math.fround||(St=new Float32Array(1),fe=>(St[0]=+fe,St[0]));var St;const gt=3,je=5,et=6;class nt{constructor(X){this.options=Object.assign(Object.create(cr),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:Y,minZoom:de,maxZoom:ve}=this.options;Y&&console.time("total time");const Ae=`prepare ${X.length} points`;Y&&console.time(Ae),this.points=X;const Pe=[];for(let Te=0;Te<X.length;Te++){const Le=X[Te];if(!Le.geometry)continue;const[dt,mt]=Le.geometry.coordinates,ct=qe(Xt(dt)),Ft=qe(Pr(mt));Pe.push(ct,Ft,1/0,Te,-1,1),this.options.reduce&&Pe.push(0)}let ke=this.trees[ve+1]=this._createTree(Pe);Y&&console.timeEnd(Ae);for(let Te=ve;Te>=de;Te--){const Le=+Date.now();ke=this.trees[Te]=this._createTree(this._cluster(ke,Te)),Y&&console.log("z%d: %d clusters in %dms",Te,ke.numItems,+Date.now()-Le)}return Y&&console.timeEnd("total time"),this}getClusters(X,Y){let de=((X[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,X[1]));let Ae=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)de=-180,Ae=180;else if(de>Ae){const mt=this.getClusters([de,ve,180,Pe],Y),ct=this.getClusters([-180,ve,Ae,Pe],Y);return mt.concat(ct)}const ke=this.trees[this._limitZoom(Y)],Te=ke.range(Xt(de),Pr(Pe),Xt(Ae),Pr(ve)),Le=ke.data,dt=[];for(const mt of Te){const ct=this.stride*mt;dt.push(Le[ct+je]>1?it(Le,ct,this.clusterProps):this.points[Le[ct+gt]])}return dt}getChildren(X){const Y=this._getOriginId(X),de=this._getOriginZoom(X),ve="No cluster with the specified id.",Ae=this.trees[de];if(!Ae)throw new Error(ve);const Pe=Ae.data;if(Y*this.stride>=Pe.length)throw new Error(ve);const ke=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Te=Ae.within(Pe[Y*this.stride],Pe[Y*this.stride+1],ke),Le=[];for(const dt of Te){const mt=dt*this.stride;Pe[mt+4]===X&&Le.push(Pe[mt+je]>1?it(Pe,mt,this.clusterProps):this.points[Pe[mt+gt]])}if(Le.length===0)throw new Error(ve);return Le}getLeaves(X,Y,de){const ve=[];return this._appendLeaves(ve,X,Y=Y||10,de=de||0,0),ve}getTile(X,Y,de){const ve=this.trees[this._limitZoom(X)],Ae=Math.pow(2,X),{extent:Pe,radius:ke}=this.options,Te=ke/Pe,Le=(de-Te)/Ae,dt=(de+1+Te)/Ae,mt={features:[]};return this._addTileFeatures(ve.range((Y-Te)/Ae,Le,(Y+1+Te)/Ae,dt),ve.data,Y,de,Ae,mt),Y===0&&this._addTileFeatures(ve.range(1-Te/Ae,Le,1,dt),ve.data,Ae,de,Ae,mt),Y===Ae-1&&this._addTileFeatures(ve.range(0,Le,Te/Ae,dt),ve.data,-1,de,Ae,mt),mt.features.length?mt:null}getClusterExpansionZoom(X){let Y=this._getOriginZoom(X)-1;for(;Y<=this.options.maxZoom;){const de=this.getChildren(X);if(Y++,de.length!==1)break;X=de[0].properties.cluster_id}return Y}_appendLeaves(X,Y,de,ve,Ae){const Pe=this.getChildren(Y);for(const ke of Pe){const Te=ke.properties;if(Te&&Te.cluster?Ae+Te.point_count<=ve?Ae+=Te.point_count:Ae=this._appendLeaves(X,Te.cluster_id,de,ve,Ae):Ae<ve?Ae++:X.push(ke),X.length===de)break}return Ae}_createTree(X){const Y=new l.KDBush(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<X.length;de+=this.stride)Y.add(X[de],X[de+1]);return Y.finish(),Y.data=X,Y}_addTileFeatures(X,Y,de,ve,Ae,Pe){for(const ke of X){const Te=ke*this.stride,Le=Y[Te+je]>1;let dt,mt,ct;if(Le)dt=ur(Y,Te,this.clusterProps),mt=Y[Te],ct=Y[Te+1];else{const Wt=this.points[Y[Te+gt]];dt=Wt.properties;const[Qt,or]=Wt.geometry.coordinates;mt=Xt(Qt),ct=Pr(or)}const Ft={type:1,geometry:[[Math.round(this.options.extent*(mt*Ae-de)),Math.round(this.options.extent*(ct*Ae-ve))]],tags:dt};let jt;jt=Le||this.options.generateId?Y[Te+gt]:this.points[Y[Te+gt]].id,jt!==void 0&&(Ft.id=jt),Pe.features.push(Ft)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,Y){const{radius:de,extent:ve,reduce:Ae,minPoints:Pe}=this.options,ke=de/(ve*Math.pow(2,Y)),Te=X.data,Le=[],dt=this.stride;for(let mt=0;mt<Te.length;mt+=dt){if(Te[mt+2]<=Y)continue;Te[mt+2]=Y;const ct=Te[mt],Ft=Te[mt+1],jt=X.within(Te[mt],Te[mt+1],ke),Wt=Te[mt+je];let Qt=Wt;for(const or of jt){const en=or*dt;Te[en+2]>Y&&(Qt+=Te[en+je])}if(Qt>Wt&&Qt>=Pe){let or,en=ct*Wt,yn=Ft*Wt,li=-1;const zn=((mt/dt|0)<<5)+(Y+1)+this.points.length;for(const qo of jt){const Vn=qo*dt;if(Te[Vn+2]<=Y)continue;Te[Vn+2]=Y;const _i=Te[Vn+je];en+=Te[Vn]*_i,yn+=Te[Vn+1]*_i,Te[Vn+4]=zn,Ae&&(or||(or=this._map(Te,mt,!0),li=this.clusterProps.length,this.clusterProps.push(or)),Ae(or,this._map(Te,Vn)))}Te[mt+4]=zn,Le.push(en/Qt,yn/Qt,1/0,zn,-1,Qt),Ae&&Le.push(li)}else{for(let or=0;or<dt;or++)Le.push(Te[mt+or]);if(Qt>1)for(const or of jt){const en=or*dt;if(!(Te[en+2]<=Y)){Te[en+2]=Y;for(let yn=0;yn<dt;yn++)Le.push(Te[en+yn])}}}}return Le}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,Y,de){if(X[Y+je]>1){const Pe=this.clusterProps[X[Y+et]];return de?Object.assign({},Pe):Pe}const ve=this.points[X[Y+gt]].properties,Ae=this.options.map(ve);return de&&Ae===ve?Object.assign({},Ae):Ae}}function it(fe,X,Y){return{type:"Feature",id:fe[X+gt],properties:ur(fe,X,Y),geometry:{type:"Point",coordinates:[(de=fe[X],360*(de-.5)),Yt(fe[X+1])]}};var de}function ur(fe,X,Y){const de=fe[X+je],ve=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,Ae=fe[X+et],Pe=Ae===-1?{}:Object.assign({},Y[Ae]);return Object.assign(Pe,{cluster:!0,cluster_id:fe[X+gt],point_count:de,point_count_abbreviated:ve})}function Xt(fe){return fe/360+.5}function Pr(fe){const X=Math.sin(fe*Math.PI/180),Y=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Y<0?0:Y>1?1:Y}function Yt(fe){const X=(180-360*fe)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function si(fe,X,Y,de){for(var ve,Ae=de,Pe=Y-X>>1,ke=Y-X,Te=fe[X],Le=fe[X+1],dt=fe[Y],mt=fe[Y+1],ct=X+3;ct<Y;ct+=3){var Ft=mr(fe[ct],fe[ct+1],Te,Le,dt,mt);if(Ft>Ae)ve=ct,Ae=Ft;else if(Ft===Ae){var jt=Math.abs(ct-Pe);jt<ke&&(ve=ct,ke=jt)}}Ae>de&&(ve-X>3&&si(fe,X,ve,de),fe[ve+2]=Ae,Y-ve>3&&si(fe,ve,Y,de))}function mr(fe,X,Y,de,ve,Ae){var Pe=ve-Y,ke=Ae-de;if(Pe!==0||ke!==0){var Te=((fe-Y)*Pe+(X-de)*ke)/(Pe*Pe+ke*ke);Te>1?(Y=ve,de=Ae):Te>0&&(Y+=Pe*Te,de+=ke*Te)}return(Pe=fe-Y)*Pe+(ke=X-de)*ke}function Vt(fe,X,Y,de){var ve={id:fe===void 0?null:fe,type:X,geometry:Y,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ae){var Pe=Ae.geometry,ke=Ae.type;if(ke==="Point"||ke==="MultiPoint"||ke==="LineString")Ii(Ae,Pe);else if(ke==="Polygon"||ke==="MultiLineString")for(var Te=0;Te<Pe.length;Te++)Ii(Ae,Pe[Te]);else if(ke==="MultiPolygon")for(Te=0;Te<Pe.length;Te++)for(var Le=0;Le<Pe[Te].length;Le++)Ii(Ae,Pe[Te][Le])}(ve),ve}function Ii(fe,X){for(var Y=0;Y<X.length;Y+=3)fe.minX=Math.min(fe.minX,X[Y]),fe.minY=Math.min(fe.minY,X[Y+1]),fe.maxX=Math.max(fe.maxX,X[Y]),fe.maxY=Math.max(fe.maxY,X[Y+1])}function qr(fe,X,Y,de){if(X.geometry){var ve=X.geometry.coordinates,Ae=X.geometry.type,Pe=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),ke=[],Te=X.id;if(Y.promoteId?Te=X.properties[Y.promoteId]:Y.generateId&&(Te=de||0),Ae==="Point")pn(ve,ke);else if(Ae==="MultiPoint")for(var Le=0;Le<ve.length;Le++)pn(ve[Le],ke);else if(Ae==="LineString")Tr(ve,ke,Pe,!1);else if(Ae==="MultiLineString"){if(Y.lineMetrics){for(Le=0;Le<ve.length;Le++)Tr(ve[Le],ke=[],Pe,!1),fe.push(Vt(Te,"LineString",ke,X.properties));return}Bn(ve,ke,Pe,!1)}else if(Ae==="Polygon")Bn(ve,ke,Pe,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(Le=0;Le<X.geometry.geometries.length;Le++)qr(fe,{id:Te,geometry:X.geometry.geometries[Le],properties:X.properties},Y,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Le=0;Le<ve.length;Le++){var dt=[];Bn(ve[Le],dt,Pe,!0),ke.push(dt)}}fe.push(Vt(Te,Ae,ke,X.properties))}}function pn(fe,X){X.push(ma(fe[0])),X.push(yi(fe[1])),X.push(0)}function Tr(fe,X,Y,de){for(var ve,Ae,Pe=0,ke=0;ke<fe.length;ke++){var Te=ma(fe[ke][0]),Le=yi(fe[ke][1]);X.push(Te),X.push(Le),X.push(0),ke>0&&(Pe+=de?(ve*Le-Te*Ae)/2:Math.sqrt(Math.pow(Te-ve,2)+Math.pow(Le-Ae,2))),ve=Te,Ae=Le}var dt=X.length-3;X[2]=1,si(X,0,dt,Y),X[dt+2]=1,X.size=Math.abs(Pe),X.start=0,X.end=X.size}function Bn(fe,X,Y,de){for(var ve=0;ve<fe.length;ve++){var Ae=[];Tr(fe[ve],Ae,Y,de),X.push(Ae)}}function ma(fe){return fe/360+.5}function yi(fe){var X=Math.sin(fe*Math.PI/180),Y=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Y<0?0:Y>1?1:Y}function Yn(fe,X,Y,de,ve,Ae,Pe,ke){if(de/=X,Ae>=(Y/=X)&&Pe<de)return fe;if(Pe<Y||Ae>=de)return null;for(var Te=[],Le=0;Le<fe.length;Le++){var dt=fe[Le],mt=dt.geometry,ct=dt.type,Ft=ve===0?dt.minX:dt.minY,jt=ve===0?dt.maxX:dt.maxY;if(Ft>=Y&&jt<de)Te.push(dt);else if(!(jt<Y||Ft>=de)){var Wt=[];if(ct==="Point"||ct==="MultiPoint")bo(mt,Wt,Y,de,ve);else if(ct==="LineString")Nn(mt,Wt,Y,de,ve,!1,ke.lineMetrics);else if(ct==="MultiLineString")Qn(mt,Wt,Y,de,ve,!1);else if(ct==="Polygon")Qn(mt,Wt,Y,de,ve,!0);else if(ct==="MultiPolygon")for(var Qt=0;Qt<mt.length;Qt++){var or=[];Qn(mt[Qt],or,Y,de,ve,!0),or.length&&Wt.push(or)}if(Wt.length){if(ke.lineMetrics&&ct==="LineString"){for(Qt=0;Qt<Wt.length;Qt++)Te.push(Vt(dt.id,ct,Wt[Qt],dt.tags));continue}ct!=="LineString"&&ct!=="MultiLineString"||(Wt.length===1?(ct="LineString",Wt=Wt[0]):ct="MultiLineString"),ct!=="Point"&&ct!=="MultiPoint"||(ct=Wt.length===3?"Point":"MultiPoint"),Te.push(Vt(dt.id,ct,Wt,dt.tags))}}}return Te.length?Te:null}function bo(fe,X,Y,de,ve){for(var Ae=0;Ae<fe.length;Ae+=3){var Pe=fe[Ae+ve];Pe>=Y&&Pe<=de&&(X.push(fe[Ae]),X.push(fe[Ae+1]),X.push(fe[Ae+2]))}}function Nn(fe,X,Y,de,ve,Ae,Pe){for(var ke,Te,Le=Un(fe),dt=ve===0?Ps:Eo,mt=fe.start,ct=0;ct<fe.length-3;ct+=3){var Ft=fe[ct],jt=fe[ct+1],Wt=fe[ct+2],Qt=fe[ct+3],or=fe[ct+4],en=ve===0?Ft:jt,yn=ve===0?Qt:or,li=!1;Pe&&(ke=Math.sqrt(Math.pow(Ft-Qt,2)+Math.pow(jt-or,2))),en<Y?yn>Y&&(Te=dt(Le,Ft,jt,Qt,or,Y),Pe&&(Le.start=mt+ke*Te)):en>de?yn<de&&(Te=dt(Le,Ft,jt,Qt,or,de),Pe&&(Le.start=mt+ke*Te)):wo(Le,Ft,jt,Wt),yn<Y&&en>=Y&&(Te=dt(Le,Ft,jt,Qt,or,Y),li=!0),yn>de&&en<=de&&(Te=dt(Le,Ft,jt,Qt,or,de),li=!0),!Ae&&li&&(Pe&&(Le.end=mt+ke*Te),X.push(Le),Le=Un(fe)),Pe&&(mt+=ke)}var zn=fe.length-3;Ft=fe[zn],jt=fe[zn+1],Wt=fe[zn+2],(en=ve===0?Ft:jt)>=Y&&en<=de&&wo(Le,Ft,jt,Wt),zn=Le.length-3,Ae&&zn>=3&&(Le[zn]!==Le[0]||Le[zn+1]!==Le[1])&&wo(Le,Le[0],Le[1],Le[2]),Le.length&&X.push(Le)}function Un(fe){var X=[];return X.size=fe.size,X.start=fe.start,X.end=fe.end,X}function Qn(fe,X,Y,de,ve,Ae){for(var Pe=0;Pe<fe.length;Pe++)Nn(fe[Pe],X,Y,de,ve,Ae,!1)}function wo(fe,X,Y,de){fe.push(X),fe.push(Y),fe.push(de)}function Ps(fe,X,Y,de,ve,Ae){var Pe=(Ae-X)/(de-X);return fe.push(Ae),fe.push(Y+(ve-Y)*Pe),fe.push(1),Pe}function Eo(fe,X,Y,de,ve,Ae){var Pe=(Ae-Y)/(ve-Y);return fe.push(X+(de-X)*Pe),fe.push(Ae),fe.push(1),Pe}function jn(fe,X){for(var Y=[],de=0;de<fe.length;de++){var ve,Ae=fe[de],Pe=Ae.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")ve=Wo(Ae.geometry,X);else if(Pe==="MultiLineString"||Pe==="Polygon"){ve=[];for(var ke=0;ke<Ae.geometry.length;ke++)ve.push(Wo(Ae.geometry[ke],X))}else if(Pe==="MultiPolygon")for(ve=[],ke=0;ke<Ae.geometry.length;ke++){for(var Te=[],Le=0;Le<Ae.geometry[ke].length;Le++)Te.push(Wo(Ae.geometry[ke][Le],X));ve.push(Te)}Y.push(Vt(Ae.id,Pe,ve,Ae.tags))}return Y}function Wo(fe,X){var Y=[];Y.size=fe.size,fe.start!==void 0&&(Y.start=fe.start,Y.end=fe.end);for(var de=0;de<fe.length;de+=3)Y.push(fe[de]+X,fe[de+1],fe[de+2]);return Y}function Qa(fe,X){if(fe.transformed)return fe;var Y,de,ve,Ae=1<<fe.z,Pe=fe.x,ke=fe.y;for(Y=0;Y<fe.features.length;Y++){var Te=fe.features[Y],Le=Te.geometry,dt=Te.type;if(Te.geometry=[],dt===1)for(de=0;de<Le.length;de+=2)Te.geometry.push(Go(Le[de],Le[de+1],X,Ae,Pe,ke));else for(de=0;de<Le.length;de++){var mt=[];for(ve=0;ve<Le[de].length;ve+=2)mt.push(Go(Le[de][ve],Le[de][ve+1],X,Ae,Pe,ke));Te.geometry.push(mt)}}return fe.transformed=!0,fe}function Go(fe,X,Y,de,ve,Ae){return[Math.round(Y*(fe*de-ve)),Math.round(Y*(X*de-Ae))]}function Hi(fe,X,Y,de,ve){for(var Ae=X===ve.maxZoom?0:ve.tolerance/((1<<X)*ve.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:de,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ke=0;ke<fe.length;ke++){Pe.numFeatures++,So(Pe,fe[ke],Ae,ve);var Te=fe[ke].minX,Le=fe[ke].minY,dt=fe[ke].maxX,mt=fe[ke].maxY;Te<Pe.minX&&(Pe.minX=Te),Le<Pe.minY&&(Pe.minY=Le),dt>Pe.maxX&&(Pe.maxX=dt),mt>Pe.maxY&&(Pe.maxY=mt)}return Pe}function So(fe,X,Y,de){var ve=X.geometry,Ae=X.type,Pe=[];if(Ae==="Point"||Ae==="MultiPoint")for(var ke=0;ke<ve.length;ke+=3)Pe.push(ve[ke]),Pe.push(ve[ke+1]),fe.numPoints++,fe.numSimplified++;else if(Ae==="LineString")ga(Pe,ve,fe,Y,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(ke=0;ke<ve.length;ke++)ga(Pe,ve[ke],fe,Y,Ae==="Polygon",ke===0);else if(Ae==="MultiPolygon")for(var Te=0;Te<ve.length;Te++){var Le=ve[Te];for(ke=0;ke<Le.length;ke++)ga(Pe,Le[ke],fe,Y,!0,ke===0)}if(Pe.length){var dt=X.tags||null;if(Ae==="LineString"&&de.lineMetrics){for(var mt in dt={},X.tags)dt[mt]=X.tags[mt];dt.mapbox_clip_start=ve.start/ve.size,dt.mapbox_clip_end=ve.end/ve.size}var ct={geometry:Pe,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:dt};X.id!==null&&(ct.id=X.id),fe.features.push(ct)}}function ga(fe,X,Y,de,ve,Ae){var Pe=de*de;if(de>0&&X.size<(ve?Pe:de))Y.numPoints+=X.length/3;else{for(var ke=[],Te=0;Te<X.length;Te+=3)(de===0||X[Te+2]>Pe)&&(Y.numSimplified++,ke.push(X[Te]),ke.push(X[Te+1])),Y.numPoints++;ve&&function(Le,dt){for(var mt=0,ct=0,Ft=Le.length,jt=Ft-2;ct<Ft;jt=ct,ct+=2)mt+=(Le[ct]-Le[jt])*(Le[ct+1]+Le[jt+1]);if(mt>0===dt)for(ct=0,Ft=Le.length;ct<Ft/2;ct+=2){var Wt=Le[ct],Qt=Le[ct+1];Le[ct]=Le[Ft-2-ct],Le[ct+1]=Le[Ft-1-ct],Le[Ft-2-ct]=Wt,Le[Ft-1-ct]=Qt}}(ke,Ae),fe.push(ke)}}function To(fe,X){var Y=(X=this.options=function(ve,Ae){for(var Pe in Ae)ve[Pe]=Ae[Pe];return ve}(Object.create(this.options),X)).debug;if(Y&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var de=function(ve,Ae){var Pe=[];if(ve.type==="FeatureCollection")for(var ke=0;ke<ve.features.length;ke++)qr(Pe,ve.features[ke],Ae,ke);else qr(Pe,ve.type==="Feature"?ve:{geometry:ve},Ae);return Pe}(fe,X);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=function(ve,Ae){var Pe=Ae.buffer/Ae.extent,ke=ve,Te=Yn(ve,1,-1-Pe,Pe,0,-1,2,Ae),Le=Yn(ve,1,1-Pe,2+Pe,0,-1,2,Ae);return(Te||Le)&&(ke=Yn(ve,1,-Pe,1+Pe,0,-1,2,Ae)||[],Te&&(ke=jn(Te,1).concat(ke)),Le&&(ke=ke.concat(jn(Le,-1)))),ke}(de,X),de.length&&this.splitTile(de,0,0,0),Y&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ho(fe,X,Y){return 32*((1<<fe)*Y+X)+fe}function ya(fe,X){const Y=fe.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const de=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!de)return X(null,null);const ve=new class{constructor(Pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=Pe.length,this._features=Pe}feature(Pe){return new class{constructor(ke){this._feature=ke,this.extent=l.EXTENT,this.type=ke.type,this.properties=ke.tags,"id"in ke&&!isNaN(ke.id)&&(this.id=parseInt(ke.id,10))}loadGeometry(){if(this._feature.type===1){const ke=[];for(const Te of this._feature.geometry)ke.push([new l.Point(Te[0],Te[1])]);return ke}{const ke=[];for(const Te of this._feature.geometry){const Le=[];for(const dt of Te)Le.push(new l.Point(dt[0],dt[1]));ke.push(Le)}return ke}}toGeoJSON(ke,Te,Le){return W.call(this,ke,Te,Le)}}(this._features[Pe])}}(de.features);let Ae=Ut(ve);Ae.byteOffset===0&&Ae.byteLength===Ae.buffer.byteLength||(Ae=new Uint8Array(Ae)),X(null,{vectorTile:ve,rawData:Ae.buffer})}To.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},To.prototype.splitTile=function(fe,X,Y,de,ve,Ae,Pe){for(var ke=[fe,X,Y,de],Te=this.options,Le=Te.debug;ke.length;){de=ke.pop(),Y=ke.pop(),X=ke.pop(),fe=ke.pop();var dt=1<<X,mt=Ho(X,Y,de),ct=this.tiles[mt];if(!ct&&(Le>1&&console.time("creation"),ct=this.tiles[mt]=Hi(fe,X,Y,de,Te),this.tileCoords.push({z:X,x:Y,y:de}),Le)){Le>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,Y,de,ct.numFeatures,ct.numPoints,ct.numSimplified),console.timeEnd("creation"));var Ft="z"+X;this.stats[Ft]=(this.stats[Ft]||0)+1,this.total++}if(ct.source=fe,ve){if(X===Te.maxZoom||X===ve)continue;var jt=1<<ve-X;if(Y!==Math.floor(Ae/jt)||de!==Math.floor(Pe/jt))continue}else if(X===Te.indexMaxZoom||ct.numPoints<=Te.indexMaxPoints)continue;if(ct.source=null,fe.length!==0){Le>1&&console.time("clipping");var Wt,Qt,or,en,yn,li,zn=.5*Te.buffer/Te.extent,qo=.5-zn,Vn=.5+zn,_i=1+zn;Wt=Qt=or=en=null,yn=Yn(fe,dt,Y-zn,Y+Vn,0,ct.minX,ct.maxX,Te),li=Yn(fe,dt,Y+qo,Y+_i,0,ct.minX,ct.maxX,Te),fe=null,yn&&(Wt=Yn(yn,dt,de-zn,de+Vn,1,ct.minY,ct.maxY,Te),Qt=Yn(yn,dt,de+qo,de+_i,1,ct.minY,ct.maxY,Te),yn=null),li&&(or=Yn(li,dt,de-zn,de+Vn,1,ct.minY,ct.maxY,Te),en=Yn(li,dt,de+qo,de+_i,1,ct.minY,ct.maxY,Te),li=null),Le>1&&console.timeEnd("clipping"),ke.push(Wt||[],X+1,2*Y,2*de),ke.push(Qt||[],X+1,2*Y,2*de+1),ke.push(or||[],X+1,2*Y+1,2*de),ke.push(en||[],X+1,2*Y+1,2*de+1)}}},To.prototype.getTile=function(fe,X,Y){var de=this.options,ve=de.extent,Ae=de.debug;if(fe<0||fe>24)return null;var Pe=1<<fe,ke=Ho(fe,X=(X%Pe+Pe)%Pe,Y);if(this.tiles[ke])return Qa(this.tiles[ke],ve);Ae>1&&console.log("drilling down to z%d-%d-%d",fe,X,Y);for(var Te,Le=fe,dt=X,mt=Y;!Te&&Le>0;)Le--,dt=Math.floor(dt/2),mt=Math.floor(mt/2),Te=this.tiles[Ho(Le,dt,mt)];return Te&&Te.source?(Ae>1&&console.log("found parent tile z%d-%d-%d",Le,dt,mt),Ae>1&&console.time("drilling down"),this.splitTile(Te.source,Le,dt,mt,fe,X,Y),Ae>1&&console.timeEnd("drilling down"),this.tiles[ke]?Qa(this.tiles[ke],ve):null):null};class Ja extends l.VectorTileWorkerSource{constructor(X,Y,de,ve,Ae){super(X,Y,de,ve,ya),Ae&&(this.loadGeoJSON=Ae)}loadData(X,Y){const de=X&&X.request,ve=de&&de.collectResourceTiming;this.loadGeoJSON(X,(Ae,Pe)=>{if(Ae||!Pe)return Y(Ae);if(typeof Pe!="object")return Y(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{U(Pe,!0);try{if(X.filter){const Te=l.createExpression(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map(dt=>`${dt.key}: ${dt.message}`).join(", "));Pe={type:"FeatureCollection",features:Pe.features.filter(dt=>Te.value.evaluate({zoom:0},dt))}}this._geoJSONIndex=X.cluster?new nt(function({superclusterOptions:Te,clusterProperties:Le}){if(!Le||!Te)return Te;const dt={},mt={},ct={accumulated:null,zoom:0},Ft={properties:null},jt=Object.keys(Le);for(const Wt of jt){const[Qt,or]=Le[Wt],en=l.createExpression(or),yn=l.createExpression(typeof Qt=="string"?[Qt,["accumulated"],["get",Wt]]:Qt);dt[Wt]=en.value,mt[Wt]=yn.value}return Te.map=Wt=>{Ft.properties=Wt;const Qt={};for(const or of jt)Qt[or]=dt[or].evaluate(ct,Ft);return Qt},Te.reduce=(Wt,Qt)=>{Ft.properties=Qt;for(const or of jt)ct.accumulated=Wt[or],Wt[or]=mt[or].evaluate(ct,Ft)},Te}(X)).load(Pe.features):function(Te,Le){return new To(Te,Le)}(Pe,X.geojsonVtOptions)}catch(Te){return Y(Te)}this.loaded={};const ke={};if(ve){const Te=l.getPerformanceMeasurement(de);Te&&(ke.resourceTiming={},ke.resourceTiming[X.source]=JSON.parse(JSON.stringify(Te)))}Y(null,ke)}})}reloadTile(X,Y){const de=this.loaded;return de&&de[X.uid]?super.reloadTile(X,Y):this.loadTile(X,Y)}loadGeoJSON(X,Y){if(X.request)l.getJSON(X.request,Y);else{if(typeof X.data!="string")return Y(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return Y(null,JSON.parse(X.data))}catch{return Y(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(de){Y(de)}}getClusterChildren(X,Y){try{Y(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(de){Y(de)}}getClusterLeaves(X,Y){try{Y(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(de){Y(de)}}}class Ds{constructor(X){this.self=X,this.actor=new l.Actor(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:Ja},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Y,de)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=de},this.self.registerRTLTextPlugin=Y=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=Y.applyArabicShaping,l.plugin.processBidirectionalText=Y.processBidirectionalText,l.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}}clearCaches(X,Y,de){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],de()}checkIfReady(X,Y,de){de()}setReferrer(X,Y){this.referrer=Y}spriteLoaded(X,Y){this.isSpriteLoaded[X]=Y;for(const de in this.workerSources[X]){const ve=this.workerSources[X][de];for(const Ae in ve)ve[Ae]instanceof l.VectorTileWorkerSource&&(ve[Ae].isSpriteLoaded=Y,ve[Ae].fire(new l.Event("isSpriteLoaded")))}}setImages(X,Y,de){this.availableImages[X]=Y;for(const ve in this.workerSources[X]){const Ae=this.workerSources[X][ve];for(const Pe in Ae)Ae[Pe].availableImages=Y}de()}enableTerrain(X,Y,de){this.terrain=Y,de()}setProjection(X,Y){this.projections[X]=l.getProjection(Y)}setLayers(X,Y,de){this.getLayerIndex(X).replace(Y),de()}updateLayers(X,Y,de){this.getLayerIndex(X).update(Y.layers,Y.removedIds),de()}loadTile(X,Y,de){const ve=this.enableTerrain?l.extend({enableTerrain:this.terrain},Y):Y;ve.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,Y.type,Y.source).loadTile(ve,de)}loadDEMTile(X,Y,de){const ve=this.enableTerrain?l.extend({buildQuadTree:this.terrain},Y):Y;this.getDEMWorkerSource(X,Y.source).loadTile(ve,de)}reloadTile(X,Y,de){const ve=this.enableTerrain?l.extend({enableTerrain:this.terrain},Y):Y;ve.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,Y.type,Y.source).reloadTile(ve,de)}abortTile(X,Y,de){this.getWorkerSource(X,Y.type,Y.source).abortTile(Y,de)}removeTile(X,Y,de){this.getWorkerSource(X,Y.type,Y.source).removeTile(Y,de)}removeSource(X,Y,de){if(!this.workerSources[X]||!this.workerSources[X][Y.type]||!this.workerSources[X][Y.type][Y.source])return;const ve=this.workerSources[X][Y.type][Y.source];delete this.workerSources[X][Y.type][Y.source],ve.removeSource!==void 0?ve.removeSource(Y,de):de()}loadWorkerSource(X,Y,de){try{this.self.importScripts(Y.url),de()}catch(ve){de(ve.toString())}}syncRTLPluginState(X,Y,de){try{l.plugin.setState(Y);const ve=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&ve!=null){this.self.importScripts(ve);const Ae=l.plugin.isParsed();de(Ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ve}`),Ae)}}catch(ve){de(ve.toString())}}getAvailableImages(X){let Y=this.availableImages[X];return Y||(Y=[]),Y}getLayerIndex(X){let Y=this.layerIndexes[X];return Y||(Y=this.layerIndexes[X]=new C),Y}getWorkerSource(X,Y,de){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][Y]||(this.workerSources[X][Y]={}),!this.workerSources[X][Y][de]){const ve={send:(Ae,Pe,ke,Te,Le,dt)=>{this.actor.send(Ae,Pe,ke,X,Le,dt)},scheduler:this.actor.scheduler};this.workerSources[X][Y][de]=new this.workerSourceTypes[Y](ve,this.getLayerIndex(X),this.getAvailableImages(X),this.isSpriteLoaded[X])}return this.workerSources[X][Y][de]}getDEMWorkerSource(X,Y){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][Y]||(this.demWorkerSources[X][Y]=new P),this.demWorkerSources[X][Y]}enforceCacheSizeLimit(X,Y){l.enforceCacheSizeLimit(Y)}getWorkerPerformanceMetrics(X,Y,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ds(self)),Ds}),d(["./shared"],function(l){function w(f,s){if(Array.isArray(f)){if(!Array.isArray(s)||f.length!==s.length)return!1;for(let h=0;h<f.length;h++)if(!w(f[h],s[h]))return!1;return!0}if(typeof f=="object"&&f!==null&&s!==null){if(typeof s!="object"||Object.keys(f).length!==Object.keys(s).length)return!1;for(const h in f)if(!w(f[h],s[h]))return!1;return!0}return f===s}var T=C;function C(f){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,b=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(b);try{v=new Worker(A),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(A),g}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===g.width}()?(P[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(P[h]=function(g){var v,b=function(A){var I=document.createElement("canvas"),D=Object.create(C.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=A,I.getContext("webgl",D)||I.getContext("experimental-webgl",D)}(g);if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),b.getShaderParameter(v,b.COMPILE_STATUS)===!0)}(h)),P[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(f)}var P={};function z(f,s,h){const g=l.window.document.createElement(f);return s!==void 0&&(g.className=s),h&&h.appendChild(g),g}function $(f,s,h){const g=l.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const v of Object.keys(s))g.setAttributeNS(null,v,s[v]);return h&&h.appendChild(g),g}C.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const U=l.window.document&&l.window.document.documentElement.style,W=U&&U.userSelect!==void 0?"userSelect":"WebkitUserSelect";let N;function V(){U&&W&&(N=U[W],U[W]="none")}function R(){U&&W&&(U[W]=N)}function F(f){f.preventDefault(),f.stopPropagation(),l.window.removeEventListener("click",F,!0)}function H(){l.window.addEventListener("click",F,!0),l.window.setTimeout(()=>{l.window.removeEventListener("click",F,!0)},0)}function J(f,s){const h=f.getBoundingClientRect();return ge(f,h,s)}function te(f,s){const h=f.getBoundingClientRect(),g=[];for(let v=0;v<s.length;v++)g.push(ge(f,h,s[v]));return g}function se(f){return l.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function ge(f,s,h){const g=f.offsetWidth===s.width?1:f.offsetWidth/s.width;return new l.Point((h.clientX-s.left)*g,(h.clientY-s.top)*g)}function xe(f,s){var h=s[0],g=s[1],v=s[2],b=s[3],A=h*b-v*g;return A?(f[0]=b*(A=1/A),f[1]=-g*A,f[2]=-v*A,f[3]=h*A,f):null}function Ee(f){const{userImage:s}=f;return!!(s&&s.render&&s.render())&&(f.data.replace(new Uint8Array(s.data.buffer)),!0)}class Be extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:g}of this.requestors)this._notify(h,g);this.requestors=[]}}hasImage(s){return!!this.getImage(s)}getImage(s){return this.images[s]}addImage(s,h){this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,h){if(!s)return!0;let g=0;for(const v of s){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h){h.version=this.images[s].version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let g=!0;if(!this.isLoaded())for(const v of s)this.images[v]||(g=!1);this.isLoaded()||g?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const g={};for(const v of s){this.images[v]||this.fire(new l.Event("styleimagemissing",{id:v}));const b=this.images[v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:l.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,g)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],g=this.getImage(s);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new l.ImagePosition(v,g);this.patterns[s]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(s,this.atlasImage,h.RGBA),this.atlasTexture&&this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const b in this.patterns)s.push(this.patterns[b].bin);const{w:h,h:g}=l.potpack(s),v=this.atlasImage;v.resize({width:h||1,height:g||1});for(const b in this.patterns){const{bin:A}=this.patterns[b],I=A.x+1,D=A.y+1,B=this.images[b].data,L=B.width,q=B.height;l.RGBAImage.copy(B,v,{x:0,y:0},{x:I,y:D},{width:L,height:q}),l.RGBAImage.copy(B,v,{x:0,y:q-1},{x:I,y:D-1},{width:L,height:1}),l.RGBAImage.copy(B,v,{x:0,y:0},{x:I,y:D+q},{width:L,height:1}),l.RGBAImage.copy(B,v,{x:L-1,y:0},{x:I-1,y:D},{width:1,height:q}),l.RGBAImage.copy(B,v,{x:0,y:0},{x:I+L,y:D},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const g=this.images[h];Ee(g)&&this.updateImage(h,g)}}}const Fe=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(f,s){return function([h,g,v]){const b=l.degToRad(g+90),A=l.degToRad(v);return{x:h*Math.cos(b)*Math.sin(A),y:h*Math.sin(b)*Math.sin(A),z:h*Math.cos(A),azimuthal:g,polar:v}}(f.expression.evaluate(s))}interpolate(f,s,h){return{x:l.number(f.x,s.x,h),y:l.number(f.y,s.y,h),z:l.number(f.z,s.z,h),azimuthal:l.number(f.azimuthal,s.azimuthal,h),polar:l.number(f.polar,s.polar,h)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)});class Ve extends l.Evented{constructor(s){super(),this._transitionable=new l.Transitionable(Fe),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(l.validateLight,s,h))for(const g in s){const v=s[g];l.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-11),v):this._transitionable.setValue(g,v)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&l.emitValidationErrors(this,s.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}const Ct=new l.Properties({source:new l.DataConstantProperty(l.spec.terrain.source),exaggeration:new l.DataConstantProperty(l.spec.terrain.exaggeration)});let Dt=class extends l.Evented{constructor(f,s){super(),this._transitionable=new l.Transitionable(Ct),this.set(f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(f){for(const s in f){const h=f[s];l.endsWith(s,"-transition")?this._transitionable.setTransition(s.slice(0,-11),h):this._transitionable.setValue(s,h)}}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}};function Ut(f,s,h,g){const v=l.smoothstep(45,65,h),[b,A]=cr(f,g),I=l.length(s);let D=1-Math.min(1,Math.exp((I-b)/(A-b)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*v*f.alpha}function cr(f,s){const h=.5/Math.tan(.5*s);return[f.range[0]+h,f.range[1]+h]}const qe=new l.Properties({range:new l.DataConstantProperty(l.spec.fog.range),color:new l.DataConstantProperty(l.spec.fog.color),"high-color":new l.DataConstantProperty(l.spec.fog["high-color"]),"space-color":new l.DataConstantProperty(l.spec.fog["space-color"]),"horizon-blend":new l.DataConstantProperty(l.spec.fog["horizon-blend"]),"star-intensity":new l.DataConstantProperty(l.spec.fog["star-intensity"])});class St extends l.Evented{constructor(s,h){super(),this._transitionable=new l.Transitionable(qe),this.set(s),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const s=this._transform,h=s.projection.name==="globe",g=l.globeToMercatorTransition(s.zoom),v=this.properties.get("range"),b=[.5,3];return{range:h?[l.number(b[0],v[0],g),l.number(b[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h={}){if(!this._validate(l.validateFog,s,h)){for(const g of Object.keys(l.spec.fog))s&&s[g]===void 0&&(s[g]=l.spec.fog[g].default);for(const g in s){const v=s[g];l.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-11),v):this._transitionable.setValue(g,v)}}}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:l.smoothstep(45,65,s))*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(g,v,b){const A=l.MercatorCoordinate.fromLngLat(v),I=b.elevation?b.elevation.getAtPointOrZero(A):0,D=[A.x,A.y,I];return l.transformMat4(D,D,b.mercatorFogMatrix),Ut(g,D,b.pitch,b._fov)}(this.state,s,h):0}getFovAdjustedRange(s){return this._transform.projection.supportsFog?cr(this.state,s):[0,1]}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&l.emitValidationErrors(this,s.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class gt{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const g=this.workerPool.acquire(this.id);for(let v=0;v<g.length;v++){const b=new gt.Actor(g[v],h,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,h,g){l.asyncAll(this.actors,(v,b)=>{v.send(s,h,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function je(f,s,h){return s*(l.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}gt.Actor=l.Actor;class et{constructor(s,h,g,v){this.screenBounds=s,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,h){let g,v;if(s instanceof l.Point||typeof s[0]=="number"){const b=l.Point.convert(s);g=[b],v=h.isPointAboveHorizon(b)}else{const b=l.Point.convert(s[0]),A=l.Point.convert(s[1]);g=[b,A],v=l.polygonizeBounds(b,A).every(I=>h.isPointAboveHorizon(I))}return new et(g,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return l.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new l.Point(1,1)):this.screenBounds[1],v=l.polygonizeBounds(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),l.bufferConvexPolygon(v,s)}bufferedCameraGeometryGlobe(s){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new l.Point(1,1)):this.screenBounds[1],v=l.polygonizeBounds(h,g,s),b=this.cameraPoint.clone();switch(3*((b.y>h.y)+(b.y>g.y))+((b.x>h.x)+(b.x>g.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(s,h,g,v=0){const b=s.queryPadding/h._pixelsPerMercatorPixel+1,A=g?this._bufferedCameraMercator(b,h):this._bufferedScreenMercator(b,h);let I=s.tileID.wrap+(A.unwrapped?v:0);const D=A.polygon.map(ae=>l.getTilePoint(s.tileTransform,ae,I));if(!l.polygonIntersectsBox(D,0,0,l.EXTENT,l.EXTENT))return;I=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const B=this.screenGeometryMercator.polygon.map(ae=>l.getTileVec3(s.tileTransform,ae,I)),L=B.map(ae=>new l.Point(ae[0],ae[1])),q=h.getFreeCameraOptions().position||new l.MercatorCoordinate(0,0,0),Q=l.getTileVec3(s.tileTransform,q,I),ne=B.map(ae=>{const Z=l.sub(ae,ae,Q);return l.normalize(Z,Z),new l.Ray(Q,Z)}),oe=je(s,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:ne,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(ie=l.getBounds(D),ie.min.x=l.clamp(ie.min.x,0,l.EXTENT),ie.min.y=l.clamp(ie.min.y,0,l.EXTENT),ie.max.x=l.clamp(ie.max.x,0,l.EXTENT),ie.max.y=l.clamp(ie.max.y,0,l.EXTENT),ie),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:oe};var ie}_bufferedScreenMercator(s,h){const g=ur(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),h):{polygon:this.bufferedScreenGeometry(s).map(b=>h.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(s,h){const g=ur(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),h):{polygon:this.bufferedCameraGeometry(s).map(b=>h.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(s,h){const g=function(b,A){const I=l.multiply([],A.pixelMatrix,A.globeMatrix),D=[0,-l.GLOBE_RADIUS,0,1],B=[0,l.GLOBE_RADIUS,0,1],L=[0,0,0,1];l.transformMat4$1(D,D,I),l.transformMat4$1(B,B,I),l.transformMat4$1(L,L,I);const q=new l.Point(D[0]/D[3],D[1]/D[3]),Q=new l.Point(B[0]/B[3],B[1]/B[3]),ne=l.polygonContainsPoint(b,q)&&D[3]<L[3],oe=l.polygonContainsPoint(b,Q)&&B[3]<L[3];if(!ne&&!oe)return null;const ie=function(we,Ce,Ie){for(let Re=1;Re<we.length;Re++){const st=it(Ce.pointCoordinate3D(we[Re-1]).x),De=it(Ce.pointCoordinate3D(we[Re]).x);if(Ie<0){if(st<De)return{idx:Re,t:-st/(De-1-st)}}else if(De<st)return{idx:Re,t:(1-st)/(De+1-st)}}return null}(b,A,ne?-1:1);if(!ie)return null;const{idx:ae,t:Z}=ie;let re=ae>1?nt(b.slice(0,ae),A):[],ue=ae<b.length?nt(b.slice(ae),A):[];re=re.map(we=>new l.Point(it(we.x),we.y)),ue=ue.map(we=>new l.Point(it(we.x),we.y));const he=[...re];he.length===0&&he.push(ue[ue.length-1]);const be=l.number(he[he.length-1].y,(ue.length===0?re[0]:ue[0]).y,Z);let Se;return Se=ne?[new l.Point(0,be),new l.Point(0,0),new l.Point(1,0),new l.Point(1,be)]:[new l.Point(1,be),new l.Point(1,1),new l.Point(0,1),new l.Point(0,be)],he.push(...Se),ue.length===0?he.push(re[0]):he.push(...ue),{polygon:he.map(we=>new l.MercatorCoordinate(we.x,we.y)),unwrapped:!1}}(s,h);if(g)return g;const v=function(b,A){let I=!1,D=-1/0,B=0;for(let q=0;q<b.length-1;q++)b[q].x>D&&(D=b[q].x,B=q);for(let q=0;q<b.length-1;q++){const Q=(B+q)%(b.length-1),ne=b[Q],oe=b[Q+1];Math.abs(ne.x-oe.x)>.5&&(ne.x<oe.x?(ne.x+=1,Q===0&&(b[b.length-1].x+=1)):(oe.x+=1,Q+1===b.length-1&&(b[0].x+=1)),I=!0)}const L=l.mercatorXfromLng(A.center.lng);return I&&L<Math.abs(L-1)&&b.forEach(q=>{q.x-=1}),{polygon:b,unwrapped:I}}(nt(s,h).map(b=>new l.Point(it(b.x),b.y)),h);return{polygon:v.polygon.map(b=>new l.MercatorCoordinate(b.x,b.y)),unwrapped:v.unwrapped}}}function nt(f,s){return l.resample(f,h=>{const g=s.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function it(f){return f<0?1+f%1:f%1}function ur(f){return 100*f|0}function Xt(f,s,h,g,v){const b=function(A,I){if(A)return v(A);if(I){f.url&&I.tiles&&f.tiles&&delete f.tiles;const D=l.pick(l.extend(I,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(D.vectorLayers=I.vector_layers,D.vectorLayerIds=D.vectorLayers.map(B=>B.id)),D.tiles=s.canonicalizeTileset(D,f.url),v(null,D)}};return f.url?l.getJSON(s.transformRequest(s.normalizeSourceURL(f.url,null,h,g),l.ResourceType.Source),b):l.exported.frame(()=>b(null,f))}class Pr{constructor(s,h,g){this.bounds=l.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),g=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*h),v=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*h),b=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*h),A=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=g&&s.x<b&&s.y>=v&&s.y<A}}class Yt{constructor(s,h,g){this.context=s;const v=s.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const si={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class mr{constructor(s,h,g,v){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.context=s;const b=s.gl;this.buffer=b.createBuffer(),s.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let g=0;g<this.attributes.length;g++){const v=h.attributes[this.attributes[g].name];v!==void 0&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,h,g){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],A=h.attributes[b.name];A!==void 0&&s.vertexAttribPointer(A,b.components,s[si[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Vt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ii extends Vt{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class qr extends Vt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class pn extends Vt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Tr extends Vt{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Bn extends Vt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class ma extends Vt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class yi extends Vt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Yn extends Vt{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class bo extends Vt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class Nn extends Vt{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Un extends Vt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class Qn extends Vt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class wo extends Vt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class Ps extends Vt{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Eo extends Vt{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class jn extends Vt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Wo extends Vt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Qa extends Vt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Go extends Vt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let Hi,So=class extends Vt{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class ga extends Vt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class To extends Vt{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ho extends Vt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class ya extends Vt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Ja extends Vt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Ds extends Vt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class fe extends Vt{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class X extends Vt{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class Y extends Vt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class de extends Vt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class ve extends Vt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Ae extends Vt{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class Pe extends Ae{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class ke extends Ae{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Te extends ke{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Le{constructor(s,h,g,v){this.context=s,this.width=h,this.height=g;const b=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new Pe(s,b),v&&(this.depthAttachment=new ke(s,b))}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const g=this.depthAttachment.get();g&&s.deleteRenderbuffer(g)}s.deleteFramebuffer(this.framebuffer)}}class dt{constructor(s,h=!1){if(this.gl=s,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){const g=s;this.extVertexArrayObject={createVertexArrayOES:g.createVertexArray.bind(s),deleteVertexArrayOES:g.deleteVertexArray.bind(s),bindVertexArrayOES:g.bindVertexArray.bind(s)}}this.clearColor=new Ii(this),this.clearDepth=new qr(this),this.clearStencil=new pn(this),this.colorMask=new Tr(this),this.depthMask=new Bn(this),this.stencilMask=new ma(this),this.stencilFunc=new yi(this),this.stencilOp=new Yn(this),this.stencilTest=new bo(this),this.depthRange=new Nn(this),this.depthTest=new Un(this),this.depthFunc=new Qn(this),this.blend=new wo(this),this.blendFunc=new Ps(this),this.blendColor=new Eo(this),this.blendEquation=new jn(this),this.cullFace=new Wo(this),this.cullFaceSide=new Qa(this),this.frontFace=new Go(this),this.program=new So(this),this.activeTexture=new ga(this),this.viewport=new To(this),this.bindFramebuffer=new Ho(this),this.bindRenderbuffer=new ya(this),this.bindTexture=new Ja(this),this.bindVertexBuffer=new Ds(this),this.bindElementBuffer=new fe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new X(this),this.pixelStoreUnpack=new Y(this),this.pixelStoreUnpackPremultiplyAlpha=new de(this),this.pixelStoreUnpackFlipY=new ve(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=s.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&s.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||s.getExtension("OES_standard_derivatives"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new Yt(this,s,h)}createVertexBuffer(s,h,g){return new mr(this,s,h,g)}createRenderbuffer(s,h,g){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,s,h,g),this.bindRenderbuffer.set(null),b}createFramebuffer(s,h,g){return new Le(this,s,h,g)}clear({color:s,depth:h,stencil:g}){const v=this.gl;let b=0;s&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(b)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){w(s.blendFunction,l.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class mt extends l.Evented{constructor(s,h,g,v){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(h,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new l.DedupedRequest}load(s){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=Xt(this._options,this.map._requestManager,h,g,(v,b)=>{this._tileJSONRequest=null,this._loaded=!0,v?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new l.ErrorEvent(v))):b&&(l.extend(this,b),b.bounds&&(this.tileBounds=new Pr(b.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(b.tiles,this.map._requestManager._customAccessToken),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return l.extend({},this._options)}loadTile(s,h){const g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(g,l.ResourceType.Tile),data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile};if(v.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",v,b.bind(this));else if(s.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",v,b.bind(this),void 0,!0);else{const A=l.loadVectorTile.call({deduped:this._deduped},v,(I,D)=>{I||!D?b.call(this,I):(v.data={cacheControl:D.cacheControl,expires:D.expires,rawData:D.rawData.slice(0)},s.actor&&s.actor.send("loadTile",v,b.bind(this),void 0,!0))},!0);s.request={cancel:A}}function b(A,I){return delete s.request,s.aborted?h(null):A&&A.status!==404?h(A):(I&&I.resourceTiming&&(s.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&s.setExpiryData(I),s.loadVectorData(I,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id})}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ct extends l.Evented{constructor(s,h,g,v){super(),this.id=s,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},h),l.extend(this,l.pick(h,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Xt(this._options,this.map._requestManager,null,null,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new l.ErrorEvent(h)):g&&(l.extend(this,g),g.bounds&&(this.tileBounds=new Pr(g.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(g.tiles),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(h)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return l.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const g=l.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=l.getImage(this.map._requestManager.transformRequest(v,l.ResourceType.Tile),(b,A,I,D)=>(delete s.request,s.aborted?(s.state="unloaded",h(null)):b?(s.state="errored",h(b)):A?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:I,expires:D}),s.setTexture(A,this.map.painter),s.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(s,h,g){s.setTexture(h,g)}static unloadTileData(s,h){s.texture&&h.saveTileTexture(s.texture)}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ft(f,s,h,g,v,b,A,I){const D=[f,h,v,s,g,b,1,1,1],B=[A,I,1],L=l.adjoint([],D),[q,Q,ne]=l.transformMat3(B,B,l.transpose(L,L));return l.multiply$1(D,[q,0,0,0,Q,0,0,0,ne],D)}class jt extends l.Evented{constructor(s,h,g,v){super(),this.id=s,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=h,this._dirty=!1}load(s,h){this._loaded=h||!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(g,v)=>{if(this._imageRequest=null,this._loaded=!0,g)this.fire(new l.ErrorEvent(g));else if(v){const{HTMLImageElement:b}=l.window;this.image=v instanceof b?l.exported.getImageData(v):v,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading()}})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(s){this.coordinates=s,this._boundsArray=void 0;const h=s.map(l.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let v=1/0,b=1/0,A=-1/0,I=-1/0;for(const q of g)v=Math.min(v,q.x),b=Math.min(b,q.y),A=Math.max(A,q.x),I=Math.max(I,q.y);const D=Math.max(A-v,I-b),B=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),L=Math.pow(2,B);return new l.CanonicalTileID(B,Math.floor((v+A)/2*L),Math.floor((b+I)/2*L))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(s){for(const D in this.tiles){const B=this.tiles[D];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray)return;const h=l.tileTransform(this.tileID,this.map.transform.projection),[g,v,b,A]=this.coordinates.map(D=>{const B=h.projection.project(D[0],D[1]);return l.getTilePoint(h,B)._round()});this.perspectiveTransform=function(D,B,L,q,Q,ne,oe,ie,ae,Z){const re=Ft(0,0,D,0,0,B,D,B),ue=Ft(L,q,Q,ne,oe,ie,ae,Z);return l.multiply$1(ue,l.adjoint(re,re),ue),[ue[6]/ue[8]*D/l.EXTENT,ue[7]/ue[8]*B/l.EXTENT]}(this.width,this.height,g.x,g.y,v.x,v.y,A.x,A.y,b.x,b.y);const I=this._boundsArray=new l.StructArrayLayout4i8;I.emplaceBack(g.x,g.y,0,0),I.emplaceBack(v.x,v.y,l.EXTENT,0),I.emplaceBack(A.x,A.y,0,l.EXTENT),I.emplaceBack(b.x,b.y,l.EXTENT,l.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=s.createVertexBuffer(I,l.boundsAttributes.members),this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,h=s.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new l.Texture(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(s)}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Wt={vector:mt,raster:ct,"raster-dem":class extends ct{constructor(f,s,h,g){super(f,s,h,g),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(f,s){const h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,b){v&&(f.state="errored",s(v)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",s(null))}f.request=l.getImage(this.map._requestManager.transformRequest(h,l.ResourceType.Tile),(function(v,b,A,I){if(delete f.request,f.aborted)f.state="unloaded",s(null);else if(v)f.state="errored",s(v);else if(b){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:A,expires:I});const D=l.window.ImageBitmap&&b instanceof l.window.ImageBitmap&&(Hi==null&&(Hi=l.window.OffscreenCanvas&&new l.window.OffscreenCanvas(1,1).getContext("2d")&&typeof l.window.createImageBitmap=="function"),Hi),B=1-(b.width-l.prevPowerOfTwo(b.width))/2;B<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const L=D?b:l.exported.getImageData(b,B),q={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:B};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",q,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const s=f.canonical,h=Math.pow(2,s.z),g=(s.x-1+h)%h,v=s.x===0?f.wrap-1:f.wrap,b=(s.x+1+h)%h,A=s.x+1===h?f.wrap+1:f.wrap,I={};return I[new l.OverscaledTileID(f.overscaledZ,v,s.z,g,s.y).key]={backfilled:!1},I[new l.OverscaledTileID(f.overscaledZ,A,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(I[new l.OverscaledTileID(f.overscaledZ,v,s.z,g,s.y-1).key]={backfilled:!1},I[new l.OverscaledTileID(f.overscaledZ,f.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},I[new l.OverscaledTileID(f.overscaledZ,A,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<h&&(I[new l.OverscaledTileID(f.overscaledZ,v,s.z,g,s.y+1).key]={backfilled:!1},I[new l.OverscaledTileID(f.overscaledZ,f.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},I[new l.OverscaledTileID(f.overscaledZ,A,s.z,b,s.y+1).key]={backfilled:!1}),I}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends l.Evented{constructor(f,s,h,g){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=s.data,this._options=l.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const v=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*v,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*v,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:l.EXTENT,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},s),this}getClusterChildren(f,s){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},s),this}getClusterLeaves(f,s,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:s,offset:h},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new l.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=l.extend({},this.workerOptions),s=this._data;typeof s=="string"?(f.request=this.map._requestManager.transformRequest(l.exported.resolveURL(s),l.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(h,g)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new l.ErrorEvent(h));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new l.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,s){const h=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(h,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,v)=>(delete f.request,f.unloadVectorData(),f.aborted?s(null):g?s(g):(f.loadVectorData(v,this.map.painter,h==="reloadTile"),s(null))),void 0,h==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends jt{constructor(f,s,h,g){super(f,s,h,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const s of f.urls)this.urls.push(this.map._requestManager.transformRequest(s,l.ResourceType.Source).url);l.getVideo(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new l.ErrorEvent(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const s=this.video.seekable;f<s.start(0)||f>s.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,s=f.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(f,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:jt,canvas:class extends jt{constructor(f,s,h,g){super(f,s,h,g),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(b=>typeof b!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends l.Evented{constructor(f,s,h,g){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new l.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new l.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Pr(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),l.extend(this,l.pick(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return l.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:s,y:h,z:g}=f.canonical;return this._implementation.hasTile({x:s,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,s){const{x:h,y:g,z:v}=f.tileID.canonical,b=new l.window.AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:b.signal})).then((function(A){return delete f.request,f.aborted?(f.state="unloaded",s(null)):A===void 0?(f.state="errored",s(null)):A===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",s(null)):function(I){return I instanceof l.window.ImageData||I instanceof l.window.HTMLCanvasElement||I instanceof l.window.ImageBitmap||I instanceof l.window.HTMLImageElement}(A)?(this.loadTileData(f,A),f.state="loaded",void s(null)):(f.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(A=>{A.code!==20&&(f.state="errored",s(A))}),f.request.cancel=()=>b.abort()}loadTileData(f,s){ct.loadTileData(f,s,this._map.painter)}unloadTileData(f){ct.unloadTileData(f,this._map.painter)}unloadTile(f,s){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:h,y:g,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}s()}abortTile(f,s){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Qt=function(f,s,h,g){const v=new Wt[s.type](f,s,h,g);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],v),v};function or(f,s){const h=l.identity([]);return l.scale(h,h,[.5*f.width,.5*-f.height,1]),l.translate(h,h,[1,-1,0]),l.multiply(h,h,f.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(h)}function en(f,s,h,g,v,b,A,I=!1){const D=f.tilesIn(g,A,I);D.sort(li);const B=[];for(const q of D)B.push({wrappedTileID:q.tile.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(s,h,f._state,q,v,b,or(f.transform,q.tile.tileID),I)});const L=function(q){const Q={},ne={};for(const oe of q){const ie=oe.queryResults,ae=oe.wrappedTileID,Z=ne[ae]=ne[ae]||{};for(const re in ie){const ue=ie[re],he=Z[re]=Z[re]||{},be=Q[re]=Q[re]||[];for(const Se of ue)he[Se.featureIndex]||(he[Se.featureIndex]=!0,be.push(Se))}}return Q}(B);for(const q in L)L[q].forEach(Q=>{const ne=Q.feature,oe=ne.layer;oe&&oe.type!=="background"&&oe.type!=="sky"&&(ne.source=oe.source,oe["source-layer"]&&(ne.sourceLayer=oe["source-layer"]),ne.state=ne.id!==void 0?f.getFeatureState(oe["source-layer"],ne.id):{})});return L}function yn(f,s){const h=f.getRenderableIds().map(b=>f.getTileByID(b)),g=[],v={};for(let b=0;b<h.length;b++){const A=h[b],I=A.tileID.canonical.key;v[I]||(v[I]=!0,A.querySourceFeatures(g,s))}return g}function li(f,s){const h=f.tileID,g=s.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}function zn(){return zl.workerClass!=null?new zl.workerClass:new l.window.Worker(zl.workerUrl)}const qo="mapboxgl_preloaded_worker_pool";class Vn{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Vn.workerCount;)this.workers.push(new zn);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[qo]}numActive(){return Object.keys(this.active).length}}let _i;function ml(){return _i||(_i=new Vn),_i}function Xv(f,s){const h={};for(const g in f)g!=="ref"&&(h[g]=f[g]);return l.refProperties.forEach(g=>{g in s&&(h[g]=s[g])}),h}function t0(f){f=f.slice();const s=Object.create(null);for(let h=0;h<f.length;h++)s[f[h].id]=f[h];for(let h=0;h<f.length;h++)"ref"in f[h]&&(f[h]=Xv(f[h],s[f[h].ref]));return f}Vn.workerCount=2;const br={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Zd(f,s,h){h.push({command:br.addSource,args:[f,s[f]]})}function Ic(f,s,h){s.push({command:br.removeSource,args:[f]}),h[f]=!0}function Kd(f,s,h,g){Ic(f,h,g),Zd(f,s,h)}function $u(f,s,h){let g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!w(f[h][g],s[h][g]))return!1;for(g in s[h])if(s[h].hasOwnProperty(g)&&g!=="data"&&!w(f[h][g],s[h][g]))return!1;return!0}function Zo(f,s,h,g,v,b){let A;for(A in s=s||{},f=f||{})f.hasOwnProperty(A)&&(w(f[A],s[A])||h.push({command:b,args:[g,A,s[A],v]}));for(A in s)s.hasOwnProperty(A)&&!f.hasOwnProperty(A)&&(w(f[A],s[A])||h.push({command:b,args:[g,A,s[A],v]}))}function _a(f){return f.id}function Xd(f,s){return f[s.id]=s,f}class Yd{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.clamp(s,0,1);let h=1,g=this._distances[h];const v=s*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];const b=h-1,A=this._distances[b],I=g-A,D=I>0?(v-A)/I:0;return this.points[b].mult(1-D).add(this.points[h].mult(D))}}class Ms{constructor(s,h,g){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(h/g);for(let A=0;A<this.xCellCount*this.yCellCount;A++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,g,v,b){this._forEachCell(h,g,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(s,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(s,h,g,v,b,A){this.boxCells[b].push(A)}_insertCircleCell(s,h,g,v,b,A){this.circleCells[b].push(A)}_query(s,h,g,v,b,A){if(g<0||s>this.width||v<0||h>this.height)return!b&&[];const I=[];if(s<=0&&h<=0&&this.width<=g&&this.height<=v){if(b)return!0;for(let D=0;D<this.boxKeys.length;D++)I.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const B=this.circles[3*D],L=this.circles[3*D+1],q=this.circles[3*D+2];I.push({key:this.circleKeys[D],x1:B-q,y1:L-q,x2:B+q,y2:L+q})}return A?I.filter(A):I}return this._forEachCell(s,h,g,v,this._queryCell,I,{hitTest:b,seenUids:{box:{},circle:{}}},A),b?I.length>0:I}_queryCircle(s,h,g,v,b){const A=s-g,I=s+g,D=h-g,B=h+g;if(I<0||A>this.width||B<0||D>this.height)return!v&&[];const L=[];return this._forEachCell(A,D,I,B,this._queryCellCircle,L,{hitTest:v,circle:{x:s,y:h,radius:g},seenUids:{box:{},circle:{}}},b),v?L.length>0:L}query(s,h,g,v,b){return this._query(s,h,g,v,!1,b)}hitTest(s,h,g,v,b){return this._query(s,h,g,v,!0,b)}hitTestCircle(s,h,g,v){return this._queryCircle(s,h,g,!0,v)}_queryCell(s,h,g,v,b,A,I,D){const B=I.seenUids,L=this.boxCells[b];if(L!==null){const Q=this.bboxes;for(const ne of L)if(!B.box[ne]){B.box[ne]=!0;const oe=4*ne;if(s<=Q[oe+2]&&h<=Q[oe+3]&&g>=Q[oe+0]&&v>=Q[oe+1]&&(!D||D(this.boxKeys[ne]))){if(I.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[ne],x1:Q[oe],y1:Q[oe+1],x2:Q[oe+2],y2:Q[oe+3]})}}}const q=this.circleCells[b];if(q!==null){const Q=this.circles;for(const ne of q)if(!B.circle[ne]){B.circle[ne]=!0;const oe=3*ne;if(this._circleAndRectCollide(Q[oe],Q[oe+1],Q[oe+2],s,h,g,v)&&(!D||D(this.circleKeys[ne]))){if(I.hitTest)return A.push(!0),!0;{const ie=Q[oe],ae=Q[oe+1],Z=Q[oe+2];A.push({key:this.circleKeys[ne],x1:ie-Z,y1:ae-Z,x2:ie+Z,y2:ae+Z})}}}}}_queryCellCircle(s,h,g,v,b,A,I,D){const B=I.circle,L=I.seenUids,q=this.boxCells[b];if(q!==null){const ne=this.bboxes;for(const oe of q)if(!L.box[oe]){L.box[oe]=!0;const ie=4*oe;if(this._circleAndRectCollide(B.x,B.y,B.radius,ne[ie+0],ne[ie+1],ne[ie+2],ne[ie+3])&&(!D||D(this.boxKeys[oe])))return A.push(!0),!0}}const Q=this.circleCells[b];if(Q!==null){const ne=this.circles;for(const oe of Q)if(!L.circle[oe]){L.circle[oe]=!0;const ie=3*oe;if(this._circlesCollide(ne[ie],ne[ie+1],ne[ie+2],B.x,B.y,B.radius)&&(!D||D(this.circleKeys[oe])))return A.push(!0),!0}}}_forEachCell(s,h,g,v,b,A,I,D){const B=this._convertToXCellCoord(s),L=this._convertToYCellCoord(h),q=this._convertToXCellCoord(g),Q=this._convertToYCellCoord(v);for(let ne=B;ne<=q;ne++)for(let oe=L;oe<=Q;oe++)if(b.call(this,s,h,g,v,this.xCellCount*oe+ne,A,I,D))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,g,v,b,A){const I=v-s,D=b-h,B=g+A;return B*B>I*I+D*D}_circleAndRectCollide(s,h,g,v,b,A,I){const D=(A-v)/2,B=Math.abs(s-(v+D));if(B>D+g)return!1;const L=(I-b)/2,q=Math.abs(h-(b+L));if(q>L+g)return!1;if(B<=D||q<=L)return!0;const Q=B-D,ne=q-L;return Q*Q+ne*ne<=g*g}}const va={unknown:0,flipRequired:1,flipNotRequired:2},Cc=Math.tan(85*Math.PI/180);function Ge(f,s,h,g,v,b,A){const I=l.create();if(h)if(b.name==="globe"){const D=l.calculateGlobeLabelMatrix(v,s);l.multiply(I,I,D)}else{const D=xe([],A);I[0]=D[0],I[1]=D[1],I[4]=D[2],I[5]=D[3],g||l.rotateZ(I,I,v.angle)}else l.multiply(I,v.labelPlaneMatrix,f);return I}function xa(f,s,h,g,v,b,A){const I=Ge(f,s,h,g,v,b,A);return b.name==="globe"&&h||(I[2]=I[6]=I[10]=I[14]=0),I}function _n(f,s,h,g,v,b,A){if(h){if(b.name==="globe"){const I=Ge(f,s,h,g,v,b,A);return l.invert(I,I),l.multiply(I,f,I),I}{const I=l.clone(f),D=l.identity([]);return D[0]=A[0],D[1]=A[1],D[4]=A[2],D[5]=A[3],l.multiply(I,I,D),g||l.rotateZ(I,I,-v.angle),I}}return v.glCoordMatrix}function $n(f,s,h,g){const v=[f,s,h,1];h?l.transformMat4$1(v,v,g):rr(v,v,g);const b=v[3];return v[0]/=b,v[1]/=b,v[2]/=b,v}function r0(f,s){return Math.min(.5+f/s*.5,1.5)}function Ko(f,s){const h=f[0]/f[3],g=f[1]/f[3];return h>=-s[0]&&h<=s[0]&&g>=-s[1]&&g<=s[1]}function Qd(f,s,h,g,v,b,A,I,D,B){const L=h.transform,q=g?f.textSizeData:f.iconSizeData,Q=l.evaluateSizeForZoom(q,h.transform.zoom),ne=L.projection.name==="globe",oe=[256/h.width*2+1,256/h.height*2+1],ie=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ie.clear();let ae=null;ne&&(ae=g?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const Z=f.lineVertexArray,re=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,ue=h.transform.width/h.transform.height;let he,be=!1;for(let Se=0;Se<re.length;Se++){const we=re.get(Se),{numGlyphs:Ce,writingMode:Ie}=we;if(Ie!==l.WritingMode.vertical||be||he===l.WritingMode.horizontal||(be=!0),he=Ie,(we.hidden||Ie===l.WritingMode.vertical)&&!be){Ao(Ce,ie);continue}be=!1;const Re=new l.Point(we.tileAnchorX,we.tileAnchorY);let{x:st,y:De,z:Ke}=L.projection.projectTilePoint(Re.x,Re.y,B.canonical);if(D){const[$t,At,Lt]=D(Re);st+=$t,De+=At,Ke+=Lt}const Ne=[st,De,Ke,1];if(l.transformMat4$1(Ne,Ne,s),!Ko(Ne,oe)){Ao(Ce,ie);continue}const at=r0(h.transform.cameraToCenterDistance,Ne[3]),ze=l.evaluateSizeForFeature(q,Q,we),Ze=A?ze/at:ze*at,ut=$n(st,De,Ke,v);if(ut[3]<=0){Ao(Ce,ie);continue}let tt={};const ht=A?null:D,Mt=bt(we,Ze,!1,I,s,v,b,f.glyphOffsetArray,Z,ie,ae,ut,Re,tt,ue,ht,L.projection,B,A);be=Mt.useVertical,ht&&Mt.needsFlipping&&(tt={}),(Mt.notEnoughRoom||be||Mt.needsFlipping&&bt(we,Ze,!0,I,s,v,b,f.glyphOffsetArray,Z,ie,ae,ut,Re,tt,ue,ht,L.projection,B,A).notEnoughRoom)&&Ao(Ce,ie)}g?(f.text.dynamicLayoutVertexBuffer.updateData(ie),ae&&f.text.globeExtVertexBuffer.updateData(ae)):(f.icon.dynamicLayoutVertexBuffer.updateData(ie),ae&&f.icon.globeExtVertexBuffer.updateData(ae))}function n0(f,s,h,g,v,b,A,I,D,B,L,q,Q,ne,oe,ie){const{lineStartIndex:ae,glyphStartIndex:Z,segment:re}=I,ue=Z+I.numGlyphs,he=ae+I.lineLength,be=s.getoffsetX(Z),Se=s.getoffsetX(ue-1),we=qi(f*be,h,g,v,b,A,re,ae,he,D,B,L,q,Q,!0,ne,oe,ie);if(!we)return null;const Ce=qi(f*Se,h,g,v,b,A,re,ae,he,D,B,L,q,Q,!0,ne,oe,ie);return Ce?{first:we,last:Ce}:null}function gl(f,s,h,g){return f===l.WritingMode.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:f===l.WritingMode.vertical?g>0?{needsFlipping:!0}:null:s!==va.unknown&&function(v,b){return v===0||Math.abs(b/v)>Cc}(h,g)?s===va.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function bt(f,s,h,g,v,b,A,I,D,B,L,q,Q,ne,oe,ie,ae,Z,re){const ue=s/24,he=f.lineOffsetX*ue,be=f.lineOffsetY*ue,{lineStartIndex:Se,glyphStartIndex:we,numGlyphs:Ce,segment:Ie,writingMode:Re,flipState:st}=f,De=Se+f.lineLength,Ke=Ne=>{if(L){const[ut,tt,ht]=Ne.up,Mt=B.length;l.updateGlobeVertexNormal(L,Mt+0,ut,tt,ht),l.updateGlobeVertexNormal(L,Mt+1,ut,tt,ht),l.updateGlobeVertexNormal(L,Mt+2,ut,tt,ht),l.updateGlobeVertexNormal(L,Mt+3,ut,tt,ht)}const[at,ze,Ze]=Ne.point;l.addDynamicAttributes(B,at,ze,Ze,Ne.angle)};if(Ce>1){const Ne=n0(ue,I,he,be,h,q,Q,f,D,b,ne,ie,!1,ae,Z,re);if(!Ne)return{notEnoughRoom:!0};if(g&&!h){let[at,ze,Ze]=Ne.first.point,[ut,tt,ht]=Ne.last.point;[at,ze]=$n(at,ze,Ze,A),[ut,tt]=$n(ut,tt,ht,A);const Mt=gl(Re,st,(ut-at)*oe,tt-ze);if(f.flipState=Mt&&Mt.needsFlipping?va.flipRequired:va.flipNotRequired,Mt)return Mt}Ke(Ne.first);for(let at=we+1;at<we+Ce-1;at++){const ze=qi(ue*I.getoffsetX(at),he,be,h,q,Q,Ie,Se,De,D,b,ne,ie,!1,!1,ae,Z,re);if(!ze)return B.length-=4*(at-we),{notEnoughRoom:!0};Ke(ze)}Ke(Ne.last)}else{if(g&&!h){const at=$n(Q.x,Q.y,0,v),ze=Se+Ie+1,Ze=new l.Point(D.getx(ze),D.gety(ze)),ut=$n(Ze.x,Ze.y,0,v),tt=ut[3]>0?ut:tr(Q,Ze,at,1,v,void 0,ae,Z.canonical),ht=gl(Re,st,(tt[0]-at[0])*oe,tt[1]-at[1]);if(f.flipState=ht&&ht.needsFlipping?va.flipRequired:va.flipNotRequired,ht)return ht}const Ne=qi(ue*I.getoffsetX(we),he,be,h,q,Q,Ie,Se,De,D,b,ne,ie,!1,!1,ae,Z,re);if(!Ne)return{notEnoughRoom:!0};Ke(Ne)}return{}}function ir(f,s,h,g,v){const{x:b,y:A,z:I}=g.projectTilePoint(f.x,f.y,s);if(!v)return $n(b,A,I,h);const[D,B,L]=v(f);return $n(b+D,A+B,I+L,h)}function tr(f,s,h,g,v,b,A,I){const D=ir(f.sub(s)._unit()._add(f),I,v,A,b);return l.sub(D,h,D),l.normalize(D,D),l.scaleAndAdd(D,h,D,g)}function qi(f,s,h,g,v,b,A,I,D,B,L,q,Q,ne,oe,ie,ae,Z){const re=g?f-s:f+s;let ue=re>0?1:-1,he=0;g&&(ue*=-1,he=Math.PI),ue<0&&(he+=Math.PI);let be=I+A+(ue>0?0:1)|0,Se=v,we=v,Ce=0,Ie=0;const Re=Math.abs(re),st=[],De=[];let Ke=b,Ne=Ke;const at=()=>tr(Ne,Ke,we,Re-Ce+1,L,Q,ie,ae.canonical);for(;Ce+Ie<=Re;){if(be+=ue,be<I||be>=D)return null;if(we=Se,Ne=Ke,st.push(we),ne&&De.push(Ne),Ke=new l.Point(B.getx(be),B.gety(be)),Se=q[be],!Se){const Lt=ir(Ke,ae.canonical,L,ie,Q);Se=Lt[3]>0?q[be]=Lt:at()}Ce+=Ie,Ie=l.distance(we,Se)}oe&&Q&&(q[be]&&(Se=at(),Ie=l.distance(we,Se)),q[be]=Se);const ze=(Re-Ce)/Ie,Ze=Ke.sub(Ne)._mult(ze)._add(Ne),ut=l.sub([],Se,we),tt=l.scaleAndAdd([],we,ut,ze);let ht=[0,0,1],Mt=ut[0],$t=ut[1];if(Z&&(ht=ie.upVector(ae.canonical,Ze.x,Ze.y),ht[0]!==0||ht[1]!==0||ht[2]!==1)){const Lt=[ht[2],0,-ht[0]],nr=l.cross([],ht,Lt);l.normalize(Lt,Lt),l.normalize(nr,nr),Mt=l.dot(ut,Lt),$t=l.dot(ut,nr)}if(h){const Lt=l.cross([],ht,ut);l.normalize(Lt,Lt),l.scaleAndAdd(tt,tt,Lt,h*ue)}const At=he+Math.atan2($t,Mt);return st.push(tt),ne&&De.push(Ze),{point:tt,angle:At,path:st,tilePath:De,up:ht}}function Ao(f,s){const h=s.length,g=h+4*f;s.resize(g),s.float32.fill(-1/0,4*h,4*g)}function rr(f,s,h){const g=s[0],v=s[1];return f[0]=h[0]*g+h[4]*v+h[12],f[1]=h[1]*g+h[5]*v+h[13],f[3]=h[3]*g+h[7]*v+h[15],f}const Zi=100;class kc{constructor(s,h,g=new Ms(s.width+200,s.height+200,25),v=new Ms(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Zi,this.screenBottomBoundary=s.height+Zi,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,g,v,b,A,I,D){let B=g.projectedAnchorX,L=g.projectedAnchorY,q=g.projectedAnchorZ;const Q=g.elevation,ne=g.tileID,oe=s.getProjection();if(Q&&ne){const[Se,we,Ce]=oe.upVector(ne.canonical,g.tileAnchorX,g.tileAnchorY),Ie=oe.upVectorScale(ne.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=Se*Q*Ie,L+=we*Q*Ie,q+=Ce*Q*Ie}const ie=this.projectAndGetPerspectiveRatio(I,B,L,q,g.tileID,oe.name==="globe"||!!Q||this.transform.pitch>0,oe),ae=A*ie.perspectiveRatio,Z=(g.x1*h+v.x-g.padding)*ae+ie.point.x,re=(g.y1*h+v.y-g.padding)*ae+ie.point.y,ue=(g.x2*h+v.x+g.padding)*ae+ie.point.x,he=(g.y2*h+v.y+g.padding)*ae+ie.point.y,be=ie.perspectiveRatio<=.55||ie.occluded;return!this.isInsideGrid(Z,re,ue,he)||!b&&this.grid.hitTest(Z,re,ue,he,D)||be?{box:[],offscreen:!1,occluded:ie.occluded}:{box:[Z,re,ue,he],offscreen:this.isOffscreen(Z,re,ue,he),occluded:!1}}placeCollisionCircles(s,h,g,v,b,A,I,D,B,L,q,Q,ne,oe,ie){const ae=[],Z=this.transform.elevation,re=s.getProjection(),ue=Z?Z.getAtTileOffsetFunc(ie,this.transform.center.lat,this.transform.worldSize,re):null,he=new l.Point(g.tileAnchorX,g.tileAnchorY);let{x:be,y:Se,z:we}=re.projectTilePoint(he.x,he.y,ie.canonical);if(ue){const[Ze,ut,tt]=ue(he);be+=Ze,Se+=ut,we+=tt}const Ce=re.name==="globe",Ie=this.projectAndGetPerspectiveRatio(I,be,Se,we,ie,Ce||!!Z||this.transform.pitch>0,re),{perspectiveRatio:Re}=Ie,st=(q?A/Re:A*Re)/l.ONE_EM,De=$n(be,Se,we,D),Ke=Ie.signedDistanceFromCamera>0?n0(st,b,g.lineOffsetX*st,g.lineOffsetY*st,!1,De,he,g,v,D,{},Z&&!q?ue:null,q&&!!Z,re,ie,q):null;let Ne=!1,at=!1,ze=!0;if(Ke&&!Ie.occluded){const Ze=.5*ne*Re+oe,ut=new l.Point(-100,-100),tt=new l.Point(this.screenRightBoundary,this.screenBottomBoundary),ht=new Yd,{first:Mt,last:$t}=Ke,At=Mt.path.length;let Lt=[];for(let Pt=At-1;Pt>=1;Pt--)Lt.push(Mt.path[Pt]);for(let Pt=1;Pt<$t.path.length;Pt++)Lt.push($t.path[Pt]);const nr=2.5*Ze;B&&(Lt=Lt.map(([Pt,Ar,Mr],zr)=>(ue&&!Ce&&(Mr=ue(zr<At-1?Mt.tilePath[At-1-zr]:$t.tilePath[zr-At+2])[2]),$n(Pt,Ar,Mr,B))),Lt.some(Pt=>Pt[3]<=0)&&(Lt=[]));let er=[];if(Lt.length>0){let Pt=1/0,Ar=-1/0,Mr=1/0,zr=-1/0;for(const Rr of Lt)Pt=Math.min(Pt,Rr[0]),Mr=Math.min(Mr,Rr[1]),Ar=Math.max(Ar,Rr[0]),zr=Math.max(zr,Rr[1]);Ar>=ut.x&&Pt<=tt.x&&zr>=ut.y&&Mr<=tt.y&&(er=[Lt.map(Rr=>new l.Point(Rr[0],Rr[1]))],(Pt<ut.x||Ar>tt.x||Mr<ut.y||zr>tt.y)&&(er=l.clipLine(er,ut.x,ut.y,tt.x,tt.y)))}for(const Pt of er){ht.reset(Pt,.25*Ze);let Ar=0;Ar=ht.length<=.5*Ze?1:Math.ceil(ht.paddedLength/nr)+1;for(let Mr=0;Mr<Ar;Mr++){const zr=Mr/Math.max(Ar-1,1),Rr=ht.lerp(zr),ui=Rr.x+Zi,Gn=Rr.y+Zi;ae.push(ui,Gn,Ze,0);const ao=ui-Ze,Jo=Gn-Ze,Yr=ui+Ze,Or=Gn+Ze;if(ze=ze&&this.isOffscreen(ao,Jo,Yr,Or),at=at||this.isInsideGrid(ao,Jo,Yr,Or),!h&&this.grid.hitTestCircle(ui,Gn,Ze,Q)&&(Ne=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Ne,occluded:!1}}}}return{circles:!L&&Ne||!at?[]:ae,offscreen:ze,collisionDetected:Ne,occluded:Ie.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let g=1/0,v=1/0,b=-1/0,A=-1/0;for(const L of s){const q=new l.Point(L.x+Zi,L.y+Zi);g=Math.min(g,q.x),v=Math.min(v,q.y),b=Math.max(b,q.x),A=Math.max(A,q.y),h.push(q)}const I=this.grid.query(g,v,b,A).concat(this.ignoredGrid.query(g,v,b,A)),D={},B={};for(const L of I){const q=L.key;if(D[q.bucketInstanceId]===void 0&&(D[q.bucketInstanceId]={}),D[q.bucketInstanceId][q.featureIndex])continue;const Q=[new l.Point(L.x1,L.y1),new l.Point(L.x2,L.y1),new l.Point(L.x2,L.y2),new l.Point(L.x1,L.y2)];l.polygonIntersectsPolygon(h,Q)&&(D[q.bucketInstanceId][q.featureIndex]=!0,B[q.bucketInstanceId]===void 0&&(B[q.bucketInstanceId]=[]),B[q.bucketInstanceId].push(q.featureIndex))}return B}insertCollisionBox(s,h,g,v,b){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:b},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,g,v,b){const A=h?this.ignoredGrid:this.grid,I={bucketInstanceId:g,featureIndex:v,collisionGroupID:b};for(let D=0;D<s.length;D+=4)A.insertCircle(I,s[D],s[D+1],s[D+2])}projectAndGetPerspectiveRatio(s,h,g,v,b,A,I){const D=[h,g,v,1];let B=!1;v||this.transform.pitch>0?(l.transformMat4$1(D,D,s),this.fogState&&b&&I.name!=="globe"&&(B=function(Q,ne,oe,ie,ae,Z){const re=Z.calculateFogTileMatrix(ae),ue=[ne,oe,ie];return l.transformMat4(ue,ue,re),Ut(Q,ue,Z.pitch,Z._fov)}(this.fogState,h,g,v,b.toUnwrapped(),this.transform)>.9)):rr(D,D,s);const L=D[3];return{point:new l.Point((D[0]/L+1)/2*this.transform.width+Zi,(-D[1]/L+1)/2*this.transform.height+Zi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/L*.5,1.5),signedDistanceFromCamera:L,occluded:A&&D[2]>L||B}}isOffscreen(s,h,g,v){return g<Zi||s>=this.screenRightBoundary||v<Zi||h>this.screenBottomBoundary}isInsideGrid(s,h,g,v){return g>=0&&s<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=l.identity([]);return l.translate(s,s,[-100,-100,0]),s}}function zs(f,s,h){const g=s.createTileMatrix(f,f.worldSize,h.toUnwrapped());return l.multiply(new Float32Array(16),f.projMatrix,g)}function ro(f,s,h){if(s.projection.name===h.projection.name)return f.projMatrix;const g=h.clone();return g.setProjection(s.projection),zs(g,s.getProjection(),f)}function Xr(f,s,h){return s.name===h.projection.name?f.projMatrix:zs(h,s,f)}class i0{constructor(s,h,g,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class ba{constructor(s,h,g,v,b,A=!1){this.text=new i0(s?s.text:null,h,g,b),this.icon=new i0(s?s.icon:null,h,v,b),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Pc{constructor(s,h,g,v=!1){this.text=s,this.icon=h,this.skipFade=g,this.clipped=v}}class Dc{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class Jd{constructor(s,h,g,v,b){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=b}}class o0{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[s]}}function Mc(f,s,h,g,v){const{horizontalAlign:b,verticalAlign:A}=l.getAnchorAlignment(f),I=-(b-.5)*s,D=-(A-.5)*h,B=l.evaluateVariableOffset(f,g);return new l.Point(I+B[0]*v,D+B[1]*v)}function zc(f,s,h,g,v){const b=new l.Point(f,s);return h&&b._rotate(g?v:-v),b}class Wu{constructor(s,h,g,v,b){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new kc(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new o0(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,g,v){const b=g.getBucket(h),A=g.latestFeatureIndex;if(!b||!A||h.id!==b.layerIds[0])return;const I=b.layers[0].layout,D=g.collisionBoxArray,B=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),L=g.tileSize/l.EXTENT,q=g.tileID.toUnwrapped();this.transform.setProjection(b.projection);const Q=(ne=g.tileID,oe=b.getProjection(),ie=this.transform,oe.name===this.projection?ie.calculateProjMatrix(ne.toUnwrapped()):zs(ie,oe,ne));var ne,oe,ie;const ae=I.get("text-pitch-alignment")==="map",Z=I.get("text-rotation-alignment")==="map";h.compileFilter();const re=h.dynamicFilter(),ue=h.dynamicFilterNeedsFeature(),he=this.transform.calculatePixelsToTileUnitsMatrix(g),be=xa(Q,g.tileID.canonical,ae,Z,this.transform,b.getProjection(),he);let Se=null;if(ae){const Ie=_n(Q,g.tileID.canonical,ae,Z,this.transform,b.getProjection(),he);Se=l.multiply([],this.transform.labelPlaneMatrix,Ie)}let we=null;re&&g.latestFeatureIndex&&(we={unwrappedTileID:q,dynamicFilter:re,dynamicFilterNeedsFeature:ue,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Jd(b.bucketInstanceId,A,b.sourceLayerIndex,b.index,g.tileID);const Ce={bucket:b,layout:I,posMatrix:Q,textLabelPlaneMatrix:be,labelToScreenMatrix:Se,clippingData:we,scale:B,textPixelRatio:L,holdingForFade:g.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:l.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const Ie of b.sortKeyRanges){const{sortKey:Re,symbolInstanceStart:st,symbolInstanceEnd:De}=Ie;s.push({sortKey:Re,symbolInstanceStart:st,symbolInstanceEnd:De,parameters:Ce})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(s,h,g,v,b,A,I,D,B,L,q,Q,ne,oe,ie,ae,Z,re){const{textOffset0:ue,textOffset1:he,crossTileID:be}=Q,Se=[ue,he],we=Mc(s,g,v,Se,b),Ce=this.collisionIndex.placeCollisionBox(oe,b,h,zc(we.x,we.y,A,I,this.transform.angle),q,D,B,L.predicate);if(ae){const Ie=oe.getSymbolInstanceIconSize(re,this.transform.zoom,Q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(oe,Ie,ae,zc(we.x,we.y,A,I,this.transform.angle),q,D,B,L.predicate).box.length===0)return}if(Ce.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Ie=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:Se,width:g,height:v,anchor:s,textScale:b,prevAnchor:Ie},this.markUsedJustification(oe,s,Q,ie),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,ie,Q),this.placedOrientations[be]=ie),{shift:we,placedGlyphBoxes:Ce}}}placeLayerBucketPart(s,h,g,v){const{bucket:b,layout:A,posMatrix:I,textLabelPlaneMatrix:D,labelToScreenMatrix:B,clippingData:L,textPixelRatio:q,holdingForFade:Q,collisionBoxArray:ne,partiallyEvaluatedTextSize:oe,partiallyEvaluatedIconSize:ie,collisionGroup:ae}=s.parameters,Z=A.get("text-optional"),re=A.get("icon-optional"),ue=A.get("text-allow-overlap"),he=A.get("icon-allow-overlap"),be=A.get("text-rotation-alignment")==="map",Se=A.get("text-pitch-alignment")==="map",we=A.get("icon-text-fit")!=="none",Ce=A.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let Ie=ue&&(he||!b.hasIconData()||re),Re=he&&(ue||!b.hasTextData()||Z);!b.collisionArrays&&ne&&b.deserializeCollisionBoxes(ne),g&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,ne);const st=(De,Ke,Ne)=>{const{crossTileID:at,numVerticalGlyphVertices:ze}=De;if(L){const Yr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Or=null;if(L.dynamicFilterNeedsFeature){const gr=this.retainedQueryData[b.bucketInstanceId];Or=L.featureIndex.loadFeature({featureIndex:De.featureIndex,bucketIndex:gr.bucketIndex,sourceLayerIndex:gr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Yr,Or,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new l.Point(De.tileAnchorX,De.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[at]=new Pc(!1,!1,!1,!0),void h.add(at)}if(h.has(at))return;if(Q)return void(this.placements[at]=new Pc(!1,!1,!1));let Ze=!1,ut=!1,tt=!0,ht=!1,Mt=!1,$t=null,At={box:null,offscreen:null,occluded:null},Lt={box:null,offscreen:null,occluded:null},nr=null,er=null,Pt=null,Ar=0,Mr=0,zr=0;Ne.textFeatureIndex?Ar=Ne.textFeatureIndex:De.useRuntimeCollisionCircles&&(Ar=De.featureIndex),Ne.verticalTextFeatureIndex&&(Mr=Ne.verticalTextFeatureIndex);const Rr=Yr=>{Yr.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Or=this.transform.elevation;(Or||Yr.elevation)&&(Yr.elevation=Or?Or.getAtTileOffset(Yr.tileID,Yr.tileAnchorX,Yr.tileAnchorY):0)},ui=Ne.textBox;if(ui){Rr(ui);const Yr=gr=>{let vn=l.WritingMode.horizontal;if(b.allowVerticalPlacement&&!gr&&this.prevPlacement){const vi=this.prevPlacement.placedOrientations[at];vi&&(this.placedOrientations[at]=vi,vn=vi,this.markUsedOrientation(b,vn,De))}return vn},Or=(gr,vn)=>{if(b.allowVerticalPlacement&&ze>0&&Ne.verticalTextBox){for(const vi of b.writingModes)if(vi===l.WritingMode.vertical?(At=vn(),Lt=At):At=gr(),At&&At.box&&At.box.length)break}else At=gr()};if(A.get("text-variable-anchor")){let gr=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[at]){const Zr=this.prevPlacement.variableOffsets[at];gr.indexOf(Zr.anchor)>0&&(gr=gr.filter(Pi=>Pi!==Zr.anchor),gr.unshift(Zr.anchor))}const vn=(Zr,Pi,yh)=>{const js=b.getSymbolInstanceTextSize(oe,De,this.transform.zoom,Ke),Jc=(Zr.x2-Zr.x1)*js+2*Zr.padding,Ca=(Zr.y2-Zr.y1)*js+2*Zr.padding,rs=we&&!he?Pi:null;rs&&Rr(rs);let Vs={box:[],offscreen:!1,occluded:!1};const _h=ue?2*gr.length:gr.length;for(let eu=0;eu<_h;++eu){const $p=this.attemptAnchorPlacement(gr[eu%gr.length],Zr,Jc,Ca,js,be,Se,q,I,ae,eu>=gr.length,De,Ke,b,yh,rs,oe,ie);if($p&&(Vs=$p.placedGlyphBoxes,Vs&&Vs.box&&Vs.box.length)){Ze=!0,$t=$p.shift;break}}return Vs};Or(()=>vn(ui,Ne.iconBox,l.WritingMode.horizontal),()=>{const Zr=Ne.verticalTextBox;return Zr&&Rr(Zr),b.allowVerticalPlacement&&!(At&&At.box&&At.box.length)&&ze>0&&Zr?vn(Zr,Ne.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),At&&(Ze=At.box,tt=At.offscreen,ht=At.occluded);const vi=Yr(!(!At||!At.box));if(!Ze&&this.prevPlacement){const Zr=this.prevPlacement.variableOffsets[at];Zr&&(this.variableOffsets[at]=Zr,this.markUsedJustification(b,Zr.anchor,De,vi))}}else{const gr=(vn,vi)=>{const Zr=b.getSymbolInstanceTextSize(oe,De,this.transform.zoom,Ke),Pi=this.collisionIndex.placeCollisionBox(b,Zr,vn,new l.Point(0,0),ue,q,I,ae.predicate);return Pi&&Pi.box&&Pi.box.length&&(this.markUsedOrientation(b,vi,De),this.placedOrientations[at]=vi),Pi};Or(()=>gr(ui,l.WritingMode.horizontal),()=>{const vn=Ne.verticalTextBox;return b.allowVerticalPlacement&&ze>0&&vn?(Rr(vn),gr(vn,l.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Yr(!!(At&&At.box&&At.box.length))}}if(nr=At,Ze=nr&&nr.box&&nr.box.length>0,tt=nr&&nr.offscreen,ht=nr&&nr.occluded,De.useRuntimeCollisionCircles){const Yr=b.text.placedSymbolArray.get(De.centerJustifiedTextSymbolIndex>=0?De.centerJustifiedTextSymbolIndex:De.verticalPlacedTextSymbolIndex),Or=l.evaluateSizeForFeature(b.textSizeData,oe,Yr),gr=A.get("text-padding");er=this.collisionIndex.placeCollisionCircles(b,ue,Yr,b.lineVertexArray,b.glyphOffsetArray,Or,I,D,B,g,Se,ae.predicate,De.collisionCircleDiameter*Or/l.ONE_EM,gr,this.retainedQueryData[b.bucketInstanceId].tileID),Ze=ue||er.circles.length>0&&!er.collisionDetected,tt=tt&&er.offscreen,ht=er.occluded}if(Ne.iconFeatureIndex&&(zr=Ne.iconFeatureIndex),Ne.iconBox){const Yr=Or=>{Rr(Or);const gr=we&&$t?zc($t.x,$t.y,be,Se,this.transform.angle):new l.Point(0,0),vn=b.getSymbolInstanceIconSize(ie,this.transform.zoom,De.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,vn,Or,gr,he,q,I,ae.predicate)};Lt&&Lt.box&&Lt.box.length&&Ne.verticalIconBox?(Pt=Yr(Ne.verticalIconBox),ut=Pt.box.length>0):(Pt=Yr(Ne.iconBox),ut=Pt.box.length>0),tt=tt&&Pt.offscreen,Mt=Pt.occluded}const Gn=Z||De.numHorizontalGlyphVertices===0&&ze===0,ao=re||De.numIconVertices===0;if(Gn||ao?ao?Gn||(ut=ut&&Ze):Ze=ut&&Ze:ut=Ze=ut&&Ze,Ze&&nr&&nr.box&&this.collisionIndex.insertCollisionBox(nr.box,A.get("text-ignore-placement"),b.bucketInstanceId,Lt&&Lt.box&&Mr?Mr:Ar,ae.ID),ut&&Pt&&this.collisionIndex.insertCollisionBox(Pt.box,A.get("icon-ignore-placement"),b.bucketInstanceId,zr,ae.ID),er&&(Ze&&this.collisionIndex.insertCollisionCircles(er.circles,A.get("text-ignore-placement"),b.bucketInstanceId,Ar,ae.ID),g)){const Yr=b.bucketInstanceId;let Or=this.collisionCircleArrays[Yr];Or===void 0&&(Or=this.collisionCircleArrays[Yr]=new Dc);for(let gr=0;gr<er.circles.length;gr+=4)Or.circles.push(er.circles[gr+0]),Or.circles.push(er.circles[gr+1]),Or.circles.push(er.circles[gr+2]),Or.circles.push(er.collisionDetected?1:0)}const Jo=b.projection.name!=="globe";Ie=Ie&&(Jo||!ht),Re=Re&&(Jo||!Mt),this.placements[at]=new Pc(Ze||Ie,ut||Re,tt||b.justReloaded),h.add(at)};if(Ce){const De=b.getSortedSymbolIndexes(this.transform.angle);for(let Ke=De.length-1;Ke>=0;--Ke){const Ne=De[Ke];st(b.symbolInstances.get(Ne),Ne,b.collisionArrays[Ne])}}else for(let De=s.symbolInstanceStart;De<s.symbolInstanceEnd;De++)st(b.symbolInstances.get(De),De,b.collisionArrays[De]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const De=this.collisionCircleArrays[b.bucketInstanceId];l.invert(De.invProjMatrix,I),De.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(s,h,g,v){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:D,crossTileID:B}=g,L=l.getAnchorJustification(h),q=v===l.WritingMode.vertical?D:L==="left"?b:L==="center"?A:L==="right"?I:-1;b>=0&&(s.text.placedSymbolArray.get(b).crossTileID=q>=0&&b!==q?0:B),A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=q>=0&&A!==q?0:B),I>=0&&(s.text.placedSymbolArray.get(I).crossTileID=q>=0&&I!==q?0:B),D>=0&&(s.text.placedSymbolArray.get(D).crossTileID=q>=0&&D!==q?0:B)}markUsedOrientation(s,h,g){const v=h===l.WritingMode.horizontal||h===l.WritingMode.horizontalOnly?h:0,b=h===l.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:B}=g,L=s.text.placedSymbolArray;A>=0&&(L.get(A).placedOrientation=v),I>=0&&(L.get(I).placedOrientation=v),D>=0&&(L.get(D).placedOrientation=v),B>=0&&(L.get(B).placedOrientation=b)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const v=h?h.symbolFadeChange(s):1,b=h?h.opacities:{},A=h?h.variableOffsets:{},I=h?h.placedOrientations:{};for(const D in this.placements){const B=this.placements[D],L=b[D];L?(this.opacities[D]=new ba(L,v,B.text,B.icon,null,B.clipped),g=g||B.text!==L.text.placed||B.icon!==L.icon.placed):(this.opacities[D]=new ba(null,v,B.text,B.icon,B.skipFade,B.clipped),g=g||B.text||B.icon)}for(const D in b){const B=b[D];if(!this.opacities[D]){const L=new ba(B,v,!1,!1);L.isHidden()||(this.opacities[D]=L,g=g||B.text.placed||B.icon.placed)}}for(const D in A)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=A[D]);for(const D in I)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=I[D]);g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const g=new Set;for(const v of h){const b=v.getBucket(s);b&&v.latestFeatureIndex&&s.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,v.collisionBoxArray)}}updateBucketOpacities(s,h,g){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const v=s.layers[0].layout,b=!!s.layers[0].dynamicFilter(),A=new ba(null,0,!1,!1,!0),I=v.get("text-allow-overlap"),D=v.get("icon-allow-overlap"),B=v.get("text-variable-anchor"),L=v.get("text-rotation-alignment")==="map",q=v.get("text-pitch-alignment")==="map",Q=v.get("icon-text-fit")!=="none",ne=new ba(null,0,I&&(D||!s.hasIconData()||v.get("icon-optional")),D&&(I||!s.hasTextData()||v.get("text-optional")),!0);!s.collisionArrays&&g&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(g);const oe=(ae,Z,re)=>{for(let ue=0;ue<Z/4;ue++)ae.opacityVertexArray.emplaceBack(re)};let ie=0;for(let ae=0;ae<s.symbolInstances.length;ae++){const Z=s.symbolInstances.get(ae),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:ue,crossTileID:he,numIconVertices:be}=Z,Se=h.has(he);let we=this.opacities[he];Se?we=A:we||(we=ne,this.opacities[he]=we),h.add(he);const Ce=re>0||ue>0,Ie=be>0,Re=this.placedOrientations[he],st=Re===l.WritingMode.vertical,De=Re===l.WritingMode.horizontal||Re===l.WritingMode.horizontalOnly;if(!Ce&&!Ie||we.isHidden()||ie++,Ce){const Ke=Rc(we.text);oe(s.text,re,st?ln:Ke),oe(s.text,ue,De?ln:Ke);const Ne=we.text.isHidden(),{leftJustifiedTextSymbolIndex:at,centerJustifiedTextSymbolIndex:ze,rightJustifiedTextSymbolIndex:Ze,verticalPlacedTextSymbolIndex:ut}=Z,tt=s.text.placedSymbolArray,ht=Ne||st?1:0;at>=0&&(tt.get(at).hidden=ht),ze>=0&&(tt.get(ze).hidden=ht),Ze>=0&&(tt.get(Ze).hidden=ht),ut>=0&&(tt.get(ut).hidden=Ne||De?1:0);const Mt=this.variableOffsets[he];Mt&&this.markUsedJustification(s,Mt.anchor,Z,Re);const $t=this.placedOrientations[he];$t&&(this.markUsedJustification(s,"left",Z,$t),this.markUsedOrientation(s,$t,Z))}if(Ie){const Ke=Rc(we.icon),{placedIconSymbolIndex:Ne,verticalPlacedIconSymbolIndex:at}=Z,ze=s.icon.placedSymbolArray,Ze=we.icon.isHidden()?1:0;Ne>=0&&(oe(s.icon,be,st?ln:Ke),ze.get(Ne).hidden=Ze),at>=0&&(oe(s.icon,Z.numVerticalIconVertices,De?ln:Ke),ze.get(at).hidden=Ze)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Ke=s.collisionArrays[ae];if(Ke){let Ne=new l.Point(0,0),at=!0;if(Ke.textBox||Ke.verticalTextBox){if(B){const Ze=this.variableOffsets[he];Ze?(Ne=Mc(Ze.anchor,Ze.width,Ze.height,Ze.textOffset,Ze.textScale),L&&Ne._rotate(q?this.transform.angle:-this.transform.angle)):at=!1}b&&(at=!we.clipped),Ke.textBox&&yl(s.textCollisionBox.collisionVertexArray,we.text.placed,!at||st,Ne.x,Ne.y),Ke.verticalTextBox&&yl(s.textCollisionBox.collisionVertexArray,we.text.placed,!at||De,Ne.x,Ne.y)}const ze=at&&!!(!De&&Ke.verticalIconBox);Ke.iconBox&&yl(s.iconCollisionBox.collisionVertexArray,we.icon.placed,ze,Q?Ne.x:0,Q?Ne.y:0),Ke.verticalIconBox&&yl(s.iconCollisionBox.collisionVertexArray,we.icon.placed,!ze,Q?Ne.x:0,Q?Ne.y:0)}}}if(s.fullyClipped=ie===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ae.invProjMatrix,s.placementViewportMatrix=ae.viewportMatrix,s.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function yl(f,s,h,g,v){f.emplaceBack(s?1:0,h?1:0,g||0,v||0),f.emplaceBack(s?1:0,h?1:0,g||0,v||0),f.emplaceBack(s?1:0,h?1:0,g||0,v||0),f.emplaceBack(s?1:0,h?1:0,g||0,v||0)}const Ci=Math.pow(2,25),fn=Math.pow(2,24),ep=Math.pow(2,17),tp=Math.pow(2,16),ki=Math.pow(2,9),no=Math.pow(2,8),a0=Math.pow(2,1);function Rc(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const s=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Ci+s*fn+h*ep+s*tp+h*ki+s*no+h*a0+s}const ln=0;class Oc{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,h,g,v,b){const A=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(A,v,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((I,D)=>I.sortKey-D.sortKey));this._currentPartIndex<A.length;){const I=A[this._currentPartIndex];if(h.placeLayerBucketPart(I,this._seenCrossTileIDs,g,I.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class rp{constructor(s,h,g,v,b,A,I,D){this.placement=new Wu(s,b,A,I,D),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,h,g){const v=l.exported.now(),b=()=>{const A=l.exported.now()-v;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=h[s[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=I)&&(!A.maxzoom||A.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Oc(A)),this._inProgressLayer.continuePlacement(g[A.source],this.placement,this._showCollisionBoxes,A,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Rs=512/l.EXTENT/2;class Jn{constructor(s,h,g){this.tileID=s,this.bucketInstanceId=g,this.index=new l.KDBush(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=s.canonical.x*l.EXTENT,b=s.canonical.y*l.EXTENT;for(let A=0;A<h.length;A++){const{key:I,crossTileID:D,tileAnchorX:B,tileAnchorY:L}=h.get(A),q=Math.floor((v+B)*Rs),Q=Math.floor((b+L)*Rs);this.index.add(q,Q),this.keys.push(I),this.crossTileIDs.push(D)}this.index.finish()}findMatches(s,h,g){const v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),b=Rs/Math.pow(2,h.canonical.z-this.tileID.canonical.z),A=h.canonical.x*l.EXTENT,I=h.canonical.y*l.EXTENT;for(let D=0;D<s.length;D++){const B=s.get(D);if(B.crossTileID)continue;const{key:L,tileAnchorX:q,tileAnchorY:Q}=B,ne=Math.floor((A+q)*b),oe=Math.floor((I+Q)*b),ie=this.index.range(ne-v,oe-v,ne+v,oe+v);for(const ae of ie){const Z=this.crossTileIDs[ae];if(this.keys[ae]===L&&!g.has(Z)){g.add(Z),B.crossTileID=Z;break}}}}}class np{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ip{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const g in this.indexes){const v=this.indexes[g],b={};for(const A in v){const I=v[A];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+h),b[I.tileID.key]=I}this.indexes[g]=b}this.lng=s}addBucket(s,h,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const v=this.usedCrossTileIDs[s.overscaledZ];for(const b in this.indexes){const A=this.indexes[b];if(Number(b)>s.overscaledZ)for(const I in A){const D=A[I];D.tileID.isChildOf(s)&&D.findMatches(h.symbolInstances,s,v)}else{const I=A[s.scaledTo(Number(b)).key];I&&I.findMatches(h.symbolInstances,s,v)}}for(let b=0;b<h.symbolInstances.length;b++){const A=h.symbolInstances.get(b);A.crossTileID||(A.crossTileID=g.generate(),v.add(A.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Jn(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const g of h.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let h=!1;for(const g in this.indexes){const v=this.indexes[g];for(const b in v)s[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[b]),delete v[b],h=!0)}return h}}class wa{constructor(){this.layerIndexes={},this.crossTileIDs=new np,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,g,v){let b=this.layerIndexes[s.id];b===void 0&&(b=this.layerIndexes[s.id]=new ip);let A=!1;const I={};v.name!=="globe"&&b.handleWrapJump(g);for(const D of h){const B=D.getBucket(s);B&&s.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(D.tileID,B,this.crossTileIDs)&&(A=!0),I[B.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(A=!0),A}pruneUnusedLayers(s){const h={};s.forEach(g=>{h[g]=!0});for(const g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}const es=(f,s)=>l.emitValidationErrors(f,s&&s.filter(h=>h.identifier!=="source.canvas")),Gu=l.pick(br,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Yv=l.pick(br,["setCenter","setZoom","setBearing","setPitch"]),op={version:8,layers:[],sources:{}},_l={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Xo extends l.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new gt(ml(),this),this.imageManager=new Be,this.imageManager.setEventedParent(this),this.glyphManager=new l.GlyphManager(s._requestManager,h.localFontFamily?l.LocalGlyphMode.all:h.localIdeographFontFamily?l.LocalGlyphMode.ideographs:l.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new wa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const g=this;this._rtlTextPluginCallback=Xo.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,A)=>{if(l.triggerPluginCompletionEvent(b),A&&A.every(I=>I))for(const I in g._sourceCaches){const D=g._sourceCaches[I],B=D.getSource().type;B!=="vector"&&B!=="geojson"||D.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const A in this._layers){const I=this._layers[A];I.source===b.id&&this._validateLayer(I)}})}loadURL(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const g=typeof h.validate=="boolean"?h.validate:!l.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,h.accessToken);const v=this.map._requestManager.transformRequest(s,l.ResourceType.Style);this._request=l.getJSON(v,(b,A)=>{this._request=null,b?this.fire(new l.ErrorEvent(b)):A&&this._load(A,g)})}loadJSON(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(op,!1)}_updateLayerCount(s,h){const g=h?1:-1;s.is3D()&&(this._num3DLayers+=g),s.type==="circle"&&(this._numCircleLayers+=g),s.type==="symbol"&&(this._numSymbolLayers+=g)}_load(s,h){if(h&&es(this,l.validateStyle(s)))return;this._loaded=!0,this.stylesheet=l.clone$1(s),this._updateMapProjection();for(const v in s.sources)this.addSource(v,s.sources[v],{validate:!1});this._changed=!1,s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(s.glyphs);const g=t0(this.stylesheet.layers);this._order=g.map(v=>v.id),this._layers={},this._serializedLayers={};for(const v of g){const b=l.createStyleLayer(v);b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ve(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(s){this._spriteRequest=function(h,g,v){let b,A,I;const D=l.exported.devicePixelRatio>1?"@2x":"";let B=l.getJSON(g.transformRequest(g.normalizeSpriteURL(h,D,".json"),l.ResourceType.SpriteJSON),(Q,ne)=>{B=null,I||(I=Q,b=ne,q())}),L=l.getImage(g.transformRequest(g.normalizeSpriteURL(h,D,".png"),l.ResourceType.SpriteImage),(Q,ne)=>{L=null,I||(I=Q,A=ne,q())});function q(){if(I)v(I);else if(b&&A){const Q=l.exported.getImageData(A),ne={};for(const oe in b){const{width:ie,height:ae,x:Z,y:re,sdf:ue,pixelRatio:he,stretchX:be,stretchY:Se,content:we}=b[oe],Ce=new l.RGBAImage({width:ie,height:ae});l.RGBAImage.copy(Q,Ce,{x:Z,y:re},{x:0,y:0},{width:ie,height:ae}),ne[oe]={data:Ce,pixelRatio:he,sdf:ue,stretchX:be,stretchY:Se,content:we}}v(null,ne)}}return{cancel(){B&&(B.cancel(),B=null),L&&(L.cancel(),L=null)}}}(s,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new l.ErrorEvent(h));else if(g)for(const v in g)this.imageManager.addImage(v,g[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(s){const h=this.getSource(s.source);if(!h)return;const g=s.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const h=[];for(const g of s){const v=this._layers[g];v.type!=="custom"&&h.push(v.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(s){return!!this.terrain&&(typeof s.isLayerDraped=="function"?s.isLayerDraped():_l[s.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const A in this._updatedSources){const I=this._updatedSources[A];I==="reload"?this._reloadSource(A):I==="clear"&&this._clearSource(A)}this._updateTilesForChangedImages();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(s);this.light.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._resetUpdates()}const g={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];g[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(s,this._availableImages),!b.isHidden(s.zoom)){const I=this._getLayerSourceCache(b);I&&(I.used=!0)}const A=this.map.painter;if(A){const I=b.getProgramIds();if(!I)continue;const D=b.getProgramConfiguration(s.zoom);for(const B of I)A.useProgram(B,D)}}for(const v in g){const b=this._sourceCaches[v];g[v]!==b.used&&b.getSource().fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),es(this,l.validateStyle(s)))return!1;(s=l.clone$1(s)).layers=t0(s.layers);const h=function(v,b){if(!v)return[{command:br.setStyle,args:[b]}];let A=[];try{if(!w(v.version,b.version))return[{command:br.setStyle,args:[b]}];w(v.center,b.center)||A.push({command:br.setCenter,args:[b.center]}),w(v.zoom,b.zoom)||A.push({command:br.setZoom,args:[b.zoom]}),w(v.bearing,b.bearing)||A.push({command:br.setBearing,args:[b.bearing]}),w(v.pitch,b.pitch)||A.push({command:br.setPitch,args:[b.pitch]}),w(v.sprite,b.sprite)||A.push({command:br.setSprite,args:[b.sprite]}),w(v.glyphs,b.glyphs)||A.push({command:br.setGlyphs,args:[b.glyphs]}),w(v.transition,b.transition)||A.push({command:br.setTransition,args:[b.transition]}),w(v.light,b.light)||A.push({command:br.setLight,args:[b.light]}),w(v.fog,b.fog)||A.push({command:br.setFog,args:[b.fog]}),w(v.projection,b.projection)||A.push({command:br.setProjection,args:[b.projection]});const I={},D=[];(function(q,Q,ne,oe){let ie;for(ie in Q=Q||{},q=q||{})q.hasOwnProperty(ie)&&(Q.hasOwnProperty(ie)||Ic(ie,ne,oe));for(ie in Q){if(!Q.hasOwnProperty(ie))continue;const ae=Q[ie];q.hasOwnProperty(ie)?w(q[ie],ae)||(q[ie].type==="geojson"&&ae.type==="geojson"&&$u(q,Q,ie)?ne.push({command:br.setGeoJSONSourceData,args:[ie,ae.data]}):Kd(ie,Q,ne,oe)):Zd(ie,Q,ne)}})(v.sources,b.sources,D,I);const B=[];v.layers&&v.layers.forEach(q=>{q.source&&I[q.source]?A.push({command:br.removeLayer,args:[q.id]}):B.push(q)});let L=v.terrain;L&&I[L.source]&&(A.push({command:br.setTerrain,args:[void 0]}),L=void 0),A=A.concat(D),w(L,b.terrain)||A.push({command:br.setTerrain,args:[b.terrain]}),function(q,Q,ne){Q=Q||[];const oe=(q=q||[]).map(_a),ie=Q.map(_a),ae=q.reduce(Xd,{}),Z=Q.reduce(Xd,{}),re=oe.slice(),ue=Object.create(null);let he,be,Se,we,Ce,Ie,Re;for(he=0,be=0;he<oe.length;he++)Se=oe[he],Z.hasOwnProperty(Se)?be++:(ne.push({command:br.removeLayer,args:[Se]}),re.splice(re.indexOf(Se,be),1));for(he=0,be=0;he<ie.length;he++)Se=ie[ie.length-1-he],re[re.length-1-he]!==Se&&(ae.hasOwnProperty(Se)?(ne.push({command:br.removeLayer,args:[Se]}),re.splice(re.lastIndexOf(Se,re.length-be),1)):be++,Ie=re[re.length-he],ne.push({command:br.addLayer,args:[Z[Se],Ie]}),re.splice(re.length-he,0,Se),ue[Se]=!0);for(he=0;he<ie.length;he++)if(Se=ie[he],we=ae[Se],Ce=Z[Se],!ue[Se]&&!w(we,Ce))if(w(we.source,Ce.source)&&w(we["source-layer"],Ce["source-layer"])&&w(we.type,Ce.type)){for(Re in Zo(we.layout,Ce.layout,ne,Se,null,br.setLayoutProperty),Zo(we.paint,Ce.paint,ne,Se,null,br.setPaintProperty),w(we.filter,Ce.filter)||ne.push({command:br.setFilter,args:[Se,Ce.filter]}),w(we.minzoom,Ce.minzoom)&&w(we.maxzoom,Ce.maxzoom)||ne.push({command:br.setLayerZoomRange,args:[Se,Ce.minzoom,Ce.maxzoom]}),we)we.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?Zo(we[Re],Ce[Re],ne,Se,Re.slice(6),br.setPaintProperty):w(we[Re],Ce[Re])||ne.push({command:br.setLayerProperty,args:[Se,Re,Ce[Re]]}));for(Re in Ce)Ce.hasOwnProperty(Re)&&!we.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?Zo(we[Re],Ce[Re],ne,Se,Re.slice(6),br.setPaintProperty):w(we[Re],Ce[Re])||ne.push({command:br.setLayerProperty,args:[Se,Re,Ce[Re]]}))}else ne.push({command:br.removeLayer,args:[Se]}),Ie=re[re.lastIndexOf(Se)+1],ne.push({command:br.addLayer,args:[Ce,Ie]})}(B,b.layers,A)}catch(I){console.warn("Unable to compute style diff:",I),A=[{command:br.setStyle,args:[b]}]}return A}(this.serialize(),s).filter(v=>!(v.command in Yv));if(h.length===0)return!1;const g=h.filter(v=>!(v.command in Gu));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return h.forEach(v=>{v.command!=="setTransition"&&v.command!=="setProjection"&&this[v.command].apply(this,v.args)}),this.stylesheet=s,this._updateMapProjection(),!0}addImage(s,h){return this.getImage(s)?this.fire(new l.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,h),this._afterImageUpdated(s),this)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s),this._afterImageUpdated(s),this):this.fire(new l.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(s,h,g={}){if(this._checkLoaded(),this.getSource(s)!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.validateSource,`sources.${s}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const v=Qt(s,h,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(s),source:v.serialize(),sourceId:s}));const b=A=>{const I=(A?"symbol:":"other:")+s,D=this._sourceCaches[I]=new l.SourceCache(I,v,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[s]=D,D.style=this,D.onAdd(this.map)};b(!1),h.type!=="vector"&&h.type!=="geojson"||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(s){this._checkLoaded();const h=this.getSource(s);if(!h)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===s)return this.fire(new l.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===s)return this.fire(new l.ErrorEvent(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(s);for(const v of g)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getSource(s).setData(h),this._changed=!0}getSource(s){const h=this._getSourceCache(s);return h&&h.getSource()}_getSources(){const s=[];for(const h in this._otherSourceCaches){const g=this._getSourceCache(h);g&&s.push(g.getSource())}return s}addLayer(s,h,g={}){this._checkLoaded();const v=s.id;if(this.getLayer(v))return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if(s.type==="custom"){if(es(this,l.validateCustomStyleLayer(s)))return;b=l.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(v,s.source),s=l.clone$1(s),s=l.extend(s,{source:v})),this._validate(l.validateLayer,`layers.${v}`,s,{arrayIndex:-1},g))return;b=l.createStyleLayer(s),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const A=h?this._order.indexOf(h):this._order.length;if(h&&A===-1)return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(A,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const I=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&I&&b.type!=="custom"){const D=this._removedLayers[v];delete this._removedLayers[v],D.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",I.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const g=this._order.indexOf(s);this._order.splice(g,1);const v=h?this._order.indexOf(h):this._order.length;h&&v===-1?this.fire(new l.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(v,0,s),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const g=this._order.indexOf(s);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}hasLayerType(s){for(const h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,g){this._checkLoaded();const v=this.getLayer(s);v?v.minzoom===h&&v.maxzoom===g||(h!=null&&(v.minzoom=h),g!=null&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(s,h,g={}){this._checkLoaded();const v=this.getLayer(s);if(v){if(!w(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(l.validateFilter,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=l.clone$1(h),this._updateLayer(v)))}else this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be filtered.`)))}getFilter(s){const h=this.getLayer(s);return h&&l.clone$1(h.filter)}setLayoutProperty(s,h,g,v={}){this._checkLoaded();const b=this.getLayer(s);b?w(b.getLayoutProperty(h),g)||(b.setLayoutProperty(h,g,v),this._updateLayer(b)):this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(s,h){const g=this.getLayer(s);if(g)return g.getLayoutProperty(h);this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style.`)))}setPaintProperty(s,h,g,v={}){this._checkLoaded();const b=this.getLayer(s);b?w(b.getPaintProperty(h),g)||(b.setPaintProperty(h,g,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(s,h){const g=this.getLayer(s);return g&&g.getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const g=s.source,v=s.sourceLayer,b=this.getSource(g);if(!b)return void this.fire(new l.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const A=b.type;if(A==="geojson"&&v)return void this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!v)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided.")));const I=this._getSourceCaches(g);for(const D of I)D.setFeatureState(v,s.id,h)}removeFeatureState(s,h){this._checkLoaded();const g=s.source,v=this.getSource(g);if(!v)return void this.fire(new l.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=v.type,A=b==="vector"?s.sourceLayer:void 0;if(b==="vector"&&!A)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const I=this._getSourceCaches(g);for(const D of I)D.removeFeatureState(A,s.id,h)}getFeatureState(s){this._checkLoaded();const h=s.source,g=s.sourceLayer,v=this.getSource(h);if(v){if(v.type!=="vector"||g)return s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(g,s.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const s={};for(const h in this._sourceCaches){const g=this._sourceCaches[h].getSource();s[g.id]||(s[g.id]=g.serialize())}return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:s,layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0;const h=this._getLayerSourceCache(s);s.source&&!this._updatedSources[s.source]&&h&&h.getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",h.pause()),this._changed=!0,s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const h=A=>this._layers[A].type==="fill-extrusion",g={},v=[];for(let A=this._order.length-1;A>=0;A--){const I=this._order[A];if(h(I)){g[I]=A;for(const D of s){const B=D[I];if(B)for(const L of B)v.push(L)}}}v.sort((A,I)=>I.intersectionZ-A.intersectionZ);const b=[];for(let A=this._order.length-1;A>=0;A--){const I=this._order[A];if(h(I))for(let D=v.length-1;D>=0;D--){const B=v[D].feature;if(g[B.layer.id]<A)break;b.push(B),v.pop()}else for(const D of s){const B=D[I];if(B)for(const L of B)b.push(L.feature)}}return b}queryRenderedFeatures(s,h,g){h&&h.filter&&this._validate(l.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const D of h.layers){const B=this._layers[D];if(!B)return this.fire(new l.ErrorEvent(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];v[B.source]=!0}}const b=[];h.availableImages=this._availableImages;const A=h&&h.layers?h.layers.some(D=>{const B=this.getLayer(D);return B&&B.is3D()}):this.has3DLayers(),I=et.createFromScreenPoints(s,g);for(const D in this._sourceCaches){const B=this._sourceCaches[D].getSource().id;h.layers&&!v[B]||b.push(en(this._sourceCaches[D],this._layers,this._serializedLayers,I,h,g,A,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(D,B,L,q,Q,ne,oe){const ie={},ae=ne.queryRenderedSymbols(q),Z=[];for(const re of Object.keys(ae).map(Number))Z.push(oe[re]);Z.sort(li);for(const re of Z){const ue=re.featureIndex.lookupSymbolFeatures(ae[re.bucketInstanceId],B,re.bucketIndex,re.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,D);for(const he in ue){const be=ie[he]=ie[he]||[],Se=ue[he];Se.sort((we,Ce)=>{const Ie=re.featureSortOrder;if(Ie){const Re=Ie.indexOf(we.featureIndex);return Ie.indexOf(Ce.featureIndex)-Re}return Ce.featureIndex-we.featureIndex});for(const we of Se)be.push(we)}}for(const re in ie)ie[re].forEach(ue=>{const he=ue.feature,be=L(D[re]);if(!be)return;const Se=be.getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=Se});return ie}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),I.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(s,h){h&&h.filter&&this._validate(l.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const g=this._getSourceCaches(s);let v=[];for(const b of g)v=v.concat(yn(b,h));return v}addSourceType(s,h,g){return Xo.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(Xo.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const A in s)if(!w(s[A],g[A])){v=!0;break}if(!v)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(s,h),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(s,h=1){if(this._checkLoaded(),!s)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let g=s;if(h===1){if(typeof g.source=="object"){const v="terrain-dem-src";this.addSource(v,g.source),g=l.clone$1(g),g=l.extend(g,{source:v})}if(this._validate(l.validateTerrain,"terrain",g))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,h)}else{const v=this.terrain,b=v.get();for(const A of Object.keys(l.spec.terrain))!g.hasOwnProperty(A)&&l.spec.terrain[A].default&&(g[A]=l.spec.terrain[A].default);for(const A in g)if(!w(g[A],b[A])){v.set(g),this.stylesheet.terrain=g;const I=this._setTransitionParameters({duration:0});v.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const h=this.fog=new St(s,this.map.transform);this.stylesheet.fog=s;const g=this._setTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,g=h.get();Object.keys(s).length===0&&h.set(s);for(const v in s)if(!w(s[v],g[v])){h.set(s),this.stylesheet.fog=s;const b=this._setTransitionParameters({duration:0});h.updateTransitions(b);break}}else this._createFog(s);this._markersNeedUpdate=!0}_setTransitionParameters(s){return{now:l.exported.now(),transition:l.extend(s,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const s=this._order.filter(g=>this.isLayerDraped(this._layers[g])),h=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){const g=this.terrain=new Dt(s,h);this.stylesheet.terrain=s,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="symbol"&&this._updateLayer(h)}}_validate(s,h,g,v,b={}){return(!b||b.validate!==!1)&&es(this,s.call(l.validateStyle,l.extend({key:h,style:this.serialize(),value:g,styleSpec:l.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this._sourceCaches)this._sourceCaches[s].clearTiles(),this._sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){const h=this._getSourceCaches(s);for(const g of h)g.clearTiles()}_reloadSource(s){const h=this._getSourceCaches(s);for(const g of h)g.resume(),g.reload()}_reloadSources(){for(const s of this._getSources())s.reload&&s.reload()}_updateSources(s){for(const h in this._sourceCaches)this._sourceCaches[h].update(s)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,g,v,b=!1){let A=!1,I=!1;const D={};for(const B of this._order){const L=this._layers[B];if(L.type!=="symbol")continue;if(!D[L.source]){const Q=this._getLayerSourceCache(L);if(!Q)continue;D[L.source]=Q.getRenderableIds(!0).map(ne=>Q.getTileByID(ne)).sort((ne,oe)=>oe.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(oe.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(L,D[L.source],s.center.lng,s.projection);A=A||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new l.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),s.zoom))&&(this.pauseablePlacement=new rp(s,this._order,b,h,g,v,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),I=!0),A&&this.pauseablePlacement.placement.setStale()),I||A)for(const B of this._order){const L=this._layers[B];L.type==="symbol"&&this.placement.updateLayerOpacities(L,D[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(s,h,g){this.glyphManager.getGlyphs(h.stacks,g)}getResource(s,h,g){return l.makeRequest(h,g)}_getSourceCache(s){return this._otherSourceCaches[s]}_getLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}_getSourceCaches(s){const h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){const h=this._getSourceCaches(s);return h.length===0?(this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${s}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Xo.getSourceType=function(f){return Wt[f]},Xo.setSourceType=function(f,s){Wt[f]=s},Xo.registerForPluginStateChange=l.registerForPluginStateChange;var ap=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Os="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ea=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Fc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Sa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Hu={},vl={};const Lc=[];xl(ap,Lc),xl(Ea,Lc),xl(Fc,Lc),xl(Sa,Lc),Hu=wr("",Ea),vl=wr(Sa,Fc);const s0=wr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),qu=ap,sp=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var lp={background:wr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:wr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:wr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:wr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:wr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:wr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:wr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:wr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:wr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:wr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:wr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:wr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:wr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:wr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:wr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:wr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:wr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:wr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:wr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:wr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:wr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:wr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:wr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:wr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:wr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Os),skyboxGradient:wr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Os),skyboxCapture:wr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:wr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:wr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function xl(f,s){const h=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=g.split(" ");for(const b of v)s.includes(b)||s.push(b)}}function wr(f,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=s.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v={},b=[...Lc];return xl(f,b),xl(s,b),{fragmentSource:f=f.replace(h,(A,I,D,B,L)=>(v[L]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${L}
varying ${D} ${B} ${L};
#else
uniform ${D} ${B} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${D} ${B} ${L} = u_${L};
#endif
`)),vertexSource:s=s.replace(h,(A,I,D,B,L)=>{const q=B==="float"?"vec2":"vec4",Q=L.match(/color/)?"color":q;return v[L]?I==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${D} ${q} a_${L};
varying ${D} ${B} ${L};
#else
uniform ${D} ${B} u_${L};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${D} ${B} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${Q}(a_${L}, u_${L}_t);
#else
    ${D} ${B} ${L} = u_${L};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${D} ${q} a_${L};
#else
uniform ${D} ${B} u_${L};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${D} ${B} ${L} = a_${L};
#else
    ${D} ${B} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${D} ${B} ${L} = unpack_mix_${Q}(a_${L}, u_${L}_t);
#else
    ${D} ${B} ${L} = u_${L};
#endif
`}),staticAttributes:g,usedDefines:b}}class Qv{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,h,g,v,b,A,I){this.context=s;let D=this.boundPaintVertexBuffers.length!==v.length;for(let L=0;!D&&L<v.length;L++)this.boundPaintVertexBuffers[L]!==v[L]&&(D=!0);let B=this.boundDynamicVertexBuffers.length!==I.length;for(let L=0;!B&&L<I.length;L++)this.boundDynamicVertexBuffers[L]!==I[L]&&(B=!0);if(!s.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||D||B||this.boundIndexBuffer!==b||this.boundVertexOffset!==A)this.freshBind(h,g,v,b,A,I);else{s.bindVertexArrayOES.set(this.vao);for(const L of I)L&&L.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(s,h,g,v,b,A){let I;const D=s.numAttributes,B=this.context,L=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=A;else{I=B.currentNumAttributes||0;for(let q=D;q<I;q++)L.disableVertexAttribArray(q)}h.enableAttributes(L,s),h.bind(),h.setVertexAttribPointers(L,s,b);for(const q of g)q.enableAttributes(L,s),q.bind(),q.setVertexAttribPointers(L,s,b);for(const q of A)q&&(q.enableAttributes(L,s),q.bind(),q.setVertexAttribPointers(L,s,b));v&&v.bind(),B.currentNumAttributes=D}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function cp(f,s){const h=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new l.MercatorCoordinate(0,g/h).toLngLat().lat,new l.MercatorCoordinate(0,(g+1)/h).toLngLat().lat]}function l0(f,s,h,g,v,b,A){const I=f.context,D=I.gl,B=h.fbo;if(!B)return;f.prepareDrawTile();const L=f.useProgram("hillshade");I.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,B.colorAttachment.get());const q=((ie,ae,Z,re)=>{const ue=Z.paint.get("hillshade-shadow-color"),he=Z.paint.get("hillshade-highlight-color"),be=Z.paint.get("hillshade-accent-color");let Se=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);Z.paint.get("hillshade-illumination-anchor")==="viewport"&&(Se-=ie.transform.angle);const we=!ie.options.moving;return{u_matrix:re||ie.transform.calculateProjMatrix(ae.tileID.toUnwrapped(),we),u_image:0,u_latrange:cp(0,ae.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),Se],u_shadow:ue,u_highlight:he,u_accent:be}})(f,h,g,f.terrain?s.projMatrix:null);f.prepareDrawProgram(I,L,s.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:ne,tileBoundsSegments:oe}=f.getTileBoundsBuffers(h);L.draw(I,D.TRIANGLES,v,b,A,l.CullFaceMode.disabled,q,g.id,Q,ne,oe)}function up(f,s,h){if(!s.needsDEMTextureUpload)return;const g=f.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||f.getTileTexture(h.stride);const b=h.getPixels();s.demTexture?s.demTexture.update(b,{premultiply:!1}):s.demTexture=new l.Texture(g,b,v.RGBA,{premultiply:!1}),s.needsDEMTextureUpload=!1}function c0(f,s,h,g,v,b){const A=f.context,I=A.gl;if(!s.dem)return;const D=s.dem;if(A.activeTexture.set(I.TEXTURE1),up(f,s,D),!s.demTexture)return;s.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);const B=D.dim;A.activeTexture.set(I.TEXTURE0);let L=s.fbo;if(!L){const oe=new l.Texture(A,{width:B,height:B,data:null},I.RGBA);oe.bind(I.LINEAR,I.CLAMP_TO_EDGE),L=s.fbo=A.createFramebuffer(B,B,!0),L.colorAttachment.set(oe.texture)}A.bindFramebuffer.set(L.framebuffer),A.viewport.set([0,0,B,B]);const{tileBoundsBuffer:q,tileBoundsIndexBuffer:Q,tileBoundsSegments:ne}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(A,I.TRIANGLES,g,v,b,l.CullFaceMode.disabled,((oe,ie)=>{const ae=ie.stride,Z=l.create();return l.ortho(Z,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(Z,Z,[0,-l.EXTENT,0]),{u_matrix:Z,u_image:1,u_dimension:[ae,ae],u_zoom:oe.overscaledZ,u_unpack:ie.unpackVector}})(s.tileID,D),h.id,q,Q,ne),s.needsHillshadePrepare=!1}const hp=f=>({u_matrix:new l.UniformMatrix4f(f),u_image0:new l.Uniform1i(f),u_skirt_height:new l.Uniform1f(f)}),bl=(f,s)=>({u_matrix:f,u_image0:0,u_skirt_height:s}),Zu=(f,s,h,g,v,b,A,I,D,B,L,q,Q,ne,oe)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:A,u_frustum_tr:I,u_frustum_br:D,u_frustum_bl:B,u_globe_pos:L,u_globe_radius:q,u_viewport:Q,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:ne});function wl(f,s){return f!=null&&s!=null&&!(!f.hasData()||!s.hasData())&&f.demTexture!=null&&s.demTexture!=null&&f.tileID.key!==s.tileID.key}const Ta=new class{constructor(){this.operations={}}newMorphing(f,s,h,g,v){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==h.tileID.key&&(b.queued=h)}else this.operations[f]={startTime:g,phase:0,duration:v,from:s,to:h,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const s=this.operations[f];return{from:s.from,to:s.to,phase:s.phase}}update(f){for(const s in this.operations){const h=this.operations[s];for(h.phase=(f-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,f)){delete this.operations[s];break}}}_nextOp(f,s){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=s,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Fs={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ku(f){return 6*Math.pow(1.5,22-f)}function u0(f,s){const h=1<<f.z;return!s&&(f.x===0||f.x===h-1)||f.y===0||f.y===h-1}const Bc=f=>({u_matrix:f});function dp(f,s,h,g,v){if(v>0){const b=l.exported.now(),A=(b-f.timeAdded)/v,I=s?(b-s.timeAdded)/v:-1,D=h.getSource(),B=g.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),L=!s||Math.abs(s.tileID.overscaledZ-B)>Math.abs(f.tileID.overscaledZ-B),q=L&&f.refreshedUponExpiration?1:l.clamp(L?A:1-I,0,1);return f.refreshedUponExpiration&&A>=1&&(f.refreshedUponExpiration=!1),s?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}class pp extends l.SourceCache{constructor(s){const h={type:"raster-dem",maxzoom:s.transform.maxZoom},g=new gt(ml(),null),v=Qt("mock-dem",h,g,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class Xu extends l.SourceCache{constructor(s){const h=Qt("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new gt(ml(),null),s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,g){if(s.freezeTileCoverage)return;this.transform=s;const v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,A)=>{if(b[A.key]="",!this._tiles[A.key]){const I=new l.Tile(A,this._source.tileSize*A.overscaleFactor(),s.tileZoom);I.state="loaded",this._tiles[A.key]=I}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(s){const h=this.proxyCachedFBO[s];if(h!==void 0){const g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Yu extends l.OverscaledTileID{constructor(s,h,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class fp extends l.Elevation{constructor(s,h){super(),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,b]=function(D){const B=new l.StructArrayLayout2i4,L=new l.StructArrayLayout3ui6,q=131;B.reserve(17161),L.reserve(33800);const Q=l.EXTENT/128,ne=l.EXTENT+Q/2,oe=ne+Q;for(let ae=-Q;ae<oe;ae+=Q)for(let Z=-Q;Z<oe;Z+=Q){const re=Z<0||Z>ne||ae<0||ae>ne?24575:0,ue=l.clamp(Math.round(Z),0,l.EXTENT),he=l.clamp(Math.round(ae),0,l.EXTENT);B.emplaceBack(ue+re,he)}const ie=(ae,Z)=>{const re=Z*q+ae;L.emplaceBack(re+1,re,re+q),L.emplaceBack(re+q,re+q+1,re+1)};for(let ae=1;ae<129;ae++)for(let Z=1;Z<129;Z++)ie(Z,ae);return[0,129].forEach(ae=>{for(let Z=0;Z<130;Z++)ie(Z,ae),ie(ae,Z)}),[B,L,32768]}(),A=s.context;this.gridBuffer=A.createVertexBuffer(g,l.posAttributes.members),this.gridIndexBuffer=A.createIndexBuffer(v),this.gridSegments=l.SegmentVector.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=l.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Xu(h.map),this.orthoMatrix=l.create(),l.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,l.EXTENT,0,l.EXTENT,0,1);const I=A.gl;this._overlapStencilMode=new l.StencilMode({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new pp(h.map)}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),s.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=s,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,h,g){if(s&&s.terrain){this._style!==s&&(this.style=s),this.enabled=!0;const v=s.terrain.properties;this.sourceCache=s.terrain.drapeRenderMode===0?this._mockSourceCache:s._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&l.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const A=this.getScaledDemTileSize();this.sourceCache.update(h,A,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const s=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||s.efficiency!==100&&l.warnOnce(`Terrain render cache efficiency is not optimal (${s.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${s.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._sourceCaches)this._style._sourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=h.getIds().map(D=>{const B=h.getTileByID(D).tileID;return B.projMatrix=g.calculateProjMatrix(B.toUnwrapped()),B});(function(D,B){const L=B.transform.pointCoordinate(B.transform.getCameraPoint()),q=new l.Point(L.x,L.y);D.sort((Q,ne)=>{if(ne.overscaledZ-Q.overscaledZ)return ne.overscaledZ-Q.overscaledZ;const oe=new l.Point(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),ie=new l.Point(ne.canonical.x+(1<<ne.canonical.z)*ne.wrap,ne.canonical.y),ae=q.mult(1<<Q.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(oe)-ae.distSqr(ie)})})(v,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const A=this._style._sourceCaches;for(const D in A){const B=A[D];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,s[D],b),B.usedForTerrain))continue;const L=s[D];B.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[h.id]=v.map(D=>new Yu(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=l.exported.now();const I={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const B=this.terrainTileForTile[D.key];if(!B)continue;const L=B.tileID.key;L in I||(this._visibleDemTiles.push(B),I[L]=L)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;const g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){const s=this.painter.context,h=s.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),up(this.painter,v,b))}}_prepareDemTileUniforms(s,h,g,v){if(!h||h.demTexture==null)return!1;const b=s.tileID.canonical,A=Math.pow(2,h.tileID.canonical.z-b.z),I=v||"";return g[`u_dem_tl${I}`]=[b.x*A%1,b.y*A%1],g[`u_dem_scale${I}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const s=this.painter.context,h=s.gl;if(!this._emptyDepthBufferTexture){const g=new l.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new l.Texture(s,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let s=0;const h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const b=v.dem.tree.minimums[0];return b>0&&s++,g+b},0);return s?h/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new l.RGBAImage({width:1,height:1},new Uint8Array(l.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new l.Texture(s,v,h.RGBA,{premultiply:!1}),b}setupElevationDraw(s,h,g){const v=this.painter.context,b=v.gl,A=(I=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:l.DEMData.getUnpackVector(I),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var I;A.u_dem_size=this.sourceCache.getSource().tileSize,A.u_exaggeration=this.exaggeration();let D=null,B=null,L=1;if(g&&g.morphing&&this._useVertexMorphing){const q=g.morphing.srcDemTile,Q=g.morphing.dstDemTile;L=g.morphing.phase,q&&Q&&(this._prepareDemTileUniforms(s,q,A,"_prev")&&(B=q),this._prepareDemTileUniforms(s,Q,A)&&(D=Q))}if(B&&D?(v.activeTexture.set(b.TEXTURE2),D.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),B.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),A.u_dem_lerp=L):(D=this.terrainTileForTile[s.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(s,D,A)?D.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&D){const q=(1<<D.tileID.canonical.z)*l.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=q}if(g&&g.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,A),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,q)}}globeUniformValues(s,h,g){const v=s.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,l.EXTENT,0),u_tile_br_up:v.upVector(h,l.EXTENT,l.EXTENT),u_tile_bl_up:v.upVector(h,0,l.EXTENT),u_tile_up_scale:g?l.globeMetersToEcef(1):v.upVectorScale(h,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const h=this.painter,g=this.painter.context;s.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,A,I,D){if(v.transform.projection.name==="globe")(function(B,L,q,Q,ne){const oe=B.context,ie=oe.gl;let ae,Z;const re=B.options.showTerrainWireframe?2:0,ue=B.transform,he=l.globeUseCustomAntiAliasing(B,oe,ue),be=(at,ze)=>{if(Z===at)return;const Ze=[Fs[at],"PROJECTION_GLOBE_VIEW"];he&&Ze.push("CUSTOM_ANTIALIASING"),ze&&Ze.push(Fs[re]),ae=B.useProgram("globeRaster",null,Ze),Z=at},Se=B.colorModeForRenderPass(),we=new l.DepthMode(ie.LEQUAL,l.DepthMode.ReadWrite,B.depthRangeFor3D);Ta.update(ne);const Ce=l.calculateGlobeMercatorMatrix(ue),Ie=[l.mercatorXfromLng(ue.center.lng),l.mercatorYfromLat(ue.center.lat)],Re=re?[!1,!0]:[!1],st=B.globeSharedBuffers,De=[ue.width*l.exported.devicePixelRatio,ue.height*l.exported.devicePixelRatio],Ke=Float32Array.from(ue.globeMatrix),Ne={useDenormalizedUpVectorScale:!0};if(Re.forEach(at=>{const ze=B.transform,Ze=Ku(ze.zoom)*L.exaggeration();Z=-1;const ut=at?ie.LINES:ie.TRIANGLES;for(const tt of Q){const ht=q.getTile(tt),Mt=l.StencilMode.disabled,$t=L.prevTerrainTileForTile[tt.key],At=L.terrainTileForTile[tt.key];wl($t,At)&&Ta.newMorphing(tt.key,$t,At,ne,250),oe.activeTexture.set(ie.TEXTURE0),ht.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const Lt=Ta.getMorphValuesForProxy(tt.key),nr=Lt?1:0;Lt&&l.extend$1(Ne,{morphing:{srcDemTile:Lt.from,dstDemTile:Lt.to,phase:l.easeCubicInOut(Lt.phase)}});const er=l.tileCornersToBounds(tt.canonical),Pt=l.getLatitudinalLod(er.getCenter().lat),Ar=l.getGridMatrix(tt.canonical,er,Pt,ze.worldSize/ze._pixelsPerMercatorPixel),Mr=l.globeNormalizeECEF(l.globeTileBounds(tt.canonical)),zr=Zu(ze.projMatrix,Ke,Ce,Mr,l.globeToMercatorTransition(ze.zoom),Ie,ze.frustumCorners.TL,ze.frustumCorners.TR,ze.frustumCorners.BR,ze.frustumCorners.BL,ze.globeCenterInViewSpace,ze.globeRadius,De,Ze,Ar);if(be(nr,at),L.setupElevationDraw(ht,ae,Ne),B.prepareDrawProgram(oe,ae,tt.toUnwrapped()),st){const[Rr,ui,Gn]=at?st.getWirefameBuffers(B.context,Pt):st.getGridBuffers(Pt,Ze!==0);ae.draw(oe,ut,we,Mt,Se,l.CullFaceMode.backCCW,zr,"globe_raster",Rr,ui,Gn)}}}),st){const at=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];he&&at.push("CUSTOM_ANTIALIASING"),ae=B.useProgram("globeRaster",null,at);for(const ze of Q){const{x:Ze,y:ut,z:tt}=ze.canonical,ht=ut===0,Mt=ut===(1<<tt)-1,[$t,At,Lt,nr]=st.getPoleBuffers(tt);if(nr&&(ht||Mt)){const er=q.getTile(ze);oe.activeTexture.set(ie.TEXTURE0),er.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);let Pt=l.globePoleMatrixForTile(tt,Ze,ue);const Ar=l.globeNormalizeECEF(l.globeTileBounds(ze.canonical)),Mr=(zr,Rr)=>zr.draw(oe,ie.TRIANGLES,we,l.StencilMode.disabled,Se,l.CullFaceMode.disabled,Zu(ue.projMatrix,Pt,Pt,Ar,0,Ie,ue.frustumCorners.TL,ue.frustumCorners.TR,ue.frustumCorners.BR,ue.frustumCorners.BL,ue.globeCenterInViewSpace,ue.globeRadius,De,0),"globe_pole_raster",Rr,Lt,nr);L.setupElevationDraw(er,ae,Ne),B.prepareDrawProgram(oe,ae,ze.toUnwrapped()),ht&&Mr(ae,$t),Mt&&(Pt=l.scale(l.create(),Pt,[1,-1,1]),Mr(ae,At))}}}})(v,b,A,I,D);else{const B=v.context,L=B.gl;let q,Q;const ne=v.options.showTerrainWireframe?2:0,oe=(ue,he)=>{if(Q===ue)return;const be=[Fs[ue]];he&&be.push(Fs[ne]),q=v.useProgram("terrainRaster",null,be),Q=ue},ie=v.colorModeForRenderPass(),ae=new l.DepthMode(L.LEQUAL,l.DepthMode.ReadWrite,v.depthRangeFor3D);Ta.update(D);const Z=v.transform,re=Ku(Z.zoom)*b.exaggeration();(ne?[!1,!0]:[!1]).forEach(ue=>{Q=-1;const he=ue?L.LINES:L.TRIANGLES,[be,Se]=ue?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const we of I){const Ce=A.getTile(we),Ie=l.StencilMode.disabled,Re=b.prevTerrainTileForTile[we.key],st=b.terrainTileForTile[we.key];wl(Re,st)&&Ta.newMorphing(we.key,Re,st,D,250),B.activeTexture.set(L.TEXTURE0),Ce.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const De=Ta.getMorphValuesForProxy(we.key),Ke=De?1:0;let Ne;De&&(Ne={morphing:{srcDemTile:De.from,dstDemTile:De.to,phase:l.easeCubicInOut(De.phase)}});const at=bl(we.projMatrix,u0(we.canonical,Z.renderWorldCopies)?re/10:re);oe(Ke,ue),b.setupElevationDraw(Ce,q,Ne),v.prepareDrawProgram(B,q,we.toUnwrapped()),q.draw(B,he,ae,Ie,ie,l.CullFaceMode.backCCW,at,"terrain_raster",b.gridBuffer,be,Se)}})}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const h=this.painter,g=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],A=this._drapedRenderBatches.shift(),I=[],D=h.style.order;let B=0;for(const L of b){const q=v.getTileByID(L.proxyTileKey),Q=v.proxyCachedFBO[L.key]?v.proxyCachedFBO[L.key][s]:void 0,ne=Q!==void 0?v.renderCache[Q]:this.pool[B++],oe=Q!==void 0;if(q.texture=ne.tex,oe&&!ne.dirty){I.push(q.tileID);continue}let ie;g.bindFramebuffer.set(ne.fb.framebuffer),this.renderedToTile=!1,ne.dirty&&(g.clear({color:l.Color.transparent,stencil:0}),ne.dirty=!1);for(let ae=A.start;ae<=A.end;++ae){const Z=h.style._layers[D[ae]];if(Z.isHidden(h.transform.zoom))continue;const re=h.style._getLayerSourceCache(Z),ue=re?this.proxyToSource[L.key][re.id]:[L];if(!ue)continue;const he=ue;g.viewport.set([0,0,ne.fb.width,ne.fb.height]),ie!==(re?re.id:null)&&(this._setupStencil(ne,ue,Z,re),ie=re?re.id:null),h.renderLayer(h,re,Z,he)}this.renderedToTile?(ne.dirty=!0,I.push(q.tileID)):oe||--B,B===5&&(B=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),A.end+1}postRender(){}renderCacheEfficiency(s){const h=s.order.length;if(h===0)return{efficiency:100};let g,v=0,b=0,A=!1;for(let I=0;I<h;++I){const D=s._layers[s.order[I]];this._style.isLayerDraped(D)?(A&&++v,++b):A||(A=!0,g=D.id)}return b===0?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,h,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const A=b.tileID,I=1<<A.overscaledZ,{x:D,y:B}=A.canonical,L=D/I,q=(D+1)/I,Q=B/I,ne=(B+1)/I;return{minx:L,miny:Q,maxx:q,maxy:ne,t:b.dem.tree.raycastRoot(L,Q,q,ne,s,h,g),tile:b}});v.sort((b,A)=>(b.t!==null?b.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const b of v){if(b.t==null)return null;const A=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,s,h,g);if(A!=null)return A}return null}_createFBO(){const s=this.painter.context,h=s.gl,g=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);const v=new l.Texture(s,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);const b=s.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new Te(s,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&!s.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const h=this._style._layers[s],g=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const g of this._style._getSources())if(g instanceof mt){s=!0;break}if(!s)return;const h={};for(let g=0;g<this._style.order.length;++g){const v=this._style._layers[this._style.order[g]],b=this._style._getLayerSourceCache(v);if(b&&!h[b.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof l.ZoomDependentExpression){h[b.id]=!0;for(const A of this.proxyCoords){const I=this.proxyToSource[A.key][b.id];if(I)for(const D of I)this._clearRenderCacheForTile(b.id,D)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const g in this._style._sourceCaches)if(this._style._sourceCaches[g]._source instanceof ct){s=!0;break}if(!s)return;const h={};for(let g=0;g<this._style.order.length;++g){const v=this._style._layers[this._style.order[g]],b=this._style._getLayerSourceCache(v);if(!b||h[b.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const A=v.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const D=this.proxyToSource[I.key][b.id];if(D)for(const B of D){const L=dp(b.getTile(B),b.findLoadedParent(B,0),b,this.painter.transform,A);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(b.id,B)}}}}_setupDrapedRenderBatches(){const s=this._style.order,h=s.length;if(h===0)return;const g=[];let v,b=0,A=this._style._layers[s[b]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++b<h;)A=this._style._layers[s[b]];for(;b<h;++b){const I=this._style._layers[s[b]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?v===void 0&&(v=b):v!==void 0&&(g.push({start:v,end:b-1}),v=void 0))}v!==void 0&&g.push({start:v,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(s){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const A=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let I=0;I<A.length;++I){const D=Object.values(A[I]);h.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let A=g.length-1;A>=0;A--){const I=g[A];if(h.getTileByID(I.key),h.proxyCachedFBO[I.key]!==void 0){const D=s[I.key],B=this.proxyToSource[I.key];let L=0;for(const q in B){const Q=B[q],ne=D[q];if(!ne||ne.length!==Q.length||Q.some((oe,ie)=>oe!==ne[ie]||v[q]&&v[q].hasOwnProperty(oe.key))){L=-1;break}++L}for(const q in h.proxyCachedFBO[I.key])h.renderCache[h.proxyCachedFBO[I.key][q]].dirty=L<0||L!==Object.values(D).length}}const b=[...this._drapedRenderBatches];b.sort((A,I)=>I.end-I.start-(A.end-A.start));for(const A of b)for(const I of g){if(h.proxyCachedFBO[I.key])continue;let D=h.renderCachePool.pop();D===void 0&&h.renderCache.length<50&&(D=h.renderCache.length,h.renderCache.push(this._createFBO())),D!==void 0&&(h.proxyCachedFBO[I.key]={},h.proxyCachedFBO[I.key][A.start]=D,h.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,A=b.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let I;if(g.isTileClipped())I=h.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):l.StencilMode.disabled}_renderTileClippingMasks(s,h){const g=this.painter,v=this.painter.context,b=v.gl;g._tileClippingMaskIDs={},v.setColorMode(l.ColorMode.disabled),v.setDepthMode(l.DepthMode.disabled);const A=g.useProgram("clippingMask");for(const I of s){const D=g._tileClippingMaskIDs[I.key]=--h;A.draw(v,b.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:b.ALWAYS,mask:0},D,255,b.KEEP,b.KEEP,b.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,Bc(I.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){const h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;const g=[s.x,s.y,1,1];l.transformMat4$1(g,g,h.pixelMatrixInverse),l.scale$1(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;const v=h._camera.position,b=l.mercatorZfromAltitude(1,h.center.lat),A=[v[0],v[1],v[2]/b,0],I=l.subtract([],g.slice(0,3),A);l.normalize(I,I);const D=this.raycast(A,I,this._exaggeration);return D!==null&&D?(l.scaleAndAdd(A,A,I,D),A[3]=A[2],A[2]*=b,A):null}drawDepth(){const s=this.painter,h=s.context,g=this.proxySourceCache,v=Math.ceil(s.width),b=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const A=h.gl,I=h.createFramebuffer(v,b,!0);h.activeTexture.set(A.TEXTURE0);const D=new l.Texture(h,{width:v,height:b,data:null},A.RGBA);D.bind(A.NEAREST,A.CLAMP_TO_EDGE),I.colorAttachment.set(D.texture);const B=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,b);I.depthAttachment.set(B),this._depthFBO=I,this._depthTexture=D}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,b]),function(A,I,D,B){if(A.transform.projection.name==="globe")return;const L=A.context,q=L.gl;L.clear({depth:1});const Q=A.useProgram("terrainDepth"),ne=new l.DepthMode(q.LESS,l.DepthMode.ReadWrite,A.depthRangeFor3D);for(const oe of B){const ie=D.getTile(oe),ae=bl(oe.projMatrix,0);I.setupElevationDraw(ie,Q),Q.draw(L,q.TRIANGLES,ne,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.backCCW,ae,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(s,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,h,g){if(s.getSource()instanceof jt)return this._setupProxiedCoordsForImageSource(s,h,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const v=this.proxiedCoords[s.id]=[],b=this.proxyCoords;for(let I=0;I<b.length;I++){const D=b[I],B=this._findTileCoveringTileID(D,s);if(B){const L=this._createProxiedId(D,B,g[D.key]&&g[D.key][s.id]);v.push(L),this.proxyToSource[D.key][s.id]=[L]}}let A=!1;for(let I=0;I<h.length;I++){const D=s.getTile(h[I]);if(!D||!D.hasData())continue;const B=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==D.tileID.canonical.z){const L=this.proxyToSource[B.tileID.key][s.id],q=this._createProxiedId(B.tileID,D,g[B.tileID.key]&&g[B.tileID.key][s.id]);L?L.splice(L.length-1,0,q):this.proxyToSource[B.tileID.key][s.id]=[q],v.push(q),A=!0}}this._sourceTilesOverlap[s.id]=A}_setupProxiedCoordsForImageSource(s,h,g){if(!s.getSource().loaded())return;const v=this.proxiedCoords[s.id]=[],b=this.proxyCoords,A=s.getSource(),I=new l.Point(A.tileID.x,A.tileID.y)._div(1<<A.tileID.z),D=A.coordinates.map(l.MercatorCoordinate.fromLngLat).reduce((L,q)=>(L.min.x=Math.min(L.min.x,q.x-I.x),L.min.y=Math.min(L.min.y,q.y-I.y),L.max.x=Math.max(L.max.x,q.x-I.x),L.max.y=Math.max(L.max.y,q.y-I.y),L),{min:new l.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new l.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(L,q)=>{const Q=L.wrap+L.canonical.x/(1<<L.canonical.z),ne=L.canonical.y/(1<<L.canonical.z),oe=l.EXTENT/(1<<L.canonical.z),ie=q.wrap+q.canonical.x/(1<<q.canonical.z),ae=q.canonical.y/(1<<q.canonical.z);return Q+oe<ie+D.min.x||Q>ie+D.max.x||ne+oe<ae+D.min.y||ne>ae+D.max.y};for(let L=0;L<b.length;L++){const q=b[L];for(let Q=0;Q<h.length;Q++){const ne=s.getTile(h[Q]);if(!ne||!ne.hasData()||B(q,ne.tileID))continue;const oe=this._createProxiedId(q,ne,g[q.key]&&g[q.key][s.id]),ie=this.proxyToSource[q.key][s.id];ie?ie.push(oe):this.proxyToSource[q.key][s.id]=[oe],v.push(oe)}}}_createProxiedId(s,h,g){let v=this.orthoMatrix;if(g){const b=g.find(A=>A.key===h.tileID.key);if(b)return b}if(h.tileID.key!==s.key){const b=s.canonical.z-h.tileID.canonical.z;let A,I,D;v=l.create();const B=h.tileID.wrap-s.wrap<<s.overscaledZ;b>0?(A=l.EXTENT>>b,I=A*((h.tileID.canonical.x<<b)-s.canonical.x+B),D=A*((h.tileID.canonical.y<<b)-s.canonical.y)):(A=l.EXTENT<<-b,I=l.EXTENT*(h.tileID.canonical.x-(s.canonical.x+B<<-b)),D=l.EXTENT*(h.tileID.canonical.y-(s.canonical.y<<-b))),l.ortho(v,0,A,0,A,0,1),l.translate(v,v,[I,D,0])}return new Yu(h.tileID,s.key,v)}_findTileCoveringTileID(s,h){let g=h.getTile(s);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[h.id],b=v[s.key];if(g=b?h.getTileByID(b):null,g&&g.hasData()||b===null)return g;let A=g?g.tileID:s,I=A.overscaledZ;const D=h.getSource().minzoom,B=[];if(!b){const q=h.getSource().maxzoom;if(s.canonical.z>=q){const Q=s.canonical.z-q;h.getSource().reparseOverscaled?(I=Math.max(s.canonical.z+2,h.transform.tileZoom),A=new l.OverscaledTileID(I,s.wrap,q,s.canonical.x>>Q,s.canonical.y>>Q)):Q!==0&&(I=q,A=new l.OverscaledTileID(I,s.wrap,q,s.canonical.x>>Q,s.canonical.y>>Q))}A.key!==s.key&&(B.push(A.key),g=h.getTile(A))}const L=q=>{B.forEach(Q=>{v[Q]=q}),B.length=0};for(I-=1;I>=D&&(!g||!g.hasData());I--){g&&L(g.tileID.key);const q=A.calculateScaledKey(I);if(g=h.getTileByID(q),g&&g.hasData())break;const Q=v[q];if(Q===null)break;Q===void 0?B.push(q):g=h.getTileByID(Q)}return L(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const s=function(h){let g=0;const v=new l.StructArrayLayout2ui4,b=131;for(let A=1;A<129;A++){for(let I=1;I<129;I++)g=A*b+I,v.emplaceBack(g,g+1),v.emplaceBack(g,g+b),v.emplaceBack(g+1,g+b),A===128&&v.emplaceBack(g+b,g+b+1);v.emplaceBack(g+1,g+1+b)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(s),this.wireframeSegments=l.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class dr{static cacheKey(s,h,g,v){let b=`${h}${v?v.cacheKey:""}`;for(const A of g)s.usedDefines.includes(A)&&(b+=`/${A}`);return b}constructor(s,h,g,v,b,A){const I=s.gl;this.program=I.createProgram();const D=function(Z){const re=[];for(let ue=0;ue<Z.length;ue++){if(Z[ue]===null)continue;const he=Z[ue].split(" ");re.push(he.pop())}return re}(g.staticAttributes),B=v?v.getBinderAttributes():[],L=D.concat(B);let q=v?v.defines():[];q=q.concat(A.map(Z=>`#define ${Z}`));const Q=s.isWebGL2?`#version 300 es
`:"",ne=Q+q.concat(s.extStandardDerivatives&&Q.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(sp):sp,sp,qu,s0.fragmentSource,vl.fragmentSource,g.fragmentSource).join(`
`),oe=Q+q.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,qu,s0.vertexSource,vl.vertexSource,Hu.vertexSource,g.vertexSource).join(`
`),ie=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ie,ne),I.compileShader(ie),I.attachShader(this.program,ie);const ae=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(ae,oe),I.compileShader(ae),I.attachShader(this.program,ae),this.attributes={},this.numAttributes=L.length;for(let Z=0;Z<this.numAttributes;Z++)L[Z]&&(I.bindAttribLocation(this.program,Z,L[Z]),this.attributes[L[Z]]=Z);I.linkProgram(this.program),I.deleteShader(ae),I.deleteShader(ie),this.fixedUniforms=b(s),this.binderUniforms=v?v.getUniforms(s):[],A.includes("TERRAIN")&&(this.terrainUniforms=(Z=>({u_dem:new l.Uniform1i(Z),u_dem_prev:new l.Uniform1i(Z),u_dem_unpack:new l.Uniform4f(Z),u_dem_tl:new l.Uniform2f(Z),u_dem_scale:new l.Uniform1f(Z),u_dem_tl_prev:new l.Uniform2f(Z),u_dem_scale_prev:new l.Uniform1f(Z),u_dem_size:new l.Uniform1f(Z),u_dem_lerp:new l.Uniform1f(Z),u_exaggeration:new l.Uniform1f(Z),u_depth:new l.Uniform1i(Z),u_depth_size_inv:new l.Uniform2f(Z),u_meter_to_dem:new l.Uniform1f(Z),u_label_plane_matrix_inv:new l.UniformMatrix4f(Z)}))(s)),A.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new l.Uniform3f(Z),u_tile_tr_up:new l.Uniform3f(Z),u_tile_br_up:new l.Uniform3f(Z),u_tile_bl_up:new l.Uniform3f(Z),u_tile_up_scale:new l.Uniform1f(Z)}))(s)),A.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new l.UniformMatrix4f(Z),u_fog_range:new l.Uniform2f(Z),u_fog_color:new l.Uniform4f(Z),u_fog_horizon_blend:new l.Uniform1f(Z),u_fog_temporal_offset:new l.Uniform1f(Z),u_frustum_tl:new l.Uniform3f(Z),u_frustum_tr:new l.Uniform3f(Z),u_frustum_br:new l.Uniform3f(Z),u_frustum_bl:new l.Uniform3f(Z),u_globe_pos:new l.Uniform3f(Z),u_globe_radius:new l.Uniform1f(Z),u_globe_transition:new l.Uniform1f(Z),u_is_globe:new l.Uniform1i(Z),u_viewport:new l.Uniform2f(Z)}))(s))}}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(s,h){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in h)g[v].set(this.program,v,h[v])}}draw(s,h,g,v,b,A,I,D,B,L,q,Q,ne,oe,ie){const ae=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(g),s.setStencilMode(v),s.setColorMode(b),s.setCullFace(A);for(const re of Object.keys(this.fixedUniforms))this.fixedUniforms[re].set(this.program,re,I[re]);oe&&oe.setUniforms(this.program,s,this.binderUniforms,Q,{zoom:ne});const Z={[ae.LINES]:2,[ae.TRIANGLES]:3,[ae.LINE_STRIP]:1}[h];for(const re of q.get()){const ue=re.vaos||(re.vaos={});(ue[D]||(ue[D]=new Qv)).bind(s,this,B,oe?oe.getPaintVertexBuffers():[],L,re.vertexOffset,ie||[]),ae.drawElements(h,re.primitiveLength*Z,ae.UNSIGNED_SHORT,re.primitiveOffset*Z*2)}}}function Nc(f,s){const h=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,f.transform.tileZoom)/h,v=g*(s.tileID.canonical.x+s.tileID.wrap*h),b=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_tile_units_to_pixels:1/je(s,1,f.transform.tileZoom),u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const h0=l.create(),mp=(f,s,h,g,v,b,A,I,D,B,L)=>{const q=s.style.light,Q=q.properties.get("position"),ne=[Q.x,Q.y,Q.z],oe=l.create$1();q.properties.get("anchor")==="viewport"&&(l.fromRotation(oe,-s.transform.angle),l.transformMat3(ne,ne,oe));const ie=q.properties.get("color"),ae=s.transform,Z={u_matrix:f,u_lightpos:ne,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ie.r,ie.g,ie.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:h0,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:b};return ae.projection.name==="globe"&&(Z.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],Z.u_zoom_transition=D,Z.u_inv_rot_matrix=L,Z.u_merc_center=B,Z.u_up_dir=ae.projection.upVector(new l.CanonicalTileID(0,0,0),B[0]*l.EXTENT,B[1]*l.EXTENT),Z.u_height_lift=I),Z},d0=(f,s,h,g,v,b,A,I,D,B,L,q)=>{const Q=mp(f,s,h,g,v,b,A,D,B,L,q),ne={u_height_factor:-Math.pow(2,A.overscaledZ)/I.tileSize/8};return l.extend(Q,Nc(s,I),ne)},Ls=f=>({u_matrix:f}),gp=(f,s,h)=>l.extend(Ls(f),Nc(s,h)),Jv=(f,s)=>({u_matrix:f,u_world:s}),ex=(f,s,h,g)=>l.extend(gp(f,s,h),{u_world:g}),tx=l.create(),yp=(f,s,h,g,v,b)=>{const A=f.transform,I=A.projection.name==="globe";let D;if(b.paint.get("circle-pitch-alignment")==="map")if(I){const L=l.globePixelsToTileUnits(A.zoom,s.canonical)*A._pixelsPerMercatorPixel;D=Float32Array.from([L,0,0,L])}else D=A.calculatePixelsToTileUnitsMatrix(h);else D=new Float32Array([A.pixelsToGLUnits[0],0,0,A.pixelsToGLUnits[1]]);const B={u_camera_to_center_distance:A.cameraToCenterDistance,u_matrix:f.translatePosMatrix(s.projMatrix,h,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:l.exported.devicePixelRatio,u_extrude_scale:D,u_inv_rot_matrix:tx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){B.u_inv_rot_matrix=g,B.u_merc_center=v,B.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],B.u_zoom_transition=l.globeToMercatorTransition(A.zoom);const L=v[0]*l.EXTENT,q=v[1]*l.EXTENT;B.u_up_dir=A.projection.upVector(new l.CanonicalTileID(0,0,0),L,q)}return B},_p=f=>{const s=[];return f.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),f.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s},vp=(f,s,h,g)=>{const v=l.EXTENT/h.tileSize;return{u_matrix:f,u_camera_to_center_distance:s.getCameraToCenterDistance(g),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},Qu=(f,s,h=1)=>({u_matrix:f,u_color:s,u_overlay:0,u_overlay_scale:h}),p0=l.create(),f0=(f,s,h,g,v,b,A)=>{const I=f.transform,D=I.projection.name==="globe",B=D?l.globePixelsToTileUnits(I.zoom,s.canonical)*I._pixelsPerMercatorPixel:je(h,1,b),L={u_matrix:s.projMatrix,u_extrude_scale:B,u_intensity:A,u_inv_rot_matrix:p0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){L.u_inv_rot_matrix=g,L.u_merc_center=v,L.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],L.u_zoom_transition=l.globeToMercatorTransition(I.zoom);const q=v[0]*l.EXTENT,Q=v[1]*l.EXTENT;L.u_up_dir=I.projection.upVector(new l.CanonicalTileID(0,0,0),q,Q)}return L},rx=(f,s,h,g,v,b,A)=>{const I=f.transform,D=I.calculatePixelsToTileUnitsMatrix(s);return{u_matrix:xp(f,s,h,g),u_pixels_to_tile_units:D,u_device_pixel_ratio:b,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:jc(h)?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:El(s,f.transform),u_alpha_discard_threshold:0,u_trim_offset:A}},Uc=(f,s,h,g,v)=>{const b=f.transform;return{u_matrix:xp(f,s,h,g),u_texsize:s.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:v,u_image:0,u_tile_units_to_pixels:El(s,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function El(f,s){return 1/je(f,1,s.tileZoom)}function xp(f,s,h,g){return f.translatePosMatrix(g||s.tileID.projMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function jc(f){const s=f.paint.get("line-dasharray").value;return s.value||s.kind!=="constant"}const bp=(f,s,h,g,v,b)=>{return{u_matrix:f,u_tl_parent:s,u_scale_parent:h,u_fade_t:g.mix,u_opacity:g.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(I=v.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(A=v.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:Yo(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var A,I};function Yo(f){f*=Math.PI/180;const s=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const Ju=l.create(),wp=(f,s,h,g,v,b,A,I,D,B,L,q,Q,ne,oe,ie)=>{const ae=v.transform,Z={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:ae.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:ae.width/ae.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:A,u_coord_matrix:I,u_is_text:+D,u_pitch_with_map:+g,u_texsize:B,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ju,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ju,u_up_vector:[0,-1,0]};return ie.name==="globe"&&(Z.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],Z.u_zoom_transition=q,Z.u_inv_rot_matrix=ne,Z.u_merc_center=Q,Z.u_camera_forward=ae._camera.forward(),Z.u_ecef_origin=l.globeECEFOrigin(ae.globeMatrix,L.toUnwrapped()),Z.u_tile_matrix=Float32Array.from(ae.globeMatrix),Z.u_up_vector=oe),Z},eh=(f,s,h,g,v,b,A,I,D,B,L,q,Q,ne,oe,ie,ae)=>l.extend(wp(f,s,h,g,v,b,A,I,D,B,q,Q,ne,oe,ie,ae),{u_gamma_scale:g?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:l.exported.devicePixelRatio,u_is_halo:+L}),m0=(f,s,h,g,v,b,A,I,D,B,L,q,Q,ne,oe,ie)=>l.extend(eh(f,s,h,g,v,b,A,I,!0,D,!0,L,q,Q,ne,oe,ie),{u_texsize_icon:B,u_texture_icon:1}),Ep=(f,s,h)=>({u_matrix:f,u_opacity:s,u_color:h}),nx=(f,s,h,g,v)=>l.extend(function(b,A,I){const D=A.imageManager.getPattern(b.toString()),{width:B,height:L}=A.imageManager.getPixelSize(),q=Math.pow(2,I.tileID.overscaledZ),Q=I.tileSize*Math.pow(2,A.transform.tileZoom)/q,ne=Q*(I.tileID.canonical.x+I.tileID.wrap*q),oe=Q*I.tileID.canonical.y;return{u_image:0,u_pattern_tl:D.tl,u_pattern_br:D.br,u_texsize:[B,L],u_pattern_size:D.displaySize,u_tile_units_to_pixels:1/je(I,1,A.transform.tileZoom),u_pixel_coord_upper:[ne>>16,oe>>16],u_pixel_coord_lower:[65535&ne,65535&oe]}}(g,h,v),{u_matrix:f,u_opacity:s}),Sp={fillExtrusion:f=>({u_matrix:new l.UniformMatrix4f(f),u_lightpos:new l.Uniform3f(f),u_lightintensity:new l.Uniform1f(f),u_lightcolor:new l.Uniform3f(f),u_vertical_gradient:new l.Uniform1f(f),u_opacity:new l.Uniform1f(f),u_edge_radius:new l.Uniform1f(f),u_ao:new l.Uniform2f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_up_dir:new l.Uniform3f(f),u_height_lift:new l.Uniform1f(f)}),fillExtrusionPattern:f=>({u_matrix:new l.UniformMatrix4f(f),u_lightpos:new l.Uniform3f(f),u_lightintensity:new l.Uniform1f(f),u_lightcolor:new l.Uniform3f(f),u_vertical_gradient:new l.Uniform1f(f),u_height_factor:new l.Uniform1f(f),u_edge_radius:new l.Uniform1f(f),u_ao:new l.Uniform2f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_up_dir:new l.Uniform3f(f),u_height_lift:new l.Uniform1f(f),u_image:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_pixel_coord_upper:new l.Uniform2f(f),u_pixel_coord_lower:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f),u_opacity:new l.Uniform1f(f)}),fill:f=>({u_matrix:new l.UniformMatrix4f(f)}),fillPattern:f=>({u_matrix:new l.UniformMatrix4f(f),u_image:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_pixel_coord_upper:new l.Uniform2f(f),u_pixel_coord_lower:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f)}),fillOutline:f=>({u_matrix:new l.UniformMatrix4f(f),u_world:new l.Uniform2f(f)}),fillOutlinePattern:f=>({u_matrix:new l.UniformMatrix4f(f),u_world:new l.Uniform2f(f),u_image:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_pixel_coord_upper:new l.Uniform2f(f),u_pixel_coord_lower:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f)}),circle:f=>({u_camera_to_center_distance:new l.Uniform1f(f),u_extrude_scale:new l.UniformMatrix2f(f),u_device_pixel_ratio:new l.Uniform1f(f),u_matrix:new l.UniformMatrix4f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_up_dir:new l.Uniform3f(f)}),collisionBox:f=>({u_matrix:new l.UniformMatrix4f(f),u_camera_to_center_distance:new l.Uniform1f(f),u_extrude_scale:new l.Uniform2f(f)}),collisionCircle:f=>({u_matrix:new l.UniformMatrix4f(f),u_inv_matrix:new l.UniformMatrix4f(f),u_camera_to_center_distance:new l.Uniform1f(f),u_viewport_size:new l.Uniform2f(f)}),debug:f=>({u_color:new l.UniformColor(f),u_matrix:new l.UniformMatrix4f(f),u_overlay:new l.Uniform1i(f),u_overlay_scale:new l.Uniform1f(f)}),clippingMask:f=>({u_matrix:new l.UniformMatrix4f(f)}),heatmap:f=>({u_extrude_scale:new l.Uniform1f(f),u_intensity:new l.Uniform1f(f),u_matrix:new l.UniformMatrix4f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_up_dir:new l.Uniform3f(f)}),heatmapTexture:f=>({u_image:new l.Uniform1i(f),u_color_ramp:new l.Uniform1i(f),u_opacity:new l.Uniform1f(f)}),hillshade:f=>({u_matrix:new l.UniformMatrix4f(f),u_image:new l.Uniform1i(f),u_latrange:new l.Uniform2f(f),u_light:new l.Uniform2f(f),u_shadow:new l.UniformColor(f),u_highlight:new l.UniformColor(f),u_accent:new l.UniformColor(f)}),hillshadePrepare:f=>({u_matrix:new l.UniformMatrix4f(f),u_image:new l.Uniform1i(f),u_dimension:new l.Uniform2f(f),u_zoom:new l.Uniform1f(f),u_unpack:new l.Uniform4f(f)}),line:f=>({u_matrix:new l.UniformMatrix4f(f),u_pixels_to_tile_units:new l.UniformMatrix2f(f),u_device_pixel_ratio:new l.Uniform1f(f),u_units_to_pixels:new l.Uniform2f(f),u_dash_image:new l.Uniform1i(f),u_gradient_image:new l.Uniform1i(f),u_image_height:new l.Uniform1f(f),u_texsize:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f),u_alpha_discard_threshold:new l.Uniform1f(f),u_trim_offset:new l.Uniform2f(f)}),linePattern:f=>({u_matrix:new l.UniformMatrix4f(f),u_texsize:new l.Uniform2f(f),u_pixels_to_tile_units:new l.UniformMatrix2f(f),u_device_pixel_ratio:new l.Uniform1f(f),u_image:new l.Uniform1i(f),u_units_to_pixels:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f),u_alpha_discard_threshold:new l.Uniform1f(f)}),raster:f=>({u_matrix:new l.UniformMatrix4f(f),u_tl_parent:new l.Uniform2f(f),u_scale_parent:new l.Uniform1f(f),u_fade_t:new l.Uniform1f(f),u_opacity:new l.Uniform1f(f),u_image0:new l.Uniform1i(f),u_image1:new l.Uniform1i(f),u_brightness_low:new l.Uniform1f(f),u_brightness_high:new l.Uniform1f(f),u_saturation_factor:new l.Uniform1f(f),u_contrast_factor:new l.Uniform1f(f),u_spin_weights:new l.Uniform3f(f),u_perspective_transform:new l.Uniform2f(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new l.Uniform1i(f),u_is_size_feature_constant:new l.Uniform1i(f),u_size_t:new l.Uniform1f(f),u_size:new l.Uniform1f(f),u_camera_to_center_distance:new l.Uniform1f(f),u_rotate_symbol:new l.Uniform1i(f),u_aspect_ratio:new l.Uniform1f(f),u_fade_change:new l.Uniform1f(f),u_matrix:new l.UniformMatrix4f(f),u_label_plane_matrix:new l.UniformMatrix4f(f),u_coord_matrix:new l.UniformMatrix4f(f),u_is_text:new l.Uniform1i(f),u_pitch_with_map:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_camera_forward:new l.Uniform3f(f),u_tile_matrix:new l.UniformMatrix4f(f),u_up_vector:new l.Uniform3f(f),u_ecef_origin:new l.Uniform3f(f),u_texture:new l.Uniform1i(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new l.Uniform1i(f),u_is_size_feature_constant:new l.Uniform1i(f),u_size_t:new l.Uniform1f(f),u_size:new l.Uniform1f(f),u_camera_to_center_distance:new l.Uniform1f(f),u_rotate_symbol:new l.Uniform1i(f),u_aspect_ratio:new l.Uniform1f(f),u_fade_change:new l.Uniform1f(f),u_matrix:new l.UniformMatrix4f(f),u_label_plane_matrix:new l.UniformMatrix4f(f),u_coord_matrix:new l.UniformMatrix4f(f),u_is_text:new l.Uniform1i(f),u_pitch_with_map:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_texture:new l.Uniform1i(f),u_gamma_scale:new l.Uniform1f(f),u_device_pixel_ratio:new l.Uniform1f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_camera_forward:new l.Uniform3f(f),u_tile_matrix:new l.UniformMatrix4f(f),u_up_vector:new l.Uniform3f(f),u_ecef_origin:new l.Uniform3f(f),u_is_halo:new l.Uniform1i(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new l.Uniform1i(f),u_is_size_feature_constant:new l.Uniform1i(f),u_size_t:new l.Uniform1f(f),u_size:new l.Uniform1f(f),u_camera_to_center_distance:new l.Uniform1f(f),u_rotate_symbol:new l.Uniform1i(f),u_aspect_ratio:new l.Uniform1f(f),u_fade_change:new l.Uniform1f(f),u_matrix:new l.UniformMatrix4f(f),u_label_plane_matrix:new l.UniformMatrix4f(f),u_coord_matrix:new l.UniformMatrix4f(f),u_is_text:new l.Uniform1i(f),u_pitch_with_map:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_texsize_icon:new l.Uniform2f(f),u_texture:new l.Uniform1i(f),u_texture_icon:new l.Uniform1i(f),u_gamma_scale:new l.Uniform1f(f),u_device_pixel_ratio:new l.Uniform1f(f),u_is_halo:new l.Uniform1i(f)}),background:f=>({u_matrix:new l.UniformMatrix4f(f),u_opacity:new l.Uniform1f(f),u_color:new l.UniformColor(f)}),backgroundPattern:f=>({u_matrix:new l.UniformMatrix4f(f),u_opacity:new l.Uniform1f(f),u_image:new l.Uniform1i(f),u_pattern_tl:new l.Uniform2f(f),u_pattern_br:new l.Uniform2f(f),u_texsize:new l.Uniform2f(f),u_pattern_size:new l.Uniform2f(f),u_pixel_coord_upper:new l.Uniform2f(f),u_pixel_coord_lower:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f)}),terrainRaster:hp,terrainDepth:hp,skybox:f=>({u_matrix:new l.UniformMatrix4f(f),u_sun_direction:new l.Uniform3f(f),u_cubemap:new l.Uniform1i(f),u_opacity:new l.Uniform1f(f),u_temporal_offset:new l.Uniform1f(f)}),skyboxGradient:f=>({u_matrix:new l.UniformMatrix4f(f),u_color_ramp:new l.Uniform1i(f),u_center_direction:new l.Uniform3f(f),u_radius:new l.Uniform1f(f),u_opacity:new l.Uniform1f(f),u_temporal_offset:new l.Uniform1f(f)}),skyboxCapture:f=>({u_matrix_3f:new l.UniformMatrix3f(f),u_sun_direction:new l.Uniform3f(f),u_sun_intensity:new l.Uniform1f(f),u_color_tint_r:new l.Uniform4f(f),u_color_tint_m:new l.Uniform4f(f),u_luminance:new l.Uniform1f(f)}),globeRaster:f=>({u_proj_matrix:new l.UniformMatrix4f(f),u_globe_matrix:new l.UniformMatrix4f(f),u_normalize_matrix:new l.UniformMatrix4f(f),u_merc_matrix:new l.UniformMatrix4f(f),u_zoom_transition:new l.Uniform1f(f),u_merc_center:new l.Uniform2f(f),u_image0:new l.Uniform1i(f),u_grid_matrix:new l.UniformMatrix3f(f),u_skirt_height:new l.Uniform1f(f),u_frustum_tl:new l.Uniform3f(f),u_frustum_tr:new l.Uniform3f(f),u_frustum_br:new l.Uniform3f(f),u_frustum_bl:new l.Uniform3f(f),u_globe_pos:new l.Uniform3f(f),u_globe_radius:new l.Uniform1f(f),u_viewport:new l.Uniform2f(f)}),globeAtmosphere:f=>({u_frustum_tl:new l.Uniform3f(f),u_frustum_tr:new l.Uniform3f(f),u_frustum_br:new l.Uniform3f(f),u_frustum_bl:new l.Uniform3f(f),u_horizon:new l.Uniform1f(f),u_transition:new l.Uniform1f(f),u_fadeout_range:new l.Uniform1f(f),u_color:new l.Uniform4f(f),u_high_color:new l.Uniform4f(f),u_space_color:new l.Uniform4f(f),u_star_intensity:new l.Uniform1f(f),u_star_density:new l.Uniform1f(f),u_star_size:new l.Uniform1f(f),u_temporal_offset:new l.Uniform1f(f),u_horizon_angle:new l.Uniform1f(f),u_rotation_matrix:new l.UniformMatrix4f(f)})};let th;function Vc(f,s,h,g,v,b,A){const I=f.context,D=I.gl,B=f.transform,L=f.useProgram("collisionBox"),q=[];let Q=0,ne=0;for(let he=0;he<g.length;he++){const be=g[he],Se=s.getTile(be),we=Se.getBucket(h);if(!we)continue;const Ce=ro(be,we,B);let Ie=Ce;v[0]===0&&v[1]===0||(Ie=f.translatePosMatrix(Ce,Se,v,b));const Re=A?we.textCollisionBox:we.iconCollisionBox,st=we.collisionCircleArray;if(st.length>0){const De=l.create(),Ke=Ie;l.mul(De,we.placementInvProjMatrix,B.glCoordMatrix),l.mul(De,De,we.placementViewportMatrix),q.push({circleArray:st,circleOffset:ne,transform:Ke,invTransform:De,projection:we.getProjection()}),Q+=st.length/4,ne=Q}Re&&(f.terrain&&f.terrain.setupElevationDraw(Se,L),L.draw(I,D.LINES,l.DepthMode.disabled,l.StencilMode.disabled,f.colorModeForRenderPass(),l.CullFaceMode.disabled,vp(Ie,B,Se,we.getProjection()),h.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,B.zoom,null,[Re.collisionVertexBuffer,Re.collisionVertexBufferExt]))}if(!A||!q.length)return;const oe=f.useProgram("collisionCircle"),ie=new l.StructArrayLayout2f1f2i16;ie.resize(4*Q),ie._trim();let ae=0;for(const he of q)for(let be=0;be<he.circleArray.length/4;be++){const Se=4*be,we=he.circleArray[Se+0],Ce=he.circleArray[Se+1],Ie=he.circleArray[Se+2],Re=he.circleArray[Se+3];ie.emplace(ae++,we,Ce,Ie,Re,0),ie.emplace(ae++,we,Ce,Ie,Re,1),ie.emplace(ae++,we,Ce,Ie,Re,2),ie.emplace(ae++,we,Ce,Ie,Re,3)}(!th||th.length<2*Q)&&(th=function(he){const be=2*he,Se=new l.StructArrayLayout3ui6;Se.resize(be),Se._trim();for(let we=0;we<be;we++){const Ce=6*we;Se.uint16[Ce+0]=4*we+0,Se.uint16[Ce+1]=4*we+1,Se.uint16[Ce+2]=4*we+2,Se.uint16[Ce+3]=4*we+2,Se.uint16[Ce+4]=4*we+3,Se.uint16[Ce+5]=4*we+0}return Se}(Q));const Z=I.createIndexBuffer(th,!0),re=I.createVertexBuffer(ie,l.collisionCircleLayout.members,!0);for(const he of q){const be={u_matrix:he.transform,u_inv_matrix:he.invTransform,u_camera_to_center_distance:(ue=B).getCameraToCenterDistance(he.projection),u_viewport_size:[ue.width,ue.height]};oe.draw(I,D.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,f.colorModeForRenderPass(),l.CullFaceMode.disabled,be,h.id,re,Z,l.SegmentVector.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,B.zoom)}var ue;re.destroy(),Z.destroy()}const g0=l.create();function Tp({width:f,height:s,anchor:h,textOffset:g,textScale:v},b){const{horizontalAlign:A,verticalAlign:I}=l.getAnchorAlignment(h),D=-(A-.5)*f,B=-(I-.5)*s,L=l.evaluateVariableOffset(h,g);return new l.Point((D/v+L[0])*b,(B/v+L[1])*b)}function ix(f,s,h,g,v,b,A,I,D,B,L){const q=f.text.placedSymbolArray,Q=f.text.dynamicLayoutVertexArray,ne=f.icon.dynamicLayoutVertexArray,oe={},ie=f.getProjection(),ae=Xr(I,ie,b),Z=b.elevation,re=ie.upVectorScale(I.canonical,b.center.lat,b.worldSize).metersToTile;Q.clear();for(let ue=0;ue<q.length;ue++){const he=q.get(ue),{tileAnchorX:be,tileAnchorY:Se,numGlyphs:we}=he,Ce=he.hidden||!he.crossTileID||f.allowVerticalPlacement&&!he.placedOrientation?null:g[he.crossTileID];if(Ce){let Ie=0,Re=0,st=0;if(Z){const ht=Z?Z.getAtTileOffset(I,be,Se):0,[Mt,$t,At]=ie.upVector(I.canonical,be,Se);Ie=ht*Mt*re,Re=ht*$t*re,st=ht*At*re}let[De,Ke,Ne,at]=$n(he.projectedAnchorX+Ie,he.projectedAnchorY+Re,he.projectedAnchorZ+st,h?ae:A);const ze=r0(b.getCameraToCenterDistance(ie),at);let Ze=v.evaluateSizeForFeature(f.textSizeData,B,he)*ze/l.ONE_EM;h&&(Ze*=f.tilePixelRatio/D);const ut=Tp(Ce,Ze);h?({x:De,y:Ke,z:Ne}=ie.projectTilePoint(be+ut.x,Se+ut.y,I.canonical),[De,Ke,Ne]=$n(De+Ie,Ke+Re,Ne+st,A)):(s&&ut._rotate(-b.angle),De+=ut.x,Ke+=ut.y,Ne=0);const tt=f.allowVerticalPlacement&&he.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let ht=0;ht<we;ht++)l.addDynamicAttributes(Q,De,Ke,Ne,tt);L&&he.associatedIconIndex>=0&&(oe[he.associatedIconIndex]={x:De,y:Ke,z:Ne,angle:tt})}else Ao(we,Q)}if(L){ne.clear();const ue=f.icon.placedSymbolArray;for(let he=0;he<ue.length;he++){const be=ue.get(he),{numGlyphs:Se}=be,we=oe[he];if(be.hidden||!we)Ao(Se,ne);else{const{x:Ce,y:Ie,z:Re,angle:st}=we;for(let De=0;De<Se;De++)l.addDynamicAttributes(ne,Ce,Ie,Re,st)}}f.icon.dynamicLayoutVertexBuffer.updateData(ne)}f.text.dynamicLayoutVertexBuffer.updateData(Q)}function Ap(f,s,h){return h.iconsInText&&s?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function y0(f,s,h,g,v,b,A,I,D,B,L,q){const Q=f.context,ne=Q.gl,oe=f.transform,ie=I==="map",ae=D==="map",Z=ie&&h.layout.get("symbol-placement")!=="point",re=ie&&!ae&&!Z,ue=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let he=!1;const be=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),Se=[l.mercatorXfromLng(oe.center.lng),l.mercatorYfromLat(oe.center.lat)],we=h.layout.get("text-variable-anchor"),Ce=oe.projection.name==="globe",Ie=[],Re=[0,-1,0];let st=Re;!Ce&&!oe.mercatorFromTransition||ie||(st=function(De){const Ke=De._camera.getWorldToCamera(De.worldSize,1),Ne=l.multiply([],Ke,De.globeMatrix);l.invert(Ne,Ne);const at=[0,0,0],ze=[0,1,0,0];return l.transformMat4$1(ze,ze,Ne),at[0]=ze[0],at[1]=ze[1],at[2]=ze[2],l.normalize(at,at),at}(oe));for(const De of g){const Ke=s.getTile(De),Ne=Ke.getBucket(h);if(!Ne||Ne.projection.name==="mercator"&&Ce)continue;const at=v?Ne.text:Ne.icon;if(!at||Ne.fullyClipped||!at.segments.get().length)continue;const ze=at.programConfigurations.get(h.id),Ze=v||Ne.sdfIcons,ut=v?Ne.textSizeData:Ne.iconSizeData,tt=ae||oe.pitch!==0,ht=l.evaluateSizeForZoom(ut,oe.zoom);let Mt,$t,At,Lt,nr=[0,0],er=null;if(v)$t=Ke.glyphAtlasTexture,At=ne.LINEAR,Mt=Ke.glyphAtlasTexture.size,Ne.iconsInText&&(nr=Ke.imageAtlasTexture.size,er=Ke.imageAtlasTexture,Lt=tt||f.options.rotating||f.options.zooming||ut.kind==="composite"||ut.kind==="camera"?ne.LINEAR:ne.NEAREST);else{const Ca=h.layout.get("icon-size").constantOr(0)!==1||Ne.iconsNeedLinear;$t=Ke.imageAtlasTexture,At=Ze||f.options.rotating||f.options.zooming||Ca||tt?ne.LINEAR:ne.NEAREST,Mt=Ke.imageAtlasTexture.size}const Pt=Ne.projection.name==="globe",Ar=Pt?st:Re,Mr=Pt?l.globeToMercatorTransition(oe.zoom):0,zr=Xr(De,Ne.getProjection(),oe),Rr=oe.calculatePixelsToTileUnitsMatrix(Ke),ui=Ge(zr,Ke.tileID.canonical,ae,ie,oe,Ne.getProjection(),Rr),Gn=f.terrain&&ae&&Z?l.invert(l.create(),ui):g0,ao=_n(zr,Ke.tileID.canonical,ae,ie,oe,Ne.getProjection(),Rr),Jo=we&&Ne.hasTextData(),Yr=h.layout.get("icon-text-fit")!=="none"&&Jo&&Ne.hasIconData();if(Z){const Ca=oe.elevation,rs=Ca?Ca.getAtTileOffsetFunc(De,oe.center.lat,oe.worldSize,Ne.getProjection()):null,Vs=xa(zr,Ke.tileID.canonical,ae,ie,oe,Ne.getProjection(),Rr);Qd(Ne,zr,f,v,Vs,ao,ae,B,rs,De)}const Or=Z||v&&we||Yr,gr=f.translatePosMatrix(zr,Ke,b,A),vn=Or?g0:ui,vi=f.translatePosMatrix(ao,Ke,b,A,!0),Zr=Ne.getProjection().createInversionMatrix(oe,De.canonical),Pi=[];f.terrainRenderModeElevated()&&ae&&Pi.push("PITCH_WITH_MAP_TERRAIN"),Pt&&Pi.push("PROJECTION_GLOBE_VIEW"),Or&&Pi.push("PROJECTED_POS_ON_VIEWPORT");const yh=Ze&&h.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let js;js=Ze?Ne.iconsInText?m0(ut.kind,ht,re,ae,f,gr,vn,vi,Mt,nr,De,Mr,Se,Zr,Ar,Ne.getProjection()):eh(ut.kind,ht,re,ae,f,gr,vn,vi,v,Mt,!0,De,Mr,Se,Zr,Ar,Ne.getProjection()):wp(ut.kind,ht,re,ae,f,gr,vn,vi,v,Mt,De,Mr,Se,Zr,Ar,Ne.getProjection());const Jc={program:f.useProgram(Ap(Ze,v,Ne),ze,Pi),buffers:at,uniformValues:js,atlasTexture:$t,atlasTextureIcon:er,atlasInterpolation:At,atlasInterpolationIcon:Lt,isSDF:Ze,hasHalo:yh,tile:Ke,labelPlaneMatrixInv:Gn};if(ue&&Ne.canOverlap){he=!0;const Ca=at.segments.get();for(const rs of Ca)Ie.push({segments:new l.SegmentVector([rs]),sortKey:rs.sortKey,state:Jc})}else Ie.push({segments:at.segments,sortKey:0,state:Jc})}he&&Ie.sort((De,Ke)=>De.sortKey-Ke.sortKey);for(const De of Ie){const Ke=De.state;if(f.terrain&&f.terrain.setupElevationDraw(Ke.tile,Ke.program,{useDepthForOcclusion:!Ce,labelPlaneMatrixInv:Ke.labelPlaneMatrixInv}),Q.activeTexture.set(ne.TEXTURE0),Ke.atlasTexture.bind(Ke.atlasInterpolation,ne.CLAMP_TO_EDGE),Ke.atlasTextureIcon&&(Q.activeTexture.set(ne.TEXTURE1),Ke.atlasTextureIcon&&Ke.atlasTextureIcon.bind(Ke.atlasInterpolationIcon,ne.CLAMP_TO_EDGE)),Ke.isSDF){const Ne=Ke.uniformValues;Ke.hasHalo&&(Ne.u_is_halo=1,$c(Ke.buffers,De.segments,h,f,Ke.program,be,L,q,Ne)),Ne.u_is_halo=0}$c(Ke.buffers,De.segments,h,f,Ke.program,be,L,q,Ke.uniformValues)}}function $c(f,s,h,g,v,b,A,I,D){const B=g.context,L=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer];v.draw(B,B.gl.TRIANGLES,b,A,I,l.CullFaceMode.disabled,D,h.id,f.layoutVertexBuffer,f.indexBuffer,s,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),L)}function _0(f,s,h,g,v,b,A){const I=f.context.gl,D=h.paint.get("fill-pattern"),B=D&&D.constantOr(1);let L,q,Q,ne,oe;A?(q=B&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=I.LINES):(q=B?"fillPattern":"fill",L=I.TRIANGLES);for(const ie of g){const ae=s.getTile(ie);if(B&&!ae.patternsLoaded())continue;const Z=ae.getBucket(h);if(!Z)continue;f.prepareDrawTile();const re=Z.programConfigurations.get(h.id),ue=f.useProgram(q,re);B&&(f.context.activeTexture.set(I.TEXTURE0),ae.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),re.updatePaintBuffers());const he=D.constantOr(null);if(he&&ae.imageAtlas){const Se=ae.imageAtlas.patternPositions[he.toString()];Se&&re.setConstantPatternPositions(Se)}const be=f.translatePosMatrix(ie.projMatrix,ae,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(A){ne=Z.indexBuffer2,oe=Z.segments2;const Se=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];Q=q==="fillOutlinePattern"&&B?ex(be,f,ae,Se):Jv(be,Se)}else ne=Z.indexBuffer,oe=Z.segments,Q=B?gp(be,f,ae):Ls(be);f.prepareDrawProgram(f.context,ue,ie.toUnwrapped()),ue.draw(f.context,L,v,f.stencilModeForClipping(ie),b,l.CullFaceMode.disabled,Q,h.id,Z.layoutVertexBuffer,ne,oe,h.paint,f.transform.zoom,re)}}function rh(f,s,h,g,v,b,A){const I=f.context,D=I.gl,B=f.transform,L=h.paint.get("fill-extrusion-pattern"),q=L.constantOr(1),Q=h.paint.get("fill-extrusion-opacity"),ne=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],oe=h.layout.get("fill-extrusion-edge-radius"),ie=oe>0&&!h.paint.get("fill-extrusion-rounded-roof"),ae=ie?0:oe,Z=B.projection.name==="globe"?l.fillExtrusionHeightLift():0,re=B.projection.name==="globe",ue=re?l.globeToMercatorTransition(B.zoom):0,he=[l.mercatorXfromLng(B.center.lng),l.mercatorYfromLat(B.center.lat)],be=[];re&&be.push("PROJECTION_GLOBE_VIEW"),ne[0]>0&&be.push("FAUX_AO"),ie&&be.push("ZERO_ROOF_RADIUS");for(const Se of g){const we=s.getTile(Se),Ce=we.getBucket(h);if(!Ce||Ce.projection.name!==B.projection.name)continue;const Ie=Ce.programConfigurations.get(h.id),Re=f.useProgram(q?"fillExtrusionPattern":"fillExtrusion",Ie,be);if(f.terrain){const Ze=f.terrain;if(f.style.terrainSetForDrapingOnly())Ze.setupElevationDraw(we,Re,{useMeterToDem:!0});else{if(!Ce.enableTerrain)continue;if(Ze.setupElevationDraw(we,Re,{useMeterToDem:!0}),v0(I,s,Se,Ce,h,Ze),!Ce.centroidVertexBuffer){const ut=Re.attributes.a_centroid_pos;ut!==void 0&&D.vertexAttrib2f(ut,0,0)}}}q&&(f.context.activeTexture.set(D.TEXTURE0),we.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Ie.updatePaintBuffers());const st=L.constantOr(null);if(st&&we.imageAtlas){const Ze=we.imageAtlas.patternPositions[st.toString()];Ze&&Ie.setConstantPatternPositions(Ze)}const De=f.translatePosMatrix(Se.projMatrix,we,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ke=B.projection.createInversionMatrix(B,Se.canonical),Ne=h.paint.get("fill-extrusion-vertical-gradient"),at=q?d0(De,f,Ne,Q,ne,ae,Se,we,Z,ue,he,Ke):mp(De,f,Ne,Q,ne,ae,Se,Z,ue,he,Ke);f.prepareDrawProgram(I,Re,Se.toUnwrapped());const ze=[];f.terrain&&ze.push(Ce.centroidVertexBuffer),re&&ze.push(Ce.layoutVertexExtBuffer),Re.draw(I,I.gl.TRIANGLES,v,b,A,l.CullFaceMode.backCCW,at,h.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,h.paint,f.transform.zoom,Ie,ze)}}function v0(f,s,h,g,v,b){const A=[Z=>{let re=Z.canonical.x-1,ue=Z.wrap;return re<0&&(re=(1<<Z.canonical.z)-1,ue--),new l.OverscaledTileID(Z.overscaledZ,ue,Z.canonical.z,re,Z.canonical.y)},Z=>{let re=Z.canonical.x+1,ue=Z.wrap;return re===1<<Z.canonical.z&&(re=0,ue++),new l.OverscaledTileID(Z.overscaledZ,ue,Z.canonical.z,re,Z.canonical.y)},Z=>new l.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,(Z.canonical.y===0?1<<Z.canonical.z:Z.canonical.y)-1),Z=>new l.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y===(1<<Z.canonical.z)-1?0:Z.canonical.y+1)],I=Z=>{const re=s.getSource().minzoom,ue=be=>{const Se=s.getTileByID(be);if(Se&&Se.hasData())return Se.getBucket(v)},he=[0,-1,1];for(const be of he){if(Z.overscaledZ+be<re)continue;const Se=ue(Z.calculateScaledKey(Z.overscaledZ+be));if(Se)return Se}},D=[0,0,0],B=(Z,re)=>(D[0]=Math.min(Z.min.y,re.min.y),D[1]=Math.max(Z.max.y,re.max.y),D[2]=l.EXTENT-re.min.x>Z.max.x?re.min.x-l.EXTENT:Z.max.x,D),L=(Z,re)=>(D[0]=Math.min(Z.min.x,re.min.x),D[1]=Math.max(Z.max.x,re.max.x),D[2]=l.EXTENT-re.min.y>Z.max.y?re.min.y-l.EXTENT:Z.max.y,D),q=[(Z,re)=>B(Z,re),(Z,re)=>B(re,Z),(Z,re)=>L(Z,re),(Z,re)=>L(re,Z)],Q=new l.Point(0,0);let ne,oe,ie;const ae=(Z,re,ue,he,be)=>{const Se=[[he?ue:Z,he?Z:ue,0],[he?ue:re,he?re:ue,0]],we=be<0?l.EXTENT+be:be,Ce=[he?we:(Z+re)/2,he?(Z+re)/2:we,0];return ue===0&&be<0||ue!==0&&be>0?b.getForTilePoints(ie,[Ce],!0,oe):Se.push(Ce),b.getForTilePoints(h,Se,!0,ne),Math.max(Se[0][2],Se[1][2],Ce[2])/b.exaggeration()};for(let Z=0;Z<4;Z++){const re=(Z<2?1:5)-Z,ue=g.borders[Z];if(ue.length===0)continue;const he=ie=A[Z](h),be=I(he);if(!(be&&be instanceof l.FillExtrusionBucket&&be.enableTerrain)||g.borderDoneWithNeighborZ[Z]===be.canonical.z&&be.borderDoneWithNeighborZ[re]===g.canonical.z||(oe=b.findDEMTileFor(he),!oe||!oe.dem))continue;if(!ne){const Ie=b.findDEMTileFor(h);if(!Ie||!Ie.dem)return;ne=Ie}const Se=be.borders[re];let we=0;const Ce=be.borderDoneWithNeighborZ[re]!==g.canonical.z;if(g.canonical.z===be.canonical.z){for(let Ie=0;Ie<ue.length;Ie++){const Re=g.featuresOnBorder[ue[Ie]],st=Re.borders[Z];let De;for(;we<Se.length&&(De=be.featuresOnBorder[Se[we]],!(De.borders[re][1]>st[0]+3));)Ce&&be.encodeCentroid(void 0,De,!1),we++;if(De&&we<Se.length){const Ke=we;let Ne=0;for(;!(De.borders[re][0]>st[1]-3)&&(Ne++,++we!==Se.length);)De=be.featuresOnBorder[Se[we]];if(De=be.featuresOnBorder[Se[Ke]],Re.intersectsCount()>1||De.intersectsCount()>1||Ne!==1){Ne!==1&&(we=Ke),g.encodeCentroid(void 0,Re,!1),Ce&&be.encodeCentroid(void 0,De,!1);continue}const at=q[Z](Re,De),ze=Z%2?l.EXTENT-1:0;Q.x=ae(at[0],Math.min(l.EXTENT-1,at[1]),ze,Z<2,at[2]),Q.y=0,g.encodeCentroid(Q,Re,!1),Ce&&be.encodeCentroid(Q,De,!1)}else g.encodeCentroid(void 0,Re,!1)}g.borderDoneWithNeighborZ[Z]=be.canonical.z,g.needsCentroidUpdate=!0,Ce&&(be.borderDoneWithNeighborZ[re]=g.canonical.z,be.needsCentroidUpdate=!0)}else{for(const Ie of ue)g.encodeCentroid(void 0,g.featuresOnBorder[Ie],!1);if(Ce){for(const Ie of Se)be.encodeCentroid(void 0,be.featuresOnBorder[Ie],!1);be.borderDoneWithNeighborZ[re]=g.canonical.z,be.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[Z]=be.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(f)}const Sl=new l.Color(1,0,0,1),ox=new l.Color(0,1,0,1),ax=new l.Color(0,0,1,1),sx=new l.Color(1,0,1,1),lx=new l.Color(0,1,1,1);function cx(f,s,h){const g=f.context,v=f.transform,b=g.gl,A=v.projection.name==="globe",I=A?["PROJECTION_GLOBE_VIEW"]:null;let D=h.projMatrix;if(A&&l.globeToMercatorTransition(v.zoom)>0){const Re=l.transitionTileAABBinECEF(h.canonical,v),st=l.globeDenormalizeECEF(Re);D=l.multiply(new Float32Array(16),v.globeMatrix,st),l.multiply(D,v.projMatrix,D)}const B=f.useProgram("debug",null,I),L=s.getTileByID(h.key);f.terrain&&f.terrain.setupElevationDraw(L,B);const q=l.DepthMode.disabled,Q=l.StencilMode.disabled,ne=f.colorModeForRenderPass(),oe="$debug";g.activeTexture.set(b.TEXTURE0),f.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),A?L._makeGlobeTileDebugBuffers(f.context,v):L._makeDebugTileBoundsBuffers(f.context,v.projection);const ie=L._tileDebugBuffer||f.debugBuffer,ae=L._tileDebugIndexBuffer||f.debugIndexBuffer,Z=L._tileDebugSegments||f.debugSegments;B.draw(g,b.LINE_STRIP,q,Q,ne,l.CullFaceMode.disabled,Qu(D,l.Color.red),oe,ie,ae,Z,null,null,null,[L._globeTileDebugBorderBuffer]);const re=L.latestRawTileData,ue=Math.floor((re&&re.byteLength||0)/1024),he=s.getTile(h).tileSize,be=512/Math.min(he,512)*(h.overscaledZ/v.zoom)*.5;let Se=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Se+=` => ${h.overscaledZ}`),Se+=` ${ue}kb`,function(Re,st){Re.initDebugOverlayCanvas();const De=Re.debugOverlayCanvas,Ke=Re.context.gl,Ne=Re.debugOverlayCanvas.getContext("2d");Ne.clearRect(0,0,De.width,De.height),Ne.shadowColor="white",Ne.shadowBlur=2,Ne.lineWidth=1.5,Ne.strokeStyle="white",Ne.textBaseline="top",Ne.font="bold 36px Open Sans, sans-serif",Ne.fillText(st,5,5),Ne.strokeText(st,5,5),Re.debugOverlayTexture.update(De),Re.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(f,Se);const we=L._tileDebugTextBuffer||f.debugBuffer,Ce=L._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Ie=L._tileDebugTextSegments||f.debugSegments;B.draw(g,b.TRIANGLES,q,Q,l.ColorMode.alphaBlended,l.CullFaceMode.disabled,Qu(D,l.Color.transparent,be),oe,we,Ce,Ie,null,null,null,[L._globeTileDebugTextBuffer])}function x0(f,s,h,g){Tl(f,0,s+h/2,f.transform.width,h,g)}function nh(f,s,h,g){Tl(f,s-h/2,0,h,f.transform.height,g)}function Tl(f,s,h,g,v,b){const A=f.context,I=A.gl;I.enable(I.SCISSOR_TEST),I.scissor(s*l.exported.devicePixelRatio,h*l.exported.devicePixelRatio,g*l.exported.devicePixelRatio,v*l.exported.devicePixelRatio),A.clear({color:b}),I.disable(I.SCISSOR_TEST)}const b0=l.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:w0}=b0;function Aa(f,s,h,g){f.emplaceBack(s,h,g)}class ih{constructor(s){this.vertexArray=new l.StructArrayLayout3f12,this.indices=new l.StructArrayLayout3ui6,Aa(this.vertexArray,-1,-1,1),Aa(this.vertexArray,1,-1,1),Aa(this.vertexArray,-1,1,1),Aa(this.vertexArray,1,1,1),Aa(this.vertexArray,-1,-1,-1),Aa(this.vertexArray,1,-1,-1),Aa(this.vertexArray,-1,1,-1),Aa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,w0),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=l.SegmentVector.simpleSegment(0,0,36,12)}}function io(f,s,h,g,v,b){const A=f.gl,I=s.paint.get("sky-atmosphere-color"),D=s.paint.get("sky-atmosphere-halo-color"),B=s.paint.get("sky-atmosphere-sun-intensity"),L=((q,Q,ne,oe,ie)=>({u_matrix_3f:q,u_sun_direction:Q,u_sun_intensity:ne,u_color_tint_r:[oe.r,oe.g,oe.b,oe.a],u_color_tint_m:[ie.r,ie.g,ie.b,ie.a],u_luminance:5e-5}))(l.fromMat4(l.create$1(),g),v,B,I,D);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+b,s.skyboxTexture,0),h.draw(f,A.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.frontCW,L,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const Wc=l.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class E0{constructor(s){const h=new l.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const g=new l.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(h,Wc.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=l.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Bs={symbol:function(f,s,h,g,v){if(f.renderPass!=="translucent")return;const b=l.StencilMode.disabled,A=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(I,D,B,L,q,Q,ne){const oe=D.transform,ie=q==="map",ae=Q==="map";for(const Z of I){const re=L.getTile(Z),ue=re.getBucket(B);if(!ue||!ue.text||!ue.text.segments.get().length)continue;const he=l.evaluateSizeForZoom(ue.textSizeData,oe.zoom),be=Xr(Z,ue.getProjection(),oe),Se=oe.calculatePixelsToTileUnitsMatrix(re),we=Ge(be,re.tileID.canonical,ae,ie,oe,ue.getProjection(),Se),Ce=B.layout.get("icon-text-fit")!=="none"&&ue.hasIconData();if(he){const Ie=Math.pow(2,oe.zoom-re.tileID.overscaledZ);ix(ue,ie,ae,ne,l.symbolSize,oe,we,Z,Ie,he,Ce)}}}(g,f,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v),h.paint.get("icon-opacity").constantOr(1)!==0&&y0(f,s,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),b,A),h.paint.get("text-opacity").constantOr(1)!==0&&y0(f,s,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),b,A),s.map.showCollisionBoxes&&(Vc(f,s,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Vc(f,s,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(f,s,h,g){if(f.renderPass!=="translucent")return;const v=h.paint.get("circle-opacity"),b=h.paint.get("circle-stroke-width"),A=h.paint.get("circle-stroke-opacity"),I=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(v.constantOr(1)===0&&(b.constantOr(1)===0||A.constantOr(1)===0))return;const D=f.context,B=D.gl,L=f.transform,q=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),Q=l.StencilMode.disabled,ne=f.colorModeForRenderPass(),oe=L.projection.name==="globe",ie=[l.mercatorXfromLng(L.center.lng),l.mercatorYfromLat(L.center.lat)],ae=[];for(let re=0;re<g.length;re++){const ue=g[re],he=s.getTile(ue),be=he.getBucket(h);if(!be||be.projection.name!==L.projection.name)continue;const Se=be.programConfigurations.get(h.id),we=_p(h);oe&&we.push("PROJECTION_GLOBE_VIEW");const Ce=f.useProgram("circle",Se,we),Ie=be.layoutVertexBuffer,Re=be.globeExtVertexBuffer,st=be.indexBuffer,De=L.projection.createInversionMatrix(L,ue.canonical),Ke={programConfiguration:Se,program:Ce,layoutVertexBuffer:Ie,globeExtVertexBuffer:Re,indexBuffer:st,uniformValues:yp(f,ue,he,De,ie,h),tile:he};if(I){const Ne=be.segments.get();for(const at of Ne)ae.push({segments:new l.SegmentVector([at]),sortKey:at.sortKey,state:Ke})}else ae.push({segments:be.segments,sortKey:0,state:Ke})}I&&ae.sort((re,ue)=>re.sortKey-ue.sortKey);const Z={useDepthForOcclusion:!oe};for(const re of ae){const{programConfiguration:ue,program:he,layoutVertexBuffer:be,globeExtVertexBuffer:Se,indexBuffer:we,uniformValues:Ce,tile:Ie}=re.state,Re=re.segments;f.terrain&&f.terrain.setupElevationDraw(Ie,he,Z),f.prepareDrawProgram(D,he,Ie.tileID.toUnwrapped()),he.draw(D,B.TRIANGLES,q,Q,ne,l.CullFaceMode.disabled,Ce,h.id,be,we,Re,h.paint,L.zoom,ue,[Se])}},heatmap:function(f,s,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const v=f.context,b=v.gl,A=l.StencilMode.disabled,I=new l.ColorMode([b.ONE,b.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(ne,oe,ie,ae){const Z=ne.gl,re=oe.width*ae,ue=oe.height*ae;ne.activeTexture.set(Z.TEXTURE1),ne.viewport.set([0,0,re,ue]);let he=ie.heatmapFbo;if(!he||he&&(he.width!==re||he.height!==ue)){he&&he.destroy();const be=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,be),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),he=ie.heatmapFbo=ne.createFramebuffer(re,ue,!1),function(Se,we,Ce,Ie,Re,st){const De=Se.gl;De.texImage2D(De.TEXTURE_2D,0,Se.isWebGL2&&Se.extRenderToTextureHalfFloat?De.RGBA16F:De.RGBA,Re,st,0,De.RGBA,Se.extRenderToTextureHalfFloat?Se.isWebGL2?De.HALF_FLOAT:Se.extTextureHalfFloat.HALF_FLOAT_OES:De.UNSIGNED_BYTE,null),Ie.colorAttachment.set(Ce)}(ne,0,be,he,re,ue)}else Z.bindTexture(Z.TEXTURE_2D,he.colorAttachment.get()),ne.bindFramebuffer.set(he.framebuffer)})(v,f,h,f.transform.projection.name==="globe"?.5:.25),v.clear({color:l.Color.transparent});const D=f.transform,B=D.projection.name==="globe",L=B?["PROJECTION_GLOBE_VIEW"]:null,q=B?l.CullFaceMode.frontCCW:l.CullFaceMode.disabled,Q=[l.mercatorXfromLng(D.center.lng),l.mercatorYfromLat(D.center.lat)];for(let ne=0;ne<g.length;ne++){const oe=g[ne];if(s.hasRenderableParent(oe))continue;const ie=s.getTile(oe),ae=ie.getBucket(h);if(!ae||ae.projection.name!==D.projection.name)continue;const Z=ae.programConfigurations.get(h.id),re=f.useProgram("heatmap",Z,L),{zoom:ue}=f.transform;f.terrain&&f.terrain.setupElevationDraw(ie,re),f.prepareDrawProgram(v,re,oe.toUnwrapped());const he=D.projection.createInversionMatrix(D,oe.canonical);re.draw(v,b.TRIANGLES,l.DepthMode.disabled,A,I,q,f0(f,oe,ie,he,Q,ue,h.paint.get("heatmap-intensity")),h.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,h.paint,f.transform.zoom,Z,B?[ae.globeExtVertexBuffer]:null)}v.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,b){const A=v.context,I=A.gl,D=b.heatmapFbo;if(!D)return;A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,D.colorAttachment.get()),A.activeTexture.set(I.TEXTURE1);let B=b.colorRampTexture;B||(B=b.colorRampTexture=new l.Texture(A,b.colorRamp,I.RGBA)),B.bind(I.LINEAR,I.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(A,I.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,v.colorModeForRenderPass(),l.CullFaceMode.disabled,((L,q,Q,ne)=>({u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}))(0,b),b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(f,h))},line:function(f,s,h,g){if(f.renderPass!=="translucent")return;const v=h.paint.get("line-opacity"),b=h.paint.get("line-width");if(v.constantOr(1)===0||b.constantOr(1)===0)return;const A=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),I=f.colorModeForRenderPass(),D=f.terrain&&f.terrain.renderingToTexture?1:l.exported.devicePixelRatio,B=h.paint.get("line-dasharray"),L=B.constantOr(1),q=h.layout.get("line-cap"),Q=h.paint.get("line-pattern"),ne=Q.constantOr(1),oe=h.paint.get("line-gradient"),ie=ne?"linePattern":"line",ae=f.context,Z=ae.gl,re=(he=>{const be=[];jc(he)&&be.push("RENDER_LINE_DASH"),he.paint.get("line-gradient")&&be.push("RENDER_LINE_GRADIENT");const Se=he.paint.get("line-trim-offset");Se[0]===0&&Se[1]===0||be.push("RENDER_LINE_TRIM_OFFSET");const we=he.paint.get("line-pattern").constantOr(1),Ce=he.paint.get("line-opacity").constantOr(1)!==1;return!we&&Ce&&be.push("RENDER_LINE_ALPHA_DISCARD"),be})(h);let ue=re.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ue=!1);for(const he of g){const be=s.getTile(he);if(ne&&!be.patternsLoaded())continue;const Se=be.getBucket(h);if(!Se)continue;f.prepareDrawTile();const we=Se.programConfigurations.get(h.id),Ce=f.useProgram(ie,we,re),Ie=Q.constantOr(null);if(Ie&&be.imageAtlas){const Ze=be.imageAtlas.patternPositions[Ie.toString()];Ze&&we.setConstantPatternPositions(Ze)}const Re=B.constantOr(null),st=q.constantOr(null);if(!ne&&Re&&st&&be.lineAtlas){const Ze=be.lineAtlas.getDash(Re,st);Ze&&we.setConstantPatternPositions(Ze)}let[De,Ke]=h.paint.get("line-trim-offset");(st==="round"||st==="square")&&De!==Ke&&(De===0&&(De-=1),Ke===1&&(Ke+=1));const Ne=f.terrain?he.projMatrix:null,at=ne?Uc(f,be,h,Ne,D):rx(f,be,h,Ne,Se.lineClipsArray.length,D,[De,Ke]);if(oe){const Ze=Se.gradients[h.id];let ut=Ze.texture;if(h.gradientVersion!==Ze.version){let tt=256;if(h.stepInterpolant){const ht=s.getSource().maxzoom,Mt=he.canonical.z===ht?Math.ceil(1<<f.transform.maxZoom-he.canonical.z):1;tt=l.clamp(l.nextPowerOfTwo(Se.maxLineLength/l.EXTENT*1024*Mt),256,ae.maxTextureSize)}Ze.gradient=l.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:tt,image:Ze.gradient||void 0,clips:Se.lineClipsArray}),Ze.texture?Ze.texture.update(Ze.gradient):Ze.texture=new l.Texture(ae,Ze.gradient,Z.RGBA),Ze.version=h.gradientVersion,ut=Ze.texture}ae.activeTexture.set(Z.TEXTURE1),ut.bind(h.stepInterpolant?Z.NEAREST:Z.LINEAR,Z.CLAMP_TO_EDGE)}L&&(ae.activeTexture.set(Z.TEXTURE0),be.lineAtlasTexture.bind(Z.LINEAR,Z.REPEAT),we.updatePaintBuffers()),ne&&(ae.activeTexture.set(Z.TEXTURE0),be.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),we.updatePaintBuffers()),f.prepareDrawProgram(ae,Ce,he.toUnwrapped());const ze=Ze=>{Ce.draw(ae,Z.TRIANGLES,A,Ze,I,l.CullFaceMode.disabled,at,h.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,h.paint,f.transform.zoom,we,[Se.layoutVertexBuffer2])};if(ue){const Ze=f.stencilModeForClipping(he).ref;Ze===0&&f.terrain&&ae.clear({stencil:0});const ut={func:Z.EQUAL,mask:255};at.u_alpha_discard_threshold=.8,ze(new l.StencilMode(ut,Ze,255,Z.KEEP,Z.KEEP,Z.INVERT)),at.u_alpha_discard_threshold=0,ze(new l.StencilMode(ut,Ze,255,Z.KEEP,Z.KEEP,Z.KEEP))}else ze(f.stencilModeForClipping(he))}ue&&(f.resetStencilClippingMasks(),f.terrain&&ae.clear({stencil:0}))},fill:function(f,s,h,g){const v=h.paint.get("fill-color"),b=h.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const A=f.colorModeForRenderPass(),I=h.paint.get("fill-pattern"),D=f.opaquePassEnabledForLayer()&&!I.constantOr(1)&&v.constantOr(l.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===D){const B=f.depthModeForSublayer(1,f.renderPass==="opaque"?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly);_0(f,s,h,g,B,A,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){const B=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,l.DepthMode.ReadOnly);_0(f,s,h,g,B,A,!0)}},"fill-extrusion":function(f,s,h,g){const v=h.paint.get("fill-extrusion-opacity");if(v!==0&&f.renderPass==="translucent"){const b=new l.DepthMode(f.context.gl.LEQUAL,l.DepthMode.ReadWrite,f.depthRangeFor3D);if(v!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))rh(f,s,h,g,b,l.StencilMode.disabled,l.ColorMode.disabled),rh(f,s,h,g,b,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const A=f.colorModeForRenderPass();rh(f,s,h,g,b,l.StencilMode.disabled,A)}}},hillshade:function(f,s,h,g){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const v=f.context,b=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),A=f.colorModeForRenderPass(),I=f.terrain&&f.terrain.renderingToTexture,[D,B]=f.renderPass!=="translucent"||I?[{},g]:f.stencilConfigForOverlap(g);for(const L of B){const q=s.getTile(L);if(q.needsHillshadePrepare&&f.renderPass==="offscreen")c0(f,q,h,b,l.StencilMode.disabled,A);else if(f.renderPass==="translucent"){const Q=I&&f.terrain?f.terrain.stencilModeForRTTOverlap(L):D[L.overscaledZ];l0(f,L,q,h,b,Q,A)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,s,h,g,v,b){if(f.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!g.length)return;const A=f.context,I=A.gl,D=s.getSource(),B=f.useProgram("raster"),L=f.colorModeForRenderPass(),q=f.terrain&&f.terrain.renderingToTexture,[Q,ne]=D instanceof jt||q?[{},g]:f.stencilConfigForOverlap(g),oe=ne[ne.length-1].overscaledZ,ie=!f.options.moving;for(const ae of ne){const Z=q?l.DepthMode.disabled:f.depthModeForSublayer(ae.overscaledZ-oe,h.paint.get("raster-opacity")===1?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly,I.LESS),re=ae.toUnwrapped(),ue=s.getTile(ae);if(q&&(!ue||!ue.hasData()))continue;const he=q?ae.projMatrix:f.transform.calculateProjMatrix(re,ie),be=f.terrain&&q?f.terrain.stencilModeForRTTOverlap(ae):Q[ae.overscaledZ],Se=b?0:h.paint.get("raster-fade-duration");ue.registerFadeDuration(Se);const we=s.findLoadedParent(ae,0),Ce=dp(ue,we,s,f.transform,Se);let Ie,Re;f.terrain&&f.terrain.prepareDrawTile();const st=h.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;A.activeTexture.set(I.TEXTURE0),ue.texture.bind(st,I.CLAMP_TO_EDGE),A.activeTexture.set(I.TEXTURE1),we?(we.texture.bind(st,I.CLAMP_TO_EDGE),Ie=Math.pow(2,we.tileID.overscaledZ-ue.tileID.overscaledZ),Re=[ue.tileID.canonical.x*Ie%1,ue.tileID.canonical.y*Ie%1]):ue.texture.bind(st,I.CLAMP_TO_EDGE),ue.texture.useMipmap&&A.extTextureFilterAnisotropic&&f.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const De=bp(he,Re||[0,0],Ie||1,Ce,h,D instanceof jt?D.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(A,B,re),D instanceof jt)D.boundsBuffer&&D.boundsSegments&&B.draw(A,I.TRIANGLES,Z,l.StencilMode.disabled,L,l.CullFaceMode.disabled,De,h.id,D.boundsBuffer,f.quadTriangleIndexBuffer,D.boundsSegments);else{const{tileBoundsBuffer:Ke,tileBoundsIndexBuffer:Ne,tileBoundsSegments:at}=f.getTileBoundsBuffers(ue);B.draw(A,I.TRIANGLES,Z,be,L,l.CullFaceMode.disabled,De,h.id,Ke,Ne,at)}}f.resetStencilClippingMasks()},background:function(f,s,h,g){const v=h.paint.get("background-color"),b=h.paint.get("background-opacity");if(b===0)return;const A=f.context,I=A.gl,D=f.transform,B=D.tileSize,L=h.paint.get("background-pattern");if(f.isPatternMissing(L))return;const q=!L&&v.a===1&&b===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==q)return;const Q=l.StencilMode.disabled,ne=f.depthModeForSublayer(0,q==="opaque"?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly),oe=f.colorModeForRenderPass(),ie=f.useProgram(L?"backgroundPattern":"background");let ae,Z=g;Z||(ae=f.getBackgroundTiles(),Z=Object.values(ae).map(re=>re.tileID)),L&&(A.activeTexture.set(I.TEXTURE0),f.imageManager.bind(f.context));for(const re of Z){const ue=re.toUnwrapped(),he=g?re.projMatrix:f.transform.calculateProjMatrix(ue);f.prepareDrawTile();const be=s?s.getTile(re):ae?ae[re.key]:new l.Tile(re,B,D.zoom,f),Se=L?nx(he,b,f,L,{tileID:re,tileSize:B}):Ep(he,b,v);f.prepareDrawProgram(A,ie,ue);const{tileBoundsBuffer:we,tileBoundsIndexBuffer:Ce,tileBoundsSegments:Ie}=f.getTileBoundsBuffers(be);ie.draw(A,I.TRIANGLES,ne,Q,oe,l.CullFaceMode.disabled,Se,h.id,we,Ce,Ie)}},sky:function(f,s,h){const g=f.transform,v=g.projection.name==="mercator"||g.projection.name==="globe"?1:l.smoothstep(7,8,g.zoom),b=h.paint.get("sky-opacity")*v;if(b===0)return;const A=f.context,I=h.paint.get("sky-type"),D=new l.DepthMode(A.gl.LEQUAL,l.DepthMode.ReadOnly,[0,1]),B=f.frameCounter/1e3%1;I==="atmosphere"?f.renderPass==="offscreen"?h.needsSkyboxCapture(f)&&(function(L,q,Q,ne){const oe=L.context,ie=oe.gl;let ae=q.skyboxFbo;if(!ae){ae=q.skyboxFbo=oe.createFramebuffer(32,32,!1),q.skyboxGeometry=new ih(oe),q.skyboxTexture=oe.gl.createTexture(),ie.bindTexture(ie.TEXTURE_CUBE_MAP,q.skyboxTexture),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MAG_FILTER,ie.LINEAR);for(let he=0;he<6;++he)ie.texImage2D(ie.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,ie.RGBA,32,32,0,ie.RGBA,ie.UNSIGNED_BYTE,null)}oe.bindFramebuffer.set(ae.framebuffer),oe.viewport.set([0,0,32,32]);const Z=q.getCenter(L,!0),re=L.useProgram("skyboxCapture"),ue=new Float64Array(16);l.identity(ue),l.rotateY(ue,ue,.5*-Math.PI),io(oe,q,re,ue,Z,0),l.identity(ue),l.rotateY(ue,ue,.5*Math.PI),io(oe,q,re,ue,Z,1),l.identity(ue),l.rotateX(ue,ue,.5*-Math.PI),io(oe,q,re,ue,Z,2),l.identity(ue),l.rotateX(ue,ue,.5*Math.PI),io(oe,q,re,ue,Z,3),l.identity(ue),io(oe,q,re,ue,Z,4),l.identity(ue),l.rotateY(ue,ue,Math.PI),io(oe,q,re,ue,Z,5),oe.viewport.set([0,0,L.width,L.height])}(f,h),h.markSkyboxValid(f)):f.renderPass==="sky"&&function(L,q,Q,ne,oe){const ie=L.context,ae=ie.gl,Z=L.transform,re=L.useProgram("skybox");ie.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_CUBE_MAP,q.skyboxTexture);const ue=((he,be,Se,we,Ce)=>({u_matrix:he,u_sun_direction:be,u_cubemap:0,u_opacity:we,u_temporal_offset:Ce}))(Z.skyboxMatrix,q.getCenter(L,!1),0,ne,oe);L.prepareDrawProgram(ie,re),re.draw(ie,ae.TRIANGLES,Q,l.StencilMode.disabled,L.colorModeForRenderPass(),l.CullFaceMode.backCW,ue,"skybox",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(f,h,D,b,B):I==="gradient"&&f.renderPass==="sky"&&function(L,q,Q,ne,oe){const ie=L.context,ae=ie.gl,Z=L.transform,re=L.useProgram("skyboxGradient");q.skyboxGeometry||(q.skyboxGeometry=new ih(ie)),ie.activeTexture.set(ae.TEXTURE0);let ue=q.colorRampTexture;ue||(ue=q.colorRampTexture=new l.Texture(ie,q.colorRamp,ae.RGBA)),ue.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const he=((be,Se,we,Ce,Ie)=>({u_matrix:be,u_color_ramp:0,u_center_direction:Se,u_radius:l.degToRad(we),u_opacity:Ce,u_temporal_offset:Ie}))(Z.skyboxMatrix,q.getCenter(L,!1),q.paint.get("sky-gradient-radius"),ne,oe);L.prepareDrawProgram(ie,re),re.draw(ie,ae.TRIANGLES,Q,l.StencilMode.disabled,L.colorModeForRenderPass(),l.CullFaceMode.backCW,he,"skyboxGradient",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(f,h,D,b,B)},debug:function(f,s,h){for(let g=0;g<h.length;g++)cx(f,s,h[g])},custom:function(f,s,h,g){const v=f.context,b=h.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&h.isLayerDraped()){if(f.renderPass==="offscreen"){const A=b.prerender;if(A){if(f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;A.call(b,v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),l.globeToMercatorTransition(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else A.call(b,v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const I=b.renderToTile;if(I){const D=g[0].canonical,B=new l.MercatorCoordinate(D.x+g[0].wrap*(1<<D.z),D.y,D.z);v.setDepthMode(l.DepthMode.disabled),v.setStencilMode(l.StencilMode.disabled),v.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),I.call(b,v.gl,B),v.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),v.setStencilMode(l.StencilMode.disabled);const A=b.renderingMode==="3d"?new l.DepthMode(f.context.gl.LEQUAL,l.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,l.DepthMode.ReadOnly);if(v.setDepthMode(A),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;b.render(v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),l.globeToMercatorTransition(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else b.render(v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState(),v.bindFramebuffer.set(null)}}else l.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Al{constructor(s,h,g=!1){this.context=new dt(s,g),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=l.SourceCache.maxUnderzooming+l.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(s,h){const g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fp(this,s));const v=this._terrain;this.transform.elevation=g?v:null,v.update(s,this.transform,h)}_updateFog(s){const h=s.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const b=g+.78*(v-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(s,h){if(this.width=s*l.exported.devicePixelRatio,this.height=h*l.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const s=this.context,h=new l.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(l.EXTENT,0),h.emplaceBack(0,l.EXTENT),h.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,l.posAttributes.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const g=new l.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(l.EXTENT,0),g.emplaceBack(0,l.EXTENT),g.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=s.createVertexBuffer(g,l.posAttributes.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const v=new l.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,l.posAttributes.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const b=new l.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(l.EXTENT,0,l.EXTENT,0),b.emplaceBack(0,l.EXTENT,0,l.EXTENT),b.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.mercatorBoundsBuffer=s.createVertexBuffer(b,l.boundsAttributes.members),this.mercatorBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const A=new l.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(A);const I=new l.StructArrayLayout1ui2;for(const B of[0,1,3,2,0])I.emplaceBack(B);this.debugIndexBuffer=s.createIndexBuffer(I),this.emptyTexture=new l.Texture(s,new l.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=l.create();const D=this.context.gl;this.stencilClearMode=new l.StencilMode({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(l.window.performance.now()),this.atmosphereBuffer=new E0(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(s,h.TRIANGLES,l.DepthMode.disabled,this.stencilClearMode,l.ColorMode.disabled,l.CullFaceMode.disabled,Bc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,h,g){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const D of g)if(this._tileClippingMaskIDs[D.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=h.id;const v=this.context,b=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(l.ColorMode.disabled),v.setDepthMode(l.DepthMode.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of g){const D=h.getTile(I),B=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:q,tileBoundsSegments:Q}=this.getTileBoundsBuffers(D);A.draw(v,b.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:b.ALWAYS,mask:0},B,255,b.KEEP,b.KEEP,b.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,Bc(I.projMatrix),"$clipping",L,q,Q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new l.StencilMode({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const h=this.context.gl;return new l.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,g=s.sort((A,I)=>I.overscaledZ-A.overscaledZ),v=g[g.length-1].overscaledZ,b=g[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const A={};for(let I=0;I<b;I++)A[I+v]=new l.StencilMode({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[A,g]}return[{[v]:l.StencilMode.disabled},g]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new l.ColorMode([s.CONSTANT_COLOR,s.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?l.ColorMode.unblended:l.ColorMode.alphaBlended}depthModeForSublayer(s,h,g){if(!this.opaquePassEnabledForLayer())return l.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new l.DepthMode(g||this.context.gl.LEQUAL,h,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const g=this.style.order,v=this.style._sourceCaches;for(const B in v){const L=v[B];L.used&&L.prepare(this.context)}const b={},A={},I={};for(const B in v){const L=v[B];b[B]=L.getVisibleCoordinates(),A[B]=b[B].slice().reverse(),I[B]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<g.length;B++)if(this.style._layers[g[B]].is3D()){this.opaquePassCutoff=B;break}if(this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new l.GlobeSharedBuffers(this.context)),!l.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const B of g){const L=this.style._layers[B],q=s._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const Q=q?A[q.id]:void 0;(L.type==="custom"||L.isSky()||Q&&Q.length)&&this.renderLayer(this,q,L,Q)}this.depthRangeFor3D=[0,1-(s.order.length+2)*this.numSublayers*this.depthEpsilon];const D=this.terrain;if(D&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&D.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[g[this.currentLayer]],L=s._getLayerSourceCache(B);if(B.isSky())continue;const q=L?A[L.id]:void 0;this._renderTileClippingMasks(B,L,q),this.renderLayer(this,L,B,q)}if(this.style.fog&&this.transform.projection.supportsFog&&function(B,L){const q=B.context,Q=q.gl,ne=B.transform,oe=new l.DepthMode(Q.LEQUAL,l.DepthMode.ReadOnly,[0,1]),ie=B.useProgram("globeAtmosphere",null,ne.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ae=l.globeToMercatorTransition(ne.zoom),Z=L.properties.get("color").toArray01(),re=L.properties.get("high-color").toArray01(),ue=L.properties.get("space-color").toArray01PremultipliedAlpha(),he=l.identity$1([]);l.rotateY$1(he,he,-l.degToRad(ne._center.lng)),l.rotateX$1(he,he,l.degToRad(ne._center.lat)),l.rotateZ$1(he,he,ne.angle),l.rotateX$1(he,he,-ne._pitch);const be=l.fromQuat(new Float32Array(16),he),Se=l.mapValue(L.properties.get("star-intensity"),0,1,0,.25),we=5e-4,Ce=l.mapValue(L.properties.get("horizon-blend"),0,1,we,.25),Ie=l.globeUseCustomAntiAliasing(B,q,ne)&&Ce===we?ne.worldSize/(2*Math.PI*1.025)-1:ne.globeRadius,Re=B.frameCounter/1e3%1,st=l.length(ne.globeCenterInViewSpace),De=Math.sqrt(Math.pow(st,2)-Math.pow(Ie,2)),Ke=Math.acos(De/st),Ne=((ze,Ze,ut,tt,ht,Mt,$t,At,Lt,nr,er,Pt,Ar,Mr)=>({u_frustum_tl:ze,u_frustum_tr:Ze,u_frustum_br:ut,u_frustum_bl:tt,u_horizon:ht,u_transition:Mt,u_fadeout_range:$t,u_color:At,u_high_color:Lt,u_space_color:nr,u_star_intensity:er,u_star_size:5*l.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Pt,u_horizon_angle:Ar,u_rotation_matrix:Mr}))(ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.frustumCorners.horizon,ae,Ce,Z,re,ue,Se,Re,Ke,be);B.prepareDrawProgram(q,ie);const at=B.atmosphereBuffer;at&&ie.draw(q,Q.TRIANGLES,oe,l.StencilMode.disabled,l.ColorMode.alphaBlended,l.CullFaceMode.backCW,Ne,"skybox",at.vertexBuffer,at.indexBuffer,at.segments)}(this,this.style.fog),this.renderPass="sky",(l.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const B=this.style._layers[g[this.currentLayer]],L=s._getLayerSourceCache(B);B.isSky()&&this.renderLayer(this,L,B,L?A[L.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const B=this.style._layers[g[this.currentLayer]],L=s._getLayerSourceCache(B);if(B.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(B)){if(B.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const q=L?(B.type==="symbol"?I:A)[L.id]:void 0;this._renderTileClippingMasks(B,L,L?b[L.id]:void 0),this.renderLayer(this,L,B,q),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let B=null;l.values(this.style._layers).forEach(L=>{const q=s._getLayerSourceCache(L);q&&!L.isHidden(this.transform.zoom)&&(!B||B.getSource().maxzoom<q.getSource().maxzoom)&&(B=q)}),B&&this.options.showTileBoundaries&&Bs.debug(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const L=B.transform.padding;x0(B,B.transform.height-(L.top||0),3,Sl),x0(B,L.bottom||0,3,ox),nh(B,L.left||0,3,ax),nh(B,B.transform.width-(L.right||0),3,sx);const q=B.transform.centerPoint;(function(Q,ne,oe,ie){Tl(Q,ne-1,oe-10,2,20,ie),Tl(Q,ne-10,oe-1,20,2,ie)})(B,q.x,B.transform.height-q.y,lx)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(l.window.performance.now()),this.saveCanvasCopy())}renderLayer(s,h,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),(!s.transform.projection.unsupportedLayers||!s.transform.projection.unsupportedLayers.includes(g.type)||s.terrain&&g.type==="custom")&&Bs[g.type](s,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let g=this.gpuTimers[s.id];g||(g=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),g.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,h=s.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),s.beginQueryEXT(s.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const h={};for(const g in s){const v=s[g],b=this.context.extTimerQuery,A=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),h[g]=A}return h}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let g=0;for(const v of s)g+=h.getQueryObjectEXT(v,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(v);return g}translatePosMatrix(s,h,g,v,b){if(!g[0]&&!g[1])return s;const A=b?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(A){const B=Math.sin(A),L=Math.cos(A);g=[g[0]*L-g[1]*B,g[0]*B+g[1]*L]}const I=[b?g[0]:je(h,g[0],this.transform.zoom),b?g[1]:je(h,g[1],this.transform.zoom),0],D=new Float32Array(16);return l.translate(D,s,I),D}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){return s===null||s!==void 0&&!this.imageManager.getPattern(s.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const s=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&this.terrain.exaggeration()===0,g=this.style&&this.style.fog,v=[];return this.terrainRenderModeElevated()&&v.push("TERRAIN"),this.transform.projection.name==="globe"&&v.push("GLOBE"),h&&v.push("ZERO_EXAGGERATION"),g&&!s&&g.getOpacity(this.transform.pitch)!==0&&v.push("FOG"),s&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}useProgram(s,h,g){this.cache=this.cache||{};const v=g||[],b=this.currentGlobalDefines().concat(v),A=dr.cacheKey(lp[s],s,b,h);return this.cache[A]||(this.cache[A]=new dr(this.context,s,lp[s],h,Sp[s],b)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(s,h,g){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),A=((I,D,B,L,q,Q,ne,oe,ie,ae,Z)=>{const re=I.transform,ue=D.properties.get("color").toArray01();ue[3]=L;const he=I.frameCounter/1e3%1;return{u_fog_matrix:B?re.calculateFogTileMatrix(B):I.identityMat,u_fog_range:D.getFovAdjustedRange(re._fov),u_fog_color:ue,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_temporal_offset:he,u_frustum_tl:q,u_frustum_tr:Q,u_frustum_br:ne,u_frustum_bl:oe,u_globe_pos:ie,u_globe_radius:ae,u_viewport:Z,u_globe_transition:l.globeToMercatorTransition(re.zoom),u_is_globe:+(re.projection.name==="globe")}})(this,v,g,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*l.exported.devicePixelRatio,this.transform.height*l.exported.devicePixelRatio]);h.setFogUniformValues(s,A)}}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)h[v.key]=s[v.key]||new l.Tile(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class oh{constructor(s=0,h=0,g=0,v=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=g,this.right=v}interpolate(s,h,g){return h.top!=null&&s.top!=null&&(this.top=l.number(s.top,h.top,g)),h.bottom!=null&&s.bottom!=null&&(this.bottom=l.number(s.bottom,h.bottom,g)),h.left!=null&&s.left!=null&&(this.left=l.number(s.left,h.left,g)),h.right!=null&&s.right!=null&&(this.right=l.number(s.right,h.right,g)),this}getCenter(s,h){const g=l.clamp((this.left+s-this.right)/2,0,s),v=l.clamp((this.top+h-this.bottom)/2,0,h);return new l.Point(g,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new oh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ah(f,s){const h=l.getColumn(f,3);l.fromQuat(f,s),l.setColumn(f,3,h)}function pr(f,s){const h=l.identity$1([]);return l.rotateZ$1(h,h,-s),l.rotateX$1(h,h,-f),h}function Gc(f,s){const h=[f[0],f[1],0],g=[s[0],s[1],0];if(l.length(h)>=1e-15){const A=l.normalize([],h);l.scale$2(g,A,l.dot(g,A)),s[0]=g[0],s[1]=g[1]}const v=l.cross([],s,f);if(l.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return pr(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}class S0{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){const h=s instanceof l.MercatorCoordinate?s:new l.MercatorCoordinate(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=l.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h){if(this.orientation=null,!this.position)return;const g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(s)):0,b=l.MercatorCoordinate.fromLngLat(s,v),A=[b.x-g.x,b.y-g.y,b.z-g.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Gc(A,h)}setPitchBearing(s,h){this.orientation=pr(l.degToRad(s),l.degToRad(-h))}}class sh{constructor(s,h){this._transform=l.identity([]),this.orientation=h,this.position=s}get mercatorPosition(){const s=this.position;return new l.MercatorCoordinate(s[0],s[1],s[2])}get position(){const s=l.getColumn(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&l.setColumn(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||l.identity$1([]),s&&ah(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=pr(s,h),ah(this._transform,this._orientation)}forward(){const s=l.getColumn(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=l.getColumn(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=l.getColumn(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){const g=new Float64Array(16);return l.invert(g,this.getWorldToCamera(s,h)),g}getWorldToCameraPosition(s,h,g){const v=this.position;l.scale$2(v,v,-s);const b=new Float64Array(16);return l.fromScaling(b,[g,g,g]),l.translate(b,b,v),b[10]*=h,b}getWorldToCamera(s,h){const g=new Float64Array(16),v=new Float64Array(4),b=this.position;return l.conjugate(v,this._orientation),l.scale$2(b,b,-s),l.fromQuat(g,v),l.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(s,h,g,v){const b=new Float64Array(16);return l.perspective(b,s,h,g,v),b}getDistanceToElevation(s,h=!1){const g=s===0?0:l.mercatorZfromAltitude(s,h?l.latFromMercatorY(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new sh([...this.position],[...this.orientation])}}function Il(f,s){const h=lh(f.projection,f.zoom,f.width,f.height),g=function(b,A,I,D,B){const L=new l.LngLat(I.lng-180*Ia,I.lat),q=new l.LngLat(I.lng+180*Ia,I.lat),Q=b.project(L.lng,L.lat),ne=b.project(q.lng,q.lat),oe=-Math.atan2(ne.y-Q.y,ne.x-Q.x),ie=l.MercatorCoordinate.fromLngLat(I);ie.y=l.clamp(ie.y,-1+Ia,1-Ia);const ae=ie.toLngLat(),Z=b.project(ae.lng,ae.lat),re=l.MercatorCoordinate.fromLngLat(ae);re.x+=Ia;const ue=re.toLngLat(),he=b.project(ue.lng,ue.lat),be=ch(he.x-Z.x,he.y-Z.y,oe),Se=l.MercatorCoordinate.fromLngLat(ae);Se.y+=Ia;const we=Se.toLngLat(),Ce=b.project(we.lng,we.lat),Ie=ch(Ce.x-Z.x,Ce.y-Z.y,oe),Re=Math.abs(be.x)/Math.abs(Ie.y),st=l.identity([]);l.rotateZ(st,st,-oe*(1-(B?0:D)));const De=l.identity([]);return l.scale(De,De,[1,1-(1-Re)*D,1]),De[4]=-Ie.x/Ie.y*D,l.rotateZ(De,De,oe),l.multiply(De,st,De),De}(f.projection,0,f.center,h,s),v=T0(f);return l.scale(g,g,[v,v,1]),g}function T0(f){const s=f.projection,h=lh(f.projection,f.zoom,f.width,f.height),g=A0(s,f.center),v=A0(s,l.LngLat.convert(s.center));return Math.pow(2,g*h+(1-h)*v)}function lh(f,s,h,g,v=1/0){const b=f.range;if(!b)return 0;const A=Math.min(v,Math.max(h,g)),I=Math.log(A/1024)/Math.LN2;return l.smoothstep(b[0]+I,b[1]+I,s)}const Ia=1/4e4;function A0(f,s){const h=l.clamp(s.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),g=new l.LngLat(s.lng-180*Ia,h),v=new l.LngLat(s.lng+180*Ia,h),b=f.project(g.lng,h),A=f.project(v.lng,h),I=l.MercatorCoordinate.fromLngLat(g),D=l.MercatorCoordinate.fromLngLat(v),B=A.x-b.x,L=A.y-b.y,q=D.x-I.x,Q=D.y-I.y,ne=Math.sqrt((q*q+Q*Q)/(B*B+L*L));return Math.log(ne)/Math.LN2}function ch(f,s,h){const g=Math.cos(h),v=Math.sin(h);return{x:f*g-s*v,y:f*v+s*g}}class Cl{constructor(s,h,g,v,b,A,I){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(A),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new oh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new sh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const s=new Cl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(s,h=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return l.pick(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=l.getProjection(this.projectionOptions);const g=!w(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=l.getProjection({name:"mercator"});const h=s!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return l.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.Point(this.width,this.height)}get bearing(){return l.wrap(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const h=-s*Math.PI/180;var g;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(g=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),function(v,b,A){var I=b[0],D=b[1],B=b[2],L=b[3],q=Math.sin(A),Q=Math.cos(A);v[0]=I*Q+B*q,v[1]=D*Q+L*q,v[2]=I*-q+B*Q,v[3]=D*-q+L*Q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=l.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=l.degToRad(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const s=this._elevation;this._centerAltitude=s.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=s.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,b=0;for(let A=0;A<h.length;A++){const I=new l.Point(h[A][0]*this.width,g+h[A][1]*(this.height-g)),D=s.pointCoordinate(I);if(!D)continue;const B=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);v+=D[3]*B,b+=B}return b===0?NaN:v/b}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(s),b=this._mercatorZfromZoom(this._maxZoom),A=Math.max(v-g,b);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let g;g=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];const v=l.length(l.sub([],this._camera.position,g));return l.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!l.exactEquals(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){const g=[s.position.x,s.position.y,s.position.z];l.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,h=new S0;return h.position=new l.MercatorCoordinate(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!l.length$1(s))return!1;l.normalize$1(s,s);const h=l.transformQuat([],[0,0,-1],s),g=l.transformQuat([],[0,-1,0],s);if(g[2]<0)return!1;const v=Gc(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){const h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=l.clamp(s[2],v/g,v/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,g){this._unmodified=!1,this._edgeInsets.interpolate(s,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new l.UnwrappedTileID(0,s)];if(this.renderWorldCopies){const g=this.pointCoordinate(new l.Point(0,0)),v=this.pointCoordinate(new l.Point(this.width,0)),b=this.pointCoordinate(new l.Point(this.width,this.height)),A=this.pointCoordinate(new l.Point(0,this.height)),I=Math.floor(Math.min(g.x,v.x,b.x,A.x)),D=Math.floor(Math.max(g.x,v.x,b.x,A.x)),B=1;for(let L=I-B;L<=D+B;L++)L!==0&&h.push(new l.UnwrappedTileID(L,s))}return h}coveringTiles(s){let h=this.coveringZoomLevel(s);const g=h,v=this.elevation&&!s.isTerrainDEM,b=this.projection.name==="mercator";if(s.minzoom!==void 0&&h<s.minzoom)return[];s.maxzoom!==void 0&&h>s.maxzoom&&(h=s.maxzoom);const A=this.locationCoordinate(this.center),I=this.center.lat,D=1<<h,B=[D*A.x,D*A.y,0],L=this.projection.name==="globe",q=!L,Q=l.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,q),ne=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=D*l.mercatorZfromAltitude(1,this.center.lat),ie=this._camera.position[2]/l.mercatorZfromAltitude(1,this.center.lat),ae=[D*ne.x,D*ne.y,ie*(q?1:oe)],Z=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),re=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,ue=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,he=s.isTerrainDEM?-ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,be=this.projection.isReprojectedInTileSpace?T0(this):1,Se=ze=>{const ut=new l.MercatorCoordinate(ze.x+25e-6,ze.y,ze.z),tt=new l.MercatorCoordinate(ze.x,ze.y+25e-6,ze.z),ht=ze.toLngLat(),Mt=ut.toLngLat(),$t=tt.toLngLat(),At=this.locationCoordinate(ht),Lt=this.locationCoordinate(Mt),nr=this.locationCoordinate($t),er=Math.hypot(Lt.x-At.x,Lt.y-At.y),Pt=Math.hypot(nr.x-At.x,nr.y-At.y);return Math.sqrt(er*Pt)*be/25e-6},we=ze=>{const Ze=ue,ut=he;return{aabb:l.tileAABB(this,D,0,0,0,ze,ut,Ze,this.projection),zoom:0,x:0,y:0,minZ:ut,maxZ:Ze,wrap:ze,fullyVisible:!1}},Ce=[];let Ie=[];const Re=h,st=s.reparseOverscaled?g:h,De=ze=>ze*ze,Ke=De((ie-this._centerAltitude)*oe),Ne=ze=>{if(!this._elevation||!ze.tileID||!b)return;const Ze=this._elevation.getMinMaxForTile(ze.tileID),ut=ze.aabb;Ze?(ut.min[2]=Ze.min,ut.max[2]=Ze.max,ut.center[2]=(ut.min[2]+ut.max[2])/2):(ze.shouldSplit=at(ze),ze.shouldSplit||(ut.min[2]=ut.max[2]=ut.center[2]=this._centerAltitude))},at=ze=>{if(ze.zoom<re)return!0;if(ze.zoom===Re)return!1;if(ze.shouldSplit!=null)return ze.shouldSplit;const Ze=ze.aabb.distanceX(ae),ut=ze.aabb.distanceY(ae);let tt=Ke,ht=1;if(L){tt=De(ze.aabb.distanceZ(ae));const At=Math.pow(2,ze.zoom),Lt=l.latFromMercatorY((ze.y+1)/At),nr=l.latFromMercatorY(ze.y/At),er=Math.min(Math.max(I,Lt),nr),Pt=l.circumferenceAtLatitude(er)/l.circumferenceAtLatitude(I);if(ht=er===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Pt/this._mercatorScaleRatio),this.zoom<=l.GLOBE_ZOOM_THRESHOLD_MIN&&ze.zoom===Re-1&&Pt>=.9)return!0}else if(v&&(tt=De(ze.aabb.distanceZ(ae)*oe)),this.projection.isReprojectedInTileSpace&&g<=5){const At=Math.pow(2,ze.zoom),Lt=Se(new l.MercatorCoordinate((ze.x+.5)/At,(ze.y+.5)/At));ht=Lt>.85?1:Lt}const Mt=Ze*Ze+ut*ut+tt,$t=De((1<<Re-ze.zoom)*Z*ht*((At,Lt)=>{if(Lt*De(.707)<At)return 1;const nr=Math.sqrt(Lt/At);return nr/(1.4144271570014144+(Math.pow(1.1,nr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(tt,Ke),Mt));return Mt<$t};if(this.renderWorldCopies)for(let ze=1;ze<=3;ze++)Ce.push(we(-ze)),Ce.push(we(ze));for(Ce.push(we(0));Ce.length>0;){const ze=Ce.pop(),Ze=ze.x,ut=ze.y;let tt=ze.fullyVisible;if(!tt){const ht=ze.aabb.intersects(Q);if(ht===0)continue;tt=ht===2}if(ze.zoom!==Re&&at(ze))for(let ht=0;ht<4;ht++){const Mt=(Ze<<1)+ht%2,$t=(ut<<1)+(ht>>1),At={aabb:b?ze.aabb.quadrant(ht):l.tileAABB(this,D,ze.zoom+1,Mt,$t,ze.wrap,ze.minZ,ze.maxZ,this.projection),zoom:ze.zoom+1,x:Mt,y:$t,wrap:ze.wrap,fullyVisible:tt,tileID:void 0,shouldSplit:void 0,minZ:ze.minZ,maxZ:ze.maxZ};v&&!L&&(At.tileID=new l.OverscaledTileID(ze.zoom+1===Re?st:ze.zoom+1,ze.wrap,ze.zoom+1,Mt,$t),Ne(At)),Ce.push(At)}else{const ht=ze.zoom===Re?st:ze.zoom;if(s.minzoom&&s.minzoom>ht)continue;const Mt=B[0]-(.5+Ze+(ze.wrap<<ze.zoom))*(1<<h-ze.zoom),$t=B[1]-.5-ut,At=ze.tileID?ze.tileID:new l.OverscaledTileID(ht,ze.wrap,ze.zoom,Ze,ut);Ie.push({tileID:At,distanceSq:Mt*Mt+$t*$t})}}if(this.fogCullDistSq){const ze=this.fogCullDistSq,Ze=this.horizonLineFromTop();Ie=Ie.filter(ut=>{const tt=[0,0,0,1],ht=[l.EXTENT,l.EXTENT,0,1],Mt=this.calculateFogTileMatrix(ut.tileID.toUnwrapped());l.transformMat4$1(tt,tt,Mt),l.transformMat4$1(ht,ht,Mt);const $t=l.getAABBPointSquareDist(tt,ht);if($t===0)return!0;let At=!1;const Lt=this._elevation;if(Lt&&$t>ze&&Ze!==0){const nr=this.calculateProjMatrix(ut.tileID.toUnwrapped());let er;s.isTerrainDEM||(er=Lt.getMinMaxForTile(ut.tileID)),er||(er={min:he,max:ue});const Pt=l.furthestTileCorner(this.rotation),Ar=[Pt[0]*l.EXTENT,Pt[1]*l.EXTENT,er.max];l.transformMat4(Ar,Ar,nr),At=(1-Ar[1])*this.height*.5<Ze}return $t<ze||At})}return Ie.sort((ze,Ze)=>ze.distanceSq-Ze.distanceSq).map(ze=>ze.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=l.clamp(s.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),g=this.projection.project(s.lng,h);return new l.Point(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/l.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,h){let g,v;const b=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;g=(h.x-b.x)/I,v=(h.y-b.y)/I}else{const I=this.pointCoordinate(h),D=this.pointCoordinate(b);g=I.x-D.x,v=I.y-D.y}const A=this.locationCoordinate(s);this.setLocation(new l.MercatorCoordinate(A.x-g,A.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,h){const g=h?l.mercatorZfromAltitude(h,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new l.MercatorCoordinate(v.x,v.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){const g=h??this._centerAltitude,v=[s.x,s.y,0,1],b=[s.x,s.y,1,1];l.transformMat4$1(v,v,this.pixelMatrixInverse),l.transformMat4$1(b,b,this.pixelMatrixInverse);const A=b[3];l.scale$1(v,v,1/v[3]),l.scale$1(b,b,1/A);const I=v[2],D=b[2];return{p0:v,p1:b,t:I===D?0:(g-I)/(D-I)}}screenPointToMercatorRay(s){const h=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return l.transformMat4$1(h,h,this.pixelMatrixInverse),l.transformMat4$1(g,g,this.pixelMatrixInverse),l.scale$1(h,h,1/h[3]),l.scale$1(g,g,1/g[3]),h[2]=l.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,g[2]=l.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,l.scale$1(h,h,1/this.worldSize),l.scale$1(g,g,1/this.worldSize),new l.Ray([h[0],h[1],h[2]],l.normalize([],l.sub([],g,h)))}rayIntersectionCoordinate(s){const{p0:h,p1:g,t:v}=s,b=l.mercatorZfromAltitude(h[2],this._center.lat),A=l.mercatorZfromAltitude(g[2],this._center.lat);return new l.MercatorCoordinate(l.number(h[0],g[0],v)/this.worldSize,l.number(h[1],g[1],v)/this.worldSize,l.number(b,A,v))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let h=this.projection.pointCoordinate3D(this,s.x,s.y);if(h)return new l.MercatorCoordinate(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(s.y>v)return this.pointCoordinate(s);const b=.02*v,A=s.clone();for(let I=0;I<10&&v-g>b;I++){A.y=l.number(g,v,.66);const D=this.projection.pointCoordinate3D(this,A.x,A.y);D?(v=A.y,h=D):g=A.y}return h?new l.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(s);const h=this.pointCoordinate(s);return h.y>=0&&h.y<=1}_coordinatePoint(s,h){const g=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return l.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new l.Point(v[0]/v[3],v[1]/v[3]):new l.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=this.pointLocation3D(new l.Point(h,s)),A=this.pointLocation3D(new l.Point(v,s)),I=this.pointLocation3D(new l.Point(v,g)),D=this.pointLocation3D(new l.Point(h,g));let B=Math.min(b.lng,A.lng,I.lng,D.lng),L=Math.max(b.lng,A.lng,I.lng,D.lng),q=Math.min(b.lat,A.lat,I.lat,D.lat),Q=Math.max(b.lat,A.lat,I.lat,D.lat);const ne=Math.pow(2,-this.zoom)/16*270,oe=this.projection.name==="globe"?1:4,ie=(ae,Z,re,ue,he)=>{const be=(ae+re)/2,Se=(Z+ue)/2,we=new l.Point(be,Se),{lng:Ce,lat:Ie}=this.pointLocation3D(we),Re=Math.max(0,B-Ce,q-Ie,Ce-L,Ie-Q);B=Math.min(B,Ce),L=Math.max(L,Ce),q=Math.min(q,Ie),Q=Math.max(Q,Ie),(he<oe||Re>ne)&&(ie(ae,Z,be,Se,he+1),ie(be,Se,re,ue,he+1))};if(ie(h,s,v,s,1),ie(v,s,v,g,1),ie(v,g,h,g,1),ie(h,g,h,s,1),this.projection.name==="globe"){const[ae,Z]=l.polesInViewport(this);ae?(Q=90,L=180,B=-180):Z&&(q=-90,L=180,B=-180)}return new l.LngLatBounds(new l.LngLat(B,q),new l.LngLat(L,Q))}_getBoundsRectangular(s,h){const{top:g,left:v}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,I=new l.Point(v,g),D=new l.Point(A,g),B=new l.Point(A,b),L=new l.Point(v,b);let q=this.pointCoordinate(I,s),Q=this.pointCoordinate(D,s);const ne=this.pointCoordinate(B,h),oe=this.pointCoordinate(L,h),ie=(ae,Z)=>(Z.y-ae.y)/(Z.x-ae.x);return q.y>1&&Q.y>=0?q=new l.MercatorCoordinate((1-oe.y)/ie(oe,q)+oe.x,1):q.y<0&&Q.y<=1&&(q=new l.MercatorCoordinate(-oe.y/ie(oe,q)+oe.x,0)),Q.y>1&&q.y>=0?Q=new l.MercatorCoordinate((1-ne.y)/ie(ne,Q)+ne.x,1):Q.y<0&&q.y<=1&&(Q=new l.MercatorCoordinate(-ne.y/ie(ne,Q)+ne.x,0)),new l.LngLatBounds().extend(this.coordinateLocation(q)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(oe)).extend(this.coordinateLocation(ne))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=s.visibleDemTiles.reduce((g,v)=>{if(v.dem){const b=v.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-l.MAX_MERCATOR_LATITUDE,this.maxLat=l.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=l.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=l.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=l.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=l.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){const h=s.key,g=this._distanceTileDataCache;if(g[h])return g[h];const v=s.canonical,b=1/this.height,A=this.cameraWorldSize,I=A/this.zoomScale(v.z),D=(v.x+Math.pow(2,v.z)*s.wrap)*I,B=v.y*I,L=this.point;L.x*=A/this.worldSize,L.y*=A/this.worldSize;const q=this.angle,Q=Math.sin(-q),ne=-Math.cos(-q);return g[h]={bearing:[Q,ne],center:[(L.x-D)*b,(L.y-B)*b],scale:I/l.EXTENT*b},g[h]}calculateFogTileMatrix(s){const h=s.key,g=this._fogTileMatrixCache;if(g[h])return g[h];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return l.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(s,h=!1){const g=s.key,v=h?this._alignedProjMatrixCache:this._projMatrixCache;if(v[g])return v[g];const b=this.calculatePosMatrix(s,this.worldSize);return l.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(s){const h=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];const v=function(b,A){const{scale:I}=b.tileTransform,D=I*l.EXTENT/(b.tileSize*Math.pow(2,A.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return B=new Float32Array(4),Q=(L=A.inverseAdjustmentMatrix)[1],ne=L[2],oe=L[3],ae=(q=[D,D])[1],B[0]=L[0]*(ie=q[0]),B[1]=Q*ie,B[2]=ne*ae,B[3]=oe*ae,B;var B,L,q,Q,ne,oe,ie,ae}(s,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,h=l.fromScaling([],[s,s,s]);return l.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const h=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),b=l.mercatorZfromAltitude(1,this._center.lat);g[2]/=b,v[2]/=b,l.normalize(v,v);const A=s.raycast(g,v,s.exaggeration());if(A){const I=l.scaleAndAdd([],g,v,A),D=new l.MercatorCoordinate(I[0],I[1],l.mercatorZfromAltitude(I[2],l.latFromMercatorY(I[1]))),B=(D.z+l.length([D.x-g[0],D.y-g[1],D.z-g[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const h=this._elevation,g=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),b=h.getAtPointOrZero(new l.MercatorCoordinate(...v)),A=this.pixelsPerMeter/this.worldSize*b,I=this._minimumHeightOverTerrain(),D=v[2]-A;if(D<=I)if(D<0||s){const B=this.locationCoordinate(this._center,this._centerAltitude),L=[v[0],v[1],B.z-v[2]],q=l.length(L);L[2]-=(I-D)/this._pixelsPerMercatorPixel;const Q=l.length(L);if(Q===0)return;l.scale$2(L,L,q/Q*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],B.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const Q=this.center;return Q.lat=l.clamp(Q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(Q.lng=l.clamp(Q.lng,this.minLng,this.maxLng)),this.center=Q,void(this._constraining=!1)}const h=this._unmodified,{x:g,y:v}=this.point;let b=0,A=g,I=v;const D=this.width/2,B=this.height/2,L=this.worldMinY*this.scale,q=this.worldMaxY*this.scale;if(v-B<L&&(I=L+B),v+B>q&&(I=q-B),q-L<this.height&&(b=Math.max(b,this.height/(q-L)),I=(q+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Q=this.worldMinX*this.scale,ne=this.worldMaxX*this.scale,oe=this.worldSize/2-(Q+ne)/2;A=(g+oe+this.worldSize)%this.worldSize-oe,A-D<Q&&(A=Q+D),A+D>ne&&(A=ne-D),ne-Q<this.width&&(b=Math.max(b,this.width/(ne-Q)),A=(ne+Q)/2)}A===g&&I===v||(this.center=this.unproject(new l.Point(A,I))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=l.mercatorZfromAltitude(1,this.center.lat)/l.mercatorZfromAltitude(1,l.GLOBE_SCALE_MATCH_LATITUDE));const g=lh(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?h:1,b=this._camera.getWorldToCamera(this.worldSize,v),A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);A[8]=2*-s.x/this.width,A[9]=2*s.y/this.height;let I=l.mul([],A,b);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),we=l.identity([]);l.translate(we,we,[Se.x*this.worldSize,Se.y*this.worldSize,0]),l.multiply(we,we,Il(this)),l.translate(we,we,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),l.multiply(I,I,we),this.inverseAdjustmentMatrix=function(Ce){const Ie=Il(Ce,!0);return xe([],[Ie[0],Ie[1],Ie[4],Ie[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=l.scale([],I,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=I,this.invProjMatrix=l.invert(new Float64Array(16),this.projMatrix);const D=l.invert([],A);this.frustumCorners=l.FrustumCorners.fromInvProjectionMatrix(D,this.horizonLineFromTop(),this.height);const B=new Float32Array(16);l.identity(B),l.scale(B,B,[1,-1,1]),l.rotateX(B,B,this._pitch),l.rotateZ(B,B,this.angle);const L=l.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;L[8]=2*-s.x/this.width,L[9]=2*(s.y+q)/this.height,this.skyboxMatrix=l.multiply(B,L,B);const Q=this.point,ne=Q.x,oe=Q.y,ie=this.width%2/2,ae=this.height%2/2,Z=Math.cos(this.angle),re=Math.sin(this.angle),ue=ne-Math.round(ne)+Z*ie+re*ae,he=oe-Math.round(oe)+Z*ae+re*ie,be=new Float64Array(I);if(l.translate(be,be,[ue>.5?ue-1:ue,he>.5?he-1:he,0]),this.alignedProjMatrix=be,I=l.create(),l.scale(I,I,[this.width/2,-this.height/2,1]),l.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=l.create(),l.scale(I,I,[1,-1,1]),l.translate(I,I,[-1,-1,0]),l.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=l.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=l.calculateGlobeMatrix(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=l.transformMat4(Se,Se,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,b=[s,s,h];l.scale$2(b,b,v),l.scale$2(g,g,-1),l.multiply$2(g,g,b);const A=l.create();l.translate(A,A,g),l.scale(A,A,b),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,v)}_computeCameraPosition(s){const h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*b,v.y/this.worldSize-g[1]*b,s/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=s[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(b=Math.min((h-g)/v,1)),this._camera.position=l.scaleAndAdd([],this._camera.position,s,b),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),b=l.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(l.degToRad(this._maxPitch)),I=Math.max((s[2]-b)/Math.cos(g),A),D=this._zoomFromMercatorZ(I);l.scaleAndAdd(s,s,h,I),this._pitch=l.clamp(g,l.degToRad(this.minPitch),l.degToRad(this.maxPitch)),this.angle=l.wrap(v,-Math.PI,Math.PI),this._setZoom(l.clamp(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new l.MercatorCoordinate(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let h=0,g=l.GLOBE_ZOOM_THRESHOLD_MAX,v=0,b=1/0;for(;g-h>1e-6&&g>h;){const A=h+.5*(g-h),I=this.tileSize*Math.pow(2,A),D=this.getCameraToCenterDistance(this.projection,A,I),B=this.scaleZoom(D/(s*this.tileSize)),L=Math.abs(A-B);L<b&&(b=L,v=A),A<B?h=A:g=A}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(l.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,h){const g=Math.min(s.x,h.x),v=Math.max(s.x,h.x),b=Math.min(s.y,h.y),A=Math.max(s.y,h.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new l.Point(g,b),new l.Point(v,A),new l.Point(g,A),new l.Point(v,b)],D=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const L of I){const q=this.pointRayIntersection(L);if(q.t<0)return!0;const Q=this.rayIntersectionCoordinate(q);if(Q.x<D||Q.y<0||Q.x>B||Q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+l.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new l.Point(0,0),new l.Point(this.width,this.height))}zoomDeltaToMovement(s,h){const g=l.length(l.sub([],this._camera.position,s)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([h,g,v],b){const A=[h,g,v,1];l.transformMat4$1(A,A,b);const I=A[3]=Math.max(A[3],1e-6);return A[0]/=I,A[1]/=I,A[2]/=I,A}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new l.Point(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.Point(0,s))}}getCameraToCenterDistance(s,h=this.zoom,g=this.worldSize){const v=lh(s,h,this.width,this.height,1024),b=s.pixelSpaceConversion(this.center.lat,g,v);return .5/Math.tan(.5*this._fov)*this.height*b}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&l.multiply(s,s,this.globeMatrix),s}}function kl(f,s){let h=!1,g=null;const v=()=>{g=null,h&&(f(),g=setTimeout(v,s),h=!1)};return()=>(h=!0,g||v(),g)}class Ip{constructor(s){this._hashName=s&&encodeURIComponent(s),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=kl(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,l.window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),l.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const h=Hc(s);if(this._hashName){const g=this._hashName;let v=!1;const b=l.window.location.hash.slice(1).split("&").map(A=>{const I=A.split("=")[0];return I===g?(v=!0,`${I}=${h}`):A}).filter(A=>A);return v||b.push(`${g}=${h}`),`#${b.join("&")}`}return`#${h}`}_getCurrentHash(){const s=l.window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){const g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=l.window.location.href.replace(/(#.+)?$/,this.getHashString());l.window.history.replaceState(l.window.history.state,null,s)}}function Hc(f,s){const h=f.getCenter(),g=Math.round(100*f.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),A=Math.round(h.lng*b)/b,I=Math.round(h.lat*b)/b,D=f.getBearing(),B=f.getPitch();let L=s?`/${A}/${I}/${g}`:`${g}/${I}/${A}`;return(D||B)&&(L+="/"+Math.round(10*D)/10),B&&(L+=`/${Math.round(B)}`),L}const qc={linearity:.3,easing:l.bezier(0,0,.3,1)},uh=l.extend({deceleration:2500,maxSpeed:1400},qc),hh=l.extend({deceleration:20,maxSpeed:1400},qc),Et=l.extend({deceleration:1e3,maxSpeed:360},qc),Io=l.extend({deceleration:1e3,maxSpeed:90},qc);class I0{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=l.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new l.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){const b=Kc(h.pan.mag(),g,l.extend({},uh,s||{}));v.offset=h.pan.mult(b.amount/h.pan.mag()),v.center=this._map.transform.center,Zc(v,b)}if(h.zoom){const b=Kc(h.zoom,g,hh);v.zoom=this._map.transform.zoom+b.amount,Zc(v,b)}if(h.bearing){const b=Kc(h.bearing,g,Et);v.bearing=this._map.transform.bearing+l.clamp(b.amount,-179,179),Zc(v,b)}if(h.pitch){const b=Kc(h.pitch,g,Io);v.pitch=this._map.transform.pitch+b.amount,Zc(v,b)}if(v.zoom||v.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Zc(f,s){(!f.duration||f.duration<s.duration)&&(f.duration=s.duration,f.easing=s.easing)}function Kc(f,s,h){const{maxSpeed:g,linearity:v,deceleration:b}=h,A=l.clamp(f*v/(s/1e3),-g,g),I=Math.abs(A)/(b*v);return{easing:h.easing,duration:1e3*I,amount:A*(I/2)}}class Wn extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g,v={}){const b=J(h.getCanvasContainer(),g),A=h.unproject(b);super(s,l.extend({point:b,lngLat:A,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class Xc extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){const v=s==="touchend"?g.changedTouches:g.touches,b=te(h.getCanvasContainer(),v),A=b.map(D=>h.unproject(D)),I=b.reduce((D,B,L,q)=>D.add(B.div(q.length)),new l.Point(0,0));super(s,{points:b,point:I,lngLats:A,lngLat:h.unproject(I),originalEvent:g}),this._defaultPrevented=!1}}class dh extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){super(s,{originalEvent:g}),this._defaultPrevented=!1}}class Cp{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new dh(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Wn(s.type,this._map,s))}mouseup(s){this._map.fire(new Wn(s.type,this._map,s))}preclick(s){const h=l.extend({},s);h.type="preclick",this._map.fire(new Wn(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Wn(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Wn(s.type,this._map,s))}mouseover(s){this._map.fire(new Wn(s.type,this._map,s))}mouseout(s){this._map.fire(new Wn(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Xc(s.type,this._map,s))}touchmove(s){this._map.fire(new Xc(s.type,this._map,s))}touchend(s){this._map.fire(new Xc(s.type,this._map,s))}touchcancel(s){this._map.fire(new Xc(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ph{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Wn(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Wn(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class C0{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(V(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const g=h,v=this._startPos,b=this._lastPos;if(!v||!b||b.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const A=Math.min(v.x,g.x),I=Math.max(v.x,g.x),D=Math.min(v.y,g.y),B=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${D}px)`,this._box.style.width=I-A+"px",this._box.style.height=B-D+"px")})}mouseupWindow(s,h){if(!this._active)return;const g=this._startPos,v=h;if(g&&s.button===0){if(this.reset(),H(),g.x!==v.x||g.y!==v.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:b=>b.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),R(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new l.Event(s,{originalEvent:h}))}}function fh(f,s){const h={};for(let g=0;g<f.length;g++)h[f[g].identifier]=s[g];return h}class Pl{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const b=new l.Point(0,0);for(const A of v)b._add(A);return b.div(v.length)}(h),this.touches=fh(g,h)))}touchmove(s,h,g){if(this.aborted||!this.centroid)return;const v=fh(g,h);for(const b in this.touches){const A=v[b];(!A||A.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(s,h,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class kp{constructor(s){this.singleTap=new Pl(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,g){this.singleTap.touchstart(s,h,g)}touchmove(s,h,g){this.singleTap.touchmove(s,h,g)}touchend(s,h,g){const v=this.singleTap.touchend(s,h,g);if(v){const b=s.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(v)<30;if(b&&A||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class ux{constructor(){this._zoomIn=new kp({numTouches:1,numTaps:2}),this._zoomOut=new kp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,g){this._zoomIn.touchstart(s,h,g),this._zoomOut.touchstart(s,h,g)}touchmove(s,h,g){this._zoomIn.touchmove(s,h,g),this._zoomOut.touchmove(s,h,g)}touchend(s,h,g){const v=this._zoomIn.touchend(s,h,g),b=this._zoomOut.touchend(s,h,g);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(v)},{originalEvent:s})}):b?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(b)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const k0={0:1,2:2};class Dl{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const g=se(s);this._correctButton(s,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(s,h){const g=this._lastPoint;if(g){if(s.preventDefault(),this._eventButton!=null&&function(v,b){const A=k0[b];return v.buttons===void 0||(v.buttons&A)!==A}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(s){this._lastPoint&&se(s)===this._eventButton&&(this._moved&&H(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pp extends Dl{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class Dp extends Dl{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const g=.8*(h.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){s.preventDefault()}}class Mp extends Dl{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const g=-.5*(h.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){s.preventDefault()}}class mh{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),l.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new l.Point(0,0)}touchstart(s,h,g){return this._calculateTransform(s,h,g)}touchmove(s,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!l.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,h,g)}}touchend(s,h,g){this._calculateTransform(s,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,g){g.length>0&&(this._active=!0);const v=fh(g,h),b=new l.Point(0,0),A=new l.Point(0,0);let I=0;for(const B in v){const L=v[B],q=this._touches[B];q&&(b._add(L),A._add(L.sub(q)),I++,v[B]=L)}if(this._touches=v,I<this._minTouches||!A.mag())return;const D=A.div(I);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Yc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,g){return{}}touchstart(s,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,g){const v=this._firstTwoTouches;if(!v)return;s.preventDefault();const[b,A]=v,I=Qc(g,h,b),D=Qc(g,h,A);if(!I||!D)return;const B=this._aroundCenter?null:I.add(D).div(2);return this._move([I,D],B,s)}touchend(s,h,g){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,A=Qc(g,h,v),I=Qc(g,h,b);A&&I||(this._active&&H(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Qc(f,s,h){for(let g=0;g<f.length;g++)if(f[g].identifier===h)return s[g]}function zp(f,s){return Math.log(f/s)/Math.LN2}class P0 extends Yc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(zp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zp(this._distance,g),pinchAround:h}}}function Rp(f,s){return 180*f.angleWith(s)/Math.PI}class D0 extends Yc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Rp(this._vector,g),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const v=Rp(s,g);return Math.abs(v)<h}}function ts(f){return Math.abs(f.y)>Math.abs(f.x)}class M0 extends Yc{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,ts(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,g){const v=this._lastPoints;if(!v)return;const b=s[0].sub(v[0]),A=s[1].sub(v[1]);return this._map._cooperativeGestures&&!l.isFullscreen()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,A,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(b.y+A.y)/2*-.5})}gestureBeginsVertically(s,h,g){if(this._valid!==void 0)return this._valid;const v=s.mag()>=2,b=h.mag()>=2;if(!v&&!b)return;if(!v||!b)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const A=s.y>0==h.y>0;return ts(s)&&ts(h)&&A}}const z0={panStep:100,bearingStep:15,pitchStep:10};class hx{constructor(){const s=z0;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,g=0,v=0,b=0,A=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),b=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),b=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),A=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:I=>{const D=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:R0,zoom:h?Math.round(D)+h*(s.shiftKey?2:1):D,bearing:I.getBearing()+g*this._bearingStep,pitch:I.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-A*this._panStep],center:I.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function R0(f){return f*(2-f)}const Op=4.000244140625;class O0{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||l.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const g=l.exported.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%Op==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=J(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>Op?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&B!==0&&(B=1/B);const L=h(),q=Math.pow(2,L),Q=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(Q*B))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,b=this._easing;let A,I=!1;if(this._type==="wheel"&&v&&b){const D=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),B=b(D);A=l.number(v,g,B),D<1?this._frameId||(this._frameId=!0):I=!0}else A=g,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:A-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=l.ease;if(this._prevEase){const g=this._prevEase,v=(l.exported.now()-g.start)/g.duration,b=g.easing(v+.01)-g.easing(v),A=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-A*A);h=l.bezier(A,I,.25,1)}return this._prevEase={start:l.exported.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(l.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class F0{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ci{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dx{constructor(){this._tap=new kp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,h,g))}touchmove(s,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=h[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(s,h,g)}touchend(s,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(s,h,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class L0{constructor(s,h,g){this._el=s,this._mousePan=h,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class px{constructor(s,h,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fx{constructor(s,h,g,v){this._el=s,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const oo=f=>f.zoom||f.drag||f.pitch||f.rotate;class B0 extends l.Event{}class mx{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){const g=l.sub([],h,s);this.radius=l.length(g[2]<0?l.div([],g,this.constants):[g[0],g[1],0])}projectRay(s){l.div(s,s,this.constants),l.normalize(s,s),l.mul$1(s,s,this.constants);const h=l.scale$2([],s,this.radius);if(h[2]>0){const g=l.scale$2([],[0,0,1],l.dot(h,[0,0,1])),v=l.scale$2([],l.normalize([],[h[0],h[1],0]),this.radius),b=l.add([],h,l.scale$2([],l.sub([],l.add([],v,g),h),2));h[0]=b[0],h[1]=b[1]}return h}}function Co(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Qo{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new I0(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new mx,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),l.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[l.window,"blur",void 0]];for(const[v,b,A]of this._listeners)v.addEventListener(b,v===l.window.document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[s,h,g]of this._listeners)s.removeEventListener(h,s===l.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(s){const h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new Cp(h,s));const v=h.boxZoom=new C0(h,s);this._add("boxZoom",v);const b=new ux,A=new ci;h.doubleClickZoom=new F0(A,b),this._add("tapZoom",b),this._add("clickZoom",A);const I=new dx;this._add("tapDragZoom",I);const D=h.touchPitch=new M0(h);this._add("touchPitch",D);const B=new Dp(s),L=new Mp(s);h.dragRotate=new px(s,B,L),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const q=new Pp(s),Q=new mh(h,s);h.dragPan=new L0(g,q,Q),this._add("mousePan",q),this._add("touchPan",Q,["touchZoom","touchRotate"]);const ne=new D0,oe=new P0;h.touchZoomRotate=new fx(g,oe,ne,I),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ph(h));const ie=h.scrollZoom=new O0(h,this);this._add("scrollZoom",ie,["mousePan"]);const ae=h.keyboard=new hx;this._add("keyboard",ae);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[Z]&&h[Z].enable(s[Z])}_add(s,h,g){this._handlers.push({handlerName:s,handler:h,allowed:g}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!oo(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,h,g){for(const v in s)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const g of s)this._el.contains(g.target)&&h.push(g);return h}handleEvent(s,h){this._updatingCamera=!0;const g=s.type==="renderFrame",v=g?void 0:s,b={needsRenderFrame:!1},A={},I={},D=s.touches?this._getMapTouches(s.touches):void 0,B=D?te(this._el,D):g?void 0:J(this._el,s);for(const{handlerName:Q,handler:ne,allowed:oe}of this._handlers){if(!ne.isEnabled())continue;let ie;this._blockedByActive(I,oe,Q)?ne.reset():ne[h||s.type]&&(ie=ne[h||s.type](s,B,D),this.mergeHandlerResult(b,A,ie,Q,v),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||ne.isActive())&&(I[Q]=ne)}const L={};for(const Q in this._previousActiveHandlers)I[Q]||(L[Q]=v);this._previousActiveHandlers=I,(Object.keys(L).length||Co(b))&&(this._changes.push([b,A,L]),this._triggerRenderFrame()),(Object.keys(I).length||Co(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=b;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(s,h,g,v,b){if(!g)return;l.extend(s,g);const A={handlerName:v,originalEvent:g.originalEvent||b};g.zoomDelta!==void 0&&(h.zoom=A),g.panDelta!==void 0&&(h.drag=A),g.pitchDelta!==void 0&&(h.pitch=A),g.bearingDelta!==void 0&&(h.rotate=A)}_applyChanges(){const s={},h={},g={};for(const[v,b,A]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new l.Point(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(s.around=v.around),v.aroundCoord!==void 0&&(s.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),l.extend(h,b),l.extend(g,A);this._updateMapTransform(s,h,g),this._changes=[]}_updateMapTransform(s,h,g){const v=this._map,b=v.transform,A=re=>[re.x,re.y,re.z];if((re=>{const ue=this._eventsInProgress.drag;return ue&&!this._handlersById[ue.handlerName].isActive()})()&&!Co(s)){const re=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",re!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&v._stop(!0),!Co(s))return void this._fireEvents(h,g,!0);let{panDelta:I,zoomDelta:D,bearingDelta:B,pitchDelta:L,around:q,aroundCoord:Q,pinchAround:ne}=s;b._isCameraConstrained&&(D>0&&(D=0),b._isCameraConstrained=!1),ne!==void 0&&(q=ne),(D||(re=>h[re]&&!this._eventsInProgress[re])("drag"))&&q&&(this._dragOrigin=A(b.pointCoordinate3D(q)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),q=q||v.transform.centerPoint,B&&(b.bearing+=B),L&&(b.pitch+=L),b._updateCameraState();const oe=[0,0,0];if(I)if(b.projection.name==="mercator"){const re=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(q).dir),ue=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(q.sub(I)).dir);oe[0]=ue[0]-re[0],oe[1]=ue[1]-re[1]}else{const re=b.pointCoordinate(q);if(b.projection.name==="globe"){I=I.rotate(-b.angle);const ue=b._pixelsPerMercatorPixel/b.worldSize;oe[0]=-I.x*l.mercatorScale(l.latFromMercatorY(re.y))*ue,oe[1]=-I.y*l.mercatorScale(b.center.lat)*ue}else{const ue=b.pointCoordinate(q.sub(I));re&&ue&&(oe[0]=ue.x-re.x,oe[1]=ue.y-re.y)}}const ie=b.zoom,ae=[0,0,0];if(D){const re=A(Q||b.pointCoordinate3D(q)),ue={dir:l.normalize([],l.sub([],re,b._camera.position))};if(ue.dir[2]<0){const he=b.zoomDeltaToMovement(re,D);l.scale$2(ae,ue.dir,he)}}const Z=l.add(oe,oe,ae);b._translateCameraConstrained(Z),D&&Math.abs(b.zoom-ie)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,g,!0)}_fireEvents(s,h,g){const v=oo(this._eventsInProgress),b=oo(s),A={};for(const L in s){const{originalEvent:q}=s[L];this._eventsInProgress[L]||(A[`${L}start`]=q),this._eventsInProgress[L]=s[L]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in A)this._fireEvent(L,A[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in s){const{originalEvent:q}=s[L];this._fireEvent(L,q)}const I={};let D;for(const L in this._eventsInProgress){const{handlerName:q,originalEvent:Q}=this._eventsInProgress[L];this._handlersById[q].isActive()||(delete this._eventsInProgress[L],D=h[q]||Q,I[`${L}end`]=D)}for(const L in I)this._fireEvent(L,I[L]);const B=oo(this._eventsInProgress);if(g&&(v||b)&&!B){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=Q=>Q!==0&&-this._bearingSnap<Q&&Q<this._bearingSnap;L?(q(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:D})):(this._map.fire(new l.Event("moveend",{originalEvent:D})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new l.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new B0("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ns="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class gh extends l.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,g){return s=l.Point.convert(s).mult(-1),this.panTo(this.transform.center,l.extend({offset:s},h),g)}panTo(s,h,g){return this.easeTo(l.extend({center:s},h),g)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,g){return this.easeTo(l.extend({zoom:s},h),g)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,g){return this.easeTo(l.extend({bearing:s},h),g)}resetNorth(s,h){return this.rotateTo(0,l.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=l.LngLatBounds.convert(s);const g=h&&h.bearing||0,v=h&&h.pitch||0,b=s.getNorthWest(),A=s.getSouthEast();return this._cameraForBounds(this.transform,b,A,g,v,h)}_extendCameraOptions(s){const h={top:0,bottom:0,right:0,left:0};if(typeof(s=l.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){const g=s.padding;s.padding={top:g,bottom:g,right:g,left:g}}return s.padding=l.extend(h,s.padding),s}_minimumAABBFrustumDistance(s,h){const g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,h,g,v,b,A){const I=s.clone(),D=this._extendCameraOptions(A);I.bearing=v,I.pitch=b;const B=l.LngLat.convert(h),L=l.LngLat.convert(g),q=.5*(B.lat+L.lat),Q=.5*(B.lng+L.lng),ne=l.latLngToECEF(q,Q),oe=l.normalize([],ne),ie=l.normalize([],l.cross([],oe,[0,1,0])),ae=l.cross([],ie,oe),Z=[ie[0],ie[1],ie[2],0,ae[0],ae[1],ae[2],0,oe[0],oe[1],oe[2],0,0,0,0,1],re=[ne,l.latLngToECEF(B.lat,B.lng),l.latLngToECEF(L.lat,B.lng),l.latLngToECEF(L.lat,L.lng),l.latLngToECEF(B.lat,L.lng),l.latLngToECEF(q,B.lng),l.latLngToECEF(q,L.lng),l.latLngToECEF(B.lat,Q),l.latLngToECEF(L.lat,Q)];let ue=l.Aabb.fromPoints(re.map(tt=>[l.dot(ie,tt),l.dot(ae,tt),l.dot(oe,tt)]));const he=l.transformMat4([],ue.center,Z);l.squaredLength(he)===0&&l.set(he,0,0,1),l.normalize(he,he),l.scale$2(he,he,l.GLOBE_RADIUS),I.center=l.ecefToLatLng(he);const be=I.getWorldToCameraMatrix(),Se=l.invert(new Float64Array(16),be);ue=l.Aabb.applyTransform(ue,l.multiply([],be,Z)),l.transformMat4(he,he,be);const we=.5*(ue.max[2]-ue.min[2]),Ce=this._minimumAABBFrustumDistance(I,ue),Ie=l.scale$2([],[0,0,1],we),Re=l.add(Ie,he,Ie),st=Ce+(I.pitch===0?0:l.distance(he,Re)),De=I.globeCenterInViewSpace,Ke=l.sub([],he,[De[0],De[1],De[2]]);l.normalize(Ke,Ke),l.scale$2(Ke,Ke,st);const Ne=l.add([],he,Ke);l.transformMat4(Ne,Ne,Se);const at=l.earthRadius/l.GLOBE_RADIUS,ze=l.length(Ne),Ze=l.mercatorZfromAltitude(Math.max(ze*at-l.earthRadius,Number.EPSILON),0),ut=Math.min(I.zoomFromMercatorZAdjusted(Ze),D.maxZoom);return ut>.5*(l.GLOBE_ZOOM_THRESHOLD_MIN+l.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"mercator"}),I.zoom=ut,this._cameraForBounds(I,h,g,v,b,A)):{center:I.center,zoom:ut,bearing:v,pitch:b}}queryTerrainElevation(s,h){const g=this.transform.elevation;return g?(h=l.extend({},{exaggerated:!0},h),g.getAtPoint(l.MercatorCoordinate.fromLngLat(s),null,h.exaggerated)):null}_cameraForBounds(s,h,g,v,b,A){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,h,g,v,b,A);const I=s.clone(),D=this._extendCameraOptions(A),B=I.padding;I.bearing=v,I.pitch=b;const L=l.LngLat.convert(h),q=l.LngLat.convert(g),Q=new l.LngLat(L.lng,q.lat),ne=new l.LngLat(q.lng,L.lat),oe=I.project(L),ie=I.project(q),ae=this.queryTerrainElevation(L),Z=this.queryTerrainElevation(q),re=this.queryTerrainElevation(Q),ue=this.queryTerrainElevation(ne),he=[[oe.x,oe.y,Math.min(ae||0,Z||0,re||0,ue||0)],[ie.x,ie.y,Math.max(ae||0,Z||0,re||0,ue||0)]];let be=l.Aabb.fromPoints(he);const Se=I.getWorldToCameraMatrix(),we=l.invert(new Float64Array(16),Se);be=l.Aabb.applyTransform(be,Se);const Ce=l.sub([],be.max,be.min),Ie=B.left||0,Re=B.right||0,st=B.bottom||0,De=B.top||0,{left:Ke,right:Ne,top:at,bottom:ze}=D.padding,Ze=.5*(Ie+Re),ut=.5*(De+st),tt=Math.min(I.scaleZoom(I.scale*Math.min((I.width-(Ie+Re+Ke+Ne))/Ce[0],(I.height-(st+De+ze+at))/Ce[1])),D.maxZoom),ht=I.scale/I.zoomScale(tt);be=new l.Aabb([be.min[0]-(Ke+Ze)*ht,be.min[1]-(ze+ut)*ht,be.min[2]],[be.max[0]+(Ne+Ze)*ht,be.max[1]+(at+ut)*ht,be.max[2]]);const Mt=.5*Ce[2],$t=this._minimumAABBFrustumDistance(I,be),At=[0,0,1,0];l.transformMat4$1(At,At,Se),l.normalize$2(At,At);const Lt=l.scale$2([],At,$t+Mt),nr=l.add([],be.center,Lt),er=(typeof D.offset.x=="number"&&typeof D.offset.y=="number"?new l.Point(D.offset.x,D.offset.y):l.Point.convert(D.offset)).rotate(-l.degToRad(v));be.center[0]-=er.x*ht,be.center[1]+=er.y*ht,l.transformMat4(be.center,be.center,we),l.transformMat4(nr,nr,we);const Pt=[be.center[0],be.center[1],nr[2]*I.pixelsPerMeter];l.scale$2(Pt,Pt,1/I.worldSize);const Ar=l.lngFromMercatorX(Pt[0]),Mr=l.latFromMercatorY(Pt[1]),zr=Math.min(I._zoomFromMercatorZ(Pt[2]),D.maxZoom),Rr=new l.LngLat(Ar,Mr);return I.mercatorFromTransition&&zr<.5*(l.GLOBE_ZOOM_THRESHOLD_MIN+l.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"globe"}),I.zoom=zr,this._cameraForBounds(I,h,g,v,b,A)):{center:Rr,zoom:zr,bearing:v,pitch:b}}fitBounds(s,h,g){const v=this.cameraForBounds(s,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(s,h,g,v,b){const A=l.Point.convert(s),I=l.Point.convert(h),D=new l.Point(Math.min(A.x,I.x),Math.min(A.y,I.y)),B=new l.Point(Math.max(A.x,I.x),Math.max(A.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,I))return this;const L=this.transform.pointLocation3D(D),q=this.transform.pointLocation3D(B),Q=this.transform.pointLocation3D(new l.Point(D.x,B.y)),ne=this.transform.pointLocation3D(new l.Point(B.x,D.y)),oe=[Math.min(L.lng,q.lng,Q.lng,ne.lng),Math.min(L.lat,q.lat,Q.lat,ne.lat)],ie=[Math.max(L.lng,q.lng,Q.lng,ne.lng),Math.max(L.lat,q.lat,Q.lat,ne.lat)],ae=v&&v.pitch?v.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,oe,ie,g,ae,v);return this._fitInternal(Z,v,b)}_fitInternal(s,h,g){return s?(delete(h=l.extend(s,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this}jumpTo(s,h){this.stop();const g=s.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,A=!1;return"zoom"in s&&g.zoom!==+s.zoom&&(v=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=l.LngLat.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(b=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(A=!0,g.pitch=+s.pitch),s.padding==null||g.isPaddingEqual(s.padding)||(g.padding=s.padding),s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),v&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),b&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),A&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||l.warnOnce(Ns),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){const g=this.transform;if(!g.projection.supportsFreeCamera)return l.warnOnce(Ns),this;this.stop();const v=g.zoom,b=g.pitch,A=g.bearing;g.setFreeCameraOptions(s);const I=v!==g.zoom,D=b!==g.pitch,B=A!==g.bearing;return this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),I&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),B&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),D&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),((s=l.extend({offset:[0,0],duration:500,easing:l.ease},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const g=this.transform,v=this.getZoom(),b=this.getBearing(),A=this.getPitch(),I=this.getPadding(),D="zoom"in s?+s.zoom:v,B="bearing"in s?this._normalizeBearing(s.bearing,b):b,L="pitch"in s?+s.pitch:A,q="padding"in s?s.padding:g.padding,Q=l.Point.convert(s.offset);let ne,oe,ie;if(g.projection.name==="globe"){const Ie=l.MercatorCoordinate.fromLngLat(g.center),Re=Q.rotate(-g.angle);Ie.x+=Re.x/g.worldSize,Ie.y+=Re.y/g.worldSize;const st=Ie.toLngLat(),De=l.LngLat.convert(s.center||st);this._normalizeCenter(De),ne=g.centerPoint.add(Re),oe=new l.Point(Ie.x,Ie.y).mult(g.worldSize),ie=new l.Point(l.mercatorXfromLng(De.lng),l.mercatorYfromLat(De.lat)).mult(g.worldSize).sub(oe)}else{ne=g.centerPoint.add(Q);const Ie=g.pointLocation(ne),Re=l.LngLat.convert(s.center||Ie);this._normalizeCenter(Re),oe=g.project(Ie),ie=g.project(Re).sub(oe)}const ae=g.zoomScale(D-v);let Z,re;s.around&&(Z=l.LngLat.convert(s.around),re=g.locationPoint(Z));const ue=this._zooming||D!==v,he=this._rotating||b!==B,be=this._pitching||L!==A,Se=!g.isPaddingEqual(q),we=Ie=>Re=>{if(ue&&(Ie.zoom=l.number(v,D,Re)),he&&(Ie.bearing=l.number(b,B,Re)),be&&(Ie.pitch=l.number(A,L,Re)),Se&&(Ie.interpolatePadding(I,q,Re),ne=Ie.centerPoint.add(Q)),Z)Ie.setLocationAtPoint(Z,re);else{const st=Ie.zoomScale(Ie.zoom-v),De=D>v?Math.min(2,ae):Math.max(.5,ae),Ke=Math.pow(De,1-Re),Ne=Ie.unproject(oe.add(ie.mult(Re*Ke)).mult(st));Ie.setLocationAtPoint(Ie.renderWorldCopies?Ne.wrap():Ne,ne)}return s.preloadOnly||this._fireMoveEvents(h),Ie};if(s.preloadOnly){const Ie=this._emulate(we,s.duration,g);return this._preloadTiles(Ie),this}const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ue,this._rotating=he,this._pitching=be,this._padding=Se,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,Ce),this._ease(we(g),Ie=>{g.recenterOnTerrain(),this._afterEase(h,Ie)},s),this}_prepareEase(s,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||g.moving||this.fire(new l.Event("movestart",s)),this._zooming&&!g.zooming&&this.fire(new l.Event("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new l.Event("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new l.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new l.Event("move",s)),this._zooming&&this.fire(new l.Event("zoom",s)),this._rotating&&this.fire(new l.Event("rotate",s)),this._pitching&&this.fire(new l.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new l.Event("zoomend",s)),v&&this.fire(new l.Event("rotateend",s)),b&&this.fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))}flyTo(s,h){if(this._prefersReducedMotion(s)){const tt=l.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(tt,h)}this.stop(),s=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},s);const g=this.transform,v=this.getZoom(),b=this.getBearing(),A=this.getPitch(),I=this.getPadding(),D="zoom"in s?l.clamp(+s.zoom,g.minZoom,g.maxZoom):v,B="bearing"in s?this._normalizeBearing(s.bearing,b):b,L="pitch"in s?+s.pitch:A,q="padding"in s?s.padding:g.padding,Q=g.zoomScale(D-v),ne=l.Point.convert(s.offset);let oe=g.centerPoint.add(ne);const ie=g.pointLocation(oe),ae=l.LngLat.convert(s.center||ie);this._normalizeCenter(ae);const Z=g.project(ie),re=g.project(ae).sub(Z);let ue=s.curve;const he=Math.max(g.width,g.height),be=he/Q,Se=re.mag();if("minZoom"in s){const tt=l.clamp(Math.min(s.minZoom,v,D),g.minZoom,g.maxZoom),ht=he/g.zoomScale(tt-v);ue=Math.sqrt(ht/Se*2)}const we=ue*ue;function Ce(tt){const ht=(be*be-he*he+(tt?-1:1)*we*we*Se*Se)/(2*(tt?be:he)*we*Se);return Math.log(Math.sqrt(ht*ht+1)-ht)}function Ie(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function Re(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const st=Ce(0);let De=function(tt){return Re(st)/Re(st+ue*tt)},Ke=function(tt){return he*((Re(st)*(Ie(ht=st+ue*tt)/Re(ht))-Ie(st))/we)/Se;var ht},Ne=(Ce(1)-st)/ue;if(Math.abs(Se)<1e-6||!isFinite(Ne)){if(Math.abs(he-be)<1e-6)return this.easeTo(s,h);const tt=be<he?-1:1;Ne=Math.abs(Math.log(be/he))/ue,Ke=function(){return 0},De=function(ht){return Math.exp(tt*ue*ht)}}s.duration="duration"in s?+s.duration:1e3*Ne/("screenSpeed"in s?+s.screenSpeed/ue:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const at=b!==B,ze=L!==A,Ze=!g.isPaddingEqual(q),ut=tt=>ht=>{const Mt=ht*Ne,$t=1/De(Mt);tt.zoom=ht===1?D:v+tt.scaleZoom($t),at&&(tt.bearing=l.number(b,B,ht)),ze&&(tt.pitch=l.number(A,L,ht)),Ze&&(tt.interpolatePadding(I,q,ht),oe=tt.centerPoint.add(ne));const At=ht===1?ae:tt.unproject(Z.add(re.mult(Ke(Mt))).mult($t));return tt.setLocationAtPoint(tt.renderWorldCopies?At.wrap():At,oe),tt._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),tt};if(s.preloadOnly){const tt=this._emulate(ut,s.duration,g);return this._preloadTiles(tt),this}return this._zooming=!0,this._rotating=at,this._pitching=ze,this._padding=Ze,this._prepareEase(h,!1),this._ease(ut(g),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!s){const g=this.handlers;g&&g.stop(!1)}return this}_ease(s,h,g){g.animate===!1||g.duration===0?(s(1),h()):(this._easeStart=l.exported.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=l.wrap(s,-180,180);const g=Math.abs(s-h);return Math.abs(s-360-h)<g&&(s-=360),Math.abs(s+360-h)<g&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const g=s.lng-h.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&l.exported.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,h,g){const v=Math.ceil(15*h/1e3),b=[],A=s(g.clone());for(let I=0;I<=v;I++){const D=A(I/v);b.push(D.clone())}return b}}class Tt{constructor(s={}){this.options=s,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const h=this.options&&this.options.compact;return this._map=s,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=z("button","mapboxgl-ctrl-attrib-button",this._container),z("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const g=this._map._getUIString(`AttributionControl.${h}`);s.setAttribute("aria-label",g),s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(s){const g=h.reduce((v,b,A)=>(b.value&&(v+=`${b.key}=${b.value}${A<h.length-1?"&":""}`),v),"?");s.href=`${l.config.FEEDBACK_URL}/${g}#${Hc(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const h=this._map.style._sourceCaches;for(const v in h){const b=h[v];if(b.used){const A=b.getSource();A.attribution&&s.indexOf(A.attribution)<0&&s.push(A.attribution)}}s.sort((v,b)=>v.length-b.length),s=s.filter((v,b)=>{for(let A=b+1;A<s.length;A++)if(s[A].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fp{constructor(){l.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=z("div","mapboxgl-ctrl");const h=z("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const h in s){const g=s[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Lp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(const v of g)if(v.id===s)return void(v.cancelled=!0)}run(s=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const g of h)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ml(f,s,h){if(f=new l.LngLat(f.lng,f.lat),s){const g=new l.LngLat(f.lng-360,f.lat),v=new l.LngLat(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-h.center.lng)/360),A=h.locationPoint(f).distSqr(s),I=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint(g).distSqr(s)<A&&(I||Math.abs(g.lng-h.center.lng)<b)?f=g:h.locationPoint(v).distSqr(s)<A&&(I||Math.abs(v.lng-h.center.lng)<b)&&(f=v)}for(;Math.abs(f.lng-h.center.lng)>180;){const g=h.locationPoint(f);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}const Us={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class xt extends l.Evented{constructor(s,h){if(super(),(s instanceof l.window.HTMLElement||h)&&(s=l.extend({element:s},h)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=l.Point.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=z("div");const v=41,b=27,A=$("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),I=$("radialGradient",{id:"shadowGradient"},$("defs",{},A));$("stop",{offset:"10%","stop-opacity":.4},I),$("stop",{offset:"100%","stop-opacity":.05},I),$("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),$("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),$("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),$("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=l.Point.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const g=this._element.classList;for(const v in Us)g.remove(`mapboxgl-marker-anchor-${v}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const h=s.code,g=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,h=this._pos;if(!s||!h)return!1;const g=s.unproject(h),v=s.getFreeCameraOptions();if(!v.position)return!1;const b=v.position.toLngLat();return b.distanceTo(g)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();const g=s.unproject(h);let v;s._showingGlobe()&&l.isLngLatBehindGlobe(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${Us[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const s=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!s||g!=="map")return"";if(!h._showingGlobe()){const D=h.getPitch();return D?`rotateX(${D}deg)`:""}const v=l.radToDeg(l.globeTiltAtLngLat(h.transform,this._lngLat)),b=s.sub(l.globeCenterToScreenPoint(h.transform)),A=Math.abs(b.x)+Math.abs(b.y);if(A===0)return"";const I=v/A;return`rotateX(${-b.y*I}deg) rotateY(${b.x*I}deg)`}_calculateZTransform(){const s=this._pos,h=this._map;if(!h||!s)return"";let g=0;const v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){const b=h.project(new l.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),A=h.project(new l.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);g=l.radToDeg(Math.atan2(A.y,A.x))-90}else g=-h.getBearing();else if(v==="horizon"){const b=l.smoothstep(4,6,h.getZoom()),A=l.globeCenterToScreenPoint(h.transform);A.y+=b*h.transform.height;const I=s.sub(A),D=l.radToDeg(Math.atan2(I.y,I.x));g=(D>90?D-270:D+90)*(1-b)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){l.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Ml(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),s===!0?this._updateFrameId=l.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=l.Point.convert(s),this._update(),this}_onMove(s){const h=this._map;if(!h)return;const g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){const b=this._clickTolerance||h._clickTolerance;if(s.point.dist(g)<b)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(s){const h=this._map,g=this._pos;h&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Bp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},gx=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function N0(f=new l.Point(0,0),s="bottom"){if(typeof f=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(s){case"top":return new l.Point(0,f);case"top-left":return new l.Point(h,h);case"top-right":return new l.Point(-h,h);case"bottom":return new l.Point(0,-f);case"bottom-left":return new l.Point(h,-h);case"bottom-right":return new l.Point(-h,-h);case"left":return new l.Point(f,0);case"right":return new l.Point(-f,0)}return new l.Point(0,0)}return f instanceof l.Point||Array.isArray(f)?l.Point.convert(f):l.Point.convert(f[s]||[0,0])}class Np{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const h=l.easeCubicInOut((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,g){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+g}}const U0={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},j0={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},yx={showCompass:!0,showZoom:!0,visualizePitch:!1};class _x{constructor(s,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Dp({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new Mp({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),V()}move(s,h){const g=this.map,v=this.mouseRotate.mousemoveWindow(s,h),b=v&&v.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const A=this.mousePitch.mousemoveWindow(s,h),I=A&&A.pitchDelta;I&&g.setPitch(g.getPitch()+I)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){R(),l.window.removeEventListener("mousemove",this.mousemove),l.window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(l.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),J(this.element,s)),l.window.addEventListener("mousemove",this.mousemove),l.window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,J(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=te(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=te(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Up={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},jp={maxWidth:100,unit:"metric"},Vp={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},zl={version:l.version,supported:T,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends gh{constructor(f){if(l.LivePerformanceUtils.mark(l.PerformanceMarkers.create),(f=l.extend({},j0,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&l.isSafariWithAntialiasingBug(l.window)&&(f.antialias=!1,l.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Cl(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._useWebGL2=f.useWebGL2,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new Lp,this._domRenderTaskQueue=new Lp,this._controls=[],this._markers=[],this._popups=[],this._mapId=l.uniqueId(),this._locale=l.extend({},U0,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Np(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new l.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,typeof f.container=="string"){if(this._container=l.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof l.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&l.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),l.window!==void 0&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1),l.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Qo(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new Ip(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,l.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Tt({customAttribution:f.customAttribution})),this._logoControl=new Fp,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new l.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new l.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(f,s){if(s===void 0&&(s=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=f.onAdd(this);this._controls.push(f);const g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(f);return s>-1&&this._controls.splice(s,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new l.Event("movestart",f)).fire(new l.Event("move",f)),this.fire(new l.Event("resize",f)),s&&this.fire(new l.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(l.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?l.window.navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(s=>s==="auto"?l.window.navigator.language:s):f}setLanguage(f){const s=this._parseLanguage(f);if(!this.style||s===this._language)return this;this._language=s,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,s=f.projection.name;let h;s==="globe"&&f.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX?(f.setMercatorFromTransition(),h=!0):s==="mercator"&&f.zoom<l.GLOBE_ZOOM_THRESHOLD_MAX&&(f.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,s){return this._updateProjection(f||s||{name:"mercator"})}_updateProjection(f){let s;if(s=f.name==="globe"&&this.transform.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),s){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(f){return this.transform.locationPoint3D(l.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(l.Point.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,s,h){if(f==="mouseenter"||f==="mouseover"){let g=!1;const v=A=>{const I=s.filter(B=>this.getLayer(B)),D=I.length?this.queryRenderedFeatures(A.point,{layers:I}):[];D.length?g||(g=!0,h.call(this,new Wn(f,this,A.originalEvent,{features:D}))):g=!1},b=()=>{g=!1};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:b}}}if(f==="mouseleave"||f==="mouseout"){let g=!1;const v=A=>{const I=s.filter(D=>this.getLayer(D));(I.length?this.queryRenderedFeatures(A.point,{layers:I}):[]).length?g=!0:g&&(g=!1,h.call(this,new Wn(f,this,A.originalEvent)))},b=A=>{g&&(g=!1,h.call(this,new Wn(f,this,A.originalEvent)))};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:b}}}{const g=v=>{const b=s.filter(I=>this.getLayer(I)),A=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];A.length&&(v.features=A,h.call(this,v),delete v.features)};return{layers:new Set(s),listener:h,delegates:{[f]:g}}}}on(f,s,h){if(h===void 0)return super.on(f,s);Array.isArray(s)||(s=[s]);const g=this._createDelegatedListener(f,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(f,s,h){if(h===void 0)return super.once(f,s);Array.isArray(s)||(s=[s]);const g=this._createDelegatedListener(f,s,h);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(f,s,h){if(h===void 0)return super.off(f,s);s=new Set(Array.isArray(s)?s:[s]);const g=(b,A)=>{if(b.size!==A.size)return!1;for(const I of b)if(!A.has(I))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[f]:void 0;return v&&(b=>{for(let A=0;A<b.length;A++){const I=b[A];if(I.listener===h&&g(I.layers,s)){for(const D in I.delegates)this.off(D,I.delegates[D]);return b.splice(A,1),this}}})(v),this}queryRenderedFeatures(f,s){return this.style?(s!==void 0||f===void 0||f instanceof l.Point||Array.isArray(f)||(s=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],s=s||{},this.transform)):[]}querySourceFeatures(f,s){return this.style.querySourceFeatures(f,s)}isPointOnSurface(f){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&l.warnOnce(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(l.Point.convert(f))}setStyle(f,s){return(s=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(f,s))}_getUIString(f){const s=this._locale[f];if(s==null)throw new Error(`Missing UI string '${f}'`);return s}_updateStyle(f,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new Xo(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,s){if(typeof f=="string"){const h=this._requestManager.normalizeStyleURL(f),g=this._requestManager.transformRequest(h,l.ResourceType.Style);l.getJSON(g,(v,b)=>{v?this.fire(new l.ErrorEvent(v)):b&&this._updateDiff(b,s)})}else typeof f=="object"&&this._updateDiff(f,s)}_updateDiff(f,s){try{this.style.setState(f)&&this._update(!0)}catch(h){l.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(f,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(l.warnOnce("There is no style added to the map."),!1)}addSource(f,s){return this._lazyInitEmptyStyle(),this.style.addSource(f,s),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const s in f){const h=f[s]._tiles;for(const g in h){const v=h[g];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}addSourceType(f,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(f,s,h)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,s,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:b,content:A}={}){if(this._lazyInitEmptyStyle(),s instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&s instanceof l.window.ImageBitmap){const{width:I,height:D,data:B}=l.exported.getImageData(s);this.style.addImage(f,{data:new l.RGBAImage({width:I,height:D},B),pixelRatio:h,stretchX:v,stretchY:b,content:A,sdf:g,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:D}=s,B=s;this.style.addImage(f,{data:new l.RGBAImage({width:I,height:D},new Uint8Array(B.data)),pixelRatio:h,stretchX:v,stretchY:b,content:A,sdf:g,version:0,userImage:B}),B.onAdd&&B.onAdd(this,f)}}updateImage(f,s){const h=this.style.getImage(f);if(!h)return void this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=s instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&s instanceof l.window.ImageBitmap?l.exported.getImageData(s):s,{width:v,height:b}=g;v!==void 0&&b!==void 0?v===h.data.width&&b===h.data.height?(h.data.replace(g.data,!(s instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&s instanceof l.window.ImageBitmap)),this.style.updateImage(f,h)):this.fire(new l.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${b})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`))):this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,s){l.getImage(this._requestManager.transformRequest(f,l.ResourceType.Image),(h,g)=>{s(h,g instanceof l.window.HTMLImageElement?l.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(f,s){return this._lazyInitEmptyStyle(),this.style.addLayer(f,s),this._update(!0)}moveLayer(f,s){return this.style.moveLayer(f,s),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,s,h){return this.style.setLayerZoomRange(f,s,h),this._update(!0)}setFilter(f,s,h={}){return this.style.setFilter(f,s,h),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,s,h,g={}){return this.style.setPaintProperty(f,s,h,g),this._update(!0)}getPaintProperty(f,s){return this.style.getPaintProperty(f,s)}setLayoutProperty(f,s,h,g={}){return this.style.setLayoutProperty(f,s,h,g),this._update(!0)}getLayoutProperty(f,s){return this.style.getLayoutProperty(f,s)}setLight(f,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,s),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(l.LngLat.convert(f),this.transform):0}setFeatureState(f,s){return this.style.setFeatureState(f,s),this._update()}removeFeatureState(f,s){return this.style.removeFeatureState(f,s),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let h,g,v,b=this._container;for(;b&&(!g||!v);){const A=l.window.getComputedStyle(b).transform;A&&A!=="none"&&(h=A.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),b=b.parentElement}this._containerWidth=g?Math.abs(f/g):f,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=z("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=z("div","mapboxgl-canvas-container",f);this._interactive&&s.classList.add("mapboxgl-interactive"),this._canvas=z("canvas","mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=z("div","mapboxgl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=z("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,s){const h=l.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(f),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${s}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const s=this._markers.indexOf(f);s!==-1&&this._markers.splice(s,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const s=this._popups.indexOf(f);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const f=l.extend({},T.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._useWebGL2&&this._canvas.getContext("webgl2",f),h=s||this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);h?(this._useWebGL2&&!s&&l.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),l.storeAuthState(h,!0),this.painter=new Al(h,this.transform,!!s),this.on("data",g=>{g.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),l.exported$1.testSupport(h)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let s;const h=this.painter.context.extTimerQuery,g=l.exported.now();if(this.listens("gpu-timing-frame")&&(s=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],l.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],l.window.performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,D=this.transform.pitch,B=l.exported.now(),L=new l.EvaluationParameters(I,{now:B,fadeDuration:v,pitch:D,transition:this.style.getTransition()});this.style.update(L)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const I=l.exported.now()-g;h.endQueryEXT(h.TIME_ELAPSED_EXT,s),setTimeout(()=>{const D=h.getQueryObjectEXT(s,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(s),this.fire(new l.Event("gpu-timing-frame",{cpuTime:I,gpuTime:D})),l.window.performance.mark("frame-gpu",{startTime:g,detail:{gpuTime:D}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(I);this.fire(new l.Event("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(I);this.fire(new l.Event("gpu-timing-deferred-render",{gpuTime:D}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(A||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(b=this._updateAverageElevation(g,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new l.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new l.Event("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,l.LivePerformanceUtils.mark(l.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&l.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const s of this._markers)f&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!f||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(f,s=!1){const h=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);if((s||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const A=Math.abs(g-v);if(A>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(v),h(v);this._averageElevation.easeTo(v,f,300)}else if(A>1e-4)return this._averageElevation.jumpTo(v),h(v)}return!!this._averageElevation.isEasing(f)&&h(this._averageElevation.getValue(f))}_authenticate(){l.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===l.AUTH_ERR_MSG||f.status===401)){const s=this.painter.context.gl;l.storeAuthState(s,!1),this._logoControl instanceof Fp&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new l.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),l.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const h=this.painter.context.gl,g=h.createFramebuffer();function v(b){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,b,0);const A=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,A),A}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(f),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(f,s,h){let g=h[1]-h[0];const v=f.length/4;for(let b=0;b<s.length;b++){const A=s[b];let I=0;for(let D=0;D<A.length;D+=4)A[D]===f[D]&&A[D+1]===f[D+1]&&A[D+2]===f[D+2]&&A[D+3]===f[D+3]&&(I+=1);g+=(h[b+2]-h[b+1])*(1-I/v)}return g}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),l.window!==void 0&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1),l.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),l.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=l.exported.frame(s=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(f){const s=this.style?Object.values(this.style._sourceCaches):[];return l.asyncAll(s,(h,g)=>h._preloadTiles(f,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){l.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,s){l.setCacheLimits(f,s)}get version(){return l.version}},NavigationControl:class{constructor(f){this.options=l.extend({},yx,f),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const s=f.getZoom(),h=s===f.getMaxZoom(),g=s===f.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _x(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,s){const h=z("button",f,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(f,s){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${s}`);f.setAttribute("aria-label",h),f.firstElementChild&&f.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends l.Evented{constructor(f){super(),this.options=l.extend({geolocation:l.window.navigator.geolocation},Up,f),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=kl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const s=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,f(h)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):l.window.navigator.permissions!==void 0?l.window.navigator.permissions.query({name:"geolocation"}).then(h=>s(h.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(f){const s=this._map.getMaxBounds(),h=f.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",f)),this._finish()}}_updateCamera(f){const s=new l.LngLat(f.coords.longitude,f.coords.latitude),h=f.coords.accuracy,g=this._map.getBearing(),v=l.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),v,{geolocateSource:!0})}_updateMarker(f){if(f){const s=new l.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,s=l.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,h=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=z("button","mapboxgl-ctrl-geolocate",this._container),z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z("div","mapboxgl-user-location"),this._dotElement.appendChild(z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new xt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{l.window.addEventListener("ondeviceorientationabsolute"in l.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};l.window.DeviceMotionEvent!==void 0&&typeof l.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),l.window.removeEventListener("deviceorientation",this._onDeviceOrientation),l.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Tt,ScaleControl:class{constructor(f){this.options=l.extend({},jp,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),l.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,s=this._map,h=s._containerHeight/2,g=s._containerWidth/2-f/2,v=s.unproject([g,h]),b=s.unproject([g+f,h]),A=v.distanceTo(b);if(this.options.unit==="imperial"){const I=3.2808*A;I>5280?this._setScale(f,I/5280,"mile"):this._setScale(f,I,"foot")}else this.options.unit==="nautical"?this._setScale(f,A/1852,"nautical-mile"):A>=1e3?this._setScale(f,A/1e3,"kilometer"):this._setScale(f,A,"meter")}_setScale(f,s,h){this._map._requestDomTask(()=>{const g=function(b){const A=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/A;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(D){const B=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*B)/B}(I),A*I}(s),v=g/s;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(g):`${g}&nbsp;${Vp[h]}`,this._container.style.width=f*v+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof l.window.HTMLElement?this._container=f.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in l.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!l.window.document.fullscreenEnabled&&!l.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);z("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(l.window.document.fullscreenElement||l.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.Evented{constructor(f){super(),this.options=l.extend(Object.create(Bp),f),l.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=l.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(l.window.document.createTextNode(f))}setHTML(f){const s=l.window.document.createDocumentFragment(),h=l.window.document.createElement("body");let g;for(h.innerHTML=f;g=h.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=z("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(f),this.options.closeButton){const h=this._closeButton=z("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let s;return this._classList.delete(f)?s=!1:(this._classList.add(f),s=!0),this._updateClassList(),s}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const s=this._map,h=this._container,g=this._pos;if(!s||!h||!g)return"bottom";const v=h.offsetWidth,b=h.offsetHeight,A=g.x<v/2,I=g.x>s.transform.width-v/2;if(g.y+f<b)return A?"top-left":I?"top-right":"top";if(g.y>s.transform.height-b){if(A)return"bottom-left";if(I)return"bottom-right"}return A?"left":I?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),f.className=s.join(" ")}_update(f){const s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=z("div","mapboxgl-popup",s.getContainer()),this._tip=z("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ml(this._lngLat,this._pos,s.transform)),!this._trackPointer||f){const v=this._pos=this._trackPointer&&f?f:s.project(this._lngLat),b=N0(this.options.offset),A=this._anchor=this._getAnchor(b.y),I=N0(this.options.offset,A),D=v.add(I).round();s._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${Us[A]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&s._showingGlobe()){const v=l.isLngLatBehindGlobe(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(gx);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:xt,Style:Xo,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.Point,MercatorCoordinate:l.MercatorCoordinate,FreeCameraOptions:S0,Evented:l.Evented,config:l.config,prewarm:function(){ml().acquire(qo)},clearPrewarmedResources:function(){const f=_i;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(qo),_i=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(f){l.config.ACCESS_TOKEN=f},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(f){l.config.API_URL=f},get workerCount(){return Vn.workerCount},set workerCount(f){Vn.workerCount=f},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){l.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){l.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:l.exported.setNow,restoreNow:l.exported.restoreNow};return zl});var _=u;return _})})(A3);var hT=A3.exports;const g$=L_(hT),y$=xL({__proto__:null,default:g$},[hT]);const pb="pk.eyJ1IjoicnVyYWxpbm5vIiwiYSI6ImNqeHl0cW0xODBlMm0zY2x0dXltYzRuazUifQ.zZBovoCHzLIW0wCZveEKzA",EP="/examples/cori.data.rin/rin_service_areas.geojson";function _$(){var d;const t=kt.useContext(qR),e=kt.useRef(null),n=kt.useMemo(()=>(_,l,w,T)=>{console.log("Set popup: ",e.current);const C=new hT.Popup;return T.hasOwnProperty(w)?(C.setLngLat([_,l]),C.setText(T[w])):C.setText("Hello world!"),C},[]);let a=!1;function u(_,l,w,T,C,P,z){return kt.createElement(ZR,{ref:_,longitude:l,latitude:w,color:T,popup:C(l,w,P,z),key:z[P]+"-marker"})}return kt.useEffect(()=>{if(t&&!t.data.hasOwnProperty("placeData")&&!a){console.log("Initial place data fetch..."),console.log(EP),a=!0;const _=window.document.getElementById("info-wrapper");_!==null&&(_.style.opacity="1.0",_.style.position="absolute",_.style.background=`rgba(46, 60, 67, 0.5) url('${t.baseURL}/images/loading.gif') no-repeat fixed center`,_.style.backgroundSize="20px"),t.setData({...(t==null?void 0:t.data)||{},placeData:null}),t==null||t.apiClient.get(EP).then(l=>{l&&l.hasOwnProperty("data")&&(console.log("Data result:",l.data.features),t.setData({...t.data,placeData:l.data.features}),a=!1,_!==null&&(_.style.opacity="0.0",_.style.pointerEvents="none",setTimeout(()=>{_.style.background="transparent"},533)))}).catch(l=>{console.error("Error fetching data:",l),a=!1,_!==null&&(_.style.opacity="0.0",_.style.pointerEvents="none",setTimeout(()=>{_.style.background="transparent"},533))})}},[t==null?void 0:t.data]),kt.createElement(kt.Fragment,null,kt.createElement("div",{className:"slippy-map"},kt.createElement(UV,{mapboxAccessToken:pb,initialViewState:{latitude:40,longitude:-99,pitch:45,zoom:4},style:{width:600,height:400},mapStyle:`https://api.mapbox.com/styles/v1/ruralinno/cl010e7b7001p15pe3l0306hv?access_token=${pb}`},!!(t!=null&&t.data)&&!!((d=t==null?void 0:t.data)!=null&&d.placeData)&&t.data.placeData.length>0&&!!e&&typeof e!==void 0&&t.data.placeData.map(_=>{console.log(_);const l=typeof _.geometry.coordinates[0]=="number"?_.geometry.coordinates[0]:0,w=typeof _.geometry.coordinates[1]=="number"?_.geometry.coordinates[1]:0;return u(e,l,w,"#16343e",n,"rin_community",_.properties)}),kt.createElement(Y9,{mapboxAccessToken:pb,position:"top-right"}),kt.createElement(VV,{position:"top-right"}),kt.createElement(jV,{position:"top-right"}),kt.createElement($V,{position:"bottom-left",unit:"imperial"}))),kt.createElement("div",{id:"info-wrapper",style:{pointerEvents:"none",position:"absolute",top:0,minWidth:"100vw",minHeight:"100vh",transition:"opacity 5.05s ease-in-out 0.025s",opacity:"initial",background:"transparent",backgroundSize:"20px",zIndex:100}}))}const v$="https://cori-risi-apps.s3.amazonaws.com";function x$(t){eR(t).render(kt.createElement(kt.StrictMode,null,kt.createElement(cV,{baseURL:v$},kt.createElement(_$,null))))}x$(document.getElementById("app"));var Jt={},Nt={},C3={},k3={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Origin="origin",e.ShowEmbed="show-embed",e.ShowPin="show-pin",e.ShowSave="show-save",e.ShowShare="show-share"}(t.AskDataAttributes||(t.AskDataAttributes={}))})(k3);var dT={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CSV="csv",e.Excel="xlsx"}(t.CrosstabFileFormat||(t.CrosstabFileFormat={})),function(e){e.Default="default",e.Desktop="desktop",e.Tablet="tablet",e.Phone="phone"}(t.DeviceType||(t.DeviceType={})),function(e){e.AuthFailed="auth-failed",e.BrowserNotCapable="browser-not-capable",e.DownloadWorkbookNotAllowed="download-workbook-not-allowed",e.FilterCannotBePerformed="filter-cannot-be-performed",e.IndexOutOfRange="index-out-of-range",e.InternalError="internal-error",e.InvalidCustomViewName="invalid-custom-view-name",e.InvalidDateParameter="invalid-date-parameter",e.invalidFilterFieldNameOrValue="invalid-filter-field-name",e.InvalidParameter="invalid-parameter",e.InvalidSize="invalid-size",e.InvalidSheetType="invalid-sheet-type",e.InvalidSizeBehavior="invalid-size-behavior",e.InvalidSizeBehaviorOnWorksheet="invalid-size-behavior-on-worksheet",e.InvalidUrl="invalid-url",e.MissingMaxSize="missing-max-size",e.MissingMinSize="missing-min-size",e.MissingMinMaxSize="missing-min-max-size",e.MissingParameter="missing-parameter",e.MissingRangeNForRelativeDateFilters="missing-range-n-for-relative-date-filters",e.NoUrlForHiddenWorksheet="no-url-for-hidden-worksheet",e.NoUrlOrParentElementNotFound="no-url-or-parent-element-not-found",e.NotActiveSheet="not-active-sheet",e.NullOrEmptyParameter="null-or-empty-parameter",e.SheetNotInWorkbook="sheet-not-in-workbook",e.StaleDataReference="stale-data-reference",e.UnknownAuthError="unknown-auth-error",e.UnsupportedEventName="unsupported-event-name",e.VizAlreadyInManager="viz-already-in-manager",e.ImplementationError="wrong-implementation",e.NotImplemented="not-implemented",e.EventInitializationError="event-initialization-error",e.IncompatibleVersionError="incompatible-version-error",e.UnknownDialogType="unknown-dialog-type",e.FilterMissingOrNotImplemented="filter-missing-not-implemented",e.StoryPointIdMismatch="storypoint-id-mismatch"}(t.EmbeddingErrorCodes||(t.EmbeddingErrorCodes={})),function(e){e.PDF="pdf",e.PNG="png"}(t.FileFormats||(t.FileFormats={})),function(e){e.Portrait="portrait",e.Landscape="landscape"}(t.PrintOrientation||(t.PrintOrientation={})),function(e){e.Letter="letter",e.Legal="legal",e.Note="note",e.Folio="folio",e.Tabloid="tabloid",e.Ledger="ledger",e.Statement="statement",e.Executive="executive",e.A3="A3",e.A4="A4",e.A5="A5",e.B4="B4",e.B5="B5",e.Quarto="quarto",e.Unspecified="unspecified"}(t.PrintPageSize||(t.PrintPageSize={})),function(e){e.Automatic="automatic",e.Perc25="25%",e.Perc50="50%",e.Perc60="60%",e.Perc75="75%",e.Perc80="80%",e.Perc90="90%",e.Perc100="100%",e.Perc200="200%",e.Perc400="400%",e.AtMost1PageHigh="at-most-1-page-high",e.AtMost2PagesHigh="at-most-2-pages-high",e.AtMost1PageWide="at-most-1-page-wide",e.AtMost2PagesWide="at-most-2-pages-wide"}(t.PrintScaling||(t.PrintScaling={})),function(e){e.All="all",e.Axes="axes",e.Filters="filters",e.Sorts="sorts",e.Shelves="shelves"}(t.RevertVizSelection||(t.RevertVizSelection={})),function(e){e.Alerts="alerts",e.AskData="askData",e.CustomViews="customViews",e.DataDetails="dataDetails",e.Share="share",e.Subscribe="subscribe"}(t.ToolbarButtons||(t.ToolbarButtons={})),function(e){e.Top="top",e.Bottom="bottom",e.Hidden="hidden"}(t.Toolbar||(t.Toolbar={})),function(e){e.Automatic="automatic",e.Exactly="exactly",e.Range="range",e.AtLeast="atleast",e.AtMost="atmost"}(t.SheetSizeBehavior||(t.SheetSizeBehavior={})),function(e){e.Default="default",e.Card="card",e.Ban="ban"}(t.PulseLayout||(t.PulseLayout={})),function(e){e.CustomViewLoaded="customviewloaded",e.CustomViewRemoved="customviewremoved",e.CustomViewSaved="customviewsaved",e.CustomViewSetDefault="customviewsetdefault",e.EditButtonClicked="editbuttonclicked",e.EditInDesktopButtonClicked="editindesktopbuttonclicked",e.FilterChanged="filterchanged",e.FirstVizSizeKnown="firstvizsizeknown",e.FirstInteractive="firstinteractive",e.CustomMarkContextMenuEvent="custommarkcontextmenu",e.MarkSelectionChanged="markselectionchanged",e.ParameterChanged="parameterchanged",e.ToolbarStateChanged="toolbarstatechanged",e.WorkbookReadyToClose="workbookreadytoclose",e.WorkbookPublished="workbookpublished",e.WorkbookPublishedAs="workbookpublishedas",e.UrlAction="urlaction",e.TabSwitched="tabswitched",e.StoryPointSwitched="storypointswitched",e.VizLoadError="vizloaderror",e.IframeSrcUpdated="iframesrcupdated",e.SummaryDataChanged="summarydatachanged",e.ReadyToReceiveAuthToken="readytoreceiveauthtoken"}(t.TableauEventType||(t.TableauEventType={})),function(e){e.Ubertip="ubertip"}(t.ApiMenuType||(t.ApiMenuType={})),function(e){e.ExportPDF="export-pdf",e.ExportPowerPoint="export-powerpoint",e.ExportData="export-data",e.ExportCrossTab="export-cross-tab",e.ExportWorkbook="export-workbook",e.Share="share"}(t.TableauDialogType||(t.TableauDialogType={}))})(dT);var P3={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DisableExploreFilter="disable-explore-filter",e.Layout="layout"}(t.PulseAttributes||(t.PulseAttributes={})),function(e){e.IframeStyle="iframe-style"}(t.PulseChildElements||(t.PulseChildElements={}))})(P3);var D3={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.TouchOptimize="touch-optimize",e.HideEditInDesktopButton="hide-edit-in-desktop-button",e.SuppressDefaultEditBehavior="suppress-default-edit-behavior",e.DisableVersionCheck="disable-version-check",e.OnEditInDesktopButtonClicked="onEditInDesktopButtonClicked",e.OnFirstVizSizeKnown="onFirstVizSizeKnown",e.OnFirstInteractive="onFirstInteractive"}(t.VizSharedAttributes||(t.VizSharedAttributes={})),function(e){e.DisableUrlActionsPopups="disable-url-actions",e.HideTabs="hide-tabs",e.Toolbar="toolbar",e.InstanceIdToClone="instance-id-to-clone",e.Device="device",e.HideEditButton="hide-edit-button",e.OnEditButtonClicked="onEditButtonClicked",e.OnFilterChanged="onFilterChanged",e.OnCustomMarkContextMenuEvent="onCustomMarkContextMenuEvent",e.OnMarkSelectionChanged="onMarkSelectionChanged",e.OnParameterChanged="onParameterChanged",e.OnToolbarStateChanged="onToolbarStateChanged",e.OnUrlAction="onUrlAction",e.OnTabSwitched="onTabSwitched",e.OnCustomViewLoaded="onCustomViewLoaded",e.OnCustomViewRemoved="onCustomViewRemoved",e.OnCustomViewSaved="onCustomViewSaved",e.OnCustomViewSetDefault="onCustomViewSetDefault",e.OnStoryPointSwitched="onStoryPointSwitched",e.OnSummaryDataChanged="onSummaryDataChanged",e.OnReadyToReceiveAuthToken="onReadyToReceiveAuthToken"}(t.VizAttributes||(t.VizAttributes={})),function(e){e.OnWorkbookPublished="onWorkbookPublished",e.OnWorkbookPublishedAs="onWorkbookPublishedAs",e.OnWorkbookReadyToClose="onWorkbookReadyToClose",e.HideCloseButton="hide-close-button"}(t.VizAuthoringAttributes||(t.VizAuthoringAttributes={})),function(e){e.VizFilter="viz-filter",e.VizParameter="viz-parameter",e.CustomParameter="custom-parameter",e.IframeStyle="iframe-style"}(t.VizChildElements||(t.VizChildElements={})),function(e){e.Field="field",e.Value="value",e.Name="name"}(t.VizChildElementAttributes||(t.VizChildElementAttributes={}))})(D3);var M3={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Src="src",e.Width="width",e.Height="height",e.Token="token",e.Debug="debug",e.IframeAuth="iframe-auth",e.OnVizLoadError="onvizloaderror",e.ForceTokenSync="force-token-sync"}(t.WebComponentAttributes||(t.WebComponentAttributes={})),function(e){e.Loading="iframe-attr-loading",e.Style="iframe-attr-style",e.Class="iframe-attr-class"}(t.EmbeddedIframeAttributes||(t.EmbeddedIframeAttributes={})),function(e){e.CustomParameter="custom-parameter",e.IframeStyle="iframe-style"}(t.WebComponentChildElements||(t.WebComponentChildElements={})),function(e){e.Field="field",e.Value="value",e.Name="name"}(t.WebComponentChildElementAttributes||(t.WebComponentChildElementAttributes={}))})(M3);var pT={},z3={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CrosstabCreationError="crosstab-creation-error",e.DataCreationError="data-creation-error",e.InvalidAggregationFieldName="invalid-aggregation-field-name",e.InvalidFilterFieldName="invalid-filter-name",e.InvalidFilterFieldValue="invalid-filter-fieldValue",e.InvalidSelectionDate="invalid-selection-date",e.InvalidSelectionFieldName="invalid-selection-fieldName",e.InvalidSelectionValue="invalid-selection-value",e.InvalidSelectionSheet="invalid-selection-sheet",e.InternalError="internal-error",e.InvalidParameter="invalid-parameter",e.PDFCreationError="pdf-creation-error",e.PowerPointCreationError="powerpoint-creation-error",e.NotActiveSheet="not-active-sheet",e.ImplementationError="wrong-implementation",e.ApiExecutionError="api-execution-error",e.ServerError="server-error",e.Timeout="timeout"}(t.SharedErrorCodes||(t.SharedErrorCodes={}))})(z3);var jE=$e&&$e.__assign||function(){return jE=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++){e=arguments[n];for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u])}return t},jE.apply(this,arguments)},VE;(function(t){(function(n){n.Cluster="cluster",n.Forecast="forecast",n.TrendLine="trend-line"})(t.AnalyticsObjectType||(t.AnalyticsObjectType={})),function(n){n.Mark="mark",n.Point="point",n.Area="area"}(t.AnnotationType||(t.AnnotationType={})),function(n){n.Discrete="discrete",n.Continuous="continuous",n.Unknown="unknown"}(t.ColumnType||(t.ColumnType={})),function(n){n.WorksheetTitle="tableau-worksheet-title",n.Worksheet="tableau-worksheet",n.Tooltip="tableau-tooltip",n.StoryTitle="tableau-story-title",n.DashboardTitle="tableau-dashboard-title"}(t.ClassNameKey||(t.ClassNameKey={})),function(n){n.Blank="blank",n.Worksheet="worksheet",n.QuickFilter="quick-filter",n.ParameterControl="parameter-control",n.PageFilter="page-filter",n.Legend="legend",n.Title="title",n.Text="text",n.Image="image",n.WebPage="web-page",n.Extension="extension"}(t.DashboardObjectType||(t.DashboardObjectType={}));var e;(function(n){n.Show="show",n.Hide="hide"})(e=t.DashboardObjectVisibilityType||(t.DashboardObjectVisibilityType={})),function(n){n.String="string",n.Int="int",n.Float="float",n.Bool="bool",n.Date="date",n.DateTime="date-time",n.Spatial="spatial",n.Unknown="unknown"}(t.DataType||(t.DataType={})),function(n){n.Added="added",n.Removed="removed",n.IsFloatingChanged="is-floating-changed",n.IsVisibleChanged="is-visible-changed",n.PositionChanged="position-changed",n.SizeChanged="size-changed",n.NameChanged="name-changed",n.Selected="selected",n.Deselected="deselected",n.DashboardChanged="dashboard-changed"}(t.DashboardLayoutChange||(t.DashboardLayoutChange={})),function(n){n.Last="last",n.LastN="last-n",n.Next="next",n.NextN="next-n",n.Current="current",n.ToDate="to-date"}(t.DateRangeType||(t.DateRangeType={})),function(n){n.Window="window",n.Modal="modal",n.Modeless="modeless"}(t.DialogStyle||(t.DialogStyle={})),function(n){n.Column="column",n.Row="row",n.Page="page",n.Filter="filter",n.MarksType="marks-type",n.MeasureValues="measure-values",n.Color="color",n.Size="size",n.Label="label",n.Detail="detail",n.Tooltip="tooltip",n.Shape="shape",n.Path="path",n.Angle="angle",n.Geometry="geometry",n.Custom="custom"}(t.EncodingType||(t.EncodingType={})),function(n){n.Sum="sum",n.Avg="avg",n.Min="min",n.Max="max",n.Stdev="stdev",n.Stdevp="stdevp",n.Var="var",n.Varp="varp",n.Collect="collect",n.Count="count",n.Countd="countd",n.Median="median",n.Attr="attr",n.None="none",n.Year="year",n.Qtr="qtr",n.Month="month",n.Day="day",n.Hour="hour",n.Minute="minute",n.Second="second",n.Week="week",n.Weekday="weekday",n.MonthYear="month-year",n.Mdy="mdy",n.End="end",n.TruncYear="trunc-year",n.TruncQtr="trunc-qtr",n.TruncMonth="trunc-month",n.TruncWeek="trunc-week",n.TruncDay="trunc-day",n.TruncHour="trunc-hour",n.TruncMinute="trunc-minute",n.TruncSecond="trunc-second",n.Quart1="quart1",n.Quart3="quart3",n.Skewness="skewness",n.Kurtosis="kurtosis",n.InOut="in-out",n.User="user"}(t.FieldAggregationType||(t.FieldAggregationType={})),function(n){n.Dimension="dimension",n.Measure="measure",n.Unknown="unknown"}(t.FieldRoleType||(t.FieldRoleType={})),function(n){n.Categorical="categorical",n.Range="range",n.Hierarchical="hierarchical",n.RelativeDate="relative-date"}(t.FilterType||(t.FilterType={})),function(n){n.Add="add",n.All="all",n.Replace="replace",n.Remove="remove"}(t.FilterUpdateType||(t.FilterUpdateType={})),function(n){n.Relevant="relevant",n.Database="database"}(t.FilterDomainType||(t.FilterDomainType={})),function(n){n.NullValues="null-values",n.NonNullValues="non-null-values",n.AllValues="all-values"}(t.FilterNullOption||(t.FilterNullOption={})),function(n){n.AllValues="all-values",n.OnlyNativeValues="only-native-values",n.OnlyFormattedValues="only-formatted-values"}(t.IncludeDataValuesOption||(t.IncludeDataValuesOption={})),function(n){n.Bar="bar",n.Line="line",n.Area="area",n.Square="square",n.Circle="circle",n.Shape="shape",n.Text="text",n.Map="map",n.Pie="pie",n.GanttBar="gantt-bar",n.Polygon="polygon",n.Heatmap="heatmap",n.VizExtension="viz-extension"}(t.MarkType||(t.MarkType={})),function(n){n.All="all",n.List="list",n.Range="range"}(t.ParameterValueType||(t.ParameterValueType={})),function(n){n.Years="years",n.Quarters="quarters",n.Months="months",n.Weeks="weeks",n.Days="days",n.Hours="hours",n.Minutes="minutes",n.Seconds="seconds"}(t.PeriodType||(t.PeriodType={})),function(n){n.RunningTotal="running-total",n.Difference="difference",n.PercentDifference="percent-difference",n.PercentOfTotal="percent-of-total",n.Rank="rank",n.Percentile="percentile",n.MovingAverage="moving-average",n.YTDTotal="ytd-total",n.CompoundGrowthRate="compound-growth-rate",n.YearOverYearGrowth="year-over-year-growth",n.YTDGrowth="ytd-growth",n.Undefined="undefined"}(t.QuickTableCalcType||(t.QuickTableCalcType={})),function(n){n.Replace="select-replace",n.Add="select-add",n.Remove="select-remove"}(t.SelectionUpdateType||(t.SelectionUpdateType={})),function(n){n.Simple="select-options-simple",n.Toggle="select-options-toggle"}(t.SelectOptions||(t.SelectOptions={})),function(n){n.Dashboard="dashboard",n.Story="story",n.Worksheet="worksheet"}(t.SheetType||(t.SheetType={})),function(n){n.Increasing="increasing",n.Decreasing="decreasing"}(t.SortDirection||(t.SortDirection={})),function(n){n.Linear="linear",n.Logarithmic="logarithmic",n.Exponential="exponential",n.Polynomial="polynomial"}(t.TrendLineModelType||(t.TrendLineModelType={})),function(n){n.Slow="slow",n.Normal="normal",n.Fast="fast"}(t.ReplaySpeedType||(t.ReplaySpeedType={})),function(n){n.AllSelected="all-selected",n.NoneSelected="none-selected",n.SomeSelected="some-selected",n.UnknownSelected="unknown-selected"}(t.HierarchicalLevelSelectionState||(t.HierarchicalLevelSelectionState={})),t.ZoneVisibilityType=jE({},e)})(VE||(VE={}));var b$=VE;(function(t){function e(a){for(var u in a)t.hasOwnProperty(u)||(t[u]=a[u])}Object.defineProperty(t,"__esModule",{value:!0}),e(z3);var n=b$;t.AnalyticsObjectType=n.AnalyticsObjectType,t.AnnotationType=n.AnnotationType,t.ClassNameKey=n.ClassNameKey,t.ColumnType=n.ColumnType,t.DashboardLayoutChange=n.DashboardLayoutChange,t.DashboardObjectType=n.DashboardObjectType,t.DashboardObjectVisibilityType=n.DashboardObjectVisibilityType,t.DataType=n.DataType,t.DateRangeType=n.DateRangeType,t.DialogStyle=n.DialogStyle,t.EncodingType=n.EncodingType,t.FieldAggregationType=n.FieldAggregationType,t.FieldRoleType=n.FieldRoleType,t.FilterDomainType=n.FilterDomainType,t.FilterNullOption=n.FilterNullOption,t.FilterType=n.FilterType,t.FilterUpdateType=n.FilterUpdateType,t.HierarchicalLevelSelectionState=n.HierarchicalLevelSelectionState,t.IncludeDataValuesOption=n.IncludeDataValuesOption,t.MarkType=n.MarkType,t.ParameterValueType=n.ParameterValueType,t.PeriodType=n.PeriodType,t.QuickTableCalcType=n.QuickTableCalcType,t.ReplaySpeedType=n.ReplaySpeedType,t.SelectOptions=n.SelectOptions,t.SelectionUpdateType=n.SelectionUpdateType,t.SheetType=n.SheetType,t.SortDirection=n.SortDirection,t.TrendLineModelType=n.TrendLineModelType,t.ZoneVisibilityType=n.ZoneVisibilityType})(pT);(function(t){function e(a){for(var u in a)t.hasOwnProperty(u)||(t[u]=a[u])}Object.defineProperty(t,"__esModule",{value:!0}),e(k3);var n=dT;t.ApiMenuType=n.ApiMenuType,t.CrosstabFileFormat=n.CrosstabFileFormat,t.DeviceType=n.DeviceType,t.EmbeddingErrorCodes=n.EmbeddingErrorCodes,t.EmbeddingTableauEventType=n.TableauEventType,t.FileFormats=n.FileFormats,t.PrintOrientation=n.PrintOrientation,t.PrintPageSize=n.PrintPageSize,t.PrintScaling=n.PrintScaling,t.PulseLayout=n.PulseLayout,t.SheetSizeBehavior=n.SheetSizeBehavior,t.TableauDialogType=n.TableauDialogType,t.Toolbar=n.Toolbar,e(P3),e(D3),e(M3),e(pT)})(C3);var R3={},$E;(function(t){(function(e){e.APINotInitialized="api-not-initialized",e.VisibilityError="visibility-error",e.DialogAlreadyOpen="dialog-already-open",e.DialogClosedByUser="dialog-closed-by-user",e.InternalError="internal-error",e.InvalidDomainDialog="invalid-dialog-domain",e.InvalidParameter="invalid-parameter",e.MissingFilter="missing-filter",e.MissingParameter="missing-parameter",e.ServerError="server-error",e.SettingSaveInProgress="setting-save-in-progress",e.UnsupportedEventName="unsupported-event-name",e.UnsupportedMethodForDataSourceType="unsupported-method-for-data-source-type"})(t.ErrorCodes||(t.ErrorCodes={})),function(e){e.Desktop="desktop",e.Server="server"}(t.ExtensionContext||(t.ExtensionContext={})),function(e){e.Authoring="authoring",e.Viewing="viewing"}(t.ExtensionMode||(t.ExtensionMode={})),function(e){e.FilterChanged="filter-changed",e.MarkSelectionChanged="mark-selection-changed",e.SummaryDataChanged="summary-data-changed",e.ParameterChanged="parameter-changed",e.SettingsChanged="settings-changed",e.DashboardLayoutChanged="dashboard-layout-changed",e.WorkbookFormattingChanged="workbook-formatting-changed"}(t.TableauEventType||(t.TableauEventType={})),function(e){e.Discrete="discrete",e.Continuous="continuous"}(t.VizImageEncodingType||(t.VizImageEncodingType={})),function(e){e.Ascending="ascending",e.Descending="descending"}(t.VizImageSortDirectionType||(t.VizImageSortDirectionType={})),function(e){e.CustomDiverging="custom-diverging",e.CustomSequential="custom-sequential"}(t.VizImagePaletteType||(t.VizImagePaletteType={})),function(e){e.Fixed="fixed",e.Manual="manual"}(t.VizImageSizeSettingType||(t.VizImageSizeSettingType={})),function(e){e.Right="right",e.Left="left",e.Center="center"}(t.VizImageSizeSettingAlignmentType||(t.VizImageSizeSettingAlignmentType={}))})($E||($E={}));var w$=$E;(function(t){function e(a){for(var u in a)t.hasOwnProperty(u)||(t[u]=a[u])}Object.defineProperty(t,"__esModule",{value:!0});var n=w$;t.ErrorCodes=n.ErrorCodes,t.ExtensionContext=n.ExtensionContext,t.ExtensionMode=n.ExtensionMode,t.TableauEventType=n.TableauEventType,t.VizImageEncodingType=n.VizImageEncodingType,t.VizImagePaletteType=n.VizImagePaletteType,t.VizImageSizeSettingAlignmentType=n.VizImageSizeSettingAlignmentType,t.VizImageSizeSettingType=n.VizImageSizeSettingType,t.VizImageSortDirectionType=n.VizImageSortDirectionType,e(pT)})(R3);(function(t){function e(n){for(var a in n)t.hasOwnProperty(a)||(t[a]=n[a])}Object.defineProperty(t,"__esModule",{value:!0}),e(C3),e(R3)})(Nt);var fb={},fT={},hv={},Mn={},E$=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(Mn,"__esModule",{value:!0});var S$=function(t){E$(e,t);function e(n,a){var u=t.call(this,n+": "+a)||this;return u._errorCode=n,Object.setPrototypeOf(u,e.prototype),u}return Object.defineProperty(e.prototype,"errorCode",{get:function(){return this._errorCode},enumerable:!0,configurable:!0}),e}(Error);Mn.TableauError=S$;Object.defineProperty(hv,"__esModule",{value:!0});var T$=Nt,A$=Mn,I$=function(){function t(e,n){var a=e.split("-");this.build=this.getBuildNumber(a[1]),e=a[0];var u=e.split(".").map(function(d){return parseInt(d,10)});if(u.length!==3)throw new A$.TableauError(T$.ErrorCodes.InternalError,"Invalid version number: "+e);this.major=u[0],this.minor=u[1],this.fix=u[2],this.isAlpha=n}return t.prototype.getBuildNumber=function(e){var n=-1;if(!e)return n;var a=e.split(".");return a[1]?parseInt(a[1],10):n},Object.defineProperty(t.prototype,"formattedValue",{get:function(){return this.major+"."+this.minor+"."+this.fix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullFormattedValue",{get:function(){return this.major+"."+this.minor+"."+this.fix+"-pre."+this.build},enumerable:!0,configurable:!0}),t}();hv.VersionNumber=I$;Object.defineProperty(fT,"__esModule",{value:!0});var C$=hv,k$=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t.SetVersionNumber=function(e,n){t._instance=new C$.VersionNumber(e,n)},t}();fT.ApiVersion=k$;var mT={},mb={},Ff=function(t){return t&&t.Math===Math&&t},Xa=Ff(typeof globalThis=="object"&&globalThis)||Ff(typeof window=="object"&&window)||Ff(typeof self=="object"&&self)||Ff(typeof $e=="object"&&$e)||Ff(typeof $e=="object"&&$e)||function(){return this}()||Function("return this")(),gT={},dl=function(t){try{return!!t()}catch{return!0}},P$=dl,Ec=!P$(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),D$=dl,O3=!D$(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),M$=O3,Xg=Function.prototype.call,dv=M$?Xg.bind(Xg):function(){return Xg.apply(Xg,arguments)},yT={},F3={}.propertyIsEnumerable,L3=Object.getOwnPropertyDescriptor,z$=L3&&!F3.call({1:2},1);yT.f=z$?function(e){var n=L3(this,e);return!!n&&n.enumerable}:F3;var B3=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}},N3=O3,U3=Function.prototype,WE=U3.call,R$=N3&&U3.bind.bind(WE,WE),Cs=N3?R$:function(t){return function(){return WE.apply(t,arguments)}},j3=Cs,O$=j3({}.toString),F$=j3("".slice),L$=function(t){return F$(O$(t),8,-1)},B$=Cs,N$=dl,U$=L$,gb=Object,j$=B$("".split),V3=N$(function(){return!gb("z").propertyIsEnumerable(0)})?function(t){return U$(t)==="String"?j$(t,""):gb(t)}:gb,$3=function(t){return t==null},V$=$3,$$=TypeError,W3=function(t){if(V$(t))throw new $$("Can't call method on "+t);return t},W$=V3,G$=W3,_T=function(t){return W$(G$(t))},yb=typeof document=="object"&&document.all,ks=typeof yb>"u"&&yb!==void 0?function(t){return typeof t=="function"||t===yb}:function(t){return typeof t=="function"},H$=ks,jd=function(t){return typeof t=="object"?t!==null:H$(t)},_b=Xa,q$=ks,Z$=function(t){return q$(t)?t:void 0},G3=function(t,e){return arguments.length<2?Z$(_b[t]):_b[t]&&_b[t][e]},K$=Cs,X$=K$({}.isPrototypeOf),Y$=typeof navigator<"u"&&String(navigator.userAgent)||"",H3=Xa,vb=Y$,SP=H3.process,TP=H3.Deno,AP=SP&&SP.versions||TP&&TP.version,IP=AP&&AP.v8,$a,z_;IP&&($a=IP.split("."),z_=$a[0]>0&&$a[0]<4?1:+($a[0]+$a[1]));!z_&&vb&&($a=vb.match(/Edge\/(\d+)/),(!$a||$a[1]>=74)&&($a=vb.match(/Chrome\/(\d+)/),$a&&(z_=+$a[1])));var Q$=z_,CP=Q$,J$=dl,eW=Xa,tW=eW.String,q3=!!Object.getOwnPropertySymbols&&!J$(function(){var t=Symbol("symbol detection");return!tW(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&CP&&CP<41}),rW=q3,Z3=rW&&!Symbol.sham&&typeof Symbol.iterator=="symbol",nW=G3,iW=ks,oW=X$,aW=Z3,sW=Object,K3=aW?function(t){return typeof t=="symbol"}:function(t){var e=nW("Symbol");return iW(e)&&oW(e.prototype,sW(t))},lW=String,cW=function(t){try{return lW(t)}catch{return"Object"}},uW=ks,hW=cW,dW=TypeError,pW=function(t){if(uW(t))return t;throw new dW(hW(t)+" is not a function")},fW=pW,mW=$3,gW=function(t,e){var n=t[e];return mW(n)?void 0:fW(n)},xb=dv,bb=ks,wb=jd,yW=TypeError,_W=function(t,e){var n,a;if(e==="string"&&bb(n=t.toString)&&!wb(a=xb(n,t))||bb(n=t.valueOf)&&!wb(a=xb(n,t))||e!=="string"&&bb(n=t.toString)&&!wb(a=xb(n,t)))return a;throw new yW("Can't convert object to primitive value")},X3={exports:{}},kP=Xa,vW=Object.defineProperty,vT=function(t,e){try{vW(kP,t,{value:e,configurable:!0,writable:!0})}catch{kP[t]=e}return e},xW=Xa,bW=vT,PP="__core-js_shared__",DP=X3.exports=xW[PP]||bW(PP,{});(DP.versions||(DP.versions=[])).push({version:"3.37.1",mode:"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"});var xT=X3.exports,MP=xT,Y3=function(t,e){return MP[t]||(MP[t]=e||{})},wW=W3,EW=Object,Q3=function(t){return EW(wW(t))},SW=Cs,TW=Q3,AW=SW({}.hasOwnProperty),Bu=Object.hasOwn||function(e,n){return AW(TW(e),n)},IW=Cs,CW=0,kW=Math.random(),PW=IW(1 .toString),J3=function(t){return"Symbol("+(t===void 0?"":t)+")_"+PW(++CW+kW,36)},DW=Xa,MW=Y3,zP=Bu,zW=J3,RW=q3,OW=Z3,fd=DW.Symbol,Eb=MW("wks"),FW=OW?fd.for||fd:fd&&fd.withoutSetter||zW,LW=function(t){return zP(Eb,t)||(Eb[t]=RW&&zP(fd,t)?fd[t]:FW("Symbol."+t)),Eb[t]},BW=dv,RP=jd,OP=K3,NW=gW,UW=_W,jW=LW,VW=TypeError,$W=jW("toPrimitive"),WW=function(t,e){if(!RP(t)||OP(t))return t;var n=NW(t,$W),a;if(n){if(e===void 0&&(e="default"),a=BW(n,t,e),!RP(a)||OP(a))return a;throw new VW("Can't convert object to primitive value")}return e===void 0&&(e="number"),UW(t,e)},GW=WW,HW=K3,eO=function(t){var e=GW(t,"string");return HW(e)?e:e+""},qW=Xa,FP=jd,GE=qW.document,ZW=FP(GE)&&FP(GE.createElement),KW=function(t){return ZW?GE.createElement(t):{}},XW=Ec,YW=dl,QW=KW,tO=!XW&&!YW(function(){return Object.defineProperty(QW("div"),"a",{get:function(){return 7}}).a!==7}),JW=Ec,eG=dv,tG=yT,rG=B3,nG=_T,iG=eO,oG=Bu,aG=tO,LP=Object.getOwnPropertyDescriptor;gT.f=JW?LP:function(e,n){if(e=nG(e),n=iG(n),aG)try{return LP(e,n)}catch{}if(oG(e,n))return rG(!eG(tG.f,e,n),e[n])};var pv={},sG=Ec,lG=dl,cG=sG&&lG(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),uG=jd,hG=String,dG=TypeError,rO=function(t){if(uG(t))return t;throw new dG(hG(t)+" is not an object")},pG=Ec,fG=tO,mG=cG,Yg=rO,BP=eO,gG=TypeError,Sb=Object.defineProperty,yG=Object.getOwnPropertyDescriptor,Tb="enumerable",Ab="configurable",Ib="writable";pv.f=pG?mG?function(e,n,a){if(Yg(e),n=BP(n),Yg(a),typeof e=="function"&&n==="prototype"&&"value"in a&&Ib in a&&!a[Ib]){var u=yG(e,n);u&&u[Ib]&&(e[n]=a.value,a={configurable:Ab in a?a[Ab]:u[Ab],enumerable:Tb in a?a[Tb]:u[Tb],writable:!1})}return Sb(e,n,a)}:Sb:function(e,n,a){if(Yg(e),n=BP(n),Yg(a),fG)try{return Sb(e,n,a)}catch{}if("get"in a||"set"in a)throw new gG("Accessors not supported");return"value"in a&&(e[n]=a.value),e};var _G=Ec,vG=pv,xG=B3,nO=_G?function(t,e,n){return vG.f(t,e,xG(1,n))}:function(t,e,n){return t[e]=n,t},iO={exports:{}},HE=Ec,bG=Bu,oO=Function.prototype,wG=HE&&Object.getOwnPropertyDescriptor,bT=bG(oO,"name"),EG=bT&&(function(){}).name==="something",SG=bT&&(!HE||HE&&wG(oO,"name").configurable),TG={EXISTS:bT,PROPER:EG,CONFIGURABLE:SG},AG=Cs,IG=ks,qE=xT,CG=AG(Function.toString);IG(qE.inspectSource)||(qE.inspectSource=function(t){return CG(t)});var kG=qE.inspectSource,PG=Xa,DG=ks,NP=PG.WeakMap,MG=DG(NP)&&/native code/.test(String(NP)),zG=Y3,RG=J3,UP=zG("keys"),OG=function(t){return UP[t]||(UP[t]=RG(t))},aO={},FG=MG,sO=Xa,LG=jd,BG=nO,Cb=Bu,kb=xT,NG=OG,UG=aO,jP="Object already initialized",ZE=sO.TypeError,jG=sO.WeakMap,R_,Rm,O_,VG=function(t){return O_(t)?Rm(t):R_(t,{})},$G=function(t){return function(e){var n;if(!LG(e)||(n=Rm(e)).type!==t)throw new ZE("Incompatible receiver, "+t+" required");return n}};if(FG||kb.state){var fs=kb.state||(kb.state=new jG);fs.get=fs.get,fs.has=fs.has,fs.set=fs.set,R_=function(t,e){if(fs.has(t))throw new ZE(jP);return e.facade=t,fs.set(t,e),e},Rm=function(t){return fs.get(t)||{}},O_=function(t){return fs.has(t)}}else{var jh=NG("state");UG[jh]=!0,R_=function(t,e){if(Cb(t,jh))throw new ZE(jP);return e.facade=t,BG(t,jh,e),e},Rm=function(t){return Cb(t,jh)?t[jh]:{}},O_=function(t){return Cb(t,jh)}}var WG={set:R_,get:Rm,has:O_,enforce:VG,getterFor:$G},wT=Cs,GG=dl,HG=ks,Qg=Bu,KE=Ec,qG=TG.CONFIGURABLE,ZG=kG,lO=WG,KG=lO.enforce,XG=lO.get,VP=String,Qy=Object.defineProperty,YG=wT("".slice),QG=wT("".replace),JG=wT([].join),eH=KE&&!GG(function(){return Qy(function(){},"length",{value:8}).length!==8}),tH=String(String).split("String"),rH=iO.exports=function(t,e,n){YG(VP(e),0,7)==="Symbol("&&(e="["+QG(VP(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!Qg(t,"name")||qG&&t.name!==e)&&(KE?Qy(t,"name",{value:e,configurable:!0}):t.name=e),eH&&n&&Qg(n,"arity")&&t.length!==n.arity&&Qy(t,"length",{value:n.arity});try{n&&Qg(n,"constructor")&&n.constructor?KE&&Qy(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch{}var a=KG(t);return Qg(a,"source")||(a.source=JG(tH,typeof e=="string"?e:"")),t};Function.prototype.toString=rH(function(){return HG(this)&&XG(this).source||ZG(this)},"toString");var nH=iO.exports,iH=ks,oH=pv,aH=nH,sH=vT,lH=function(t,e,n,a){a||(a={});var u=a.enumerable,d=a.name!==void 0?a.name:e;if(iH(n)&&aH(n,d,a),a.global)u?t[e]=n:sH(e,n);else{try{a.unsafe?t[e]&&(u=!0):delete t[e]}catch{}u?t[e]=n:oH.f(t,e,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return t},cO={},cH=Math.ceil,uH=Math.floor,hH=Math.trunc||function(e){var n=+e;return(n>0?uH:cH)(n)},dH=hH,uO=function(t){var e=+t;return e!==e||e===0?0:dH(e)},pH=uO,fH=Math.max,mH=Math.min,gH=function(t,e){var n=pH(t);return n<0?fH(n+e,0):mH(n,e)},yH=uO,_H=Math.min,vH=function(t){var e=yH(t);return e>0?_H(e,9007199254740991):0},xH=vH,bH=function(t){return xH(t.length)},wH=_T,EH=gH,SH=bH,$P=function(t){return function(e,n,a){var u=wH(e),d=SH(u);if(d===0)return!t&&-1;var _=EH(a,d),l;if(t&&n!==n){for(;d>_;)if(l=u[_++],l!==l)return!0}else for(;d>_;_++)if((t||_ in u)&&u[_]===n)return t||_||0;return!t&&-1}},TH={includes:$P(!0),indexOf:$P(!1)},AH=Cs,Pb=Bu,IH=_T,CH=TH.indexOf,kH=aO,WP=AH([].push),hO=function(t,e){var n=IH(t),a=0,u=[],d;for(d in n)!Pb(kH,d)&&Pb(n,d)&&WP(u,d);for(;e.length>a;)Pb(n,d=e[a++])&&(~CH(u,d)||WP(u,d));return u},dO=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],PH=hO,DH=dO,MH=DH.concat("length","prototype");cO.f=Object.getOwnPropertyNames||function(e){return PH(e,MH)};var ET={};ET.f=Object.getOwnPropertySymbols;var zH=G3,RH=Cs,OH=cO,FH=ET,LH=rO,BH=RH([].concat),NH=zH("Reflect","ownKeys")||function(e){var n=OH.f(LH(e)),a=FH.f;return a?BH(n,a(e)):n},GP=Bu,UH=NH,jH=gT,VH=pv,$H=function(t,e,n){for(var a=UH(e),u=VH.f,d=jH.f,_=0;_<a.length;_++){var l=a[_];!GP(t,l)&&!(n&&GP(n,l))&&u(t,l,d(e,l))}},WH=dl,GH=ks,HH=/#|\.prototype\./,Vm=function(t,e){var n=ZH[qH(t)];return n===XH?!0:n===KH?!1:GH(e)?WH(e):!!e},qH=Vm.normalize=function(t){return String(t).replace(HH,".").toLowerCase()},ZH=Vm.data={},KH=Vm.NATIVE="N",XH=Vm.POLYFILL="P",YH=Vm,Jg=Xa,QH=gT.f,JH=nO,eq=lH,tq=vT,rq=$H,nq=YH,ST=function(t,e){var n=t.target,a=t.global,u=t.stat,d,_,l,w,T,C;if(a?_=Jg:u?_=Jg[n]||tq(n,{}):_=Jg[n]&&Jg[n].prototype,_)for(l in e){if(T=e[l],t.dontCallGetSet?(C=QH(_,l),w=C&&C.value):w=_[l],d=nq(a?l:n+(u?".":"#")+l,t.forced),!d&&w!==void 0){if(typeof T==typeof w)continue;rq(T,w)}(t.sham||w&&w.sham)&&JH(T,"sham",!0),eq(_,l,T,t)}},iq=jd,oq=Math.floor,aq=Number.isInteger||function(e){return!iq(e)&&isFinite(e)&&oq(e)===e},sq=ST,lq=aq;sq({target:"Number",stat:!0},{isInteger:lq});var cq=Xa,TT=cq,uq=TT;uq.Number.isInteger;var hq=ST;hq({target:"Number",stat:!0},{isNaN:function(e){return e!==e}});var dq=TT;dq.Number.isNaN;var pq=hO,fq=dO,mq=Object.keys||function(e){return pq(e,fq)},HP=Ec,gq=Cs,yq=dv,_q=dl,Db=mq,vq=ET,xq=yT,bq=Q3,wq=V3,Vh=Object.assign,qP=Object.defineProperty,Eq=gq([].concat),Sq=!Vh||_q(function(){if(HP&&Vh({b:1},Vh(qP({},"a",{enumerable:!0,get:function(){qP(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol("assign detection"),a="abcdefghijklmnopqrst";return t[n]=7,a.split("").forEach(function(u){e[u]=u}),Vh({},t)[n]!==7||Db(Vh({},e)).join("")!==a})?function(e,n){for(var a=bq(e),u=arguments.length,d=1,_=vq.f,l=xq.f;u>d;)for(var w=wq(arguments[d++]),T=_?Eq(Db(w),_(w)):Db(w),C=T.length,P=0,z;C>P;)z=T[P++],(!HP||yq(l,w,z))&&(a[z]=w[z]);return a}:Vh,Tq=ST,ZP=Sq;Tq({target:"Object",stat:!0,arity:2,forced:Object.assign!==ZP},{assign:ZP});var Aq=TT;Aq.Object.assign;const Iq=1,Cq=162,kq=0,Pq={major:Iq,minor:Cq,fix:kq};var AT={},IT={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Desktop="desktop",e.Server="server",e.Unknown="unknown"}(t.ExtensionContext||(t.ExtensionContext={})),function(e){e.Authoring="authoring",e.Viewing="viewing",e.Unknown="unknown"}(t.ExtensionMode||(t.ExtensionMode={})),function(e){e.Mark="mark",e.Point="point",e.Area="area"}(t.AnnotateEnum||(t.AnnotateEnum={})),function(e){e.Discrete="discrete",e.Continuous="continuous",e.Unknown="unknown"}(t.ColumnType||(t.ColumnType={})),function(e){e.Blank="blank",e.Worksheet="worksheet",e.QuickFilter="quick-filter",e.ParameterControl="parameter-control",e.PageFilter="page-filter",e.Legend="legend",e.Title="title",e.Text="text",e.Image="image",e.WebPage="web-page",e.Extension="extension"}(t.DashboardObjectType||(t.DashboardObjectType={})),function(e){e.String="string",e.Int="int",e.Float="float",e.Bool="bool",e.Date="date",e.DateTime="date-time",e.Spatial="spatial",e.Unknown="unknown"}(t.DataType||(t.DataType={})),function(e){e.Window="window",e.Modal="modal",e.Modeless="modeless"}(t.DialogStyle||(t.DialogStyle={})),function(e){e.Number="number",e.String="string",e.Date="date",e.Boolean="boolean"}(t.EncodedDataType||(t.EncodedDataType={})),function(e){e.INITIALIZATION_ERROR="initialization-error",e.INTERNAL_ERROR="internal-error",e.MISSING_ENUM_MAPPING="missing-enum-mapping",e.MISSING_PARAMETER="missing-parameter",e.PERMISSION_DENIED="permission-denied",e.PRES_MODEL_PARSING_ERROR="pres-model-parsing-error",e.VERSION_NOT_CONFIGURED="version-not-configured",e.VISIBILITY_ERROR="visibility-error",e.UNKNOWN_VERB_ID="unknown-verb-id"}(t.ErrorCodes||(t.ErrorCodes={})),function(e){e.Sum="sum",e.Avg="avg",e.Min="min",e.Max="max",e.Stdev="stdev",e.Stdevp="stdevp",e.Var="var",e.Varp="varp",e.Collect="collect",e.Count="count",e.Countd="countd",e.Median="median",e.Attr="attr",e.None="none",e.Year="year",e.Qtr="qtr",e.Month="month",e.Day="day",e.Hour="hour",e.Minute="minute",e.Second="second",e.Week="week",e.Weekday="weekday",e.MonthYear="month-year",e.Mdy="mdy",e.End="end",e.TruncYear="trunc-year",e.TruncQtr="trunc-qtr",e.TruncMonth="trunc-month",e.TruncWeek="trunc-week",e.TruncDay="trunc-day",e.TruncHour="trunc-hour",e.TruncMinute="trunc-minute",e.TruncSecond="trunc-second",e.Quart1="quart1",e.Quart3="quart3",e.Skewness="skewness",e.Kurtosis="kurtosis",e.InOut="in-out",e.User="user"}(t.FieldAggregationType||(t.FieldAggregationType={})),function(e){e.Dimension="dimension",e.Measure="measure",e.Unknown="unknown"}(t.FieldRoleType||(t.FieldRoleType={})),function(e){e.Add="add",e.All="all",e.Replace="replace",e.Remove="remove"}(t.FilterUpdateType||(t.FilterUpdateType={})),function(e){e.Dashboard="dashboard",e.Story="story",e.Worksheet="worksheet"}(t.SheetType||(t.SheetType={})),function(e){e.All="all",e.List="list",e.Range="range"}(t.DomainRestrictionType||(t.DomainRestrictionType={})),function(e){e.Years="years",e.Quarters="quarters",e.Months="months",e.Weeks="weeks",e.Days="days",e.Hours="hours",e.Minutes="minutes",e.Seconds="seconds"}(t.DateStepPeriod||(t.DateStepPeriod={})),function(e){e.NullValues="nullvalues",e.NonNullValues="nonnullvalues",e.AllValues="allvalues"}(t.FilterNullOption||(t.FilterNullOption={})),function(e){e.Relevant="relevant",e.Database="database"}(t.FilterDomainType||(t.FilterDomainType={})),function(e){e.Replace="select-replace",e.Add="select-add",e.Remove="select-remove"}(t.SelectionUpdateType||(t.SelectionUpdateType={})),function(e){e.Simple="select-options-simple",e.Toggle="select-options-toggle",e.Menu="select-options-menu",e.Range="select-options-range",e.Search="select-options-search"}(t.SelectOptions||(t.SelectOptions={})),function(e){e.IncludeNull="include-null",e.IncludeNonNull="include-non-null",e.IncludeAll="include-all"}(t.QuantitativeIncludedValues||(t.QuantitativeIncludedValues={})),function(e){e.AllSelected="all-selected",e.NoneSelected="none-selected",e.SomeSelected="some-selected",e.UnknownSelected="unknown-selected"}(t.HierarchicalLevelSelectionState||(t.HierarchicalLevelSelectionState={})),function(e){e.Bar="bar",e.Line="line",e.Area="area",e.Square="square",e.Circle="circle",e.Shape="shape",e.Text="text",e.Map="map",e.Pie="pie",e.GanttBar="gantt-bar",e.Polygon="polygon",e.Heatmap="heatmap",e.VizExtension="viz-extension"}(t.MarkType||(t.MarkType={})),function(e){e.Categorical="categorical",e.Range="range",e.RelativeDate="relativeDate",e.Hierarchical="hierarchical"}(t.FilterType||(t.FilterType={})),function(e){e.Last="last",e.LastN="lastN",e.Next="next",e.NextN="nextN",e.Current="current",e.ToDate="toDate"}(t.DateRangeType||(t.DateRangeType={})),function(e){e.DialogAlreadyOpen="dialog-already-open",e.InvalidDomain="invalid-domain",e.Success="success"}(t.ExtensionDialogResult||(t.ExtensionDialogResult={})),function(e){e.SingleTableId="single-table-id-sentinel",e.SingleTableCaption="Single table id sentinel"}(t.ApiShowDataTableSentinel||(t.ApiShowDataTableSentinel={})),function(e){e.NativeValuesOnly="native-values-only",e.FormattedValuesOnly="formatted-values-only",e.NativeAndFormattedValues="native-and-formatted-values"}(t.ApiShowDataTableFormat||(t.ApiShowDataTableFormat={})),function(e){e.Letter="letter",e.Legal="legal",e.Note="note",e.Folio="folio",e.Tabloid="tabloid",e.Ledger="ledger",e.Statement="statement",e.Executive="executive",e.A3="a3",e.A4="a4",e.A5="a5",e.B4="b4",e.B5="b5",e.Quarto="quarto",e.Unspecified="unspecified"}(t.PageSizeOption||(t.PageSizeOption={})),function(e){e.Printer="printer",e.Portrait="portrait",e.Landscape="landscape"}(t.PageOrientation||(t.PageOrientation={})),function(e){e.ScaleAuto="auto",e.ScalePercentage="percent",e.ScaleFitPages="fit-pages"}(t.ScaleMode||(t.ScaleMode={})),function(e){e.ScalePctAuto="auto",e.ScalePct400="pct400",e.ScalePct200="pct200",e.ScalePct100="pct100",e.ScalePct90="pct90",e.ScalePct80="pct80",e.ScalePct75="pct75",e.ScalePct60="pct60",e.ScalePct50="pct50",e.ScalePct25="pct25"}(t.PageScalingOption||(t.PageScalingOption={})),function(e){e.FitOneHigh="fit0x1",e.FitTwoHigh="fit0x2",e.FitOneWide="fit1x0",e.FitTwoWide="fit2x0"}(t.FitPages||(t.FitPages={})),function(e){e.Color="color",e.Size="size",e.Label="label",e.Detail="detail",e.Tooltip="tooltip",e.Shape="shape",e.Path="path",e.Angle="angle",e.Geometry="geometry",e.Custom="custom"}(t.EncodingType||(t.EncodingType={}))})(IT);Object.defineProperty(AT,"__esModule",{value:!0});var ho=IT,Dq=function(){function t(){}return t.isSpecial=function(e){return e.length>2&&e[0]==="%"&&e[e.length-1]==="%"},t.parseBoolean=function(e){var n=e.toLowerCase();return n!=="true"&&n!=="false"?this.specialValueIndicator:n==="true"},t.parseNumber=function(e){var n=Number(e);return isNaN(n)?this.specialValueIndicator:n},t.parseDate=function(e){var n=new Date(e);return Number.isNaN(n.getTime())?null:n},t.parseDateTime=function(e){var n=e.replace(" ","T").concat("Z"),a=new Date(n);return Number.isNaN(a.getTime())?null:a},t.convertValueAsStringToValue=function(e,n){if(e!=null){if(this.isSpecial(e))return e;switch(n){case ho.DataType.Bool:return this.parseBoolean(e);case ho.DataType.Int:case ho.DataType.Float:return this.parseNumber(e);case ho.DataType.Date:return this.parseDate(e)===null?this.specialValueIndicator:e;case ho.DataType.DateTime:return this.parseDateTime(e)===null?this.specialValueIndicator:e;case ho.DataType.Spatial:case ho.DataType.String:default:return e}}},t.convertValueToNativeValue=function(e,n){if(e==null)return null;switch(n){case ho.DataType.Bool:return typeof e=="string"?null:e;case ho.DataType.Int:case ho.DataType.Float:return typeof e=="string"?null:e;case ho.DataType.Date:return this.parseDate(e);case ho.DataType.DateTime:return this.parseDateTime(e);case ho.DataType.String:return this.isSpecial(e)?null:e;case ho.DataType.Spatial:default:return e}},t.convertStringValueToNativeValue=function(e,n){return this.convertValueToNativeValue(this.convertValueAsStringToValue(e,n),n)},t.specialValueIndicator="%null%",t}();AT.DataTypeConverter=Dq;var fv={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CustomMarkContextMenuClicked="custom-mark-context-menu-clicked",e.ContextMenuClick="context-menu-click",e.CustomViewRemoved="custom-view-removed",e.CustomViewSaved="custom-view-saved",e.CustomViewSetDefault="custom-view-set-default",e.CustomViewsLoaded="custom-views-loaded",e.DashboardLayoutChanged="dashboard-layout-changed",e.EditButtonClicked="edit-button-clicked",e.EditInDesktopButtonClicked="edit-in-desktop-button-clicked",e.ExtensionDialogUpdate="extension-dialog-update",e.FilterChanged="filter-changed",e.FirstVizSizeKnown="first-viz-size-known",e.ParameterChanged="parameter-changed",e.SelectedMarksChanged="selected-marks-changed",e.SettingsChanged="settings-changed",e.SummaryDataChanged="summary-data-changed",e.TestConversionNotification="test-conversion-notification",e.ToolbarStateChanged="toolbar-state-changed",e.VizInteractive="viz-interactive",e.AskDataInteractive="ask-data-interactive",e.WorkbookReadyToClose="workbook-ready-to-close",e.WorkbookFormattingChanged="workbook-formatting-changed",e.WorkbookPublished="workbook-published",e.WorkbookPublishedAs="workbook-published-as",e.UrlAction="url-action",e.TabSwitched="tab-switched",e.StoryPointSwitched="story-point-switched",e.ReadyToReceiveAuthToken="ready-to-receive-auth-token"}(t.NotificationId||(t.NotificationId={}))})(fv);var pO={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ActiveTablesInfo="active-tables-info",e.AnchorDate="anchor-date",e.AnnotateEnum="annotate-enum",e.AnnotationList="annotation-list",e.CategoricalDomain="categorical-domain",e.ClickThroughEnabled="click-through-enabled",e.ColumnsToInclude="columns-to-include",e.ColumnsToIncludeById="columns-to-include-by-id",e.ConnectionDescriptionSummaries="connection-description-summaries",e.CurrentSheetType="current-sheet-type",e.CustomView="custom-view",e.CustomViewIsDefault="custom-view-is-default",e.CustomViewIsPublic="custom-view-is-public",e.CustomViewLuid="custom-view-luid",e.CustomViewName="custom-view-name",e.CustomViews="custom-views",e.Dashboard="dashboard",e.DashboardFilters="dashboard-filters",e.DashboardName="dashboard",e.DashboardObjectPositionAndSizeUpdate="dashboard-object-position-and-size-update",e.DashboardObjectPositionAndSizeUpdateList="dashboard-object-position-and-size-update-list",e.DataRowIndex="data-row-index",e.DataSchema="data-schema",e.DataSource="data-source",e.DataSourceDataTable="data-source-data-table",e.DataSourceId="data-source-id",e.DataSourceName="data-source-name",e.DataTable="data-table",e.DataTableReader="data-table-reader",e.DateRangeType="date-range-type",e.DeltaTimeMs="delta-time-ms",e.DimValSelectionModels="dimensionValueSelectionModels",e.DomainType="domain-type",e.EmbeddingAbstractQuery="embedding-abstract-query",e.EmbeddingBootstrapInfo="embedding-bootstrap-info",e.ExportCrosstabSheetMap="export-crosstab-sheet-map",e.ExportFile="export-file",e.ExportOriginUrl="export-origin-url",e.ExportPdfOptions="export-pdf-options",e.ExtensionBootstrapInfo="extension-bootstrap-info",e.ExtensionContextMenuIds="extension-context-menu-ids",e.ExtensionDialogH="extension-dialog-height",e.ExtensionDialogPayload="extension-dialog-payload",e.ExtensionDialogResult="extension-dialog-result",e.ExtensionDialogStyle="extension-dialog-style",e.ExtensionDialogUrl="extension-dialog-url",e.ExtensionDialogW="extension-dialog-width",e.ExtensionLocator="extension-locator",e.ExtensionSettingsInfo="extension-settings-info",e.ExtensionZoneId="extension-zone-id",e.ExternalMenuDescription="external-menu-description",e.ExternalMenuHeader="external-menu-header",e.ExternalMenuItemDisplayName="external-menu-item-display-name",e.ExternalMenuItemId="external-menu-item-id",e.Field="field",e.FieldId="field-id",e.FieldName="field-name",e.FilterLevels="filter-levels",e.FilterRangeMax="filter-range-max",e.FilterRangeMin="filter-range-min",e.FilterRangeNullOption="filter-range-null-option",e.FilterUpdateType="filter-update-type",e.FilterValues="filter-values",e.FontNameListItems="font-name-list-items",e.FormattedText="formatted-text",e.FunctionName="function-name",e.HierValSelectionModels="hierarchicalValueSelectionModels",e.HighlightedData="highlighted-data",e.HoverTupleInteraction="hover-tuple-interaction",e.IgnoreAliases="ignore-aliases",e.IgnoreSelection="ignore-selection",e.IncludeAllColumns="include-all-columns",e.InvalidAggFieldName="invalid-agg-field-name",e.InvalidDates="invalid-dates",e.InvalidFieldCaption="invalid-field-caption",e.InvalidFields="invalid-fields",e.InvalidValues="invalid-values",e.IsExcludeMode="is-exclude",e.IsExtensionDialog="is-extension-dialog",e.JoinDescription="join-description",e.LogicalTableId="logical-table-id",e.LogicalTableInfoList="logical-table-info-list",e.MaxHeight="max-height",e.MaxRows="max-rows",e.MaxWidth="max-width",e.MinHeight="min-height",e.MinWidth="min-width",e.PageRowCount="page-row-count",e.ParameterCaption="paremeter-caption",e.ParameterError="parameter-error",e.ParameterFieldName="parameter-field-name",e.ParameterInfo="parameter-info",e.ParameterInfos="parameter-infos",e.ParameterValue="parameter-value",e.PeriodType="period-type",e.QuantitativeDomain="quantitative-dmain",e.QuantRangeSelectionModels="quantativeRangeSelectionModels",e.RangeN="range-n",e.ReplaySpeed="replay-speed",e.SelectedData="selected-data",e.SelectedSheetNames="selected-sheet-names",e.Selection="selection",e.SelectionList="selection-list",e.SelectionUpdateType="selectionUpdateType",e.SelectTuplesInteraction="select-tuples-interaction",e.SendNotifications="send-notifications",e.SettingsValues="settings-values",e.SharedFilterSheets="shared-filter-sheets",e.SharedFiltersInfo="shared-filters-info",e.SheetIdentifier="sheet-identifier",e.SheetName="sheet-name",e.SheetPath="sheet-path",e.ShouldRefreshDS="should-refresh-ds",e.ShowDataTableFormat="show-data-table-format",e.State="state",e.StoryPointIndex="story-point-index",e.StoryPointInfo="story-point-info",e.SwitchToSheetName="switch-to-sheet-name",e.TargetPoint="target-point",e.TestConversionParameter="test-conversion-parameter",e.Text="formatted-text",e.TooltipContext="tooltip-context",e.TooltipTextRequest="tooltip-text-request",e.TooltipText="tooltip-text",e.UnderlyingDataTable="underlying-data-table",e.UnderlyingSummaryDataTable="underlying-summary-data-table",e.Url="url",e.UseTabDelimiters="use-tab-delimiters",e.ViewDataTableCacheId="view-data-table-cache-id",e.ViewDataTableId="view-data-table-id",e.VisualId="visual-id",e.VisualSpecification="visual-specification",e.VizAPIInputJson="vizapi-input-json",e.VizAPIStateWithDataModel="vizapi-state-with-data-model",e.VizAPIStateWarningMsg="vizapi-state-warning-msg",e.VizAPISVG="vizapi-svg",e.WorksheetName="worksheet-name",e.WorksheetFilters="worksheet-filters",e.ZoneIdsVisibilityMap="zone-ids-visibility-map"}(t.ParameterId||(t.ParameterId={}))})(pO);var fO={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ActivateNextStoryPoint="activate-next-story-point",e.ActivatePreviousStoryPoint="activate-previous-story-point",e.ActivateSheet="activateSheet",e.ActivateStoryPoint="activate-story-point",e.AppendExternalMenuItem="append-external-menu-item",e.ApplyCategoricalFilter="categorical-filter",e.ApplyRangeFilter="range-filter",e.ApplyRelativeDateFilter="apply-relative-date-Filter",e.Authenticate="authenticate",e.BlockExtension="block-extension",e.ChangeParameterValue="change-parameter-value",e.ChangeSharedFilter="change-shared-filter",e.ClearFilter="clear-filter",e.ClearSelectedMarks="clear-selected-marks",e.CloseDialog="close-dialog",e.CreateAnnotation="create-annotation",e.DashboardCategoricalFilter="dashboard-categorical-filter",e.DisplayDialog="display-dialog",e.DownloadWorkbook="download-workbook",e.ExecuteExternalMenuItem="execute-external-menu-item",e.ExportCrosstab="export-crosstab",e.ExportCrosstabCsvDownload="export-crosstab-csv-download",e.ExportCrosstabExcelDownload="export-crosstab-excel-download",e.ExportData="export-data",e.ExportDataDownload="export-data-download",e.ExportImage="export-image",e.ExportPdf="export-pdf",e.ExportPdfDownload="export-pdf-download",e.ExportPowerpoint="export-powerpoint",e.ExportPowerpointDownload="export-powerpoint-download",e.FindParameter="find-parameter",e.GetActiveTables="get-active-tables",e.GetAllDataSources="get-all-data-sources",e.GetAnnotations="get-annotations",e.GetCategoricalDomain="get-categorical-domain",e.GetConnectionDescriptionSummaries="get-connection-description-summaries",e.GetCurrentSrc="get-current-src",e.GetCustomViews="get-custom-views",e.GetDashboardFilters="get-dashboard-filters",e.GetDataSource="get-datasource",e.GetDataSourceData="get-datasource-data",e.GetDataSources="get-data-sources",e.GetDataSummaryData="get-summary-data",e.GetDataSummaryDataReader="get-summary-data-reader",e.GetDataTableReaderPage="get-data-table-reader-page",e.GetEmbeddingAbstractQueryWithDataModel="get-embedding-abstract-query-with-data-model",e.GetEmbeddingClientInfo="get-embedding-client-info",e.GetVizStateWithDataModel="get-viz-state-with-data-model",e.GetExportCrosstabSheetMap="get-export-crosstab-sheet-map",e.GetExportPdfOptions="get-export-pdf-options",e.GetField="get-field",e.GetFieldAndDataSource="get-field-and-datasource",e.GetVisualSpecification="get-visual-specification",e.GetFilters="get-filters",e.GetFonts="get-fonts",e.GetHighlightedMarks="get-highlighted-marks",e.GetJoinDescription="get-join-description",e.GetLogicalTableData="get-logical-table-data",e.GetLogicalTableDataReader="get-logical-table-data-reader",e.GetLogicalTables="get-logical-tables",e.GetParametersForSheet="get-parameters-for-sheet",e.GetRangeDomain="get-range-domain",e.GetSelectedMarks="get-selected-marks",e.GetSharedFilter="get-shared-filter",e.GetTooltipText="get-tooltip-text",e.GetUnderlyingData="get-underlying-data",e.GetUnderlyingTableData="get-underlying-table-data",e.GetUnderlyingTableDataReader="get-underlying-table-data-reader",e.GetUnderlyingTables="get-underlying-tables",e.HierarchicalFilter="hierachical-filter",e.InitializeExtension="initialize-extension",e.MoveAndResizeZones="move-and-resize-zones",e.RaiseLeaveMarkNavNotification="raise-leave-mark-nav-notification",e.RaiseHoverTupleNotification="raise-hover-tuple-notification",e.RaiseSelectTuplesNotification="raise-select-tuples-notification",e.Redo="redo",e.RefreshDataSource="refresh-data-source",e.ReleaseDataTableReader="release-data-table-reader",e.RemoveAnnotation="remove-annotation",e.RemoveCustomView="remove-custom-view",e.RemoveExternalMenuItem="remove-external-menu-item",e.RenameExternalMenu="rename-external-menu",e.ReplayAnimation="replay-animation",e.RevertStoryPoint="revert-story-point",e.RevertWorkbook="revert-workbook",e.SaveExtensionSettings="save-extension-settings",e.SaveWorkbookAsCustomView="save-workbook-as-custom-view",e.SelectByValue="select-by-value",e.SetActiveCustomViewAsDefault="set-active-custom-view-as-default",e.SetAutoUpdate="set-auto-update",e.SetClickThrough="set-click-through",e.SetVizStateWithDataModel="set-viz-state-with-data-model",e.SetSheetSize="set-sheet-size",e.SetZoneVisibility="set-zone-visibility",e.Share="share",e.ShowCustomView="show-custom-view",e.TestConversionVerb="test-conversion-verb",e.Undo="undo",e.UpdateCustomView="update-custom-view",e.VizAPI="viz-api"}(t.VerbId||(t.VerbId={}))})(fO);var mO={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.token="token",e.origin="origin",e.showEmbed="showEmbed",e.showPin="showPin",e.showSave="showSave",e.showShare="showShare",e.debug=":jsdebug",e.ApiID=":apiID",e.ApiExternalVersion=":apiExternalVersion",e.ApiInternalVersion=":apiInternalVersion",e.AskDataWebComponent=":askDataWebComponent"}(t.AskDataOptionNames||(t.AskDataOptionNames={}))})(mO);var gO={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.embed="embed",e.token="token",e.disableExploreFilter="disableExploreFilter",e.layout="embed_layout",e.ApiExternalVersion=":apiExternalVersion",e.ApiInternalVersion=":apiInternalVersion",e.PulseWebComponent=":pulseWebComponent"}(t.PulseOptionNames||(t.PulseOptionNames={}))})(gO);var yO={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e;(function(a){a.ONE="1",a.ALERTS=":alerts",a.ALIAS="alias",a.ALLOW_DEFERRED_BOOTSTRAP=":allowDeferredBootstrap",a.ALLOW_AUTOGEN_WORKSHEET_PHONE_LAYOUTS="allowAutogenWorksheetPhoneLayouts",a.API_ID=":apiID",a.APP=":app",a.ATTACHMENT="attachment",a.IS_IPAD_APP="app",a.ANIMATE_TRANSITION=":animate_transition",a.ASCENDING="ascending",a.AUTHENTICATION="authentication",a.ATTRIBUTES="attributes",a.AUTHORING_SHEET=":authSheet",a.AXIS="axis",a.BOOTSTRAP_WHEN_NOTIFIED=":bootstrapWhenNotified",a.BROWSER_BACK_BUTTON_UNDO=":browserBackButtonUndo",a.BROWSER_RENDERING_ON="isBrowserRendering",a.BROWSER_RENDERING_THRESHOLD="browserRenderingThreshold",a.CHARSET="charset",a.CLIENT_DIMENSION="clientDimension",a.CLIENT_IP="client_ip",a.CLIENT_NUM="clientNum",a.COLON_EMBEDDED=":embedded",a.COLON_MOBILE=":mobile",a.COLON_DEEP_LINKING_DISABLED=":deepLinkingDisabled",a.COLON_WATERMARK=":watermark",a.COMMENTS=":comments",a.COMMENTING_ENABLED=":commentingEnabled",a.COMMENTING_MENTIONS_ENABLED=":commentingMentions",a.CONNECTION="connection",a.CREATED_BY_FEATURE="createdByFeature",a.CRYPTED_PASSWORD="crypted",a.CSSDEBUG=":cssdebug",a.CSV="csv",a.CUSTOM_VIEWS=":customViews",a.CV=":cv",a.CV_ID="cvId",a.DASHBOARD_PORT_SIZE="dashboardPortSize",a.DATA_DETAILS=":dataDetails",a.DATASOURCE="datasource",a.DEBUG=":debug",a.DELAY=":delay",a.DEPTH="depth",a.DEVICE_TYPE=":device",a.DEVICE_PIXEL_RATIO="devicePixelRatio",a.DEVICE_PREVIEW_MODE=":devicepreviewmode",a.DIMENSIONS=":dimensions",a.DISABLE_SHARED_SESSIONS=":disable_shared_sessions",a.DISABLE_URL_ACTIONS_POPUPS=":disableUrlActionsPopups",a.DIRECTION="direction",a.DISPLAY_OVERLAY=":display_overlay",a.DISPLAY_SHARE=":display_share",a.DISPLAY_SPINNER=":display_spinner",a.DISPLAY_STATIC_IMAGE=":display_static_image",a.DISPLAY_TABS="display_tabs",a.DISPLAY_VIEW_COUNT=":display_count",a.IGNORE_STICKY_SESSION=":ignore_sticky_session",a.INCREMENT_VIEW_COUNT=":increment_view_count",a.DOCMODE="docmode",a.DOMAIN="domain",a.DO_WORK="do_work",a.DX="dx",a.DY="dy",a.EDIT_DATA_ALERT=":editDataAlert",a.EMBED=":embed",a.EMBEDDED="embedded",a.ENCRYPTED="encrypted",a.API_EXTERNAL_VERSION=":apiExternalVersion",a.API_INTERNAL_VERSION=":apiInternalVersion",a.EXCLUDE="exclude",a.EXPORT_FORMAT=":export_format",a.FIELDNAME="fieldname",a.FIELD_NAME="field_name",a.FIELD_SEP="field_sep",a.FILE="file",a.FILTER_TILE_SIZE="filterTileSize",a.FN="fn",a.FOCUS="focus",a.FORCE_CACHE="force_cache",a.FORMAT="format",a.FORMAT_DATA_VALUE_LOCALLY="formatDataValueLocally",a.FROM_WG=":from_wg",a.GRAPHQL_DATABASE_ID=":graphQLDatabaseId",a.GRAPHQL_TABLE_ID=":graphQLTableId",a.GUID=":guid",a.H="h",a.HIDDEN="hidden",a.HIDE_CLOSE_BUTTON=":hideCloseButton",a.HIDE_EDIT_BUTTON=":hideEditButton",a.HIDE_EDIT_IN_DESKTOP_BUTTON=":hideEditInDesktopButton",a.HIGH_DPI=":highdpi",a.IMAGE_SIZE_LIMIT="imageSizeLimit",a.TRANSPARENT_LINE_MARKS_LIMIT="transparentLineMarkLimit",a.CLIENT_RENDER_PIXEL_LIMIT="clientRenderPixelLimit",a.IN="in",a.INSTANCE_ID=":iid",a.IS_GUEST_REDIRECT_FROM_VIZPORTAL=":isGuestRedirectFromVizportal",a.IS_MARK_ANIMATION_ENABLED="isMarkAnimationEnabled",a.IS_VIZPORTAL=":isVizPortal",a.INPUT_="input_string",a.JSDEBUG=":jsdebug",a.JSON="json",a.JSON_ONLY=":jsonOnly",a.KEEPFILE="keepfile",a.KEY="key",a.LANGUAGE="language",a.LANGUAGE_REQUESTED=":language",a.LINKTARGET=":linktarget",a.LOAD_ORDER_ID=":loadOrderID",a.LOAD_NEWEST_REVISION=":loadNewestRevision",a.LOCAL_PATHS=":localPaths",a.LOCALE="locale",a.LOCATION_ID="locationid",a.LOCATION_TYPE="locationtype",a.WORKBOOK_LOCALE="workbookLocale",a.MAXROWS="maxrows",a.MAX_AGE="maxAge",a.MAX_ROWS="maxRows",a.METHOD="method",a.MOBILE="mobile",a.MODIFIER="modifier",a.NAME="name",a.NAV_TYPE="navType",a.NAV_SRC="navSrc",a.NOATTACHMENT="no-attachment",a.NO_OVERWRITE="no_overwrite",a.OPEN_AUTHORING_IN_TOP_WINDOW=":openAuthoringInTopWindow",a.OPENID_HD=":openid_hd",a.OPENID_LOGIN_HINT=":openid_login_hint",a.OAUTHREQUEST="oauthrequest",a.OAUTH_CREDENTIAL_IDS="oauth_credential_ids",a.OFFLINE_MODE=":offlinemode",a.ORIGIN=":origin",a.OVERLAY=":overlay",a.P="p",a.PATH="path",a.PANE_RESOLVER_X="paneResolverX",a.PANE_RESOLVER_Y="paneResolverY",a.PARAM="param",a.PARENT_ID="parent_id",a.PASSWORD="password",a.PATTERN="pattern",a.PIXEL_RATIO=":pixelratio",a.PREFIX=":prefix",a.PREVIEW=":preview",a.PRIMARY_CONTENT_URL="primary_content_url",a.PROJECT="project",a.PROTOCOL="protocol",a.PSEUDO=":pseudo",a.QUERY="query",a.R="r",a.RANGE_TYPE="range_type",a.RECORD_SEP="record_sep",a.RECORD_CLIENT_PERFORMANCE=":record_client_performance",a.RECORD_PERFORMANCE=":record_performance",a.RECOVER_OLD_SESSION_ID=":recover_old_session_id",a.RECOVER_SESSION_STATE_TICKETS=":recover_session_state_tickets",a.REFRESH=":refresh",a.REFRESHUNMODIFIED=":refreshunmodified",a.REGION="region",a.RELOAD_ON_CUSTOM_VIEW_SAVE=":reloadOnCustomViewSave",a.RENDER=":render",a.RENDER_MAPS_CLIENT_SIDE="renderMapsClientSide",a.RETRY=":retry",a.REUSE="reuse",a.REUSE_FOREVER="reuse_forever",a.REVERT=":revert",a.SAVE_DB_PASSWORDS="save_db_passwords",a.SELECT_X="select_x",a.SELECT_Y="select_y",a.SESSION_FEATURE_PREFIX=":ff_",a.SESSION_FLAGS=":session_feature_flags",a.SHARE_BUTTON="share_button",a.SHEET_ID="sheet_id",a.SHARED="shared",a.SHOWALL="showall",a.SHOW_APP_BANNER=":showAppBanner",a.SHOW_ASK_DATA=":showAskData",a.SHOW_PARAMS="showParams",a.SHOW_SHARE_OPTIONS=":showShareOptions",a.SIZE=":size",a.SOURCE="source",a.STATE="state",a.STICKY_SESSION_KEY="stickySessionKey",a.SUBSCRIPTIONS=":subscriptions",a.SUMMARY="summary",a.SUPPRESS_DEFAULT_EDIT_BEHAVIOR=":suppressDefaultEditBehavior",a.SYNC_SESSION=":sync_session",a.SYNC_SESSION_STATE="sync_session_state",a.TABS=":tabs",a.TARGET="target",a.TARGET_SITE="target_site",a.TOOLBAR=":toolbar",a.TOOLTIP=":tooltip",a.TS="ts",a.UNDERLYING_TABLE_ID="underlying_table_id",a.UNDERLYING_TABLE_CAPTION="underlying_table_caption",a.UPDATE_TYPE="update_type",a.USE_GUEST=":useGuest",a.USE_INLINE_IMAGES="use_inline_images",a.USERAGENT="useragent",a.USERNAME="username",a.VALUE="value",a.VERBOSE_MODE="verboseMode",a.VIEW_ID="views_id",a.VIZ_SNAPSHOT_ID="viz_snapshot_id",a.VW=":vw",a.W="w",a.WORKSHEET_PORT_SIZE="worksheetPortSize",a.WATERMARK="watermark",a.WATERMARK_MARGIN=":watermark_margin",a.WB=":wb",a.WHICH="which",a.X="x",a.Y="y",a.ZID="zid",a.ZONE_ID="zone_id",a.KEYCHAIN_VERSION="keychain_version",a.DATASOURCE_ID="datasource_id",a.DATASOURCE_NAME="datasource_name",a.LENS_ID="lens_id",a.WIDTH="width",a.HEIGHT="height",a.LAYOUT_VIEWS="views",a.LAYOUT_MENUS="menus",a.LAYOUT_GEOMETRY="geometry",a.LAYOUT_PAGES="pages",a.LAYOUT_CACHEURL="cacheurl",a.LAYOUT_SHEET="sheet",a.LAYOUT_DEPTH="depth"})(e||(e={}));var n;(function(a){a.SHOW_VIZ_HOME=":showVizHome"})(n||(n={})),function(a){a.Size=":size",a.Embed=":embed",a.ApiInternalVersion=":apiInternalVersion",a.ApiExternalVersion=":apiExternalVersion",a.ShowVizHome=":showVizHome",a.Jsdebug=":jsdebug",a.BootstrapWhenNotified=":bootstrapWhenNotified",a.NavType="navType",a.NavSrc="navSrc",a.debug=":jsdebug",a.ApiID=":apiID",a.disableUrlActionsPopups=":disableUrlActionsPopups",a.hideTabs=":tabs",a.toolbar=":toolbar",a.device=":device",a.instanceIdToClone=":iid",a.touchOptimize="mobile",a.hideEditButton=":hideEditButton",a.hideEditInDesktopButton=":hideEditInDesktopButton",a.suppressDefaultEditBehavior=":suppressDefaultEditBehavior",a.hideCloseButton=":hideCloseButton"}(t.VizOptionNames||(t.VizOptionNames={}))})(yO);var ey={},_O={exports:{}};(function(t){(function(){var e=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i");function n(u){for(var d="",_=0;_<u;_++)d+=((1+Math.random())*65536|0).toString(16).substring(1);return d}function a(u){if(!u)throw new TypeError("Invalid argument; `value` has no value.");this.value=a.EMPTY,u&&u instanceof a?this.value=u.toString():u&&Object.prototype.toString.call(u)==="[object String]"&&a.isGuid(u)&&(this.value=u),this.equals=function(d){return a.isGuid(d)&&this.value==d},this.isEmpty=function(){return this.value===a.EMPTY},this.toString=function(){return this.value},this.toJSON=function(){return this.value}}a.EMPTY="00000000-0000-0000-0000-000000000000",a.isGuid=function(u){return u&&(u instanceof a||e.test(u.toString()))},a.create=function(){return new a([n(2),n(1),n(1),n(1),n(3)].join("-"))},a.raw=function(){return[n(2),n(1),n(1),n(1),n(3)].join("-")},t.exports?t.exports=a:typeof window<"u"&&(window.Guid=a)})()})(_O);var vO=_O.exports,CT={};Object.defineProperty(CT,"__esModule",{value:!0});var Mq=function(){function t(e,n,a){this._message=e,this._target=n,this._origin=a}return Object.defineProperty(t.prototype,"messageGuid",{get:function(){return this._message.msgGuid},enumerable:!0,configurable:!0}),t.prototype.send=function(){return this._target.postMessage(this._message,this._origin),this},t}();CT.CrossFramePreparedMessage=Mq;var pl={},mv={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Initialize="initialize",e.Notification="notification",e.Command="command",e.CommandResponse="command-response",e.Handshake="v-handshake",e.Ack="v-ack"}(t.MessageType||(t.MessageType={}))})(mv);Object.defineProperty(pl,"__esModule",{value:!0});var xO=vO,Lf=fv,Ss=mv,zq=new Set([Lf.NotificationId.EditButtonClicked,Lf.NotificationId.EditInDesktopButtonClicked,Lf.NotificationId.WorkbookPublished,Lf.NotificationId.WorkbookReadyToClose,Lf.NotificationId.ReadyToReceiveAuthToken]);function Vd(t){if(!t)return!1;var e=t;if(!e||!e.msgGuid||!e.msgType||!xO.isGuid(e.msgGuid)||typeof e.msgType!="string")return!1;var n=[Ss.MessageType.Command,Ss.MessageType.CommandResponse,Ss.MessageType.Initialize,Ss.MessageType.Notification,Ss.MessageType.Handshake];return!(n.indexOf(e.msgType)<0)}pl.isMessage=Vd;function XE(t){if(!t)return!1;var e=t;return!(typeof e!="object"||typeof e.fix!="number"||typeof e.minor!="number"||typeof e.major!="number")}pl.isVersion=XE;function Rq(t){if(!Vd(t))return!1;var e=t;return!(e.msgType!==Ss.MessageType.Initialize||!e.apiVersion||!XE(e.apiVersion)||!e.crossFrameVersion||!XE(e.crossFrameVersion))}pl.isInitMessage=Rq;function Oq(t){if(!Vd(t))return!1;var e=t;return!(e.msgType!==Ss.MessageType.CommandResponse||!xO.isGuid(e.commandGuid)||!e.data&&!e.error)}pl.isCommandResponseMessage=Oq;function Fq(t){if(!Vd(t))return!1;var e=t;return!(e.msgType!==Ss.MessageType.Command||!e.parameters||typeof e.parameters!="object"||!e.verbId||typeof e.verbId!="string")}pl.isCommandMessage=Fq;function Lq(t){if(!Vd(t))return!1;var e=t;return!(e.msgType!==Ss.MessageType.Notification||!e.data&&!zq.has(e.notificationId)||!e.notificationId||typeof e.notificationId!="string")}pl.isNotificationMessage=Lq;function Bq(t){if(!Vd(t))return!1;var e=t;return e.msgType===Ss.MessageType.Handshake}pl.isHandshakeMessage=Bq;var KP;function Nq(){if(KP)return ey;KP=1,Object.defineProperty(ey,"__esModule",{value:!0});var t=vO,e=hr(),n=CT,a=pl,u=mv,d=function(){function _(l,w,T){this.thisWindow=l,this.otherWindow=w,this.otherWindowOrigin=T}return _.prototype.startListening=function(){var l=this;if(!this.unregisterFunction){var w=this.onMessageReceived.bind(this);this.thisWindow.addEventListener("message",w,!0),this.unregisterFunction=function(){return l.thisWindow.removeEventListener("message",w,!0)}}},_.prototype.stopListening=function(){this.unregisterFunction&&(this.unregisterFunction(),this.unregisterFunction=void 0)},_.prototype.setInitializeMessageHandler=function(l){this.initializeMessageHandler=l},_.prototype.setCommandResponseMessageHandler=function(l){this.commandResponseMessageHandler=l},_.prototype.setCommandMessageHandler=function(l){this.commandMessageHandler=l},_.prototype.setNotificationMessageHandler=function(l){this.notificationMessageHandler=l},_.prototype.setHandshakeMessageHandler=function(l){this.handshakeMessageHandler=l},_.prototype.prepareInitializationMessage=function(l,w,T){var C={msgGuid:t.raw(),msgType:u.MessageType.Initialize,crossFrameVersion:w,apiVersion:l,options:T};return this.prepareMessage(C)},_.prototype.prepareCommandMessage=function(l,w){var T={msgGuid:t.raw(),msgType:u.MessageType.Command,verbId:l,parameters:w};return this.prepareMessage(T)},_.prototype.prepareCommandResponseMessage=function(l,w,T){var C={msgGuid:t.raw(),msgType:u.MessageType.CommandResponse,commandGuid:l,data:w,error:T};return T&&(C.error=JSON.parse(JSON.stringify(T))),this.prepareMessage(C)},_.prototype.prepareNotificationMessage=function(l,w){var T={msgGuid:t.raw(),msgType:u.MessageType.Notification,notificationId:l,data:w};return this.prepareMessage(T)},_.prototype.prepareAckMessage=function(){var l={msgGuid:t.raw(),msgType:u.MessageType.Ack,platformVersion:e.INTERNAL_CONTRACT_VERSION};return this.prepareMessage(l)},_.prototype.prepareMessage=function(l){if(!this.otherWindow||!this.otherWindowOrigin)throw"Other window not initialized, cannot dispatch messages";var w=new n.CrossFramePreparedMessage(l,this.otherWindow,this.otherWindowOrigin);return w},_.prototype.onMessageReceived=function(l){if(!(this.otherWindow&&l.source!==this.otherWindow)&&l.data){var w=l.data;if(a.isMessage(w))switch(w.msgType){case u.MessageType.Initialize:{if(!a.isInitMessage(w)||!this.initializeMessageHandler)return;this.initializeMessageHandler(w,l.source);break}case u.MessageType.CommandResponse:{if(!a.isCommandResponseMessage(w)||!this.commandResponseMessageHandler)return;this.commandResponseMessageHandler(w,l.source);break}case u.MessageType.Command:{if(!a.isCommandMessage(w)||!this.commandMessageHandler)return;this.commandMessageHandler(w,l.source);break}case u.MessageType.Notification:{if(!a.isNotificationMessage(w)||!this.notificationMessageHandler)return;this.notificationMessageHandler(w,l.source);break}case u.MessageType.Handshake:{if(!a.isHandshakeMessage(w)||!this.handshakeMessageHandler)return;this.handshakeMessageHandler(w,l.source);break}}}},_.prototype.setOtherWindow=function(l){this.otherWindow=l},_.prototype.setOtherWindowOrigin=function(l){this.otherWindowOrigin=l},_}();return ey.CrossFrameMessenger=d,ey}var kT={},PT={};Object.defineProperty(PT,"__esModule",{value:!0});var Uq=function(){function t(){}return t.prototype.upgradeExecuteCall=function(e,n){return{verb:e,parameters:n}},t.prototype.downgradeExecuteReturn=function(e){return e},t.prototype.downgradeNotification=function(e){return e},t}();PT.IdentityVersionConverter=Uq;var DT={};Object.defineProperty(DT,"__esModule",{value:!0});var jq=function(){function t(e,n,a,u,d){if(this._externalMajorVersion=e,this._platformMajorVersion=n,this._upgradeExecuteTranslations=a,this._downgradeExecuteTranslations=u,this._downgradeNotificationTranslations=d,this._externalMajorVersion>this._platformMajorVersion)throw new Error("Cannot convert between external version "+this._externalMajorVersion+" and "+this._platformMajorVersion)}return t.fromData=function(e,n,a,u,d){return new this(e.major,n.major,a,u,d)},t.prototype.upgradeExecuteCall=function(e,n){for(var a={verb:e,parameters:n},u=0,d=this._upgradeExecuteTranslations;u<d.length;u++){var _=d[u];a=_(a.verb,a.parameters)}return a},t.prototype.downgradeExecuteReturn=function(e){for(var n=e,a=0,u=this._downgradeExecuteTranslations;a<u.length;a++){var d=u[a];n=d(n)}return n},t.prototype.downgradeNotification=function(e){for(var n=e,a=0,u=this._downgradeNotificationTranslations;a<u.length;a++){var d=u[a];n=d(n)}return n},t}();DT.StackingVersionConverter=jq;var gv={};Object.defineProperty(gv,"__esModule",{value:!0});var Vq=fv;function $q(t){var e=t.result;return e.extensionDashboardInfo!==void 0&&e.extensionDashboardInfo.zones.forEach(function(n){n.sheetInfo&&(n.name=n.sheetInfo.name)}),t}gv.DowngradeWorksheetNames=$q;function Wq(t){if(t.notificationId===Vq.NotificationId.SelectedMarksChanged){var e=t.data;e.flipboardZoneID===void 0&&(e.flipboardZoneID=0)}return t}gv.DowngradeFlipboardZoneID=Wq;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=PT,n=DT,a=gv;function u(C,P){return C.major>P.major?!1:C.major<P.major?!0:C.minor<P.minor}t.VersionLessThan=u;function d(C,P){return C.major===P.major&&C.minor===P.minor}t.VersionEqualTo=d,t.ExecuteMinorUpgrades={1:{9:[]}},t.ExecuteMinorDowngrades={1:{5:[a.DowngradeWorksheetNames],9:[]}},t.NotificationMinorDowngrades={1:{9:[],10:[a.DowngradeFlipboardZoneID]}};function _(C,P){return l(C,P,t.ExecuteMinorUpgrades,t.ExecuteMinorDowngrades,t.NotificationMinorDowngrades)}t.CreateVersionConverter=_;function l(C,P,z,$,U){var W=C.major,N=C.minor,V=P.major;if(W>V)throw new Error(`External version must be less than or equal to platform version.
    externalMajorVersion=`+W+" platformMajorVersion="+V);if(d(C,P))return new e.IdentityVersionConverter;var R=w(W,V,N,z),F=w(W,V,N,$),H=w(W,V,N,U);return F.reverse(),H.reverse(),n.StackingVersionConverter.fromData(C,P,R,F,H)}t.CreateVersionConverterWithTranslators=l;function w(C,P,z,$){for(var U=[],W=C;W<=P;W++)if(W in $)for(var N=W===C?z:0,V=T(Object.keys($[W])),R=N;R<=V;R++)R in $[W]&&U.push.apply(U,$[W][R]);return U}function T(C){return C.map(function(P){return Number(P)}).reduce(function(P,z){return P>z?P:z})}t.GetMaximumMinorIndex=T})(kT);var yv={};Object.defineProperty(yv,"__esModule",{value:!0});var Gq=function(){function t(){}return t.prototype.downgradeExecuteCall=function(e,n){return{verb:e,parameters:n}},t.prototype.upgradeExecuteReturn=function(e,n,a){return e},t.prototype.upgradeNotification=function(e){return e},t}();yv.ExternalIdentityVersionConverter=Gq;var Mb={},MT={};Object.defineProperty(MT,"__esModule",{value:!0});var Hq=function(){function t(e,n,a,u,d){if(this._externalVersion=e,this._platformVersion=n,this._downgradeExecuteCallTranslations=a,this._upgradeExecuteReturnTranslations=u,this._upgradeNotificationTranslations=d,this._externalVersion.major>this._platformVersion.major)throw new Error("Cannot convert between external version "+this._externalVersion.major+`
      and `+this._platformVersion.major)}return t.prototype.downgradeExecuteCall=function(e,n){for(var a={verb:e,parameters:n},u=0,d=this._downgradeExecuteCallTranslations;u<d.length;u++){var _=d[u];a=_(a.verb,a.parameters)}return a},t.prototype.upgradeExecuteReturn=function(e,n,a){for(var u=e,d=0,_=this._upgradeExecuteReturnTranslations;d<_.length;d++){var l=_[d];u=l(u,n,a)}return u},t.prototype.upgradeNotification=function(e){for(var n=e,a=0,u=this._upgradeNotificationTranslations;a<u.length;a++){var d=u[a];n=d(n)}return n},t}();MT.ExternalStackingVersionConverter=Hq;var mu={},XP;function qq(){if(XP)return mu;XP=1,Object.defineProperty(mu,"__esModule",{value:!0});var t=hr();function e(P,z,$){if(!P)return P;var U=P.result;if(U.data!==void 0&&U.isSummary!==void 0)return u(U.data),P;var W=P.result;return W.data!==void 0&&Array.isArray(W.data)&&W.data.forEach(function(N){u(N)}),P}mu.UpgradeDataTableTypes=e;function n(P,z){return P===t.VerbId.GetUnderlyingTableData&&(d(P,z),P=t.VerbId.GetUnderlyingData),{verb:P,parameters:z}}mu.DowngradeUnderlyingTableDataAsync=n;function a(P,z){return P===t.VerbId.GetLogicalTableData&&(d(P,z),P=t.VerbId.GetDataSourceData),{verb:P,parameters:z}}mu.DowngradeLogicalTableDataAsync=a;function u(P){P===void 0||P.dataTable===void 0||!Array.isArray(P.dataTable)||P.dataTable.forEach(function(z){z.forEach(function($,U){var W=$.value;W!==null&&($.value=t.DataTypeConverter.convertValueAsStringToValue(W,P.headers[U].dataType))})})}function d(P,z){if(z[t.ParameterId.LogicalTableId]!==t.ApiShowDataTableSentinel.SingleTableId)throw new Error("Invalid logical table id passed to "+P+".")}function _(P,z,$){return l(z)&&$[t.ParameterId.MaxRows]&&(P=T(P,$[t.ParameterId.MaxRows])),w(z)&&$[t.ParameterId.ColumnsToIncludeById]&&(P=C(P,$[t.ParameterId.ColumnsToIncludeById])),P}mu.UpgradeDataTableRowsAndColumns=_;function l(P){return P===t.VerbId.GetDataSummaryData}function w(P){return P===t.VerbId.GetDataSummaryData||P===t.VerbId.GetUnderlyingTableData||P===t.VerbId.GetLogicalTableData||P===t.VerbId.GetDataSourceData||P===t.VerbId.GetUnderlyingData}function T(P,z){var $=P.result;return!$.data||!Array.isArray($.data.dataTable)||z>0&&z<$.data.dataTable.length&&($.data.dataTable.length=z),P}function C(P,z){if(z.length===0)return P;var $=P.result;if(!$.data||!Array.isArray($.data.dataTable)||!Array.isArray($.data.headers))return P;var U=$.data.headers.filter(function(N,V){return z.find(function(R){return R===N.fieldName})});$.data.dataTable.forEach(function(N,V){$.data.dataTable[V]=N.filter(function(R,F){return U.findIndex(function(H){return H.index===F})!==-1})});var W=0;return $.data.headers=U.map(function(N){return N.index=W++,N}),P}return mu}var YP;function Zq(){return YP||(YP=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=kT,n=yv,a=MT,u=qq();t.ExecuteMinorDowngradeCallExternal={1:{9:[],13:[u.DowngradeUnderlyingTableDataAsync,u.DowngradeLogicalTableDataAsync]}},t.ExecuteMinorUpgradeReturnExternal={1:{9:[u.UpgradeDataTableTypes],29:[u.UpgradeDataTableRowsAndColumns]}},t.ExecuteMinorUpgradeNotification={1:{9:[]}};function d(w,T){return _(w,T,t.ExecuteMinorDowngradeCallExternal,t.ExecuteMinorUpgradeReturnExternal,t.ExecuteMinorUpgradeNotification)}t.CreateExternalCompatibleVersionConverter=d;function _(w,T,C,P,z){var $=w.major,U=T.major,W=T.minor;if($>U)throw new Error(`External version must be less than or equal to platform version.
    externalMajorVersion=`+$+" platformMajorVersion="+U);if($<U||e.VersionEqualTo(w,T))return new n.ExternalIdentityVersionConverter;var N=l(U,W,C),V=l(U,W,P),R=l(U,W,z);return N.reverse(),new a.ExternalStackingVersionConverter(w,T,N,V,R)}t.CreateExternalCompatibleVersionConverterWithTranslators=_;function l(w,T,C){var P=[];if(w in C)for(var z=T,$=e.GetMaximumMinorIndex(Object.keys(C[w])),U=z;U<=$;U++)U in C[w]&&P.push.apply(P,C[w][U]);return P}}(Mb)),Mb}var QP;function hr(){return QP||(QP=1,function(t){function e(a){for(var u in a)t.hasOwnProperty(u)||(t[u]=a[u])}Object.defineProperty(t,"__esModule",{value:!0});var n=Pq;t.INTERNAL_CONTRACT_VERSION=n,e(AT),e(IT),e(fv),e(pO),e(fO),e(mO),e(gO),e(yO),e(Nq()),e(mv),e(kT),e(yv),e(Zq()),t.MESSAGING_VERSION={major:1,minor:0,fix:0}}(mb)),mb}var _v={};Object.defineProperty(_v,"__esModule",{value:!0});var Kq=Nt,Xq=function(){function t(e){if(this._messenger=e,this._pendingPromises={},this._notificationHandlers=[],!this._messenger)throw"Missing messenger object";this._messenger.setCommandResponseMessageHandler(this.onCommandResponse.bind(this)),this._messenger.setNotificationMessageHandler(this.onNotification.bind(this))}return t.prototype.execute=function(e,n){var a=this,u=this._messenger.prepareCommandMessage(e,n),d=new Promise(function(_,l){a._pendingPromises[u.messageGuid]={resolve:_,reject:l}});return u.send(),d},t.prototype.registerNotificationHandler=function(e){this._notificationHandlers.push(e)},t.prototype.unregisterNotificationHandler=function(e){this._notificationHandlers=this._notificationHandlers.filter(function(n){return n!==e})},t.prototype.onCommandResponse=function(e){if(!(Object.keys(this._pendingPromises).indexOf(e.commandGuid)<0)){var n=this._pendingPromises[e.commandGuid];e.error&&n.reject(e.error),e.data&&n.resolve({result:e.data}),delete this._pendingPromises[e.commandGuid]}},t.prototype.onNotification=function(e){for(var n=0,a=this._notificationHandlers;n<a.length;n++){var u=a[n];try{u({notificationId:e.notificationId,data:e.data})}catch(d){if(d.errorCode===Kq.EmbeddingErrorCodes.IncompatibleVersionError)throw d}}},t}();_v.CrossFrameDispatcher=Xq;Object.defineProperty(mT,"__esModule",{value:!0});var JP=hr(),Yq=_v;function Qq(t){try{return t.self!==t.parent}catch{return!0}}function Jq(t,e,n){return new Promise(function(a,u){var d;Qq(t)?d=t.parent:d=t.opener,d||u("This extension is not running inside an iframe, desktop, or popup window. Initialization failed.");var _=new JP.CrossFrameMessenger(t,d,"*"),l=_.prepareInitializationMessage(e,JP.MESSAGING_VERSION,n);_.setCommandResponseMessageHandler(function(w){if(w.commandGuid===l.messageGuid){var T=function(){return new Yq.CrossFrameDispatcher(_)};a(T)}}),_.startListening(),l.send()})}mT.doCrossFrameBootstrap=Jq;var $m={};Object.defineProperty($m,"__esModule",{value:!0});var eZ=function(){function t(e){this._dataSourceImpl=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._dataSourceImpl.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._dataSourceImpl.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this._dataSourceImpl.fields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extractUpdateTime",{get:function(){return this._dataSourceImpl.extractUpdateTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExtract",{get:function(){return this._dataSourceImpl.isExtract},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPublished",{get:function(){return this._dataSourceImpl.isPublished},enumerable:!0,configurable:!0}),t.prototype.publishedUrl=function(){return this._dataSourceImpl.publishedUrl()},t.prototype.refreshAsync=function(){return this._dataSourceImpl.refreshAsync()},t.prototype.getActiveTablesAsync=function(){return console.warn("DataSource.getActiveTablesAsync is deprecated. Please use DataSource.getLogicalTablesAsync."),this._dataSourceImpl.getActiveTablesAsync()},t.prototype.getConnectionSummariesAsync=function(){return this._dataSourceImpl.getConnectionSummariesAsync()},t.prototype.getUnderlyingDataAsync=function(e){return console.warn("DataSource.getUnderlyingDataAsync is deprecated. Please use DataSource.getLogicalTablesAsync and DataSource.getLogicalTableDataAsync."),this._dataSourceImpl.getUnderlyingDataAsync(e)},t.prototype.getLogicalTablesAsync=function(){return this._dataSourceImpl.getLogicalTablesAsync()},t.prototype.getLogicalTableDataAsync=function(e,n){return this._dataSourceImpl.getLogicalTableDataAsync(e,n)},t.prototype.getLogicalTableDataReaderAsync=function(e,n,a){return this._dataSourceImpl.getLogicalTableDataReaderAsync(e,n,a)},t}();$m.DataSource=eZ;var Sc={},vv={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Nt,n=Mn,a=function(){function d(_,l){this._mappings=_,this._defaultVal=l}return d.prototype.convert=function(_,l){if(l===void 0&&(l=u.Yes),this._mappings.hasOwnProperty(_))return this._mappings[_];if(this._defaultVal!==void 0&&l!==u.Yes)return this._defaultVal;throw new n.TableauError(e.ErrorCodes.InternalError,"Enum Mapping not found for: "+_)},d}();t.EnumConverter=a;var u;(function(d){d.Yes="yes",d.No="no"})(u=t.ShouldThrow||(t.ShouldThrow={}))})(vv);var ty,Bf,$h,ry,Nf,Uf,jf,ms,Zl,Vf;Object.defineProperty(Sc,"__esModule",{value:!0});var _r=Nt,Ur=hr(),gs=vv,tZ=function(){function t(){}return t.filterDomainType=new gs.EnumConverter((ty={},ty[_r.FilterDomainType.Relevant]=Ur.FilterDomainType.Relevant,ty[_r.FilterDomainType.Database]=Ur.FilterDomainType.Database,ty)),t.nullOptions=new gs.EnumConverter((Bf={},Bf[_r.FilterNullOption.AllValues]=Ur.FilterNullOption.AllValues,Bf[_r.FilterNullOption.NonNullValues]=Ur.FilterNullOption.NonNullValues,Bf[_r.FilterNullOption.NullValues]=Ur.FilterNullOption.NullValues,Bf)),t.filterUpdateType=new gs.EnumConverter(($h={},$h[_r.FilterUpdateType.Add]=Ur.FilterUpdateType.Add,$h[_r.FilterUpdateType.All]=Ur.FilterUpdateType.All,$h[_r.FilterUpdateType.Remove]=Ur.FilterUpdateType.Remove,$h[_r.FilterUpdateType.Replace]=Ur.FilterUpdateType.Replace,$h)),t.setVisibilityType=new gs.EnumConverter((ry={},ry[_r.ZoneVisibilityType.Show]=!0,ry[_r.ZoneVisibilityType.Hide]=!1,ry)),t.setReplaySpeedType=new gs.EnumConverter((Nf={},Nf[_r.ReplaySpeedType.Slow]=2,Nf[_r.ReplaySpeedType.Normal]=1,Nf[_r.ReplaySpeedType.Fast]=.5,Nf)),t.sheetType=new gs.EnumConverter((Uf={},Uf[_r.SheetType.Dashboard]=Ur.SheetType.Dashboard,Uf[_r.SheetType.Worksheet]=Ur.SheetType.Worksheet,Uf[_r.SheetType.Story]=Ur.SheetType.Story,Uf)),t.showDataTableFormatType=new gs.EnumConverter((jf={},jf[_r.IncludeDataValuesOption.AllValues]=Ur.ApiShowDataTableFormat.NativeAndFormattedValues,jf[_r.IncludeDataValuesOption.OnlyNativeValues]=Ur.ApiShowDataTableFormat.NativeValuesOnly,jf[_r.IncludeDataValuesOption.OnlyFormattedValues]=Ur.ApiShowDataTableFormat.FormattedValuesOnly,jf)),t.periodType=new gs.EnumConverter((ms={},ms[_r.PeriodType.Years]=Ur.DateStepPeriod.Years,ms[_r.PeriodType.Quarters]=Ur.DateStepPeriod.Quarters,ms[_r.PeriodType.Months]=Ur.DateStepPeriod.Months,ms[_r.PeriodType.Weeks]=Ur.DateStepPeriod.Weeks,ms[_r.PeriodType.Days]=Ur.DateStepPeriod.Days,ms[_r.PeriodType.Hours]=Ur.DateStepPeriod.Hours,ms[_r.PeriodType.Minutes]=Ur.DateStepPeriod.Minutes,ms[_r.PeriodType.Seconds]=Ur.DateStepPeriod.Seconds,ms)),t.dateRangeType=new gs.EnumConverter((Zl={},Zl[_r.DateRangeType.Last]=Ur.DateRangeType.Last,Zl[_r.DateRangeType.LastN]=Ur.DateRangeType.LastN,Zl[_r.DateRangeType.Next]=Ur.DateRangeType.Next,Zl[_r.DateRangeType.NextN]=Ur.DateRangeType.NextN,Zl[_r.DateRangeType.Current]=Ur.DateRangeType.Current,Zl[_r.DateRangeType.ToDate]=Ur.DateRangeType.ToDate,Zl)),t.dialogStyles=new gs.EnumConverter((Vf={},Vf[_r.DialogStyle.Window]=Ur.DialogStyle.Window,Vf[_r.DialogStyle.Modal]=Ur.DialogStyle.Modal,Vf[_r.DialogStyle.Modeless]=Ur.DialogStyle.Modeless,Vf)),t}();Sc.ExternalToInternalEnumMappings=tZ;var fl={},ny,iy,$f,lr,Wf,Gf,Mo,Xs,Wh,Hf,ys,Kl,Na,Gh,ia,Hh,qf,Xi;Object.defineProperty(fl,"__esModule",{value:!0});var Xe=Nt,rt=hr(),pi=vv,rZ=function(){function t(){}return t.extensionContext=new pi.EnumConverter((ny={},ny[rt.ExtensionContext.Desktop]=Xe.ExtensionContext.Desktop,ny[rt.ExtensionContext.Server]=Xe.ExtensionContext.Server,ny)),t.extensionMode=new pi.EnumConverter((iy={},iy[rt.ExtensionMode.Authoring]=Xe.ExtensionMode.Authoring,iy[rt.ExtensionMode.Viewing]=Xe.ExtensionMode.Viewing,iy)),t.columnType=new pi.EnumConverter(($f={},$f[rt.ColumnType.Continuous]=Xe.ColumnType.Continuous,$f[rt.ColumnType.Discrete]=Xe.ColumnType.Discrete,$f[rt.ColumnType.Unknown]=Xe.ColumnType.Unknown,$f)),t.fieldAggregationType=new pi.EnumConverter((lr={},lr[rt.FieldAggregationType.Attr]=Xe.FieldAggregationType.Attr,lr[rt.FieldAggregationType.Avg]=Xe.FieldAggregationType.Avg,lr[rt.FieldAggregationType.Collect]=Xe.FieldAggregationType.Collect,lr[rt.FieldAggregationType.Count]=Xe.FieldAggregationType.Count,lr[rt.FieldAggregationType.Countd]=Xe.FieldAggregationType.Countd,lr[rt.FieldAggregationType.Day]=Xe.FieldAggregationType.Day,lr[rt.FieldAggregationType.End]=Xe.FieldAggregationType.End,lr[rt.FieldAggregationType.Hour]=Xe.FieldAggregationType.Hour,lr[rt.FieldAggregationType.InOut]=Xe.FieldAggregationType.InOut,lr[rt.FieldAggregationType.Kurtosis]=Xe.FieldAggregationType.Kurtosis,lr[rt.FieldAggregationType.Max]=Xe.FieldAggregationType.Max,lr[rt.FieldAggregationType.Mdy]=Xe.FieldAggregationType.Mdy,lr[rt.FieldAggregationType.Median]=Xe.FieldAggregationType.Median,lr[rt.FieldAggregationType.Min]=Xe.FieldAggregationType.Min,lr[rt.FieldAggregationType.Minute]=Xe.FieldAggregationType.Minute,lr[rt.FieldAggregationType.MonthYear]=Xe.FieldAggregationType.MonthYear,lr[rt.FieldAggregationType.None]=Xe.FieldAggregationType.None,lr[rt.FieldAggregationType.Qtr]=Xe.FieldAggregationType.Qtr,lr[rt.FieldAggregationType.Quart1]=Xe.FieldAggregationType.Quart1,lr[rt.FieldAggregationType.Quart3]=Xe.FieldAggregationType.Quart3,lr[rt.FieldAggregationType.Second]=Xe.FieldAggregationType.Second,lr[rt.FieldAggregationType.Skewness]=Xe.FieldAggregationType.Skewness,lr[rt.FieldAggregationType.Stdev]=Xe.FieldAggregationType.Stdev,lr[rt.FieldAggregationType.Stdevp]=Xe.FieldAggregationType.Stdevp,lr[rt.FieldAggregationType.Sum]=Xe.FieldAggregationType.Sum,lr[rt.FieldAggregationType.TruncDay]=Xe.FieldAggregationType.TruncDay,lr[rt.FieldAggregationType.TruncHour]=Xe.FieldAggregationType.TruncHour,lr[rt.FieldAggregationType.TruncMinute]=Xe.FieldAggregationType.TruncMinute,lr[rt.FieldAggregationType.TruncMonth]=Xe.FieldAggregationType.TruncMonth,lr[rt.FieldAggregationType.TruncQtr]=Xe.FieldAggregationType.TruncQtr,lr[rt.FieldAggregationType.TruncSecond]=Xe.FieldAggregationType.TruncSecond,lr[rt.FieldAggregationType.TruncWeek]=Xe.FieldAggregationType.TruncWeek,lr[rt.FieldAggregationType.TruncYear]=Xe.FieldAggregationType.TruncYear,lr[rt.FieldAggregationType.User]=Xe.FieldAggregationType.User,lr[rt.FieldAggregationType.Var]=Xe.FieldAggregationType.Var,lr[rt.FieldAggregationType.Varp]=Xe.FieldAggregationType.Varp,lr[rt.FieldAggregationType.Week]=Xe.FieldAggregationType.Week,lr[rt.FieldAggregationType.Weekday]=Xe.FieldAggregationType.Weekday,lr[rt.FieldAggregationType.Year]=Xe.FieldAggregationType.Year,lr)),t.fieldRoleType=new pi.EnumConverter((Wf={},Wf[rt.FieldRoleType.Dimension]=Xe.FieldRoleType.Dimension,Wf[rt.FieldRoleType.Measure]=Xe.FieldRoleType.Measure,Wf[rt.FieldRoleType.Unknown]=Xe.FieldRoleType.Unknown,Wf)),t.sheetType=new pi.EnumConverter((Gf={},Gf[rt.SheetType.Dashboard]=Xe.SheetType.Dashboard,Gf[rt.SheetType.Story]=Xe.SheetType.Story,Gf[rt.SheetType.Worksheet]=Xe.SheetType.Worksheet,Gf)),t.dashboardObjectType=new pi.EnumConverter((Mo={},Mo[rt.DashboardObjectType.Extension]=Xe.DashboardObjectType.Extension,Mo[rt.DashboardObjectType.Blank]=Xe.DashboardObjectType.Blank,Mo[rt.DashboardObjectType.Image]=Xe.DashboardObjectType.Image,Mo[rt.DashboardObjectType.Legend]=Xe.DashboardObjectType.Legend,Mo[rt.DashboardObjectType.PageFilter]=Xe.DashboardObjectType.PageFilter,Mo[rt.DashboardObjectType.ParameterControl]=Xe.DashboardObjectType.ParameterControl,Mo[rt.DashboardObjectType.QuickFilter]=Xe.DashboardObjectType.QuickFilter,Mo[rt.DashboardObjectType.Text]=Xe.DashboardObjectType.Text,Mo[rt.DashboardObjectType.Title]=Xe.DashboardObjectType.Title,Mo[rt.DashboardObjectType.WebPage]=Xe.DashboardObjectType.WebPage,Mo[rt.DashboardObjectType.Worksheet]=Xe.DashboardObjectType.Worksheet,Mo)),t.dataType=new pi.EnumConverter((Xs={},Xs[rt.DataType.Bool]=Xe.DataType.Bool,Xs[rt.DataType.Date]=Xe.DataType.Date,Xs[rt.DataType.DateTime]=Xe.DataType.DateTime,Xs[rt.DataType.Float]=Xe.DataType.Float,Xs[rt.DataType.Int]=Xe.DataType.Int,Xs[rt.DataType.Spatial]=Xe.DataType.Spatial,Xs[rt.DataType.String]=Xe.DataType.String,Xs)),t.filterUpdateType=new pi.EnumConverter((Wh={},Wh[rt.FilterUpdateType.Add]=Xe.FilterUpdateType.Add,Wh[rt.FilterUpdateType.All]=Xe.FilterUpdateType.All,Wh[rt.FilterUpdateType.Remove]=Xe.FilterUpdateType.Remove,Wh[rt.FilterUpdateType.Replace]=Xe.FilterUpdateType.Replace,Wh)),t.allowableValues=new pi.EnumConverter((Hf={},Hf[rt.DomainRestrictionType.All]=Xe.ParameterValueType.All,Hf[rt.DomainRestrictionType.List]=Xe.ParameterValueType.List,Hf[rt.DomainRestrictionType.Range]=Xe.ParameterValueType.Range,Hf)),t.dateStepPeriod=new pi.EnumConverter((ys={},ys[rt.DateStepPeriod.Years]=Xe.PeriodType.Years,ys[rt.DateStepPeriod.Quarters]=Xe.PeriodType.Quarters,ys[rt.DateStepPeriod.Months]=Xe.PeriodType.Months,ys[rt.DateStepPeriod.Weeks]=Xe.PeriodType.Weeks,ys[rt.DateStepPeriod.Days]=Xe.PeriodType.Days,ys[rt.DateStepPeriod.Hours]=Xe.PeriodType.Hours,ys[rt.DateStepPeriod.Minutes]=Xe.PeriodType.Minutes,ys[rt.DateStepPeriod.Seconds]=Xe.PeriodType.Seconds,ys)),t.dateRangeType=new pi.EnumConverter((Kl={},Kl[rt.DateRangeType.Current]=Xe.DateRangeType.Current,Kl[rt.DateRangeType.Last]=Xe.DateRangeType.Last,Kl[rt.DateRangeType.LastN]=Xe.DateRangeType.LastN,Kl[rt.DateRangeType.Next]=Xe.DateRangeType.Next,Kl[rt.DateRangeType.NextN]=Xe.DateRangeType.NextN,Kl[rt.DateRangeType.ToDate]=Xe.DateRangeType.ToDate,Kl)),t.errorCode=new pi.EnumConverter((Na={},Na[rt.ErrorCodes.INITIALIZATION_ERROR]=Xe.ErrorCodes.InternalError,Na[rt.ErrorCodes.INTERNAL_ERROR]=Xe.ErrorCodes.InternalError,Na[rt.ErrorCodes.MISSING_ENUM_MAPPING]=Xe.ErrorCodes.InternalError,Na[rt.ErrorCodes.MISSING_PARAMETER]=Xe.ErrorCodes.InternalError,Na[rt.ErrorCodes.PERMISSION_DENIED]=Xe.ErrorCodes.InternalError,Na[rt.ErrorCodes.PRES_MODEL_PARSING_ERROR]=Xe.ErrorCodes.InternalError,Na[rt.ErrorCodes.UNKNOWN_VERB_ID]=Xe.ErrorCodes.InternalError,Na[rt.ErrorCodes.VERSION_NOT_CONFIGURED]=Xe.ErrorCodes.APINotInitialized,Na[rt.ErrorCodes.VISIBILITY_ERROR]=Xe.ErrorCodes.VisibilityError,Na),Xe.ErrorCodes.InternalError),t.filterType=new pi.EnumConverter((Gh={},Gh[rt.FilterType.Categorical]=Xe.FilterType.Categorical,Gh[rt.FilterType.Range]=Xe.FilterType.Range,Gh[rt.FilterType.RelativeDate]=Xe.FilterType.RelativeDate,Gh[rt.FilterType.Hierarchical]=Xe.FilterType.Hierarchical,Gh)),t.classNameKey=new pi.EnumConverter((ia={},ia["tableau-dashboard-title"]=Xe.ClassNameKey.DashboardTitle,ia["tableau-story-title"]=Xe.ClassNameKey.StoryTitle,ia["tableau-tooltip"]=Xe.ClassNameKey.Tooltip,ia["tableau-worksheet"]=Xe.ClassNameKey.Worksheet,ia["tableau-worksheet-title"]=Xe.ClassNameKey.WorksheetTitle,ia["dashboard-title"]=Xe.ClassNameKey.DashboardTitle,ia["story-title"]=Xe.ClassNameKey.StoryTitle,ia.tooltip=Xe.ClassNameKey.Tooltip,ia.worksheet=Xe.ClassNameKey.Worksheet,ia["worksheet-title"]=Xe.ClassNameKey.WorksheetTitle,ia)),t.hierarchicalLevelSelectionState=new pi.EnumConverter((Hh={},Hh[rt.HierarchicalLevelSelectionState.AllSelected]=Xe.HierarchicalLevelSelectionState.AllSelected,Hh[rt.HierarchicalLevelSelectionState.NoneSelected]=Xe.HierarchicalLevelSelectionState.NoneSelected,Hh[rt.HierarchicalLevelSelectionState.SomeSelected]=Xe.HierarchicalLevelSelectionState.SomeSelected,Hh[rt.HierarchicalLevelSelectionState.UnknownSelected]=Xe.HierarchicalLevelSelectionState.UnknownSelected,Hh)),t.annotationType=new pi.EnumConverter((qf={},qf[rt.AnnotateEnum.Area]=Xe.AnnotationType.Area,qf[rt.AnnotateEnum.Mark]=Xe.AnnotationType.Mark,qf[rt.AnnotateEnum.Point]=Xe.AnnotationType.Point,qf)),t.markType=new pi.EnumConverter((Xi={},Xi[rt.MarkType.Area]=Xe.MarkType.Area,Xi[rt.MarkType.Bar]=Xe.MarkType.Bar,Xi[rt.MarkType.Circle]=Xe.MarkType.Circle,Xi[rt.MarkType.GanttBar]=Xe.MarkType.GanttBar,Xi[rt.MarkType.Heatmap]=Xe.MarkType.Heatmap,Xi[rt.MarkType.Line]=Xe.MarkType.Line,Xi[rt.MarkType.Map]=Xe.MarkType.Map,Xi[rt.MarkType.Pie]=Xe.MarkType.Pie,Xi[rt.MarkType.Polygon]=Xe.MarkType.Polygon,Xi[rt.MarkType.Shape]=Xe.MarkType.Shape,Xi[rt.MarkType.Square]=Xe.MarkType.Square,Xi[rt.MarkType.Text]=Xe.MarkType.Text,Xi[rt.MarkType.VizExtension]=Xe.MarkType.VizExtension,Xi)),t}();fl.InternalToExternalEnumMappings=rZ;var zT={};Object.defineProperty(zT,"__esModule",{value:!0});var eD=Nt,tD=Mn,nZ=function(){function t(){this._eventListenerManagers={}}return t.prototype.addEventListener=function(e,n){if(!this._eventListenerManagers.hasOwnProperty(e))throw new tD.TableauError(eD.ErrorCodes.UnsupportedEventName,"Cannot add event, unsupported event type: "+e);return this._eventListenerManagers[e].addEventListener(n)},t.prototype.removeEventListener=function(e,n){if(!this._eventListenerManagers.hasOwnProperty(e))throw new tD.TableauError(eD.ErrorCodes.UnsupportedEventName,"Cannot remove event, unsupported event type: "+e);return this._eventListenerManagers[e].removeEventListener(n)},t.prototype.addNewEventType=function(e){this._eventListenerManagers[e.eventType]=e},t}();zT.EventListenerManager=nZ;var Wm={};Object.defineProperty(Wm,"__esModule",{value:!0});var iZ=function(){function t(e){this._fieldImpl=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._fieldImpl.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._fieldImpl.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this._fieldImpl.description},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataType",{get:function(){return this._fieldImpl.dataType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aggregation",{get:function(){return this._fieldImpl.aggregation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataSource",{get:function(){return this._fieldImpl.dataSource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"role",{get:function(){return this._fieldImpl.role},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnType",{get:function(){return this._fieldImpl.columnType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCalculatedField",{get:function(){return this._fieldImpl.isCalculatedField},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCombinedField",{get:function(){return this._fieldImpl.isCombinedField},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGenerated",{get:function(){return this._fieldImpl.isGenerated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGeospatial",{get:function(){return this._fieldImpl.isGeospatial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHidden",{get:function(){return this._fieldImpl.isHidden},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPresentOnPublishedDatasource",{get:function(){return this._fieldImpl.isPresentOnPublishedDatasource},enumerable:!0,configurable:!0}),t}();Wm.Field=iZ;var oy={},rD;function bO(){if(rD)return oy;rD=1,Object.defineProperty(oy,"__esModule",{value:!0});var t=sn(),e=function(){function n(a,u){this._registryId=u,this._luid=a.luid,this._name=a.name,this._shared=a.shared,this._isDefault=a.isDefault,this._ownerName=a.owner.userFriendlyName,this._url=a.url}return Object.defineProperty(n.prototype,"luid",{get:function(){return this._luid},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},set:function(a){this._name=a},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"shared",{get:function(){return this._shared},set:function(a){this._shared=a},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isDefault",{get:function(){return this._isDefault},set:function(a){this._isDefault=a},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ownerName",{get:function(){return this._ownerName},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),n.prototype.saveAsync=function(){var a=t.ApiServiceRegistry.get(this._registryId).getService("viz-service");return a.saveAsync(this)},n}();return oy.CustomViewImpl=e,oy}var xv={},bv={};Object.defineProperty(bv,"__esModule",{value:!0});var oZ=function(){function t(e,n){this._x=e,this._y=n}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t}();bv.Point=oZ;var pa={};Object.defineProperty(pa,"__esModule",{value:!0});var wO=Nt,EO=Mn;window.__tableauApiServiceRegistry=window.__tableauApiServiceRegistry||{};var aZ=function(){function t(){this._services={}}return t.prototype.registerService=function(e){this._services[e.serviceName]=e},t.prototype.getService=function(e){if(!this._services.hasOwnProperty(e))throw new EO.TableauError(wO.ErrorCodes.InternalError,"Service not registered: "+e);return this._services[e]},t}(),sZ=function(){function t(){}return t.get=function(e){if((!window.__tableauApiServiceRegistry||!window.__tableauApiServiceRegistry[e])&&t.setInstance(e,new aZ),!window.__tableauApiServiceRegistry[e])throw new EO.TableauError(wO.ErrorCodes.InternalError,"Service registry failed");return window.__tableauApiServiceRegistry[e]},t.setInstance=function(e,n){window.__tableauApiServiceRegistry||(window.__tableauApiServiceRegistry={}),window.__tableauApiServiceRegistry[e]=n},t.clearRegistry=function(){window.__tableauApiServiceRegistry={}},t}();pa.ApiServiceRegistry=sZ;var ay={},sy={},nD;function $d(){if(nD)return sy;nD=1,Object.defineProperty(sy,"__esModule",{value:!0});var t=Nt,e=Mn,n=$o(),a=function(){function u(){}return u.serializeDateForPlatform=function(d){var _=d.getUTCFullYear(),l=d.getUTCMonth()+1,w=d.getUTCDate(),T=d.getUTCHours(),C=d.getUTCMinutes(),P=d.getUTCSeconds();return _+"-"+l+"-"+w+" "+T+":"+C+":"+P},u.serializeBooleanForPlatform=function(d){return d?"true":"false"},u.serializeNumberForPlatform=function(d){return d.toString(10)},u.isTypeNumber=function(d){return typeof d=="number"||d instanceof Number},u.isTypeDate=function(d){return d instanceof Date},u.isTypeString=function(d){return typeof d=="string"||d instanceof String},u.isTypeBool=function(d){return typeof d=="boolean"||d instanceof Boolean},u.isNullOrUndefined=function(d){return d==null},u.serializeParameterValue=function(d){if(u.isTypeNumber(d))return u.serializeNumberForPlatform(d);if(u.isTypeDate(d))return u.serializeDateForPlatform(d);if(u.isTypeBool(d))return u.serializeBooleanForPlatform(d);if(u.isTypeString(d))return d;throw new e.TableauError(t.ErrorCodes.InternalError,"Unexpected invalid value for: "+d)},u.convertParameterToMap=function(d,_){if(n.ErrorHelpers.verifyParameterType(d,"object",_),Array.isArray(d))throw new e.TableauError(t.ErrorCodes.InvalidParameter,"Expecting object or Map for: "+_+".");return d instanceof Map?d:new Map(Object.entries(d))},u.tryParseNumber=function(d){if(u.isNullOrUndefined(d))return{success:!1};if(u.isTypeNumber(d))return{parsed:d,success:!0};var _=d.toString();if(_==="NaN")return{parsed:NaN,success:!0};var l=parseFloat(_);return isNaN(l)?{success:!1}:{parsed:l,success:!0}},u}();return sy.Param=a,sy}var iD;function $o(){if(iD)return ay;iD=1,Object.defineProperty(ay,"__esModule",{value:!0});var t=Nt,e=Mn,n=$d(),a=function(){function u(){}return u.apiNotImplemented=function(d){return new e.TableauError(t.SharedErrorCodes.InternalError,d+" API not yet implemented.")},u.verifyInternalValue=function(d,_){if(d==null)throw new e.TableauError(t.SharedErrorCodes.InternalError,d+" is invalid value for: "+_)},u.verifyParameter=function(d,_){if(d==null)throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,d+" is invalid value for parameter: "+_)},u.verifyParameterType=function(d,_,l){if(typeof d!==_)throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,d+" has invalid type for parameter: "+l+".")},u.verifyStringParameter=function(d,_){if(d==null||d==="")throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,d+" is invalid value for paramter: "+_)},u.verifyEnumValue=function(d,_,l){var w=!1;if(Object.keys(_).forEach(function(T){_[T]===d.toString()&&(w=!0)}),!w)throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,d+" is invalid value for enum: "+l+".")},u.verifyRange=function(d,_,l){var w=_<=d&&d<l;if(!w)throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,d+" is invalid value for range: ["+_+".."+l+")")},u.verifyRangeParamType=function(d,_){if(!d&&!_)throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,"Unexpected invalid param value, at least one of min or max is required.");if(d&&!n.Param.isTypeNumber(d)&&!n.Param.isTypeDate(d))throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,"Unexpected invalid param value, only Date and number are allowed for parameter min.");if(_&&!n.Param.isTypeNumber(_)&&!n.Param.isTypeDate(_))throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,"Unexpected invalid param value, only Date and number are allowed for parameter max.");if(d&&_&&typeof d!=typeof _)throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,"Unexpected invalid param value, parameters min and max should be of the same type.")},u.verifyZoneIsValid=function(d,_){if(!d.has(_))throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,"Unexpected invalid param value, Dashboard Object Id: "+_+" is not present in dashboard.")},u.verifyZoneIsValidAndFloating=function(d,_){if(!(d.has(_)&&d.get(_).isFloating))throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,"Unexpected invalid param value, Dashboard Object Id: "+_+" is not present or is a fixed zone in the dashboard.")},u.verifyWidthAndHeightOfDashboardObjectPositionAndSizeUpdate=function(d){if(d.width<0||d.height<0)throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,"Unexpected invalid param value for dashboard object ID "+d.dashboardObjectID+": negative widths and heights are not allowed.")},u.verifySheetName=function(d,_){if(!d.includes(_))throw new e.TableauError(t.SharedErrorCodes.InvalidSelectionSheet,"sheetName parameter must belong to a worksheet within the current view")},u.verifyExportDataOptions=function(d){if(!n.Param.isNullOrUndefined(d.ignoreAliases)&&!n.Param.isTypeBool(d.ignoreAliases)||!n.Param.isNullOrUndefined(d.columnsToIncludeById)&&!Array.isArray(d.columnsToIncludeById))throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,"options paramater must be of type ExportDataOptions")},u.verifySheetNamesForPDFAndPPT=function(d,_){if(!Array.isArray(d))throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,"sheetNames parameter must be an array");if(d.length===0)throw new e.TableauError(t.SharedErrorCodes.InternalError,"sheetNames should not be empty");var l=d.every(function(C){return _.exportableSheetNamesFromDashboard.includes(C)});if(!l){var w=d.every(function(C){return _.exportableSheetNamesFromWorkbook.includes(C)});if(!w){var T=d.length===1&&d[0]===_.currentSheetName;if(!T)throw new e.TableauError(t.SharedErrorCodes.InvalidSelectionSheet,"sheetNames parameter must have all its entries be exportable sheet names from the dashboard or all its entries be exportable sheet names from the workbook")}}},u.verifyExportPDFOptions=function(d){try{this.verifyEnumValue(d.orientation,t.PrintOrientation,"PrintOrientation"),this.verifyEnumValue(d.pageSize,t.PrintPageSize,"PrintPageSize"),this.verifyEnumValue(d.scaling,t.PrintScaling,"PrintScaling")}catch{throw new e.TableauError(t.SharedErrorCodes.InvalidParameter,"options parameter must be of type ExportPDFOptions")}},u}();return ay.ErrorHelpers=a,ay}var wv={};Object.defineProperty(wv,"__esModule",{value:!0});var lZ=function(){function t(e,n,a,u,d,_,l,w,T,C){this._dashboardImpl=e,this._type=n,this._position=a,this._size=u,this._worksheetImpl=d,this._name=_,this._isFloating=l,this._isVisible=w,this._id=T,this._fieldId=C}return Object.defineProperty(t.prototype,"dashboardImpl",{get:function(){return this._dashboardImpl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"worksheetImpl",{get:function(){return this._worksheetImpl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFloating",{get:function(){return this._isFloating},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisible",{get:function(){return this._isVisible},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldId",{get:function(){return this._fieldId},enumerable:!0,configurable:!0}),t}();wv.DashboardObjectImpl=lZ;var Wd={},Gm={};Object.defineProperty(Gm,"__esModule",{value:!0});var _s=Nt,zb=hr(),cZ=Mn,uZ=function(){function t(){}return t.getSheetSizeFromSizeConstraints=function(e){var n=e.minWidth,a=e.minHeight,u=e.maxWidth,d=e.maxHeight;if(a===0&&n===0)return d===0&&u===0?{behavior:_s.SheetSizeBehavior.Automatic}:{behavior:_s.SheetSizeBehavior.AtMost,maxSize:{width:u,height:d}};if(d===0&&u===0)return{behavior:_s.SheetSizeBehavior.AtLeast,minSize:{width:n,height:a}};if(d===a&&u===n&&n>0)return{behavior:_s.SheetSizeBehavior.Exactly,minSize:{width:n,height:a},maxSize:{width:n,height:a}};var _=n===0&&u===0;return{behavior:_s.SheetSizeBehavior.Range,minSize:{width:n,height:a},maxSize:{width:_?2147483647:u,height:d}}},t.createAutomaticSize=function(){var e=_s.SheetSizeBehavior.Automatic,n={width:0,height:0},a={width:0,height:0};return{behavior:e,minSize:n,maxSize:a}},t.getPublishedSheetInfoByName=function(e,n){var a=n.find(function(u){return u.name===e});return a},t.getSheetTypeEnum=function(e){var n;switch(e){case zb.SheetType.Worksheet:{n=_s.SheetType.Worksheet;break}case zb.SheetType.Dashboard:{n=_s.SheetType.Dashboard;break}case zb.SheetType.Story:{n=_s.SheetType.Story;break}default:throw new cZ.TableauError(_s.SharedErrorCodes.ServerError,"Invalid SheetType")}return n},t.isValidSheetSize=function(e){return e.behavior!==void 0},t}();Gm.SheetUtils=uZ;Object.defineProperty(Wd,"__esModule",{value:!0});var un=Nt,ly=pa,xi=Mn,oD=$o(),qh=$d(),aD=Gm,hZ=function(){function t(e,n){this._sheetInfoImpl=e,this._registryId=n}return Object.defineProperty(t.prototype,"name",{get:function(){return this._sheetInfoImpl.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sheetType",{get:function(){return this._sheetInfoImpl.sheetType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sheetPath",{get:function(){return this._sheetInfoImpl.sheetPath},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._sheetInfoImpl.sheetSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hidden",{get:function(){if(this._sheetInfoImpl.isHidden!==void 0)return this._sheetInfoImpl.isHidden;throw new xi.TableauError(un.EmbeddingErrorCodes.ImplementationError,"isHidden not implemented")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){if(this._sheetInfoImpl.isActive!==void 0)return this._sheetInfoImpl.isActive;throw new xi.TableauError(un.EmbeddingErrorCodes.ImplementationError,"active not implemented")},set:function(e){this._sheetInfoImpl.isActive!==void 0&&(this._sheetInfoImpl.active=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){if(this._sheetInfoImpl.index!==void 0)return this._sheetInfoImpl.index;throw new xi.TableauError(un.EmbeddingErrorCodes.ImplementationError,"index not implemented")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){if(this._sheetInfoImpl.url!==void 0)return this._sheetInfoImpl.url;throw new xi.TableauError(un.EmbeddingErrorCodes.ImplementationError,"url not implemented")},enumerable:!0,configurable:!0}),t.prototype.getSheetSize=function(){if(!aD.SheetUtils.isValidSheetSize(this.size))throw new xi.TableauError(un.EmbeddingErrorCodes.InternalError,"size is not of type SheetSize");return this.size},t.prototype.findParameterAsync=function(e){oD.ErrorHelpers.verifyParameter(e,"parameterName");var n=ly.ApiServiceRegistry.get(this._registryId).getService("parameters-service");return n.findParameterByNameAsync(e)},t.prototype.getParametersAsync=function(){var e=ly.ApiServiceRegistry.get(this._registryId).getService("parameters-service");return e.getParametersForSheetAsync(this.sheetPath)},t.prototype.changeSizeAsync=function(e){var n=this,a=new xi.TableauError(un.EmbeddingErrorCodes.InvalidSize,"Invalid sheet size parameter");if(!e||!e.behavior)throw a;var u=this.normalizeSheetSize(e),d=u.behavior===un.SheetSizeBehavior.Automatic;if(!d&&!u.minSize&&!u.maxSize)throw a;if(!d&&this.sheetType===un.SheetType.Worksheet)throw new xi.TableauError(un.EmbeddingErrorCodes.InvalidSizeBehaviorOnWorksheet,"Only SheetSizeBehavior.Automatic is allowed on Worksheets");if(d&&this.getSheetSize().behavior===u.behavior)return Promise.resolve(e);var _=this.processNewSize(u),l=ly.ApiServiceRegistry.get(this._registryId).getService("size-service");return l.changeSizeAsync(this.name,_).then(function(){var w=ly.ApiServiceRegistry.get(n._registryId).getService("client-info-service");return w.getClientInfoAsync().then(function(T){var C=T.publishedSheets.find(function(z){return z.name===n.name});if(!C)throw new xi.TableauError(un.SharedErrorCodes.InternalError,"Can't find sheet with name "+n.name);var P=aD.SheetUtils.getSheetSizeFromSizeConstraints(C.sizeConstraint);return n._sheetInfoImpl.sheetSize=P,P})})},t.prototype.normalizeSheetSize=function(e){var n=e.behavior;oD.ErrorHelpers.verifyEnumValue(n,un.SheetSizeBehavior,"SheetSizeBehavior");var a=t.parseDimensions(e.minSize),u=t.parseDimensions(e.maxSize);return{behavior:n,minSize:a,maxSize:u}},t.prototype.processNewSize=function(e){var n,a,u,d,_=e.behavior,l=e.minSize,w=e.maxSize,T=!qh.Param.isNullOrUndefined((n=l)===null||n===void 0?void 0:n.width),C=!qh.Param.isNullOrUndefined((a=l)===null||a===void 0?void 0:a.height),P=!qh.Param.isNullOrUndefined((u=w)===null||u===void 0?void 0:u.width),z=!qh.Param.isNullOrUndefined((d=w)===null||d===void 0?void 0:d.height),$=T&&C,U=P&&z;switch(_){case un.SheetSizeBehavior.Automatic:return{behavior:_};case un.SheetSizeBehavior.AtMost:{if(!w||!U)throw new xi.TableauError(un.EmbeddingErrorCodes.MissingMaxSize,"Missing maxSize for SheetSizeBehavior.AtMost");var W={width:w.width,height:w.height};if(W.width<0||W.height<0)throw new xi.TableauError(un.EmbeddingErrorCodes.InvalidSize,"Size value cannot be less than zero");return{behavior:_,maxSize:W}}case un.SheetSizeBehavior.AtLeast:{if(!l||!$)throw new xi.TableauError(un.EmbeddingErrorCodes.MissingMinSize,"Missing minSize for SheetSizeBehavior.AtLeast");var N={width:l.width,height:l.height};if(N.width<0||N.height<0)throw new xi.TableauError(un.EmbeddingErrorCodes.InvalidSize,"Size value cannot be less than zero");return{behavior:_,minSize:N}}case un.SheetSizeBehavior.Range:{if(!l||!w||!$||!U)throw new xi.TableauError(un.EmbeddingErrorCodes.MissingMinMaxSize,"Missing minSize or maxSize for SheetSizeBehavior.Range");var N={width:l.width,height:l.height},W={width:w.width,height:w.height};if(N.width<0||N.height<0||W.width<0||W.height<0||N.width>W.width||N.height>W.height)throw new xi.TableauError(un.EmbeddingErrorCodes.InvalidSize,"Missing minSize or maxSize for SheetSizeBehavior.Range");return{behavior:_,minSize:N,maxSize:W}}case un.SheetSizeBehavior.Exactly:{if(l&&w){if($&&U){var N={width:l.width,height:l.height},W={width:w.width,height:w.height};if(N.width!==W.width||N.height!==W.height)throw new xi.TableauError(un.EmbeddingErrorCodes.InvalidSize,"Conflicting size values for SheetSizeBehavior.Exactly");return{behavior:_,minSize:N,maxSize:W}}if($){var N={width:l.width,height:l.height};return{behavior:_,minSize:N,maxSize:N}}if(U){var W={width:w.width,height:w.height};return{behavior:_,minSize:W,maxSize:W}}}throw new xi.TableauError(un.EmbeddingErrorCodes.InvalidSize,"Invalid sheet size parameter")}default:throw new xi.TableauError(un.SharedErrorCodes.InternalError,"Unsupported sheet size behavior: "+_)}},t.parseDimensions=function(e){var n={width:void 0,height:void 0};if(!e)return n;var a=qh.Param.tryParseNumber(e.width),u=a.success,d=a.parsed,_=qh.Param.tryParseNumber(e.height),l=_.success,w=_.parsed;return u&&l?{width:d,height:w}:u?{width:d}:l?{height:w}:n},t}();Wd.SheetImpl=hZ;var Hm={};Object.defineProperty(Hm,"__esModule",{value:!0});var dZ=Nt,pZ=function(){function t(e,n,a,u,d,_,l){this._name=e,this._sheetType=n,this._sheetSize=a,this._index=u,this._isActive=d,this._isHidden=_,this._url=l}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sheetSize",{get:function(){return this._sheetSize},set:function(e){this._sheetSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sheetType",{get:function(){return this._sheetType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sheetPath",{get:function(){return{sheetName:this.name,isDashboard:this.sheetType===dZ.SheetType.Dashboard}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"active",{set:function(e){this._isActive=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHidden",{get:function(){return this._isHidden},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),t}();Hm.SheetInfoImpl=pZ;var qm={},Ev={};Object.defineProperty(Ev,"__esModule",{value:!0});var fZ=function(){function t(e){this._logicalTable=e}return Object.defineProperty(t.prototype,"id",{get:function(){return this._logicalTable.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"caption",{get:function(){return this._logicalTable.caption},enumerable:!0,configurable:!0}),t}();Ev.LogicalTable=fZ;var RT={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Summary="summary",e.Underlying="underlying"}(t.GetDataType||(t.GetDataType={}))})(RT);var Zm={},OT={};Object.defineProperty(OT,"__esModule",{value:!0});var mZ=function(){function t(e){this._connectionInfo=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._connectionInfo.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._connectionInfo.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverURI",{get:function(){return this._connectionInfo.serverURI},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._connectionInfo.type},enumerable:!0,configurable:!0}),t}();OT.ConnectionSummary=mZ;var FT={};Object.defineProperty(FT,"__esModule",{value:!0});var gZ=function(){function t(e){this._tableInfo=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._tableInfo.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._tableInfo.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"connectionId",{get:function(){return this._tableInfo.connectionId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"customSQL",{get:function(){return this._tableInfo.customSQL},enumerable:!0,configurable:!0}),t}();FT.TableSummary=gZ;var Sv={};Object.defineProperty(Sv,"__esModule",{value:!0});var yZ=Nt,_Z=hr(),Rb=fl,vZ=function(){function t(e,n){this._fieldInfo=e,this._parentDataSource=n}return Object.defineProperty(t.prototype,"name",{get:function(){return this._fieldInfo.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._fieldInfo.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this._fieldInfo.description},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataType",{get:function(){var e;return e=this._fieldInfo.dataType,e??yZ.DataType.Unknown},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aggregation",{get:function(){return Rb.InternalToExternalEnumMappings.fieldAggregationType.convert(this._fieldInfo.aggregation)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataSource",{get:function(){if(!this._parentDataSource)throw new Error("Data source information is not available for this field. Please use getFieldAsync method to get field's data source information");return this._parentDataSource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"role",{get:function(){return Rb.InternalToExternalEnumMappings.fieldRoleType.convert(this._fieldInfo.role)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnType",{get:function(){var e=this._fieldInfo.columnType||_Z.ColumnType.Unknown;return Rb.InternalToExternalEnumMappings.columnType.convert(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCalculatedField",{get:function(){return this._fieldInfo.isCalculatedField},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCombinedField",{get:function(){return this._fieldInfo.isCombinedField},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGenerated",{get:function(){return this._fieldInfo.isGenerated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGeospatial",{get:function(){return this._fieldInfo.isGeospatial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHidden",{get:function(){return this._fieldInfo.isHidden},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPresentOnPublishedDatasource",{get:function(){return this._fieldInfo.isPresentOnPublishedDatasource},enumerable:!0,configurable:!0}),t}();Sv.FieldImpl=vZ;Object.defineProperty(Zm,"__esModule",{value:!0});var Ob=Nt,xZ=OT,sD=Wm,bZ=Ev,gu=pa,wZ=FT,EZ=$o(),lD=Sv,SZ=function(){function t(e,n){var a=this;this._dataSourceInfo=e,this._registryId=n,this._fields=e.fields.map(function(u){var d=new lD.FieldImpl(u,a);return new sD.Field(d)})}return Object.defineProperty(t.prototype,"name",{get:function(){return this._dataSourceInfo.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._dataSourceInfo.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extractUpdateTime",{get:function(){return this._dataSourceInfo.extractUpdateTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this._fields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExtract",{get:function(){return this._dataSourceInfo.isExtract},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPublished",{get:function(){return this._dataSourceInfo.isPublished},enumerable:!0,configurable:!0}),t.prototype.publishedUrl=function(){return this._dataSourceInfo.publishedUrl},t.prototype.getMaxPageRowLimit=function(){return 1e4},t.prototype.refreshAsync=function(){var e=gu.ApiServiceRegistry.get(this._registryId).getService("data-source-service");return e.refreshAsync(this._dataSourceInfo.id)},t.prototype.getConnectionSummariesAsync=function(){var e=gu.ApiServiceRegistry.get(this._registryId).getService("data-source-service");return e.getConnectionSummariesAsync(this._dataSourceInfo.id).then(function(n){return n.map(function(a){return new xZ.ConnectionSummary(a)})})},t.prototype.getActiveTablesAsync=function(){var e=gu.ApiServiceRegistry.get(this._registryId).getService("data-source-service");return e.getActiveTablesAsync(this._dataSourceInfo.id).then(function(n){return n.map(function(a){return new wZ.TableSummary(a)})})},t.prototype.getUnderlyingDataAsync=function(e){var n=gu.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return e=e||{},n.getDataSourceDataAsync(this.id,!!e.ignoreAliases,e.maxRows||0,e.columnsToInclude||[],e.columnsToIncludeById||[],e.includeDataValuesOption||Ob.IncludeDataValuesOption.AllValues)},t.prototype.getLogicalTableDataAsync=function(e,n){var a=gu.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return n=n||{},a.getLogicalTableDataAsync(this.id,e,!!n.ignoreAliases,n.maxRows||0,n.columnsToInclude||[],n.columnsToIncludeById||[],n.includeDataValuesOption||Ob.IncludeDataValuesOption.AllValues)},t.prototype.getLogicalTableDataReaderAsync=function(e,n,a){var u=gu.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return a=a||{},u.getLogicalTableDataReaderAsync(this.id,e,n||this.getMaxPageRowLimit(),!!a.ignoreAliases,a.columnsToIncludeById||[],a.includeDataValuesOption||Ob.IncludeDataValuesOption.AllValues)},t.prototype.initializeWithPublicInterfaces=function(e){EZ.ErrorHelpers.verifyInternalValue(e,"dataSource"),this._fields=this._dataSourceInfo.fields.map(function(n){var a=new lD.FieldImpl(n,e);return new sD.Field(a)})},t.prototype.getLogicalTablesAsync=function(){var e=gu.ApiServiceRegistry.get(this._registryId).getService("data-source-service");return e.getLogicalTablesAsync(this.id).then(function(n){return n.map(function(a){return new bZ.LogicalTable(a)})})},t}();Zm.DataSourceImpl=SZ;var TZ=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(qm,"__esModule",{value:!0});var Zh=Nt,oa=Nt,AZ=$m,IZ=Ev,cD=RT,Gr=pa,Kh=Mn,ri=$o(),CZ=Zm,kZ=Wd,PZ=function(t){TZ(e,t);function e(n,a,u,d,_){var l=t.call(this,n,a)||this;return l._visualId=u,l._parentDashboardImpl=d,l._parentStoryPointImpl=_,l}return Object.defineProperty(e.prototype,"parentDashboard",{get:function(){return this._parentDashboardImpl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentStoryPoint",{get:function(){return this._parentStoryPointImpl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visualId",{get:function(){return this._visualId},enumerable:!0,configurable:!0}),e.prototype.getMaxPageRowLimit=function(){return 1e4},e.prototype.applyFilterAsync=function(n,a,u,d){ri.ErrorHelpers.verifyEnumValue(u,Zh.FilterUpdateType,"Contract.FilterUpdateType"),this.verifyActiveSheet();var _=Gr.ApiServiceRegistry.get(this._registryId).getService("filter-service");return _.applyFilterAsync(this.visualId,n,a,u,d)},e.prototype.applyRangeFilterAsync=function(n,a){ri.ErrorHelpers.verifyParameter(n,"fieldName"),ri.ErrorHelpers.verifyParameter(a,"filterOptions"),a.nullOption?ri.ErrorHelpers.verifyEnumValue(a.nullOption,oa.FilterNullOption,"FilterNullOption"):ri.ErrorHelpers.verifyRangeParamType(a.min,a.max),this.verifyActiveSheet();var u=Gr.ApiServiceRegistry.get(this._registryId).getService("filter-service");return u.applyRangeFilterAsync(this.visualId,n,a)},e.prototype.applyHierarchicalFilterAsync=function(n,a,u,d){if(ri.ErrorHelpers.verifyParameter(n,"fieldName"),ri.ErrorHelpers.verifyParameter(a,"values"),ri.ErrorHelpers.verifyEnumValue(u,Zh.FilterUpdateType,"Contract.FilterUpdateType"),!Array.isArray(a)&&!a.levels)throw new Kh.TableauError(oa.ErrorCodes.InvalidParameter,"values parameter for applyHierarchicalFilterAsync must be an array or contain a levels key");this.verifyActiveSheet();var _=Gr.ApiServiceRegistry.get(this._registryId).getService("filter-service");return _.applyHierarchicalFilterAsync(this.visualId,n,a,u,d)},e.prototype.clearFilterAsync=function(n){ri.ErrorHelpers.verifyParameter(n,"fieldName"),this.verifyActiveSheet();var a=Gr.ApiServiceRegistry.get(this._registryId).getService("filter-service");return a.clearFilterAsync(this.visualId,n)},e.prototype.applyRelativeDateFilterAsync=function(n,a){ri.ErrorHelpers.verifyStringParameter(n,"fieldName"),ri.ErrorHelpers.verifyParameter(a,"options"),ri.ErrorHelpers.verifyEnumValue(a.periodType,oa.PeriodType,"PeriodType"),ri.ErrorHelpers.verifyEnumValue(a.rangeType,oa.DateRangeType,"DateRangeType"),this.verifyActiveSheet();var u=Gr.ApiServiceRegistry.get(this._registryId).getService("filter-service");return u.applyRelativeDateFilterAsync(this.visualId,n,a)},e.prototype.getDataSourcesAsync=function(){var n=this;this.verifyActiveSheet();var a=Gr.ApiServiceRegistry.get(this._registryId).getService("data-source-service");return a.getDataSourcesAsync(this.visualId).then(function(u){var d=u,_=d.worksheetDataSchemaMap[n.name],l=[],w=_.primaryDataSource;l.push(n.createDataSourceFromInfo(d.dataSources[w]));for(var T=0,C=_.referencedDataSourceList;T<C.length;T++){var P=C[T];P!==w&&l.push(n.createDataSourceFromInfo(d.dataSources[P]))}return l})},e.prototype.getFiltersAsync=function(){this.verifyActiveSheet();var n=Gr.ApiServiceRegistry.get(this._registryId).getService("filter-service");return n.getFiltersAsync(this.visualId)},e.prototype.getSelectedMarksAsync=function(){this.verifyActiveSheet();var n=Gr.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return n.getSelectedMarksAsync(this.visualId)},e.prototype.getHighlightedMarksAsync=function(){this.verifyActiveSheet();var n=Gr.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return n.getHighlightedMarksAsync(this.visualId)},e.prototype.getSummaryDataAsync=function(n){this.verifyActiveSheet();var a=Gr.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return n=n||{},a.getUnderlyingDataAsync(this.visualId,cD.GetDataType.Summary,!!n.ignoreAliases,!!n.ignoreSelection,!0,n.columnsToIncludeById||[],n.maxRows||0,n.includeDataValuesOption||oa.IncludeDataValuesOption.AllValues)},e.prototype.getSummaryDataReaderAsync=function(n,a){this.verifyActiveSheet();var u=Gr.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return a=a||{},u.getSummaryDataReaderAsync(this.visualId,n||this.getMaxPageRowLimit(),!!a.ignoreAliases,!!a.ignoreSelection,!0,a.columnsToIncludeById||[],a.includeDataValuesOption||oa.IncludeDataValuesOption.AllValues)},e.prototype.getVisualSpecificationAsync=function(){this.verifyActiveSheet();var n=Gr.ApiServiceRegistry.get(this._registryId).getService("visual-model-service");return n.getVisualSpecificationAsync(this.visualId)},e.prototype.getSummaryColumnsInfoAsync=function(){this.verifyActiveSheet();var n=Gr.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return n.getSummaryColumnsInfoAsync(this.visualId)},e.prototype.getUnderlyingDataAsync=function(n){this.verifyActiveSheet();var a=Gr.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return n=n||{},a.getUnderlyingDataAsync(this.visualId,cD.GetDataType.Underlying,!!n.ignoreAliases,!!n.ignoreSelection,!!n.includeAllColumns,n.columnsToIncludeById||[],n.maxRows||0,n.includeDataValuesOption||oa.IncludeDataValuesOption.AllValues)},e.prototype.getUnderlyingTablesAsync=function(){this.verifyActiveSheet();var n=Gr.ApiServiceRegistry.get(this._registryId).getService("data-source-service");return n.getUnderlyingTablesAsync(this.visualId).then(function(a){return a.map(function(u){return new IZ.LogicalTable(u)})})},e.prototype.getUnderlyingTableDataAsync=function(n,a){this.verifyActiveSheet();var u=Gr.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return a=a||{},u.getUnderlyingTableDataAsync(this.visualId,n,!!a.ignoreAliases,!!a.ignoreSelection,!!a.includeAllColumns,a.columnsToIncludeById||[],a.maxRows||0,a.includeDataValuesOption||oa.IncludeDataValuesOption.AllValues)},e.prototype.getUnderlyingTableDataReaderAsync=function(n,a,u){this.verifyActiveSheet();var d=Gr.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return u=u||{},d.getUnderlyingTableDataReaderAsync(this.visualId,n,a||this.getMaxPageRowLimit(),!!u.ignoreAliases,!!u.ignoreSelection,!!u.includeAllColumns,u.columnsToIncludeById||[],u.includeDataValuesOption||oa.IncludeDataValuesOption.AllValues)},e.prototype.clearSelectedMarksAsync=function(){this.verifyActiveSheet();var n=Gr.ApiServiceRegistry.get(this._registryId).getService("selection-service");return n.clearSelectedMarksAsync(this.visualId)},e.prototype.selectMarksByValueAsync=function(n,a){ri.ErrorHelpers.verifyParameter(n,"fieldName"),ri.ErrorHelpers.verifyEnumValue(a,oa.SelectionUpdateType,"SelectionUpdateType"),this.verifyActiveSheet();var u=Gr.ApiServiceRegistry.get(this._registryId).getService("selection-service");return u.selectMarksByValueAsync(this.visualId,n,a)},e.prototype.selectMarksByIdAsync=function(n,a){ri.ErrorHelpers.verifyParameter(n,"fieldName"),ri.ErrorHelpers.verifyEnumValue(a,oa.SelectionUpdateType,"SelectionUpdateType"),this.verifyActiveSheet();var u=Gr.ApiServiceRegistry.get(this._registryId).getService("selection-service");return u.selectMarksByIdAsync(this.visualId,n,a)},e.prototype.annotateMarkAsync=function(n,a){ri.ErrorHelpers.verifyParameter(n,"mark"),this.verifyActiveSheet();var u=Gr.ApiServiceRegistry.get(this._registryId).getService("annotation-service");return u.annotateMarkAsync(this.visualId,n,a)},e.prototype.getAnnotationsAsync=function(){this.verifyActiveSheet();var n=Gr.ApiServiceRegistry.get(this._registryId).getService("annotation-service");return n.getAnnotationsAsync(this.visualId)},e.prototype.removeAnnotationAsync=function(n){ri.ErrorHelpers.verifyParameter(n,"annotation"),this.verifyActiveSheet();var a=Gr.ApiServiceRegistry.get(this._registryId).getService("annotation-service");return a.removeAnnotationAsync(this.visualId,n)},e.prototype.appendContextMenuAsync=function(n,a){this.verifyActiveSheet();var u=Gr.ApiServiceRegistry.get(this._registryId).getService("external-context-menu-service");return u.appendContextMenuAsync(this.visualId.worksheet,n,a)},e.prototype.removeContextMenuAsync=function(n,a){this.verifyActiveSheet();var u=Gr.ApiServiceRegistry.get(this._registryId).getService("external-context-menu-service");return u.removeContextMenuAsync(this.visualId.worksheet,n,a)},e.prototype.executeContextMenuAsync=function(n,a){this.verifyActiveSheet();var u=Gr.ApiServiceRegistry.get(this._registryId).getService("external-context-menu-service");return u.executeContextMenuAsync(this.visualId.worksheet,n,a)},e.prototype.renameContextMenuAsync=function(n,a,u){this.verifyActiveSheet();var d=Gr.ApiServiceRegistry.get(this._registryId).getService("external-context-menu-service");return d.renameContextMenuAsync(this.visualId.worksheet,n,a,u)},e.prototype.hoverTupleAsync=function(n,a,u){if(this.isInsideDashboardExtension())return Promise.reject(new Kh.TableauError(Zh.SharedErrorCodes.ImplementationError,"hoverTupleAsync is not supported in dashboard extensions"));var d=Gr.ApiServiceRegistry.get(this._registryId).getService("selection-service");return d.hoverTupleAsync(this.visualId,n,a,u)},e.prototype.selectTuplesAsync=function(n,a,u){if(this.isInsideDashboardExtension())return Promise.reject(new Kh.TableauError(Zh.SharedErrorCodes.ImplementationError,"selectTuplesAsync is not supported in dashboard extensions"));var d=Gr.ApiServiceRegistry.get(this._registryId).getService("selection-service");return d.selectTuplesAsync(this.visualId,n,a,u)},e.prototype.getTooltipTextAsync=function(n){if(this.isInsideDashboardExtension())return Promise.reject(new Kh.TableauError(Zh.SharedErrorCodes.ImplementationError,"getTooltipTextAsync is not supported in dashboard extensions"));var a=Gr.ApiServiceRegistry.get(this._registryId).getService("accessibility");return a.getTooltipTextAsync(this.visualId,n)},e.prototype.leaveMarkNavigationAsync=function(){if(this.isInsideDashboardExtension())return Promise.reject(new Kh.TableauError(Zh.SharedErrorCodes.ImplementationError,"leaveMarkNavigationAsync is not supported in dashboard extensions"));var n=Gr.ApiServiceRegistry.get(this._registryId).getService("accessibility");return n.leaveMarkNavigationAsync(this.visualId)},e.prototype.createDataSourceFromInfo=function(n){var a=new CZ.DataSourceImpl(n,this._registryId),u=new AZ.DataSource(a);return a.initializeWithPublicInterfaces(u),u},e.prototype.verifyActiveSheet=function(){var n=this.active,a=this.isInsideActiveDashboard(),u=this.isInsideActiveStoryPoint();if(!n&&!a&&!u)throw new Kh.TableauError(oa.SharedErrorCodes.NotActiveSheet,"Operation not allowed on non-active sheet")},e.prototype.isInsideActiveStoryPoint=function(){return this._parentStoryPointImpl&&this._parentStoryPointImpl.active},e.prototype.isInsideActiveDashboard=function(){return this._parentDashboardImpl&&this._parentDashboardImpl.active},e.prototype.isInsideDashboardExtension=function(){return this._parentDashboardImpl!==null},e}(kZ.SheetImpl);qm.WorksheetImpl=PZ;var DZ=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(xv,"__esModule",{value:!0});var MZ=Nt,zo=Nt,cy=hr(),zZ=fl,RZ=bv,Zf=pa,uD=Mn,hD=$o(),OZ=wv,FZ=Wd,LZ=Hm,BZ=qm,NZ=function(t){DZ(e,t);function e(n,a,u,d,_,l){l===void 0&&(l=0);var w=t.call(this,n,d)||this;return w._zones=a,w._sheetPath=u,w._parentStoryPointImpl=_,w._activeDashboardObjectId=l,w}return Object.defineProperty(e.prototype,"worksheetsImpl",{get:function(){return this._worksheetsImpl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objects",{get:function(){return this._objects},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentStoryPoint",{get:function(){return this._parentStoryPointImpl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeDashboardObjectId",{get:function(){return this._activeDashboardObjectId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeDashboardName",{get:function(){return this._sheetPath.sheetName},enumerable:!0,configurable:!0}),e.prototype.initializeWithPublicInterfaces=function(){this._worksheetsImpl=new Array,this._objects=new Array,this.zoneMap=new Map;for(var n=0,a=this._zones;n<a.length;n++){var u=a[n],d=void 0,_={width:u.width,height:u.height},l=!1;if(u.zoneType===cy.DashboardObjectType.Worksheet||u.zoneType===cy.DashboardObjectType.QuickFilter){var w="",T="",C=!1;u.sheetInfo?(w=u.sheetInfo.name,T=u.sheetInfo.url||"",C=T===""):w=u.name;var P=new LZ.SheetInfoImpl(w,zo.SheetType.Worksheet,_,this._worksheetsImpl.length,l,C,T),z={worksheet:w,dashboard:this._sheetInfoImpl.name,storyboard:this._sheetPath.storyboard,flipboardZoneID:this._sheetPath.flipboardZoneID,storyPointID:this._sheetPath.storyPointID};d=new BZ.WorksheetImpl(P,this._registryId,z,this,this._parentStoryPointImpl),u.zoneType===cy.DashboardObjectType.Worksheet&&this._worksheetsImpl.push(d)}var $=new RZ.Point(u.x,u.y),U=new OZ.DashboardObjectImpl(this,zZ.InternalToExternalEnumMappings.dashboardObjectType.convert(u.zoneType),$,_,d,u.name,u.isFloating!==void 0?u.isFloating:!1,u.isVisible!==void 0?u.isVisible:!0,u.zoneId,u.fieldId);this._objects.push(U),this.zoneMap.set(u.zoneId,U)}},e.prototype.setDashboardObjectVisibilityAsync=function(n){var a=Zf.ApiServiceRegistry.get(this._registryId).getService("zone-service");return a.setVisibilityAsync(this.name,this.zoneMap,n)},e.prototype.getDashboardObjectById=function(n){return this.zoneMap.get(n)},e.prototype.updateZones=function(n,a,u){var d=this;a===void 0&&(a=0),u===void 0&&(u="");var _=this._objects,l=this.zoneMap,w=this._activeDashboardObjectId,T=this._sheetPath.sheetName;this._zones=n,this._activeDashboardObjectId=a,this._sheetPath.sheetName=u,this._sheetInfoImpl.name=u,this.initializeWithPublicInterfaces();var C=this._objects,P=this.zoneMap,z=new Map;return _.forEach(function($){var U=$.id;if(!P.has(U)){d.addChange(U,z,zo.DashboardLayoutChange.Removed);return}var W=P.get(U);$.isFloating!==W.isFloating&&d.addChange(U,z,zo.DashboardLayoutChange.IsFloatingChanged),$.isVisible!==W.isVisible&&d.addChange(U,z,zo.DashboardLayoutChange.IsVisibleChanged),$.name!==W.name&&d.addChange(U,z,zo.DashboardLayoutChange.NameChanged),($.position.x!==W.position.x||$.position.y!==W.position.y)&&d.addChange(U,z,zo.DashboardLayoutChange.PositionChanged),($.size.width!==W.size.width||$.size.height!==W.size.height)&&d.addChange(U,z,zo.DashboardLayoutChange.SizeChanged)}),C.forEach(function($){l.has($.id)||d.addChange($.id,z,zo.DashboardLayoutChange.Added)}),w!==a&&(a!==0&&this.addChange(a,z,zo.DashboardLayoutChange.Selected),w!==0&&this.addChange(w,z,zo.DashboardLayoutChange.Deselected)),T!==u&&this.addChange(0,z,zo.DashboardLayoutChange.DashboardChanged),z},e.prototype.addChange=function(n,a,u){a.has(n)||a.set(n,[]),a.get(n).push(u)},e.prototype.moveAndResizeDashboardObjectsAsync=function(n){var a=Zf.ApiServiceRegistry.get(this._registryId).getService("zone-service");return a.moveAndResizeAsync(this.name,this.zoneMap,n)},e.prototype.replayAnimationAsync=function(n){var a=Zf.ApiServiceRegistry.get(this._registryId).getService("animation-service");return a.replayAsync(n)},e.prototype.getFiltersAsync=function(){this.verifyActiveSheetOrEmbeddedInActiveStoryPoint();var n=Zf.ApiServiceRegistry.get(this._registryId).getService("filter-service");return n.getDashboardFiltersAsync()},e.prototype.applyFilterAsync=function(n,a,u,d){if(hD.ErrorHelpers.verifyEnumValue(u,MZ.FilterUpdateType,"FilterUpdateType"),hD.ErrorHelpers.verifyStringParameter(n,"fieldName"),!Array.isArray(a))throw new uD.TableauError(zo.ErrorCodes.InvalidParameter,"values parameter for applyDashboardFilterAsync must be an array");this.verifyActiveSheetOrEmbeddedInActiveStoryPoint();var _=Zf.ApiServiceRegistry.get(this._registryId).getService("filter-service");return _.applyDashboardFilterAsync(n,a,u,d)},e.prototype.getWorksheetNamesFromZones=function(){for(var n=[],a=0,u=this._zones;a<u.length;a++){var d=u[a];if(d.zoneType===cy.DashboardObjectType.Worksheet){var _=d.sheetInfo?d.sheetInfo.name:d.name;n.push(_)}}return n},e.prototype.verifyActiveSheetOrEmbeddedInActiveStoryPoint=function(){var n=this.active,a=this.parentStoryPoint!=null&&this.parentStoryPoint.active;if(!n&&!a)throw new uD.TableauError(zo.SharedErrorCodes.NotActiveSheet,"Operation not allowed on non-active sheet")},e}(FZ.SheetImpl);xv.DashboardImpl=NZ;var Tv={},Km={},Nu={};Object.defineProperty(Nu,"__esModule",{value:!0});var UZ=function(){function t(e,n,a,u,d,_){this._data=e,this._columns=n,this._totalRowCount=a,this._isTotalRowCountLimited=u,this._isSummaryData=d,this._marksInfo=_,this._name=d?"Summary Data Table":"Underlying Data Table"}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this._columns},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"marksInfo",{get:function(){return this._marksInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalRowCount",{get:function(){return this._totalRowCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTotalRowCountLimited",{get:function(){return this._isTotalRowCountLimited},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSummaryData",{get:function(){return this._isSummaryData},enumerable:!0,configurable:!0}),t}();Nu.DataTable=UZ;var jZ=function(){function t(e,n,a){this._type=e,this._color=n,this._tupleId=a}return Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tupleId",{get:function(){return this._tupleId},enumerable:!0,configurable:!0}),t}();Nu.MarkInfo=jZ;var VZ=function(){function t(e,n,a,u,d){this._fieldName=e,this._fieldId=n,this._dataType=a,this._isReferenced=u,this._index=d}return Object.defineProperty(t.prototype,"fieldName",{get:function(){return this._fieldName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldId",{get:function(){return this._fieldId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataType",{get:function(){return this._dataType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReferenced",{get:function(){return this._isReferenced},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),t}();Nu.Column=VZ;var $Z=function(){function t(e,n,a){this._value=e,this._nativeValue=n,this._formattedValue=a}return Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nativeValue",{get:function(){return this._nativeValue},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formattedValue",{get:function(){return this._formattedValue},enumerable:!0,configurable:!0}),t}();Nu.DataValue=$Z;Object.defineProperty(Km,"__esModule",{value:!0});var dD=hr(),Fb=Nu,WZ=function(){function t(){}return t.MakeParameterDataValue=function(e,n){return new Fb.DataValue(e.value,dD.DataTypeConverter.convertStringValueToNativeValue(e.value,n),e.formattedValue)},t.MakeFilterDataValue=function(e){return new Fb.DataValue(e.value,e.value,e.formattedValue)},t.MakeTableDataValue=function(e,n){return new Fb.DataValue(e.value,e.value!==void 0?dD.DataTypeConverter.convertValueToNativeValue(e.value,n):void 0,e.formattedValue)},t}();Km.DataValueFactory=WZ;Object.defineProperty(Tv,"__esModule",{value:!0});var pD=Nt,Lb=fl,GZ=pa,uy=Km,HZ=$o(),qZ=$d(),ZZ=function(){function t(e,n){this._registryId=n,this.setParameterInfo(e)}return Object.defineProperty(t.prototype,"name",{get:function(){return this._parameterInfo.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentValue",{get:function(){return uy.DataValueFactory.MakeParameterDataValue(this._parameterInfo.currentValue,this._parameterInfo.dataType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataType",{get:function(){return Lb.InternalToExternalEnumMappings.dataType.convert(this._parameterInfo.dataType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._globalFieldName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowableValues",{get:function(){return this._allowableValues},enumerable:!0,configurable:!0}),t.prototype.changeValueAsync=function(e){var n=this;HZ.ErrorHelpers.verifyParameter(e,"newValue");var a=qZ.Param.serializeParameterValue(e),u=GZ.ApiServiceRegistry.get(this._registryId).getService("parameters-service");return u.changeParameterValueAsync(this._globalFieldName,a).then(function(d){return n.setParameterInfo(d),n.currentValue})},t.prototype.setParameterInfo=function(e){this._parameterInfo=e,this._globalFieldName=e.fieldName;var n=Lb.InternalToExternalEnumMappings.allowableValues.convert(e.allowableValuesType),a,u,d,_,l;if(n===pD.ParameterValueType.List){var w=e.allowableValues||[];a=w.map(function(T){return uy.DataValueFactory.MakeParameterDataValue(T,e.dataType)})}else n===pD.ParameterValueType.Range&&(u=e.minValue&&uy.DataValueFactory.MakeParameterDataValue(e.minValue,e.dataType),d=e.maxValue&&uy.DataValueFactory.MakeParameterDataValue(e.maxValue,e.dataType),_=e.stepSize,l=e.dateStepPeriod&&Lb.InternalToExternalEnumMappings.dateStepPeriod.convert(e.dateStepPeriod));this._allowableValues={type:n,allowableValues:a,minValue:u,maxValue:d,stepSize:_,dateStepPeriod:l}},t}();Tv.ParameterImpl=ZZ;var LT={};Object.defineProperty(LT,"__esModule",{value:!0});var KZ=function(){function t(e){this._eventType=e,this._handlers=[]}return Object.defineProperty(t.prototype,"eventType",{get:function(){return this._eventType},enumerable:!0,configurable:!0}),t.prototype.addEventListener=function(e){var n=this;return this._handlers.push(e),function(){return n.removeEventListener(e)}},t.prototype.removeEventListener=function(e){var n=this._handlers.length;return this._handlers=this._handlers.filter(function(a){return a!==e}),n>this._handlers.length},t.prototype.triggerEvent=function(e){for(var n=0,a=this._handlers;n<a.length;n++){var u=a[n];try{var d=e();u(d)}catch{continue}}},t}();LT.SingleEventManagerImpl=KZ;var BT={},NT={},Xm={};Object.defineProperty(Xm,"__esModule",{value:!0});var XZ=function(){function t(){var e=this;this._promise=new Promise(function(n,a){e._resolve=n,e._reject=a})}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),t.prototype.resolve=function(e){this._resolve&&this._resolve(e)},t.prototype.reject=function(e){this._reject&&this._reject(e)},t}();Xm.Deferred=XZ;Xm.UnregisterTimeoutInMilliseconds=3e4;Object.defineProperty(NT,"__esModule",{value:!0});var fD=Nt,mD=Mn,gD=Xm,YZ=function(){function t(e){e===void 0&&(e=gD.UnregisterTimeoutInMilliseconds),this._timeoutInMilliseconds=e}return t.prototype.getNewPromiseOrThrowIfBusy=function(){var e=this;if(this._deferred)throw new mD.TableauError(fD.SharedErrorCodes.ApiExecutionError,"This api cannot be executed till previous call is resolved.");return this._deferred=new gD.Deferred,this._timeoutId=setTimeout(function(){var n=new mD.TableauError(fD.SharedErrorCodes.Timeout,"Api failed to complete in "+e._timeoutInMilliseconds/1e3+" seconds");e.reject(n)},this._timeoutInMilliseconds),this._deferred.promise},t.prototype.resolve=function(e){this._deferred&&(clearTimeout(this._timeoutId),this._deferred.resolve(e),this._deferred=void 0)},t.prototype.reject=function(e){this._deferred&&(clearTimeout(this._timeoutId),this._deferred.reject(e),this._deferred=void 0)},t}();NT.ShortLivedDeferred=YZ;var Av={};Object.defineProperty(Av,"__esModule",{value:!0});var Bb=Nt,QZ=Mn,Nb=Gm,JZ=xv,eK=Hm,tK=qm,rK=function(){function t(e,n,a,u){this._storyPointInfoImpl=e,u&&(this._containedSheetImpl=this.createContainedSheet(u,n,a))}return Object.defineProperty(t.prototype,"index",{get:function(){return this._storyPointInfoImpl.index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"caption",{get:function(){return this._storyPointInfoImpl.caption},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return this._storyPointInfoImpl.active},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updated",{get:function(){return this._storyPointInfoImpl.updated},set:function(e){this._storyPointInfoImpl.updated=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentStory",{get:function(){return this._storyPointInfoImpl.parentStory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"containedSheet",{get:function(){return this._containedSheetImpl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storyPointId",{get:function(){return this._storyPointInfoImpl.storyPointId},enumerable:!0,configurable:!0}),t.prototype.createContainedSheet=function(e,n,a){var u=-1,d=Nb.SheetUtils.getPublishedSheetInfoByName(e.name,n),_=Nb.SheetUtils.createAutomaticSize(),l=d===void 0,w=d?d.url:"",T=!1,C=new eK.SheetInfoImpl(e.name,Nb.SheetUtils.getSheetTypeEnum(e.sheetType),_,u,T,l,w),P;switch(C.sheetType){case Bb.SheetType.Worksheet:{var z={worksheet:C.name};P=new tK.WorksheetImpl(C,a,z,null,this);break}case Bb.SheetType.Dashboard:{var $={sheetName:C.name,isDashboard:!0};P=new JZ.DashboardImpl(C,e.dashboardZones,$,a,this);break}default:throw new QZ.TableauError(Bb.SharedErrorCodes.ServerError,"Invalid SheetType")}return P},t}();Av.StoryPointImpl=rK;var Iv={};Object.defineProperty(Iv,"__esModule",{value:!0});var nK=function(){function t(e,n,a,u,d,_){this._caption=e,this._index=n,this._storyPointId=a,this._active=u,this._updated=d,this._parentStoryImpl=_}return Object.defineProperty(t.prototype,"caption",{get:function(){return this._caption},set:function(e){this._caption=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},set:function(e){this._index=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storyPointId",{get:function(){return this._storyPointId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return this._active},set:function(e){this._active=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updated",{get:function(){return this._updated},set:function(e){this._updated=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentStory",{get:function(){return this._parentStoryImpl},enumerable:!0,configurable:!0}),t}();Iv.StoryPointInfoImpl=nK;var iK=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(BT,"__esModule",{value:!0});var Ub=Nt,hy=pa,jb=Mn,dy=$o(),oK=NT,aK=Wd,yD=Av,_D=Iv,sK=function(t){iK(e,t);function e(n,a,u,d){var _=t.call(this,n,d)||this;return _._sheetInfoImpl=n,_._publishedSheetInfos=u,_._registryId=d,_._storyPointInfoImpls=[],_._deferred=new oK.ShortLivedDeferred,_.initializeStory(a),_}return e.prototype.initializeStory=function(n){var a=this;n.storyPoints.forEach(function(u){var d=u.index===n.activeStoryPointIndex,_=new _D.StoryPointInfoImpl(u.caption,u.index,u.storyPointId,d,u.updated,a);a._storyPointInfoImpls.push(_),d&&(a._activeStoryPointImpl=new yD.StoryPointImpl(_,a._publishedSheetInfos,a._registryId,u.containedSheetInfo))})},e.prototype.updateStoryInfo=function(n,a){if(this._storyPointInfoImpls){var u=this._storyPointInfoImpls[n];if(u.storyPointId!==a.storyPointId)throw new jb.TableauError(Ub.EmbeddingErrorCodes.StoryPointIdMismatch,"We should not be updating a story point when the IDs don't match. Existing storyPointID="+u.storyPointId+", newStoryPointID="+a.storyPointId);u.caption=a.caption,u.updated=a.updated,this._activeStoryPointImpl.storyPointId===a.storyPointId&&(this._activeStoryPointImpl.updated=u.updated)}},e.prototype.updateStory=function(n){var a=this;this._storyPointInfoImpls&&(this._storyPointInfoImpls.forEach(function(u){var d=u.storyPointId===n.storyPointId;d?(u.caption=n.caption,u.index=n.index,u.active=!0,u.updated=n.updated,a._activeStoryPointImpl=new yD.StoryPointImpl(u,a._publishedSheetInfos,a._registryId,n.containedSheetInfo)):u.active=!1}),this.activeStoryPoint&&this._deferred.resolve(this.activeStoryPoint))},Object.defineProperty(e.prototype,"activeStoryPoint",{get:function(){return this._activeStoryPointImpl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storyPointsInfo",{get:function(){return this._storyPointInfoImpls},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isActive",{get:function(){return this._sheetInfoImpl.active},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHidden",{get:function(){return!!this._sheetInfoImpl.isHidden},enumerable:!0,configurable:!0}),e.prototype.activateNextStoryPointAsync=function(){if(this._activeStoryPointImpl.index===this._storyPointInfoImpls.length-1)return Promise.resolve(this._activeStoryPointImpl);var n=this._deferred.getNewPromiseOrThrowIfBusy(),a=hy.ApiServiceRegistry.get(this._registryId).getService("story-activation-service");return a.activateNextStoryPointAsync(),n},e.prototype.activatePreviousStoryPointAsync=function(){if(this._activeStoryPointImpl.index===0)return Promise.resolve(this._activeStoryPointImpl);var n=this._deferred.getNewPromiseOrThrowIfBusy(),a=hy.ApiServiceRegistry.get(this._registryId).getService("story-activation-service");return a.activatePreviousStoryPointAsync(),n},e.prototype.activateStoryPointAsync=function(n){if(dy.ErrorHelpers.verifyParameter(n,"index"),dy.ErrorHelpers.verifyParameterType(n,"number","index"),n<0||n>=this._storyPointInfoImpls.length)throw new jb.TableauError(Ub.EmbeddingErrorCodes.IndexOutOfRange,"The index passed to this command is out of range.");if(n===this._activeStoryPointImpl.index)return Promise.resolve(this._activeStoryPointImpl);var a=this._deferred.getNewPromiseOrThrowIfBusy(),u=hy.ApiServiceRegistry.get(this._registryId).getService("story-activation-service");return u.activateStoryPointAsync(n),a},e.prototype.revertStoryPointAsync=function(n){var a=this;if(dy.ErrorHelpers.verifyParameter(n,"index"),dy.ErrorHelpers.verifyParameterType(n,"number","index"),n<0||n>=this._storyPointInfoImpls.length)throw new jb.TableauError(Ub.EmbeddingErrorCodes.IndexOutOfRange,"The index passed to this command is out of range.");var u=hy.ApiServiceRegistry.get(this._registryId).getService("story-activation-service");return u.revertStoryPointAsync(n).then(function(d){a.updateStoryInfo(d.index,d);var _=new _D.StoryPointInfoImpl(d.caption,d.index,d.storyPointId,!1,d.updated,a);return _})},e.prototype.clearPendingPromises=function(){this._deferred&&this._deferred.reject("All pending promises cleared")},e}(aK.SheetImpl);BT.StoryImpl=sK;var UT={};Object.defineProperty(UT,"__esModule",{value:!0});var lK=function(){function t(){}return t}();UT.WorkbookImpl=lK;var py={},jT={},VT={};Object.defineProperty(VT,"__esModule",{value:!0});var cK=function(){function t(e,n){this.visualIdPresModel=e,this.tupleId=n}return t}();VT.TooltipTextRequestModel=cK;var ai={};Object.defineProperty(ai,"__esModule",{value:!0});var uK=fl,hK=Mn,dK=vv,pK=function(){function t(e,n){this._dispatcher=e,this._registryId=n}return t.prototype.execute=function(e,n){return this._dispatcher.execute(e,n).catch(function(a){var u=a,d=uK.InternalToExternalEnumMappings.errorCode.convert(u.errorCode,dK.ShouldThrow.No);throw new hK.TableauError(d,u.message)})},t}();ai.ServiceImplBase=pK;var fK=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(jT,"__esModule",{value:!0});var Xh=hr(),mK=VT,gK=ai,yK=function(t){fK(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"accessibility"},enumerable:!0,configurable:!0}),e.prototype.getTooltipTextAsync=function(n,a){var u,d=new mK.TooltipTextRequestModel(n,a),_=(u={},u[Xh.ParameterId.FunctionName]="getTooltipTextAsync",u[Xh.ParameterId.TooltipTextRequest]=d,u);return this.execute(Xh.VerbId.GetTooltipText,_).then(function(l){return l.result})},e.prototype.leaveMarkNavigationAsync=function(n){var a,u=(a={},a[Xh.ParameterId.FunctionName]="leaveMarkNavigationAsync",a[Xh.ParameterId.VisualId]=n,a);return this.execute(Xh.VerbId.RaiseLeaveMarkNavNotification,u).then(function(d){})},e}(gK.ServiceImplBase);jT.AccessibilityServiceImpl=yK;var $T={},_K=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty($T,"__esModule",{value:!0});var vK=Nt,Vb=hr(),xK=Sc,bK=$o(),wK=ai,EK=function(t){_K(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"animation-service"},enumerable:!0,configurable:!0}),e.prototype.replayAsync=function(n){var a,u=(a={},a[Vb.ParameterId.ReplaySpeed]=1,a);return bK.ErrorHelpers.verifyEnumValue(n,vK.ReplaySpeedType,"ReplaySpeedType"),u[Vb.ParameterId.ReplaySpeed]=xK.ExternalToInternalEnumMappings.setReplaySpeedType.convert(n),this.execute(Vb.VerbId.ReplayAnimation,u).then(function(d){})},e}(wK.ServiceImplBase);$T.AnimationServiceImpl=EK;var WT={},fa={},Cv=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(fa,"__esModule",{value:!0});var GT=function(){function t(){}return t}();fa.SelectionModel=GT;var HT=function(t){Cv(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n.selectValues=[],n}return e}(GT);fa.ValueSelectionModel=HT;var SK=function(t){Cv(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(HT);fa.HierarchicalSelectionModel=SK;var TK=function(t){Cv(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(GT);fa.RangeSelectionModel=TK;var AK=function(t){Cv(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(HT);fa.DimensionSelectionModel=AK;var IK=function(){function t(){this.objectIds=[]}return t}();fa.TupleSelectionModel=IK;var CK=function(){function t(){this.hierModelArr=[],this.dimModelArr=[],this.quantModelArr=[]}return t}();fa.SelectionModelsContainer=CK;var kK=function(){function t(e,n,a,u){n===void 0&&(n=[]),this.visualIdPresModel=e,this.tupleIds=n,this.selectOptions=a,this.tooltipContext=u}return t}();fa.SelectTuplesInteractionModel=kK;var PK=function(){function t(e,n,a,u){this.visualIdPresModel=e,this.tupleId=n,this.tooltipContext=a,this.allowHoverActions=u}return t}();fa.HoverTupleInteractionModel=PK;var DK=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(WT,"__esModule",{value:!0});var vD=Nt,Yi=hr(),MK=fl,fy=fa,xD=Mn,zK=ai,RK=function(t){DK(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"annotation-service"},enumerable:!0,configurable:!0}),e.prototype.annotateMarkAsync=function(n,a,u){var d,_=this.parseMarkSelectionIds([a]),l={x:0,y:0},w="<formatted-text><run>"+u+"</run></formatted-text>",T=(d={},d[Yi.ParameterId.FunctionName]="annotateMarkAsync",d[Yi.ParameterId.VisualId]=n,d[Yi.ParameterId.AnnotateEnum]=Yi.AnnotateEnum.Mark,d[Yi.ParameterId.TargetPoint]=l,d[Yi.ParameterId.SelectionList]=[_.selection],d[Yi.ParameterId.FormattedText]=w,d);return this.execute(Yi.VerbId.CreateAnnotation,T).then(function(C){})},e.prototype.getAnnotationsAsync=function(n){var a,u=this,d=(a={},a[Yi.ParameterId.FunctionName]="getAnnotationsAsync",a[Yi.ParameterId.VisualId]=n,a);return this.execute(Yi.VerbId.GetAnnotations,d).then(function(_){var l=_.result;return u.annotationFilterMap(l)})},e.prototype.removeAnnotationAsync=function(n,a){var u,d=this.parseAnnotationSelectionIds([a]),_=(u={},u[Yi.ParameterId.FunctionName]="removeAnnotationAsync",u[Yi.ParameterId.VisualId]=n,u[Yi.ParameterId.SelectionList]=[d.selection],u);return this.execute(Yi.VerbId.RemoveAnnotation,_).then(function(l){})},e.prototype.parseMarkSelectionIds=function(n){var a=[],u=new fy.SelectionModelsContainer;if(n.forEach(function(_){var l=_.tupleId;if(l!=null&&l>0)a.push(l.toString());else throw new xD.TableauError(vD.ErrorCodes.InternalError,"invalid tupleId")}),a.length!==0){var d=new fy.TupleSelectionModel;d.selectionType="tuples",d.objectIds=a,u.selection=d}return u},e.prototype.parseAnnotationSelectionIds=function(n){var a=[],u=new fy.SelectionModelsContainer;if(n.forEach(function(_){var l=_.annotationId;if(l!=null&&l>=0)a.push(l.toString());else throw new xD.TableauError(vD.ErrorCodes.InternalError,"invalid annotationId")}),a.length!==0){var d=new fy.TupleSelectionModel;d.selectionType="annotations",d.objectIds=a,u.selection=d}return u},e.prototype.mapAnnotation=function(n){return{annotationHTML:n.annotationText,annotationId:n.annotationId,annotationText:n.annotationPlainText,annotationType:MK.InternalToExternalEnumMappings.annotationType.convert(n.annotateEnum),tupleId:n.tupleId}},e.prototype.annotationFilterMap=function(n){var a=this,u=n.map(function(d){return a.mapAnnotation(d)});return u},e}(zK.ServiceImplBase);WT.AnnotationServiceImpl=RK;var SO={};(function(t){var e=$e&&$e.__extends||function(){var $=function(U,W){return $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,V){N.__proto__=V}||function(N,V){for(var R in V)V.hasOwnProperty(R)&&(N[R]=V[R])},$(U,W)};return function(U,W){$(U,W);function N(){this.constructor=U}U.prototype=W===null?Object.create(W):(N.prototype=W.prototype,new N)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=Nt,a=hr(),u=hr(),d=$m,_=Wm,l=Zm,w=Sv,T=Mn,C=ai;t.SENTINEL_LOGICAL_TABLE_INFO={id:a.ApiShowDataTableSentinel.SingleTableId,caption:a.ApiShowDataTableSentinel.SingleTableCaption};var P={major:1,minor:20,fix:1},z=function($){e(U,$);function U(W,N,V){V===void 0&&(V=P);var R=$.call(this,W,N)||this;return R._platformVersion=V,R}return Object.defineProperty(U.prototype,"serviceName",{get:function(){return"data-source-service"},enumerable:!0,configurable:!0}),U.prototype.refreshAsync=function(W){var N,V=(N={},N[u.ParameterId.FunctionName]="refreshAsync",N[u.ParameterId.DeltaTimeMs]=0,N[u.ParameterId.ShouldRefreshDS]=!0,N);return W&&(V[u.ParameterId.DataSourceId]=W),this.execute(u.VerbId.RefreshDataSource,V).then(function(R){})},U.prototype.getActiveTablesAsync=function(W){var N,V=(N={},N[u.ParameterId.FunctionName]="getActiveTablesAsync",N[u.ParameterId.DataSourceId]=W,N);return this.execute(u.VerbId.GetActiveTables,V).then(function(R){var F=R.result;if(F.tables.length===0)throw new T.TableauError(n.ErrorCodes.UnsupportedMethodForDataSourceType,"getActiveTables is not supported for: "+W);return F.tables})},U.prototype.getDataSourcesAsync=function(W){var N,V=(N={},N[u.ParameterId.FunctionName]="getDataSourcesAsync",N[u.ParameterId.VisualId]=W,N);return this.execute(u.VerbId.GetDataSources,V).then(function(R){var F=R.result;return F})},U.prototype.getAllDataSourcesAsync=function(){var W,N=(W={},W[u.ParameterId.FunctionName]="getAllDataSourcesAsync",W);return this.execute(u.VerbId.GetAllDataSources,N).then(function(V){var R=V.result;return R})},U.prototype.getConnectionSummariesAsync=function(W){var N,V=(N={},N[u.ParameterId.FunctionName]="getConnectionSummariesAsync",N[u.ParameterId.DataSourceId]=W,N);return this.execute(u.VerbId.GetConnectionDescriptionSummaries,V).then(function(R){var F=R.result;return F})},U.prototype.getFieldAsync=function(W){var N,V=this,R=u.VerbId.GetFieldAndDataSource,F=(N={},N[u.ParameterId.FunctionName]="getFieldAsync",N[u.ParameterId.FieldId]=W,N);return this.execute(R,F).then(function(H){var J=H.result[u.ParameterId.DataSource],te=H.result[u.ParameterId.Field];return V.convertField(te,V.convertDataSource(J))})},U.prototype.getLogicalTablesAsync=function(W){var N;if(!this.isObjectModelSupportedByPlatform())return new Promise(function(R){return R([t.SENTINEL_LOGICAL_TABLE_INFO])});var V=(N={},N[u.ParameterId.FunctionName]="getLogicalTablesAsync",N[u.ParameterId.DataSourceId]=W,N);return this.execute(u.VerbId.GetLogicalTables,V).then(function(R){return R.result})},U.prototype.getUnderlyingTablesAsync=function(W){var N;if(!this.isObjectModelSupportedByPlatform())return new Promise(function(R){return R([t.SENTINEL_LOGICAL_TABLE_INFO])});var V=(N={},N[u.ParameterId.FunctionName]="getUnderlyingTablesAsync",N[u.ParameterId.VisualId]=W,N);return this.execute(u.VerbId.GetUnderlyingTables,V).then(function(R){return R.result})},U.prototype.convertField=function(W,N){return new _.Field(new w.FieldImpl(W,N))},U.prototype.convertDataSource=function(W){return new d.DataSource(new l.DataSourceImpl(W,this._registryId))},U.prototype.isObjectModelSupportedByPlatform=function(){var W={major:1,minor:13,fix:0};return a.VersionLessThan(W,this._platformVersion)},U}(C.ServiceImplBase);t.DataSourceServiceImpl=z})(SO);var qT={},kv={};Object.defineProperty(kv,"__esModule",{value:!0});var Er=hr(),vr=Nt,$b=Mn,OK=function(){function t(){}return t.updateInternalExportPDFOptions=function(e,n,a){e.currentSheet=a[0],this.updateExportLayoutOptions(e,n),this.updateSheetOptions(e,a)},t.updateExportLayoutOptions=function(e,n){var a=e.exportLayoutOptions;switch(a.imageHeight=this.DefaultLayoutOptions.imageHeight,a.imageWidth=this.DefaultLayoutOptions.imageWidth,n.orientation){case vr.PrintOrientation.Landscape:a.pageOrientationOption=Er.PageOrientation.Landscape;break;case vr.PrintOrientation.Portrait:a.pageOrientationOption=Er.PageOrientation.Portrait;break;default:throw new $b.TableauError(vr.SharedErrorCodes.InternalError,"invalid orientation for ExportPDFOption")}switch(n.pageSize){case vr.PrintPageSize.A3:a.pageSizeOption=Er.PageSizeOption.A3;break;case vr.PrintPageSize.A4:a.pageSizeOption=Er.PageSizeOption.A4;break;case vr.PrintPageSize.A5:a.pageSizeOption=Er.PageSizeOption.A5;break;case vr.PrintPageSize.B4:a.pageSizeOption=Er.PageSizeOption.B4;break;case vr.PrintPageSize.B5:a.pageSizeOption=Er.PageSizeOption.B5;break;case vr.PrintPageSize.Executive:a.pageSizeOption=Er.PageSizeOption.Executive;break;case vr.PrintPageSize.Folio:a.pageSizeOption=Er.PageSizeOption.Folio;break;case vr.PrintPageSize.Ledger:a.pageSizeOption=Er.PageSizeOption.Ledger;break;case vr.PrintPageSize.Legal:a.pageSizeOption=Er.PageSizeOption.Legal;break;case vr.PrintPageSize.Letter:a.pageSizeOption=Er.PageSizeOption.Letter;break;case vr.PrintPageSize.Note:a.pageSizeOption=Er.PageSizeOption.Note;break;case vr.PrintPageSize.Quarto:a.pageSizeOption=Er.PageSizeOption.Quarto;break;case vr.PrintPageSize.Statement:a.pageSizeOption=Er.PageSizeOption.Statement;break;case vr.PrintPageSize.Tabloid:a.pageSizeOption=Er.PageSizeOption.Tabloid;break;case vr.PrintPageSize.Unspecified:a.pageSizeOption=Er.PageSizeOption.Unspecified;break;default:throw new $b.TableauError(vr.SharedErrorCodes.InternalError,"invalid pageSize for ExportPDFOption")}switch(n.scaling){case vr.PrintScaling.AtMost1PageHigh:this.setFitAndScaleValues(a,Er.FitPages.FitOneHigh);break;case vr.PrintScaling.AtMost1PageWide:this.setFitAndScaleValues(a,Er.FitPages.FitOneWide);break;case vr.PrintScaling.AtMost2PagesHigh:this.setFitAndScaleValues(a,Er.FitPages.FitTwoHigh);break;case vr.PrintScaling.AtMost2PagesWide:this.setFitAndScaleValues(a,Er.FitPages.FitTwoWide);break;case vr.PrintScaling.Automatic:this.setFitAndScaleValues(a,Er.PageScalingOption.ScalePctAuto);break;case vr.PrintScaling.Perc100:this.setFitAndScaleValues(a,Er.PageScalingOption.ScalePct100);break;case vr.PrintScaling.Perc200:this.setFitAndScaleValues(a,Er.PageScalingOption.ScalePct200);break;case vr.PrintScaling.Perc25:this.setFitAndScaleValues(a,Er.PageScalingOption.ScalePct25);break;case vr.PrintScaling.Perc400:this.setFitAndScaleValues(a,Er.PageScalingOption.ScalePct400);break;case vr.PrintScaling.Perc50:this.setFitAndScaleValues(a,Er.PageScalingOption.ScalePct50);break;case vr.PrintScaling.Perc60:this.setFitAndScaleValues(a,Er.PageScalingOption.ScalePct60);break;case vr.PrintScaling.Perc75:this.setFitAndScaleValues(a,Er.PageScalingOption.ScalePct75);break;case vr.PrintScaling.Perc80:this.setFitAndScaleValues(a,Er.PageScalingOption.ScalePct80);break;case vr.PrintScaling.Perc90:this.setFitAndScaleValues(a,Er.PageScalingOption.ScalePct90);break;default:throw new $b.TableauError(vr.SharedErrorCodes.InternalError,"invalid scaling for ExportPDFOption")}},t.updateSheetOptions=function(e,n){for(var a=e.exportLayoutOptions,u=e.sheetOptions,d=0,_=u;d<_.length;d++){var l=_[d];l.exportLayoutOptions=a,l.isSelected=n.includes(l.sheet)}},t.setFitAndScaleValues=function(e,n){var a,u=this.DefaultLayoutOptions,d=u.pageFitHorizontal,_=u.pageFitVertical,l=u.pageScaleMode,w=u.pageScalePercent,T=this.fitRegex.exec(n),C=this.pctRegex.exec(n);T?(a=T.slice(1).map(function(P){return Number(P)}),d=a[0],_=a[1],l=Er.ScaleMode.ScaleFitPages):C&&(w=C.slice(1).map(function(P){return Number(P)})[0],l=Er.ScaleMode.ScalePercentage),e.pageFitHorizontal=d,e.pageFitVertical=_,e.pageScaleMode=l,e.pageScalePercent=w},t.DefaultDataOptions={ignoreAliases:!1,columnsToIncludeById:[]},t.DefaultPDFOptions={scaling:vr.PrintScaling.Automatic,pageSize:vr.PrintPageSize.Letter,orientation:vr.PrintOrientation.Portrait},t.DefaultLayoutOptions={imageHeight:0,imageWidth:0,pageFitHorizontal:1,pageFitVertical:1,pageOrientationOption:Er.PageOrientation.Portrait,pageScaleMode:Er.ScaleMode.ScaleAuto,pageScalePercent:100,pageSizeOption:Er.PageSizeOption.Letter},t.fitRegex=new RegExp("fit([0-9]+)x([0-9]+)"),t.pctRegex=new RegExp("pct([0-9]+)"),t}();kv.ExportHelpers=OK;var FK=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),bD=$e&&$e.__awaiter||function(t,e,n,a){function u(d){return d instanceof n?d:new n(function(_){_(d)})}return new(n||(n=Promise))(function(d,_){function l(C){try{T(a.next(C))}catch(P){_(P)}}function w(C){try{T(a.throw(C))}catch(P){_(P)}}function T(C){C.done?d(C.value):u(C.value).then(l,w)}T((a=a.apply(t,e||[])).next())})},wD=$e&&$e.__generator||function(t,e){var n={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},a,u,d,_;return _={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function l(T){return function(C){return w([T,C])}}function w(T){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,u&&(d=T[0]&2?u.return:T[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,T[1])).done)return d;switch(u=0,d&&(T=[T[0]&2,d.value]),T[0]){case 0:case 1:d=T;break;case 4:return n.label++,{value:T[1],done:!1};case 5:n.label++,u=T[1],T=[0];continue;case 7:T=n.ops.pop(),n.trys.pop();continue;default:if(d=n.trys,!(d=d.length>0&&d[d.length-1])&&(T[0]===6||T[0]===2)){n=0;continue}if(T[0]===3&&(!d||T[1]>d[0]&&T[1]<d[3])){n.label=T[1];break}if(T[0]===6&&n.label<d[1]){n.label=d[1],d=T;break}if(d&&n.label<d[2]){n.label=d[2],n.ops.push(T);break}d[2]&&n.ops.pop(),n.trys.pop();continue}T=e.call(t,n)}catch(C){T=[6,C],u=0}finally{a=d=0}if(T[0]&5)throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}};Object.defineProperty(qT,"__esModule",{value:!0});var An=hr(),Ys=Nt,LK=Sc,BK=kv,Yh=$o(),Qh=Mn,NK=ai,UK=function(t){FK(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"export-service"},enumerable:!0,configurable:!0}),e.prototype.getExportCrosstabSheetMapAsync=function(n){var a,u=An.VerbId.GetExportCrosstabSheetMap,d=(a={},a[An.ParameterId.FunctionName]="getExportCrosstabSheetMapAsync",a[An.ParameterId.CurrentSheetType]=LK.ExternalToInternalEnumMappings.sheetType.convert(n),a);return this.execute(u,d).then(function(_){var l=_.result;return l})},e.prototype.exportCrosstabAsync=function(n,a,u,d){return bD(this,void 0,void 0,function(){var _,l,w,T;return wD(this,function(C){switch(C.label){case 0:return Yh.ErrorHelpers.verifySheetName(u,n),Yh.ErrorHelpers.verifyEnumValue(a,Ys.CrosstabFileFormat,"CrosstabFileFormat"),[4,this.getExportCrosstabSheetMapAsync(d)];case 1:if(_=C.sent(),!_[n])throw new Qh.TableauError(Ys.SharedErrorCodes.InternalError,"missing sheet doc id from sheetMap");switch(l=(T={},T[An.ParameterId.FunctionName]="exportCrosstabAsync",T[An.ParameterId.SheetIdentifier]=_[n],T[An.ParameterId.SendNotifications]=!0,T),a){case Ys.CrosstabFileFormat.CSV:w=An.VerbId.ExportCrosstabCsvDownload,l[An.ParameterId.UseTabDelimiters]=!0;break;case Ys.CrosstabFileFormat.Excel:w=An.VerbId.ExportCrosstabExcelDownload;break;default:throw new Qh.TableauError(Ys.SharedErrorCodes.InternalError,"unsupported Crosstab file format.")}return[2,this.execute(w,l).then(function(P){var z=P.result;return z}).catch(function(){throw new Qh.TableauError(Ys.SharedErrorCodes.CrosstabCreationError,"An unexpected error occurred while generating the document.")})]}})})},e.prototype.exportDataAsync=function(n,a){var u,d;Yh.ErrorHelpers.verifyExportDataOptions(a);var _=new Set(a.columnsToIncludeById),l=Array.from(_),w=An.VerbId.ExportDataDownload,T=(u={},u[An.ParameterId.FunctionName]="exportDataAsync",u[An.ParameterId.VisualId]=n,u[An.ParameterId.IgnoreAliases]=(d=a.ignoreAliases,d??!1),u[An.ParameterId.ColumnsToIncludeById]=l,u);return this.execute(w,T).then(function(){}).catch(function(){throw new Qh.TableauError(Ys.SharedErrorCodes.DataCreationError,"An unexpected error occurred while generating the document.")})},e.prototype.exportPowerPointAsync=function(n,a){var u;Yh.ErrorHelpers.verifySheetNamesForPDFAndPPT(n,a);var d=An.VerbId.ExportPowerpointDownload,_=(u={},u[An.ParameterId.FunctionName]="exportPowerPointAsync",u[An.ParameterId.ExportOriginUrl]="",u[An.ParameterId.SelectedSheetNames]=n,u);return this.execute(d,_).then(function(l){var w=l.result;return w}).catch(function(){throw new Qh.TableauError(Ys.SharedErrorCodes.PowerPointCreationError,"An error occured while attempting to generate the PowerPoint file.")})},e.prototype.exportPDFAsync=function(n,a,u){return bD(this,void 0,void 0,function(){var d,_,l,w;return wD(this,function(T){switch(T.label){case 0:return Yh.ErrorHelpers.verifyExportPDFOptions(a),Yh.ErrorHelpers.verifySheetNamesForPDFAndPPT(n,u),[4,this.getExportPDFOptionsAsync()];case 1:return d=T.sent(),BK.ExportHelpers.updateInternalExportPDFOptions(d,a,n),_=An.VerbId.ExportPdfDownload,l=(w={},w[An.ParameterId.FunctionName]="exportPDFAsync",w[An.ParameterId.ExportPdfOptions]=d,w),[2,this.execute(_,l).then(function(C){var P=C.result;return P}).catch(function(){throw new Qh.TableauError(Ys.SharedErrorCodes.PDFCreationError,"Unable to create PDF because something went wrong. Try again.")})]}})})},e.prototype.getExportPDFOptionsAsync=function(){var n,a=An.VerbId.GetExportPdfOptions,u=(n={},n[An.ParameterId.FunctionName]="getExportPdfOptionsAsync",n);return this.execute(a,u).then(function(d){var _=d.result;return _})},e}(NK.ServiceImplBase);qT.ExportServiceImpl=UK;var ZT={},jK=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(ZT,"__esModule",{value:!0});var bi=hr(),VK=ai,$K=function(t){jK(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"external-context-menu-service"},enumerable:!0,configurable:!0}),e.prototype.appendContextMenuAsync=function(n,a,u){var d,_=bi.VerbId.AppendExternalMenuItem,l=(d={},d[bi.ParameterId.FunctionName]="appendContextMenuAsync",d[bi.ParameterId.WorksheetName]=n,d[bi.ParameterId.ExternalMenuItemDisplayName]=u.displayName,d);return this.execute(_,l).then(function(w){var T=w.result;return T})},e.prototype.removeContextMenuAsync=function(n,a,u){var d,_=bi.VerbId.RemoveExternalMenuItem,l=(d={},d[bi.ParameterId.FunctionName]="removeContextMenuAsync",d[bi.ParameterId.WorksheetName]=n,d[bi.ParameterId.ExternalMenuItemId]=u,d);return this.execute(_,l).then(function(w){})},e.prototype.executeContextMenuAsync=function(n,a,u){var d,_=bi.VerbId.ExecuteExternalMenuItem,l=(d={},d[bi.ParameterId.FunctionName]="executeContextMenuAsync",d[bi.ParameterId.WorksheetName]=n,d[bi.ParameterId.ExternalMenuItemId]=u,d);return this.execute(_,l).then(function(w){})},e.prototype.renameContextMenuAsync=function(n,a,u,d){var _,l=bi.VerbId.RenameExternalMenu,w=(_={},_[bi.ParameterId.FunctionName]="renameContextMenuAsync",_[bi.ParameterId.WorksheetName]=n,_[bi.ParameterId.ExternalMenuHeader]=u,_[bi.ParameterId.ExternalMenuDescription]=d,_);return this.execute(l,w).then(function(T){})},e}(VK.ServiceImplBase);ZT.ExternalContextMenuServiceImpl=$K;var my={},Ya={},Pv=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(Ya,"__esModule",{value:!0});var F_=Nt,hm=pa,KT=$o(),Ym=function(){function t(e,n,a,u,d){this._worksheetName=e,this._fieldName=n,this._filterType=a,this._fieldId=u,this._registryId=d}return Object.defineProperty(t.prototype,"worksheetName",{get:function(){return this._worksheetName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldName",{get:function(){return this._fieldName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldId",{get:function(){return this._fieldId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterType",{get:function(){return this._filterType},enumerable:!0,configurable:!0}),t.prototype.getFieldAsync=function(){var e=hm.ApiServiceRegistry.get(this._registryId).getService("data-source-service");return e.getFieldAsync(this._fieldId)},t.prototype.getAppliedWorksheetsAsync=function(){var e=hm.ApiServiceRegistry.get(this._registryId).getService("filter-service");return e.getAppliedWorksheetsAsync(this._worksheetName,this._fieldId)},t.prototype.setAppliedWorksheetsAsync=function(e){KT.ErrorHelpers.verifyParameter(e,"applyToWorksheets");var n=new Set(e),a=hm.ApiServiceRegistry.get(this._registryId).getService("filter-service");return a.setAppliedWorksheetsAsync(this._worksheetName,this._fieldName,this._fieldId,Array.from(n))},t}();Ya.Filter=Ym;var WK=function(t){Pv(e,t);function e(n,a,u,d,_,l,w,T){var C=t.call(this,n,a,d,u,_)||this;return C._appliedValues=l,C._isExcludeMode=w,C._isAllSelected=T,C}return Object.defineProperty(e.prototype,"isAllSelected",{get:function(){return this._isAllSelected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appliedValues",{get:function(){return this._appliedValues},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isExcludeMode",{get:function(){return this._isExcludeMode},enumerable:!0,configurable:!0}),e.prototype.getDomainAsync=function(n){n||(n=F_.FilterDomainType.Relevant),KT.ErrorHelpers.verifyEnumValue(n,F_.FilterDomainType,"FilterDomainType");var a=hm.ApiServiceRegistry.get(this._registryId).getService("filter-service");return a.getCategoricalDomainAsync(this._worksheetName,this._fieldId,n)},e}(Ym);Ya.CategoricalFilter=WK;var GK=function(){function t(e,n,a){this._value=e,this._hierarchicalPath=n,this._level=a}return Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hierarchicalPath",{get:function(){return this._hierarchicalPath},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},enumerable:!0,configurable:!0}),t}();Ya.HierarchicalDataValue=GK;var HK=function(){function t(e,n){this._name=e,this._levelSelectionState=n}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"levelSelectionState",{get:function(){return this._levelSelectionState},enumerable:!0,configurable:!0}),t}();Ya.HierarchicalLevelDetail=HK;var qK=function(t){Pv(e,t);function e(n,a,u,d,_,l,w,T,C,P,z){var $=t.call(this,n,a,d,u,_)||this;return $._dimensionName=l,$._hierarchyCaption=w,$._numberOfLevels=T,$._levelDetails=C,$._appliedValues=P,$._isAllSelected=z,$}return e.prototype.getDomainAsync=function(n){throw new Error("Method not implemented.")},Object.defineProperty(e.prototype,"dimensionName",{get:function(){return this._dimensionName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hierarchyCaption",{get:function(){return this._hierarchyCaption},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfLevels",{get:function(){return this._numberOfLevels},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"levelDetails",{get:function(){return this._levelDetails},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAllSelected",{get:function(){return this._isAllSelected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appliedValues",{get:function(){return this._appliedValues},enumerable:!0,configurable:!0}),e}(Ym);Ya.HierarchicalFilter=qK;var ZK=function(t){Pv(e,t);function e(n,a,u,d,_,l,w,T){var C=t.call(this,n,a,d,u,_)||this;return C._min=l,C._max=w,C._includeNullValues=T,C}return Object.defineProperty(e.prototype,"minValue",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxValue",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"includeNullValues",{get:function(){return this._includeNullValues},enumerable:!0,configurable:!0}),e.prototype.getDomainAsync=function(n){var a=hm.ApiServiceRegistry.get(this._registryId).getService("filter-service");return n||(n=F_.FilterDomainType.Relevant),KT.ErrorHelpers.verifyEnumValue(n,F_.FilterDomainType,"FilterDomainType"),a.getRangeDomainAsync(this._worksheetName,this._fieldId,n)},e}(Ym);Ya.RangeFilter=ZK;var KK=function(t){Pv(e,t);function e(n,a,u,d,_,l,w,T,C){var P=t.call(this,n,a,d,u,_)||this;return P._anchorDate=l,P._periodType=w,P._rangeType=T,P._rangeN=C,P}return Object.defineProperty(e.prototype,"anchorDate",{get:function(){return this._anchorDate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"periodType",{get:function(){return this._periodType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeType",{get:function(){return this._rangeType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeN",{get:function(){return this._rangeN},enumerable:!0,configurable:!0}),e}(Ym);Ya.RelativeDateFilter=KK;var XK=function(){function t(e,n){this._values=e,this._domainType=n}return Object.defineProperty(t.prototype,"values",{get:function(){return this._values},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._domainType},enumerable:!0,configurable:!0}),t}();Ya.CategoricalDomain=XK;var YK=function(){function t(e,n,a){this._min=e,this._max=n,this._domainType=a}return Object.defineProperty(t.prototype,"type",{get:function(){return this._domainType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),t}();Ya.RangeDomain=YK;var ED;function QK(){if(ED)return my;ED=1;var t=$e&&$e.__extends||function(){var U=function(W,N){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,R){V.__proto__=R}||function(V,R){for(var F in R)R.hasOwnProperty(F)&&(V[F]=R[F])},U(W,N)};return function(W,N){U(W,N);function V(){this.constructor=W}W.prototype=N===null?Object.create(N):(V.prototype=N.prototype,new V)}}(),e=$e&&$e.__awaiter||function(U,W,N,V){function R(F){return F instanceof N?F:new N(function(H){H(F)})}return new(N||(N=Promise))(function(F,H){function J(ge){try{se(V.next(ge))}catch(xe){H(xe)}}function te(ge){try{se(V.throw(ge))}catch(xe){H(xe)}}function se(ge){ge.done?F(ge.value):R(ge.value).then(J,te)}se((V=V.apply(U,W||[])).next())})},n=$e&&$e.__generator||function(U,W){var N={label:0,sent:function(){if(F[0]&1)throw F[1];return F[1]},trys:[],ops:[]},V,R,F,H;return H={next:J(0),throw:J(1),return:J(2)},typeof Symbol=="function"&&(H[Symbol.iterator]=function(){return this}),H;function J(se){return function(ge){return te([se,ge])}}function te(se){if(V)throw new TypeError("Generator is already executing.");for(;N;)try{if(V=1,R&&(F=se[0]&2?R.return:se[0]?R.throw||((F=R.return)&&F.call(R),0):R.next)&&!(F=F.call(R,se[1])).done)return F;switch(R=0,F&&(se=[se[0]&2,F.value]),se[0]){case 0:case 1:F=se;break;case 4:return N.label++,{value:se[1],done:!1};case 5:N.label++,R=se[1],se=[0];continue;case 7:se=N.ops.pop(),N.trys.pop();continue;default:if(F=N.trys,!(F=F.length>0&&F[F.length-1])&&(se[0]===6||se[0]===2)){N=0;continue}if(se[0]===3&&(!F||se[1]>F[0]&&se[1]<F[3])){N.label=se[1];break}if(se[0]===6&&N.label<F[1]){N.label=F[1],F=se;break}if(F&&N.label<F[2]){N.label=F[2],N.ops.push(se);break}F[2]&&N.ops.pop(),N.trys.pop();continue}se=W.call(U,N)}catch(ge){se=[6,ge],R=0}finally{V=F=0}if(se[0]&5)throw se[1];return{value:se[0]?se[1]:void 0,done:!0}}};Object.defineProperty(my,"__esModule",{value:!0});var a=Nt,u=hr(),d=hr(),_=sn(),l=Sc,w=fl,T=Ya,C=Km,P=$d(),z=ai,$=function(U){t(W,U);function W(){return U!==null&&U.apply(this,arguments)||this}return Object.defineProperty(W.prototype,"serviceName",{get:function(){return"filter-service"},enumerable:!0,configurable:!0}),W.prototype.applyFilterAsync=function(N,V,R,F,H){var J,te=d.VerbId.ApplyCategoricalFilter,se=(J={},J[d.ParameterId.FunctionName]="applyFilterAsync",J);if(se[d.ParameterId.VisualId]=N,se[d.ParameterId.FieldName]=V,!Array.isArray(R))throw new _.TableauError(a.ErrorCodes.InvalidParameter,"values parameter for applyFilterAsync must be an array");return se[d.ParameterId.FilterValues]=R,se[d.ParameterId.FilterUpdateType]=l.ExternalToInternalEnumMappings.filterUpdateType.convert(F),se[d.ParameterId.IsExcludeMode]=H===void 0||H.isExcludeMode===void 0?!1:H.isExcludeMode,this.execute(te,se).then(function(ge){return V})},W.prototype.applyRangeFilterAsync=function(N,V,R){var F,H=this,J=d.VerbId.ApplyRangeFilter,te=(F={},F[d.ParameterId.FunctionName]="applyRangeFilterAsync",F);if(R.min!==void 0&&R.min!==null){var se=void 0;R.min instanceof Date?se=P.Param.serializeDateForPlatform(R.min):se=R.min,te[d.ParameterId.FilterRangeMin]=se}if(R.max!==void 0&&R.max!==null){var ge=void 0;R.max instanceof Date?ge=P.Param.serializeDateForPlatform(R.max):ge=R.max,te[d.ParameterId.FilterRangeMax]=ge}return R.nullOption&&(te[d.ParameterId.FilterRangeNullOption]=l.ExternalToInternalEnumMappings.nullOptions.convert(R.nullOption)),te[d.ParameterId.FieldName]=V,te[d.ParameterId.VisualId]=N,this.execute(J,te).then(function(xe){return H.apiFilterHandlerCheckForCommandError(xe.result),V})},W.prototype.applyHierarchicalFilterAsync=function(N,V,R,F,H){var J,te=d.VerbId.HierarchicalFilter,se=(J={},J[d.ParameterId.FunctionName]="applyHierarchicalFilterAsync",J);se[d.ParameterId.VisualId]=N,se[d.ParameterId.FieldName]=V;var ge=R.levels;return Array.isArray(ge)&&ge.length>0?se[d.ParameterId.FilterLevels]=ge:R.length>0?se[d.ParameterId.FilterValues]=R:se[d.ParameterId.FilterLevels]=[],se[d.ParameterId.FilterUpdateType]=l.ExternalToInternalEnumMappings.filterUpdateType.convert(F),se[d.ParameterId.IsExcludeMode]=H&&!!H.isExcludeMode,this.execute(te,se).then(function(xe){return V})},W.prototype.clearFilterAsync=function(N,V){var R,F=d.VerbId.ClearFilter,H=(R={},R[d.ParameterId.FunctionName]="clearFilterAsync",R);return H[d.ParameterId.VisualId]=N,H[d.ParameterId.FieldName]=V,this.execute(F,H).then(function(J){return V})},W.prototype.applyRelativeDateFilterAsync=function(N,V,R){var F,H=d.VerbId.ApplyRelativeDateFilter,J=(F={},F[d.ParameterId.FunctionName]="applyRelativeDateFilterAsync",F);if(J[d.ParameterId.VisualId]=N,J[d.ParameterId.FieldName]=V,J[d.ParameterId.PeriodType]=l.ExternalToInternalEnumMappings.periodType.convert(R.periodType),J[d.ParameterId.DateRangeType]=l.ExternalToInternalEnumMappings.dateRangeType.convert(R.rangeType),R.rangeType===a.DateRangeType.LastN||R.rangeType===a.DateRangeType.NextN){if(R.rangeN===void 0||R.rangeN===null)throw new _.TableauError(a.EmbeddingErrorCodes.MissingRangeNForRelativeDateFilters,"Missing rangeN field for a relative date filter of LASTN or NEXTN.");J[d.ParameterId.RangeN]=R.rangeN}return R.anchorDate!==void 0&&R.anchorDate!==null&&(J[d.ParameterId.AnchorDate]=this.convertAnchorDate(R.anchorDate)),this.execute(H,J).then(function(te){return te.result})},W.prototype.getFiltersAsync=function(N){var V,R=this,F=d.VerbId.GetFilters,H=(V={},V[d.ParameterId.FunctionName]="getFiltersAsync",V);return H[d.ParameterId.VisualId]=N,this.execute(F,H).then(function(J){var te=J.result;return R.convertDomainFilters(te)})},W.prototype.getCategoricalDomainAsync=function(N,V,R){var F,H=this,J=d.VerbId.GetCategoricalDomain,te=(F={},F[d.ParameterId.FunctionName]="getCategoricalDomainAsync",F);return te[d.ParameterId.VisualId]={worksheet:N},te[d.ParameterId.FieldId]=V,te[d.ParameterId.DomainType]=l.ExternalToInternalEnumMappings.filterDomainType.convert(R),this.execute(J,te).then(function(se){var ge=se.result;return H.convertCategoricalDomain(ge,R)})},W.prototype.getRangeDomainAsync=function(N,V,R){var F,H=this,J=d.VerbId.GetRangeDomain,te=(F={},F[d.ParameterId.FunctionName]="getRangeDomainAsync",F);return te[d.ParameterId.VisualId]={worksheet:N},te[d.ParameterId.FieldId]=V,te[d.ParameterId.DomainType]=l.ExternalToInternalEnumMappings.filterDomainType.convert(R),this.execute(J,te).then(function(se){var ge=se.result;return H.convertRangeDomain(ge,R)})},W.prototype.getDashboardFiltersAsync=function(){var N,V=this,R=d.VerbId.GetDashboardFilters,F=(N={},N[d.ParameterId.FunctionName]="getDashboardFiltersAsync",N);return this.execute(R,F).then(function(H){var J=H.result;return V.convertDomainFilters(J)})},W.prototype.applyDashboardFilterAsync=function(N,V,R,F){var H,J=d.VerbId.DashboardCategoricalFilter,te=(H={},H[d.ParameterId.FunctionName]="applyDashboardFilterAsync",H);return te[d.ParameterId.FieldName]=N,te[d.ParameterId.FilterValues]=V,te[d.ParameterId.FilterUpdateType]=l.ExternalToInternalEnumMappings.filterUpdateType.convert(R),te[d.ParameterId.IsExcludeMode]=F&&!!F.isExcludeMode,this.execute(J,te).then(function(se){return se.result})},W.prototype.getAppliedWorksheetsAsync=function(N,V){var R;return e(this,void 0,void 0,function(){var F,H;return n(this,function(J){switch(J.label){case 0:return[4,this.executeGetAppliedWorksheets(N,V,"getAppliedWorksheetsAsync")];case 1:return F=J.sent(),H=[],(R=F.worksheets)===null||R===void 0||R.map(function(te){te.isSelected&&H.push(te.worksheetName)}),[2,H]}})})},W.prototype.setAppliedWorksheetsAsync=function(N,V,R,F){return e(this,void 0,void 0,function(){var H,J,te,se,ge;return n(this,function(xe){switch(xe.label){case 0:return[4,this.executeGetAppliedWorksheets(N,R,"getAppliedWorksheetsAsyncInternal")];case 1:if(H=xe.sent(),!H||!H.worksheets)throw new _.TableauError(a.SharedErrorCodes.InternalError,"This filter does not apply to multiple worksheets");if(J=[],te="",H.worksheets.forEach(function(Ee){Ee.isActive&&(te=Ee.worksheetName),(Ee.isSelected||Ee.isEnabled)&&J.push(Ee.worksheetName)}),te==="")throw new _.TableauError(a.SharedErrorCodes.InternalError,"No active worksheet");if(!F.includes(te))throw new _.TableauError(a.SharedErrorCodes.InternalError,te+" must be included in the applied worksheets");return F.forEach(function(Ee){if(!J.includes(Ee))throw new _.TableauError(a.SharedErrorCodes.InternalError,"The field "+V+" isn't applicable to the worksheet "+Ee)}),se=d.VerbId.ChangeSharedFilter,ge={},ge[d.ParameterId.FunctionName]="setAppliedWorksheetsAsync",ge[d.ParameterId.VisualId]={worksheet:N},ge[d.ParameterId.FieldId]=R,ge[d.ParameterId.SharedFilterSheets]=F,[2,this.execute(se,ge).then(function(Ee){return F})]}})})},W.prototype.executeGetAppliedWorksheets=function(N,V,R){var F=d.VerbId.GetSharedFilter,H={};return H[d.ParameterId.FunctionName]=R,H[d.ParameterId.VisualId]={worksheet:N},H[d.ParameterId.FieldId]=V,this.execute(F,H).then(function(J){var te=J.result;return te})},W.prototype.convertDomainFilters=function(N){var V=this,R=[];return N.forEach(function(F){switch(F.filterType){case d.FilterType.Categorical:{var H=F;if(H)R.push(V.convertCategoricalFilter(H));else throw new Error("Invalid Categorical Filter");break}case d.FilterType.Hierarchical:{var H=F;if(H)R.push(V.convertHierarchicalFilter(H));else throw new Error("Invalid Hierarchical Filter");break}case d.FilterType.Range:{var H=F;if(H)R.push(V.convertRangeFilter(H));else throw new Error("Invalid Range Filter");break}case d.FilterType.RelativeDate:{var H=F;if(H)R.push(V.convertRelativeDateFilter(H));else throw new Error("Invalid Relative Date Filter");break}}}),R},W.prototype.convertCategoricalFilter=function(N){var V=N.values.map(function(R){return C.DataValueFactory.MakeFilterDataValue(R)});return new T.CategoricalFilter(N.visualId.worksheet,N.fieldCaption,N.fieldName,d.FilterType.Categorical,this._registryId,V,N.isExclude,N.isAllSelected)},W.prototype.convertHierarchicalFilter=function(N){var V=N.values.map(function(F){return new T.HierarchicalDataValue(C.DataValueFactory.MakeFilterDataValue(F.value),F.hierarchicalPath,F.level)}),R=N.levelInfo.map(function(F){return new T.HierarchicalLevelDetail(F.name,w.InternalToExternalEnumMappings.hierarchicalLevelSelectionState.convert(F.levelSelectionState))});return new T.HierarchicalFilter(N.visualId.worksheet,N.fieldCaption,N.fieldName,d.FilterType.Hierarchical,this._registryId,N.dimensionName,N.hierarchyCaption,N.levels,R,V,N.isAllSelected)},W.prototype.convertRangeFilter=function(N){var V=C.DataValueFactory.MakeFilterDataValue(N.min),R=C.DataValueFactory.MakeFilterDataValue(N.max);return new T.RangeFilter(N.visualId.worksheet,N.fieldCaption,N.fieldName,d.FilterType.Range,this._registryId,V,R,N.includeNullValues)},W.prototype.convertRelativeDateFilter=function(N){var V=C.DataValueFactory.MakeFilterDataValue(N.anchorDate);return new T.RelativeDateFilter(N.visualId.worksheet,N.fieldCaption,N.fieldName,a.FilterType.RelativeDate,this._registryId,V,w.InternalToExternalEnumMappings.dateStepPeriod.convert(N.periodType),w.InternalToExternalEnumMappings.dateRangeType.convert(N.rangeType),N.rangeN)},W.prototype.convertCategoricalDomain=function(N,V){var R=N.values.map(function(F){return C.DataValueFactory.MakeFilterDataValue(F)});return new T.CategoricalDomain(R,V)},W.prototype.convertRangeDomain=function(N,V){var R=C.DataValueFactory.MakeFilterDataValue(N.min),F=C.DataValueFactory.MakeFilterDataValue(N.max);return new T.RangeDomain(R,F,V)},W.prototype.convertAnchorDate=function(N){var V=N.getUTCFullYear(),R=N.getUTCMonth()+1,F=N.getUTCDate(),H=N.getUTCHours(),J=N.getUTCMinutes(),te=N.getUTCSeconds();if(isNaN(V)||isNaN(R)||isNaN(F)||isNaN(H)||isNaN(J)||isNaN(te))throw new _.TableauError(a.EmbeddingErrorCodes.InvalidDateParameter,"Invalid date parameter: anchorDate");var se=V+"-"+R+"-"+F+" "+H+":"+J+":"+te;return se},W.prototype.apiFilterHandlerCheckForCommandError=function(N){if(N[u.ParameterId.ParameterError])throw N[u.ParameterId.InvalidFieldCaption]?new _.TableauError(a.SharedErrorCodes.InvalidFilterFieldName,N[u.ParameterId.InvalidFieldCaption]):N[u.ParameterId.InvalidValues]?new _.TableauError(a.SharedErrorCodes.InvalidFilterFieldValue,N[u.ParameterId.InvalidValues]):N[u.ParameterId.InvalidAggFieldName]?new _.TableauError(a.SharedErrorCodes.InvalidAggregationFieldName,N[u.ParameterId.InvalidAggFieldName]):new _.TableauError(a.SharedErrorCodes.ServerError,"Server Error")},W}(z.ServiceImplBase);return my.FilterServiceImpl=$,my}var gy={},yy,JK=new Uint8Array(16);function TO(){if(!yy&&(yy=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!yy))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return yy(JK)}const eX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Dv(t){return typeof t=="string"&&eX.test(t)}var wi=[];for(var Wb=0;Wb<256;++Wb)wi.push((Wb+256).toString(16).substr(1));function Mv(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(wi[t[e+0]]+wi[t[e+1]]+wi[t[e+2]]+wi[t[e+3]]+"-"+wi[t[e+4]]+wi[t[e+5]]+"-"+wi[t[e+6]]+wi[t[e+7]]+"-"+wi[t[e+8]]+wi[t[e+9]]+"-"+wi[t[e+10]]+wi[t[e+11]]+wi[t[e+12]]+wi[t[e+13]]+wi[t[e+14]]+wi[t[e+15]]).toLowerCase();if(!Dv(n))throw TypeError("Stringified UUID is invalid");return n}var SD,Gb,Hb=0,qb=0;function tX(t,e,n){var a=e&&n||0,u=e||new Array(16);t=t||{};var d=t.node||SD,_=t.clockseq!==void 0?t.clockseq:Gb;if(d==null||_==null){var l=t.random||(t.rng||TO)();d==null&&(d=SD=[l[0]|1,l[1],l[2],l[3],l[4],l[5]]),_==null&&(_=Gb=(l[6]<<8|l[7])&16383)}var w=t.msecs!==void 0?t.msecs:Date.now(),T=t.nsecs!==void 0?t.nsecs:qb+1,C=w-Hb+(T-qb)/1e4;if(C<0&&t.clockseq===void 0&&(_=_+1&16383),(C<0||w>Hb)&&t.nsecs===void 0&&(T=0),T>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Hb=w,qb=T,Gb=_,w+=122192928e5;var P=((w&268435455)*1e4+T)%4294967296;u[a++]=P>>>24&255,u[a++]=P>>>16&255,u[a++]=P>>>8&255,u[a++]=P&255;var z=w/4294967296*1e4&268435455;u[a++]=z>>>8&255,u[a++]=z&255,u[a++]=z>>>24&15|16,u[a++]=z>>>16&255,u[a++]=_>>>8|128,u[a++]=_&255;for(var $=0;$<6;++$)u[a+$]=d[$];return e||Mv(u)}function AO(t){if(!Dv(t))throw TypeError("Invalid UUID");var e,n=new Uint8Array(16);return n[0]=(e=parseInt(t.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=e&255,n[4]=(e=parseInt(t.slice(9,13),16))>>>8,n[5]=e&255,n[6]=(e=parseInt(t.slice(14,18),16))>>>8,n[7]=e&255,n[8]=(e=parseInt(t.slice(19,23),16))>>>8,n[9]=e&255,n[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=e&255,n}function rX(t){t=unescape(encodeURIComponent(t));for(var e=[],n=0;n<t.length;++n)e.push(t.charCodeAt(n));return e}var nX="6ba7b810-9dad-11d1-80b4-00c04fd430c8",iX="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function IO(t,e,n){function a(u,d,_,l){if(typeof u=="string"&&(u=rX(u)),typeof d=="string"&&(d=AO(d)),d.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var w=new Uint8Array(16+u.length);if(w.set(d),w.set(u,d.length),w=n(w),w[6]=w[6]&15|e,w[8]=w[8]&63|128,_){l=l||0;for(var T=0;T<16;++T)_[l+T]=w[T];return _}return Mv(w)}try{a.name=t}catch{}return a.DNS=nX,a.URL=iX,a}function oX(t){if(typeof t=="string"){var e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(var n=0;n<e.length;++n)t[n]=e.charCodeAt(n)}return aX(sX(lX(t),t.length*8))}function aX(t){for(var e=[],n=t.length*32,a="0123456789abcdef",u=0;u<n;u+=8){var d=t[u>>5]>>>u%32&255,_=parseInt(a.charAt(d>>>4&15)+a.charAt(d&15),16);e.push(_)}return e}function CO(t){return(t+64>>>9<<4)+14+1}function sX(t,e){t[e>>5]|=128<<e%32,t[CO(e)-1]=e;for(var n=1732584193,a=-271733879,u=-1732584194,d=271733878,_=0;_<t.length;_+=16){var l=n,w=a,T=u,C=d;n=Bi(n,a,u,d,t[_],7,-680876936),d=Bi(d,n,a,u,t[_+1],12,-389564586),u=Bi(u,d,n,a,t[_+2],17,606105819),a=Bi(a,u,d,n,t[_+3],22,-1044525330),n=Bi(n,a,u,d,t[_+4],7,-176418897),d=Bi(d,n,a,u,t[_+5],12,1200080426),u=Bi(u,d,n,a,t[_+6],17,-1473231341),a=Bi(a,u,d,n,t[_+7],22,-45705983),n=Bi(n,a,u,d,t[_+8],7,1770035416),d=Bi(d,n,a,u,t[_+9],12,-1958414417),u=Bi(u,d,n,a,t[_+10],17,-42063),a=Bi(a,u,d,n,t[_+11],22,-1990404162),n=Bi(n,a,u,d,t[_+12],7,1804603682),d=Bi(d,n,a,u,t[_+13],12,-40341101),u=Bi(u,d,n,a,t[_+14],17,-1502002290),a=Bi(a,u,d,n,t[_+15],22,1236535329),n=Ni(n,a,u,d,t[_+1],5,-165796510),d=Ni(d,n,a,u,t[_+6],9,-1069501632),u=Ni(u,d,n,a,t[_+11],14,643717713),a=Ni(a,u,d,n,t[_],20,-373897302),n=Ni(n,a,u,d,t[_+5],5,-701558691),d=Ni(d,n,a,u,t[_+10],9,38016083),u=Ni(u,d,n,a,t[_+15],14,-660478335),a=Ni(a,u,d,n,t[_+4],20,-405537848),n=Ni(n,a,u,d,t[_+9],5,568446438),d=Ni(d,n,a,u,t[_+14],9,-1019803690),u=Ni(u,d,n,a,t[_+3],14,-187363961),a=Ni(a,u,d,n,t[_+8],20,1163531501),n=Ni(n,a,u,d,t[_+13],5,-1444681467),d=Ni(d,n,a,u,t[_+2],9,-51403784),u=Ni(u,d,n,a,t[_+7],14,1735328473),a=Ni(a,u,d,n,t[_+12],20,-1926607734),n=Ui(n,a,u,d,t[_+5],4,-378558),d=Ui(d,n,a,u,t[_+8],11,-2022574463),u=Ui(u,d,n,a,t[_+11],16,1839030562),a=Ui(a,u,d,n,t[_+14],23,-35309556),n=Ui(n,a,u,d,t[_+1],4,-1530992060),d=Ui(d,n,a,u,t[_+4],11,1272893353),u=Ui(u,d,n,a,t[_+7],16,-155497632),a=Ui(a,u,d,n,t[_+10],23,-1094730640),n=Ui(n,a,u,d,t[_+13],4,681279174),d=Ui(d,n,a,u,t[_],11,-358537222),u=Ui(u,d,n,a,t[_+3],16,-722521979),a=Ui(a,u,d,n,t[_+6],23,76029189),n=Ui(n,a,u,d,t[_+9],4,-640364487),d=Ui(d,n,a,u,t[_+12],11,-421815835),u=Ui(u,d,n,a,t[_+15],16,530742520),a=Ui(a,u,d,n,t[_+2],23,-995338651),n=ji(n,a,u,d,t[_],6,-198630844),d=ji(d,n,a,u,t[_+7],10,1126891415),u=ji(u,d,n,a,t[_+14],15,-1416354905),a=ji(a,u,d,n,t[_+5],21,-57434055),n=ji(n,a,u,d,t[_+12],6,1700485571),d=ji(d,n,a,u,t[_+3],10,-1894986606),u=ji(u,d,n,a,t[_+10],15,-1051523),a=ji(a,u,d,n,t[_+1],21,-2054922799),n=ji(n,a,u,d,t[_+8],6,1873313359),d=ji(d,n,a,u,t[_+15],10,-30611744),u=ji(u,d,n,a,t[_+6],15,-1560198380),a=ji(a,u,d,n,t[_+13],21,1309151649),n=ji(n,a,u,d,t[_+4],6,-145523070),d=ji(d,n,a,u,t[_+11],10,-1120210379),u=ji(u,d,n,a,t[_+2],15,718787259),a=ji(a,u,d,n,t[_+9],21,-343485551),n=ac(n,l),a=ac(a,w),u=ac(u,T),d=ac(d,C)}return[n,a,u,d]}function lX(t){if(t.length===0)return[];for(var e=t.length*8,n=new Uint32Array(CO(e)),a=0;a<e;a+=8)n[a>>5]|=(t[a/8]&255)<<a%32;return n}function ac(t,e){var n=(t&65535)+(e&65535),a=(t>>16)+(e>>16)+(n>>16);return a<<16|n&65535}function cX(t,e){return t<<e|t>>>32-e}function zv(t,e,n,a,u,d){return ac(cX(ac(ac(e,t),ac(a,d)),u),n)}function Bi(t,e,n,a,u,d,_){return zv(e&n|~e&a,t,e,u,d,_)}function Ni(t,e,n,a,u,d,_){return zv(e&a|n&~a,t,e,u,d,_)}function Ui(t,e,n,a,u,d,_){return zv(e^n^a,t,e,u,d,_)}function ji(t,e,n,a,u,d,_){return zv(n^(e|~a),t,e,u,d,_)}var uX=IO("v3",48,oX);const hX=uX;function dX(t,e,n){t=t||{};var a=t.random||(t.rng||TO)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,e){n=n||0;for(var u=0;u<16;++u)e[n+u]=a[u];return e}return Mv(a)}function pX(t,e,n,a){switch(t){case 0:return e&n^~e&a;case 1:return e^n^a;case 2:return e&n^e&a^n&a;case 3:return e^n^a}}function Zb(t,e){return t<<e|t>>>32-e}function fX(t){var e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){var a=unescape(encodeURIComponent(t));t=[];for(var u=0;u<a.length;++u)t.push(a.charCodeAt(u))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var d=t.length/4+2,_=Math.ceil(d/16),l=new Array(_),w=0;w<_;++w){for(var T=new Uint32Array(16),C=0;C<16;++C)T[C]=t[w*64+C*4]<<24|t[w*64+C*4+1]<<16|t[w*64+C*4+2]<<8|t[w*64+C*4+3];l[w]=T}l[_-1][14]=(t.length-1)*8/Math.pow(2,32),l[_-1][14]=Math.floor(l[_-1][14]),l[_-1][15]=(t.length-1)*8&4294967295;for(var P=0;P<_;++P){for(var z=new Uint32Array(80),$=0;$<16;++$)z[$]=l[P][$];for(var U=16;U<80;++U)z[U]=Zb(z[U-3]^z[U-8]^z[U-14]^z[U-16],1);for(var W=n[0],N=n[1],V=n[2],R=n[3],F=n[4],H=0;H<80;++H){var J=Math.floor(H/20),te=Zb(W,5)+pX(J,N,V,R)+F+e[J]+z[H]>>>0;F=R,R=V,V=Zb(N,30)>>>0,N=W,W=te}n[0]=n[0]+W>>>0,n[1]=n[1]+N>>>0,n[2]=n[2]+V>>>0,n[3]=n[3]+R>>>0,n[4]=n[4]+F>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,n[0]&255,n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,n[1]&255,n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,n[2]&255,n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,n[3]&255,n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,n[4]&255]}var mX=IO("v5",80,fX);const gX=mX,yX="00000000-0000-0000-0000-000000000000";function _X(t){if(!Dv(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)}const vX=Object.freeze(Object.defineProperty({__proto__:null,NIL:yX,parse:AO,stringify:Mv,v1:tX,v3:hX,v4:dX,v5:gX,validate:Dv,version:_X},Symbol.toStringTag,{value:"Module"})),xX=$M(vX);var XT={},bX=$e&&$e.__awaiter||function(t,e,n,a){function u(d){return d instanceof n?d:new n(function(_){_(d)})}return new(n||(n=Promise))(function(d,_){function l(C){try{T(a.next(C))}catch(P){_(P)}}function w(C){try{T(a.throw(C))}catch(P){_(P)}}function T(C){C.done?d(C.value):u(C.value).then(l,w)}T((a=a.apply(t,e||[])).next())})},wX=$e&&$e.__generator||function(t,e){var n={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},a,u,d,_;return _={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function l(T){return function(C){return w([T,C])}}function w(T){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,u&&(d=T[0]&2?u.return:T[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,T[1])).done)return d;switch(u=0,d&&(T=[T[0]&2,d.value]),T[0]){case 0:case 1:d=T;break;case 4:return n.label++,{value:T[1],done:!1};case 5:n.label++,u=T[1],T=[0];continue;case 7:T=n.ops.pop(),n.trys.pop();continue;default:if(d=n.trys,!(d=d.length>0&&d[d.length-1])&&(T[0]===6||T[0]===2)){n=0;continue}if(T[0]===3&&(!d||T[1]>d[0]&&T[1]<d[3])){n.label=T[1];break}if(T[0]===6&&n.label<d[1]){n.label=d[1],d=T;break}if(d&&n.label<d[2]){n.label=d[2],n.ops.push(T);break}d[2]&&n.ops.pop(),n.trys.pop();continue}T=e.call(t,n)}catch(C){T=[6,C],u=0}finally{a=d=0}if(T[0]&5)throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}};Object.defineProperty(XT,"__esModule",{value:!0});var TD=pa,EX=$o(),SX=function(){function t(e,n,a,u){this._id=e,this._totalRowCount=n,this._pageRowCount=a,this._registryId=u,this._pageCount=Math.ceil(n/a)}return Object.defineProperty(t.prototype,"totalRowCount",{get:function(){return this._totalRowCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageCount",{get:function(){return this._pageCount},enumerable:!0,configurable:!0}),t.prototype.getPageAsync=function(e){EX.ErrorHelpers.verifyRange(e,0,this._pageCount);var n=TD.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return n.getPageAsync(this._id,e,this._pageRowCount)},t.prototype.getAllPagesAsync=function(e){return bX(this,void 0,void 0,function(){var n,a,u,d,_,l,w,T,C,P;return wX(this,function(z){switch(z.label){case 0:return[4,this.getPageAsync(0)];case 1:n=z.sent(),e=e||this.totalRowCount,a=Math.min(e,this.totalRowCount),u=Math.ceil(a/this._pageRowCount),d=Math.min(u,400),_=d<u,l=[],w=1,z.label=2;case 2:return w<d?[4,this.getPageAsync(w)]:[3,5];case 3:T=z.sent(),l.push(T.data),z.label=4;case 4:return w++,[3,2];case 5:return C=(P=n.data).concat.apply(P,l),C.length=a,[2,{name:n.name,data:C,columns:n.columns,totalRowCount:_?d*this._pageRowCount:a,isTotalRowCountLimited:_,isSummaryData:n.isSummaryData}]}})})},t.prototype.releaseAsync=function(){var e=TD.ApiServiceRegistry.get(this._registryId).getService("get-data-service");return e.releaseAsync(this._id)},t}();XT.DataTableReader=SX;var AD;function TX(){if(AD)return gy;AD=1;var t=$e&&$e.__extends||function(){var z=function($,U){return z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,N){W.__proto__=N}||function(W,N){for(var V in N)N.hasOwnProperty(V)&&(W[V]=N[V])},z($,U)};return function($,U){z($,U);function W(){this.constructor=$}$.prototype=U===null?Object.create(U):(W.prototype=U.prototype,new W)}}();Object.defineProperty(gy,"__esModule",{value:!0});var e=Nt,n=hr(),a=xX,u=sn(),d=Sc,_=Nu,l=XT,w=Km,T=RT,C=ai,P=function(z){t($,z);function $(){var U=z!==null&&z.apply(this,arguments)||this;return U.viewDataTableCacheId=a.v4(),U}return Object.defineProperty($.prototype,"serviceName",{get:function(){return"get-data-service"},enumerable:!0,configurable:!0}),$.prototype.getMaxRowLimit=function(){return 1e4},$.prototype.getViewDataTableCacheId=function(){return this.viewDataTableCacheId},$.prototype.getLimitedMaxRows=function(U,W){return U>0&&U<W?U:W},$.prototype.getUnderlyingDataAsync=function(U,W,N,V,R,F,H,J){var te,se=this,ge=W===T.GetDataType.Summary,xe=ge?"getSummaryDataAsync":"getUnderlyingDataAsync",Ee=ge?n.VerbId.GetDataSummaryData:n.VerbId.GetUnderlyingData,Be=Ee===n.VerbId.GetUnderlyingData?this.getLimitedMaxRows(H,this.getMaxRowLimit()+1):H,Fe=(te={},te[n.ParameterId.FunctionName]=xe,te);return Fe[n.ParameterId.VisualId]=U,Fe[n.ParameterId.IgnoreAliases]=N,Fe[n.ParameterId.IgnoreSelection]=V,Fe[n.ParameterId.IncludeAllColumns]=R,Fe[n.ParameterId.ColumnsToIncludeById]=this.verifyIncludeColumnArray(F),Fe[n.ParameterId.MaxRows]=Be,Fe[n.ParameterId.ShowDataTableFormat]=d.ExternalToInternalEnumMappings.showDataTableFormatType.convert(J),this.execute(Ee,Fe).then(function(Ve){var Ct=Ve.result;return se.processResultsTable(Ct.data,Ct.isSummary)})},$.prototype.getSummaryDataReaderAsync=function(U,W,N,V,R,F,H){var J,te=this,se=(J={},J[n.ParameterId.FunctionName]="getSummaryDataReaderAsync",J[n.ParameterId.ViewDataTableCacheId]=this.getViewDataTableCacheId(),J[n.ParameterId.VisualId]=U,J[n.ParameterId.PageRowCount]=W,J[n.ParameterId.IgnoreAliases]=N,J[n.ParameterId.IgnoreSelection]=V,J[n.ParameterId.IncludeAllColumns]=R,J[n.ParameterId.ColumnsToIncludeById]=this.verifyIncludeColumnArray(F),J[n.ParameterId.ShowDataTableFormat]=d.ExternalToInternalEnumMappings.showDataTableFormatType.convert(H),J);return this.execute(n.VerbId.GetDataSummaryDataReader,se).then(function(ge){var xe=ge.result;return new l.DataTableReader(xe.id,xe.totalRowCount,W,te._registryId)})},$.prototype.getSummaryColumnsInfoAsync=function(U){var W,N=n.VerbId.GetDataSummaryData,V=(W={},W[n.ParameterId.FunctionName]="getSummaryColumnsInfoAsync",W[n.ParameterId.VisualId]=U,W[n.ParameterId.IgnoreAliases]=!0,W[n.ParameterId.IgnoreSelection]=!0,W[n.ParameterId.IncludeAllColumns]=!0,W[n.ParameterId.MaxRows]=1,W[n.ParameterId.ShowDataTableFormat]=n.ApiShowDataTableFormat.NativeValuesOnly,W);return this.execute(N,V).then(function(R){var F=R.result,H=F.data,J=H.headers.map(function(te){return new _.Column(te.fieldCaption,te.fieldName,te.dataType,te.isReferenced,te.index)});return J})},$.prototype.getSelectedMarksAsync=function(U){var W,N=this,V=(W={},W[n.ParameterId.FunctionName]="getSelectedMarksAsync",W[n.ParameterId.VisualId]=U,W);return this.execute(n.VerbId.GetSelectedMarks,V).then(function(R){var F=R.result;return{data:F.data.map(function(H){return N.processResultsTable(H,!0)})}})},$.prototype.getHighlightedMarksAsync=function(U){var W,N=this,V=(W={},W[n.ParameterId.FunctionName]="getHighlightedMarksAsync",W[n.ParameterId.VisualId]=U,W);return this.execute(n.VerbId.GetHighlightedMarks,V).then(function(R){var F=R.result;return{data:F.data.map(function(H){return N.processResultsTable(H,!0)})}})},$.prototype.getDataSourceDataAsync=function(U,W,N,V,R,F){var H,J=this,te=(H={},H[n.ParameterId.FunctionName]="getDataSourceDataAsync",H[n.ParameterId.DataSourceId]=U,H[n.ParameterId.IgnoreAliases]=W,H[n.ParameterId.MaxRows]=this.getLimitedMaxRows(N,this.getMaxRowLimit()+1),H[n.ParameterId.ColumnsToInclude]=this.verifyIncludeColumnArray(V),H[n.ParameterId.ColumnsToIncludeById]=this.verifyIncludeColumnArray(R),H[n.ParameterId.ShowDataTableFormat]=d.ExternalToInternalEnumMappings.showDataTableFormatType.convert(F),H);return this.execute(n.VerbId.GetDataSourceData,te).then(function(se){var ge=se.result;return J.processResultsTable(ge.data,!1)})},$.prototype.getLogicalTableDataAsync=function(U,W,N,V,R,F,H){var J,te=this,se=(J={},J[n.ParameterId.FunctionName]="getLogicalTableDataAsync",J[n.ParameterId.ColumnsToInclude]=R,J[n.ParameterId.ColumnsToIncludeById]=this.verifyIncludeColumnArray(F),J[n.ParameterId.DataSourceId]=U,J[n.ParameterId.IgnoreAliases]=N,J[n.ParameterId.LogicalTableId]=W,J[n.ParameterId.MaxRows]=this.getLimitedMaxRows(V,this.getMaxRowLimit()+1),J[n.ParameterId.ShowDataTableFormat]=d.ExternalToInternalEnumMappings.showDataTableFormatType.convert(H),J);return this.execute(n.VerbId.GetLogicalTableData,se).then(function(ge){var xe=ge.result;return te.processResultsTable(xe.data,!1)})},$.prototype.getLogicalTableDataReaderAsync=function(U,W,N,V,R,F){var H,J=this;N=this.getLimitedMaxRows(N,this.getMaxRowLimit());var te=(H={},H[n.ParameterId.FunctionName]="getLogicalTableDataReaderAsync",H[n.ParameterId.ViewDataTableCacheId]=this.getViewDataTableCacheId(),H[n.ParameterId.DataSourceId]=U,H[n.ParameterId.LogicalTableId]=W,H[n.ParameterId.PageRowCount]=N,H[n.ParameterId.IgnoreAliases]=V,H[n.ParameterId.ColumnsToIncludeById]=this.verifyIncludeColumnArray(R),H[n.ParameterId.ShowDataTableFormat]=d.ExternalToInternalEnumMappings.showDataTableFormatType.convert(F),H);return this.execute(n.VerbId.GetLogicalTableDataReader,te).then(function(se){var ge=se.result;return new l.DataTableReader(ge.id,ge.totalRowCount,N,J._registryId)})},$.prototype.getUnderlyingTableDataAsync=function(U,W,N,V,R,F,H,J){var te,se=this,ge=(te={},te[n.ParameterId.FunctionName]="getUnderlyingTableDataAsync",te[n.ParameterId.VisualId]=U,te[n.ParameterId.LogicalTableId]=W,te[n.ParameterId.IgnoreAliases]=N,te[n.ParameterId.IgnoreSelection]=V,te[n.ParameterId.IncludeAllColumns]=R,te[n.ParameterId.ColumnsToIncludeById]=this.verifyIncludeColumnArray(F),te[n.ParameterId.MaxRows]=this.getLimitedMaxRows(H,this.getMaxRowLimit()+1),te[n.ParameterId.ShowDataTableFormat]=d.ExternalToInternalEnumMappings.showDataTableFormatType.convert(J),te);return this.execute(n.VerbId.GetUnderlyingTableData,ge).then(function(xe){var Ee=xe.result;return se.processResultsTable(Ee.data,!1)})},$.prototype.getUnderlyingTableDataReaderAsync=function(U,W,N,V,R,F,H,J){var te,se=this;N=this.getLimitedMaxRows(N,this.getMaxRowLimit());var ge=(te={},te[n.ParameterId.FunctionName]="getUnderlyingTableDataReaderAsync",te[n.ParameterId.ViewDataTableCacheId]=this.getViewDataTableCacheId(),te[n.ParameterId.VisualId]=U,te[n.ParameterId.LogicalTableId]=W,te[n.ParameterId.IgnoreAliases]=V,te[n.ParameterId.IgnoreSelection]=R,te[n.ParameterId.IncludeAllColumns]=F,te[n.ParameterId.ColumnsToIncludeById]=this.verifyIncludeColumnArray(H),te[n.ParameterId.ShowDataTableFormat]=d.ExternalToInternalEnumMappings.showDataTableFormatType.convert(J),te[n.ParameterId.PageRowCount]=N,te);return this.execute(n.VerbId.GetUnderlyingTableDataReader,ge).then(function(xe){var Ee=xe.result;return new l.DataTableReader(Ee.id,Ee.totalRowCount,N,se._registryId)})},$.prototype.getPageAsync=function(U,W,N){var V,R=this,F=(V={},V[n.ParameterId.FunctionName]="getPageAsync",V[n.ParameterId.ViewDataTableCacheId]=this.getViewDataTableCacheId(),V[n.ParameterId.ViewDataTableId]=U,V[n.ParameterId.DataRowIndex]=W*N,V);return this.execute(n.VerbId.GetDataTableReaderPage,F).then(function(H){var J=H.result;return R.processResultsPage(J,U===$.summaryTableId)})},$.prototype.releaseAsync=function(U){var W,N=(W={},W[n.ParameterId.FunctionName]="release",W[n.ParameterId.ViewDataTableCacheId]=this.getViewDataTableCacheId(),W[n.ParameterId.ViewDataTableId]=U,W);return this.execute(n.VerbId.ReleaseDataTableReader,N).then(function(V){})},$.prototype.verifyIncludeColumnArray=function(U){if(!Array.isArray(U))throw new u.TableauError(e.ErrorCodes.InvalidParameter,"columnsToInclude and columnsToIncludeById must be valid arrays");var W=new Set(U);return Array.from(W)},$.prototype.processResultsTable=function(U,W){var N=U.headers.map(function(H){return new _.Column(H.fieldCaption,H.fieldName,H.dataType,H.isReferenced,H.index)}),V;U.marks&&(V=U.marks.map(function(H){return new _.MarkInfo(H.type,H.color,H.tupleId)}));var R=W===!1&&U.dataTable.length===this.getMaxRowLimit()+1;R&&(U.dataTable.length-=1);var F=U.dataTable.map(function(H){return H.map(function(J,te){return w.DataValueFactory.MakeTableDataValue(J,N[te].dataType)})});return V?new _.DataTable(F,N,F.length,R,W,V):new _.DataTable(F,N,F.length,R,W)},$.prototype.processResultsPage=function(U,W){var N=U.headers.map(function(F){return new _.Column(F.fieldCaption,F.fieldName,F.dataType,F.isReferenced,F.index)}),V;U.marks&&(V=U.marks.map(function(F){return new _.MarkInfo(F.type,F.color,F.tupleId)}));var R=U.dataTable.map(function(F){return F.map(function(H,J){return w.DataValueFactory.MakeTableDataValue(H,N[J].dataType)})});return V?new _.DataTable(R,N,R.length,!1,W,V):new _.DataTable(R,N,R.length,!1,W)},$.summaryTableId="",$}(C.ServiceImplBase);return gy.GetDataServiceImpl=P,gy}var Rv={},Qm={};Object.defineProperty(Qm,"__esModule",{value:!0});var kO=function(){function t(e,n){this._filterFn=e,this._callbackFn=n}return t.prototype.onNotification=function(e){this._filterFn(e)&&this._callbackFn(e)},t}();Qm.Registration=kO;var AX=function(){function t(e){this.dispatcher=e,this._handlers={},this.dispatcher.registerNotificationHandler(this.onNotification.bind(this))}return t.prototype.registerHandler=function(e,n,a){var u=this,d=this._handlers[e]||new Array,_=new kO(n,a);return d.push(_),this._handlers[e]=d,function(){return u.removeRegistration(e,_)}},t.prototype.hasHandlersForNotificationType=function(e){return this._handlers.hasOwnProperty(e)},t.prototype.onNotification=function(e){this.hasHandlersForNotificationType(e.notificationId)&&this._handlers[e.notificationId].forEach(function(n){return n.onNotification(e.data)})},t.prototype.removeRegistration=function(e,n){this.hasHandlersForNotificationType(e)&&(this._handlers[e]=this._handlers[e].filter(function(a){return a!==n}))},t}();Qm.NotificationServiceImplBase=AX;var IX=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(Rv,"__esModule",{value:!0});var CX=Qm,kX=function(t){IX(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"notification-service"},enumerable:!0,configurable:!0}),e}(CX.NotificationServiceImplBase);Rv.NotificationServiceImpl=kX;var YT={},PX=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(YT,"__esModule",{value:!0});var DX=Nt,aa=hr(),ID=Tv,MX=Mn,zX=ai,RX=function(t){PX(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"parameters-service"},enumerable:!0,configurable:!0}),e.prototype.getParametersForSheetAsync=function(n){var a,u=(a={},a[aa.ParameterId.FunctionName]="getParametersForSheetAsync",a[aa.ParameterId.SheetPath]=n,a);return this.getParametersAsync(u)},e.prototype.getAllParametersAsync=function(){var n,a=(n={},n[aa.ParameterId.FunctionName]="getParametersForSheetAsync",n);return this.getParametersAsync(a)},e.prototype.getParametersAsync=function(n){var a=this;return this.execute(aa.VerbId.GetParametersForSheet,n).then(function(u){var d=u.result;return d.map(function(_){return new ID.ParameterImpl(_,a._registryId)})})},e.prototype.changeParameterValueAsync=function(n,a){var u,d=(u={},u[aa.ParameterId.FunctionName]="changeParameterValueAsync",u[aa.ParameterId.ParameterFieldName]=n,u[aa.ParameterId.ParameterValue]=a,u);return this.execute(aa.VerbId.ChangeParameterValue,d).then(function(_){var l=_.result;return l})},e.prototype.findParameterByNameAsync=function(n){return this.findParameterAsync(n,void 0)},e.prototype.findParameterByGlobalFieldNameAsync=function(n){return this.findParameterAsync(void 0,n)},e.prototype.findParameterAsync=function(n,a){var u,d=this,_=(u={},u[aa.ParameterId.FunctionName]="findParameterAsync",u);if(n!==void 0)_[aa.ParameterId.ParameterCaption]=n;else if(a!==void 0)_[aa.ParameterId.ParameterFieldName]=a;else throw new MX.TableauError(DX.ErrorCodes.InvalidParameter,"name or fieldName must be provided to find parameter");return this.execute(aa.VerbId.FindParameter,_).then(function(l){var w=function(C){return"fieldName"in C};if(w(l.result)){var T=l.result;return new ID.ParameterImpl(T,d._registryId)}else return})},e}(zX.ServiceImplBase);YT.ParametersServiceImpl=RX;var QT={},OX=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(QT,"__esModule",{value:!0});var Ro=Nt,Sr=hr(),yu=fa,_u=Mn,_y=$d(),FX=ai,LX=function(t){OX(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"selection-service"},enumerable:!0,configurable:!0}),e.prototype.clearSelectedMarksAsync=function(n){var a,u=(a={},a[Sr.ParameterId.FunctionName]="clearSelectedMarksAsync",a[Sr.ParameterId.VisualId]=n,a);return this.execute(Sr.VerbId.ClearSelectedMarks,u).then(function(d){})},e.prototype.selectMarksByValueAsync=function(n,a,u){var d,_=this;if(a.length===0)throw new _u.TableauError(Ro.ErrorCodes.InvalidParameter,"Selection criteria missing for selecting marks by value");var l=this.validateSelectionUpdateType(u),w=this.parseSelectionMarks(a),T=(d={},d[Sr.ParameterId.FunctionName]="selectMarksByValueAsync",d[Sr.ParameterId.VisualId]=n,d[Sr.ParameterId.SelectionUpdateType]=l,d);return w.hierModelArr&&w.hierModelArr.length&&(T[Sr.ParameterId.HierValSelectionModels]=w.hierModelArr),w.quantModelArr&&w.quantModelArr.length&&(T[Sr.ParameterId.QuantRangeSelectionModels]=w.quantModelArr),w.dimModelArr&&w.dimModelArr.length&&(T[Sr.ParameterId.DimValSelectionModels]=w.dimModelArr),this.execute(Sr.VerbId.SelectByValue,T).then(function(C){_.apiFilterHandlerCheckForCommandError(C.result)})},e.prototype.hoverTupleAsync=function(n,a,u,d){var _,l=new yu.HoverTupleInteractionModel(n,this.ensureTupleIDIsNonNegative(a),u,d),w=(_={},_[Sr.ParameterId.FunctionName]="hoverTupleAsync",_[Sr.ParameterId.HoverTupleInteraction]=l,_);return this.execute(Sr.VerbId.RaiseHoverTupleNotification,w).then(function(T){})},e.prototype.selectTuplesAsync=function(n,a,u,d){var _,l=new yu.SelectTuplesInteractionModel(n,a,u,d),w=(_={},_[Sr.ParameterId.FunctionName]="selectTuplesAsync",_[Sr.ParameterId.SelectTuplesInteraction]=l,_);return this.execute(Sr.VerbId.RaiseSelectTuplesNotification,w).then(function(T){})},e.prototype.apiFilterHandlerCheckForCommandError=function(n){if(n[Sr.ParameterId.ParameterError]){if(n[Sr.ParameterId.InvalidFields])throw new _u.TableauError(Ro.SharedErrorCodes.InvalidSelectionFieldName,n[Sr.ParameterId.InvalidFields]);if(n[Sr.ParameterId.InvalidValues])throw new _u.TableauError(Ro.SharedErrorCodes.InvalidSelectionValue,n[Sr.ParameterId.InvalidValues]);if(n[Sr.ParameterId.InvalidDates])throw new _u.TableauError(Ro.SharedErrorCodes.InvalidSelectionDate,n[Sr.ParameterId.InvalidDates])}},e.prototype.selectMarksByIdAsync=function(n,a,u){var d;if(a.length===0)throw new _u.TableauError(Ro.ErrorCodes.InvalidParameter,"Marks info missing for selecting marks by Id");var _=this.validateSelectionUpdateType(u),l=this.parseSelectionIds(a),w=(d={},d[Sr.ParameterId.FunctionName]="selectMarksByIdAsync",d[Sr.ParameterId.VisualId]=n,d[Sr.ParameterId.SelectionUpdateType]=_,d[Sr.ParameterId.Selection]=l.selection,d);return this.execute(Sr.VerbId.SelectByValue,w).then(function(T){})},e.prototype.parseSelectionIds=function(n){for(var a=[],u=new yu.SelectionModelsContainer,d=0;d<n.length;d++){var _=n[d].tupleId;if(_!=null)a.push(_.toString());else throw new _u.TableauError(Ro.ErrorCodes.InternalError,"tupleId parsing error")}if(a.length!==0){var l=new yu.TupleSelectionModel;l.selectionType="tuples",l.objectIds=a,u.selection=l}return u},e.prototype.parseSelectionMarks=function(n){for(var a=new yu.SelectionModelsContainer,u=0;u<n.length;u++){var d=n[u];if(!(d.fieldName&&d.value!==void 0&&d.value!==null))throw new _u.TableauError(Ro.ErrorCodes.InternalError,"Selection Criteria parsing error");var _=new RegExp("([[A-Za-z0-9]+]).*","g"),l=d.value;if(_.test(d.fieldName)){var w=this.addToParamsList(d.fieldName,d.value);a.hierModelArr.push(w)}else if(l.min!==void 0&&l.max!==void 0){var T=this.addToRangeParamsList(d.fieldName,l);a.quantModelArr.push(T)}else{var C=this.addToParamsList(d.fieldName,d.value);a.dimModelArr.push(C)}}return a},e.prototype.addToParamsList=function(n,a){var u=new yu.ValueSelectionModel,d=[];if(a instanceof Array)for(var _=a,l=0;l<_.length;l++)d.push(_y.Param.serializeParameterValue(_[l]));else d.push(_y.Param.serializeParameterValue(a));return u.qualifiedFieldCaption=n,u.selectValues=d,u},e.prototype.addToRangeParamsList=function(n,a){var u=new yu.RangeSelectionModel;return u.qualifiedFieldCaption=n,a.max!==void 0&&a.max!==null&&(u.maxValue=_y.Param.serializeParameterValue(a.max)),a.min!==void 0&&a.min!==null&&(u.minValue=_y.Param.serializeParameterValue(a.min)),u.included=this.validateNullOptionType(a.nullOption),u},e.prototype.validateSelectionUpdateType=function(n){return n===Ro.SelectionUpdateType.Replace?Sr.SelectionUpdateType.Replace:n===Ro.SelectionUpdateType.Add?Sr.SelectionUpdateType.Add:n===Ro.SelectionUpdateType.Remove?Sr.SelectionUpdateType.Remove:Sr.SelectionUpdateType.Replace},e.prototype.validateNullOptionType=function(n){if(n){if(n===Ro.FilterNullOption.NullValues)return Sr.QuantitativeIncludedValues.IncludeNull;if(n===Ro.FilterNullOption.NonNullValues)return Sr.QuantitativeIncludedValues.IncludeNonNull;if(n===Ro.FilterNullOption.AllValues)return Sr.QuantitativeIncludedValues.IncludeAll}return Sr.QuantitativeIncludedValues.IncludeAll},e.prototype.ensureTupleIDIsNonNegative=function(n){return n&&n>0?n:0},e}(FX.ServiceImplBase);QT.SelectionServiceImpl=LX;var Ov={},BX=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(Ov,"__esModule",{value:!0});var vu=hr(),NX=ai,UX=function(t){BX(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"size-service"},enumerable:!0,configurable:!0}),e.prototype.changeSizeAsync=function(n,a){var u,d,_,l,w,T=(u={},u[vu.ParameterId.FunctionName]="changeSizeAsync",u[vu.ParameterId.SheetName]=n,u[vu.ParameterId.MinHeight]=((d=a.minSize)===null||d===void 0?void 0:d.height)||0,u[vu.ParameterId.MinWidth]=((_=a.minSize)===null||_===void 0?void 0:_.width)||0,u[vu.ParameterId.MaxHeight]=((l=a.maxSize)===null||l===void 0?void 0:l.height)||0,u[vu.ParameterId.MaxWidth]=((w=a.maxSize)===null||w===void 0?void 0:w.width)||0,u);return this.execute(vu.VerbId.SetSheetSize,T).then(function(C){})},e}(NX.ServiceImplBase);Ov.SizeServiceImpl=UX;var JT={},jX=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(JT,"__esModule",{value:!0});var Kb=hr(),VX=ai,$X=function(t){jX(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"visual-model-service"},enumerable:!0,configurable:!0}),e.prototype.getVisualSpecificationAsync=function(n){var a,u=(a={},a[Kb.ParameterId.FunctionName]="getVisualSpecificationAsync",a[Kb.ParameterId.WorksheetName]=n.worksheet,a);return this.execute(Kb.VerbId.GetVisualSpecification,u).then(function(d){var _=d.result;return _})},e}(VX.ServiceImplBase);JT.VisualModelServiceImpl=$X;var vy={},CD;function WX(){if(CD)return vy;CD=1;var t=$e&&$e.__extends||function(){var d=function(_,l){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,T){w.__proto__=T}||function(w,T){for(var C in T)T.hasOwnProperty(C)&&(w[C]=T[C])},d(_,l)};return function(_,l){d(_,l);function w(){this.constructor=_}_.prototype=l===null?Object.create(l):(w.prototype=l.prototype,new w)}}();Object.defineProperty(vy,"__esModule",{value:!0});var e=hr(),n=bO(),a=ai,u=function(d){t(_,d);function _(){return d!==null&&d.apply(this,arguments)||this}return Object.defineProperty(_.prototype,"serviceName",{get:function(){return"viz-service"},enumerable:!0,configurable:!0}),_.prototype.createVizImageAsync=function(l){var w,T=(w={},w[e.ParameterId.FunctionName]="createVizImageAsync",w[e.ParameterId.VizAPIInputJson]=JSON.stringify(l),w);return this.execute(e.VerbId.VizAPI,T).then(function(C){var P=C.result;return P})},_.prototype.activateSheetAsync=function(l){var w,T=(w={},w[e.ParameterId.FunctionName]="activateSheetAsync",w[e.ParameterId.SwitchToSheetName]=l,w);return this.execute(e.VerbId.ActivateSheet,T).then(function(){})},_.prototype.getCustomViewsAsync=function(){var l,w=this,T=(l={},l[e.ParameterId.FunctionName]="getCustomViewsAsync",l);return this.execute(e.VerbId.GetCustomViews,T).then(function(C){var P=C.result;return P.map(function(z){return new n.CustomViewImpl(z,w._registryId)})})},_.prototype.showCustomViewAsync=function(l){var w,T=this,C=(w={},w[e.ParameterId.FunctionName]="showCustomViewAsync",w[e.ParameterId.CustomViewName]=l||"",w);return this.execute(e.VerbId.ShowCustomView,C).then(function(P){var z,$=P.result;return!((z=$)===null||z===void 0)&&z.luid?new n.CustomViewImpl($,T._registryId):void 0})},_.prototype.removeCustomViewAsync=function(l){var w,T=this,C=(w={},w[e.ParameterId.FunctionName]="removeCustomViewAsync",w[e.ParameterId.CustomViewName]=l,w);return this.execute(e.VerbId.RemoveCustomView,C).then(function(P){var z=P.result;return new n.CustomViewImpl(z,T._registryId)})},_.prototype.saveCustomViewAsync=function(l){var w,T=this,C=(w={},w[e.ParameterId.FunctionName]="saveCustomViewAsync",w[e.ParameterId.CustomViewName]=l,w[e.ParameterId.CustomViewIsDefault]=!1,w);return this.execute(e.VerbId.SaveWorkbookAsCustomView,C).then(function(P){var z=P.result;return new n.CustomViewImpl(z,T._registryId)})},_.prototype.setActiveCustomViewAsDefaultAsync=function(){var l,w=(l={},l[e.ParameterId.FunctionName]="setActiveCustomViewAsDefaultAsync",l);return this.execute(e.VerbId.SetActiveCustomViewAsDefault,w).then(function(){})},_.prototype.saveAsync=function(l){var w,T=this,C=(w={},w[e.ParameterId.FunctionName]="saveAsync",w[e.ParameterId.CustomViewLuid]=l.luid,w[e.ParameterId.CustomViewName]=l.name,w[e.ParameterId.CustomViewIsDefault]=l.isDefault,w[e.ParameterId.CustomViewIsPublic]=l.shared,w);return this.execute(e.VerbId.UpdateCustomView,C).then(function(P){var z=P.result;return new n.CustomViewImpl(z,T._registryId)})},_.prototype.getCurrentSrcAsync=function(){var l,w=(l={},l[e.ParameterId.FunctionName]="getCurrentSrcAsync",l);return this.execute(e.VerbId.GetCurrentSrc,w).then(function(T){return T.result})},_}(a.ServiceImplBase);return vy.VizServiceImpl=u,vy}var eA={},GX=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(eA,"__esModule",{value:!0});var HX=Nt,Xl=hr(),qX=Sc,xy=$o(),ZX=$d(),KX=ai,XX=function(t){GX(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"zone-service"},enumerable:!0,configurable:!0}),e.prototype.setVisibilityAsync=function(n,a,u){var d,_=(d={},d[Xl.ParameterId.FunctionName]="setVisibilityAsync",d[Xl.ParameterId.Dashboard]=n,d[Xl.ParameterId.ZoneIdsVisibilityMap]={},d),l=ZX.Param.convertParameterToMap(u,"zoneVisibilityMap");return l.forEach(function(w,T){xy.ErrorHelpers.verifyZoneIsValid(a,Number.parseInt(T,10)),xy.ErrorHelpers.verifyEnumValue(w,HX.DashboardObjectVisibilityType,"DashboardObjectVisibilityType"),_[Xl.ParameterId.ZoneIdsVisibilityMap][T]=qX.ExternalToInternalEnumMappings.setVisibilityType.convert(w)}),this.execute(Xl.VerbId.SetZoneVisibility,_).then(function(w){})},e.prototype.moveAndResizeAsync=function(n,a,u){var d,_=(d={},d[Xl.ParameterId.Dashboard]=n,d[Xl.ParameterId.DashboardObjectPositionAndSizeUpdateList]=u,d);return u.forEach(function(l){xy.ErrorHelpers.verifyZoneIsValidAndFloating(a,l.dashboardObjectID),xy.ErrorHelpers.verifyWidthAndHeightOfDashboardObjectPositionAndSizeUpdate(l)}),this.execute(Xl.VerbId.MoveAndResizeZones,_).then(function(l){})},e}(KX.ServiceImplBase);eA.ZoneServiceImpl=XX;var kD;function YX(){if(kD)return py;kD=1,Object.defineProperty(py,"__esModule",{value:!0});var t=pa,e=jT,n=$T,a=WT,u=SO,d=qT,_=ZT,l=QK(),w=TX(),T=Rv,C=YT,P=QT,z=Ov,$=JT,U=WX(),W=eA;function N(V,R,F){t.ApiServiceRegistry.get(R).registerService(new n.AnimationServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new u.DataSourceServiceImpl(V,R,F)),t.ApiServiceRegistry.get(R).registerService(new d.ExportServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new w.GetDataServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new l.FilterServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new T.NotificationServiceImpl(V)),t.ApiServiceRegistry.get(R).registerService(new C.ParametersServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new P.SelectionServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new a.AnnotationServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new W.ZoneServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new z.SizeServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new $.VisualModelServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new U.VizServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new _.ExternalContextMenuServiceImpl(V,R)),t.ApiServiceRegistry.get(R).registerService(new e.AccessibilityServiceImpl(V,R))}return py.registerAllSharedServices=N,py}var tA={},QX=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(tA,"__esModule",{value:!0});var PD=hr(),JX=ai,eY=function(t){QX(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"client-info-service"},enumerable:!0,configurable:!0}),e.prototype.getClientInfoAsync=function(){var n,a=PD.VerbId.GetEmbeddingClientInfo,u=(n={},n[PD.ParameterId.FunctionName]="getClientInfoAsync",n);return this.execute(a,u).then(function(d){var _=d.result;return _})},e}(JX.ServiceImplBase);tA.ClientInfoServiceImpl=eY;var rA={},tY=$e&&$e.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])},t(e,n)};return function(e,n){t(e,n);function a(){this.constructor=e}e.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(rA,"__esModule",{value:!0});var vs=hr(),rY=ai,nY=function(t){tY(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"serviceName",{get:function(){return"story-activation-service"},enumerable:!0,configurable:!0}),e.prototype.activateNextStoryPointAsync=function(){var n,a=vs.VerbId.ActivateNextStoryPoint,u=(n={},n[vs.ParameterId.FunctionName]="activateNextStoryPointAsync",n);return this.execute(a,u).then(function(d){})},e.prototype.activatePreviousStoryPointAsync=function(){var n,a=vs.VerbId.ActivatePreviousStoryPoint,u=(n={},n[vs.ParameterId.FunctionName]="activatePreviousStoryPointAsync",n);return this.execute(a,u).then(function(d){})},e.prototype.activateStoryPointAsync=function(n){var a,u=vs.VerbId.ActivateStoryPoint,d=(a={},a[vs.ParameterId.FunctionName]="activateStoryPointAsync",a);return d[vs.ParameterId.StoryPointIndex]=n,this.execute(u,d).then(function(_){})},e.prototype.revertStoryPointAsync=function(n){var a,u=vs.VerbId.RevertStoryPoint,d=(a={},a[vs.ParameterId.FunctionName]="revertStoryPointAsync",a);return d[vs.ParameterId.StoryPointIndex]=n,this.execute(u,d).then(function(_){return _.result})},e}(rY.ServiceImplBase);rA.StoryActivationServiceImpl=nY;var nA={};Object.defineProperty(nA,"__esModule",{value:!0});var by=hr(),iY=function(){function t(e,n){var a=this;this._apiDelegateDispatcher=e,this._versionConverter=by.CreateExternalCompatibleVersionConverter(by.INTERNAL_CONTRACT_VERSION,n),this._notificationHandlers=[],e.registerNotificationHandler(function(u){if(a._notificationHandlers.length!==0){var d=a._versionConverter.upgradeNotification(u);a._notificationHandlers.forEach(function(_){_(d)})}})}return t.needsVersionConverter=function(e){return by.VersionLessThan(e,by.INTERNAL_CONTRACT_VERSION)},t.prototype.execute=function(e,n){var a=this;try{var u=this._versionConverter.downgradeExecuteCall(e,n);return this._apiDelegateDispatcher.execute(u.verb,u.parameters).then(function(d){var _=a._versionConverter.upgradeExecuteReturn(d,e,n);return _})}catch(d){return Promise.reject(d)}},t.prototype.registerNotificationHandler=function(e){this._notificationHandlers.push(e)},t.prototype.unregisterNotificationHandler=function(e){this._notificationHandlers=this._notificationHandlers.filter(function(n){return n!==e})},t}();nA.VersionedExternalApiDispatcher=iY;var DD;function sn(){return DD||(DD=1,function(t){function e(gt){for(var je in gt)t.hasOwnProperty(je)||(t[je]=gt[je])}Object.defineProperty(t,"__esModule",{value:!0});var n=fT;t.ApiVersion=n.ApiVersion,e(mT);var a=_v;t.CrossFrameDispatcher=a.CrossFrameDispatcher;var u=$m;t.DataSource=u.DataSource;var d=Sc;t.ExternalToInternalEnumMappings=d.ExternalToInternalEnumMappings;var _=fl;t.InternalToExternalEnumMappings=_.InternalToExternalEnumMappings;var l=zT;t.EventListenerManager=l.EventListenerManager;var w=Wm;t.Field=w.Field;var T=bO();t.CustomViewImpl=T.CustomViewImpl;var C=xv;t.DashboardImpl=C.DashboardImpl;var P=wv;t.DashboardObjectImpl=P.DashboardObjectImpl;var z=Zm;t.DataSourceImpl=z.DataSourceImpl;var $=Tv;t.ParameterImpl=$.ParameterImpl;var U=Wd;t.SheetImpl=U.SheetImpl;var W=Hm;t.SheetInfoImpl=W.SheetInfoImpl;var N=LT;t.SingleEventManagerImpl=N.SingleEventManagerImpl;var V=BT;t.StoryImpl=V.StoryImpl;var R=Av;t.StoryPointImpl=R.StoryPointImpl;var F=Iv;t.StoryPointInfoImpl=F.StoryPointInfoImpl;var H=UT;t.WorkbookImpl=H.WorkbookImpl;var J=qm;t.WorksheetImpl=J.WorksheetImpl;var te=bv;t.Point=te.Point,e(YX()),e(pa);var se=tA;t.ClientInfoServiceImpl=se.ClientInfoServiceImpl;var ge=Rv;t.NotificationServiceImpl=ge.NotificationServiceImpl;var xe=Qm;t.NotificationServiceImplBase=xe.NotificationServiceImplBase,t.Registration=xe.Registration;var Ee=ai;t.ServiceImplBase=Ee.ServiceImplBase;var Be=Ov;t.SizeServiceImpl=Be.SizeServiceImpl;var Fe=rA;t.StoryActivationServiceImpl=Fe.StoryActivationServiceImpl;var Ve=Mn;t.TableauError=Ve.TableauError;var Ct=Xm;t.Deferred=Ct.Deferred;var Dt=$o();t.ErrorHelpers=Dt.ErrorHelpers;var Ut=kv;t.ExportHelpers=Ut.ExportHelpers;var cr=Gm;t.SheetUtils=cr.SheetUtils;var qe=hv;t.VersionNumber=qe.VersionNumber;var St=nA;t.VersionedExternalApiDispatcher=St.VersionedExternalApiDispatcher}(fb)),fb}var Fv={},Lv={},Tc={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SANITIZED_VALUES={YES_VALUE:"y",NO_VALUE:"n"};const e=new Set(["https:","http:"]);class n{build(){return this._url}appendDefaultParameters(T){for(const C of T.keys()){const P=T.get(C);P&&!this._url.searchParams.has(C)&&this._url.searchParams.append(C,P)}return this}appendUserOptions(T){for(const C of Object.keys(T)){if(T[C]===null||T[C]===void 0)continue;const P=this._optionNames[C];if(!P)continue;const z=this.sanitizeParameterValue(P,T[C]);this._url.searchParams.append(P,z)}return this}appendCustomParams(T){for(const C of T)this._url.searchParams.set(C.name,C.value);return this}setToken(T){if(this._token)throw new Error(`The token has already been set to ${this._token}`);if(!T)return this;this._token=T;const C=this._url.toString().substring(this._url.origin.length);return this._url=new URL(`${this._url.origin}/vizportal/api/web/v1/auth/embed/target`),this._url.searchParams.append("token",T),this._url.searchParams.append("target",C),this}sanitizeValue(T){const C=String(T);switch(C){case"true":return t.SANITIZED_VALUES.YES_VALUE;case"false":return t.SANITIZED_VALUES.NO_VALUE;default:return C}}}t.EmbeddingUrlBuilder=n;function a(w){u(w)}t.validateUrl=a;function u(w){const T=w.protocol;if(!e.has(T))throw new Error(`Invalid protocol in URL '${w}'. The protocols supported are ${Array.from(e).join(", ")}.`)}function d(w){const C=l(new URL(w.toString())).pathname.split("/").filter(P=>P);return C.length===0?"":C[0]==="site"?C[1]:C[0]==="pulse"&&C[1]==="site"?C[2]:""}t.getSiteIdForPulse=d;function _(w){const C=l(new URL(w.toString())).pathname.split("/").filter(P=>P);return C.length===0||C[0]!=="t"||C.length<2?"":C[1]}t.getSiteId=_;function l(w){let T=w.toString();return T=T.replace("/#/site/","/t/").replace("/#/","/"),new URL(T)}t.canonicalizeVizPortalRoutingHashes=l})(Tc);Object.defineProperty(Lv,"__esModule",{value:!0});const oY=Nt,Ql=hr(),PO=sn(),DO=Tc;function aY(t,e,n,a){const u=t.split("?")[0];let d;try{d=new URL(u),DO.validateUrl(d)}catch(w){throw new PO.TableauError(oY.EmbeddingErrorCodes.InvalidUrl,w.message)}const _=sY(d,n),l=new MO(d).appendDefaultParameters(_).appendUserOptions(e).appendCustomParams(a);return e.iframeAuth&&l.setToken(e.token),l.build()}Lv.createAskDataUrl=aY;function sY(t,e){const n=new Map,a=`${Ql.INTERNAL_CONTRACT_VERSION.major}.${Ql.INTERNAL_CONTRACT_VERSION.minor}.${Ql.INTERNAL_CONTRACT_VERSION.fix}`;n.set(Ql.AskDataOptionNames.ApiInternalVersion,a);const u=PO.ApiVersion.Instance.formattedValue;return n.set(Ql.AskDataOptionNames.ApiExternalVersion,u),n.set(Ql.AskDataOptionNames.ApiID,`embhost${e}`),n.set(Ql.AskDataOptionNames.AskDataWebComponent,"true"),n}class MO extends DO.EmbeddingUrlBuilder{constructor(e){super(),this._url=e,this._optionNames=Ql.AskDataOptionNames}sanitizeParameterValue(e,n){return this.sanitizeValue(n)}}Lv.EmbeddingAskDataUrlBuilder=MO;var Uu={},iA={},lY=$e&&$e.__awaiter||function(t,e,n,a){function u(d){return d instanceof n?d:new n(function(_){_(d)})}return new(n||(n=Promise))(function(d,_){function l(C){try{T(a.next(C))}catch(P){_(P)}}function w(C){try{T(a.throw(C))}catch(P){_(P)}}function T(C){C.done?d(C.value):u(C.value).then(l,w)}T((a=a.apply(t,e||[])).next())})};Object.defineProperty(iA,"__esModule",{value:!0});class cY{constructor(){this.queue=[],this.pending=0,this.concurrency=1}add(e){return new Promise((a,u)=>{this.queue.push(()=>lY(this,void 0,void 0,function*(){try{const d=yield e();a(d)}catch(d){u(d)}finally{this.pending--,this.poll()}}))})}poll(){if(this.pending<this.concurrency&&this.queue.length>0){const e=this.queue.shift();this.pending++,e()}}size(){return this.queue.length}}iA.PromiseQueue=cY;Object.defineProperty(Uu,"__esModule",{value:!0});const uY=iA;class Jm{static authRequired(e,n){if(!n)return!0;try{const a=new URL(e);if(this.signedInOrigins.has(a.origin))return!1}catch{return!0}return!0}static updateSignedInOrigin(e,n){if(n)try{const a=new URL(e);this.signedInOrigins.add(a.origin)}catch{return}}static clearOrigin(e,n){if(n&&e)try{const a=new URL(e);this.signedInOrigins.delete(a.origin)}catch{return}}static registerWebComponent(e){const n=this.embeddingIndex;return this.webComponents.set(n,e),this.embeddingIndex++,n}static unregisterWebComponent(e){this.webComponents.delete(e)}static getWebComponents(){const e=new Map;return this.webComponents.forEach((n,a)=>{e.set(a,n)}),e}static synchronizeRender(e){const n=this.queue.add(e);return this.queue.poll(),n}static clear(){this.webComponents.clear()}}Uu.WebComponentManager=Jm;Jm.embeddingIndex=0;Jm.webComponents=new Map;Jm.queue=new uY.PromiseQueue;Jm.signedInOrigins=new Set;var e0={},oA={};Object.defineProperty(oA,"__esModule",{value:!0});class hY{constructor(e,n){this._errorCode=e,this._message=n}get message(){return this._message}get errorCode(){return this._errorCode}}oA.VizLoadErrorEvent=hY;var Bv={};Object.defineProperty(Bv,"__esModule",{value:!0});class zO{}Bv.HtmlElementHelpers=zO;zO.getContentSize=t=>{const e=window.getComputedStyle(t),n=parseInt(e.paddingLeft,10)||0,a=parseInt(e.paddingTop,10)||0,u=parseInt(e.paddingRight,10)||0,d=parseInt(e.paddingBottom,10)||0,_=t.clientWidth-Math.round(n+u),l=t.clientHeight-Math.round(a+d);return{width:_,height:l}};(function(t){var e=$e&&$e.__awaiter||function(C,P,z,$){function U(W){return W instanceof z?W:new z(function(N){N(W)})}return new(z||(z=Promise))(function(W,N){function V(H){try{F($.next(H))}catch(J){N(J)}}function R(H){try{F($.throw(H))}catch(J){N(J)}}function F(H){H.done?W(H.value):U(H.value).then(V,R)}F(($=$.apply(C,P||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=Nt,a=sn(),u=oA,d=Bv,_=Uu;var l;(function(C){C.Skip="skip",C.Success="success",C.Failure="failure"})(l=t.TableauAuthResponse||(t.TableauAuthResponse={}));const w={allowTransparency:"allowTransparency",allowFullScreen:"allowFullScreen",style:"style",class:"class",loading:"loading"};t.getLocalizedTitle=C=>{const P={en:"Data Visualization","en-GB":"Data Visualisation",fr:"Visualisation de données",es:"Visualización de datos",it:"Visualizzazione dati",pt:"Visualização de dados",ja:"データ ビジュアライゼーション",de:"Datenvisualisierung",ko:"데이터 비주얼리제이션","zh-CN":"数据可视化","zh-TW":"資料可視化"};return P[C]||P[C.substr(0,2)]||P.en};class T extends HTMLElement{constructor(){super(),this._initialized=!1,this._embeddingIdCounter=0,this._fixedSize=!1,this.attachShadow({mode:"open"})}disconnectedCallback(){var P,z;this._iframe&&((P=this.shadowRoot)===null||P===void 0||P.removeChild(this._iframe)),this._iframeStyle&&((z=this.shadowRoot)===null||z===void 0||z.removeChild(this._iframeStyle)),_.WebComponentManager.clearOrigin(this.src,this.forceTokenSync),_.WebComponentManager.unregisterWebComponent(this._embeddingIdCounter),this._initialized=!1}connectedCallback(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{this.initialize()}):this.initialize()}attributeChangedCallback(P,z,$){if(!(!z&&z===$)){if(P===n.WebComponentAttributes.Width||P===n.WebComponentAttributes.Height){this.setFrameSize();return}P===n.WebComponentAttributes.Token&&z&&z!==$&&_.WebComponentManager.clearOrigin(this.src,this.forceTokenSync),_.WebComponentManager.synchronizeRender(this.updateRenderingIfInitialized.bind(this,this.src))}}static get observedAttributes(){return Object.values(n.WebComponentAttributes)}initialize(){this._initialized||(this.style.display="flex",this.setupFrame(),this.registerAttributeAuthErrorEvent(),_.WebComponentManager.synchronizeRender(this.updateRendering.bind(this,this.src)))}get fixedSize(){return this._fixedSize}readCustomParamsFromChildren(){const P=[];return Array.from(this.children).forEach(z=>{z.localName===n.WebComponentChildElements.CustomParameter&&z.getAttribute(n.WebComponentChildElementAttributes.Name)&&z.getAttribute(n.WebComponentChildElementAttributes.Value)&&P.push({name:z.getAttribute(n.WebComponentChildElementAttributes.Name),value:z.getAttribute(n.WebComponentChildElementAttributes.Value)})}),P}getIframeStyleChild(){let P;for(const z of Array.from(this.children))if(z.localName===n.WebComponentChildElements.IframeStyle){if(P)throw new a.TableauError(n.EmbeddingErrorCodes.InternalError,`Only one ${n.WebComponentChildElements.IframeStyle} child element is supported. Please combine your styles.`);P=z}return P}setupFrame(){var P;this._iframe=document.createElement("iframe");const z=navigator.language,$=t.getLocalizedTitle(z);if(this._iframe.setAttribute("title",$),this._iframe.setAttribute(w.allowTransparency,"true"),this._iframe.setAttribute(w.allowFullScreen,"true"),this.iframeAttributeLoading&&this._iframe.setAttribute("loading",this.iframeAttributeLoading),this._iframe.style.margin="0px",this._iframe.style.padding="0px",this._iframe.style.border="none",this._iframe.style.position="relative",this._iframe.id=this.id,this._iframe.name=this.id,this.setFrameSize(),this.iframeAttributeStyle){const U=this._iframe.getAttribute(w.style);this._iframe.setAttribute(w.style,`${U} ${this.iframeAttributeStyle}`)}if(this.iframeAttributeClass&&this._iframe.setAttribute(w.class,this.iframeAttributeClass),this.shadowRoot){const U=this.getIframeStyleChild();if(U){U.style.display="none";const W=(P=U.textContent)===null||P===void 0?void 0:P.trim();W&&(this._iframeStyle=document.createElement("style"),this._iframeStyle.textContent=W,this.shadowRoot.appendChild(this._iframeStyle))}this.shadowRoot.appendChild(this._iframe)}}setFrameSize(){this._iframe&&(this._iframe.style.height=this.height,this._iframe.style.width=this.width)}computeElementSize(){const P=this.getPixelAttribute(n.WebComponentAttributes.Height),z=this.getPixelAttribute(n.WebComponentAttributes.Width);if(P&&z)return this._fixedSize=!0,{height:P,width:z};if(this.parentElement){const{height:$,width:U}=d.HtmlElementHelpers.getContentSize(this.parentElement);if($&&U)return this._fixedSize=!0,{height:`${$}px`,width:`${U}px`}}return this._fixedSize=!1,{height:T.AttributeDefaults.height,width:T.AttributeDefaults.width}}get src(){return this.getAttribute(n.WebComponentAttributes.Src)}set src(P){P&&this.setAttribute(n.WebComponentAttributes.Src,P)}get forceTokenSync(){return this.hasAttribute(n.WebComponentAttributes.ForceTokenSync)}set forceTokenSync(P){P?this.setAttribute(n.WebComponentAttributes.ForceTokenSync,""):this.removeAttribute(n.WebComponentAttributes.ForceTokenSync)}get width(){return this.computeElementSize().width}set width(P){this.setAttribute(n.WebComponentAttributes.Width,P)}get height(){return this.computeElementSize().height}set height(P){this.setAttribute(n.WebComponentAttributes.Height,P)}get debug(){return this.hasAttribute(n.WebComponentAttributes.Debug)}set debug(P){P?this.setAttribute(n.WebComponentAttributes.Debug,""):this.removeAttribute(n.WebComponentAttributes.Debug)}get token(){const P=this.getAttribute(n.WebComponentAttributes.Token);if(P)return P}set token(P){P?this.setAttribute(n.WebComponentAttributes.Token,P):this.removeAttribute(n.WebComponentAttributes.Token)}get iframeAuth(){return this.hasAttribute(n.WebComponentAttributes.IframeAuth)}set iframeAuth(P){P?this.setAttribute(n.WebComponentAttributes.IframeAuth,""):this.removeAttribute(n.WebComponentAttributes.IframeAuth)}get iframeAttributeLoading(){const P=this.getAttribute(n.EmbeddedIframeAttributes.Loading);if(P)return P}set iframeAttributeLoading(P){var z,$;P?(this.setAttribute(n.EmbeddedIframeAttributes.Loading,P),(z=this._iframe)===null||z===void 0||z.setAttribute(w.loading,P)):(this.removeAttribute(n.EmbeddedIframeAttributes.Loading),($=this._iframe)===null||$===void 0||$.removeAttribute(w.loading))}get iframeAttributeStyle(){const P=this.getAttribute(n.EmbeddedIframeAttributes.Style);if(P)return P}set iframeAttributeStyle(P){var z,$;P?(this.setAttribute(n.EmbeddedIframeAttributes.Style,P),(z=this._iframe)===null||z===void 0||z.setAttribute(w.style,P)):(this.removeAttribute(n.EmbeddedIframeAttributes.Style),($=this._iframe)===null||$===void 0||$.removeAttribute(w.style))}get iframeAttributeClass(){const P=this.getAttribute(n.EmbeddedIframeAttributes.Class);if(P)return P}set iframeAttributeClass(P){var z,$;P?(this.setAttribute(n.EmbeddedIframeAttributes.Class,P),(z=this._iframe)===null||z===void 0||z.setAttribute(w.class,P)):(this.removeAttribute(n.EmbeddedIframeAttributes.Class),($=this._iframe)===null||$===void 0||$.removeAttribute(w.class))}getPixelAttribute(P){const z=this.getAttribute(P);return z&&z!==""?isNaN(Number(z))?z:`${Math.round(Number(z))}px`:""}get iframe(){return this._iframe}registerAttributeAuthErrorEvent(){this.getWebComponentAttributeEvents().forEach(P=>{const[z,$]=P;this.registerCallback(z,$)})}getWebComponentAttributeEvents(){return[[n.WebComponentAttributes.OnVizLoadError,n.EmbeddingTableauEventType.VizLoadError]]}registerCallback(P,z){const $=this.getAttribute(P);$&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test($)&&window[$]&&this.addEventListener(z,window[$])}auth(P){return e(this,void 0,void 0,function*(){try{if(!this.src||!this.token||this.iframeAuth||!_.WebComponentManager.authRequired(this.src,this.forceTokenSync))return l.Skip;const U=`${new URL(this.src).origin.toString()}/vizportal/api/web/v1/auth/embed/signin`,W={siteName:P,jwt:this.token},N={method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify(W)},V=yield fetch(U,N);if(V.ok)return _.WebComponentManager.updateSignedInOrigin(this.src,this.forceTokenSync),l.Success;const F=yield V.text(),H={statusCode:V.status,errorMessage:F};return this.isFallbackToRedirectAuthNeeded(H)?(this.iframeAuth=!0,console.debug("Auth Fallback trigger"),l.Failure):(this.raiseVizLoadErrorNotification(n.EmbeddingErrorCodes.AuthFailed,H),l.Failure)}catch(z){return this.raiseVizLoadErrorNotification(n.EmbeddingErrorCodes.UnknownAuthError,z),l.Failure}})}isFallbackToRedirectAuthNeeded(P){try{if(P.statusCode===404)return!0;if(P.statusCode===401){let z=JSON.parse(P.errorMessage).result.errors;if(z&&z.length>0&&z[0].code===67)return!0}return!1}catch(z){return console.error("Parsing error: "+z),!1}}raiseIframeSrcUpdatedNotification(){this.dispatchEvent(new CustomEvent(n.EmbeddingTableauEventType.IframeSrcUpdated))}raiseVizLoadErrorNotification(P,z){try{console.error(z);const $=new u.VizLoadErrorEvent(P,JSON.stringify(z));this.dispatchEvent(new CustomEvent(n.EmbeddingTableauEventType.VizLoadError,{detail:$}))}catch{const U=new u.VizLoadErrorEvent(n.EmbeddingErrorCodes.UnknownAuthError,"");this.dispatchEvent(new CustomEvent(n.EmbeddingTableauEventType.VizLoadError,{detail:U}))}}}t.TableauWebComponent=T,T.AttributeDefaults={width:"800px",height:"600px"}})(e0);var MD=$e&&$e.__awaiter||function(t,e,n,a){function u(d){return d instanceof n?d:new n(function(_){_(d)})}return new(n||(n=Promise))(function(d,_){function l(C){try{T(a.next(C))}catch(P){_(P)}}function w(C){try{T(a.throw(C))}catch(P){_(P)}}function T(C){C.done?d(C.value):u(C.value).then(l,w)}T((a=a.apply(t,e||[])).next())})};Object.defineProperty(Fv,"__esModule",{value:!0});const Vi=Nt,dY=Lv,pY=Tc,zD=Uu,RD=e0;class fY extends RD.TableauWebComponent{constructor(){super()}static get observedAttributes(){return[...super.observedAttributes,...Object.values(Vi.AskDataAttributes)]}updateRenderingIfInitialized(e){return MD(this,void 0,void 0,function*(){if(this._initialized)return zD.WebComponentManager.unregisterWebComponent(this._embeddingIdCounter),this.updateRendering(e)})}updateRendering(e){return MD(this,void 0,void 0,function*(){try{if(this._initialized=!0,!e){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if((yield this.auth(pY.getSiteId(e)))===RD.TableauAuthResponse.Failure){console.debug("Authentication failed.");return}if(!this.src){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if(!this.iframe){console.debug("No iframe available to update the src.");return}const a=this.readCustomParamsFromChildren();this._embeddingIdCounter=zD.WebComponentManager.registerWebComponent(this);const u=dY.createAskDataUrl(this.src,this.constructOptions(),this._embeddingIdCounter,a).toString();this.iframe.src=u,this.raiseIframeSrcUpdatedNotification();return}catch(n){console.warn(n)}})}constructOptions(){return{origin:this.origin,showEmbed:this.showEmbed,showPin:this.showPin,showSave:this.showSave,showShare:this.showShare,token:this.token,iframeAuth:this.iframeAuth,debug:this.debug}}get origin(){const e=this.getAttribute(Vi.AskDataAttributes.Origin);return e||void 0}set origin(e){e?this.setAttribute(Vi.AskDataAttributes.Origin,e):this.removeAttribute(Vi.AskDataAttributes.Origin)}get showEmbed(){return this.hasAttribute(Vi.AskDataAttributes.ShowEmbed)}set showEmbed(e){e?this.setAttribute(Vi.AskDataAttributes.ShowEmbed,""):this.removeAttribute(Vi.AskDataAttributes.ShowEmbed)}get showPin(){return this.hasAttribute(Vi.AskDataAttributes.ShowPin)}set showPin(e){e?this.setAttribute(Vi.AskDataAttributes.ShowPin,""):this.removeAttribute(Vi.AskDataAttributes.ShowPin)}get showShare(){return this.hasAttribute(Vi.AskDataAttributes.ShowShare)}set showShare(e){e?this.setAttribute(Vi.AskDataAttributes.ShowShare,""):this.removeAttribute(Vi.AskDataAttributes.ShowShare)}get showSave(){return this.hasAttribute(Vi.AskDataAttributes.ShowSave)}set showSave(e){e?this.setAttribute(Vi.AskDataAttributes.ShowSave,""):this.removeAttribute(Vi.AskDataAttributes.ShowSave)}}Fv.TableauAskData=fY;var Nv={},aA={},sA={};Object.defineProperty(sA,"__esModule",{value:!0});const Xb=sn();class mY{constructor(e){this._registryId=e}getAbstractQueryWithDataModel(){return Xb.ApiServiceRegistry.get(this._registryId).getService("EmbeddingVizApiService").getEmbeddingAbstractQueryAsync()}getVizStateWithDataModel(){return Xb.ApiServiceRegistry.get(this._registryId).getService("EmbeddingVizApiService").getEmbeddingVizStateWithDataModelAsync()}setVizStateWithDataModel(e){return Xb.ApiServiceRegistry.get(this._registryId).getService("EmbeddingVizApiService").setEmbeddingVizStateWithDataModelAsync(e)}}sA.AuthoringWorksheetImpl=mY;var lA={};Object.defineProperty(lA,"__esModule",{value:!0});class gY{constructor(e){this._authoringWorksheetImpl=e}getAbstractQueryWithDataModelAsync(){return this._authoringWorksheetImpl.getAbstractQueryWithDataModel()}getVizStateWithDataModelAsync(){return this._authoringWorksheetImpl.getVizStateWithDataModel()}setVizStateWithDataModelAsync(e){return this._authoringWorksheetImpl.setVizStateWithDataModel(e)}}lA.AuthoringWorksheet=gY;var yY=$e&&$e.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(aA,"__esModule",{value:!0});const OD=yY(Nt),_Y=sn(),vY=sA,xY=lA;class bY{constructor(e,n){this._workbookImpl=e,this._registryId=n}get activeSheet(){if(this._workbookImpl.activeSheet.sheetType===OD.SheetType.Worksheet){const e=new vY.AuthoringWorksheetImpl(this._registryId);return new xY.AuthoringWorksheet(e)}throw new _Y.TableauError(OD.EmbeddingErrorCodes.InvalidSheetType,"Worksheet type not yet supported in Authoring")}}aA.AuthoringWorkbook=bY;var cA={},RO={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Tc;t.VizUrlMode={Viewing:"views",Authoring:"authoring"};class n{constructor(u,d){this._url=u,this._segments=d}get mode(){return this._segments.mode}get siteId(){return this._segments.siteId}get workbookId(){return this._segments.workbookId}get sheetId(){return this._segments.sheetId}get customView(){return this._segments.customView}static create(u){const d=e.canonicalizeVizPortalRoutingHashes(new URL(u.toString())),_=n._parsePathName(d.pathname);return d.pathname=n._buildPathName(_),new n(d,_)}toURL(){return new URL(this.toString())}toString(){return this._url.toString()}withMode(u){if(this._segments.mode===u)return this;const d=this._getSegmentsForMode(u);return this._makeVizUrlFromPathSegments(d)}withCustomView(u){var d;if(u.luid===((d=this.customView)===null||d===void 0?void 0:d.luid)&&u.name===this.customView.name)return this;const _=this._getSegmentsForMode(this.mode);return _.customView=u,this._makeVizUrlFromPathSegments(_)}withSheetId(u){if(this.sheetId===u)return this;const d=Object.assign(Object.assign({},this._segments),{sheetId:u});return this._makeVizUrlFromPathSegments(d)}withWorkbookId(u){if(this.workbookId===u)return this;const d=Object.assign(Object.assign({},this._segments),{workbookId:u});return this._makeVizUrlFromPathSegments(d)}_getSegmentsForMode(u){return u===t.VizUrlMode.Authoring&&(this._segments.customView=void 0),Object.assign(Object.assign({},this._segments),{mode:u})}_makeVizUrlFromPathSegments(u){const d=n._buildPathName(u),_=new URL(this._url.toString());return _.pathname=d,new n(_,u)}static _parsePathName(u){var d,_,l;const w=u.split("/").filter(W=>W);if(w.length===0)throw new Error("Invalid path name");let T;if(w[0]==="t"){if(w.length<2)throw new Error(`Invalid site in path '${u}'`);T=w[1],w.splice(0,2)}const C=w.shift();if(!C)throw new Error(`Missing mode in path '${u}'`);const P=C;if(!Object.values(t.VizUrlMode).includes(P))throw new Error(`Invalid Viz Url Mode '${C}' in path '${u}'`);if(w.length===0)throw new Error(`Missing workbook/sheet name in path '${u}'`);const z=(d=w.shift(),d??""),$=w.shift();if(w.length!==0&&w.length!==2)throw new Error(`Invalid path name: unknown parts after sheet id: '${u}'`);let U;if(w.length===2){const W=(_=w.shift(),_??""),N=(l=w.shift(),l??"");U={luid:W,name:N}}return{mode:P,siteId:T,workbookId:z,sheetId:$,customView:U}}static _buildPathName(u){const d=[];return u.siteId&&(d.push("t"),d.push(u.siteId)),d.push(u.mode),u.workbookId&&d.push(u.workbookId),u.sheetId&&d.push(u.sheetId),u.customView&&u.mode===t.VizUrlMode.Viewing&&(d.push(u.customView.luid),d.push(u.customView.name)),d.join("/")}}t.VizUrl=n})(RO);(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Nt,n=hr(),a=sn(),u=Tc,d=RO;var _;(function(P){P[P.Viewing=0]="Viewing",P[P.Authoring=1]="Authoring"})(_=t.EmbeddingUrlMode||(t.EmbeddingUrlMode={}));const l=new Map([[_.Viewing,d.VizUrlMode.Viewing],[_.Authoring,d.VizUrlMode.Authoring]]);class w extends u.EmbeddingUrlBuilder{constructor(z){super(),this._url=z,this._optionNames=n.VizOptionNames}appendFilters(z){for(const $ of z)this._url.searchParams.append($.field,$.value);return this}appendParams(z){for(const $ of z)this._url.searchParams.append($.name,$.value);return this}sanitizeParameterValue(z,$){let U;switch(z){case n.VizOptionNames.hideTabs:U=this.sanitizeValue(!$);break;case n.VizOptionNames.toolbar:U=this.sanitizeValue($===e.Toolbar.Hidden?!1:$);break;default:U=this.sanitizeValue($);break}return U}}t.EmbeddingVizUrlBuilder=w;function T(P,z,$,U,W,N,V){if(!P)throw new a.TableauError(e.EmbeddingErrorCodes.InternalError,"We should not have attempted to render the component without a src");const R=l.get(z);if(!R)throw new a.TableauError(e.EmbeddingErrorCodes.InternalError,`'${z}' is not yet supported.`);const F=P.split("?")[0];let H;try{H=new URL(F),u.validateUrl(H)}catch(se){throw new a.TableauError(e.EmbeddingErrorCodes.InvalidUrl,se.message)}try{H=d.VizUrl.create(F).withMode(R).toURL()}catch{}const J=C(H,U),te=new w(H).appendDefaultParameters(J).appendUserOptions($).appendFilters(W).appendParams(N).appendCustomParams(V);return $.iframeAuth&&te.setToken($.token),te.build()}t.createVizUrl=T;function C(P,z){const $=new Map;$.set(n.VizOptionNames.Embed,u.SANITIZED_VALUES.YES_VALUE),$.set(n.VizOptionNames.ApiID,`embhost${z}`),P.hostname==="public.tableau.com"&&$.set(n.VizOptionNames.ShowVizHome,u.SANITIZED_VALUES.NO_VALUE);const U=`${n.INTERNAL_CONTRACT_VERSION.major}.${n.INTERNAL_CONTRACT_VERSION.minor}.${n.INTERNAL_CONTRACT_VERSION.fix}`;$.set(n.VizOptionNames.ApiInternalVersion,U);const W=a.ApiVersion.Instance.formattedValue;return $.set(n.VizOptionNames.ApiExternalVersion,W),$.set(n.VizOptionNames.NavType,"0"),$.set(n.VizOptionNames.NavSrc,"Opt"),$}})(cA);var Gd={},uA={},hA={};Object.defineProperty(hA,"__esModule",{value:!0});class wY{constructor(e){this._vizSize=e}get vizSize(){return this._vizSize}}hA.FirstVizSizeKnownEvent=wY;var dA={};Object.defineProperty(dA,"__esModule",{value:!0});class EY{constructor(e,n){this._oldSheetName=e,this._newSheetName=n}get oldSheetName(){return this._oldSheetName}get newSheetName(){return this._newSheetName}}dA.TabSwitchedEvent=EY;var pA={};Object.defineProperty(pA,"__esModule",{value:!0});class SY{constructor(e,n){this._canRedo=e,this._canUndo=n}get canRedo(){return this._canRedo}get canUndo(){return this._canUndo}}pA.ToolbarStateChangedEvent=SY;var fA={},TY=$e&&$e.__awaiter||function(t,e,n,a){function u(d){return d instanceof n?d:new n(function(_){_(d)})}return new(n||(n=Promise))(function(d,_){function l(C){try{T(a.next(C))}catch(P){_(P)}}function w(C){try{T(a.throw(C))}catch(P){_(P)}}function T(C){C.done?d(C.value):u(C.value).then(l,w)}T((a=a.apply(t,e||[])).next())})},AY=$e&&$e.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(fA,"__esModule",{value:!0});const Qs=AY(Nt),wy=hr(),rn=sn();class IY extends rn.WorkbookImpl{constructor(e,n){super(),this._registryId=n,this._publishedSheetsInfo=[],this._customViews=new Map,this._name=e.workbookName,this._canDownloadWorkbook=e.canDownloadWorkbook,this.initializeWorkbook(e)}get activeSheet(){return this._activeSheetImpl}get publishedSheetsInfo(){return this._publishedSheetsInfo}get name(){return this._name}get canDownloadWorkbook(){return this._canDownloadWorkbook}get pendingTabSwitchPromise(){return this._pendingTabSwitchPromise}get pendingShowCustomViewPromise(){return this._pendingShowCustomViewPromise}clearPendingShowCustomViewPromise(){this._pendingShowCustomViewPromise=void 0}get activeCustomView(){return this._currentCustomView}activateSheetAsync(e){rn.ErrorHelpers.verifyParameter(e,"sheetNameOrIndex");let n=this.convertSheetIndexToSheetName(e);return rn.ErrorHelpers.verifyParameterType(n,"string","sheetNameOrIndex"),this.validatePublishedSheet(n)||this.verifyDashboardSheets(n),this._activeSheetImpl&&n===this._activeSheetImpl.name?new Promise((d,_)=>{d(this)}):(rn.ApiServiceRegistry.get(this._registryId).getService("viz-service").activateSheetAsync(n),new Promise((d,_)=>{this._pendingTabSwitchPromise={resolve:d,reject:_}}))}getParametersAsync(){return rn.ApiServiceRegistry.get(this._registryId).getService("parameters-service").getAllParametersAsync()}changeParameterValueAsync(e,n){return TY(this,void 0,void 0,function*(){rn.ErrorHelpers.verifyParameter(e,"parameterName");const u=yield rn.ApiServiceRegistry.get(this._registryId).getService("parameters-service").findParameterByNameAsync(e);if(u)return u.changeValueAsync(n).then(()=>u)})}updateExistingActiveSheetReferences(e){if(this._activeSheetImpl){if(this._activeSheetImpl.name===e)return;this._activeSheetImpl.active=!1,this._publishedSheetsInfo.forEach((n,a)=>{n.name===this._activeSheetImpl.name&&(n.active=!1)})}}processCustomViews(e,n){var a;const u=(a=n.currentView)===null||a===void 0?void 0:a.luid;let d=[];switch(e){case wy.NotificationId.CustomViewsLoaded:case wy.NotificationId.CustomViewSaved:{if(this.refreshCustomViewCache(n),u){const _=this._customViews.get(u);_&&d.push(_)}break}case wy.NotificationId.CustomViewRemoved:{let _=new Map(this._customViews);this._customViews.clear(),n.customViewsList.map(l=>{this._customViews.set(l.luid,new rn.CustomViewImpl(l,this._registryId)),_.delete(l.luid)});for(let l of _.values())d.push(l);break}case wy.NotificationId.CustomViewSetDefault:{this.refreshCustomViewCache(n);const _=n.customViewsList.find(l=>l.isDefault);_&&d.push(new rn.CustomViewImpl(_,this._registryId));break}}return this._currentCustomView=u?this._customViews.get(u):void 0,d}refreshCustomViewCache(e){this._customViews.clear(),e.customViewsList.map(n=>{this._customViews.set(n.luid,new rn.CustomViewImpl(n,this._registryId))})}revertAllAsync(){return rn.ApiServiceRegistry.get(this._registryId).getService("ToolbarService").revertAllAsync()}getCustomViewsAsync(){return rn.ApiServiceRegistry.get(this._registryId).getService("viz-service").getCustomViewsAsync()}showCustomViewAsync(e){return rn.ApiServiceRegistry.get(this._registryId).getService("viz-service").showCustomViewAsync(e),new Promise((u,d)=>{this._pendingShowCustomViewPromise={resolve:u,reject:d}})}removeCustomViewAsync(e){return rn.ApiServiceRegistry.get(this._registryId).getService("viz-service").removeCustomViewAsync(e)}saveCustomViewAsync(e){return rn.ApiServiceRegistry.get(this._registryId).getService("viz-service").saveCustomViewAsync(e)}setActiveCustomViewAsDefaultAsync(){return rn.ApiServiceRegistry.get(this._registryId).getService("viz-service").setActiveCustomViewAsDefaultAsync()}initializeWorkbook(e){e.publishedSheets.forEach((n,a)=>{const u=rn.SheetUtils.getSheetSizeFromSizeConstraints(n.sizeConstraint),d=n.name===e.currWorksheetName,_=!1,l=rn.SheetUtils.getSheetTypeEnum(n.sheetType),w=new rn.SheetInfoImpl(n.name,l,u,a,d,_,n.url);if(this._publishedSheetsInfo.push(w),d)switch(w.sheetType){case Qs.SheetType.Worksheet:{const T={worksheet:w.name};this._activeSheetImpl=new rn.WorksheetImpl(w,this._registryId,T,null,null);break}case Qs.SheetType.Dashboard:{const T={sheetName:w.name,isDashboard:!0};this._activeSheetImpl=new rn.DashboardImpl(w,e.dashboardZones,T,this._registryId,null);break}case Qs.SheetType.Story:{if(!e.story)throw new rn.TableauError(Qs.SharedErrorCodes.ServerError,"Unable to receive story information from Tableau");this._activeSheetImpl=new rn.StoryImpl(w,e.story,e.publishedSheets,this._registryId);break}default:throw new rn.TableauError(Qs.SharedErrorCodes.ServerError,"Invalid SheetType")}})}convertSheetIndexToSheetName(e){if(typeof e=="number"){const n=e;if(this.publishedSheetsInfo[n])return this.publishedSheetsInfo[n].name;throw new rn.TableauError(Qs.EmbeddingErrorCodes.IndexOutOfRange,`Index ${n} is out of range.`)}return e}validatePublishedSheet(e){return this.publishedSheetsInfo.find(a=>a.name===e)!==void 0}verifyDashboardSheets(e){if(this._activeSheetImpl.sheetType===Qs.SheetType.Dashboard){let n=this._activeSheetImpl,a=n.worksheetsImpl.findIndex(u=>u.name===e);if(a!==-1){if(n.worksheetsImpl[a].hidden)throw new rn.TableauError(Qs.SharedErrorCodes.ServerError,"Cannot activate hidden sheet");return}}throw new rn.TableauError(Qs.EmbeddingErrorCodes.SheetNotInWorkbook,"Sheet is not found in Workbook")}}fA.EmbeddingWorkbookImpl=IY;var Ey={},Sy={},Ty={},Ay={},Iy={},Cy={},FD;function mA(){if(FD)return Cy;FD=1;var t=$e&&$e.__importStar||function(d){if(d&&d.__esModule)return d;var _={};if(d!=null)for(var l in d)Object.hasOwnProperty.call(d,l)&&(_[l]=d[l]);return _.default=d,_};Object.defineProperty(Cy,"__esModule",{value:!0});const e=t(Nt),n=sn(),a=Wv();let u=class{constructor(_,l){this._sheetImpl=_,this._workbookImpl=l}get isHidden(){return this._sheetImpl.hidden}get isActive(){return this._sheetImpl.active}get name(){return this._sheetImpl.name}get sheetType(){return this._sheetImpl.sheetType}get size(){if(n.SheetUtils.isValidSheetSize(this._sheetImpl.size))return this._sheetImpl.size;throw new n.TableauError(e.EmbeddingErrorCodes.NotImplemented,"Not implemented")}get url(){if(this.isHidden)throw new n.TableauError(e.EmbeddingErrorCodes.NoUrlForHiddenWorksheet,"No URL for hidden worksheet");return this._sheetImpl.url}get index(){return this._sheetImpl.index}get workbook(){return new a.Workbook(this._workbookImpl)}changeSizeAsync(_){return this._sheetImpl.changeSizeAsync(_)}};return Cy.Sheet=u,Cy}var ky={},Py={},Dy={},LD;function OO(){if(LD)return Dy;LD=1,Object.defineProperty(Dy,"__esModule",{value:!0});const t=gA();let e=class{constructor(a,u){this._storyPointInfoImpl=a,this._workbookImpl=u}get index(){return this._storyPointInfoImpl.index}get caption(){return this._storyPointInfoImpl.caption}get active(){return this._storyPointInfoImpl.active}get updated(){return this._storyPointInfoImpl.updated}get parentStory(){return new t.Story(this._storyPointInfoImpl.parentStory,this._workbookImpl)}};return Dy.StoryPointInfo=e,Dy}var BD;function gA(){if(BD)return Py;BD=1;var t=$e&&$e.__importStar||function(l){if(l&&l.__esModule)return l;var w={};if(l!=null)for(var T in l)Object.hasOwnProperty.call(l,T)&&(w[T]=l[T]);return w.default=l,w};Object.defineProperty(Py,"__esModule",{value:!0});const e=t(Nt),n=sn(),a=mA(),u=Uv(),d=OO();let _=class extends a.Sheet{constructor(w,T){super(w,T),this._storyImpl=w}get activeStoryPoint(){if(!this._storyImpl.activeStoryPoint)throw new n.TableauError(e.EmbeddingErrorCodes.ImplementationError,"Active story point has not been initialized");return new u.StoryPoint(this._storyImpl.activeStoryPoint,this._workbookImpl)}get storyPointsInfo(){return this._storyImpl.storyPointsInfo.map(w=>new d.StoryPointInfo(w,this._workbookImpl))}activateNextStoryPointAsync(){return this._storyImpl.activateNextStoryPointAsync().then(w=>new u.StoryPoint(w,this._workbookImpl))}activatePreviousStoryPointAsync(){return this._storyImpl.activatePreviousStoryPointAsync().then(w=>new u.StoryPoint(w,this._workbookImpl))}activateStoryPointAsync(w){return this._storyImpl.activateStoryPointAsync(w).then(T=>new u.StoryPoint(T,this._workbookImpl))}revertStoryPointAsync(w){return this._storyImpl.revertStoryPointAsync(w).then(T=>new d.StoryPointInfo(T,this._workbookImpl))}};return Py.Story=_,Py}var ND;function Uv(){if(ND)return ky;ND=1;var t=$e&&$e.__importStar||function(l){if(l&&l.__esModule)return l;var w={};if(l!=null)for(var T in l)Object.hasOwnProperty.call(l,T)&&(w[T]=l[T]);return w.default=l,w};Object.defineProperty(ky,"__esModule",{value:!0});const e=t(Nt),n=sn(),a=Vv(),u=gA(),d=jv();let _=class{constructor(w,T){this._storyPointImpl=w,this._workbookImpl=T}get index(){return this._storyPointImpl.index}get caption(){return this._storyPointImpl.caption}get active(){return this._storyPointImpl.active}get updated(){return this._storyPointImpl.updated}get containedSheet(){const w=this._storyPointImpl.containedSheet;if(w)switch(w.sheetType){case e.SheetType.Worksheet:return new d.Worksheet(w,this._workbookImpl);case e.SheetType.Dashboard:return new a.Dashboard(w,this._workbookImpl);case e.SheetType.Story:throw new n.TableauError(e.EmbeddingErrorCodes.ImplementationError,"A story cannot contain another story");default:throw new n.TableauError(e.EmbeddingErrorCodes.ImplementationError,"Unable to initialize contained sheet")}}get parentStory(){return new u.Story(this._storyPointImpl.parentStory,this._workbookImpl)}};return ky.StoryPoint=_,ky}var UD;function jv(){if(UD)return Iy;UD=1,Object.defineProperty(Iy,"__esModule",{value:!0});const t=Vv(),e=mA(),n=Uv();let a=class extends e.Sheet{constructor(d,_){super(d,_),this._worksheetImpl=d}get parentDashboard(){return this._worksheetImpl.parentDashboard==null?null:new t.Dashboard(this._worksheetImpl.parentDashboard,this._workbookImpl)}get parentStoryPoint(){return this._worksheetImpl.parentStoryPoint==null?null:new n.StoryPoint(this._worksheetImpl.parentStoryPoint,this._workbookImpl)}getDataSourcesAsync(){return this._worksheetImpl.getDataSourcesAsync()}getSummaryDataAsync(d){return this._worksheetImpl.getSummaryDataAsync(d)}getSummaryDataReaderAsync(d,_){return this._worksheetImpl.getSummaryDataReaderAsync(d,_)}getSummaryColumnsInfoAsync(){return this._worksheetImpl.getSummaryColumnsInfoAsync()}getUnderlyingDataAsync(d){return console.warn("Worksheet.getUnderlyingDataAsync is deprecated. Please use Worksheet.getUnderlyingTablesAsync and Worksheet.getUnderlyingTableDataAsync"),this._worksheetImpl.getUnderlyingDataAsync(d)}getUnderlyingTablesAsync(){return this._worksheetImpl.getUnderlyingTablesAsync()}getUnderlyingTableDataAsync(d,_){return this._worksheetImpl.getUnderlyingTableDataAsync(d,_)}getUnderlyingTableDataReaderAsync(d,_,l){return this._worksheetImpl.getUnderlyingTableDataReaderAsync(d,_,l)}getFiltersAsync(){return this._worksheetImpl.getFiltersAsync()}applyFilterAsync(d,_,l,w){return this._worksheetImpl.applyFilterAsync(d,_,l,w)}applyRangeFilterAsync(d,_){return this._worksheetImpl.applyRangeFilterAsync(d,_)}clearFilterAsync(d){return this._worksheetImpl.clearFilterAsync(d)}applyRelativeDateFilterAsync(d,_){return this._worksheetImpl.applyRelativeDateFilterAsync(d,_)}applyHierarchicalFilterAsync(d,_,l,w){return this._worksheetImpl.applyHierarchicalFilterAsync(d,_,l,w)}clearSelectedMarksAsync(){return this._worksheetImpl.clearSelectedMarksAsync()}getSelectedMarksAsync(){return this._worksheetImpl.getSelectedMarksAsync()}annotateMarkAsync(d,_){return this._worksheetImpl.annotateMarkAsync(d,_)}getAnnotationsAsync(){return this._worksheetImpl.getAnnotationsAsync()}removeAnnotationAsync(d){return this._worksheetImpl.removeAnnotationAsync(d)}selectMarksByValueAsync(d,_){return this._worksheetImpl.selectMarksByValueAsync(d,_)}appendContextMenuAsync(d,_){return this._worksheetImpl.appendContextMenuAsync(d,_)}removeContextMenuAsync(d,_){return this._worksheetImpl.removeContextMenuAsync(d,_)}executeContextMenuAsync(d,_){return this._worksheetImpl.executeContextMenuAsync(d,_)}renameContextMenuAsync(d,_,l){return this._worksheetImpl.renameContextMenuAsync(d,_,l)}getVisualSpecificationAsync(){return this._worksheetImpl.getVisualSpecificationAsync()}};return Iy.Worksheet=a,Iy}var jD;function CY(){if(jD)return Ay;jD=1,Object.defineProperty(Ay,"__esModule",{value:!0});const t=Vv(),e=jv();let n=class{constructor(u,d){this._dashboardObjectImpl=u,this._workbookImpl=d}get dashboard(){return new t.Dashboard(this._dashboardObjectImpl.dashboardImpl,this._workbookImpl)}get type(){return this._dashboardObjectImpl.type}get position(){return this._dashboardObjectImpl.position}get size(){return this._dashboardObjectImpl.size}get worksheet(){if(this._dashboardObjectImpl.worksheetImpl)return new e.Worksheet(this._dashboardObjectImpl.worksheetImpl,this._workbookImpl)}get name(){return this._dashboardObjectImpl.name}get isFloating(){return this._dashboardObjectImpl.isFloating}get isVisible(){return this._dashboardObjectImpl.isVisible}get id(){return this._dashboardObjectImpl.id}};return Ay.DashboardObject=n,Ay}var VD;function Vv(){if(VD)return Ty;VD=1,Object.defineProperty(Ty,"__esModule",{value:!0});const t=CY(),e=mA(),n=Uv(),a=jv();let u=class extends e.Sheet{constructor(_,l){super(_,l),this._dashboardImpl=_,_.initializeWithPublicInterfaces()}get objects(){return this._dashboardImpl.objects.map(_=>new t.DashboardObject(_,this._workbookImpl))}get worksheets(){return this._dashboardImpl.worksheetsImpl.map(_=>new a.Worksheet(_,this._workbookImpl))}get parentStoryPoint(){return this._dashboardImpl.parentStoryPoint==null?null:new n.StoryPoint(this._dashboardImpl.parentStoryPoint,this._workbookImpl)}getFiltersAsync(){return this._dashboardImpl.getFiltersAsync()}applyFilterAsync(_,l,w,T){return this._dashboardImpl.applyFilterAsync(_,l,w,T)}};return Ty.Dashboard=u,Ty}var $v={};Object.defineProperty($v,"__esModule",{value:!0});class kY{constructor(e){this.parameterImpl=e}get name(){return this.parameterImpl.name}get currentValue(){return this.parameterImpl.currentValue}get dataType(){return this.parameterImpl.dataType}get allowableValues(){return this.parameterImpl.allowableValues}get id(){return this.parameterImpl.id}changeValueAsync(e){return this.parameterImpl.changeValueAsync(e)}}$v.Parameter=kY;var My={},$D;function PY(){if($D)return My;$D=1;var t=$e&&$e.__importStar||function(d){if(d&&d.__esModule)return d;var _={};if(d!=null)for(var l in d)Object.hasOwnProperty.call(d,l)&&(_[l]=d[l]);return _.default=d,_};Object.defineProperty(My,"__esModule",{value:!0});const e=t(Nt),n=sn(),a=Wv();let u=class{constructor(_,l){this._sheetInfoImpl=_,this._workbookImpl=l}get name(){return this._sheetInfoImpl.name}get sheetType(){return this._sheetInfoImpl.sheetType}get index(){if(this._sheetInfoImpl.index!==void 0)return this._sheetInfoImpl.index;throw new n.TableauError(e.EmbeddingErrorCodes.ImplementationError,"index not implemented")}get isActive(){return this._sheetInfoImpl.isActive?this._sheetInfoImpl.isActive:!1}get isHidden(){return this._sheetInfoImpl.isHidden?this._sheetInfoImpl.isHidden:!1}get workbook(){return new a.Workbook(this._workbookImpl)}get url(){return this._sheetInfoImpl.url?this._sheetInfoImpl.url:""}get size(){if(n.SheetUtils.isValidSheetSize(this._sheetInfoImpl.sheetSize))return this._sheetInfoImpl.sheetSize;throw new n.TableauError(e.EmbeddingErrorCodes.NotImplemented,"Not implemented")}};return My.SheetInfo=u,My}var WD;function Wv(){if(WD)return Sy;WD=1;var t=$e&&$e.__importStar||function(C){if(C&&C.__esModule)return C;var P={};if(C!=null)for(var z in C)Object.hasOwnProperty.call(C,z)&&(P[z]=C[z]);return P.default=C,P};Object.defineProperty(Sy,"__esModule",{value:!0});const e=t(Nt),n=sn(),a=LO(),u=Vv(),d=$v,_=PY(),l=gA(),w=jv();let T=class{constructor(P){this._workbookImpl=P}get activeSheet(){switch(this._workbookImpl.activeSheet.sheetType){case e.SheetType.Worksheet:return new w.Worksheet(this._workbookImpl.activeSheet,this._workbookImpl);case e.SheetType.Dashboard:return new u.Dashboard(this._workbookImpl.activeSheet,this._workbookImpl);case e.SheetType.Story:return new l.Story(this._workbookImpl.activeSheet,this._workbookImpl);default:throw new n.TableauError(e.EmbeddingErrorCodes.ImplementationError,"Unable to initialize ActiveSheet")}}get publishedSheetsInfo(){return this._workbookImpl.publishedSheetsInfo.map(P=>new _.SheetInfo(P,this._workbookImpl))}get name(){return this._workbookImpl.name}get activeCustomView(){if(this._workbookImpl.activeCustomView)return new a.CustomView(this._workbookImpl.activeCustomView,this._workbookImpl)}activateSheetAsync(P){return this._workbookImpl.activateSheetAsync(P).then(z=>(this._workbookImpl!==z&&(this._workbookImpl=z),this.activeSheet))}revertAllAsync(){return this._workbookImpl.revertAllAsync()}getCustomViewsAsync(){return this._workbookImpl.getCustomViewsAsync().then(P=>P.map(z=>new a.CustomView(z,this._workbookImpl)))}showCustomViewAsync(P){return this._workbookImpl.showCustomViewAsync(P).then(z=>z?new a.CustomView(z,this._workbookImpl):void 0)}removeCustomViewAsync(P){return this._workbookImpl.removeCustomViewAsync(P).then(z=>new a.CustomView(z,this._workbookImpl))}saveCustomViewAsync(P){return this._workbookImpl.saveCustomViewAsync(P).then(z=>new a.CustomView(z,this._workbookImpl))}setActiveCustomViewAsDefaultAsync(){return this._workbookImpl.setActiveCustomViewAsDefaultAsync()}getParametersAsync(){return this._workbookImpl.getParametersAsync().then(P=>P.map(z=>new d.Parameter(z)))}changeParameterValueAsync(P,z){return this._workbookImpl.changeParameterValueAsync(P,z).then($=>{if($)return new d.Parameter($);throw new n.TableauError(e.EmbeddingErrorCodes.InvalidParameter,`Invalid parameter:  ${P}`)})}};return Sy.Workbook=T,Sy}var GD;function LO(){if(GD)return Ey;GD=1,Object.defineProperty(Ey,"__esModule",{value:!0});const t=Wv();let e=class FO{constructor(a,u){this._customViewImpl=a,this._workbookImpl=u}get name(){return this._customViewImpl.name}set name(a){this._customViewImpl.name=a}get shared(){return this._customViewImpl.shared}set shared(a){this._customViewImpl.shared=a}get default(){return this._customViewImpl.isDefault}set default(a){this._customViewImpl.isDefault=a}get ownerName(){return this._customViewImpl.ownerName}get url(){return this._customViewImpl.url}get workbook(){return new t.Workbook(this._workbookImpl)}saveAsync(){return this._customViewImpl.saveAsync().then(a=>new FO(a,this._workbookImpl))}};return Ey.CustomView=e,Ey}var yA={};Object.defineProperty(yA,"__esModule",{value:!0});class DY{constructor(e,n){this._sheetSize=e,this._chromeHeight=n}get sheetSize(){return this._sheetSize}get chromeHeight(){return this._chromeHeight}}yA.VizSize=DY;var Gv={},Hd={},_A={};Object.defineProperty(_A,"__esModule",{value:!0});const MY=hr(),zY=sn();class RY extends zY.ServiceImplBase{get serviceName(){return"authentication"}setAuthToken(e){const n={authToken:e};return this.execute(MY.VerbId.Authenticate,n).then(a=>{})}}_A.AuthServiceImpl=RY;var vA={};Object.defineProperty(vA,"__esModule",{value:!0});const HD=Nt,xs=hr(),Yb=sn();class OY extends Yb.ServiceImplBase{get serviceName(){return"EmbeddingVizApiService"}getEmbeddingVizStateWithDataModelAsync(){const e=xs.VerbId.GetVizStateWithDataModel,n={[xs.ParameterId.FunctionName]:"getVizStateWithDataModel"};return this.execute(e,n).then(a=>{const u=a.result;return this.checkForErrorParameter(u),{vizStateWithDataModel:u[xs.ParameterId.VizAPIStateWithDataModel]}})}checkForErrorParameter(e){if(e[xs.ParameterId.VizAPIStateWarningMsg])throw new Yb.TableauError(HD.ErrorCodes.InternalError,e[xs.ParameterId.VizAPIStateWarningMsg])}setEmbeddingVizStateWithDataModelAsync(e){const n=xs.VerbId.SetVizStateWithDataModel,a={[xs.ParameterId.FunctionName]:"setVizStateWithDataModel",[xs.ParameterId.VizAPIStateWithDataModel]:e.vizStateWithDataModel};return this.execute(n,a).then(u=>{if(Object.keys(u.result).length!==0){const d=u.result;throw new Yb.TableauError(HD.ErrorCodes.InternalError,d)}})}getEmbeddingAbstractQueryAsync(){const e=xs.VerbId.GetEmbeddingAbstractQueryWithDataModel,n={[xs.ParameterId.FunctionName]:"getEmbeddingAbstractQuery"};return this.execute(e,n).then(a=>a.result)}}vA.EmbeddingVizApiServiceImpl=OY;var xA={};Object.defineProperty(xA,"__esModule",{value:!0});const FY=sn();class LY extends FY.NotificationServiceImplBase{get serviceName(){return"initialization-service"}}xA.InitializationServiceImpl=LY;var bA={};Object.defineProperty(bA,"__esModule",{value:!0});const In=hr(),BY=sn();class NY extends BY.ServiceImplBase{get serviceName(){return"ToolbarService"}revertAllAsync(){const e=In.VerbId.RevertWorkbook,n={[In.ParameterId.FunctionName]:"revertAllAsync"};return this.execute(e,n).then(a=>{})}redoAsync(){const e=In.VerbId.Redo,n={[In.ParameterId.FunctionName]:"redoAsync"};return this.execute(e,n).then(a=>{})}undoAsync(){const e=In.VerbId.Undo,n={[In.ParameterId.FunctionName]:"undoAsync"};return this.execute(e,n).then(a=>{})}exportImageAsync(){const e=In.VerbId.ExportImage,n={[In.ParameterId.FunctionName]:"exportImageAsync"};return this.execute(e,n).then(a=>{})}setAutoUpdateAsync(e){const n=In.VerbId.SetAutoUpdate,a={[In.ParameterId.FunctionName]:"setAutoUpdateAsync",[In.ParameterId.State]:e};return this.execute(n,a).then(()=>{})}displayDownloadWorkbookDialogAsync(){const e=In.VerbId.DownloadWorkbook,n={[In.ParameterId.FunctionName]:"displayDialogAsync(Workbook)"};return this.execute(e,n).then(a=>{})}displayExportPdfDialogAsync(){const e=In.VerbId.ExportPdf,n={[In.ParameterId.FunctionName]:"displayDialogAsync(ExportPDF)"};return this.execute(e,n).then(a=>{})}displayExportPowerpointDialogAsync(){const e=In.VerbId.ExportPowerpoint,n={[In.ParameterId.FunctionName]:"displayDialogAsync(ExportPowerPoint)"};return this.execute(e,n).then(a=>{})}displayExportDataDialogAsync(){const e=In.VerbId.ExportData,n={[In.ParameterId.FunctionName]:"displayDialogAsync(ExportData)"};return this.execute(e,n).then(a=>{})}displayExportCrosstabDialogAsync(){const e=In.VerbId.ExportCrosstab,n={[In.ParameterId.FunctionName]:"displayDialogAsync(ExportCrossTab)"};return this.execute(e,n).then(a=>{})}displayShareDialogAsync(){const e=In.VerbId.Share,n={[In.ParameterId.FunctionName]:"displayDialogAsync(Share)"};return this.execute(e,n).then(a=>{})}}bA.ToolbarServiceImpl=NY;Object.defineProperty(Hd,"__esModule",{value:!0});const md=sn(),UY=_A,jY=vA,VY=xA,$Y=bA;function WY(t,e){const n=md.ApiServiceRegistry.get(e);n.registerService(new md.ClientInfoServiceImpl(t,e)),n.registerService(new jY.EmbeddingVizApiServiceImpl(t,e)),n.registerService(new md.SizeServiceImpl(t,e)),n.registerService(new md.StoryActivationServiceImpl(t,e)),n.registerService(new $Y.ToolbarServiceImpl(t,e))}Hd.registerAllEmbeddingServices=WY;function GY(t,e){md.ApiServiceRegistry.get(e).registerService(new VY.InitializationServiceImpl(t))}Hd.registerInitializationEmbeddingServices=GY;function HY(t,e){md.ApiServiceRegistry.get(e).registerService(new UY.AuthServiceImpl(t,e))}Hd.registerAuthServices=HY;Object.defineProperty(Gv,"__esModule",{value:!0});var BO=Hd;Gv.registerAllEmbeddingServices=BO.registerAllEmbeddingServices;Gv.registerInitializationEmbeddingServices=BO.registerInitializationEmbeddingServices;var Qb=$e&&$e.__awaiter||function(t,e,n,a){function u(d){return d instanceof n?d:new n(function(_){_(d)})}return new(n||(n=Promise))(function(d,_){function l(C){try{T(a.next(C))}catch(P){_(P)}}function w(C){try{T(a.throw(C))}catch(P){_(P)}}function T(C){C.done?d(C.value):u(C.value).then(l,w)}T((a=a.apply(t,e||[])).next())})},qY=$e&&$e.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(uA,"__esModule",{value:!0});const Ir=qY(Nt),Jh=dT,ni=hr(),Qr=sn(),ZY=e0,KY=hA,XY=dA,YY=pA,qD=fA,QY=LO(),JY=yA,ZD=Gv,eQ=Hd,tQ=Bv;class rQ{constructor(e,n,a,u){if(this._viz=e,this._iframe=n,this._frameUrl=a,this._embeddingId=u,this._automaticUpdatesArePaused=!1,this._resizeEventType="resize",!this._iframe)throw new Qr.TableauError(Ir.EmbeddingErrorCodes.InternalError,"Iframe has not been created yet")}get workbookImpl(){return this._workbookImpl}get iframe(){return this._iframe}get embeddingId(){return this._embeddingId}get exportScenariosForPdfAndPowerPoint(){return{currentSheetName:this._workbookImpl.activeSheet.name,exportableSheetNamesFromDashboard:this.exportableSheetNamesFromDashboard,exportableSheetNamesFromWorkbook:this.exportableSheetNamesFromWorkbook}}get exportableSheetNamesFromDashboard(){const e=this._workbookImpl.activeSheet;return e&&e.sheetType===Ir.SheetType.Dashboard?e.getWorksheetNamesFromZones():[]}get exportableSheetNamesFromWorkbook(){const e=[];if(this._workbookImpl)for(const n of this._workbookImpl.publishedSheetsInfo)e.push(n.name);return e}get automaticUpdatesArePaused(){return this._automaticUpdatesArePaused}set automaticUpdatesArePaused(e){this._automaticUpdatesArePaused=e}getVisualIdForSheetName(e){var n,a,u;const d=this._workbookImpl.activeSheet;switch(d.sheetType){case Ir.SheetType.Worksheet:if(d.name===e)return d.visualId;break;case Ir.SheetType.Dashboard:{const _=d;for(const l of _.getWorksheetNamesFromZones())if(l===e)return{worksheet:l,dashboard:_.name};break}case Ir.SheetType.Story:{const _=d,l=(n=_.activeStoryPoint)===null||n===void 0?void 0:n.containedSheet;if(l&&l.sheetType===Ir.SheetType.Worksheet&&l.name===e){const w=Object.assign({},l.visualId);return w.dashboard=w.worksheet,w.storyboard=_.name,w.storyPointID=(a=_.activeStoryPoint)===null||a===void 0?void 0:a.storyPointId,w}else if(l&&l.sheetType===Ir.SheetType.Dashboard){const w=l;for(const T of w.getWorksheetNamesFromZones())if(T===e)return{worksheet:T,dashboard:w.name,storyboard:_.name,storyPointID:(u=_.activeStoryPoint)===null||u===void 0?void 0:u.storyPointId}}break}default:throw new Qr.TableauError(Ir.SharedErrorCodes.ServerError,"Invalid SheetType")}throw new Qr.TableauError(Ir.SharedErrorCodes.InvalidParameter,"sheetName parameter must belong to a worksheet within the current view")}get exportableWorksheetNames(){var e;const n=this._workbookImpl.activeSheet;switch(n.sheetType){case Ir.SheetType.Worksheet:return[n.name];case Ir.SheetType.Dashboard:return n.getWorksheetNamesFromZones();case Ir.SheetType.Story:{const a=(e=n.activeStoryPoint)===null||e===void 0?void 0:e.containedSheet;if(a&&a.sheetType===Ir.SheetType.Worksheet)return[a.name];if(a&&a.sheetType===Ir.SheetType.Dashboard)return a.getWorksheetNamesFromZones();break}}return[]}initializeViz(){const e=this._iframe.contentWindow;if(!e)throw new Qr.TableauError(Ir.EmbeddingErrorCodes.InternalError,"Iframe has not been created yet");try{this._messenger=new ni.CrossFrameMessenger(window,e,this._frameUrl.origin),this._dispatcher=new Qr.CrossFrameDispatcher(this._messenger),ZD.registerInitializationEmbeddingServices(this._dispatcher,this.embeddingId),eQ.registerAuthServices(this._dispatcher,this.embeddingId);const n=Qr.ApiServiceRegistry.get(this.embeddingId).getService("initialization-service"),a=n.registerHandler(ni.NotificationId.FirstVizSizeKnown,()=>!0,d=>{this.handleVizSizeKnownEvent(d),a()}),u=n.registerHandler(ni.NotificationId.VizInteractive,()=>!0,d=>{this.handleVizInteractiveEvent(d),u()});n.registerHandler(ni.NotificationId.ReadyToReceiveAuthToken,()=>!0,()=>{this._viz.dispatchEvent(new CustomEvent(Ir.EmbeddingTableauEventType.ReadyToReceiveAuthToken,{}))}),n.registerHandler(ni.NotificationId.ToolbarStateChanged,()=>!0,d=>this.handleToolbarStateEvent(d)),n.registerHandler(ni.NotificationId.TabSwitched,()=>!0,d=>this.handleTabSwitch(d)),n.registerHandler(ni.NotificationId.CustomViewsLoaded,()=>!0,d=>this.handleCustomViews(d)),n.registerHandler(ni.NotificationId.CustomViewRemoved,()=>!0,d=>this.handleCustomViewRemoved(d)),n.registerHandler(ni.NotificationId.CustomViewSaved,()=>!0,d=>this.handleCustomViewSaved(d)),n.registerHandler(ni.NotificationId.CustomViewSetDefault,()=>!0,d=>this.handleCustomViewSetDefault(d)),this._messenger.startListening()}catch{throw new Qr.TableauError(Ir.EmbeddingErrorCodes.InternalError,"Unexpected error during initialization.")}}dispose(){this._messenger&&this._messenger.stopListening(),this.removeWindowResizeHandler()}getCurrentSrcAsync(){return Qr.ApiServiceRegistry.get(this.embeddingId).getService("viz-service").getCurrentSrcAsync()}revertAllAsync(){return Qr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService").revertAllAsync()}redoAsync(){return Qr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService").redoAsync()}undoAsync(){return Qr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService").undoAsync()}refreshDataAsync(){return Qr.ApiServiceRegistry.get(this.embeddingId).getService("data-source-service").refreshAsync()}pauseAutomaticUpdatesAsync(){return this._automaticUpdatesArePaused?Promise.resolve():this.setAutoUpdateAsync(!1)}resumeAutomaticUpdatesAsync(){return this._automaticUpdatesArePaused?this.setAutoUpdateAsync(!0):Promise.resolve()}toggleAutomaticUpdatesAsync(){return this.setAutoUpdateAsync(this._automaticUpdatesArePaused)}exportImageAsync(){return Qr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService").exportImageAsync()}exportCrosstabAsync(e,n){return Qb(this,void 0,void 0,function*(){yield Qr.ApiServiceRegistry.get(this.embeddingId).getService("export-service").exportCrosstabAsync(e,n,this.exportableWorksheetNames,this._workbookImpl.activeSheet.sheetType)})}exportDataAsync(e,n=Qr.ExportHelpers.DefaultDataOptions){return Qr.ApiServiceRegistry.get(this.embeddingId).getService("export-service").exportDataAsync(this.getVisualIdForSheetName(e),n)}exportPowerPointAsync(e=[]){return Qb(this,void 0,void 0,function*(){const n=Qr.ApiServiceRegistry.get(this.embeddingId).getService("export-service"),a=this.exportScenariosForPdfAndPowerPoint;e.length===0&&e.push(a.currentSheetName),yield n.exportPowerPointAsync(e,a)})}exportPDFAsync(e=[],n=Qr.ExportHelpers.DefaultPDFOptions){return Qb(this,void 0,void 0,function*(){const a=Qr.ApiServiceRegistry.get(this.embeddingId).getService("export-service"),u=this.exportScenariosForPdfAndPowerPoint;e.length===0&&e.push(u.currentSheetName),yield a.exportPDFAsync(e,n,u)})}displayDialogAsync(e){const n=Qr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService");switch(e){case Jh.TableauDialogType.ExportWorkbook:if(!this.workbookImpl.canDownloadWorkbook)throw new Qr.TableauError(Ir.EmbeddingErrorCodes.DownloadWorkbookNotAllowed,"Download workbook is not allowed");return n.displayDownloadWorkbookDialogAsync();case Jh.TableauDialogType.ExportPDF:return n.displayExportPdfDialogAsync();case Jh.TableauDialogType.ExportPowerPoint:return n.displayExportPowerpointDialogAsync();case Jh.TableauDialogType.ExportData:return n.displayExportDataDialogAsync();case Jh.TableauDialogType.ExportCrossTab:return n.displayExportCrosstabDialogAsync();case Jh.TableauDialogType.Share:return n.displayShareDialogAsync();default:throw new Qr.TableauError(Ir.EmbeddingErrorCodes.UnknownDialogType,"Unknown dialog type")}}setAuthToken(e){Qr.ApiServiceRegistry.get(this.embeddingId).getService("authentication").setAuthToken(e)}setAutoUpdateAsync(e){return Qr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService").setAutoUpdateAsync(e).then(()=>{this._automaticUpdatesArePaused=!e})}isVersionCompatible(e){return e?ni.VersionLessThan(ni.INTERNAL_CONTRACT_VERSION,e)||ni.VersionEqualTo(ni.INTERNAL_CONTRACT_VERSION,e):!1}updateIframeTitle(e){this._iframe.setAttribute("title",ZY.getLocalizedTitle(navigator.language)+": "+e.workbookName+": "+e.currWorksheetName)}handleVizInteractiveEvent(e){if(!this._viz.disableVersionCheck&&!this.isVersionCompatible(e.platformVersion))throw this._messenger.stopListening(),new Qr.TableauError(Ir.EmbeddingErrorCodes.IncompatibleVersionError,"The version of the Embedding library is not compatible with the version of Tableau. The visualization will load, but the Embedding API methods and events are not available.");this.updateIframeTitle(e),Qr.registerAllSharedServices(this._dispatcher,this.embeddingId),ZD.registerAllEmbeddingServices(this._dispatcher,this.embeddingId),this._viz.initializeEvents(),this._workbookImpl=new qD.EmbeddingWorkbookImpl(e,this.embeddingId);let n=[];this._customViewsTemp&&(n=this._workbookImpl.processCustomViews(ni.NotificationId.CustomViewsLoaded,this._customViewsTemp)),this._viz.dispatchEvent(new CustomEvent(Ir.EmbeddingTableauEventType.FirstInteractive)),this._customViewsTemp&&(this.sendCustomViewEvents(Ir.EmbeddingTableauEventType.CustomViewLoaded,n),this._customViewsTemp=null)}handleVizSizeKnownEvent(e){const n=Qr.SheetUtils.getSheetSizeFromSizeConstraints(e.sheetSize);this._vizSize=new JY.VizSize(n,e.chromeHeight);const a=new KY.FirstVizSizeKnownEvent(this._vizSize);this._viz.dispatchEvent(new CustomEvent(Ir.EmbeddingTableauEventType.FirstVizSizeKnown,{detail:a})),!this._viz.fixedSize&&(this.resize(),this.addWindowResizeHandler())}resize(){const{height:e,width:n}=this.calculateLayoutSize();e!==this._vizSize.chromeHeight&&(this._iframe.style.height=e+"px",this._iframe.style.width=n+"px")}calculateLayoutSize(){const e=this._viz.parentElement?tQ.HtmlElementHelpers.getContentSize(this._viz.parentElement):{height:0,width:0},{chromeHeight:n,sheetSize:a}=this._vizSize;let u=0,d=0;const _=a.minSize||{height:0,width:0},l=a.maxSize||{height:0,width:0};if(a.behavior===Ir.SheetSizeBehavior.Exactly)u=l.width,d=l.height+n;else{let w,T,C,P;switch(a.behavior){case Ir.SheetSizeBehavior.Range:w=_.width,T=l.width,C=_.height+n,P=l.height+n,u=Math.max(w,Math.min(T,e.width)),d=Math.max(C,Math.min(P,e.height));break;case Ir.SheetSizeBehavior.AtLeast:w=_.width,C=_.height+n,u=Math.max(w,e.width),d=Math.max(C,e.height);break;case Ir.SheetSizeBehavior.AtMost:T=l.width,P=l.height+n,u=Math.min(T,e.width),d=Math.min(P,e.height);break;case Ir.SheetSizeBehavior.Automatic:u=e.width,d=Math.max(e.height,n);break;default:throw new Qr.TableauError(Ir.EmbeddingErrorCodes.InvalidSizeBehavior,"Unknown SheetSizeBehavior for viz: "+a.behavior)}}return{height:d,width:u}}removeWindowResizeHandler(){this._windowResizeHandler&&window.removeEventListener(this._resizeEventType,this._windowResizeHandler)}addWindowResizeHandler(){this._windowResizeHandler||(this._windowResizeHandler=this.resize.bind(this),window.addEventListener(this._resizeEventType,this._windowResizeHandler))}handleToolbarStateEvent(e){const n=new YY.ToolbarStateChangedEvent(e.toolbarState.canRedo,e.toolbarState.canUndo);this._viz.dispatchEvent(new CustomEvent(Ir.EmbeddingTableauEventType.ToolbarStateChanged,{detail:n}))}handleTabSwitch(e){if(!this._workbookImpl||!e.oldSheetName)return;this.updateIframeTitle(e);const n=this._workbookImpl.pendingTabSwitchPromise;this._workbookImpl.updateExistingActiveSheetReferences(e.currWorksheetName),this._workbookImpl=new qD.EmbeddingWorkbookImpl(e,this.embeddingId),n&&n.resolve(this._workbookImpl);const a=new XY.TabSwitchedEvent(e.oldSheetName,e.currWorksheetName);this._viz.dispatchEvent(new CustomEvent(Ir.EmbeddingTableauEventType.TabSwitched,{detail:a}))}handleCustomViews(e){if(!this._workbookImpl)this._customViewsTemp=e;else{const n=this._workbookImpl.processCustomViews(ni.NotificationId.CustomViewsLoaded,e),a=this._workbookImpl.pendingShowCustomViewPromise;if(a){const u=n[0];a.resolve(u),this._workbookImpl.clearPendingShowCustomViewPromise()}this.sendCustomViewEvents(Ir.EmbeddingTableauEventType.CustomViewLoaded,n)}}handleCustomViewRemoved(e){const n=this._workbookImpl.processCustomViews(ni.NotificationId.CustomViewRemoved,e);this.sendCustomViewEvents(Ir.EmbeddingTableauEventType.CustomViewRemoved,n)}handleCustomViewSaved(e){const n=this._workbookImpl.processCustomViews(ni.NotificationId.CustomViewSaved,e);this.sendCustomViewEvents(Ir.EmbeddingTableauEventType.CustomViewSaved,n)}handleCustomViewSetDefault(e){const n=this._workbookImpl.processCustomViews(ni.NotificationId.CustomViewSetDefault,e);this.sendCustomViewEvents(Ir.EmbeddingTableauEventType.CustomViewSetDefault,n)}sendCustomViewEvents(e,n){for(let a of n){const u={customView:new QY.CustomView(a,this._workbookImpl)};this._viz.dispatchEvent(new CustomEvent(e,{detail:u}))}}}uA.VizImpl=rQ;var KD=$e&&$e.__awaiter||function(t,e,n,a){function u(d){return d instanceof n?d:new n(function(_){_(d)})}return new(n||(n=Promise))(function(d,_){function l(C){try{T(a.next(C))}catch(P){_(P)}}function w(C){try{T(a.throw(C))}catch(P){_(P)}}function T(C){C.done?d(C.value):u(C.value).then(l,w)}T((a=a.apply(t,e||[])).next())})},nQ=$e&&$e.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(Gd,"__esModule",{value:!0});const Ei=nQ(Nt),iQ=hr(),XD=sn(),oQ=uA,aQ=Tc,YD=Uu,QD=e0;class NO extends QD.TableauWebComponent{disconnectedCallback(){super.disconnectedCallback(),this._vizImpl&&this._vizImpl.dispose()}static get observedAttributes(){return[...super.observedAttributes,...Object.values(Ei.VizSharedAttributes)]}updateRenderingIfInitialized(e){return KD(this,void 0,void 0,function*(){if(this._initialized)return this._vizImpl&&this._vizImpl.dispose(),YD.WebComponentManager.unregisterWebComponent(this._embeddingIdCounter),this.updateRendering(e)})}updateRendering(e){return KD(this,void 0,void 0,function*(){try{if(this._initialized=!0,!e){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if((yield this.auth(aQ.getSiteId(e)))===QD.TableauAuthResponse.Failure){console.debug("Authentication failed.");return}if(!this.src){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if(!this.iframe){console.debug("No iframe available to update the src.");return}this._embeddingIdCounter=YD.WebComponentManager.registerWebComponent(this),this.registerAttributeEvents();const a=this.createFrameUrlWithParams();this._vizImpl=this.createAndInitializeVizImpl(a),this.iframe.src=a.toString(),this.raiseIframeSrcUpdatedNotification();return}catch(n){console.debug(n)}})}createAndInitializeVizImpl(e){const n=new oQ.VizImpl(this,this.iframe,e,this._embeddingIdCounter);return n.initializeViz(),n}registerAttributeEvents(){this.getAttributeEvents().forEach(e=>{const[n,a]=e;this.registerCallback(n,a)})}initializeEvents(){let e;try{e=XD.ApiServiceRegistry.get(this.vizImpl.embeddingId).getService("notification-service")}catch{throw new XD.TableauError(Ei.EmbeddingErrorCodes.EventInitializationError,"Event initialization failed")}const n=this.getRegisteredEvents();for(const[a,u,d]of n)e.registerHandler(a,u,d)}getRegisteredEvents(){return[[iQ.NotificationId.EditInDesktopButtonClicked,()=>!0,()=>this.dispatchEvent(new CustomEvent(Ei.EmbeddingTableauEventType.EditInDesktopButtonClicked))]]}get touchOptimize(){return this.hasAttribute(Ei.VizSharedAttributes.TouchOptimize)}set touchOptimize(e){e?this.setAttribute(Ei.VizSharedAttributes.TouchOptimize,""):this.removeAttribute(Ei.VizSharedAttributes.TouchOptimize)}get vizImpl(){return this._vizImpl}get hideEditInDesktopButton(){return this.hasAttribute(Ei.VizSharedAttributes.HideEditInDesktopButton)}set hideEditInDesktopButton(e){e?this.setAttribute(Ei.VizSharedAttributes.HideEditInDesktopButton,""):this.removeAttribute(Ei.VizSharedAttributes.HideEditInDesktopButton)}get suppressDefaultEditBehavior(){return this.hasAttribute(Ei.VizSharedAttributes.SuppressDefaultEditBehavior)}set suppressDefaultEditBehavior(e){e?this.setAttribute(Ei.VizSharedAttributes.SuppressDefaultEditBehavior,""):this.removeAttribute(Ei.VizSharedAttributes.SuppressDefaultEditBehavior)}get disableVersionCheck(){return this.hasAttribute(Ei.VizSharedAttributes.DisableVersionCheck)}set disableVersionCheck(e){e?this.setAttribute(Ei.VizSharedAttributes.DisableVersionCheck,""):this.removeAttribute(Ei.VizSharedAttributes.DisableVersionCheck)}getCurrentSrcAsync(){return this.vizImpl.getCurrentSrcAsync()}resize(){this.vizImpl.resize()}}Gd.TableauVizBase=NO;NO.VizAttributeDefaults={device:Ei.DeviceType.Default,toolbar:Ei.Toolbar.Bottom};function sQ(t){if(!t||t.length<1)return"";const e=t.toLowerCase();return e[0].toUpperCase()+e.substring(1)}Gd.attributeToEnumKey=sQ;var lQ=$e&&$e.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(Nv,"__esModule",{value:!0});const Fn=lQ(Nt),Jb=hr(),cQ=aA,JD=cA,uQ=Gd;class hQ extends uQ.TableauVizBase{static get observedAttributes(){return[...super.observedAttributes,...Object.values(Fn.VizAuthoringAttributes)]}getAttributeEvents(){return[[Fn.VizSharedAttributes.OnEditInDesktopButtonClicked,Fn.EmbeddingTableauEventType.EditInDesktopButtonClicked],[Fn.VizSharedAttributes.OnFirstInteractive,Fn.EmbeddingTableauEventType.FirstInteractive],[Fn.VizSharedAttributes.OnFirstVizSizeKnown,Fn.EmbeddingTableauEventType.FirstVizSizeKnown],[Fn.VizAuthoringAttributes.OnWorkbookPublished,Fn.EmbeddingTableauEventType.WorkbookPublished],[Fn.VizAuthoringAttributes.OnWorkbookPublishedAs,Fn.EmbeddingTableauEventType.WorkbookPublishedAs],[Fn.VizAuthoringAttributes.OnWorkbookReadyToClose,Fn.EmbeddingTableauEventType.WorkbookReadyToClose],[Fn.VizAttributes.OnReadyToReceiveAuthToken,Fn.EmbeddingTableauEventType.ReadyToReceiveAuthToken]]}createFrameUrlWithParams(){const e=this.constructVizqlOptions(),n=this.readCustomParamsFromChildren();return JD.createVizUrl(this.src,JD.EmbeddingUrlMode.Authoring,e,this._embeddingIdCounter,[],[],n)}constructVizqlOptions(){return{token:this.token,touchOptimize:this.touchOptimize,hideEditInDesktopButton:this.hideEditInDesktopButton,suppressDefaultEditBehavior:this.suppressDefaultEditBehavior,hideCloseButton:this.hideCloseButton,debug:this.debug,iframeAuth:this.iframeAuth}}getRegisteredEvents(){return super.getRegisteredEvents().concat([[Jb.NotificationId.WorkbookPublished,()=>!0,()=>this.dispatchEvent(new CustomEvent(Fn.EmbeddingTableauEventType.WorkbookPublished))],[Jb.NotificationId.WorkbookPublishedAs,()=>!0,e=>this.handleWorkbookPublishedAsEvent(e)],[Jb.NotificationId.WorkbookReadyToClose,()=>!0,()=>this.dispatchEvent(new CustomEvent(Fn.EmbeddingTableauEventType.WorkbookReadyToClose))]])}handleWorkbookPublishedAsEvent(e){const n={newUrl:e.newUrl};this.dispatchEvent(new CustomEvent(Fn.EmbeddingTableauEventType.WorkbookPublishedAs,{detail:n}))}set hideCloseButton(e){e?this.setAttribute(Fn.VizAuthoringAttributes.HideCloseButton,""):this.removeAttribute(Fn.VizAuthoringAttributes.HideCloseButton)}get hideCloseButton(){return this.hasAttribute(Fn.VizAuthoringAttributes.HideCloseButton)}get workbook(){return new cQ.AuthoringWorkbook(this.vizImpl.workbookImpl,this.vizImpl.embeddingId)}setAuthToken(e){this.vizImpl.setAuthToken(e)}}Nv.TableauAuthoringViz=hQ;var Hv={},qv={};Object.defineProperty(qv,"__esModule",{value:!0});const dQ=Nt,Jl=hr(),UO=sn(),jO=Tc;function pQ(t,e,n){const a=t.split("?")[0];let u;try{u=new URL(a),jO.validateUrl(u)}catch(l){throw new UO.TableauError(dQ.EmbeddingErrorCodes.InvalidUrl,l.message)}const d=fQ();return new VO(u).appendDefaultParameters(d).appendUserOptions(e).appendCustomParams(n).build()}qv.createPulseUrl=pQ;function fQ(t){const e=new Map,n=`${Jl.INTERNAL_CONTRACT_VERSION.major}.${Jl.INTERNAL_CONTRACT_VERSION.minor}.${Jl.INTERNAL_CONTRACT_VERSION.fix}`;e.set(Jl.PulseOptionNames.ApiInternalVersion,n),e.set(Jl.PulseOptionNames.embed,"y");const a=UO.ApiVersion.Instance.formattedValue;return e.set(Jl.PulseOptionNames.ApiExternalVersion,a),e.set(Jl.PulseOptionNames.PulseWebComponent,"true"),e}class VO extends jO.EmbeddingUrlBuilder{constructor(e){super(),this._url=e,this._optionNames=Jl.PulseOptionNames}sanitizeParameterValue(e,n){return this.sanitizeValue(n)}}qv.EmbeddingPulseUrlBuilder=VO;var eM=$e&&$e.__awaiter||function(t,e,n,a){function u(d){return d instanceof n?d:new n(function(_){_(d)})}return new(n||(n=Promise))(function(d,_){function l(C){try{T(a.next(C))}catch(P){_(P)}}function w(C){try{T(a.throw(C))}catch(P){_(P)}}function T(C){C.done?d(C.value):u(C.value).then(l,w)}T((a=a.apply(t,e||[])).next())})};Object.defineProperty(Hv,"__esModule",{value:!0});const bs=Nt,mQ=qv,gQ=Tc,tM=Uu,yQ=Gd,rM=e0;class _Q extends rM.TableauWebComponent{constructor(){super()}static get observedAttributes(){return[...super.observedAttributes,...Object.values(bs.PulseAttributes)]}updateRenderingIfInitialized(e){return eM(this,void 0,void 0,function*(){if(this._initialized)return tM.WebComponentManager.unregisterWebComponent(this._embeddingIdCounter),this.updateRendering(e)})}updateRendering(e){return eM(this,void 0,void 0,function*(){try{if(this._initialized=!0,!e){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if(!this.token){console.debug(`A token needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if((yield this.auth(gQ.getSiteIdForPulse(e)))===rM.TableauAuthResponse.Failure){console.debug("Authentication failed.");return}if(!this.src){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if(!this.iframe){console.debug("No iframe available to update the src.");return}const a=this.readCustomParamsFromChildren();this._embeddingIdCounter=tM.WebComponentManager.registerWebComponent(this);const u=mQ.createPulseUrl(this.src,this.constructOptions(),a).toString();this.iframe.src=u,this.raiseIframeSrcUpdatedNotification();return}catch(n){console.warn(n)}})}constructOptions(){const e={token:this.token};return this.disableExploreFilter&&(e.disableExploreFilter=this.disableExploreFilter),this.layout&&this.layout!==bs.PulseLayout.Default&&(e.layout=this.layout),e}get disableExploreFilter(){return this.hasAttribute(bs.PulseAttributes.DisableExploreFilter)}set disableExploreFilter(e){e?this.setAttribute(bs.PulseAttributes.DisableExploreFilter,""):this.removeAttribute(bs.PulseAttributes.DisableExploreFilter)}get layout(){const e=yQ.attributeToEnumKey(this.getAttribute(bs.PulseAttributes.Layout)),n=bs.PulseLayout[e];return n||bs.PulseLayout.Default}set layout(e){e?this.setAttribute(bs.PulseAttributes.Layout,e):this.removeAttribute(bs.PulseAttributes.Layout)}}Hv.TableauPulse=_Q;var Zv={},wA={},qd={},EA={};Object.defineProperty(EA,"__esModule",{value:!0});class vQ{constructor(e,n){this._sheet=n}get sheet(){return this._sheet}}EA.TableauSheetEvent=vQ;Object.defineProperty(qd,"__esModule",{value:!0});const xQ=EA;class bQ extends xQ.TableauSheetEvent{constructor(e,n){super(e,n),this._worksheet=n}get worksheet(){return this._worksheet}}qd.TableauWorksheetEvent=bQ;Object.defineProperty(wA,"__esModule",{value:!0});const wQ=Nt,EQ=qd;class SQ extends EQ.TableauWorksheetEvent{constructor(e,n){super(wQ.EmbeddingTableauEventType.CustomMarkContextMenuEvent,e),this._contextMenuId=n}getContextMenuId(){return this._contextMenuId}getSelectedMarksAsync(){return this.worksheet.getSelectedMarksAsync()}}wA.CustomMarkContextMenuEvent=SQ;var SA={};Object.defineProperty(SA,"__esModule",{value:!0});const nM=Nt,TQ=sn(),AQ=qd;class IQ extends AQ.TableauWorksheetEvent{constructor(e,n,a){super(nM.EmbeddingTableauEventType.FilterChanged,e),this._fieldName=n,this._fieldId=a}get fieldName(){return this._fieldName}get fieldId(){return this._fieldId}getFilterAsync(){return this.worksheet.getFiltersAsync().then(e=>{const n=this.fieldId?e.find(a=>a.fieldId===this.fieldId,this):e.find(a=>a.fieldName===this.fieldName,this);if(!n)throw new TQ.TableauError(nM.EmbeddingErrorCodes.FilterMissingOrNotImplemented,`Cannot find filter: ${this._fieldName}.`);return n})}}SA.FilterChangedEvent=IQ;var TA={};Object.defineProperty(TA,"__esModule",{value:!0});const CQ=Nt,kQ=qd;class PQ extends kQ.TableauWorksheetEvent{constructor(e){super(CQ.EmbeddingTableauEventType.MarkSelectionChanged,e)}getMarksAsync(){return this.worksheet.getSelectedMarksAsync()}}TA.MarksSelectedEvent=PQ;var AA={};Object.defineProperty(AA,"__esModule",{value:!0});const DQ=Nt,iM=sn(),MQ=$v;class zQ{constructor(e,n){this._globalFieldName=e,this._embeddingId=n}getParameterAsync(){return iM.ApiServiceRegistry.get(this._embeddingId).getService("parameters-service").findParameterByGlobalFieldNameAsync(this._globalFieldName).then(n=>{if(n===void 0)throw new iM.TableauError(DQ.EmbeddingErrorCodes.MissingParameter,`Cannot find parameter: ${this._globalFieldName}`);return new MQ.Parameter(n)})}}AA.ParameterChangedEvent=zQ;var IA={};Object.defineProperty(IA,"__esModule",{value:!0});const RQ=Uv(),OQ=OO();class FQ{constructor(e,n,a){this._oldStoryPointInfoImpl=e,this._currStoryPointImpl=n,this._workbookImpl=a}get oldStoryPointInfo(){return new OQ.StoryPointInfo(this._oldStoryPointInfoImpl,this._workbookImpl)}get newStoryPoint(){return new RQ.StoryPoint(this._currStoryPointImpl,this._workbookImpl)}}IA.StoryPointSwitchedEvent=FQ;var CA={};Object.defineProperty(CA,"__esModule",{value:!0});const LQ=Nt,BQ=qd;class NQ extends BQ.TableauWorksheetEvent{constructor(e){super(LQ.EmbeddingTableauEventType.SummaryDataChanged,e)}}CA.SummaryDataChangedEvent=NQ;var kA={};Object.defineProperty(kA,"__esModule",{value:!0});class UQ{constructor(e,n){this._url=e,this._target=n}get url(){return this._url}get target(){return this._target}}kA.UrlActionEvent=UQ;var jQ=$e&&$e.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(Zv,"__esModule",{value:!0});const wt=jQ(Nt),Yl=hr(),Kf=sn(),VQ=wA,$Q=SA,WQ=TA,GQ=AA,HQ=IA,qQ=CA,ZQ=kA,oM=cA,KQ=Wv(),XQ=Uu,Xf=Gd;class YQ extends Xf.TableauVizBase{constructor(){super(...arguments),this.preInitFilters=[]}readFiltersFromChild(){const e=[];return[].forEach.call(this.children,n=>{n.localName===wt.VizChildElements.VizFilter&&n.getAttribute(wt.VizChildElementAttributes.Field)&&n.getAttribute(wt.VizChildElementAttributes.Value)!==void 0&&e.push({field:n.getAttribute(wt.VizChildElementAttributes.Field),value:n.getAttribute(wt.VizChildElementAttributes.Value)})}),e}readParametersFromChild(){const e=[];return[].forEach.call(this.children,n=>{n.localName===wt.VizChildElements.VizParameter&&n.getAttribute(wt.VizChildElementAttributes.Name)&&n.getAttribute(wt.VizChildElementAttributes.Value)&&e.push({name:n.getAttribute(wt.VizChildElementAttributes.Name),value:n.getAttribute(wt.VizChildElementAttributes.Value)})}),e}static get observedAttributes(){return[...super.observedAttributes,...Object.values(wt.VizAttributes)]}disconnectedCallback(){this.preInitFilters=[],super.disconnectedCallback()}createFrameUrlWithParams(){const e=this.constructVizqlOptions(),n=this.readFiltersFromChild().concat(this.preInitFilters),a=this.readParametersFromChild(),u=this.readCustomParamsFromChildren();return oM.createVizUrl(this.src,oM.EmbeddingUrlMode.Viewing,e,this._embeddingIdCounter,n,a,u)}constructVizqlOptions(){return{disableUrlActionsPopups:this.disableUrlActionsPopups,hideTabs:this.hideTabs,toolbar:this.toolbar,instanceIdToClone:this.instanceIdToClone,device:this.device,token:this.token,touchOptimize:this.touchOptimize,hideEditButton:this.hideEditButton,hideEditInDesktopButton:this.hideEditInDesktopButton,suppressDefaultEditBehavior:this.suppressDefaultEditBehavior,debug:this.debug,iframeAuth:this.iframeAuth}}getAttributeEvents(){return[[wt.VizAttributes.OnCustomMarkContextMenuEvent,wt.EmbeddingTableauEventType.CustomMarkContextMenuEvent],[wt.VizAttributes.OnEditButtonClicked,wt.EmbeddingTableauEventType.EditButtonClicked],[wt.VizSharedAttributes.OnEditInDesktopButtonClicked,wt.EmbeddingTableauEventType.EditInDesktopButtonClicked],[wt.VizAttributes.OnFilterChanged,wt.EmbeddingTableauEventType.FilterChanged],[wt.VizSharedAttributes.OnFirstInteractive,wt.EmbeddingTableauEventType.FirstInteractive],[wt.VizSharedAttributes.OnFirstVizSizeKnown,wt.EmbeddingTableauEventType.FirstVizSizeKnown],[wt.VizAttributes.OnMarkSelectionChanged,wt.EmbeddingTableauEventType.MarkSelectionChanged],[wt.VizAttributes.OnParameterChanged,wt.EmbeddingTableauEventType.ParameterChanged],[wt.VizAttributes.OnTabSwitched,wt.EmbeddingTableauEventType.TabSwitched],[wt.VizAttributes.OnToolbarStateChanged,wt.EmbeddingTableauEventType.ToolbarStateChanged],[wt.VizAttributes.OnUrlAction,wt.EmbeddingTableauEventType.UrlAction],[wt.VizAttributes.OnCustomViewLoaded,wt.EmbeddingTableauEventType.CustomViewLoaded],[wt.VizAttributes.OnCustomViewRemoved,wt.EmbeddingTableauEventType.CustomViewRemoved],[wt.VizAttributes.OnCustomViewSaved,wt.EmbeddingTableauEventType.CustomViewSaved],[wt.VizAttributes.OnCustomViewSetDefault,wt.EmbeddingTableauEventType.CustomViewSetDefault],[wt.VizAttributes.OnStoryPointSwitched,wt.EmbeddingTableauEventType.StoryPointSwitched],[wt.VizAttributes.OnSummaryDataChanged,wt.EmbeddingTableauEventType.SummaryDataChanged],[wt.VizAttributes.OnReadyToReceiveAuthToken,wt.EmbeddingTableauEventType.ReadyToReceiveAuthToken]]}getRegisteredEvents(){return super.getRegisteredEvents().concat([[Yl.NotificationId.SelectedMarksChanged,e=>this.shouldNotifyEvent(e),e=>this.handleSelectedMarksChangedEvent(e)],[Yl.NotificationId.FilterChanged,e=>this.shouldNotifyEvent(e.visualId),e=>this.handleFilterChangedEvent(e)],[Yl.NotificationId.EditButtonClicked,()=>!0,()=>this.handleEditButtonClicked()],[Yl.NotificationId.CustomMarkContextMenuClicked,e=>this.shouldNotifyEvent(e.visualId),e=>this.handleCustomMarkClickedContextMenuEvent(e)],[Yl.NotificationId.ParameterChanged,()=>!0,e=>this.handleParameterChangedEvent(e)],[Yl.NotificationId.UrlAction,()=>!0,e=>this.handleUrlAction(e)],[Yl.NotificationId.StoryPointSwitched,()=>!0,e=>this.handleStoryPointSwitch(e)],[Yl.NotificationId.SummaryDataChanged,e=>this.shouldNotifyEvent(e.visualId),e=>this.handleSummaryDataChangedEvent(e)]])}shouldNotifyEvent(e){switch(this.workbook.activeSheet.sheetType){case wt.SheetType.Worksheet:return this.workbook.activeSheet.name===e.worksheet;case wt.SheetType.Dashboard:return this.workbook.activeSheet.worksheets.filter(u=>u.name===e.worksheet).length===1;case wt.SheetType.Story:{const a=this.workbook.activeSheet.activeStoryPoint.containedSheet;return a?a.sheetType===wt.SheetType.Worksheet?a.name===e.worksheet:a.sheetType===wt.SheetType.Dashboard?a.worksheets.filter(_=>_.name===e.worksheet).length===1:!1:!1}default:return!1}}handleSelectedMarksChangedEvent(e){const n=new WQ.MarksSelectedEvent(this.getWorksheetForNotificationHandler(e));this.dispatchEvent(new CustomEvent(wt.EmbeddingTableauEventType.MarkSelectionChanged,{detail:n}))}handleFilterChangedEvent(e){const n=new $Q.FilterChangedEvent(this.getWorksheetForNotificationHandler(e.visualId),e.fieldName,e.fieldId);this.dispatchEvent(new CustomEvent(wt.EmbeddingTableauEventType.FilterChanged,{detail:n}))}handleSummaryDataChangedEvent(e){const n=new qQ.SummaryDataChangedEvent(this.getWorksheetForNotificationHandler(e.visualId));this.dispatchEvent(new CustomEvent(wt.EmbeddingTableauEventType.SummaryDataChanged,{detail:n}))}handleEditButtonClicked(){this.dispatchEvent(new CustomEvent(wt.EmbeddingTableauEventType.EditButtonClicked))}handleCustomMarkClickedContextMenuEvent(e){const n=new VQ.CustomMarkContextMenuEvent(this.getWorksheetForNotificationHandler(e.visualId),e.contextMenuId);this.dispatchEvent(new CustomEvent(wt.EmbeddingTableauEventType.CustomMarkContextMenuEvent,{detail:n}))}handleParameterChangedEvent(e){const n=new GQ.ParameterChangedEvent(e,this.vizImpl.embeddingId);this.dispatchEvent(new CustomEvent(wt.EmbeddingTableauEventType.ParameterChanged,{detail:n}))}handleUrlAction(e){const n=new ZQ.UrlActionEvent(e.url,e.target);this.dispatchEvent(new CustomEvent(wt.EmbeddingTableauEventType.UrlAction,{detail:n}))}handleStoryPointSwitch(e){const n=this.vizImpl.workbookImpl.activeSheet,a=n.storyPointsInfo.find(u=>u.active===!0);if(n.activeStoryPoint&&a&&n.activeStoryPoint.index!==e.index){n.updateStory(e);const u=new HQ.StoryPointSwitchedEvent(a,n.activeStoryPoint,this.vizImpl.workbookImpl);this.dispatchEvent(new CustomEvent(wt.EmbeddingTableauEventType.StoryPointSwitched,{detail:u}))}}getWorksheetForNotificationHandler(e){let n;switch(this.workbook.activeSheet.sheetType){case wt.SheetType.Worksheet:{n=this.workbook.activeSheet;break}case wt.SheetType.Dashboard:{const u=this.workbook.activeSheet.worksheets.filter(d=>d.name===e.worksheet);if(u.length===1)n=u[0];else throw new Kf.TableauError(wt.EmbeddingErrorCodes.IndexOutOfRange,"Worksheet not found");break}case wt.SheetType.Story:{const u=this.workbook.activeSheet.activeStoryPoint.containedSheet;if(!u)throw new Kf.TableauError(wt.EmbeddingErrorCodes.IndexOutOfRange,"Worksheet not found");if(u.sheetType===wt.SheetType.Worksheet)n=u;else if(u.sheetType===wt.SheetType.Dashboard){const _=u.worksheets.filter(l=>l.name===e.worksheet);if(_.length===1)n=_[0];else throw new Kf.TableauError(wt.EmbeddingErrorCodes.IndexOutOfRange,"Worksheet not found")}else throw new Kf.TableauError(wt.EmbeddingErrorCodes.ImplementationError,"Could not find sheetType");break}default:throw new Kf.TableauError(wt.EmbeddingErrorCodes.ImplementationError,"Could not find sheetType")}return n}get disableUrlActionsPopups(){return this.hasAttribute(wt.VizAttributes.DisableUrlActionsPopups)}set disableUrlActionsPopups(e){e?this.setAttribute(wt.VizAttributes.DisableUrlActionsPopups,""):this.removeAttribute(wt.VizAttributes.DisableUrlActionsPopups)}get hideTabs(){return this.hasAttribute(wt.VizAttributes.HideTabs)}set hideTabs(e){e?this.setAttribute(wt.VizAttributes.HideTabs,""):this.removeAttribute(wt.VizAttributes.HideTabs)}get toolbar(){const e=Xf.attributeToEnumKey(this.getAttribute(wt.VizAttributes.Toolbar)),n=wt.Toolbar[e];return n||Xf.TableauVizBase.VizAttributeDefaults.toolbar}set toolbar(e){e&&this.setAttribute(wt.VizAttributes.Toolbar,e)}get instanceIdToClone(){const e=this.getAttribute(wt.VizAttributes.InstanceIdToClone);if(e)return e}set instanceIdToClone(e){e?this.setAttribute(wt.VizAttributes.InstanceIdToClone,e):this.removeAttribute(wt.VizAttributes.InstanceIdToClone)}get device(){const e=Xf.attributeToEnumKey(this.getAttribute(wt.VizAttributes.Device)),n=wt.DeviceType[e];return n||Xf.TableauVizBase.VizAttributeDefaults.device}set device(e){this.setAttribute(wt.VizAttributes.Device,e)}get hideEditButton(){return this.hasAttribute(wt.VizAttributes.HideEditButton)}set hideEditButton(e){e?this.setAttribute(wt.VizAttributes.HideEditButton,""):this.removeAttribute(wt.VizAttributes.HideEditButton)}get automaticUpdatesArePaused(){return this.vizImpl.automaticUpdatesArePaused}pauseAutomaticUpdatesAsync(){return this.vizImpl.pauseAutomaticUpdatesAsync()}resumeAutomaticUpdatesAsync(){return this.vizImpl.resumeAutomaticUpdatesAsync()}toggleAutomaticUpdatesAsync(){return this.vizImpl.toggleAutomaticUpdatesAsync()}revertAllAsync(){return this.vizImpl.revertAllAsync()}refreshDataAsync(){return this.vizImpl.refreshDataAsync()}exportImageAsync(){return this.vizImpl.exportImageAsync()}exportCrosstabAsync(e,n){return this.vizImpl.exportCrosstabAsync(e,n)}exportDataAsync(e,n){return this.vizImpl.exportDataAsync(e,n)}exportPowerPointAsync(e){return this.vizImpl.exportPowerPointAsync(e)}exportPDFAsync(e,n){return this.vizImpl.exportPDFAsync(e,n)}displayDialogAsync(e){return this.vizImpl.displayDialogAsync(e)}redoAsync(){return this.vizImpl.redoAsync()}undoAsync(){return this.vizImpl.undoAsync()}setAuthToken(e){this.vizImpl.setAuthToken(e)}addFilter(e,n){this.preInitFilters.push({field:e,value:n}),XQ.WebComponentManager.synchronizeRender(this.updateRenderingIfInitialized.bind(this,this.src))}get workbook(){return new KQ.Workbook(this.vizImpl.workbookImpl)}}Zv.TableauViz=YQ;Object.defineProperty(Jt,"__esModule",{value:!0});const aM=Nt,QQ=sn(),JQ=Fv,eJ=Nv,tJ=Hv,rJ=Zv,nJ=typeof VERSION_IS_ALPHA<"u"?VERSION_IS_ALPHA:!1;QQ.ApiVersion.SetVersionNumber(typeof API_VERSION_NUMBER<"u"?API_VERSION_NUMBER:"0.0.0",nJ);function zy(t,e){try{window.customElements.get(t)?console.warn(`Custom element '${t}' is already defined.`):window.customElements.define(t,e)}catch(n){console.error(`Error defining custom element '${t}':`,n)}}function iJ(){return"customElements"in window}iJ()?(zy("tableau-viz",rJ.TableauViz),zy("tableau-authoring-viz",eJ.TableauAuthoringViz),zy("tableau-ask-data",JQ.TableauAskData),zy("tableau-pulse",tJ.TableauPulse)):console.error("Custom Elements API is not supported in this browser.");const oJ=Object.assign(Object.assign({},aM.EmbeddingErrorCodes),aM.SharedErrorCodes);Jt.ErrorCodes=oJ;var sr=Nt;Jt.AnalyticsObjectType=sr.AnalyticsObjectType;Jt.AnnotationType=sr.AnnotationType;Jt.ApiMenuType=sr.ApiMenuType;Jt.ClassNameKey=sr.ClassNameKey;Jt.ColumnType=sr.ColumnType;Jt.CrosstabFileFormat=sr.CrosstabFileFormat;Jt.DashboardLayoutChange=sr.DashboardLayoutChange;Jt.DashboardObjectType=sr.DashboardObjectType;Jt.DataType=sr.DataType;Jt.DateRangeType=sr.DateRangeType;Jt.DeviceType=sr.DeviceType;Jt.EncodingType=sr.EncodingType;Jt.FieldAggregationType=sr.FieldAggregationType;Jt.FieldRoleType=sr.FieldRoleType;Jt.FileFormats=sr.FileFormats;Jt.FilterDomainType=sr.FilterDomainType;Jt.FilterNullOption=sr.FilterNullOption;Jt.FilterType=sr.FilterType;Jt.FilterUpdateType=sr.FilterUpdateType;Jt.HierarchicalLevelSelectionState=sr.HierarchicalLevelSelectionState;Jt.IncludeDataValuesOption=sr.IncludeDataValuesOption;Jt.MarkType=sr.MarkType;Jt.ParameterValueType=sr.ParameterValueType;Jt.PeriodType=sr.PeriodType;Jt.PrintOrientation=sr.PrintOrientation;Jt.PrintPageSize=sr.PrintPageSize;Jt.PrintScaling=sr.PrintScaling;Jt.PulseAttributes=sr.PulseAttributes;Jt.PulseLayout=sr.PulseLayout;Jt.QuickTableCalcType=sr.QuickTableCalcType;Jt.SelectionUpdateType=sr.SelectionUpdateType;Jt.SheetSizeBehavior=sr.SheetSizeBehavior;var aJ=Jt.SheetType=sr.SheetType;Jt.SortDirection=sr.SortDirection;Jt.TableauDialogType=sr.TableauDialogType;var sM=Jt.TableauEventType=sr.EmbeddingTableauEventType;Jt.Toolbar=sr.Toolbar;Jt.TrendLineModelType=sr.TrendLineModelType;Jt.VizAttributes=sr.VizAttributes;Jt.VizAuthoringAttributes=sr.VizAuthoringAttributes;Jt.VizSharedAttributes=sr.VizSharedAttributes;Jt.WebComponentAttributes=sr.WebComponentAttributes;var sJ=Fv;Jt.TableauAskData=sJ.TableauAskData;var lJ=Nv;Jt.TableauAuthoringViz=lJ.TableauAuthoringViz;var cJ=Hv;Jt.TableauPulse=cJ.TableauPulse;var uJ=Zv;Jt.TableauViz=uJ.TableauViz;var $O={exports:{}};function hJ(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ew={exports:{}};const dJ={},pJ=Object.freeze(Object.defineProperty({__proto__:null,default:dJ},Symbol.toStringTag,{value:"Module"})),fJ=$M(pJ);var lM;function kr(){return lM||(lM=1,function(t,e){(function(n,a){t.exports=a()})($e,function(){var n=n||function(a,u){var d;if(typeof window<"u"&&window.crypto&&(d=window.crypto),typeof self<"u"&&self.crypto&&(d=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(d=globalThis.crypto),!d&&typeof window<"u"&&window.msCrypto&&(d=window.msCrypto),!d&&typeof $e<"u"&&$e.crypto&&(d=$e.crypto),!d&&typeof hJ=="function")try{d=fJ}catch{}var _=function(){if(d){if(typeof d.getRandomValues=="function")try{return d.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof d.randomBytes=="function")try{return d.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},l=Object.create||function(){function R(){}return function(F){var H;return R.prototype=F,H=new R,R.prototype=null,H}}(),w={},T=w.lib={},C=T.Base=function(){return{extend:function(R){var F=l(this);return R&&F.mixIn(R),(!F.hasOwnProperty("init")||this.init===F.init)&&(F.init=function(){F.$super.init.apply(this,arguments)}),F.init.prototype=F,F.$super=this,F},create:function(){var R=this.extend();return R.init.apply(R,arguments),R},init:function(){},mixIn:function(R){for(var F in R)R.hasOwnProperty(F)&&(this[F]=R[F]);R.hasOwnProperty("toString")&&(this.toString=R.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),P=T.WordArray=C.extend({init:function(R,F){R=this.words=R||[],F!=u?this.sigBytes=F:this.sigBytes=R.length*4},toString:function(R){return(R||$).stringify(this)},concat:function(R){var F=this.words,H=R.words,J=this.sigBytes,te=R.sigBytes;if(this.clamp(),J%4)for(var se=0;se<te;se++){var ge=H[se>>>2]>>>24-se%4*8&255;F[J+se>>>2]|=ge<<24-(J+se)%4*8}else for(var xe=0;xe<te;xe+=4)F[J+xe>>>2]=H[xe>>>2];return this.sigBytes+=te,this},clamp:function(){var R=this.words,F=this.sigBytes;R[F>>>2]&=4294967295<<32-F%4*8,R.length=a.ceil(F/4)},clone:function(){var R=C.clone.call(this);return R.words=this.words.slice(0),R},random:function(R){for(var F=[],H=0;H<R;H+=4)F.push(_());return new P.init(F,R)}}),z=w.enc={},$=z.Hex={stringify:function(R){for(var F=R.words,H=R.sigBytes,J=[],te=0;te<H;te++){var se=F[te>>>2]>>>24-te%4*8&255;J.push((se>>>4).toString(16)),J.push((se&15).toString(16))}return J.join("")},parse:function(R){for(var F=R.length,H=[],J=0;J<F;J+=2)H[J>>>3]|=parseInt(R.substr(J,2),16)<<24-J%8*4;return new P.init(H,F/2)}},U=z.Latin1={stringify:function(R){for(var F=R.words,H=R.sigBytes,J=[],te=0;te<H;te++){var se=F[te>>>2]>>>24-te%4*8&255;J.push(String.fromCharCode(se))}return J.join("")},parse:function(R){for(var F=R.length,H=[],J=0;J<F;J++)H[J>>>2]|=(R.charCodeAt(J)&255)<<24-J%4*8;return new P.init(H,F)}},W=z.Utf8={stringify:function(R){try{return decodeURIComponent(escape(U.stringify(R)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(R){return U.parse(unescape(encodeURIComponent(R)))}},N=T.BufferedBlockAlgorithm=C.extend({reset:function(){this._data=new P.init,this._nDataBytes=0},_append:function(R){typeof R=="string"&&(R=W.parse(R)),this._data.concat(R),this._nDataBytes+=R.sigBytes},_process:function(R){var F,H=this._data,J=H.words,te=H.sigBytes,se=this.blockSize,ge=se*4,xe=te/ge;R?xe=a.ceil(xe):xe=a.max((xe|0)-this._minBufferSize,0);var Ee=xe*se,Be=a.min(Ee*4,te);if(Ee){for(var Fe=0;Fe<Ee;Fe+=se)this._doProcessBlock(J,Fe);F=J.splice(0,Ee),H.sigBytes-=Be}return new P.init(F,Be)},clone:function(){var R=C.clone.call(this);return R._data=this._data.clone(),R},_minBufferSize:0});T.Hasher=N.extend({cfg:C.extend(),init:function(R){this.cfg=this.cfg.extend(R),this.reset()},reset:function(){N.reset.call(this),this._doReset()},update:function(R){return this._append(R),this._process(),this},finalize:function(R){R&&this._append(R);var F=this._doFinalize();return F},blockSize:16,_createHelper:function(R){return function(F,H){return new R.init(H).finalize(F)}},_createHmacHelper:function(R){return function(F,H){return new V.HMAC.init(R,H).finalize(F)}}});var V=w.algo={};return w}(Math);return n})}(ew)),ew.exports}var tw={exports:{}},cM;function Kv(){return cM||(cM=1,function(t,e){(function(n,a){t.exports=a(kr())})($e,function(n){return function(a){var u=n,d=u.lib,_=d.Base,l=d.WordArray,w=u.x64={};w.Word=_.extend({init:function(T,C){this.high=T,this.low=C}}),w.WordArray=_.extend({init:function(T,C){T=this.words=T||[],C!=a?this.sigBytes=C:this.sigBytes=T.length*8},toX32:function(){for(var T=this.words,C=T.length,P=[],z=0;z<C;z++){var $=T[z];P.push($.high),P.push($.low)}return l.create(P,this.sigBytes)},clone:function(){for(var T=_.clone.call(this),C=T.words=this.words.slice(0),P=C.length,z=0;z<P;z++)C[z]=C[z].clone();return T}})}(),n})}(tw)),tw.exports}var rw={exports:{}},uM;function mJ(){return uM||(uM=1,function(t,e){(function(n,a){t.exports=a(kr())})($e,function(n){return function(){if(typeof ArrayBuffer=="function"){var a=n,u=a.lib,d=u.WordArray,_=d.init,l=d.init=function(w){if(w instanceof ArrayBuffer&&(w=new Uint8Array(w)),(w instanceof Int8Array||typeof Uint8ClampedArray<"u"&&w instanceof Uint8ClampedArray||w instanceof Int16Array||w instanceof Uint16Array||w instanceof Int32Array||w instanceof Uint32Array||w instanceof Float32Array||w instanceof Float64Array)&&(w=new Uint8Array(w.buffer,w.byteOffset,w.byteLength)),w instanceof Uint8Array){for(var T=w.byteLength,C=[],P=0;P<T;P++)C[P>>>2]|=w[P]<<24-P%4*8;_.call(this,C,T)}else _.apply(this,arguments)};l.prototype=d}}(),n.lib.WordArray})}(rw)),rw.exports}var nw={exports:{}},hM;function gJ(){return hM||(hM=1,function(t,e){(function(n,a){t.exports=a(kr())})($e,function(n){return function(){var a=n,u=a.lib,d=u.WordArray,_=a.enc;_.Utf16=_.Utf16BE={stringify:function(w){for(var T=w.words,C=w.sigBytes,P=[],z=0;z<C;z+=2){var $=T[z>>>2]>>>16-z%4*8&65535;P.push(String.fromCharCode($))}return P.join("")},parse:function(w){for(var T=w.length,C=[],P=0;P<T;P++)C[P>>>1]|=w.charCodeAt(P)<<16-P%2*16;return d.create(C,T*2)}},_.Utf16LE={stringify:function(w){for(var T=w.words,C=w.sigBytes,P=[],z=0;z<C;z+=2){var $=l(T[z>>>2]>>>16-z%4*8&65535);P.push(String.fromCharCode($))}return P.join("")},parse:function(w){for(var T=w.length,C=[],P=0;P<T;P++)C[P>>>1]|=l(w.charCodeAt(P)<<16-P%2*16);return d.create(C,T*2)}};function l(w){return w<<8&4278255360|w>>>8&16711935}}(),n.enc.Utf16})}(nw)),nw.exports}var iw={exports:{}},dM;function ju(){return dM||(dM=1,function(t,e){(function(n,a){t.exports=a(kr())})($e,function(n){return function(){var a=n,u=a.lib,d=u.WordArray,_=a.enc;_.Base64={stringify:function(w){var T=w.words,C=w.sigBytes,P=this._map;w.clamp();for(var z=[],$=0;$<C;$+=3)for(var U=T[$>>>2]>>>24-$%4*8&255,W=T[$+1>>>2]>>>24-($+1)%4*8&255,N=T[$+2>>>2]>>>24-($+2)%4*8&255,V=U<<16|W<<8|N,R=0;R<4&&$+R*.75<C;R++)z.push(P.charAt(V>>>6*(3-R)&63));var F=P.charAt(64);if(F)for(;z.length%4;)z.push(F);return z.join("")},parse:function(w){var T=w.length,C=this._map,P=this._reverseMap;if(!P){P=this._reverseMap=[];for(var z=0;z<C.length;z++)P[C.charCodeAt(z)]=z}var $=C.charAt(64);if($){var U=w.indexOf($);U!==-1&&(T=U)}return l(w,T,P)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function l(w,T,C){for(var P=[],z=0,$=0;$<T;$++)if($%4){var U=C[w.charCodeAt($-1)]<<$%4*2,W=C[w.charCodeAt($)]>>>6-$%4*2,N=U|W;P[z>>>2]|=N<<24-z%4*8,z++}return d.create(P,z)}}(),n.enc.Base64})}(iw)),iw.exports}var ow={exports:{}},pM;function yJ(){return pM||(pM=1,function(t,e){(function(n,a){t.exports=a(kr())})($e,function(n){return function(){var a=n,u=a.lib,d=u.WordArray,_=a.enc;_.Base64url={stringify:function(w,T){T===void 0&&(T=!0);var C=w.words,P=w.sigBytes,z=T?this._safe_map:this._map;w.clamp();for(var $=[],U=0;U<P;U+=3)for(var W=C[U>>>2]>>>24-U%4*8&255,N=C[U+1>>>2]>>>24-(U+1)%4*8&255,V=C[U+2>>>2]>>>24-(U+2)%4*8&255,R=W<<16|N<<8|V,F=0;F<4&&U+F*.75<P;F++)$.push(z.charAt(R>>>6*(3-F)&63));var H=z.charAt(64);if(H)for(;$.length%4;)$.push(H);return $.join("")},parse:function(w,T){T===void 0&&(T=!0);var C=w.length,P=T?this._safe_map:this._map,z=this._reverseMap;if(!z){z=this._reverseMap=[];for(var $=0;$<P.length;$++)z[P.charCodeAt($)]=$}var U=P.charAt(64);if(U){var W=w.indexOf(U);W!==-1&&(C=W)}return l(w,C,z)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function l(w,T,C){for(var P=[],z=0,$=0;$<T;$++)if($%4){var U=C[w.charCodeAt($-1)]<<$%4*2,W=C[w.charCodeAt($)]>>>6-$%4*2,N=U|W;P[z>>>2]|=N<<24-z%4*8,z++}return d.create(P,z)}}(),n.enc.Base64url})}(ow)),ow.exports}var aw={exports:{}},fM;function Vu(){return fM||(fM=1,function(t,e){(function(n,a){t.exports=a(kr())})($e,function(n){return function(a){var u=n,d=u.lib,_=d.WordArray,l=d.Hasher,w=u.algo,T=[];(function(){for(var W=0;W<64;W++)T[W]=a.abs(a.sin(W+1))*4294967296|0})();var C=w.MD5=l.extend({_doReset:function(){this._hash=new _.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(W,N){for(var V=0;V<16;V++){var R=N+V,F=W[R];W[R]=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360}var H=this._hash.words,J=W[N+0],te=W[N+1],se=W[N+2],ge=W[N+3],xe=W[N+4],Ee=W[N+5],Be=W[N+6],Fe=W[N+7],Ve=W[N+8],Ct=W[N+9],Dt=W[N+10],Ut=W[N+11],cr=W[N+12],qe=W[N+13],St=W[N+14],gt=W[N+15],je=H[0],et=H[1],nt=H[2],it=H[3];je=P(je,et,nt,it,J,7,T[0]),it=P(it,je,et,nt,te,12,T[1]),nt=P(nt,it,je,et,se,17,T[2]),et=P(et,nt,it,je,ge,22,T[3]),je=P(je,et,nt,it,xe,7,T[4]),it=P(it,je,et,nt,Ee,12,T[5]),nt=P(nt,it,je,et,Be,17,T[6]),et=P(et,nt,it,je,Fe,22,T[7]),je=P(je,et,nt,it,Ve,7,T[8]),it=P(it,je,et,nt,Ct,12,T[9]),nt=P(nt,it,je,et,Dt,17,T[10]),et=P(et,nt,it,je,Ut,22,T[11]),je=P(je,et,nt,it,cr,7,T[12]),it=P(it,je,et,nt,qe,12,T[13]),nt=P(nt,it,je,et,St,17,T[14]),et=P(et,nt,it,je,gt,22,T[15]),je=z(je,et,nt,it,te,5,T[16]),it=z(it,je,et,nt,Be,9,T[17]),nt=z(nt,it,je,et,Ut,14,T[18]),et=z(et,nt,it,je,J,20,T[19]),je=z(je,et,nt,it,Ee,5,T[20]),it=z(it,je,et,nt,Dt,9,T[21]),nt=z(nt,it,je,et,gt,14,T[22]),et=z(et,nt,it,je,xe,20,T[23]),je=z(je,et,nt,it,Ct,5,T[24]),it=z(it,je,et,nt,St,9,T[25]),nt=z(nt,it,je,et,ge,14,T[26]),et=z(et,nt,it,je,Ve,20,T[27]),je=z(je,et,nt,it,qe,5,T[28]),it=z(it,je,et,nt,se,9,T[29]),nt=z(nt,it,je,et,Fe,14,T[30]),et=z(et,nt,it,je,cr,20,T[31]),je=$(je,et,nt,it,Ee,4,T[32]),it=$(it,je,et,nt,Ve,11,T[33]),nt=$(nt,it,je,et,Ut,16,T[34]),et=$(et,nt,it,je,St,23,T[35]),je=$(je,et,nt,it,te,4,T[36]),it=$(it,je,et,nt,xe,11,T[37]),nt=$(nt,it,je,et,Fe,16,T[38]),et=$(et,nt,it,je,Dt,23,T[39]),je=$(je,et,nt,it,qe,4,T[40]),it=$(it,je,et,nt,J,11,T[41]),nt=$(nt,it,je,et,ge,16,T[42]),et=$(et,nt,it,je,Be,23,T[43]),je=$(je,et,nt,it,Ct,4,T[44]),it=$(it,je,et,nt,cr,11,T[45]),nt=$(nt,it,je,et,gt,16,T[46]),et=$(et,nt,it,je,se,23,T[47]),je=U(je,et,nt,it,J,6,T[48]),it=U(it,je,et,nt,Fe,10,T[49]),nt=U(nt,it,je,et,St,15,T[50]),et=U(et,nt,it,je,Ee,21,T[51]),je=U(je,et,nt,it,cr,6,T[52]),it=U(it,je,et,nt,ge,10,T[53]),nt=U(nt,it,je,et,Dt,15,T[54]),et=U(et,nt,it,je,te,21,T[55]),je=U(je,et,nt,it,Ve,6,T[56]),it=U(it,je,et,nt,gt,10,T[57]),nt=U(nt,it,je,et,Be,15,T[58]),et=U(et,nt,it,je,qe,21,T[59]),je=U(je,et,nt,it,xe,6,T[60]),it=U(it,je,et,nt,Ut,10,T[61]),nt=U(nt,it,je,et,se,15,T[62]),et=U(et,nt,it,je,Ct,21,T[63]),H[0]=H[0]+je|0,H[1]=H[1]+et|0,H[2]=H[2]+nt|0,H[3]=H[3]+it|0},_doFinalize:function(){var W=this._data,N=W.words,V=this._nDataBytes*8,R=W.sigBytes*8;N[R>>>5]|=128<<24-R%32;var F=a.floor(V/4294967296),H=V;N[(R+64>>>9<<4)+15]=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360,N[(R+64>>>9<<4)+14]=(H<<8|H>>>24)&16711935|(H<<24|H>>>8)&4278255360,W.sigBytes=(N.length+1)*4,this._process();for(var J=this._hash,te=J.words,se=0;se<4;se++){var ge=te[se];te[se]=(ge<<8|ge>>>24)&16711935|(ge<<24|ge>>>8)&4278255360}return J},clone:function(){var W=l.clone.call(this);return W._hash=this._hash.clone(),W}});function P(W,N,V,R,F,H,J){var te=W+(N&V|~N&R)+F+J;return(te<<H|te>>>32-H)+N}function z(W,N,V,R,F,H,J){var te=W+(N&R|V&~R)+F+J;return(te<<H|te>>>32-H)+N}function $(W,N,V,R,F,H,J){var te=W+(N^V^R)+F+J;return(te<<H|te>>>32-H)+N}function U(W,N,V,R,F,H,J){var te=W+(V^(N|~R))+F+J;return(te<<H|te>>>32-H)+N}u.MD5=l._createHelper(C),u.HmacMD5=l._createHmacHelper(C)}(Math),n.MD5})}(aw)),aw.exports}var sw={exports:{}},mM;function WO(){return mM||(mM=1,function(t,e){(function(n,a){t.exports=a(kr())})($e,function(n){return function(){var a=n,u=a.lib,d=u.WordArray,_=u.Hasher,l=a.algo,w=[],T=l.SHA1=_.extend({_doReset:function(){this._hash=new d.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(C,P){for(var z=this._hash.words,$=z[0],U=z[1],W=z[2],N=z[3],V=z[4],R=0;R<80;R++){if(R<16)w[R]=C[P+R]|0;else{var F=w[R-3]^w[R-8]^w[R-14]^w[R-16];w[R]=F<<1|F>>>31}var H=($<<5|$>>>27)+V+w[R];R<20?H+=(U&W|~U&N)+1518500249:R<40?H+=(U^W^N)+1859775393:R<60?H+=(U&W|U&N|W&N)-1894007588:H+=(U^W^N)-899497514,V=N,N=W,W=U<<30|U>>>2,U=$,$=H}z[0]=z[0]+$|0,z[1]=z[1]+U|0,z[2]=z[2]+W|0,z[3]=z[3]+N|0,z[4]=z[4]+V|0},_doFinalize:function(){var C=this._data,P=C.words,z=this._nDataBytes*8,$=C.sigBytes*8;return P[$>>>5]|=128<<24-$%32,P[($+64>>>9<<4)+14]=Math.floor(z/4294967296),P[($+64>>>9<<4)+15]=z,C.sigBytes=P.length*4,this._process(),this._hash},clone:function(){var C=_.clone.call(this);return C._hash=this._hash.clone(),C}});a.SHA1=_._createHelper(T),a.HmacSHA1=_._createHmacHelper(T)}(),n.SHA1})}(sw)),sw.exports}var lw={exports:{}},gM;function PA(){return gM||(gM=1,function(t,e){(function(n,a){t.exports=a(kr())})($e,function(n){return function(a){var u=n,d=u.lib,_=d.WordArray,l=d.Hasher,w=u.algo,T=[],C=[];(function(){function $(V){for(var R=a.sqrt(V),F=2;F<=R;F++)if(!(V%F))return!1;return!0}function U(V){return(V-(V|0))*4294967296|0}for(var W=2,N=0;N<64;)$(W)&&(N<8&&(T[N]=U(a.pow(W,1/2))),C[N]=U(a.pow(W,1/3)),N++),W++})();var P=[],z=w.SHA256=l.extend({_doReset:function(){this._hash=new _.init(T.slice(0))},_doProcessBlock:function($,U){for(var W=this._hash.words,N=W[0],V=W[1],R=W[2],F=W[3],H=W[4],J=W[5],te=W[6],se=W[7],ge=0;ge<64;ge++){if(ge<16)P[ge]=$[U+ge]|0;else{var xe=P[ge-15],Ee=(xe<<25|xe>>>7)^(xe<<14|xe>>>18)^xe>>>3,Be=P[ge-2],Fe=(Be<<15|Be>>>17)^(Be<<13|Be>>>19)^Be>>>10;P[ge]=Ee+P[ge-7]+Fe+P[ge-16]}var Ve=H&J^~H&te,Ct=N&V^N&R^V&R,Dt=(N<<30|N>>>2)^(N<<19|N>>>13)^(N<<10|N>>>22),Ut=(H<<26|H>>>6)^(H<<21|H>>>11)^(H<<7|H>>>25),cr=se+Ut+Ve+C[ge]+P[ge],qe=Dt+Ct;se=te,te=J,J=H,H=F+cr|0,F=R,R=V,V=N,N=cr+qe|0}W[0]=W[0]+N|0,W[1]=W[1]+V|0,W[2]=W[2]+R|0,W[3]=W[3]+F|0,W[4]=W[4]+H|0,W[5]=W[5]+J|0,W[6]=W[6]+te|0,W[7]=W[7]+se|0},_doFinalize:function(){var $=this._data,U=$.words,W=this._nDataBytes*8,N=$.sigBytes*8;return U[N>>>5]|=128<<24-N%32,U[(N+64>>>9<<4)+14]=a.floor(W/4294967296),U[(N+64>>>9<<4)+15]=W,$.sigBytes=U.length*4,this._process(),this._hash},clone:function(){var $=l.clone.call(this);return $._hash=this._hash.clone(),$}});u.SHA256=l._createHelper(z),u.HmacSHA256=l._createHmacHelper(z)}(Math),n.SHA256})}(lw)),lw.exports}var cw={exports:{}},yM;function _J(){return yM||(yM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),PA())})($e,function(n){return function(){var a=n,u=a.lib,d=u.WordArray,_=a.algo,l=_.SHA256,w=_.SHA224=l.extend({_doReset:function(){this._hash=new d.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var T=l._doFinalize.call(this);return T.sigBytes-=4,T}});a.SHA224=l._createHelper(w),a.HmacSHA224=l._createHmacHelper(w)}(),n.SHA224})}(cw)),cw.exports}var uw={exports:{}},_M;function GO(){return _M||(_M=1,function(t,e){(function(n,a,u){t.exports=a(kr(),Kv())})($e,function(n){return function(){var a=n,u=a.lib,d=u.Hasher,_=a.x64,l=_.Word,w=_.WordArray,T=a.algo;function C(){return l.create.apply(l,arguments)}var P=[C(1116352408,3609767458),C(1899447441,602891725),C(3049323471,3964484399),C(3921009573,2173295548),C(961987163,4081628472),C(1508970993,3053834265),C(2453635748,2937671579),C(2870763221,3664609560),C(3624381080,2734883394),C(310598401,1164996542),C(607225278,1323610764),C(1426881987,3590304994),C(1925078388,4068182383),C(2162078206,991336113),C(2614888103,633803317),C(3248222580,3479774868),C(3835390401,2666613458),C(4022224774,944711139),C(264347078,2341262773),C(604807628,2007800933),C(770255983,1495990901),C(1249150122,1856431235),C(1555081692,3175218132),C(1996064986,2198950837),C(2554220882,3999719339),C(2821834349,766784016),C(2952996808,2566594879),C(3210313671,3203337956),C(3336571891,1034457026),C(3584528711,2466948901),C(113926993,3758326383),C(338241895,168717936),C(666307205,1188179964),C(773529912,1546045734),C(1294757372,1522805485),C(1396182291,2643833823),C(1695183700,2343527390),C(1986661051,1014477480),C(2177026350,1206759142),C(2456956037,344077627),C(2730485921,1290863460),C(2820302411,3158454273),C(3259730800,3505952657),C(3345764771,106217008),C(3516065817,3606008344),C(3600352804,1432725776),C(4094571909,1467031594),C(275423344,851169720),C(430227734,3100823752),C(506948616,1363258195),C(659060556,3750685593),C(883997877,3785050280),C(958139571,3318307427),C(1322822218,3812723403),C(1537002063,2003034995),C(1747873779,3602036899),C(1955562222,1575990012),C(2024104815,1125592928),C(2227730452,2716904306),C(2361852424,442776044),C(2428436474,593698344),C(2756734187,3733110249),C(3204031479,2999351573),C(3329325298,3815920427),C(3391569614,3928383900),C(3515267271,566280711),C(3940187606,3454069534),C(4118630271,4000239992),C(116418474,1914138554),C(174292421,2731055270),C(289380356,3203993006),C(460393269,320620315),C(685471733,587496836),C(852142971,1086792851),C(1017036298,365543100),C(1126000580,2618297676),C(1288033470,3409855158),C(1501505948,4234509866),C(1607167915,987167468),C(1816402316,1246189591)],z=[];(function(){for(var U=0;U<80;U++)z[U]=C()})();var $=T.SHA512=d.extend({_doReset:function(){this._hash=new w.init([new l.init(1779033703,4089235720),new l.init(3144134277,2227873595),new l.init(1013904242,4271175723),new l.init(2773480762,1595750129),new l.init(1359893119,2917565137),new l.init(2600822924,725511199),new l.init(528734635,4215389547),new l.init(1541459225,327033209)])},_doProcessBlock:function(U,W){for(var N=this._hash.words,V=N[0],R=N[1],F=N[2],H=N[3],J=N[4],te=N[5],se=N[6],ge=N[7],xe=V.high,Ee=V.low,Be=R.high,Fe=R.low,Ve=F.high,Ct=F.low,Dt=H.high,Ut=H.low,cr=J.high,qe=J.low,St=te.high,gt=te.low,je=se.high,et=se.low,nt=ge.high,it=ge.low,ur=xe,Xt=Ee,Pr=Be,Yt=Fe,si=Ve,mr=Ct,Vt=Dt,Ii=Ut,qr=cr,pn=qe,Tr=St,Bn=gt,ma=je,yi=et,Yn=nt,bo=it,Nn=0;Nn<80;Nn++){var Un,Qn,wo=z[Nn];if(Nn<16)Qn=wo.high=U[W+Nn*2]|0,Un=wo.low=U[W+Nn*2+1]|0;else{var Ps=z[Nn-15],Eo=Ps.high,jn=Ps.low,Wo=(Eo>>>1|jn<<31)^(Eo>>>8|jn<<24)^Eo>>>7,Qa=(jn>>>1|Eo<<31)^(jn>>>8|Eo<<24)^(jn>>>7|Eo<<25),Go=z[Nn-2],Hi=Go.high,So=Go.low,ga=(Hi>>>19|So<<13)^(Hi<<3|So>>>29)^Hi>>>6,To=(So>>>19|Hi<<13)^(So<<3|Hi>>>29)^(So>>>6|Hi<<26),Ho=z[Nn-7],ya=Ho.high,Ja=Ho.low,Ds=z[Nn-16],fe=Ds.high,X=Ds.low;Un=Qa+Ja,Qn=Wo+ya+(Un>>>0<Qa>>>0?1:0),Un=Un+To,Qn=Qn+ga+(Un>>>0<To>>>0?1:0),Un=Un+X,Qn=Qn+fe+(Un>>>0<X>>>0?1:0),wo.high=Qn,wo.low=Un}var Y=qr&Tr^~qr&ma,de=pn&Bn^~pn&yi,ve=ur&Pr^ur&si^Pr&si,Ae=Xt&Yt^Xt&mr^Yt&mr,Pe=(ur>>>28|Xt<<4)^(ur<<30|Xt>>>2)^(ur<<25|Xt>>>7),ke=(Xt>>>28|ur<<4)^(Xt<<30|ur>>>2)^(Xt<<25|ur>>>7),Te=(qr>>>14|pn<<18)^(qr>>>18|pn<<14)^(qr<<23|pn>>>9),Le=(pn>>>14|qr<<18)^(pn>>>18|qr<<14)^(pn<<23|qr>>>9),dt=P[Nn],mt=dt.high,ct=dt.low,Ft=bo+Le,jt=Yn+Te+(Ft>>>0<bo>>>0?1:0),Ft=Ft+de,jt=jt+Y+(Ft>>>0<de>>>0?1:0),Ft=Ft+ct,jt=jt+mt+(Ft>>>0<ct>>>0?1:0),Ft=Ft+Un,jt=jt+Qn+(Ft>>>0<Un>>>0?1:0),Wt=ke+Ae,Qt=Pe+ve+(Wt>>>0<ke>>>0?1:0);Yn=ma,bo=yi,ma=Tr,yi=Bn,Tr=qr,Bn=pn,pn=Ii+Ft|0,qr=Vt+jt+(pn>>>0<Ii>>>0?1:0)|0,Vt=si,Ii=mr,si=Pr,mr=Yt,Pr=ur,Yt=Xt,Xt=Ft+Wt|0,ur=jt+Qt+(Xt>>>0<Ft>>>0?1:0)|0}Ee=V.low=Ee+Xt,V.high=xe+ur+(Ee>>>0<Xt>>>0?1:0),Fe=R.low=Fe+Yt,R.high=Be+Pr+(Fe>>>0<Yt>>>0?1:0),Ct=F.low=Ct+mr,F.high=Ve+si+(Ct>>>0<mr>>>0?1:0),Ut=H.low=Ut+Ii,H.high=Dt+Vt+(Ut>>>0<Ii>>>0?1:0),qe=J.low=qe+pn,J.high=cr+qr+(qe>>>0<pn>>>0?1:0),gt=te.low=gt+Bn,te.high=St+Tr+(gt>>>0<Bn>>>0?1:0),et=se.low=et+yi,se.high=je+ma+(et>>>0<yi>>>0?1:0),it=ge.low=it+bo,ge.high=nt+Yn+(it>>>0<bo>>>0?1:0)},_doFinalize:function(){var U=this._data,W=U.words,N=this._nDataBytes*8,V=U.sigBytes*8;W[V>>>5]|=128<<24-V%32,W[(V+128>>>10<<5)+30]=Math.floor(N/4294967296),W[(V+128>>>10<<5)+31]=N,U.sigBytes=W.length*4,this._process();var R=this._hash.toX32();return R},clone:function(){var U=d.clone.call(this);return U._hash=this._hash.clone(),U},blockSize:1024/32});a.SHA512=d._createHelper($),a.HmacSHA512=d._createHmacHelper($)}(),n.SHA512})}(uw)),uw.exports}var hw={exports:{}},vM;function vJ(){return vM||(vM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),Kv(),GO())})($e,function(n){return function(){var a=n,u=a.x64,d=u.Word,_=u.WordArray,l=a.algo,w=l.SHA512,T=l.SHA384=w.extend({_doReset:function(){this._hash=new _.init([new d.init(3418070365,3238371032),new d.init(1654270250,914150663),new d.init(2438529370,812702999),new d.init(355462360,4144912697),new d.init(1731405415,4290775857),new d.init(2394180231,1750603025),new d.init(3675008525,1694076839),new d.init(1203062813,3204075428)])},_doFinalize:function(){var C=w._doFinalize.call(this);return C.sigBytes-=16,C}});a.SHA384=w._createHelper(T),a.HmacSHA384=w._createHmacHelper(T)}(),n.SHA384})}(hw)),hw.exports}var dw={exports:{}},xM;function xJ(){return xM||(xM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),Kv())})($e,function(n){return function(a){var u=n,d=u.lib,_=d.WordArray,l=d.Hasher,w=u.x64,T=w.Word,C=u.algo,P=[],z=[],$=[];(function(){for(var N=1,V=0,R=0;R<24;R++){P[N+5*V]=(R+1)*(R+2)/2%64;var F=V%5,H=(2*N+3*V)%5;N=F,V=H}for(var N=0;N<5;N++)for(var V=0;V<5;V++)z[N+5*V]=V+(2*N+3*V)%5*5;for(var J=1,te=0;te<24;te++){for(var se=0,ge=0,xe=0;xe<7;xe++){if(J&1){var Ee=(1<<xe)-1;Ee<32?ge^=1<<Ee:se^=1<<Ee-32}J&128?J=J<<1^113:J<<=1}$[te]=T.create(se,ge)}})();var U=[];(function(){for(var N=0;N<25;N++)U[N]=T.create()})();var W=C.SHA3=l.extend({cfg:l.cfg.extend({outputLength:512}),_doReset:function(){for(var N=this._state=[],V=0;V<25;V++)N[V]=new T.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(N,V){for(var R=this._state,F=this.blockSize/2,H=0;H<F;H++){var J=N[V+2*H],te=N[V+2*H+1];J=(J<<8|J>>>24)&16711935|(J<<24|J>>>8)&4278255360,te=(te<<8|te>>>24)&16711935|(te<<24|te>>>8)&4278255360;var se=R[H];se.high^=te,se.low^=J}for(var ge=0;ge<24;ge++){for(var xe=0;xe<5;xe++){for(var Ee=0,Be=0,Fe=0;Fe<5;Fe++){var se=R[xe+5*Fe];Ee^=se.high,Be^=se.low}var Ve=U[xe];Ve.high=Ee,Ve.low=Be}for(var xe=0;xe<5;xe++)for(var Ct=U[(xe+4)%5],Dt=U[(xe+1)%5],Ut=Dt.high,cr=Dt.low,Ee=Ct.high^(Ut<<1|cr>>>31),Be=Ct.low^(cr<<1|Ut>>>31),Fe=0;Fe<5;Fe++){var se=R[xe+5*Fe];se.high^=Ee,se.low^=Be}for(var qe=1;qe<25;qe++){var Ee,Be,se=R[qe],St=se.high,gt=se.low,je=P[qe];je<32?(Ee=St<<je|gt>>>32-je,Be=gt<<je|St>>>32-je):(Ee=gt<<je-32|St>>>64-je,Be=St<<je-32|gt>>>64-je);var et=U[z[qe]];et.high=Ee,et.low=Be}var nt=U[0],it=R[0];nt.high=it.high,nt.low=it.low;for(var xe=0;xe<5;xe++)for(var Fe=0;Fe<5;Fe++){var qe=xe+5*Fe,se=R[qe],ur=U[qe],Xt=U[(xe+1)%5+5*Fe],Pr=U[(xe+2)%5+5*Fe];se.high=ur.high^~Xt.high&Pr.high,se.low=ur.low^~Xt.low&Pr.low}var se=R[0],Yt=$[ge];se.high^=Yt.high,se.low^=Yt.low}},_doFinalize:function(){var N=this._data,V=N.words;this._nDataBytes*8;var R=N.sigBytes*8,F=this.blockSize*32;V[R>>>5]|=1<<24-R%32,V[(a.ceil((R+1)/F)*F>>>5)-1]|=128,N.sigBytes=V.length*4,this._process();for(var H=this._state,J=this.cfg.outputLength/8,te=J/8,se=[],ge=0;ge<te;ge++){var xe=H[ge],Ee=xe.high,Be=xe.low;Ee=(Ee<<8|Ee>>>24)&16711935|(Ee<<24|Ee>>>8)&4278255360,Be=(Be<<8|Be>>>24)&16711935|(Be<<24|Be>>>8)&4278255360,se.push(Be),se.push(Ee)}return new _.init(se,J)},clone:function(){for(var N=l.clone.call(this),V=N._state=this._state.slice(0),R=0;R<25;R++)V[R]=V[R].clone();return N}});u.SHA3=l._createHelper(W),u.HmacSHA3=l._createHmacHelper(W)}(Math),n.SHA3})}(dw)),dw.exports}var pw={exports:{}},bM;function bJ(){return bM||(bM=1,function(t,e){(function(n,a){t.exports=a(kr())})($e,function(n){/** @preserve
			(c) 2012 by Cédric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(a){var u=n,d=u.lib,_=d.WordArray,l=d.Hasher,w=u.algo,T=_.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),C=_.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),P=_.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),z=_.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),$=_.create([0,1518500249,1859775393,2400959708,2840853838]),U=_.create([1352829926,1548603684,1836072691,2053994217,0]),W=w.RIPEMD160=l.extend({_doReset:function(){this._hash=_.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(te,se){for(var ge=0;ge<16;ge++){var xe=se+ge,Ee=te[xe];te[xe]=(Ee<<8|Ee>>>24)&16711935|(Ee<<24|Ee>>>8)&4278255360}var Be=this._hash.words,Fe=$.words,Ve=U.words,Ct=T.words,Dt=C.words,Ut=P.words,cr=z.words,qe,St,gt,je,et,nt,it,ur,Xt,Pr;nt=qe=Be[0],it=St=Be[1],ur=gt=Be[2],Xt=je=Be[3],Pr=et=Be[4];for(var Yt,ge=0;ge<80;ge+=1)Yt=qe+te[se+Ct[ge]]|0,ge<16?Yt+=N(St,gt,je)+Fe[0]:ge<32?Yt+=V(St,gt,je)+Fe[1]:ge<48?Yt+=R(St,gt,je)+Fe[2]:ge<64?Yt+=F(St,gt,je)+Fe[3]:Yt+=H(St,gt,je)+Fe[4],Yt=Yt|0,Yt=J(Yt,Ut[ge]),Yt=Yt+et|0,qe=et,et=je,je=J(gt,10),gt=St,St=Yt,Yt=nt+te[se+Dt[ge]]|0,ge<16?Yt+=H(it,ur,Xt)+Ve[0]:ge<32?Yt+=F(it,ur,Xt)+Ve[1]:ge<48?Yt+=R(it,ur,Xt)+Ve[2]:ge<64?Yt+=V(it,ur,Xt)+Ve[3]:Yt+=N(it,ur,Xt)+Ve[4],Yt=Yt|0,Yt=J(Yt,cr[ge]),Yt=Yt+Pr|0,nt=Pr,Pr=Xt,Xt=J(ur,10),ur=it,it=Yt;Yt=Be[1]+gt+Xt|0,Be[1]=Be[2]+je+Pr|0,Be[2]=Be[3]+et+nt|0,Be[3]=Be[4]+qe+it|0,Be[4]=Be[0]+St+ur|0,Be[0]=Yt},_doFinalize:function(){var te=this._data,se=te.words,ge=this._nDataBytes*8,xe=te.sigBytes*8;se[xe>>>5]|=128<<24-xe%32,se[(xe+64>>>9<<4)+14]=(ge<<8|ge>>>24)&16711935|(ge<<24|ge>>>8)&4278255360,te.sigBytes=(se.length+1)*4,this._process();for(var Ee=this._hash,Be=Ee.words,Fe=0;Fe<5;Fe++){var Ve=Be[Fe];Be[Fe]=(Ve<<8|Ve>>>24)&16711935|(Ve<<24|Ve>>>8)&4278255360}return Ee},clone:function(){var te=l.clone.call(this);return te._hash=this._hash.clone(),te}});function N(te,se,ge){return te^se^ge}function V(te,se,ge){return te&se|~te&ge}function R(te,se,ge){return(te|~se)^ge}function F(te,se,ge){return te&ge|se&~ge}function H(te,se,ge){return te^(se|~ge)}function J(te,se){return te<<se|te>>>32-se}u.RIPEMD160=l._createHelper(W),u.HmacRIPEMD160=l._createHmacHelper(W)}(),n.RIPEMD160})}(pw)),pw.exports}var fw={exports:{}},wM;function DA(){return wM||(wM=1,function(t,e){(function(n,a){t.exports=a(kr())})($e,function(n){(function(){var a=n,u=a.lib,d=u.Base,_=a.enc,l=_.Utf8,w=a.algo;w.HMAC=d.extend({init:function(T,C){T=this._hasher=new T.init,typeof C=="string"&&(C=l.parse(C));var P=T.blockSize,z=P*4;C.sigBytes>z&&(C=T.finalize(C)),C.clamp();for(var $=this._oKey=C.clone(),U=this._iKey=C.clone(),W=$.words,N=U.words,V=0;V<P;V++)W[V]^=1549556828,N[V]^=909522486;$.sigBytes=U.sigBytes=z,this.reset()},reset:function(){var T=this._hasher;T.reset(),T.update(this._iKey)},update:function(T){return this._hasher.update(T),this},finalize:function(T){var C=this._hasher,P=C.finalize(T);C.reset();var z=C.finalize(this._oKey.clone().concat(P));return z}})})()})}(fw)),fw.exports}var mw={exports:{}},EM;function wJ(){return EM||(EM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),PA(),DA())})($e,function(n){return function(){var a=n,u=a.lib,d=u.Base,_=u.WordArray,l=a.algo,w=l.SHA256,T=l.HMAC,C=l.PBKDF2=d.extend({cfg:d.extend({keySize:128/32,hasher:w,iterations:25e4}),init:function(P){this.cfg=this.cfg.extend(P)},compute:function(P,z){for(var $=this.cfg,U=T.create($.hasher,P),W=_.create(),N=_.create([1]),V=W.words,R=N.words,F=$.keySize,H=$.iterations;V.length<F;){var J=U.update(z).finalize(N);U.reset();for(var te=J.words,se=te.length,ge=J,xe=1;xe<H;xe++){ge=U.finalize(ge),U.reset();for(var Ee=ge.words,Be=0;Be<se;Be++)te[Be]^=Ee[Be]}W.concat(J),R[0]++}return W.sigBytes=F*4,W}});a.PBKDF2=function(P,z,$){return C.create($).compute(P,z)}}(),n.PBKDF2})}(mw)),mw.exports}var gw={exports:{}},SM;function Ac(){return SM||(SM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),WO(),DA())})($e,function(n){return function(){var a=n,u=a.lib,d=u.Base,_=u.WordArray,l=a.algo,w=l.MD5,T=l.EvpKDF=d.extend({cfg:d.extend({keySize:128/32,hasher:w,iterations:1}),init:function(C){this.cfg=this.cfg.extend(C)},compute:function(C,P){for(var z,$=this.cfg,U=$.hasher.create(),W=_.create(),N=W.words,V=$.keySize,R=$.iterations;N.length<V;){z&&U.update(z),z=U.update(C).finalize(P),U.reset();for(var F=1;F<R;F++)z=U.finalize(z),U.reset();W.concat(z)}return W.sigBytes=V*4,W}});a.EvpKDF=function(C,P,z){return T.create(z).compute(C,P)}}(),n.EvpKDF})}(gw)),gw.exports}var yw={exports:{}},TM;function gi(){return TM||(TM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),Ac())})($e,function(n){n.lib.Cipher||function(a){var u=n,d=u.lib,_=d.Base,l=d.WordArray,w=d.BufferedBlockAlgorithm,T=u.enc;T.Utf8;var C=T.Base64,P=u.algo,z=P.EvpKDF,$=d.Cipher=w.extend({cfg:_.extend(),createEncryptor:function(Ee,Be){return this.create(this._ENC_XFORM_MODE,Ee,Be)},createDecryptor:function(Ee,Be){return this.create(this._DEC_XFORM_MODE,Ee,Be)},init:function(Ee,Be,Fe){this.cfg=this.cfg.extend(Fe),this._xformMode=Ee,this._key=Be,this.reset()},reset:function(){w.reset.call(this),this._doReset()},process:function(Ee){return this._append(Ee),this._process()},finalize:function(Ee){Ee&&this._append(Ee);var Be=this._doFinalize();return Be},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function Ee(Be){return typeof Be=="string"?xe:te}return function(Be){return{encrypt:function(Fe,Ve,Ct){return Ee(Ve).encrypt(Be,Fe,Ve,Ct)},decrypt:function(Fe,Ve,Ct){return Ee(Ve).decrypt(Be,Fe,Ve,Ct)}}}}()});d.StreamCipher=$.extend({_doFinalize:function(){var Ee=this._process(!0);return Ee},blockSize:1});var U=u.mode={},W=d.BlockCipherMode=_.extend({createEncryptor:function(Ee,Be){return this.Encryptor.create(Ee,Be)},createDecryptor:function(Ee,Be){return this.Decryptor.create(Ee,Be)},init:function(Ee,Be){this._cipher=Ee,this._iv=Be}}),N=U.CBC=function(){var Ee=W.extend();Ee.Encryptor=Ee.extend({processBlock:function(Fe,Ve){var Ct=this._cipher,Dt=Ct.blockSize;Be.call(this,Fe,Ve,Dt),Ct.encryptBlock(Fe,Ve),this._prevBlock=Fe.slice(Ve,Ve+Dt)}}),Ee.Decryptor=Ee.extend({processBlock:function(Fe,Ve){var Ct=this._cipher,Dt=Ct.blockSize,Ut=Fe.slice(Ve,Ve+Dt);Ct.decryptBlock(Fe,Ve),Be.call(this,Fe,Ve,Dt),this._prevBlock=Ut}});function Be(Fe,Ve,Ct){var Dt,Ut=this._iv;Ut?(Dt=Ut,this._iv=a):Dt=this._prevBlock;for(var cr=0;cr<Ct;cr++)Fe[Ve+cr]^=Dt[cr]}return Ee}(),V=u.pad={},R=V.Pkcs7={pad:function(Ee,Be){for(var Fe=Be*4,Ve=Fe-Ee.sigBytes%Fe,Ct=Ve<<24|Ve<<16|Ve<<8|Ve,Dt=[],Ut=0;Ut<Ve;Ut+=4)Dt.push(Ct);var cr=l.create(Dt,Ve);Ee.concat(cr)},unpad:function(Ee){var Be=Ee.words[Ee.sigBytes-1>>>2]&255;Ee.sigBytes-=Be}};d.BlockCipher=$.extend({cfg:$.cfg.extend({mode:N,padding:R}),reset:function(){var Ee;$.reset.call(this);var Be=this.cfg,Fe=Be.iv,Ve=Be.mode;this._xformMode==this._ENC_XFORM_MODE?Ee=Ve.createEncryptor:(Ee=Ve.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==Ee?this._mode.init(this,Fe&&Fe.words):(this._mode=Ee.call(Ve,this,Fe&&Fe.words),this._mode.__creator=Ee)},_doProcessBlock:function(Ee,Be){this._mode.processBlock(Ee,Be)},_doFinalize:function(){var Ee,Be=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(Be.pad(this._data,this.blockSize),Ee=this._process(!0)):(Ee=this._process(!0),Be.unpad(Ee)),Ee},blockSize:128/32});var F=d.CipherParams=_.extend({init:function(Ee){this.mixIn(Ee)},toString:function(Ee){return(Ee||this.formatter).stringify(this)}}),H=u.format={},J=H.OpenSSL={stringify:function(Ee){var Be,Fe=Ee.ciphertext,Ve=Ee.salt;return Ve?Be=l.create([1398893684,1701076831]).concat(Ve).concat(Fe):Be=Fe,Be.toString(C)},parse:function(Ee){var Be,Fe=C.parse(Ee),Ve=Fe.words;return Ve[0]==1398893684&&Ve[1]==1701076831&&(Be=l.create(Ve.slice(2,4)),Ve.splice(0,4),Fe.sigBytes-=16),F.create({ciphertext:Fe,salt:Be})}},te=d.SerializableCipher=_.extend({cfg:_.extend({format:J}),encrypt:function(Ee,Be,Fe,Ve){Ve=this.cfg.extend(Ve);var Ct=Ee.createEncryptor(Fe,Ve),Dt=Ct.finalize(Be),Ut=Ct.cfg;return F.create({ciphertext:Dt,key:Fe,iv:Ut.iv,algorithm:Ee,mode:Ut.mode,padding:Ut.padding,blockSize:Ee.blockSize,formatter:Ve.format})},decrypt:function(Ee,Be,Fe,Ve){Ve=this.cfg.extend(Ve),Be=this._parse(Be,Ve.format);var Ct=Ee.createDecryptor(Fe,Ve).finalize(Be.ciphertext);return Ct},_parse:function(Ee,Be){return typeof Ee=="string"?Be.parse(Ee,this):Ee}}),se=u.kdf={},ge=se.OpenSSL={execute:function(Ee,Be,Fe,Ve,Ct){if(Ve||(Ve=l.random(64/8)),Ct)var Dt=z.create({keySize:Be+Fe,hasher:Ct}).compute(Ee,Ve);else var Dt=z.create({keySize:Be+Fe}).compute(Ee,Ve);var Ut=l.create(Dt.words.slice(Be),Fe*4);return Dt.sigBytes=Be*4,F.create({key:Dt,iv:Ut,salt:Ve})}},xe=d.PasswordBasedCipher=te.extend({cfg:te.cfg.extend({kdf:ge}),encrypt:function(Ee,Be,Fe,Ve){Ve=this.cfg.extend(Ve);var Ct=Ve.kdf.execute(Fe,Ee.keySize,Ee.ivSize,Ve.salt,Ve.hasher);Ve.iv=Ct.iv;var Dt=te.encrypt.call(this,Ee,Be,Ct.key,Ve);return Dt.mixIn(Ct),Dt},decrypt:function(Ee,Be,Fe,Ve){Ve=this.cfg.extend(Ve),Be=this._parse(Be,Ve.format);var Ct=Ve.kdf.execute(Fe,Ee.keySize,Ee.ivSize,Be.salt,Ve.hasher);Ve.iv=Ct.iv;var Dt=te.decrypt.call(this,Ee,Be,Ct.key,Ve);return Dt}})}()})}(yw)),yw.exports}var _w={exports:{}},AM;function EJ(){return AM||(AM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),gi())})($e,function(n){return n.mode.CFB=function(){var a=n.lib.BlockCipherMode.extend();a.Encryptor=a.extend({processBlock:function(d,_){var l=this._cipher,w=l.blockSize;u.call(this,d,_,w,l),this._prevBlock=d.slice(_,_+w)}}),a.Decryptor=a.extend({processBlock:function(d,_){var l=this._cipher,w=l.blockSize,T=d.slice(_,_+w);u.call(this,d,_,w,l),this._prevBlock=T}});function u(d,_,l,w){var T,C=this._iv;C?(T=C.slice(0),this._iv=void 0):T=this._prevBlock,w.encryptBlock(T,0);for(var P=0;P<l;P++)d[_+P]^=T[P]}return a}(),n.mode.CFB})}(_w)),_w.exports}var vw={exports:{}},IM;function SJ(){return IM||(IM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),gi())})($e,function(n){return n.mode.CTR=function(){var a=n.lib.BlockCipherMode.extend(),u=a.Encryptor=a.extend({processBlock:function(d,_){var l=this._cipher,w=l.blockSize,T=this._iv,C=this._counter;T&&(C=this._counter=T.slice(0),this._iv=void 0);var P=C.slice(0);l.encryptBlock(P,0),C[w-1]=C[w-1]+1|0;for(var z=0;z<w;z++)d[_+z]^=P[z]}});return a.Decryptor=u,a}(),n.mode.CTR})}(vw)),vw.exports}var xw={exports:{}},CM;function TJ(){return CM||(CM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),gi())})($e,function(n){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return n.mode.CTRGladman=function(){var a=n.lib.BlockCipherMode.extend();function u(l){if((l>>24&255)===255){var w=l>>16&255,T=l>>8&255,C=l&255;w===255?(w=0,T===255?(T=0,C===255?C=0:++C):++T):++w,l=0,l+=w<<16,l+=T<<8,l+=C}else l+=1<<24;return l}function d(l){return(l[0]=u(l[0]))===0&&(l[1]=u(l[1])),l}var _=a.Encryptor=a.extend({processBlock:function(l,w){var T=this._cipher,C=T.blockSize,P=this._iv,z=this._counter;P&&(z=this._counter=P.slice(0),this._iv=void 0),d(z);var $=z.slice(0);T.encryptBlock($,0);for(var U=0;U<C;U++)l[w+U]^=$[U]}});return a.Decryptor=_,a}(),n.mode.CTRGladman})}(xw)),xw.exports}var bw={exports:{}},kM;function AJ(){return kM||(kM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),gi())})($e,function(n){return n.mode.OFB=function(){var a=n.lib.BlockCipherMode.extend(),u=a.Encryptor=a.extend({processBlock:function(d,_){var l=this._cipher,w=l.blockSize,T=this._iv,C=this._keystream;T&&(C=this._keystream=T.slice(0),this._iv=void 0),l.encryptBlock(C,0);for(var P=0;P<w;P++)d[_+P]^=C[P]}});return a.Decryptor=u,a}(),n.mode.OFB})}(bw)),bw.exports}var ww={exports:{}},PM;function IJ(){return PM||(PM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),gi())})($e,function(n){return n.mode.ECB=function(){var a=n.lib.BlockCipherMode.extend();return a.Encryptor=a.extend({processBlock:function(u,d){this._cipher.encryptBlock(u,d)}}),a.Decryptor=a.extend({processBlock:function(u,d){this._cipher.decryptBlock(u,d)}}),a}(),n.mode.ECB})}(ww)),ww.exports}var Ew={exports:{}},DM;function CJ(){return DM||(DM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),gi())})($e,function(n){return n.pad.AnsiX923={pad:function(a,u){var d=a.sigBytes,_=u*4,l=_-d%_,w=d+l-1;a.clamp(),a.words[w>>>2]|=l<<24-w%4*8,a.sigBytes+=l},unpad:function(a){var u=a.words[a.sigBytes-1>>>2]&255;a.sigBytes-=u}},n.pad.Ansix923})}(Ew)),Ew.exports}var Sw={exports:{}},MM;function kJ(){return MM||(MM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),gi())})($e,function(n){return n.pad.Iso10126={pad:function(a,u){var d=u*4,_=d-a.sigBytes%d;a.concat(n.lib.WordArray.random(_-1)).concat(n.lib.WordArray.create([_<<24],1))},unpad:function(a){var u=a.words[a.sigBytes-1>>>2]&255;a.sigBytes-=u}},n.pad.Iso10126})}(Sw)),Sw.exports}var Tw={exports:{}},zM;function PJ(){return zM||(zM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),gi())})($e,function(n){return n.pad.Iso97971={pad:function(a,u){a.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(a,u)},unpad:function(a){n.pad.ZeroPadding.unpad(a),a.sigBytes--}},n.pad.Iso97971})}(Tw)),Tw.exports}var Aw={exports:{}},RM;function DJ(){return RM||(RM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),gi())})($e,function(n){return n.pad.ZeroPadding={pad:function(a,u){var d=u*4;a.clamp(),a.sigBytes+=d-(a.sigBytes%d||d)},unpad:function(a){for(var u=a.words,d=a.sigBytes-1,d=a.sigBytes-1;d>=0;d--)if(u[d>>>2]>>>24-d%4*8&255){a.sigBytes=d+1;break}}},n.pad.ZeroPadding})}(Aw)),Aw.exports}var Iw={exports:{}},OM;function MJ(){return OM||(OM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),gi())})($e,function(n){return n.pad.NoPadding={pad:function(){},unpad:function(){}},n.pad.NoPadding})}(Iw)),Iw.exports}var Cw={exports:{}},FM;function zJ(){return FM||(FM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),gi())})($e,function(n){return function(a){var u=n,d=u.lib,_=d.CipherParams,l=u.enc,w=l.Hex,T=u.format;T.Hex={stringify:function(C){return C.ciphertext.toString(w)},parse:function(C){var P=w.parse(C);return _.create({ciphertext:P})}}}(),n.format.Hex})}(Cw)),Cw.exports}var kw={exports:{}},LM;function RJ(){return LM||(LM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),ju(),Vu(),Ac(),gi())})($e,function(n){return function(){var a=n,u=a.lib,d=u.BlockCipher,_=a.algo,l=[],w=[],T=[],C=[],P=[],z=[],$=[],U=[],W=[],N=[];(function(){for(var F=[],H=0;H<256;H++)H<128?F[H]=H<<1:F[H]=H<<1^283;for(var J=0,te=0,H=0;H<256;H++){var se=te^te<<1^te<<2^te<<3^te<<4;se=se>>>8^se&255^99,l[J]=se,w[se]=J;var ge=F[J],xe=F[ge],Ee=F[xe],Be=F[se]*257^se*16843008;T[J]=Be<<24|Be>>>8,C[J]=Be<<16|Be>>>16,P[J]=Be<<8|Be>>>24,z[J]=Be;var Be=Ee*16843009^xe*65537^ge*257^J*16843008;$[se]=Be<<24|Be>>>8,U[se]=Be<<16|Be>>>16,W[se]=Be<<8|Be>>>24,N[se]=Be,J?(J=ge^F[F[F[Ee^ge]]],te^=F[F[te]]):J=te=1}})();var V=[0,1,2,4,8,16,32,64,128,27,54],R=_.AES=d.extend({_doReset:function(){var F;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var H=this._keyPriorReset=this._key,J=H.words,te=H.sigBytes/4,se=this._nRounds=te+6,ge=(se+1)*4,xe=this._keySchedule=[],Ee=0;Ee<ge;Ee++)Ee<te?xe[Ee]=J[Ee]:(F=xe[Ee-1],Ee%te?te>6&&Ee%te==4&&(F=l[F>>>24]<<24|l[F>>>16&255]<<16|l[F>>>8&255]<<8|l[F&255]):(F=F<<8|F>>>24,F=l[F>>>24]<<24|l[F>>>16&255]<<16|l[F>>>8&255]<<8|l[F&255],F^=V[Ee/te|0]<<24),xe[Ee]=xe[Ee-te]^F);for(var Be=this._invKeySchedule=[],Fe=0;Fe<ge;Fe++){var Ee=ge-Fe;if(Fe%4)var F=xe[Ee];else var F=xe[Ee-4];Fe<4||Ee<=4?Be[Fe]=F:Be[Fe]=$[l[F>>>24]]^U[l[F>>>16&255]]^W[l[F>>>8&255]]^N[l[F&255]]}}},encryptBlock:function(F,H){this._doCryptBlock(F,H,this._keySchedule,T,C,P,z,l)},decryptBlock:function(F,H){var J=F[H+1];F[H+1]=F[H+3],F[H+3]=J,this._doCryptBlock(F,H,this._invKeySchedule,$,U,W,N,w);var J=F[H+1];F[H+1]=F[H+3],F[H+3]=J},_doCryptBlock:function(F,H,J,te,se,ge,xe,Ee){for(var Be=this._nRounds,Fe=F[H]^J[0],Ve=F[H+1]^J[1],Ct=F[H+2]^J[2],Dt=F[H+3]^J[3],Ut=4,cr=1;cr<Be;cr++){var qe=te[Fe>>>24]^se[Ve>>>16&255]^ge[Ct>>>8&255]^xe[Dt&255]^J[Ut++],St=te[Ve>>>24]^se[Ct>>>16&255]^ge[Dt>>>8&255]^xe[Fe&255]^J[Ut++],gt=te[Ct>>>24]^se[Dt>>>16&255]^ge[Fe>>>8&255]^xe[Ve&255]^J[Ut++],je=te[Dt>>>24]^se[Fe>>>16&255]^ge[Ve>>>8&255]^xe[Ct&255]^J[Ut++];Fe=qe,Ve=St,Ct=gt,Dt=je}var qe=(Ee[Fe>>>24]<<24|Ee[Ve>>>16&255]<<16|Ee[Ct>>>8&255]<<8|Ee[Dt&255])^J[Ut++],St=(Ee[Ve>>>24]<<24|Ee[Ct>>>16&255]<<16|Ee[Dt>>>8&255]<<8|Ee[Fe&255])^J[Ut++],gt=(Ee[Ct>>>24]<<24|Ee[Dt>>>16&255]<<16|Ee[Fe>>>8&255]<<8|Ee[Ve&255])^J[Ut++],je=(Ee[Dt>>>24]<<24|Ee[Fe>>>16&255]<<16|Ee[Ve>>>8&255]<<8|Ee[Ct&255])^J[Ut++];F[H]=qe,F[H+1]=St,F[H+2]=gt,F[H+3]=je},keySize:256/32});a.AES=d._createHelper(R)}(),n.AES})}(kw)),kw.exports}var Pw={exports:{}},BM;function OJ(){return BM||(BM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),ju(),Vu(),Ac(),gi())})($e,function(n){return function(){var a=n,u=a.lib,d=u.WordArray,_=u.BlockCipher,l=a.algo,w=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],T=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],C=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],P=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],z=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],$=l.DES=_.extend({_doReset:function(){for(var V=this._key,R=V.words,F=[],H=0;H<56;H++){var J=w[H]-1;F[H]=R[J>>>5]>>>31-J%32&1}for(var te=this._subKeys=[],se=0;se<16;se++){for(var ge=te[se]=[],xe=C[se],H=0;H<24;H++)ge[H/6|0]|=F[(T[H]-1+xe)%28]<<31-H%6,ge[4+(H/6|0)]|=F[28+(T[H+24]-1+xe)%28]<<31-H%6;ge[0]=ge[0]<<1|ge[0]>>>31;for(var H=1;H<7;H++)ge[H]=ge[H]>>>(H-1)*4+3;ge[7]=ge[7]<<5|ge[7]>>>27}for(var Ee=this._invSubKeys=[],H=0;H<16;H++)Ee[H]=te[15-H]},encryptBlock:function(V,R){this._doCryptBlock(V,R,this._subKeys)},decryptBlock:function(V,R){this._doCryptBlock(V,R,this._invSubKeys)},_doCryptBlock:function(V,R,F){this._lBlock=V[R],this._rBlock=V[R+1],U.call(this,4,252645135),U.call(this,16,65535),W.call(this,2,858993459),W.call(this,8,16711935),U.call(this,1,1431655765);for(var H=0;H<16;H++){for(var J=F[H],te=this._lBlock,se=this._rBlock,ge=0,xe=0;xe<8;xe++)ge|=P[xe][((se^J[xe])&z[xe])>>>0];this._lBlock=se,this._rBlock=te^ge}var Ee=this._lBlock;this._lBlock=this._rBlock,this._rBlock=Ee,U.call(this,1,1431655765),W.call(this,8,16711935),W.call(this,2,858993459),U.call(this,16,65535),U.call(this,4,252645135),V[R]=this._lBlock,V[R+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function U(V,R){var F=(this._lBlock>>>V^this._rBlock)&R;this._rBlock^=F,this._lBlock^=F<<V}function W(V,R){var F=(this._rBlock>>>V^this._lBlock)&R;this._lBlock^=F,this._rBlock^=F<<V}a.DES=_._createHelper($);var N=l.TripleDES=_.extend({_doReset:function(){var V=this._key,R=V.words;if(R.length!==2&&R.length!==4&&R.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var F=R.slice(0,2),H=R.length<4?R.slice(0,2):R.slice(2,4),J=R.length<6?R.slice(0,2):R.slice(4,6);this._des1=$.createEncryptor(d.create(F)),this._des2=$.createEncryptor(d.create(H)),this._des3=$.createEncryptor(d.create(J))},encryptBlock:function(V,R){this._des1.encryptBlock(V,R),this._des2.decryptBlock(V,R),this._des3.encryptBlock(V,R)},decryptBlock:function(V,R){this._des3.decryptBlock(V,R),this._des2.encryptBlock(V,R),this._des1.decryptBlock(V,R)},keySize:192/32,ivSize:64/32,blockSize:64/32});a.TripleDES=_._createHelper(N)}(),n.TripleDES})}(Pw)),Pw.exports}var Dw={exports:{}},NM;function FJ(){return NM||(NM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),ju(),Vu(),Ac(),gi())})($e,function(n){return function(){var a=n,u=a.lib,d=u.StreamCipher,_=a.algo,l=_.RC4=d.extend({_doReset:function(){for(var C=this._key,P=C.words,z=C.sigBytes,$=this._S=[],U=0;U<256;U++)$[U]=U;for(var U=0,W=0;U<256;U++){var N=U%z,V=P[N>>>2]>>>24-N%4*8&255;W=(W+$[U]+V)%256;var R=$[U];$[U]=$[W],$[W]=R}this._i=this._j=0},_doProcessBlock:function(C,P){C[P]^=w.call(this)},keySize:256/32,ivSize:0});function w(){for(var C=this._S,P=this._i,z=this._j,$=0,U=0;U<4;U++){P=(P+1)%256,z=(z+C[P])%256;var W=C[P];C[P]=C[z],C[z]=W,$|=C[(C[P]+C[z])%256]<<24-U*8}return this._i=P,this._j=z,$}a.RC4=d._createHelper(l);var T=_.RC4Drop=l.extend({cfg:l.cfg.extend({drop:192}),_doReset:function(){l._doReset.call(this);for(var C=this.cfg.drop;C>0;C--)w.call(this)}});a.RC4Drop=d._createHelper(T)}(),n.RC4})}(Dw)),Dw.exports}var Mw={exports:{}},UM;function LJ(){return UM||(UM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),ju(),Vu(),Ac(),gi())})($e,function(n){return function(){var a=n,u=a.lib,d=u.StreamCipher,_=a.algo,l=[],w=[],T=[],C=_.Rabbit=d.extend({_doReset:function(){for(var z=this._key.words,$=this.cfg.iv,U=0;U<4;U++)z[U]=(z[U]<<8|z[U]>>>24)&16711935|(z[U]<<24|z[U]>>>8)&4278255360;var W=this._X=[z[0],z[3]<<16|z[2]>>>16,z[1],z[0]<<16|z[3]>>>16,z[2],z[1]<<16|z[0]>>>16,z[3],z[2]<<16|z[1]>>>16],N=this._C=[z[2]<<16|z[2]>>>16,z[0]&4294901760|z[1]&65535,z[3]<<16|z[3]>>>16,z[1]&4294901760|z[2]&65535,z[0]<<16|z[0]>>>16,z[2]&4294901760|z[3]&65535,z[1]<<16|z[1]>>>16,z[3]&4294901760|z[0]&65535];this._b=0;for(var U=0;U<4;U++)P.call(this);for(var U=0;U<8;U++)N[U]^=W[U+4&7];if($){var V=$.words,R=V[0],F=V[1],H=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360,J=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360,te=H>>>16|J&4294901760,se=J<<16|H&65535;N[0]^=H,N[1]^=te,N[2]^=J,N[3]^=se,N[4]^=H,N[5]^=te,N[6]^=J,N[7]^=se;for(var U=0;U<4;U++)P.call(this)}},_doProcessBlock:function(z,$){var U=this._X;P.call(this),l[0]=U[0]^U[5]>>>16^U[3]<<16,l[1]=U[2]^U[7]>>>16^U[5]<<16,l[2]=U[4]^U[1]>>>16^U[7]<<16,l[3]=U[6]^U[3]>>>16^U[1]<<16;for(var W=0;W<4;W++)l[W]=(l[W]<<8|l[W]>>>24)&16711935|(l[W]<<24|l[W]>>>8)&4278255360,z[$+W]^=l[W]},blockSize:128/32,ivSize:64/32});function P(){for(var z=this._X,$=this._C,U=0;U<8;U++)w[U]=$[U];$[0]=$[0]+1295307597+this._b|0,$[1]=$[1]+3545052371+($[0]>>>0<w[0]>>>0?1:0)|0,$[2]=$[2]+886263092+($[1]>>>0<w[1]>>>0?1:0)|0,$[3]=$[3]+1295307597+($[2]>>>0<w[2]>>>0?1:0)|0,$[4]=$[4]+3545052371+($[3]>>>0<w[3]>>>0?1:0)|0,$[5]=$[5]+886263092+($[4]>>>0<w[4]>>>0?1:0)|0,$[6]=$[6]+1295307597+($[5]>>>0<w[5]>>>0?1:0)|0,$[7]=$[7]+3545052371+($[6]>>>0<w[6]>>>0?1:0)|0,this._b=$[7]>>>0<w[7]>>>0?1:0;for(var U=0;U<8;U++){var W=z[U]+$[U],N=W&65535,V=W>>>16,R=((N*N>>>17)+N*V>>>15)+V*V,F=((W&4294901760)*W|0)+((W&65535)*W|0);T[U]=R^F}z[0]=T[0]+(T[7]<<16|T[7]>>>16)+(T[6]<<16|T[6]>>>16)|0,z[1]=T[1]+(T[0]<<8|T[0]>>>24)+T[7]|0,z[2]=T[2]+(T[1]<<16|T[1]>>>16)+(T[0]<<16|T[0]>>>16)|0,z[3]=T[3]+(T[2]<<8|T[2]>>>24)+T[1]|0,z[4]=T[4]+(T[3]<<16|T[3]>>>16)+(T[2]<<16|T[2]>>>16)|0,z[5]=T[5]+(T[4]<<8|T[4]>>>24)+T[3]|0,z[6]=T[6]+(T[5]<<16|T[5]>>>16)+(T[4]<<16|T[4]>>>16)|0,z[7]=T[7]+(T[6]<<8|T[6]>>>24)+T[5]|0}a.Rabbit=d._createHelper(C)}(),n.Rabbit})}(Mw)),Mw.exports}var zw={exports:{}},jM;function BJ(){return jM||(jM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),ju(),Vu(),Ac(),gi())})($e,function(n){return function(){var a=n,u=a.lib,d=u.StreamCipher,_=a.algo,l=[],w=[],T=[],C=_.RabbitLegacy=d.extend({_doReset:function(){var z=this._key.words,$=this.cfg.iv,U=this._X=[z[0],z[3]<<16|z[2]>>>16,z[1],z[0]<<16|z[3]>>>16,z[2],z[1]<<16|z[0]>>>16,z[3],z[2]<<16|z[1]>>>16],W=this._C=[z[2]<<16|z[2]>>>16,z[0]&4294901760|z[1]&65535,z[3]<<16|z[3]>>>16,z[1]&4294901760|z[2]&65535,z[0]<<16|z[0]>>>16,z[2]&4294901760|z[3]&65535,z[1]<<16|z[1]>>>16,z[3]&4294901760|z[0]&65535];this._b=0;for(var N=0;N<4;N++)P.call(this);for(var N=0;N<8;N++)W[N]^=U[N+4&7];if($){var V=$.words,R=V[0],F=V[1],H=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360,J=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360,te=H>>>16|J&4294901760,se=J<<16|H&65535;W[0]^=H,W[1]^=te,W[2]^=J,W[3]^=se,W[4]^=H,W[5]^=te,W[6]^=J,W[7]^=se;for(var N=0;N<4;N++)P.call(this)}},_doProcessBlock:function(z,$){var U=this._X;P.call(this),l[0]=U[0]^U[5]>>>16^U[3]<<16,l[1]=U[2]^U[7]>>>16^U[5]<<16,l[2]=U[4]^U[1]>>>16^U[7]<<16,l[3]=U[6]^U[3]>>>16^U[1]<<16;for(var W=0;W<4;W++)l[W]=(l[W]<<8|l[W]>>>24)&16711935|(l[W]<<24|l[W]>>>8)&4278255360,z[$+W]^=l[W]},blockSize:128/32,ivSize:64/32});function P(){for(var z=this._X,$=this._C,U=0;U<8;U++)w[U]=$[U];$[0]=$[0]+1295307597+this._b|0,$[1]=$[1]+3545052371+($[0]>>>0<w[0]>>>0?1:0)|0,$[2]=$[2]+886263092+($[1]>>>0<w[1]>>>0?1:0)|0,$[3]=$[3]+1295307597+($[2]>>>0<w[2]>>>0?1:0)|0,$[4]=$[4]+3545052371+($[3]>>>0<w[3]>>>0?1:0)|0,$[5]=$[5]+886263092+($[4]>>>0<w[4]>>>0?1:0)|0,$[6]=$[6]+1295307597+($[5]>>>0<w[5]>>>0?1:0)|0,$[7]=$[7]+3545052371+($[6]>>>0<w[6]>>>0?1:0)|0,this._b=$[7]>>>0<w[7]>>>0?1:0;for(var U=0;U<8;U++){var W=z[U]+$[U],N=W&65535,V=W>>>16,R=((N*N>>>17)+N*V>>>15)+V*V,F=((W&4294901760)*W|0)+((W&65535)*W|0);T[U]=R^F}z[0]=T[0]+(T[7]<<16|T[7]>>>16)+(T[6]<<16|T[6]>>>16)|0,z[1]=T[1]+(T[0]<<8|T[0]>>>24)+T[7]|0,z[2]=T[2]+(T[1]<<16|T[1]>>>16)+(T[0]<<16|T[0]>>>16)|0,z[3]=T[3]+(T[2]<<8|T[2]>>>24)+T[1]|0,z[4]=T[4]+(T[3]<<16|T[3]>>>16)+(T[2]<<16|T[2]>>>16)|0,z[5]=T[5]+(T[4]<<8|T[4]>>>24)+T[3]|0,z[6]=T[6]+(T[5]<<16|T[5]>>>16)+(T[4]<<16|T[4]>>>16)|0,z[7]=T[7]+(T[6]<<8|T[6]>>>24)+T[5]|0}a.RabbitLegacy=d._createHelper(C)}(),n.RabbitLegacy})}(zw)),zw.exports}var Rw={exports:{}},VM;function NJ(){return VM||(VM=1,function(t,e){(function(n,a,u){t.exports=a(kr(),ju(),Vu(),Ac(),gi())})($e,function(n){return function(){var a=n,u=a.lib,d=u.BlockCipher,_=a.algo;const l=16,w=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],T=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var C={pbox:[],sbox:[]};function P(N,V){let R=V>>24&255,F=V>>16&255,H=V>>8&255,J=V&255,te=N.sbox[0][R]+N.sbox[1][F];return te=te^N.sbox[2][H],te=te+N.sbox[3][J],te}function z(N,V,R){let F=V,H=R,J;for(let te=0;te<l;++te)F=F^N.pbox[te],H=P(N,F)^H,J=F,F=H,H=J;return J=F,F=H,H=J,H=H^N.pbox[l],F=F^N.pbox[l+1],{left:F,right:H}}function $(N,V,R){let F=V,H=R,J;for(let te=l+1;te>1;--te)F=F^N.pbox[te],H=P(N,F)^H,J=F,F=H,H=J;return J=F,F=H,H=J,H=H^N.pbox[1],F=F^N.pbox[0],{left:F,right:H}}function U(N,V,R){for(let se=0;se<4;se++){N.sbox[se]=[];for(let ge=0;ge<256;ge++)N.sbox[se][ge]=T[se][ge]}let F=0;for(let se=0;se<l+2;se++)N.pbox[se]=w[se]^V[F],F++,F>=R&&(F=0);let H=0,J=0,te=0;for(let se=0;se<l+2;se+=2)te=z(N,H,J),H=te.left,J=te.right,N.pbox[se]=H,N.pbox[se+1]=J;for(let se=0;se<4;se++)for(let ge=0;ge<256;ge+=2)te=z(N,H,J),H=te.left,J=te.right,N.sbox[se][ge]=H,N.sbox[se][ge+1]=J;return!0}var W=_.Blowfish=d.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var N=this._keyPriorReset=this._key,V=N.words,R=N.sigBytes/4;U(C,V,R)}},encryptBlock:function(N,V){var R=z(C,N[V],N[V+1]);N[V]=R.left,N[V+1]=R.right},decryptBlock:function(N,V){var R=$(C,N[V],N[V+1]);N[V]=R.left,N[V+1]=R.right},blockSize:64/32,keySize:128/32,ivSize:64/32});a.Blowfish=d._createHelper(W)}(),n.Blowfish})}(Rw)),Rw.exports}(function(t,e){(function(n,a,u){t.exports=a(kr(),Kv(),mJ(),gJ(),ju(),yJ(),Vu(),WO(),PA(),_J(),GO(),vJ(),xJ(),bJ(),DA(),wJ(),Ac(),gi(),EJ(),SJ(),TJ(),AJ(),IJ(),CJ(),kJ(),PJ(),DJ(),MJ(),zJ(),RJ(),OJ(),FJ(),LJ(),BJ(),NJ())})($e,function(n){return n})})($O);var UJ=$O.exports;const Jy=L_(UJ),jJ={}.VITE_TABLEAU_CLIENT_ID,VJ={}.VITE_TABLEAU_SECRET_ID,$J={}.VITE_TABLEAU_SECRET_VALUE,WJ={}.VITE_TABLEAU_USER,GJ=10,HJ=["tableau:views:embed"];function Ow(t){let e=Jy.enc.Base64.stringify(t);return e=e.replace(/=+$/,""),e=e.replace(/\+/g,"-"),e=e.replace(/\//g,"_"),e}function qJ(t,e,n,a,u){const d={alg:"HS256",typ:"JWT",iss:a,kid:e},_=Jy.enc.Utf8.parse(JSON.stringify(d)),l=Ow(_),w={sub:t,aud:"tableau",nbf:Math.round(new Date().getTime()/1e3)-100,jti:new Date().getTime().toString(),iss:a,scp:u,exp:Math.round(new Date().getTime()/1e3)+GJ*60},T=Jy.enc.Utf8.parse(JSON.stringify(w)),C=Ow(T),P=l+"."+C,z=Jy.HmacSHA256(P,n),$=Ow(z),U=P+"."+$;return console.log(U),U}const ed=document.querySelector("tableau-viz, tableau-authoring-viz");ed.token=qJ(WJ,VJ,$J,jJ,HJ);new Promise((t,e)=>{ed.addEventListener(sM.FirstInteractive,()=>{console.log("Viz is interactive!"),t()}),ed.addEventListener(sM.VizLoadError,n=>{const a=JSON.parse(n.detail.message),d=`ca-error-${JSON.parse(a.errorMessage).result.errors[0].code}`;e(d)})}).then(t=>{let e;ed.workbook.activeSheet.sheetType===aJ.Dashboard?(e=ed.workbook.activeSheet,e.worksheets.find(n=>n.name==="Replace-Name-of-Worksheet")):ed.workbook.activeSheet});
