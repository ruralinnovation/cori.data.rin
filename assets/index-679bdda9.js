import Or from"@tableau/api-external-contract-js";import $r from"@tableau/api-shared-js";import ho from"@tableau/api-internal-contract-js";import YD from"@tableau/api-external-contract-js/lib/src/ExternalContract/Embedding/Enums";function JD(t,r){for(var a=0;a<r.length;a++){const c=r[a];if(typeof c!="string"&&!Array.isArray(c)){for(const f in c)if(f!=="default"&&!(f in t)){const _=Object.getOwnPropertyDescriptor(c,f);_&&Object.defineProperty(t,f,_.get?_:{enumerable:!0,get:()=>c[f]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))c(f);new MutationObserver(f=>{for(const _ of f)if(_.type==="childList")for(const b of _.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&c(b)}).observe(document,{childList:!0,subtree:!0});function a(f){const _={};return f.integrity&&(_.integrity=f.integrity),f.referrerPolicy&&(_.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?_.credentials="include":f.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function c(f){if(f.ep)return;f.ep=!0;const _=a(f);fetch(f.href,_)}})();var gt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function s1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function hC(t){if(t.__esModule)return t;var r=t.default;if(typeof r=="function"){var a=function c(){return this instanceof c?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};a.prototype=r.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(t).forEach(function(c){var f=Object.getOwnPropertyDescriptor(t,c);Object.defineProperty(a,c,f.get?f:{enumerable:!0,get:function(){return t[c]}})}),a}var dC={exports:{}},pr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wp=Symbol.for("react.element"),QD=Symbol.for("react.portal"),eM=Symbol.for("react.fragment"),tM=Symbol.for("react.strict_mode"),rM=Symbol.for("react.profiler"),nM=Symbol.for("react.provider"),iM=Symbol.for("react.context"),oM=Symbol.for("react.forward_ref"),sM=Symbol.for("react.suspense"),aM=Symbol.for("react.memo"),lM=Symbol.for("react.lazy"),D2=Symbol.iterator;function cM(t){return t===null||typeof t!="object"?null:(t=D2&&t[D2]||t["@@iterator"],typeof t=="function"?t:null)}var pC={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},fC=Object.assign,mC={};function ah(t,r,a){this.props=t,this.context=r,this.refs=mC,this.updater=a||pC}ah.prototype.isReactComponent={};ah.prototype.setState=function(t,r){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,r,"setState")};ah.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function gC(){}gC.prototype=ah.prototype;function a1(t,r,a){this.props=t,this.context=r,this.refs=mC,this.updater=a||pC}var l1=a1.prototype=new gC;l1.constructor=a1;fC(l1,ah.prototype);l1.isPureReactComponent=!0;var M2=Array.isArray,_C=Object.prototype.hasOwnProperty,c1={current:null},yC={key:!0,ref:!0,__self:!0,__source:!0};function xC(t,r,a){var c,f={},_=null,b=null;if(r!=null)for(c in r.ref!==void 0&&(b=r.ref),r.key!==void 0&&(_=""+r.key),r)_C.call(r,c)&&!yC.hasOwnProperty(c)&&(f[c]=r[c]);var s=arguments.length-2;if(s===1)f.children=a;else if(1<s){for(var S=Array(s),C=0;C<s;C++)S[C]=arguments[C+2];f.children=S}if(t&&t.defaultProps)for(c in s=t.defaultProps,s)f[c]===void 0&&(f[c]=s[c]);return{$$typeof:Wp,type:t,key:_,ref:b,props:f,_owner:c1.current}}function uM(t,r){return{$$typeof:Wp,type:t.type,key:r,ref:t.ref,props:t.props,_owner:t._owner}}function u1(t){return typeof t=="object"&&t!==null&&t.$$typeof===Wp}function hM(t){var r={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(a){return r[a]})}var R2=/\/+/g;function ky(t,r){return typeof t=="object"&&t!==null&&t.key!=null?hM(""+t.key):r.toString(36)}function h0(t,r,a,c,f){var _=typeof t;(_==="undefined"||_==="boolean")&&(t=null);var b=!1;if(t===null)b=!0;else switch(_){case"string":case"number":b=!0;break;case"object":switch(t.$$typeof){case Wp:case QD:b=!0}}if(b)return b=t,f=f(b),t=c===""?"."+ky(b,0):c,M2(f)?(a="",t!=null&&(a=t.replace(R2,"$&/")+"/"),h0(f,r,a,"",function(C){return C})):f!=null&&(u1(f)&&(f=uM(f,a+(!f.key||b&&b.key===f.key?"":(""+f.key).replace(R2,"$&/")+"/")+t)),r.push(f)),1;if(b=0,c=c===""?".":c+":",M2(t))for(var s=0;s<t.length;s++){_=t[s];var S=c+ky(_,s);b+=h0(_,r,a,S,f)}else if(S=cM(t),typeof S=="function")for(t=S.call(t),s=0;!(_=t.next()).done;)_=_.value,S=c+ky(_,s++),b+=h0(_,r,a,S,f);else if(_==="object")throw r=String(t),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return b}function Cm(t,r,a){if(t==null)return t;var c=[],f=0;return h0(t,c,"","",function(_){return r.call(a,_,f++)}),c}function dM(t){if(t._status===-1){var r=t._result;r=r(),r.then(function(a){(t._status===0||t._status===-1)&&(t._status=1,t._result=a)},function(a){(t._status===0||t._status===-1)&&(t._status=2,t._result=a)}),t._status===-1&&(t._status=0,t._result=r)}if(t._status===1)return t._result.default;throw t._result}var Pi={current:null},d0={transition:null},pM={ReactCurrentDispatcher:Pi,ReactCurrentBatchConfig:d0,ReactCurrentOwner:c1};function vC(){throw Error("act(...) is not supported in production builds of React.")}pr.Children={map:Cm,forEach:function(t,r,a){Cm(t,function(){r.apply(this,arguments)},a)},count:function(t){var r=0;return Cm(t,function(){r++}),r},toArray:function(t){return Cm(t,function(r){return r})||[]},only:function(t){if(!u1(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};pr.Component=ah;pr.Fragment=eM;pr.Profiler=rM;pr.PureComponent=a1;pr.StrictMode=tM;pr.Suspense=sM;pr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pM;pr.act=vC;pr.cloneElement=function(t,r,a){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var c=fC({},t.props),f=t.key,_=t.ref,b=t._owner;if(r!=null){if(r.ref!==void 0&&(_=r.ref,b=c1.current),r.key!==void 0&&(f=""+r.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(S in r)_C.call(r,S)&&!yC.hasOwnProperty(S)&&(c[S]=r[S]===void 0&&s!==void 0?s[S]:r[S])}var S=arguments.length-2;if(S===1)c.children=a;else if(1<S){s=Array(S);for(var C=0;C<S;C++)s[C]=arguments[C+2];c.children=s}return{$$typeof:Wp,type:t.type,key:f,ref:_,props:c,_owner:b}};pr.createContext=function(t){return t={$$typeof:iM,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:nM,_context:t},t.Consumer=t};pr.createElement=xC;pr.createFactory=function(t){var r=xC.bind(null,t);return r.type=t,r};pr.createRef=function(){return{current:null}};pr.forwardRef=function(t){return{$$typeof:oM,render:t}};pr.isValidElement=u1;pr.lazy=function(t){return{$$typeof:lM,_payload:{_status:-1,_result:t},_init:dM}};pr.memo=function(t,r){return{$$typeof:aM,type:t,compare:r===void 0?null:r}};pr.startTransition=function(t){var r=d0.transition;d0.transition={};try{t()}finally{d0.transition=r}};pr.unstable_act=vC;pr.useCallback=function(t,r){return Pi.current.useCallback(t,r)};pr.useContext=function(t){return Pi.current.useContext(t)};pr.useDebugValue=function(){};pr.useDeferredValue=function(t){return Pi.current.useDeferredValue(t)};pr.useEffect=function(t,r){return Pi.current.useEffect(t,r)};pr.useId=function(){return Pi.current.useId()};pr.useImperativeHandle=function(t,r,a){return Pi.current.useImperativeHandle(t,r,a)};pr.useInsertionEffect=function(t,r){return Pi.current.useInsertionEffect(t,r)};pr.useLayoutEffect=function(t,r){return Pi.current.useLayoutEffect(t,r)};pr.useMemo=function(t,r){return Pi.current.useMemo(t,r)};pr.useReducer=function(t,r,a){return Pi.current.useReducer(t,r,a)};pr.useRef=function(t){return Pi.current.useRef(t)};pr.useState=function(t){return Pi.current.useState(t)};pr.useSyncExternalStore=function(t,r,a){return Pi.current.useSyncExternalStore(t,r,a)};pr.useTransition=function(){return Pi.current.useTransition()};pr.version="18.3.1";dC.exports=pr;var wt=dC.exports;const Py=s1(wt);var bC={exports:{}},po={},wC={exports:{}},EC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function r(Ge,St){var ft=Ge.length;Ge.push(St);e:for(;0<ft;){var Ve=ft-1>>>1,Je=Ge[Ve];if(0<f(Je,St))Ge[Ve]=St,Ge[ft]=Je,ft=Ve;else break e}}function a(Ge){return Ge.length===0?null:Ge[0]}function c(Ge){if(Ge.length===0)return null;var St=Ge[0],ft=Ge.pop();if(ft!==St){Ge[0]=ft;e:for(var Ve=0,Je=Ge.length,et=Je>>>1;Ve<et;){var tt=2*(Ve+1)-1,ir=Ge[tt],Zt=tt+1,vr=Ge[Zt];if(0>f(ir,ft))Zt<Je&&0>f(vr,ir)?(Ge[Ve]=vr,Ge[Zt]=ft,Ve=Zt):(Ge[Ve]=ir,Ge[tt]=ft,Ve=tt);else if(Zt<Je&&0>f(vr,ft))Ge[Ve]=vr,Ge[Zt]=ft,Ve=Zt;else break e}}return St}function f(Ge,St){var ft=Ge.sortIndex-St.sortIndex;return ft!==0?ft:Ge.id-St.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;t.unstable_now=function(){return _.now()}}else{var b=Date,s=b.now();t.unstable_now=function(){return b.now()-s}}var S=[],C=[],k=1,M=null,L=3,V=!1,O=!1,j=!1,H=typeof setTimeout=="function"?setTimeout:null,Z=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function $(Ge){for(var St=a(C);St!==null;){if(St.callback===null)c(C);else if(St.startTime<=Ge)c(C),St.sortIndex=St.expirationTime,r(S,St);else break;St=a(C)}}function J(Ge){if(j=!1,$(Ge),!O)if(a(S)!==null)O=!0,Ut(le);else{var St=a(C);St!==null&&sr(J,St.startTime-Ge)}}function le(Ge,St){O=!1,j&&(j=!1,Z(Te),Te=-1),V=!0;var ft=L;try{for($(St),M=a(S);M!==null&&(!(M.expirationTime>St)||Ge&&!Ne());){var Ve=M.callback;if(typeof Ve=="function"){M.callback=null,L=M.priorityLevel;var Je=Ve(M.expirationTime<=St);St=t.unstable_now(),typeof Je=="function"?M.callback=Je:M===a(S)&&c(S),$(St)}else c(S);M=a(S)}if(M!==null)var et=!0;else{var tt=a(C);tt!==null&&sr(J,tt.startTime-St),et=!1}return et}finally{M=null,L=ft,V=!1}}var pe=!1,ye=null,Te=-1,Se=5,Ae=-1;function Ne(){return!(t.unstable_now()-Ae<Se)}function Ue(){if(ye!==null){var Ge=t.unstable_now();Ae=Ge;var St=!0;try{St=ye(!0,Ge)}finally{St?je():(pe=!1,ye=null)}}else pe=!1}var je;if(typeof U=="function")je=function(){U(Ue)};else if(typeof MessageChannel<"u"){var Ct=new MessageChannel,zt=Ct.port2;Ct.port1.onmessage=Ue,je=function(){zt.postMessage(null)}}else je=function(){H(Ue,0)};function Ut(Ge){ye=Ge,pe||(pe=!0,je())}function sr(Ge,St){Te=H(function(){Ge(t.unstable_now())},St)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ge){Ge.callback=null},t.unstable_continueExecution=function(){O||V||(O=!0,Ut(le))},t.unstable_forceFrameRate=function(Ge){0>Ge||125<Ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Se=0<Ge?Math.floor(1e3/Ge):5},t.unstable_getCurrentPriorityLevel=function(){return L},t.unstable_getFirstCallbackNode=function(){return a(S)},t.unstable_next=function(Ge){switch(L){case 1:case 2:case 3:var St=3;break;default:St=L}var ft=L;L=St;try{return Ge()}finally{L=ft}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Ge,St){switch(Ge){case 1:case 2:case 3:case 4:case 5:break;default:Ge=3}var ft=L;L=Ge;try{return St()}finally{L=ft}},t.unstable_scheduleCallback=function(Ge,St,ft){var Ve=t.unstable_now();switch(typeof ft=="object"&&ft!==null?(ft=ft.delay,ft=typeof ft=="number"&&0<ft?Ve+ft:Ve):ft=Ve,Ge){case 1:var Je=-1;break;case 2:Je=250;break;case 5:Je=1073741823;break;case 4:Je=1e4;break;default:Je=5e3}return Je=ft+Je,Ge={id:k++,callback:St,priorityLevel:Ge,startTime:ft,expirationTime:Je,sortIndex:-1},ft>Ve?(Ge.sortIndex=ft,r(C,Ge),a(S)===null&&Ge===a(C)&&(j?(Z(Te),Te=-1):j=!0,sr(J,ft-Ve))):(Ge.sortIndex=Je,r(S,Ge),O||V||(O=!0,Ut(le))),Ge},t.unstable_shouldYield=Ne,t.unstable_wrapCallback=function(Ge){var St=L;return function(){var ft=L;L=St;try{return Ge.apply(this,arguments)}finally{L=ft}}}})(EC);wC.exports=EC;var fM=wC.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mM=wt,uo=fM;function pt(t){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+t,a=1;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+t+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var SC=new Set,wp={};function Ac(t,r){Ju(t,r),Ju(t+"Capture",r)}function Ju(t,r){for(wp[t]=r,t=0;t<r.length;t++)SC.add(r[t])}var ha=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nv=Object.prototype.hasOwnProperty,gM=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,B2={},L2={};function _M(t){return nv.call(L2,t)?!0:nv.call(B2,t)?!1:gM.test(t)?L2[t]=!0:(B2[t]=!0,!1)}function yM(t,r,a,c){if(a!==null&&a.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return c?!1:a!==null?!a.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function xM(t,r,a,c){if(r===null||typeof r>"u"||yM(t,r,a,c))return!0;if(c)return!1;if(a!==null)switch(a.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function zi(t,r,a,c,f,_,b){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=c,this.attributeNamespace=f,this.mustUseProperty=a,this.propertyName=t,this.type=r,this.sanitizeURL=_,this.removeEmptyString=b}var ai={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ai[t]=new zi(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var r=t[0];ai[r]=new zi(r,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ai[t]=new zi(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ai[t]=new zi(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ai[t]=new zi(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ai[t]=new zi(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ai[t]=new zi(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ai[t]=new zi(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ai[t]=new zi(t,5,!1,t.toLowerCase(),null,!1,!1)});var h1=/[\-:]([a-z])/g;function d1(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var r=t.replace(h1,d1);ai[r]=new zi(r,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var r=t.replace(h1,d1);ai[r]=new zi(r,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var r=t.replace(h1,d1);ai[r]=new zi(r,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ai[t]=new zi(t,1,!1,t.toLowerCase(),null,!1,!1)});ai.xlinkHref=new zi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ai[t]=new zi(t,1,!1,t.toLowerCase(),null,!0,!0)});function p1(t,r,a,c){var f=ai.hasOwnProperty(r)?ai[r]:null;(f!==null?f.type!==0:c||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(xM(r,a,f,c)&&(a=null),c||f===null?_M(r)&&(a===null?t.removeAttribute(r):t.setAttribute(r,""+a)):f.mustUseProperty?t[f.propertyName]=a===null?f.type===3?!1:"":a:(r=f.attributeName,c=f.attributeNamespace,a===null?t.removeAttribute(r):(f=f.type,a=f===3||f===4&&a===!0?"":""+a,c?t.setAttributeNS(c,r,a):t.setAttribute(r,a))))}var ma=mM.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Im=Symbol.for("react.element"),Pu=Symbol.for("react.portal"),zu=Symbol.for("react.fragment"),f1=Symbol.for("react.strict_mode"),iv=Symbol.for("react.profiler"),AC=Symbol.for("react.provider"),TC=Symbol.for("react.context"),m1=Symbol.for("react.forward_ref"),ov=Symbol.for("react.suspense"),sv=Symbol.for("react.suspense_list"),g1=Symbol.for("react.memo"),Ja=Symbol.for("react.lazy"),CC=Symbol.for("react.offscreen"),F2=Symbol.iterator;function Xd(t){return t===null||typeof t!="object"?null:(t=F2&&t[F2]||t["@@iterator"],typeof t=="function"?t:null)}var yn=Object.assign,zy;function ap(t){if(zy===void 0)try{throw Error()}catch(a){var r=a.stack.trim().match(/\n( *(at )?)/);zy=r&&r[1]||""}return`
`+zy+t}var Dy=!1;function My(t,r){if(!t||Dy)return"";Dy=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(C){var c=C}Reflect.construct(t,[],r)}else{try{r.call()}catch(C){c=C}t.call(r.prototype)}else{try{throw Error()}catch(C){c=C}t()}}catch(C){if(C&&c&&typeof C.stack=="string"){for(var f=C.stack.split(`
`),_=c.stack.split(`
`),b=f.length-1,s=_.length-1;1<=b&&0<=s&&f[b]!==_[s];)s--;for(;1<=b&&0<=s;b--,s--)if(f[b]!==_[s]){if(b!==1||s!==1)do if(b--,s--,0>s||f[b]!==_[s]){var S=`
`+f[b].replace(" at new "," at ");return t.displayName&&S.includes("<anonymous>")&&(S=S.replace("<anonymous>",t.displayName)),S}while(1<=b&&0<=s);break}}}finally{Dy=!1,Error.prepareStackTrace=a}return(t=t?t.displayName||t.name:"")?ap(t):""}function vM(t){switch(t.tag){case 5:return ap(t.type);case 16:return ap("Lazy");case 13:return ap("Suspense");case 19:return ap("SuspenseList");case 0:case 2:case 15:return t=My(t.type,!1),t;case 11:return t=My(t.type.render,!1),t;case 1:return t=My(t.type,!0),t;default:return""}}function av(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case zu:return"Fragment";case Pu:return"Portal";case iv:return"Profiler";case f1:return"StrictMode";case ov:return"Suspense";case sv:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case TC:return(t.displayName||"Context")+".Consumer";case AC:return(t._context.displayName||"Context")+".Provider";case m1:var r=t.render;return t=t.displayName,t||(t=r.displayName||r.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case g1:return r=t.displayName||null,r!==null?r:av(t.type)||"Memo";case Ja:r=t._payload,t=t._init;try{return av(t(r))}catch{}}return null}function bM(t){var r=t.type;switch(t.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=r.render,t=t.displayName||t.name||"",r.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return av(r);case 8:return r===f1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function dl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function IC(t){var r=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function wM(t){var r=IC(t)?"checked":"value",a=Object.getOwnPropertyDescriptor(t.constructor.prototype,r),c=""+t[r];if(!t.hasOwnProperty(r)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var f=a.get,_=a.set;return Object.defineProperty(t,r,{configurable:!0,get:function(){return f.call(this)},set:function(b){c=""+b,_.call(this,b)}}),Object.defineProperty(t,r,{enumerable:a.enumerable}),{getValue:function(){return c},setValue:function(b){c=""+b},stopTracking:function(){t._valueTracker=null,delete t[r]}}}}function km(t){t._valueTracker||(t._valueTracker=wM(t))}function kC(t){if(!t)return!1;var r=t._valueTracker;if(!r)return!0;var a=r.getValue(),c="";return t&&(c=IC(t)?t.checked?"true":"false":t.value),t=c,t!==a?(r.setValue(t),!0):!1}function z0(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function lv(t,r){var a=r.checked;return yn({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??t._wrapperState.initialChecked})}function O2(t,r){var a=r.defaultValue==null?"":r.defaultValue,c=r.checked!=null?r.checked:r.defaultChecked;a=dl(r.value!=null?r.value:a),t._wrapperState={initialChecked:c,initialValue:a,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function PC(t,r){r=r.checked,r!=null&&p1(t,"checked",r,!1)}function cv(t,r){PC(t,r);var a=dl(r.value),c=r.type;if(a!=null)c==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+a):t.value!==""+a&&(t.value=""+a);else if(c==="submit"||c==="reset"){t.removeAttribute("value");return}r.hasOwnProperty("value")?uv(t,r.type,a):r.hasOwnProperty("defaultValue")&&uv(t,r.type,dl(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(t.defaultChecked=!!r.defaultChecked)}function N2(t,r,a){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var c=r.type;if(!(c!=="submit"&&c!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+t._wrapperState.initialValue,a||r===t.value||(t.value=r),t.defaultValue=r}a=t.name,a!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,a!==""&&(t.name=a)}function uv(t,r,a){(r!=="number"||z0(t.ownerDocument)!==t)&&(a==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+a&&(t.defaultValue=""+a))}var lp=Array.isArray;function Wu(t,r,a,c){if(t=t.options,r){r={};for(var f=0;f<a.length;f++)r["$"+a[f]]=!0;for(a=0;a<t.length;a++)f=r.hasOwnProperty("$"+t[a].value),t[a].selected!==f&&(t[a].selected=f),f&&c&&(t[a].defaultSelected=!0)}else{for(a=""+dl(a),r=null,f=0;f<t.length;f++){if(t[f].value===a){t[f].selected=!0,c&&(t[f].defaultSelected=!0);return}r!==null||t[f].disabled||(r=t[f])}r!==null&&(r.selected=!0)}}function hv(t,r){if(r.dangerouslySetInnerHTML!=null)throw Error(pt(91));return yn({},r,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function U2(t,r){var a=r.value;if(a==null){if(a=r.children,r=r.defaultValue,a!=null){if(r!=null)throw Error(pt(92));if(lp(a)){if(1<a.length)throw Error(pt(93));a=a[0]}r=a}r==null&&(r=""),a=r}t._wrapperState={initialValue:dl(a)}}function zC(t,r){var a=dl(r.value),c=dl(r.defaultValue);a!=null&&(a=""+a,a!==t.value&&(t.value=a),r.defaultValue==null&&t.defaultValue!==a&&(t.defaultValue=a)),c!=null&&(t.defaultValue=""+c)}function V2(t){var r=t.textContent;r===t._wrapperState.initialValue&&r!==""&&r!==null&&(t.value=r)}function DC(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dv(t,r){return t==null||t==="http://www.w3.org/1999/xhtml"?DC(r):t==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Pm,MC=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,a,c,f){MSApp.execUnsafeLocalFunction(function(){return t(r,a,c,f)})}:t}(function(t,r){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=r;else{for(Pm=Pm||document.createElement("div"),Pm.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=Pm.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;r.firstChild;)t.appendChild(r.firstChild)}});function Ep(t,r){if(r){var a=t.firstChild;if(a&&a===t.lastChild&&a.nodeType===3){a.nodeValue=r;return}}t.textContent=r}var dp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},EM=["Webkit","ms","Moz","O"];Object.keys(dp).forEach(function(t){EM.forEach(function(r){r=r+t.charAt(0).toUpperCase()+t.substring(1),dp[r]=dp[t]})});function RC(t,r,a){return r==null||typeof r=="boolean"||r===""?"":a||typeof r!="number"||r===0||dp.hasOwnProperty(t)&&dp[t]?(""+r).trim():r+"px"}function BC(t,r){t=t.style;for(var a in r)if(r.hasOwnProperty(a)){var c=a.indexOf("--")===0,f=RC(a,r[a],c);a==="float"&&(a="cssFloat"),c?t.setProperty(a,f):t[a]=f}}var SM=yn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pv(t,r){if(r){if(SM[t]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(pt(137,t));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(pt(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(pt(61))}if(r.style!=null&&typeof r.style!="object")throw Error(pt(62))}}function fv(t,r){if(t.indexOf("-")===-1)return typeof r.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mv=null;function _1(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var gv=null,qu=null,Gu=null;function j2(t){if(t=Hp(t)){if(typeof gv!="function")throw Error(pt(280));var r=t.stateNode;r&&(r=_g(r),gv(t.stateNode,t.type,r))}}function LC(t){qu?Gu?Gu.push(t):Gu=[t]:qu=t}function FC(){if(qu){var t=qu,r=Gu;if(Gu=qu=null,j2(t),r)for(t=0;t<r.length;t++)j2(r[t])}}function OC(t,r){return t(r)}function NC(){}var Ry=!1;function UC(t,r,a){if(Ry)return t(r,a);Ry=!0;try{return OC(t,r,a)}finally{Ry=!1,(qu!==null||Gu!==null)&&(NC(),FC())}}function Sp(t,r){var a=t.stateNode;if(a===null)return null;var c=_g(a);if(c===null)return null;a=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(t=t.type,c=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!c;break e;default:t=!1}if(t)return null;if(a&&typeof a!="function")throw Error(pt(231,r,typeof a));return a}var _v=!1;if(ha)try{var Kd={};Object.defineProperty(Kd,"passive",{get:function(){_v=!0}}),window.addEventListener("test",Kd,Kd),window.removeEventListener("test",Kd,Kd)}catch{_v=!1}function AM(t,r,a,c,f,_,b,s,S){var C=Array.prototype.slice.call(arguments,3);try{r.apply(a,C)}catch(k){this.onError(k)}}var pp=!1,D0=null,M0=!1,yv=null,TM={onError:function(t){pp=!0,D0=t}};function CM(t,r,a,c,f,_,b,s,S){pp=!1,D0=null,AM.apply(TM,arguments)}function IM(t,r,a,c,f,_,b,s,S){if(CM.apply(this,arguments),pp){if(pp){var C=D0;pp=!1,D0=null}else throw Error(pt(198));M0||(M0=!0,yv=C)}}function Tc(t){var r=t,a=t;if(t.alternate)for(;r.return;)r=r.return;else{t=r;do r=t,r.flags&4098&&(a=r.return),t=r.return;while(t)}return r.tag===3?a:null}function VC(t){if(t.tag===13){var r=t.memoizedState;if(r===null&&(t=t.alternate,t!==null&&(r=t.memoizedState)),r!==null)return r.dehydrated}return null}function $2(t){if(Tc(t)!==t)throw Error(pt(188))}function kM(t){var r=t.alternate;if(!r){if(r=Tc(t),r===null)throw Error(pt(188));return r!==t?null:t}for(var a=t,c=r;;){var f=a.return;if(f===null)break;var _=f.alternate;if(_===null){if(c=f.return,c!==null){a=c;continue}break}if(f.child===_.child){for(_=f.child;_;){if(_===a)return $2(f),t;if(_===c)return $2(f),r;_=_.sibling}throw Error(pt(188))}if(a.return!==c.return)a=f,c=_;else{for(var b=!1,s=f.child;s;){if(s===a){b=!0,a=f,c=_;break}if(s===c){b=!0,c=f,a=_;break}s=s.sibling}if(!b){for(s=_.child;s;){if(s===a){b=!0,a=_,c=f;break}if(s===c){b=!0,c=_,a=f;break}s=s.sibling}if(!b)throw Error(pt(189))}}if(a.alternate!==c)throw Error(pt(190))}if(a.tag!==3)throw Error(pt(188));return a.stateNode.current===a?t:r}function jC(t){return t=kM(t),t!==null?$C(t):null}function $C(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var r=$C(t);if(r!==null)return r;t=t.sibling}return null}var WC=uo.unstable_scheduleCallback,W2=uo.unstable_cancelCallback,PM=uo.unstable_shouldYield,zM=uo.unstable_requestPaint,Sn=uo.unstable_now,DM=uo.unstable_getCurrentPriorityLevel,y1=uo.unstable_ImmediatePriority,qC=uo.unstable_UserBlockingPriority,R0=uo.unstable_NormalPriority,MM=uo.unstable_LowPriority,GC=uo.unstable_IdlePriority,pg=null,Rs=null;function RM(t){if(Rs&&typeof Rs.onCommitFiberRoot=="function")try{Rs.onCommitFiberRoot(pg,t,void 0,(t.current.flags&128)===128)}catch{}}var ls=Math.clz32?Math.clz32:FM,BM=Math.log,LM=Math.LN2;function FM(t){return t>>>=0,t===0?32:31-(BM(t)/LM|0)|0}var zm=64,Dm=4194304;function cp(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function B0(t,r){var a=t.pendingLanes;if(a===0)return 0;var c=0,f=t.suspendedLanes,_=t.pingedLanes,b=a&268435455;if(b!==0){var s=b&~f;s!==0?c=cp(s):(_&=b,_!==0&&(c=cp(_)))}else b=a&~f,b!==0?c=cp(b):_!==0&&(c=cp(_));if(c===0)return 0;if(r!==0&&r!==c&&!(r&f)&&(f=c&-c,_=r&-r,f>=_||f===16&&(_&4194240)!==0))return r;if(c&4&&(c|=a&16),r=t.entangledLanes,r!==0)for(t=t.entanglements,r&=c;0<r;)a=31-ls(r),f=1<<a,c|=t[a],r&=~f;return c}function OM(t,r){switch(t){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function NM(t,r){for(var a=t.suspendedLanes,c=t.pingedLanes,f=t.expirationTimes,_=t.pendingLanes;0<_;){var b=31-ls(_),s=1<<b,S=f[b];S===-1?(!(s&a)||s&c)&&(f[b]=OM(s,r)):S<=r&&(t.expiredLanes|=s),_&=~s}}function xv(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function HC(){var t=zm;return zm<<=1,!(zm&4194240)&&(zm=64),t}function By(t){for(var r=[],a=0;31>a;a++)r.push(t);return r}function qp(t,r,a){t.pendingLanes|=r,r!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,r=31-ls(r),t[r]=a}function UM(t,r){var a=t.pendingLanes&~r;t.pendingLanes=r,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=r,t.mutableReadLanes&=r,t.entangledLanes&=r,r=t.entanglements;var c=t.eventTimes;for(t=t.expirationTimes;0<a;){var f=31-ls(a),_=1<<f;r[f]=0,c[f]=-1,t[f]=-1,a&=~_}}function x1(t,r){var a=t.entangledLanes|=r;for(t=t.entanglements;a;){var c=31-ls(a),f=1<<c;f&r|t[c]&r&&(t[c]|=r),a&=~f}}var Fr=0;function ZC(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var XC,v1,KC,YC,JC,vv=!1,Mm=[],il=null,ol=null,sl=null,Ap=new Map,Tp=new Map,el=[],VM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function q2(t,r){switch(t){case"focusin":case"focusout":il=null;break;case"dragenter":case"dragleave":ol=null;break;case"mouseover":case"mouseout":sl=null;break;case"pointerover":case"pointerout":Ap.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tp.delete(r.pointerId)}}function Yd(t,r,a,c,f,_){return t===null||t.nativeEvent!==_?(t={blockedOn:r,domEventName:a,eventSystemFlags:c,nativeEvent:_,targetContainers:[f]},r!==null&&(r=Hp(r),r!==null&&v1(r)),t):(t.eventSystemFlags|=c,r=t.targetContainers,f!==null&&r.indexOf(f)===-1&&r.push(f),t)}function jM(t,r,a,c,f){switch(r){case"focusin":return il=Yd(il,t,r,a,c,f),!0;case"dragenter":return ol=Yd(ol,t,r,a,c,f),!0;case"mouseover":return sl=Yd(sl,t,r,a,c,f),!0;case"pointerover":var _=f.pointerId;return Ap.set(_,Yd(Ap.get(_)||null,t,r,a,c,f)),!0;case"gotpointercapture":return _=f.pointerId,Tp.set(_,Yd(Tp.get(_)||null,t,r,a,c,f)),!0}return!1}function QC(t){var r=dc(t.target);if(r!==null){var a=Tc(r);if(a!==null){if(r=a.tag,r===13){if(r=VC(a),r!==null){t.blockedOn=r,JC(t.priority,function(){KC(a)});return}}else if(r===3&&a.stateNode.current.memoizedState.isDehydrated){t.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}t.blockedOn=null}function p0(t){if(t.blockedOn!==null)return!1;for(var r=t.targetContainers;0<r.length;){var a=bv(t.domEventName,t.eventSystemFlags,r[0],t.nativeEvent);if(a===null){a=t.nativeEvent;var c=new a.constructor(a.type,a);mv=c,a.target.dispatchEvent(c),mv=null}else return r=Hp(a),r!==null&&v1(r),t.blockedOn=a,!1;r.shift()}return!0}function G2(t,r,a){p0(t)&&a.delete(r)}function $M(){vv=!1,il!==null&&p0(il)&&(il=null),ol!==null&&p0(ol)&&(ol=null),sl!==null&&p0(sl)&&(sl=null),Ap.forEach(G2),Tp.forEach(G2)}function Jd(t,r){t.blockedOn===r&&(t.blockedOn=null,vv||(vv=!0,uo.unstable_scheduleCallback(uo.unstable_NormalPriority,$M)))}function Cp(t){function r(f){return Jd(f,t)}if(0<Mm.length){Jd(Mm[0],t);for(var a=1;a<Mm.length;a++){var c=Mm[a];c.blockedOn===t&&(c.blockedOn=null)}}for(il!==null&&Jd(il,t),ol!==null&&Jd(ol,t),sl!==null&&Jd(sl,t),Ap.forEach(r),Tp.forEach(r),a=0;a<el.length;a++)c=el[a],c.blockedOn===t&&(c.blockedOn=null);for(;0<el.length&&(a=el[0],a.blockedOn===null);)QC(a),a.blockedOn===null&&el.shift()}var Hu=ma.ReactCurrentBatchConfig,L0=!0;function WM(t,r,a,c){var f=Fr,_=Hu.transition;Hu.transition=null;try{Fr=1,b1(t,r,a,c)}finally{Fr=f,Hu.transition=_}}function qM(t,r,a,c){var f=Fr,_=Hu.transition;Hu.transition=null;try{Fr=4,b1(t,r,a,c)}finally{Fr=f,Hu.transition=_}}function b1(t,r,a,c){if(L0){var f=bv(t,r,a,c);if(f===null)qy(t,r,c,F0,a),q2(t,c);else if(jM(f,t,r,a,c))c.stopPropagation();else if(q2(t,c),r&4&&-1<VM.indexOf(t)){for(;f!==null;){var _=Hp(f);if(_!==null&&XC(_),_=bv(t,r,a,c),_===null&&qy(t,r,c,F0,a),_===f)break;f=_}f!==null&&c.stopPropagation()}else qy(t,r,c,null,a)}}var F0=null;function bv(t,r,a,c){if(F0=null,t=_1(c),t=dc(t),t!==null)if(r=Tc(t),r===null)t=null;else if(a=r.tag,a===13){if(t=VC(r),t!==null)return t;t=null}else if(a===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;t=null}else r!==t&&(t=null);return F0=t,null}function eI(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(DM()){case y1:return 1;case qC:return 4;case R0:case MM:return 16;case GC:return 536870912;default:return 16}default:return 16}}var rl=null,w1=null,f0=null;function tI(){if(f0)return f0;var t,r=w1,a=r.length,c,f="value"in rl?rl.value:rl.textContent,_=f.length;for(t=0;t<a&&r[t]===f[t];t++);var b=a-t;for(c=1;c<=b&&r[a-c]===f[_-c];c++);return f0=f.slice(t,1<c?1-c:void 0)}function m0(t){var r=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&r===13&&(t=13)):t=r,t===10&&(t=13),32<=t||t===13?t:0}function Rm(){return!0}function H2(){return!1}function fo(t){function r(a,c,f,_,b){this._reactName=a,this._targetInst=f,this.type=c,this.nativeEvent=_,this.target=b,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(a=t[s],this[s]=a?a(_):_[s]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?Rm:H2,this.isPropagationStopped=H2,this}return yn(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Rm)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Rm)},persist:function(){},isPersistent:Rm}),r}var lh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},E1=fo(lh),Gp=yn({},lh,{view:0,detail:0}),GM=fo(Gp),Ly,Fy,Qd,fg=yn({},Gp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:S1,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Qd&&(Qd&&t.type==="mousemove"?(Ly=t.screenX-Qd.screenX,Fy=t.screenY-Qd.screenY):Fy=Ly=0,Qd=t),Ly)},movementY:function(t){return"movementY"in t?t.movementY:Fy}}),Z2=fo(fg),HM=yn({},fg,{dataTransfer:0}),ZM=fo(HM),XM=yn({},Gp,{relatedTarget:0}),Oy=fo(XM),KM=yn({},lh,{animationName:0,elapsedTime:0,pseudoElement:0}),YM=fo(KM),JM=yn({},lh,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),QM=fo(JM),e3=yn({},lh,{data:0}),X2=fo(e3),t3={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},r3={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},n3={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function i3(t){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(t):(t=n3[t])?!!r[t]:!1}function S1(){return i3}var o3=yn({},Gp,{key:function(t){if(t.key){var r=t3[t.key]||t.key;if(r!=="Unidentified")return r}return t.type==="keypress"?(t=m0(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?r3[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:S1,charCode:function(t){return t.type==="keypress"?m0(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?m0(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),s3=fo(o3),a3=yn({},fg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),K2=fo(a3),l3=yn({},Gp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:S1}),c3=fo(l3),u3=yn({},lh,{propertyName:0,elapsedTime:0,pseudoElement:0}),h3=fo(u3),d3=yn({},fg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),p3=fo(d3),f3=[9,13,27,32],A1=ha&&"CompositionEvent"in window,fp=null;ha&&"documentMode"in document&&(fp=document.documentMode);var m3=ha&&"TextEvent"in window&&!fp,rI=ha&&(!A1||fp&&8<fp&&11>=fp),Y2=String.fromCharCode(32),J2=!1;function nI(t,r){switch(t){case"keyup":return f3.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function iI(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Du=!1;function g3(t,r){switch(t){case"compositionend":return iI(r);case"keypress":return r.which!==32?null:(J2=!0,Y2);case"textInput":return t=r.data,t===Y2&&J2?null:t;default:return null}}function _3(t,r){if(Du)return t==="compositionend"||!A1&&nI(t,r)?(t=tI(),f0=w1=rl=null,Du=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return rI&&r.locale!=="ko"?null:r.data;default:return null}}var y3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Q2(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r==="input"?!!y3[t.type]:r==="textarea"}function oI(t,r,a,c){LC(c),r=O0(r,"onChange"),0<r.length&&(a=new E1("onChange","change",null,a,c),t.push({event:a,listeners:r}))}var mp=null,Ip=null;function x3(t){gI(t,0)}function mg(t){var r=Bu(t);if(kC(r))return t}function v3(t,r){if(t==="change")return r}var sI=!1;if(ha){var Ny;if(ha){var Uy="oninput"in document;if(!Uy){var eS=document.createElement("div");eS.setAttribute("oninput","return;"),Uy=typeof eS.oninput=="function"}Ny=Uy}else Ny=!1;sI=Ny&&(!document.documentMode||9<document.documentMode)}function tS(){mp&&(mp.detachEvent("onpropertychange",aI),Ip=mp=null)}function aI(t){if(t.propertyName==="value"&&mg(Ip)){var r=[];oI(r,Ip,t,_1(t)),UC(x3,r)}}function b3(t,r,a){t==="focusin"?(tS(),mp=r,Ip=a,mp.attachEvent("onpropertychange",aI)):t==="focusout"&&tS()}function w3(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return mg(Ip)}function E3(t,r){if(t==="click")return mg(r)}function S3(t,r){if(t==="input"||t==="change")return mg(r)}function A3(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var ds=typeof Object.is=="function"?Object.is:A3;function kp(t,r){if(ds(t,r))return!0;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return!1;var a=Object.keys(t),c=Object.keys(r);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var f=a[c];if(!nv.call(r,f)||!ds(t[f],r[f]))return!1}return!0}function rS(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function nS(t,r){var a=rS(t);t=0;for(var c;a;){if(a.nodeType===3){if(c=t+a.textContent.length,t<=r&&c>=r)return{node:a,offset:r-t};t=c}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=rS(a)}}function lI(t,r){return t&&r?t===r?!0:t&&t.nodeType===3?!1:r&&r.nodeType===3?lI(t,r.parentNode):"contains"in t?t.contains(r):t.compareDocumentPosition?!!(t.compareDocumentPosition(r)&16):!1:!1}function cI(){for(var t=window,r=z0();r instanceof t.HTMLIFrameElement;){try{var a=typeof r.contentWindow.location.href=="string"}catch{a=!1}if(a)t=r.contentWindow;else break;r=z0(t.document)}return r}function T1(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r&&(r==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||r==="textarea"||t.contentEditable==="true")}function T3(t){var r=cI(),a=t.focusedElem,c=t.selectionRange;if(r!==a&&a&&a.ownerDocument&&lI(a.ownerDocument.documentElement,a)){if(c!==null&&T1(a)){if(r=c.start,t=c.end,t===void 0&&(t=r),"selectionStart"in a)a.selectionStart=r,a.selectionEnd=Math.min(t,a.value.length);else if(t=(r=a.ownerDocument||document)&&r.defaultView||window,t.getSelection){t=t.getSelection();var f=a.textContent.length,_=Math.min(c.start,f);c=c.end===void 0?_:Math.min(c.end,f),!t.extend&&_>c&&(f=c,c=_,_=f),f=nS(a,_);var b=nS(a,c);f&&b&&(t.rangeCount!==1||t.anchorNode!==f.node||t.anchorOffset!==f.offset||t.focusNode!==b.node||t.focusOffset!==b.offset)&&(r=r.createRange(),r.setStart(f.node,f.offset),t.removeAllRanges(),_>c?(t.addRange(r),t.extend(b.node,b.offset)):(r.setEnd(b.node,b.offset),t.addRange(r)))}}for(r=[],t=a;t=t.parentNode;)t.nodeType===1&&r.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<r.length;a++)t=r[a],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var C3=ha&&"documentMode"in document&&11>=document.documentMode,Mu=null,wv=null,gp=null,Ev=!1;function iS(t,r,a){var c=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Ev||Mu==null||Mu!==z0(c)||(c=Mu,"selectionStart"in c&&T1(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),gp&&kp(gp,c)||(gp=c,c=O0(wv,"onSelect"),0<c.length&&(r=new E1("onSelect","select",null,r,a),t.push({event:r,listeners:c}),r.target=Mu)))}function Bm(t,r){var a={};return a[t.toLowerCase()]=r.toLowerCase(),a["Webkit"+t]="webkit"+r,a["Moz"+t]="moz"+r,a}var Ru={animationend:Bm("Animation","AnimationEnd"),animationiteration:Bm("Animation","AnimationIteration"),animationstart:Bm("Animation","AnimationStart"),transitionend:Bm("Transition","TransitionEnd")},Vy={},uI={};ha&&(uI=document.createElement("div").style,"AnimationEvent"in window||(delete Ru.animationend.animation,delete Ru.animationiteration.animation,delete Ru.animationstart.animation),"TransitionEvent"in window||delete Ru.transitionend.transition);function gg(t){if(Vy[t])return Vy[t];if(!Ru[t])return t;var r=Ru[t],a;for(a in r)if(r.hasOwnProperty(a)&&a in uI)return Vy[t]=r[a];return t}var hI=gg("animationend"),dI=gg("animationiteration"),pI=gg("animationstart"),fI=gg("transitionend"),mI=new Map,oS="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function gl(t,r){mI.set(t,r),Ac(r,[t])}for(var jy=0;jy<oS.length;jy++){var $y=oS[jy],I3=$y.toLowerCase(),k3=$y[0].toUpperCase()+$y.slice(1);gl(I3,"on"+k3)}gl(hI,"onAnimationEnd");gl(dI,"onAnimationIteration");gl(pI,"onAnimationStart");gl("dblclick","onDoubleClick");gl("focusin","onFocus");gl("focusout","onBlur");gl(fI,"onTransitionEnd");Ju("onMouseEnter",["mouseout","mouseover"]);Ju("onMouseLeave",["mouseout","mouseover"]);Ju("onPointerEnter",["pointerout","pointerover"]);Ju("onPointerLeave",["pointerout","pointerover"]);Ac("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ac("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ac("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ac("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ac("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ac("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var up="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),P3=new Set("cancel close invalid load scroll toggle".split(" ").concat(up));function sS(t,r,a){var c=t.type||"unknown-event";t.currentTarget=a,IM(c,r,void 0,t),t.currentTarget=null}function gI(t,r){r=(r&4)!==0;for(var a=0;a<t.length;a++){var c=t[a],f=c.event;c=c.listeners;e:{var _=void 0;if(r)for(var b=c.length-1;0<=b;b--){var s=c[b],S=s.instance,C=s.currentTarget;if(s=s.listener,S!==_&&f.isPropagationStopped())break e;sS(f,s,C),_=S}else for(b=0;b<c.length;b++){if(s=c[b],S=s.instance,C=s.currentTarget,s=s.listener,S!==_&&f.isPropagationStopped())break e;sS(f,s,C),_=S}}}if(M0)throw t=yv,M0=!1,yv=null,t}function Qr(t,r){var a=r[Iv];a===void 0&&(a=r[Iv]=new Set);var c=t+"__bubble";a.has(c)||(_I(r,t,2,!1),a.add(c))}function Wy(t,r,a){var c=0;r&&(c|=4),_I(a,t,c,r)}var Lm="_reactListening"+Math.random().toString(36).slice(2);function Pp(t){if(!t[Lm]){t[Lm]=!0,SC.forEach(function(a){a!=="selectionchange"&&(P3.has(a)||Wy(a,!1,t),Wy(a,!0,t))});var r=t.nodeType===9?t:t.ownerDocument;r===null||r[Lm]||(r[Lm]=!0,Wy("selectionchange",!1,r))}}function _I(t,r,a,c){switch(eI(r)){case 1:var f=WM;break;case 4:f=qM;break;default:f=b1}a=f.bind(null,r,a,t),f=void 0,!_v||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(f=!0),c?f!==void 0?t.addEventListener(r,a,{capture:!0,passive:f}):t.addEventListener(r,a,!0):f!==void 0?t.addEventListener(r,a,{passive:f}):t.addEventListener(r,a,!1)}function qy(t,r,a,c,f){var _=c;if(!(r&1)&&!(r&2)&&c!==null)e:for(;;){if(c===null)return;var b=c.tag;if(b===3||b===4){var s=c.stateNode.containerInfo;if(s===f||s.nodeType===8&&s.parentNode===f)break;if(b===4)for(b=c.return;b!==null;){var S=b.tag;if((S===3||S===4)&&(S=b.stateNode.containerInfo,S===f||S.nodeType===8&&S.parentNode===f))return;b=b.return}for(;s!==null;){if(b=dc(s),b===null)return;if(S=b.tag,S===5||S===6){c=_=b;continue e}s=s.parentNode}}c=c.return}UC(function(){var C=_,k=_1(a),M=[];e:{var L=mI.get(t);if(L!==void 0){var V=E1,O=t;switch(t){case"keypress":if(m0(a)===0)break e;case"keydown":case"keyup":V=s3;break;case"focusin":O="focus",V=Oy;break;case"focusout":O="blur",V=Oy;break;case"beforeblur":case"afterblur":V=Oy;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":V=Z2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":V=ZM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":V=c3;break;case hI:case dI:case pI:V=YM;break;case fI:V=h3;break;case"scroll":V=GM;break;case"wheel":V=p3;break;case"copy":case"cut":case"paste":V=QM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":V=K2}var j=(r&4)!==0,H=!j&&t==="scroll",Z=j?L!==null?L+"Capture":null:L;j=[];for(var U=C,$;U!==null;){$=U;var J=$.stateNode;if($.tag===5&&J!==null&&($=J,Z!==null&&(J=Sp(U,Z),J!=null&&j.push(zp(U,J,$)))),H)break;U=U.return}0<j.length&&(L=new V(L,O,null,a,k),M.push({event:L,listeners:j}))}}if(!(r&7)){e:{if(L=t==="mouseover"||t==="pointerover",V=t==="mouseout"||t==="pointerout",L&&a!==mv&&(O=a.relatedTarget||a.fromElement)&&(dc(O)||O[da]))break e;if((V||L)&&(L=k.window===k?k:(L=k.ownerDocument)?L.defaultView||L.parentWindow:window,V?(O=a.relatedTarget||a.toElement,V=C,O=O?dc(O):null,O!==null&&(H=Tc(O),O!==H||O.tag!==5&&O.tag!==6)&&(O=null)):(V=null,O=C),V!==O)){if(j=Z2,J="onMouseLeave",Z="onMouseEnter",U="mouse",(t==="pointerout"||t==="pointerover")&&(j=K2,J="onPointerLeave",Z="onPointerEnter",U="pointer"),H=V==null?L:Bu(V),$=O==null?L:Bu(O),L=new j(J,U+"leave",V,a,k),L.target=H,L.relatedTarget=$,J=null,dc(k)===C&&(j=new j(Z,U+"enter",O,a,k),j.target=$,j.relatedTarget=H,J=j),H=J,V&&O)t:{for(j=V,Z=O,U=0,$=j;$;$=Iu($))U++;for($=0,J=Z;J;J=Iu(J))$++;for(;0<U-$;)j=Iu(j),U--;for(;0<$-U;)Z=Iu(Z),$--;for(;U--;){if(j===Z||Z!==null&&j===Z.alternate)break t;j=Iu(j),Z=Iu(Z)}j=null}else j=null;V!==null&&aS(M,L,V,j,!1),O!==null&&H!==null&&aS(M,H,O,j,!0)}}e:{if(L=C?Bu(C):window,V=L.nodeName&&L.nodeName.toLowerCase(),V==="select"||V==="input"&&L.type==="file")var le=v3;else if(Q2(L))if(sI)le=S3;else{le=w3;var pe=b3}else(V=L.nodeName)&&V.toLowerCase()==="input"&&(L.type==="checkbox"||L.type==="radio")&&(le=E3);if(le&&(le=le(t,C))){oI(M,le,a,k);break e}pe&&pe(t,L,C),t==="focusout"&&(pe=L._wrapperState)&&pe.controlled&&L.type==="number"&&uv(L,"number",L.value)}switch(pe=C?Bu(C):window,t){case"focusin":(Q2(pe)||pe.contentEditable==="true")&&(Mu=pe,wv=C,gp=null);break;case"focusout":gp=wv=Mu=null;break;case"mousedown":Ev=!0;break;case"contextmenu":case"mouseup":case"dragend":Ev=!1,iS(M,a,k);break;case"selectionchange":if(C3)break;case"keydown":case"keyup":iS(M,a,k)}var ye;if(A1)e:{switch(t){case"compositionstart":var Te="onCompositionStart";break e;case"compositionend":Te="onCompositionEnd";break e;case"compositionupdate":Te="onCompositionUpdate";break e}Te=void 0}else Du?nI(t,a)&&(Te="onCompositionEnd"):t==="keydown"&&a.keyCode===229&&(Te="onCompositionStart");Te&&(rI&&a.locale!=="ko"&&(Du||Te!=="onCompositionStart"?Te==="onCompositionEnd"&&Du&&(ye=tI()):(rl=k,w1="value"in rl?rl.value:rl.textContent,Du=!0)),pe=O0(C,Te),0<pe.length&&(Te=new X2(Te,t,null,a,k),M.push({event:Te,listeners:pe}),ye?Te.data=ye:(ye=iI(a),ye!==null&&(Te.data=ye)))),(ye=m3?g3(t,a):_3(t,a))&&(C=O0(C,"onBeforeInput"),0<C.length&&(k=new X2("onBeforeInput","beforeinput",null,a,k),M.push({event:k,listeners:C}),k.data=ye))}gI(M,r)})}function zp(t,r,a){return{instance:t,listener:r,currentTarget:a}}function O0(t,r){for(var a=r+"Capture",c=[];t!==null;){var f=t,_=f.stateNode;f.tag===5&&_!==null&&(f=_,_=Sp(t,a),_!=null&&c.unshift(zp(t,_,f)),_=Sp(t,r),_!=null&&c.push(zp(t,_,f))),t=t.return}return c}function Iu(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function aS(t,r,a,c,f){for(var _=r._reactName,b=[];a!==null&&a!==c;){var s=a,S=s.alternate,C=s.stateNode;if(S!==null&&S===c)break;s.tag===5&&C!==null&&(s=C,f?(S=Sp(a,_),S!=null&&b.unshift(zp(a,S,s))):f||(S=Sp(a,_),S!=null&&b.push(zp(a,S,s)))),a=a.return}b.length!==0&&t.push({event:r,listeners:b})}var z3=/\r\n?/g,D3=/\u0000|\uFFFD/g;function lS(t){return(typeof t=="string"?t:""+t).replace(z3,`
`).replace(D3,"")}function Fm(t,r,a){if(r=lS(r),lS(t)!==r&&a)throw Error(pt(425))}function N0(){}var Sv=null,Av=null;function Tv(t,r){return t==="textarea"||t==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Cv=typeof setTimeout=="function"?setTimeout:void 0,M3=typeof clearTimeout=="function"?clearTimeout:void 0,cS=typeof Promise=="function"?Promise:void 0,R3=typeof queueMicrotask=="function"?queueMicrotask:typeof cS<"u"?function(t){return cS.resolve(null).then(t).catch(B3)}:Cv;function B3(t){setTimeout(function(){throw t})}function Gy(t,r){var a=r,c=0;do{var f=a.nextSibling;if(t.removeChild(a),f&&f.nodeType===8)if(a=f.data,a==="/$"){if(c===0){t.removeChild(f),Cp(r);return}c--}else a!=="$"&&a!=="$?"&&a!=="$!"||c++;a=f}while(a);Cp(r)}function al(t){for(;t!=null;t=t.nextSibling){var r=t.nodeType;if(r===1||r===3)break;if(r===8){if(r=t.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return t}function uS(t){t=t.previousSibling;for(var r=0;t;){if(t.nodeType===8){var a=t.data;if(a==="$"||a==="$!"||a==="$?"){if(r===0)return t;r--}else a==="/$"&&r++}t=t.previousSibling}return null}var ch=Math.random().toString(36).slice(2),Ms="__reactFiber$"+ch,Dp="__reactProps$"+ch,da="__reactContainer$"+ch,Iv="__reactEvents$"+ch,L3="__reactListeners$"+ch,F3="__reactHandles$"+ch;function dc(t){var r=t[Ms];if(r)return r;for(var a=t.parentNode;a;){if(r=a[da]||a[Ms]){if(a=r.alternate,r.child!==null||a!==null&&a.child!==null)for(t=uS(t);t!==null;){if(a=t[Ms])return a;t=uS(t)}return r}t=a,a=t.parentNode}return null}function Hp(t){return t=t[Ms]||t[da],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Bu(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(pt(33))}function _g(t){return t[Dp]||null}var kv=[],Lu=-1;function _l(t){return{current:t}}function en(t){0>Lu||(t.current=kv[Lu],kv[Lu]=null,Lu--)}function Zr(t,r){Lu++,kv[Lu]=t.current,t.current=r}var pl={},wi=_l(pl),Wi=_l(!1),yc=pl;function Qu(t,r){var a=t.type.contextTypes;if(!a)return pl;var c=t.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===r)return c.__reactInternalMemoizedMaskedChildContext;var f={},_;for(_ in a)f[_]=r[_];return c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=f),f}function qi(t){return t=t.childContextTypes,t!=null}function U0(){en(Wi),en(wi)}function hS(t,r,a){if(wi.current!==pl)throw Error(pt(168));Zr(wi,r),Zr(Wi,a)}function yI(t,r,a){var c=t.stateNode;if(r=r.childContextTypes,typeof c.getChildContext!="function")return a;c=c.getChildContext();for(var f in c)if(!(f in r))throw Error(pt(108,bM(t)||"Unknown",f));return yn({},a,c)}function V0(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||pl,yc=wi.current,Zr(wi,t),Zr(Wi,Wi.current),!0}function dS(t,r,a){var c=t.stateNode;if(!c)throw Error(pt(169));a?(t=yI(t,r,yc),c.__reactInternalMemoizedMergedChildContext=t,en(Wi),en(wi),Zr(wi,t)):en(Wi),Zr(Wi,a)}var oa=null,yg=!1,Hy=!1;function xI(t){oa===null?oa=[t]:oa.push(t)}function O3(t){yg=!0,xI(t)}function yl(){if(!Hy&&oa!==null){Hy=!0;var t=0,r=Fr;try{var a=oa;for(Fr=1;t<a.length;t++){var c=a[t];do c=c(!0);while(c!==null)}oa=null,yg=!1}catch(f){throw oa!==null&&(oa=oa.slice(t+1)),WC(y1,yl),f}finally{Fr=r,Hy=!1}}return null}var Fu=[],Ou=0,j0=null,$0=0,ko=[],Po=0,xc=null,la=1,ca="";function cc(t,r){Fu[Ou++]=$0,Fu[Ou++]=j0,j0=t,$0=r}function vI(t,r,a){ko[Po++]=la,ko[Po++]=ca,ko[Po++]=xc,xc=t;var c=la;t=ca;var f=32-ls(c)-1;c&=~(1<<f),a+=1;var _=32-ls(r)+f;if(30<_){var b=f-f%5;_=(c&(1<<b)-1).toString(32),c>>=b,f-=b,la=1<<32-ls(r)+f|a<<f|c,ca=_+t}else la=1<<_|a<<f|c,ca=t}function C1(t){t.return!==null&&(cc(t,1),vI(t,1,0))}function I1(t){for(;t===j0;)j0=Fu[--Ou],Fu[Ou]=null,$0=Fu[--Ou],Fu[Ou]=null;for(;t===xc;)xc=ko[--Po],ko[Po]=null,ca=ko[--Po],ko[Po]=null,la=ko[--Po],ko[Po]=null}var lo=null,ao=null,on=!1,as=null;function bI(t,r){var a=zo(5,null,null,0);a.elementType="DELETED",a.stateNode=r,a.return=t,r=t.deletions,r===null?(t.deletions=[a],t.flags|=16):r.push(a)}function pS(t,r){switch(t.tag){case 5:var a=t.type;return r=r.nodeType!==1||a.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(t.stateNode=r,lo=t,ao=al(r.firstChild),!0):!1;case 6:return r=t.pendingProps===""||r.nodeType!==3?null:r,r!==null?(t.stateNode=r,lo=t,ao=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(a=xc!==null?{id:la,overflow:ca}:null,t.memoizedState={dehydrated:r,treeContext:a,retryLane:1073741824},a=zo(18,null,null,0),a.stateNode=r,a.return=t,t.child=a,lo=t,ao=null,!0):!1;default:return!1}}function Pv(t){return(t.mode&1)!==0&&(t.flags&128)===0}function zv(t){if(on){var r=ao;if(r){var a=r;if(!pS(t,r)){if(Pv(t))throw Error(pt(418));r=al(a.nextSibling);var c=lo;r&&pS(t,r)?bI(c,a):(t.flags=t.flags&-4097|2,on=!1,lo=t)}}else{if(Pv(t))throw Error(pt(418));t.flags=t.flags&-4097|2,on=!1,lo=t}}}function fS(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;lo=t}function Om(t){if(t!==lo)return!1;if(!on)return fS(t),on=!0,!1;var r;if((r=t.tag!==3)&&!(r=t.tag!==5)&&(r=t.type,r=r!=="head"&&r!=="body"&&!Tv(t.type,t.memoizedProps)),r&&(r=ao)){if(Pv(t))throw wI(),Error(pt(418));for(;r;)bI(t,r),r=al(r.nextSibling)}if(fS(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(pt(317));e:{for(t=t.nextSibling,r=0;t;){if(t.nodeType===8){var a=t.data;if(a==="/$"){if(r===0){ao=al(t.nextSibling);break e}r--}else a!=="$"&&a!=="$!"&&a!=="$?"||r++}t=t.nextSibling}ao=null}}else ao=lo?al(t.stateNode.nextSibling):null;return!0}function wI(){for(var t=ao;t;)t=al(t.nextSibling)}function eh(){ao=lo=null,on=!1}function k1(t){as===null?as=[t]:as.push(t)}var N3=ma.ReactCurrentBatchConfig;function ep(t,r,a){if(t=a.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(pt(309));var c=a.stateNode}if(!c)throw Error(pt(147,t));var f=c,_=""+t;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===_?r.ref:(r=function(b){var s=f.refs;b===null?delete s[_]:s[_]=b},r._stringRef=_,r)}if(typeof t!="string")throw Error(pt(284));if(!a._owner)throw Error(pt(290,t))}return t}function Nm(t,r){throw t=Object.prototype.toString.call(r),Error(pt(31,t==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":t))}function mS(t){var r=t._init;return r(t._payload)}function EI(t){function r(Z,U){if(t){var $=Z.deletions;$===null?(Z.deletions=[U],Z.flags|=16):$.push(U)}}function a(Z,U){if(!t)return null;for(;U!==null;)r(Z,U),U=U.sibling;return null}function c(Z,U){for(Z=new Map;U!==null;)U.key!==null?Z.set(U.key,U):Z.set(U.index,U),U=U.sibling;return Z}function f(Z,U){return Z=hl(Z,U),Z.index=0,Z.sibling=null,Z}function _(Z,U,$){return Z.index=$,t?($=Z.alternate,$!==null?($=$.index,$<U?(Z.flags|=2,U):$):(Z.flags|=2,U)):(Z.flags|=1048576,U)}function b(Z){return t&&Z.alternate===null&&(Z.flags|=2),Z}function s(Z,U,$,J){return U===null||U.tag!==6?(U=ex($,Z.mode,J),U.return=Z,U):(U=f(U,$),U.return=Z,U)}function S(Z,U,$,J){var le=$.type;return le===zu?k(Z,U,$.props.children,J,$.key):U!==null&&(U.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===Ja&&mS(le)===U.type)?(J=f(U,$.props),J.ref=ep(Z,U,$),J.return=Z,J):(J=w0($.type,$.key,$.props,null,Z.mode,J),J.ref=ep(Z,U,$),J.return=Z,J)}function C(Z,U,$,J){return U===null||U.tag!==4||U.stateNode.containerInfo!==$.containerInfo||U.stateNode.implementation!==$.implementation?(U=tx($,Z.mode,J),U.return=Z,U):(U=f(U,$.children||[]),U.return=Z,U)}function k(Z,U,$,J,le){return U===null||U.tag!==7?(U=_c($,Z.mode,J,le),U.return=Z,U):(U=f(U,$),U.return=Z,U)}function M(Z,U,$){if(typeof U=="string"&&U!==""||typeof U=="number")return U=ex(""+U,Z.mode,$),U.return=Z,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case Im:return $=w0(U.type,U.key,U.props,null,Z.mode,$),$.ref=ep(Z,null,U),$.return=Z,$;case Pu:return U=tx(U,Z.mode,$),U.return=Z,U;case Ja:var J=U._init;return M(Z,J(U._payload),$)}if(lp(U)||Xd(U))return U=_c(U,Z.mode,$,null),U.return=Z,U;Nm(Z,U)}return null}function L(Z,U,$,J){var le=U!==null?U.key:null;if(typeof $=="string"&&$!==""||typeof $=="number")return le!==null?null:s(Z,U,""+$,J);if(typeof $=="object"&&$!==null){switch($.$$typeof){case Im:return $.key===le?S(Z,U,$,J):null;case Pu:return $.key===le?C(Z,U,$,J):null;case Ja:return le=$._init,L(Z,U,le($._payload),J)}if(lp($)||Xd($))return le!==null?null:k(Z,U,$,J,null);Nm(Z,$)}return null}function V(Z,U,$,J,le){if(typeof J=="string"&&J!==""||typeof J=="number")return Z=Z.get($)||null,s(U,Z,""+J,le);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case Im:return Z=Z.get(J.key===null?$:J.key)||null,S(U,Z,J,le);case Pu:return Z=Z.get(J.key===null?$:J.key)||null,C(U,Z,J,le);case Ja:var pe=J._init;return V(Z,U,$,pe(J._payload),le)}if(lp(J)||Xd(J))return Z=Z.get($)||null,k(U,Z,J,le,null);Nm(U,J)}return null}function O(Z,U,$,J){for(var le=null,pe=null,ye=U,Te=U=0,Se=null;ye!==null&&Te<$.length;Te++){ye.index>Te?(Se=ye,ye=null):Se=ye.sibling;var Ae=L(Z,ye,$[Te],J);if(Ae===null){ye===null&&(ye=Se);break}t&&ye&&Ae.alternate===null&&r(Z,ye),U=_(Ae,U,Te),pe===null?le=Ae:pe.sibling=Ae,pe=Ae,ye=Se}if(Te===$.length)return a(Z,ye),on&&cc(Z,Te),le;if(ye===null){for(;Te<$.length;Te++)ye=M(Z,$[Te],J),ye!==null&&(U=_(ye,U,Te),pe===null?le=ye:pe.sibling=ye,pe=ye);return on&&cc(Z,Te),le}for(ye=c(Z,ye);Te<$.length;Te++)Se=V(ye,Z,Te,$[Te],J),Se!==null&&(t&&Se.alternate!==null&&ye.delete(Se.key===null?Te:Se.key),U=_(Se,U,Te),pe===null?le=Se:pe.sibling=Se,pe=Se);return t&&ye.forEach(function(Ne){return r(Z,Ne)}),on&&cc(Z,Te),le}function j(Z,U,$,J){var le=Xd($);if(typeof le!="function")throw Error(pt(150));if($=le.call($),$==null)throw Error(pt(151));for(var pe=le=null,ye=U,Te=U=0,Se=null,Ae=$.next();ye!==null&&!Ae.done;Te++,Ae=$.next()){ye.index>Te?(Se=ye,ye=null):Se=ye.sibling;var Ne=L(Z,ye,Ae.value,J);if(Ne===null){ye===null&&(ye=Se);break}t&&ye&&Ne.alternate===null&&r(Z,ye),U=_(Ne,U,Te),pe===null?le=Ne:pe.sibling=Ne,pe=Ne,ye=Se}if(Ae.done)return a(Z,ye),on&&cc(Z,Te),le;if(ye===null){for(;!Ae.done;Te++,Ae=$.next())Ae=M(Z,Ae.value,J),Ae!==null&&(U=_(Ae,U,Te),pe===null?le=Ae:pe.sibling=Ae,pe=Ae);return on&&cc(Z,Te),le}for(ye=c(Z,ye);!Ae.done;Te++,Ae=$.next())Ae=V(ye,Z,Te,Ae.value,J),Ae!==null&&(t&&Ae.alternate!==null&&ye.delete(Ae.key===null?Te:Ae.key),U=_(Ae,U,Te),pe===null?le=Ae:pe.sibling=Ae,pe=Ae);return t&&ye.forEach(function(Ue){return r(Z,Ue)}),on&&cc(Z,Te),le}function H(Z,U,$,J){if(typeof $=="object"&&$!==null&&$.type===zu&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case Im:e:{for(var le=$.key,pe=U;pe!==null;){if(pe.key===le){if(le=$.type,le===zu){if(pe.tag===7){a(Z,pe.sibling),U=f(pe,$.props.children),U.return=Z,Z=U;break e}}else if(pe.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===Ja&&mS(le)===pe.type){a(Z,pe.sibling),U=f(pe,$.props),U.ref=ep(Z,pe,$),U.return=Z,Z=U;break e}a(Z,pe);break}else r(Z,pe);pe=pe.sibling}$.type===zu?(U=_c($.props.children,Z.mode,J,$.key),U.return=Z,Z=U):(J=w0($.type,$.key,$.props,null,Z.mode,J),J.ref=ep(Z,U,$),J.return=Z,Z=J)}return b(Z);case Pu:e:{for(pe=$.key;U!==null;){if(U.key===pe)if(U.tag===4&&U.stateNode.containerInfo===$.containerInfo&&U.stateNode.implementation===$.implementation){a(Z,U.sibling),U=f(U,$.children||[]),U.return=Z,Z=U;break e}else{a(Z,U);break}else r(Z,U);U=U.sibling}U=tx($,Z.mode,J),U.return=Z,Z=U}return b(Z);case Ja:return pe=$._init,H(Z,U,pe($._payload),J)}if(lp($))return O(Z,U,$,J);if(Xd($))return j(Z,U,$,J);Nm(Z,$)}return typeof $=="string"&&$!==""||typeof $=="number"?($=""+$,U!==null&&U.tag===6?(a(Z,U.sibling),U=f(U,$),U.return=Z,Z=U):(a(Z,U),U=ex($,Z.mode,J),U.return=Z,Z=U),b(Z)):a(Z,U)}return H}var th=EI(!0),SI=EI(!1),W0=_l(null),q0=null,Nu=null,P1=null;function z1(){P1=Nu=q0=null}function D1(t){var r=W0.current;en(W0),t._currentValue=r}function Dv(t,r,a){for(;t!==null;){var c=t.alternate;if((t.childLanes&r)!==r?(t.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),t===a)break;t=t.return}}function Zu(t,r){q0=t,P1=Nu=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&r&&($i=!0),t.firstContext=null)}function Mo(t){var r=t._currentValue;if(P1!==t)if(t={context:t,memoizedValue:r,next:null},Nu===null){if(q0===null)throw Error(pt(308));Nu=t,q0.dependencies={lanes:0,firstContext:t}}else Nu=Nu.next=t;return r}var pc=null;function M1(t){pc===null?pc=[t]:pc.push(t)}function AI(t,r,a,c){var f=r.interleaved;return f===null?(a.next=a,M1(r)):(a.next=f.next,f.next=a),r.interleaved=a,pa(t,c)}function pa(t,r){t.lanes|=r;var a=t.alternate;for(a!==null&&(a.lanes|=r),a=t,t=t.return;t!==null;)t.childLanes|=r,a=t.alternate,a!==null&&(a.childLanes|=r),a=t,t=t.return;return a.tag===3?a.stateNode:null}var Qa=!1;function R1(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function TI(t,r){t=t.updateQueue,r.updateQueue===t&&(r.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ua(t,r){return{eventTime:t,lane:r,tag:0,payload:null,callback:null,next:null}}function ll(t,r,a){var c=t.updateQueue;if(c===null)return null;if(c=c.shared,br&2){var f=c.pending;return f===null?r.next=r:(r.next=f.next,f.next=r),c.pending=r,pa(t,a)}return f=c.interleaved,f===null?(r.next=r,M1(c)):(r.next=f.next,f.next=r),c.interleaved=r,pa(t,a)}function g0(t,r,a){if(r=r.updateQueue,r!==null&&(r=r.shared,(a&4194240)!==0)){var c=r.lanes;c&=t.pendingLanes,a|=c,r.lanes=a,x1(t,a)}}function gS(t,r){var a=t.updateQueue,c=t.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var f=null,_=null;if(a=a.firstBaseUpdate,a!==null){do{var b={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};_===null?f=_=b:_=_.next=b,a=a.next}while(a!==null);_===null?f=_=r:_=_.next=r}else f=_=r;a={baseState:c.baseState,firstBaseUpdate:f,lastBaseUpdate:_,shared:c.shared,effects:c.effects},t.updateQueue=a;return}t=a.lastBaseUpdate,t===null?a.firstBaseUpdate=r:t.next=r,a.lastBaseUpdate=r}function G0(t,r,a,c){var f=t.updateQueue;Qa=!1;var _=f.firstBaseUpdate,b=f.lastBaseUpdate,s=f.shared.pending;if(s!==null){f.shared.pending=null;var S=s,C=S.next;S.next=null,b===null?_=C:b.next=C,b=S;var k=t.alternate;k!==null&&(k=k.updateQueue,s=k.lastBaseUpdate,s!==b&&(s===null?k.firstBaseUpdate=C:s.next=C,k.lastBaseUpdate=S))}if(_!==null){var M=f.baseState;b=0,k=C=S=null,s=_;do{var L=s.lane,V=s.eventTime;if((c&L)===L){k!==null&&(k=k.next={eventTime:V,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var O=t,j=s;switch(L=r,V=a,j.tag){case 1:if(O=j.payload,typeof O=="function"){M=O.call(V,M,L);break e}M=O;break e;case 3:O.flags=O.flags&-65537|128;case 0:if(O=j.payload,L=typeof O=="function"?O.call(V,M,L):O,L==null)break e;M=yn({},M,L);break e;case 2:Qa=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,L=f.effects,L===null?f.effects=[s]:L.push(s))}else V={eventTime:V,lane:L,tag:s.tag,payload:s.payload,callback:s.callback,next:null},k===null?(C=k=V,S=M):k=k.next=V,b|=L;if(s=s.next,s===null){if(s=f.shared.pending,s===null)break;L=s,s=L.next,L.next=null,f.lastBaseUpdate=L,f.shared.pending=null}}while(1);if(k===null&&(S=M),f.baseState=S,f.firstBaseUpdate=C,f.lastBaseUpdate=k,r=f.shared.interleaved,r!==null){f=r;do b|=f.lane,f=f.next;while(f!==r)}else _===null&&(f.shared.lanes=0);bc|=b,t.lanes=b,t.memoizedState=M}}function _S(t,r,a){if(t=r.effects,r.effects=null,t!==null)for(r=0;r<t.length;r++){var c=t[r],f=c.callback;if(f!==null){if(c.callback=null,c=a,typeof f!="function")throw Error(pt(191,f));f.call(c)}}}var Zp={},Bs=_l(Zp),Mp=_l(Zp),Rp=_l(Zp);function fc(t){if(t===Zp)throw Error(pt(174));return t}function B1(t,r){switch(Zr(Rp,r),Zr(Mp,t),Zr(Bs,Zp),t=r.nodeType,t){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:dv(null,"");break;default:t=t===8?r.parentNode:r,r=t.namespaceURI||null,t=t.tagName,r=dv(r,t)}en(Bs),Zr(Bs,r)}function rh(){en(Bs),en(Mp),en(Rp)}function CI(t){fc(Rp.current);var r=fc(Bs.current),a=dv(r,t.type);r!==a&&(Zr(Mp,t),Zr(Bs,a))}function L1(t){Mp.current===t&&(en(Bs),en(Mp))}var gn=_l(0);function H0(t){for(var r=t;r!==null;){if(r.tag===13){var a=r.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Zy=[];function F1(){for(var t=0;t<Zy.length;t++)Zy[t]._workInProgressVersionPrimary=null;Zy.length=0}var _0=ma.ReactCurrentDispatcher,Xy=ma.ReactCurrentBatchConfig,vc=0,_n=null,$n=null,Yn=null,Z0=!1,_p=!1,Bp=0,U3=0;function _i(){throw Error(pt(321))}function O1(t,r){if(r===null)return!1;for(var a=0;a<r.length&&a<t.length;a++)if(!ds(t[a],r[a]))return!1;return!0}function N1(t,r,a,c,f,_){if(vc=_,_n=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,_0.current=t===null||t.memoizedState===null?W3:q3,t=a(c,f),_p){_=0;do{if(_p=!1,Bp=0,25<=_)throw Error(pt(301));_+=1,Yn=$n=null,r.updateQueue=null,_0.current=G3,t=a(c,f)}while(_p)}if(_0.current=X0,r=$n!==null&&$n.next!==null,vc=0,Yn=$n=_n=null,Z0=!1,r)throw Error(pt(300));return t}function U1(){var t=Bp!==0;return Bp=0,t}function Ds(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yn===null?_n.memoizedState=Yn=t:Yn=Yn.next=t,Yn}function Ro(){if($n===null){var t=_n.alternate;t=t!==null?t.memoizedState:null}else t=$n.next;var r=Yn===null?_n.memoizedState:Yn.next;if(r!==null)Yn=r,$n=t;else{if(t===null)throw Error(pt(310));$n=t,t={memoizedState:$n.memoizedState,baseState:$n.baseState,baseQueue:$n.baseQueue,queue:$n.queue,next:null},Yn===null?_n.memoizedState=Yn=t:Yn=Yn.next=t}return Yn}function Lp(t,r){return typeof r=="function"?r(t):r}function Ky(t){var r=Ro(),a=r.queue;if(a===null)throw Error(pt(311));a.lastRenderedReducer=t;var c=$n,f=c.baseQueue,_=a.pending;if(_!==null){if(f!==null){var b=f.next;f.next=_.next,_.next=b}c.baseQueue=f=_,a.pending=null}if(f!==null){_=f.next,c=c.baseState;var s=b=null,S=null,C=_;do{var k=C.lane;if((vc&k)===k)S!==null&&(S=S.next={lane:0,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null}),c=C.hasEagerState?C.eagerState:t(c,C.action);else{var M={lane:k,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null};S===null?(s=S=M,b=c):S=S.next=M,_n.lanes|=k,bc|=k}C=C.next}while(C!==null&&C!==_);S===null?b=c:S.next=s,ds(c,r.memoizedState)||($i=!0),r.memoizedState=c,r.baseState=b,r.baseQueue=S,a.lastRenderedState=c}if(t=a.interleaved,t!==null){f=t;do _=f.lane,_n.lanes|=_,bc|=_,f=f.next;while(f!==t)}else f===null&&(a.lanes=0);return[r.memoizedState,a.dispatch]}function Yy(t){var r=Ro(),a=r.queue;if(a===null)throw Error(pt(311));a.lastRenderedReducer=t;var c=a.dispatch,f=a.pending,_=r.memoizedState;if(f!==null){a.pending=null;var b=f=f.next;do _=t(_,b.action),b=b.next;while(b!==f);ds(_,r.memoizedState)||($i=!0),r.memoizedState=_,r.baseQueue===null&&(r.baseState=_),a.lastRenderedState=_}return[_,c]}function II(){}function kI(t,r){var a=_n,c=Ro(),f=r(),_=!ds(c.memoizedState,f);if(_&&(c.memoizedState=f,$i=!0),c=c.queue,V1(DI.bind(null,a,c,t),[t]),c.getSnapshot!==r||_||Yn!==null&&Yn.memoizedState.tag&1){if(a.flags|=2048,Fp(9,zI.bind(null,a,c,f,r),void 0,null),Jn===null)throw Error(pt(349));vc&30||PI(a,r,f)}return f}function PI(t,r,a){t.flags|=16384,t={getSnapshot:r,value:a},r=_n.updateQueue,r===null?(r={lastEffect:null,stores:null},_n.updateQueue=r,r.stores=[t]):(a=r.stores,a===null?r.stores=[t]:a.push(t))}function zI(t,r,a,c){r.value=a,r.getSnapshot=c,MI(r)&&RI(t)}function DI(t,r,a){return a(function(){MI(r)&&RI(t)})}function MI(t){var r=t.getSnapshot;t=t.value;try{var a=r();return!ds(t,a)}catch{return!0}}function RI(t){var r=pa(t,1);r!==null&&cs(r,t,1,-1)}function yS(t){var r=Ds();return typeof t=="function"&&(t=t()),r.memoizedState=r.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Lp,lastRenderedState:t},r.queue=t,t=t.dispatch=$3.bind(null,_n,t),[r.memoizedState,t]}function Fp(t,r,a,c){return t={tag:t,create:r,destroy:a,deps:c,next:null},r=_n.updateQueue,r===null?(r={lastEffect:null,stores:null},_n.updateQueue=r,r.lastEffect=t.next=t):(a=r.lastEffect,a===null?r.lastEffect=t.next=t:(c=a.next,a.next=t,t.next=c,r.lastEffect=t)),t}function BI(){return Ro().memoizedState}function y0(t,r,a,c){var f=Ds();_n.flags|=t,f.memoizedState=Fp(1|r,a,void 0,c===void 0?null:c)}function xg(t,r,a,c){var f=Ro();c=c===void 0?null:c;var _=void 0;if($n!==null){var b=$n.memoizedState;if(_=b.destroy,c!==null&&O1(c,b.deps)){f.memoizedState=Fp(r,a,_,c);return}}_n.flags|=t,f.memoizedState=Fp(1|r,a,_,c)}function xS(t,r){return y0(8390656,8,t,r)}function V1(t,r){return xg(2048,8,t,r)}function LI(t,r){return xg(4,2,t,r)}function FI(t,r){return xg(4,4,t,r)}function OI(t,r){if(typeof r=="function")return t=t(),r(t),function(){r(null)};if(r!=null)return t=t(),r.current=t,function(){r.current=null}}function NI(t,r,a){return a=a!=null?a.concat([t]):null,xg(4,4,OI.bind(null,r,t),a)}function j1(){}function UI(t,r){var a=Ro();r=r===void 0?null:r;var c=a.memoizedState;return c!==null&&r!==null&&O1(r,c[1])?c[0]:(a.memoizedState=[t,r],t)}function VI(t,r){var a=Ro();r=r===void 0?null:r;var c=a.memoizedState;return c!==null&&r!==null&&O1(r,c[1])?c[0]:(t=t(),a.memoizedState=[t,r],t)}function jI(t,r,a){return vc&21?(ds(a,r)||(a=HC(),_n.lanes|=a,bc|=a,t.baseState=!0),r):(t.baseState&&(t.baseState=!1,$i=!0),t.memoizedState=a)}function V3(t,r){var a=Fr;Fr=a!==0&&4>a?a:4,t(!0);var c=Xy.transition;Xy.transition={};try{t(!1),r()}finally{Fr=a,Xy.transition=c}}function $I(){return Ro().memoizedState}function j3(t,r,a){var c=ul(t);if(a={lane:c,action:a,hasEagerState:!1,eagerState:null,next:null},WI(t))qI(r,a);else if(a=AI(t,r,a,c),a!==null){var f=ki();cs(a,t,c,f),GI(a,r,c)}}function $3(t,r,a){var c=ul(t),f={lane:c,action:a,hasEagerState:!1,eagerState:null,next:null};if(WI(t))qI(r,f);else{var _=t.alternate;if(t.lanes===0&&(_===null||_.lanes===0)&&(_=r.lastRenderedReducer,_!==null))try{var b=r.lastRenderedState,s=_(b,a);if(f.hasEagerState=!0,f.eagerState=s,ds(s,b)){var S=r.interleaved;S===null?(f.next=f,M1(r)):(f.next=S.next,S.next=f),r.interleaved=f;return}}catch{}finally{}a=AI(t,r,f,c),a!==null&&(f=ki(),cs(a,t,c,f),GI(a,r,c))}}function WI(t){var r=t.alternate;return t===_n||r!==null&&r===_n}function qI(t,r){_p=Z0=!0;var a=t.pending;a===null?r.next=r:(r.next=a.next,a.next=r),t.pending=r}function GI(t,r,a){if(a&4194240){var c=r.lanes;c&=t.pendingLanes,a|=c,r.lanes=a,x1(t,a)}}var X0={readContext:Mo,useCallback:_i,useContext:_i,useEffect:_i,useImperativeHandle:_i,useInsertionEffect:_i,useLayoutEffect:_i,useMemo:_i,useReducer:_i,useRef:_i,useState:_i,useDebugValue:_i,useDeferredValue:_i,useTransition:_i,useMutableSource:_i,useSyncExternalStore:_i,useId:_i,unstable_isNewReconciler:!1},W3={readContext:Mo,useCallback:function(t,r){return Ds().memoizedState=[t,r===void 0?null:r],t},useContext:Mo,useEffect:xS,useImperativeHandle:function(t,r,a){return a=a!=null?a.concat([t]):null,y0(4194308,4,OI.bind(null,r,t),a)},useLayoutEffect:function(t,r){return y0(4194308,4,t,r)},useInsertionEffect:function(t,r){return y0(4,2,t,r)},useMemo:function(t,r){var a=Ds();return r=r===void 0?null:r,t=t(),a.memoizedState=[t,r],t},useReducer:function(t,r,a){var c=Ds();return r=a!==void 0?a(r):r,c.memoizedState=c.baseState=r,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:r},c.queue=t,t=t.dispatch=j3.bind(null,_n,t),[c.memoizedState,t]},useRef:function(t){var r=Ds();return t={current:t},r.memoizedState=t},useState:yS,useDebugValue:j1,useDeferredValue:function(t){return Ds().memoizedState=t},useTransition:function(){var t=yS(!1),r=t[0];return t=V3.bind(null,t[1]),Ds().memoizedState=t,[r,t]},useMutableSource:function(){},useSyncExternalStore:function(t,r,a){var c=_n,f=Ds();if(on){if(a===void 0)throw Error(pt(407));a=a()}else{if(a=r(),Jn===null)throw Error(pt(349));vc&30||PI(c,r,a)}f.memoizedState=a;var _={value:a,getSnapshot:r};return f.queue=_,xS(DI.bind(null,c,_,t),[t]),c.flags|=2048,Fp(9,zI.bind(null,c,_,a,r),void 0,null),a},useId:function(){var t=Ds(),r=Jn.identifierPrefix;if(on){var a=ca,c=la;a=(c&~(1<<32-ls(c)-1)).toString(32)+a,r=":"+r+"R"+a,a=Bp++,0<a&&(r+="H"+a.toString(32)),r+=":"}else a=U3++,r=":"+r+"r"+a.toString(32)+":";return t.memoizedState=r},unstable_isNewReconciler:!1},q3={readContext:Mo,useCallback:UI,useContext:Mo,useEffect:V1,useImperativeHandle:NI,useInsertionEffect:LI,useLayoutEffect:FI,useMemo:VI,useReducer:Ky,useRef:BI,useState:function(){return Ky(Lp)},useDebugValue:j1,useDeferredValue:function(t){var r=Ro();return jI(r,$n.memoizedState,t)},useTransition:function(){var t=Ky(Lp)[0],r=Ro().memoizedState;return[t,r]},useMutableSource:II,useSyncExternalStore:kI,useId:$I,unstable_isNewReconciler:!1},G3={readContext:Mo,useCallback:UI,useContext:Mo,useEffect:V1,useImperativeHandle:NI,useInsertionEffect:LI,useLayoutEffect:FI,useMemo:VI,useReducer:Yy,useRef:BI,useState:function(){return Yy(Lp)},useDebugValue:j1,useDeferredValue:function(t){var r=Ro();return $n===null?r.memoizedState=t:jI(r,$n.memoizedState,t)},useTransition:function(){var t=Yy(Lp)[0],r=Ro().memoizedState;return[t,r]},useMutableSource:II,useSyncExternalStore:kI,useId:$I,unstable_isNewReconciler:!1};function os(t,r){if(t&&t.defaultProps){r=yn({},r),t=t.defaultProps;for(var a in t)r[a]===void 0&&(r[a]=t[a]);return r}return r}function Mv(t,r,a,c){r=t.memoizedState,a=a(c,r),a=a==null?r:yn({},r,a),t.memoizedState=a,t.lanes===0&&(t.updateQueue.baseState=a)}var vg={isMounted:function(t){return(t=t._reactInternals)?Tc(t)===t:!1},enqueueSetState:function(t,r,a){t=t._reactInternals;var c=ki(),f=ul(t),_=ua(c,f);_.payload=r,a!=null&&(_.callback=a),r=ll(t,_,f),r!==null&&(cs(r,t,f,c),g0(r,t,f))},enqueueReplaceState:function(t,r,a){t=t._reactInternals;var c=ki(),f=ul(t),_=ua(c,f);_.tag=1,_.payload=r,a!=null&&(_.callback=a),r=ll(t,_,f),r!==null&&(cs(r,t,f,c),g0(r,t,f))},enqueueForceUpdate:function(t,r){t=t._reactInternals;var a=ki(),c=ul(t),f=ua(a,c);f.tag=2,r!=null&&(f.callback=r),r=ll(t,f,c),r!==null&&(cs(r,t,c,a),g0(r,t,c))}};function vS(t,r,a,c,f,_,b){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(c,_,b):r.prototype&&r.prototype.isPureReactComponent?!kp(a,c)||!kp(f,_):!0}function HI(t,r,a){var c=!1,f=pl,_=r.contextType;return typeof _=="object"&&_!==null?_=Mo(_):(f=qi(r)?yc:wi.current,c=r.contextTypes,_=(c=c!=null)?Qu(t,f):pl),r=new r(a,_),t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=vg,t.stateNode=r,r._reactInternals=t,c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=f,t.__reactInternalMemoizedMaskedChildContext=_),r}function bS(t,r,a,c){t=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(a,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(a,c),r.state!==t&&vg.enqueueReplaceState(r,r.state,null)}function Rv(t,r,a,c){var f=t.stateNode;f.props=a,f.state=t.memoizedState,f.refs={},R1(t);var _=r.contextType;typeof _=="object"&&_!==null?f.context=Mo(_):(_=qi(r)?yc:wi.current,f.context=Qu(t,_)),f.state=t.memoizedState,_=r.getDerivedStateFromProps,typeof _=="function"&&(Mv(t,r,_,a),f.state=t.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(r=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),r!==f.state&&vg.enqueueReplaceState(f,f.state,null),G0(t,a,f,c),f.state=t.memoizedState),typeof f.componentDidMount=="function"&&(t.flags|=4194308)}function nh(t,r){try{var a="",c=r;do a+=vM(c),c=c.return;while(c);var f=a}catch(_){f=`
Error generating stack: `+_.message+`
`+_.stack}return{value:t,source:r,stack:f,digest:null}}function Jy(t,r,a){return{value:t,source:null,stack:a??null,digest:r??null}}function Bv(t,r){try{console.error(r.value)}catch(a){setTimeout(function(){throw a})}}var H3=typeof WeakMap=="function"?WeakMap:Map;function ZI(t,r,a){a=ua(-1,a),a.tag=3,a.payload={element:null};var c=r.value;return a.callback=function(){Y0||(Y0=!0,qv=c),Bv(t,r)},a}function XI(t,r,a){a=ua(-1,a),a.tag=3;var c=t.type.getDerivedStateFromError;if(typeof c=="function"){var f=r.value;a.payload=function(){return c(f)},a.callback=function(){Bv(t,r)}}var _=t.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(a.callback=function(){Bv(t,r),typeof c!="function"&&(cl===null?cl=new Set([this]):cl.add(this));var b=r.stack;this.componentDidCatch(r.value,{componentStack:b!==null?b:""})}),a}function wS(t,r,a){var c=t.pingCache;if(c===null){c=t.pingCache=new H3;var f=new Set;c.set(r,f)}else f=c.get(r),f===void 0&&(f=new Set,c.set(r,f));f.has(a)||(f.add(a),t=a5.bind(null,t,r,a),r.then(t,t))}function ES(t){do{var r;if((r=t.tag===13)&&(r=t.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return t;t=t.return}while(t!==null);return null}function SS(t,r,a,c,f){return t.mode&1?(t.flags|=65536,t.lanes=f,t):(t===r?t.flags|=65536:(t.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(r=ua(-1,1),r.tag=2,ll(a,r,1))),a.lanes|=1),t)}var Z3=ma.ReactCurrentOwner,$i=!1;function Ii(t,r,a,c){r.child=t===null?SI(r,null,a,c):th(r,t.child,a,c)}function AS(t,r,a,c,f){a=a.render;var _=r.ref;return Zu(r,f),c=N1(t,r,a,c,_,f),a=U1(),t!==null&&!$i?(r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~f,fa(t,r,f)):(on&&a&&C1(r),r.flags|=1,Ii(t,r,c,f),r.child)}function TS(t,r,a,c,f){if(t===null){var _=a.type;return typeof _=="function"&&!K1(_)&&_.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(r.tag=15,r.type=_,KI(t,r,_,c,f)):(t=w0(a.type,null,c,r,r.mode,f),t.ref=r.ref,t.return=r,r.child=t)}if(_=t.child,!(t.lanes&f)){var b=_.memoizedProps;if(a=a.compare,a=a!==null?a:kp,a(b,c)&&t.ref===r.ref)return fa(t,r,f)}return r.flags|=1,t=hl(_,c),t.ref=r.ref,t.return=r,r.child=t}function KI(t,r,a,c,f){if(t!==null){var _=t.memoizedProps;if(kp(_,c)&&t.ref===r.ref)if($i=!1,r.pendingProps=c=_,(t.lanes&f)!==0)t.flags&131072&&($i=!0);else return r.lanes=t.lanes,fa(t,r,f)}return Lv(t,r,a,c,f)}function YI(t,r,a){var c=r.pendingProps,f=c.children,_=t!==null?t.memoizedState:null;if(c.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},Zr(Vu,so),so|=a;else{if(!(a&1073741824))return t=_!==null?_.baseLanes|a:a,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:t,cachePool:null,transitions:null},r.updateQueue=null,Zr(Vu,so),so|=t,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=_!==null?_.baseLanes:a,Zr(Vu,so),so|=c}else _!==null?(c=_.baseLanes|a,r.memoizedState=null):c=a,Zr(Vu,so),so|=c;return Ii(t,r,f,a),r.child}function JI(t,r){var a=r.ref;(t===null&&a!==null||t!==null&&t.ref!==a)&&(r.flags|=512,r.flags|=2097152)}function Lv(t,r,a,c,f){var _=qi(a)?yc:wi.current;return _=Qu(r,_),Zu(r,f),a=N1(t,r,a,c,_,f),c=U1(),t!==null&&!$i?(r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~f,fa(t,r,f)):(on&&c&&C1(r),r.flags|=1,Ii(t,r,a,f),r.child)}function CS(t,r,a,c,f){if(qi(a)){var _=!0;V0(r)}else _=!1;if(Zu(r,f),r.stateNode===null)x0(t,r),HI(r,a,c),Rv(r,a,c,f),c=!0;else if(t===null){var b=r.stateNode,s=r.memoizedProps;b.props=s;var S=b.context,C=a.contextType;typeof C=="object"&&C!==null?C=Mo(C):(C=qi(a)?yc:wi.current,C=Qu(r,C));var k=a.getDerivedStateFromProps,M=typeof k=="function"||typeof b.getSnapshotBeforeUpdate=="function";M||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(s!==c||S!==C)&&bS(r,b,c,C),Qa=!1;var L=r.memoizedState;b.state=L,G0(r,c,b,f),S=r.memoizedState,s!==c||L!==S||Wi.current||Qa?(typeof k=="function"&&(Mv(r,a,k,c),S=r.memoizedState),(s=Qa||vS(r,a,s,c,L,S,C))?(M||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(r.flags|=4194308)):(typeof b.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=S),b.props=c,b.state=S,b.context=C,c=s):(typeof b.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{b=r.stateNode,TI(t,r),s=r.memoizedProps,C=r.type===r.elementType?s:os(r.type,s),b.props=C,M=r.pendingProps,L=b.context,S=a.contextType,typeof S=="object"&&S!==null?S=Mo(S):(S=qi(a)?yc:wi.current,S=Qu(r,S));var V=a.getDerivedStateFromProps;(k=typeof V=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(s!==M||L!==S)&&bS(r,b,c,S),Qa=!1,L=r.memoizedState,b.state=L,G0(r,c,b,f);var O=r.memoizedState;s!==M||L!==O||Wi.current||Qa?(typeof V=="function"&&(Mv(r,a,V,c),O=r.memoizedState),(C=Qa||vS(r,a,C,c,L,O,S)||!1)?(k||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(c,O,S),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(c,O,S)),typeof b.componentDidUpdate=="function"&&(r.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof b.componentDidUpdate!="function"||s===t.memoizedProps&&L===t.memoizedState||(r.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&L===t.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=O),b.props=c,b.state=O,b.context=S,c=C):(typeof b.componentDidUpdate!="function"||s===t.memoizedProps&&L===t.memoizedState||(r.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&L===t.memoizedState||(r.flags|=1024),c=!1)}return Fv(t,r,a,c,_,f)}function Fv(t,r,a,c,f,_){JI(t,r);var b=(r.flags&128)!==0;if(!c&&!b)return f&&dS(r,a,!1),fa(t,r,_);c=r.stateNode,Z3.current=r;var s=b&&typeof a.getDerivedStateFromError!="function"?null:c.render();return r.flags|=1,t!==null&&b?(r.child=th(r,t.child,null,_),r.child=th(r,null,s,_)):Ii(t,r,s,_),r.memoizedState=c.state,f&&dS(r,a,!0),r.child}function QI(t){var r=t.stateNode;r.pendingContext?hS(t,r.pendingContext,r.pendingContext!==r.context):r.context&&hS(t,r.context,!1),B1(t,r.containerInfo)}function IS(t,r,a,c,f){return eh(),k1(f),r.flags|=256,Ii(t,r,a,c),r.child}var Ov={dehydrated:null,treeContext:null,retryLane:0};function Nv(t){return{baseLanes:t,cachePool:null,transitions:null}}function ek(t,r,a){var c=r.pendingProps,f=gn.current,_=!1,b=(r.flags&128)!==0,s;if((s=b)||(s=t!==null&&t.memoizedState===null?!1:(f&2)!==0),s?(_=!0,r.flags&=-129):(t===null||t.memoizedState!==null)&&(f|=1),Zr(gn,f&1),t===null)return zv(r),t=r.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(r.mode&1?t.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(b=c.children,t=c.fallback,_?(c=r.mode,_=r.child,b={mode:"hidden",children:b},!(c&1)&&_!==null?(_.childLanes=0,_.pendingProps=b):_=Eg(b,c,0,null),t=_c(t,c,a,null),_.return=r,t.return=r,_.sibling=t,r.child=_,r.child.memoizedState=Nv(a),r.memoizedState=Ov,t):$1(r,b));if(f=t.memoizedState,f!==null&&(s=f.dehydrated,s!==null))return X3(t,r,b,c,s,f,a);if(_){_=c.fallback,b=r.mode,f=t.child,s=f.sibling;var S={mode:"hidden",children:c.children};return!(b&1)&&r.child!==f?(c=r.child,c.childLanes=0,c.pendingProps=S,r.deletions=null):(c=hl(f,S),c.subtreeFlags=f.subtreeFlags&14680064),s!==null?_=hl(s,_):(_=_c(_,b,a,null),_.flags|=2),_.return=r,c.return=r,c.sibling=_,r.child=c,c=_,_=r.child,b=t.child.memoizedState,b=b===null?Nv(a):{baseLanes:b.baseLanes|a,cachePool:null,transitions:b.transitions},_.memoizedState=b,_.childLanes=t.childLanes&~a,r.memoizedState=Ov,c}return _=t.child,t=_.sibling,c=hl(_,{mode:"visible",children:c.children}),!(r.mode&1)&&(c.lanes=a),c.return=r,c.sibling=null,t!==null&&(a=r.deletions,a===null?(r.deletions=[t],r.flags|=16):a.push(t)),r.child=c,r.memoizedState=null,c}function $1(t,r){return r=Eg({mode:"visible",children:r},t.mode,0,null),r.return=t,t.child=r}function Um(t,r,a,c){return c!==null&&k1(c),th(r,t.child,null,a),t=$1(r,r.pendingProps.children),t.flags|=2,r.memoizedState=null,t}function X3(t,r,a,c,f,_,b){if(a)return r.flags&256?(r.flags&=-257,c=Jy(Error(pt(422))),Um(t,r,b,c)):r.memoizedState!==null?(r.child=t.child,r.flags|=128,null):(_=c.fallback,f=r.mode,c=Eg({mode:"visible",children:c.children},f,0,null),_=_c(_,f,b,null),_.flags|=2,c.return=r,_.return=r,c.sibling=_,r.child=c,r.mode&1&&th(r,t.child,null,b),r.child.memoizedState=Nv(b),r.memoizedState=Ov,_);if(!(r.mode&1))return Um(t,r,b,null);if(f.data==="$!"){if(c=f.nextSibling&&f.nextSibling.dataset,c)var s=c.dgst;return c=s,_=Error(pt(419)),c=Jy(_,c,void 0),Um(t,r,b,c)}if(s=(b&t.childLanes)!==0,$i||s){if(c=Jn,c!==null){switch(b&-b){case 4:f=2;break;case 16:f=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:f=32;break;case 536870912:f=268435456;break;default:f=0}f=f&(c.suspendedLanes|b)?0:f,f!==0&&f!==_.retryLane&&(_.retryLane=f,pa(t,f),cs(c,t,f,-1))}return X1(),c=Jy(Error(pt(421))),Um(t,r,b,c)}return f.data==="$?"?(r.flags|=128,r.child=t.child,r=l5.bind(null,t),f._reactRetry=r,null):(t=_.treeContext,ao=al(f.nextSibling),lo=r,on=!0,as=null,t!==null&&(ko[Po++]=la,ko[Po++]=ca,ko[Po++]=xc,la=t.id,ca=t.overflow,xc=r),r=$1(r,c.children),r.flags|=4096,r)}function kS(t,r,a){t.lanes|=r;var c=t.alternate;c!==null&&(c.lanes|=r),Dv(t.return,r,a)}function Qy(t,r,a,c,f){var _=t.memoizedState;_===null?t.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:f}:(_.isBackwards=r,_.rendering=null,_.renderingStartTime=0,_.last=c,_.tail=a,_.tailMode=f)}function tk(t,r,a){var c=r.pendingProps,f=c.revealOrder,_=c.tail;if(Ii(t,r,c.children,a),c=gn.current,c&2)c=c&1|2,r.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=r.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&kS(t,a,r);else if(t.tag===19)kS(t,a,r);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===r)break e;for(;t.sibling===null;){if(t.return===null||t.return===r)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}c&=1}if(Zr(gn,c),!(r.mode&1))r.memoizedState=null;else switch(f){case"forwards":for(a=r.child,f=null;a!==null;)t=a.alternate,t!==null&&H0(t)===null&&(f=a),a=a.sibling;a=f,a===null?(f=r.child,r.child=null):(f=a.sibling,a.sibling=null),Qy(r,!1,f,a,_);break;case"backwards":for(a=null,f=r.child,r.child=null;f!==null;){if(t=f.alternate,t!==null&&H0(t)===null){r.child=f;break}t=f.sibling,f.sibling=a,a=f,f=t}Qy(r,!0,a,null,_);break;case"together":Qy(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function x0(t,r){!(r.mode&1)&&t!==null&&(t.alternate=null,r.alternate=null,r.flags|=2)}function fa(t,r,a){if(t!==null&&(r.dependencies=t.dependencies),bc|=r.lanes,!(a&r.childLanes))return null;if(t!==null&&r.child!==t.child)throw Error(pt(153));if(r.child!==null){for(t=r.child,a=hl(t,t.pendingProps),r.child=a,a.return=r;t.sibling!==null;)t=t.sibling,a=a.sibling=hl(t,t.pendingProps),a.return=r;a.sibling=null}return r.child}function K3(t,r,a){switch(r.tag){case 3:QI(r),eh();break;case 5:CI(r);break;case 1:qi(r.type)&&V0(r);break;case 4:B1(r,r.stateNode.containerInfo);break;case 10:var c=r.type._context,f=r.memoizedProps.value;Zr(W0,c._currentValue),c._currentValue=f;break;case 13:if(c=r.memoizedState,c!==null)return c.dehydrated!==null?(Zr(gn,gn.current&1),r.flags|=128,null):a&r.child.childLanes?ek(t,r,a):(Zr(gn,gn.current&1),t=fa(t,r,a),t!==null?t.sibling:null);Zr(gn,gn.current&1);break;case 19:if(c=(a&r.childLanes)!==0,t.flags&128){if(c)return tk(t,r,a);r.flags|=128}if(f=r.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),Zr(gn,gn.current),c)break;return null;case 22:case 23:return r.lanes=0,YI(t,r,a)}return fa(t,r,a)}var rk,Uv,nk,ik;rk=function(t,r){for(var a=r.child;a!==null;){if(a.tag===5||a.tag===6)t.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};Uv=function(){};nk=function(t,r,a,c){var f=t.memoizedProps;if(f!==c){t=r.stateNode,fc(Bs.current);var _=null;switch(a){case"input":f=lv(t,f),c=lv(t,c),_=[];break;case"select":f=yn({},f,{value:void 0}),c=yn({},c,{value:void 0}),_=[];break;case"textarea":f=hv(t,f),c=hv(t,c),_=[];break;default:typeof f.onClick!="function"&&typeof c.onClick=="function"&&(t.onclick=N0)}pv(a,c);var b;a=null;for(C in f)if(!c.hasOwnProperty(C)&&f.hasOwnProperty(C)&&f[C]!=null)if(C==="style"){var s=f[C];for(b in s)s.hasOwnProperty(b)&&(a||(a={}),a[b]="")}else C!=="dangerouslySetInnerHTML"&&C!=="children"&&C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(wp.hasOwnProperty(C)?_||(_=[]):(_=_||[]).push(C,null));for(C in c){var S=c[C];if(s=f!=null?f[C]:void 0,c.hasOwnProperty(C)&&S!==s&&(S!=null||s!=null))if(C==="style")if(s){for(b in s)!s.hasOwnProperty(b)||S&&S.hasOwnProperty(b)||(a||(a={}),a[b]="");for(b in S)S.hasOwnProperty(b)&&s[b]!==S[b]&&(a||(a={}),a[b]=S[b])}else a||(_||(_=[]),_.push(C,a)),a=S;else C==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,s=s?s.__html:void 0,S!=null&&s!==S&&(_=_||[]).push(C,S)):C==="children"?typeof S!="string"&&typeof S!="number"||(_=_||[]).push(C,""+S):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&(wp.hasOwnProperty(C)?(S!=null&&C==="onScroll"&&Qr("scroll",t),_||s===S||(_=[])):(_=_||[]).push(C,S))}a&&(_=_||[]).push("style",a);var C=_;(r.updateQueue=C)&&(r.flags|=4)}};ik=function(t,r,a,c){a!==c&&(r.flags|=4)};function tp(t,r){if(!on)switch(t.tailMode){case"hidden":r=t.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?t.tail=null:a.sibling=null;break;case"collapsed":a=t.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?r||t.tail===null?t.tail=null:t.tail.sibling=null:c.sibling=null}}function yi(t){var r=t.alternate!==null&&t.alternate.child===t.child,a=0,c=0;if(r)for(var f=t.child;f!==null;)a|=f.lanes|f.childLanes,c|=f.subtreeFlags&14680064,c|=f.flags&14680064,f.return=t,f=f.sibling;else for(f=t.child;f!==null;)a|=f.lanes|f.childLanes,c|=f.subtreeFlags,c|=f.flags,f.return=t,f=f.sibling;return t.subtreeFlags|=c,t.childLanes=a,r}function Y3(t,r,a){var c=r.pendingProps;switch(I1(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yi(r),null;case 1:return qi(r.type)&&U0(),yi(r),null;case 3:return c=r.stateNode,rh(),en(Wi),en(wi),F1(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(t===null||t.child===null)&&(Om(r)?r.flags|=4:t===null||t.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,as!==null&&(Zv(as),as=null))),Uv(t,r),yi(r),null;case 5:L1(r);var f=fc(Rp.current);if(a=r.type,t!==null&&r.stateNode!=null)nk(t,r,a,c,f),t.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!c){if(r.stateNode===null)throw Error(pt(166));return yi(r),null}if(t=fc(Bs.current),Om(r)){c=r.stateNode,a=r.type;var _=r.memoizedProps;switch(c[Ms]=r,c[Dp]=_,t=(r.mode&1)!==0,a){case"dialog":Qr("cancel",c),Qr("close",c);break;case"iframe":case"object":case"embed":Qr("load",c);break;case"video":case"audio":for(f=0;f<up.length;f++)Qr(up[f],c);break;case"source":Qr("error",c);break;case"img":case"image":case"link":Qr("error",c),Qr("load",c);break;case"details":Qr("toggle",c);break;case"input":O2(c,_),Qr("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!_.multiple},Qr("invalid",c);break;case"textarea":U2(c,_),Qr("invalid",c)}pv(a,_),f=null;for(var b in _)if(_.hasOwnProperty(b)){var s=_[b];b==="children"?typeof s=="string"?c.textContent!==s&&(_.suppressHydrationWarning!==!0&&Fm(c.textContent,s,t),f=["children",s]):typeof s=="number"&&c.textContent!==""+s&&(_.suppressHydrationWarning!==!0&&Fm(c.textContent,s,t),f=["children",""+s]):wp.hasOwnProperty(b)&&s!=null&&b==="onScroll"&&Qr("scroll",c)}switch(a){case"input":km(c),N2(c,_,!0);break;case"textarea":km(c),V2(c);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(c.onclick=N0)}c=f,r.updateQueue=c,c!==null&&(r.flags|=4)}else{b=f.nodeType===9?f:f.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=DC(a)),t==="http://www.w3.org/1999/xhtml"?a==="script"?(t=b.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof c.is=="string"?t=b.createElement(a,{is:c.is}):(t=b.createElement(a),a==="select"&&(b=t,c.multiple?b.multiple=!0:c.size&&(b.size=c.size))):t=b.createElementNS(t,a),t[Ms]=r,t[Dp]=c,rk(t,r,!1,!1),r.stateNode=t;e:{switch(b=fv(a,c),a){case"dialog":Qr("cancel",t),Qr("close",t),f=c;break;case"iframe":case"object":case"embed":Qr("load",t),f=c;break;case"video":case"audio":for(f=0;f<up.length;f++)Qr(up[f],t);f=c;break;case"source":Qr("error",t),f=c;break;case"img":case"image":case"link":Qr("error",t),Qr("load",t),f=c;break;case"details":Qr("toggle",t),f=c;break;case"input":O2(t,c),f=lv(t,c),Qr("invalid",t);break;case"option":f=c;break;case"select":t._wrapperState={wasMultiple:!!c.multiple},f=yn({},c,{value:void 0}),Qr("invalid",t);break;case"textarea":U2(t,c),f=hv(t,c),Qr("invalid",t);break;default:f=c}pv(a,f),s=f;for(_ in s)if(s.hasOwnProperty(_)){var S=s[_];_==="style"?BC(t,S):_==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,S!=null&&MC(t,S)):_==="children"?typeof S=="string"?(a!=="textarea"||S!=="")&&Ep(t,S):typeof S=="number"&&Ep(t,""+S):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(wp.hasOwnProperty(_)?S!=null&&_==="onScroll"&&Qr("scroll",t):S!=null&&p1(t,_,S,b))}switch(a){case"input":km(t),N2(t,c,!1);break;case"textarea":km(t),V2(t);break;case"option":c.value!=null&&t.setAttribute("value",""+dl(c.value));break;case"select":t.multiple=!!c.multiple,_=c.value,_!=null?Wu(t,!!c.multiple,_,!1):c.defaultValue!=null&&Wu(t,!!c.multiple,c.defaultValue,!0);break;default:typeof f.onClick=="function"&&(t.onclick=N0)}switch(a){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return yi(r),null;case 6:if(t&&r.stateNode!=null)ik(t,r,t.memoizedProps,c);else{if(typeof c!="string"&&r.stateNode===null)throw Error(pt(166));if(a=fc(Rp.current),fc(Bs.current),Om(r)){if(c=r.stateNode,a=r.memoizedProps,c[Ms]=r,(_=c.nodeValue!==a)&&(t=lo,t!==null))switch(t.tag){case 3:Fm(c.nodeValue,a,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Fm(c.nodeValue,a,(t.mode&1)!==0)}_&&(r.flags|=4)}else c=(a.nodeType===9?a:a.ownerDocument).createTextNode(c),c[Ms]=r,r.stateNode=c}return yi(r),null;case 13:if(en(gn),c=r.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(on&&ao!==null&&r.mode&1&&!(r.flags&128))wI(),eh(),r.flags|=98560,_=!1;else if(_=Om(r),c!==null&&c.dehydrated!==null){if(t===null){if(!_)throw Error(pt(318));if(_=r.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(pt(317));_[Ms]=r}else eh(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;yi(r),_=!1}else as!==null&&(Zv(as),as=null),_=!0;if(!_)return r.flags&65536?r:null}return r.flags&128?(r.lanes=a,r):(c=c!==null,c!==(t!==null&&t.memoizedState!==null)&&c&&(r.child.flags|=8192,r.mode&1&&(t===null||gn.current&1?Wn===0&&(Wn=3):X1())),r.updateQueue!==null&&(r.flags|=4),yi(r),null);case 4:return rh(),Uv(t,r),t===null&&Pp(r.stateNode.containerInfo),yi(r),null;case 10:return D1(r.type._context),yi(r),null;case 17:return qi(r.type)&&U0(),yi(r),null;case 19:if(en(gn),_=r.memoizedState,_===null)return yi(r),null;if(c=(r.flags&128)!==0,b=_.rendering,b===null)if(c)tp(_,!1);else{if(Wn!==0||t!==null&&t.flags&128)for(t=r.child;t!==null;){if(b=H0(t),b!==null){for(r.flags|=128,tp(_,!1),c=b.updateQueue,c!==null&&(r.updateQueue=c,r.flags|=4),r.subtreeFlags=0,c=a,a=r.child;a!==null;)_=a,t=c,_.flags&=14680066,b=_.alternate,b===null?(_.childLanes=0,_.lanes=t,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=b.childLanes,_.lanes=b.lanes,_.child=b.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=b.memoizedProps,_.memoizedState=b.memoizedState,_.updateQueue=b.updateQueue,_.type=b.type,t=b.dependencies,_.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),a=a.sibling;return Zr(gn,gn.current&1|2),r.child}t=t.sibling}_.tail!==null&&Sn()>ih&&(r.flags|=128,c=!0,tp(_,!1),r.lanes=4194304)}else{if(!c)if(t=H0(b),t!==null){if(r.flags|=128,c=!0,a=t.updateQueue,a!==null&&(r.updateQueue=a,r.flags|=4),tp(_,!0),_.tail===null&&_.tailMode==="hidden"&&!b.alternate&&!on)return yi(r),null}else 2*Sn()-_.renderingStartTime>ih&&a!==1073741824&&(r.flags|=128,c=!0,tp(_,!1),r.lanes=4194304);_.isBackwards?(b.sibling=r.child,r.child=b):(a=_.last,a!==null?a.sibling=b:r.child=b,_.last=b)}return _.tail!==null?(r=_.tail,_.rendering=r,_.tail=r.sibling,_.renderingStartTime=Sn(),r.sibling=null,a=gn.current,Zr(gn,c?a&1|2:a&1),r):(yi(r),null);case 22:case 23:return Z1(),c=r.memoizedState!==null,t!==null&&t.memoizedState!==null!==c&&(r.flags|=8192),c&&r.mode&1?so&1073741824&&(yi(r),r.subtreeFlags&6&&(r.flags|=8192)):yi(r),null;case 24:return null;case 25:return null}throw Error(pt(156,r.tag))}function J3(t,r){switch(I1(r),r.tag){case 1:return qi(r.type)&&U0(),t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 3:return rh(),en(Wi),en(wi),F1(),t=r.flags,t&65536&&!(t&128)?(r.flags=t&-65537|128,r):null;case 5:return L1(r),null;case 13:if(en(gn),t=r.memoizedState,t!==null&&t.dehydrated!==null){if(r.alternate===null)throw Error(pt(340));eh()}return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 19:return en(gn),null;case 4:return rh(),null;case 10:return D1(r.type._context),null;case 22:case 23:return Z1(),null;case 24:return null;default:return null}}var Vm=!1,vi=!1,Q3=typeof WeakSet=="function"?WeakSet:Set,Dt=null;function Uu(t,r){var a=t.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(c){wn(t,r,c)}else a.current=null}function Vv(t,r,a){try{a()}catch(c){wn(t,r,c)}}var PS=!1;function e5(t,r){if(Sv=L0,t=cI(),T1(t)){if("selectionStart"in t)var a={start:t.selectionStart,end:t.selectionEnd};else e:{a=(a=t.ownerDocument)&&a.defaultView||window;var c=a.getSelection&&a.getSelection();if(c&&c.rangeCount!==0){a=c.anchorNode;var f=c.anchorOffset,_=c.focusNode;c=c.focusOffset;try{a.nodeType,_.nodeType}catch{a=null;break e}var b=0,s=-1,S=-1,C=0,k=0,M=t,L=null;t:for(;;){for(var V;M!==a||f!==0&&M.nodeType!==3||(s=b+f),M!==_||c!==0&&M.nodeType!==3||(S=b+c),M.nodeType===3&&(b+=M.nodeValue.length),(V=M.firstChild)!==null;)L=M,M=V;for(;;){if(M===t)break t;if(L===a&&++C===f&&(s=b),L===_&&++k===c&&(S=b),(V=M.nextSibling)!==null)break;M=L,L=M.parentNode}M=V}a=s===-1||S===-1?null:{start:s,end:S}}else a=null}a=a||{start:0,end:0}}else a=null;for(Av={focusedElem:t,selectionRange:a},L0=!1,Dt=r;Dt!==null;)if(r=Dt,t=r.child,(r.subtreeFlags&1028)!==0&&t!==null)t.return=r,Dt=t;else for(;Dt!==null;){r=Dt;try{var O=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(O!==null){var j=O.memoizedProps,H=O.memoizedState,Z=r.stateNode,U=Z.getSnapshotBeforeUpdate(r.elementType===r.type?j:os(r.type,j),H);Z.__reactInternalSnapshotBeforeUpdate=U}break;case 3:var $=r.stateNode.containerInfo;$.nodeType===1?$.textContent="":$.nodeType===9&&$.documentElement&&$.removeChild($.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(pt(163))}}catch(J){wn(r,r.return,J)}if(t=r.sibling,t!==null){t.return=r.return,Dt=t;break}Dt=r.return}return O=PS,PS=!1,O}function yp(t,r,a){var c=r.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var f=c=c.next;do{if((f.tag&t)===t){var _=f.destroy;f.destroy=void 0,_!==void 0&&Vv(r,a,_)}f=f.next}while(f!==c)}}function bg(t,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&t)===t){var c=a.create;a.destroy=c()}a=a.next}while(a!==r)}}function jv(t){var r=t.ref;if(r!==null){var a=t.stateNode;switch(t.tag){case 5:t=a;break;default:t=a}typeof r=="function"?r(t):r.current=t}}function ok(t){var r=t.alternate;r!==null&&(t.alternate=null,ok(r)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(r=t.stateNode,r!==null&&(delete r[Ms],delete r[Dp],delete r[Iv],delete r[L3],delete r[F3])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function sk(t){return t.tag===5||t.tag===3||t.tag===4}function zS(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||sk(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function $v(t,r,a){var c=t.tag;if(c===5||c===6)t=t.stateNode,r?a.nodeType===8?a.parentNode.insertBefore(t,r):a.insertBefore(t,r):(a.nodeType===8?(r=a.parentNode,r.insertBefore(t,a)):(r=a,r.appendChild(t)),a=a._reactRootContainer,a!=null||r.onclick!==null||(r.onclick=N0));else if(c!==4&&(t=t.child,t!==null))for($v(t,r,a),t=t.sibling;t!==null;)$v(t,r,a),t=t.sibling}function Wv(t,r,a){var c=t.tag;if(c===5||c===6)t=t.stateNode,r?a.insertBefore(t,r):a.appendChild(t);else if(c!==4&&(t=t.child,t!==null))for(Wv(t,r,a),t=t.sibling;t!==null;)Wv(t,r,a),t=t.sibling}var oi=null,ss=!1;function Ga(t,r,a){for(a=a.child;a!==null;)ak(t,r,a),a=a.sibling}function ak(t,r,a){if(Rs&&typeof Rs.onCommitFiberUnmount=="function")try{Rs.onCommitFiberUnmount(pg,a)}catch{}switch(a.tag){case 5:vi||Uu(a,r);case 6:var c=oi,f=ss;oi=null,Ga(t,r,a),oi=c,ss=f,oi!==null&&(ss?(t=oi,a=a.stateNode,t.nodeType===8?t.parentNode.removeChild(a):t.removeChild(a)):oi.removeChild(a.stateNode));break;case 18:oi!==null&&(ss?(t=oi,a=a.stateNode,t.nodeType===8?Gy(t.parentNode,a):t.nodeType===1&&Gy(t,a),Cp(t)):Gy(oi,a.stateNode));break;case 4:c=oi,f=ss,oi=a.stateNode.containerInfo,ss=!0,Ga(t,r,a),oi=c,ss=f;break;case 0:case 11:case 14:case 15:if(!vi&&(c=a.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){f=c=c.next;do{var _=f,b=_.destroy;_=_.tag,b!==void 0&&(_&2||_&4)&&Vv(a,r,b),f=f.next}while(f!==c)}Ga(t,r,a);break;case 1:if(!vi&&(Uu(a,r),c=a.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=a.memoizedProps,c.state=a.memoizedState,c.componentWillUnmount()}catch(s){wn(a,r,s)}Ga(t,r,a);break;case 21:Ga(t,r,a);break;case 22:a.mode&1?(vi=(c=vi)||a.memoizedState!==null,Ga(t,r,a),vi=c):Ga(t,r,a);break;default:Ga(t,r,a)}}function DS(t){var r=t.updateQueue;if(r!==null){t.updateQueue=null;var a=t.stateNode;a===null&&(a=t.stateNode=new Q3),r.forEach(function(c){var f=c5.bind(null,t,c);a.has(c)||(a.add(c),c.then(f,f))})}}function is(t,r){var a=r.deletions;if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];try{var _=t,b=r,s=b;e:for(;s!==null;){switch(s.tag){case 5:oi=s.stateNode,ss=!1;break e;case 3:oi=s.stateNode.containerInfo,ss=!0;break e;case 4:oi=s.stateNode.containerInfo,ss=!0;break e}s=s.return}if(oi===null)throw Error(pt(160));ak(_,b,f),oi=null,ss=!1;var S=f.alternate;S!==null&&(S.return=null),f.return=null}catch(C){wn(f,r,C)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)lk(r,t),r=r.sibling}function lk(t,r){var a=t.alternate,c=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(is(r,t),Cs(t),c&4){try{yp(3,t,t.return),bg(3,t)}catch(j){wn(t,t.return,j)}try{yp(5,t,t.return)}catch(j){wn(t,t.return,j)}}break;case 1:is(r,t),Cs(t),c&512&&a!==null&&Uu(a,a.return);break;case 5:if(is(r,t),Cs(t),c&512&&a!==null&&Uu(a,a.return),t.flags&32){var f=t.stateNode;try{Ep(f,"")}catch(j){wn(t,t.return,j)}}if(c&4&&(f=t.stateNode,f!=null)){var _=t.memoizedProps,b=a!==null?a.memoizedProps:_,s=t.type,S=t.updateQueue;if(t.updateQueue=null,S!==null)try{s==="input"&&_.type==="radio"&&_.name!=null&&PC(f,_),fv(s,b);var C=fv(s,_);for(b=0;b<S.length;b+=2){var k=S[b],M=S[b+1];k==="style"?BC(f,M):k==="dangerouslySetInnerHTML"?MC(f,M):k==="children"?Ep(f,M):p1(f,k,M,C)}switch(s){case"input":cv(f,_);break;case"textarea":zC(f,_);break;case"select":var L=f._wrapperState.wasMultiple;f._wrapperState.wasMultiple=!!_.multiple;var V=_.value;V!=null?Wu(f,!!_.multiple,V,!1):L!==!!_.multiple&&(_.defaultValue!=null?Wu(f,!!_.multiple,_.defaultValue,!0):Wu(f,!!_.multiple,_.multiple?[]:"",!1))}f[Dp]=_}catch(j){wn(t,t.return,j)}}break;case 6:if(is(r,t),Cs(t),c&4){if(t.stateNode===null)throw Error(pt(162));f=t.stateNode,_=t.memoizedProps;try{f.nodeValue=_}catch(j){wn(t,t.return,j)}}break;case 3:if(is(r,t),Cs(t),c&4&&a!==null&&a.memoizedState.isDehydrated)try{Cp(r.containerInfo)}catch(j){wn(t,t.return,j)}break;case 4:is(r,t),Cs(t);break;case 13:is(r,t),Cs(t),f=t.child,f.flags&8192&&(_=f.memoizedState!==null,f.stateNode.isHidden=_,!_||f.alternate!==null&&f.alternate.memoizedState!==null||(G1=Sn())),c&4&&DS(t);break;case 22:if(k=a!==null&&a.memoizedState!==null,t.mode&1?(vi=(C=vi)||k,is(r,t),vi=C):is(r,t),Cs(t),c&8192){if(C=t.memoizedState!==null,(t.stateNode.isHidden=C)&&!k&&t.mode&1)for(Dt=t,k=t.child;k!==null;){for(M=Dt=k;Dt!==null;){switch(L=Dt,V=L.child,L.tag){case 0:case 11:case 14:case 15:yp(4,L,L.return);break;case 1:Uu(L,L.return);var O=L.stateNode;if(typeof O.componentWillUnmount=="function"){c=L,a=L.return;try{r=c,O.props=r.memoizedProps,O.state=r.memoizedState,O.componentWillUnmount()}catch(j){wn(c,a,j)}}break;case 5:Uu(L,L.return);break;case 22:if(L.memoizedState!==null){RS(M);continue}}V!==null?(V.return=L,Dt=V):RS(M)}k=k.sibling}e:for(k=null,M=t;;){if(M.tag===5){if(k===null){k=M;try{f=M.stateNode,C?(_=f.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(s=M.stateNode,S=M.memoizedProps.style,b=S!=null&&S.hasOwnProperty("display")?S.display:null,s.style.display=RC("display",b))}catch(j){wn(t,t.return,j)}}}else if(M.tag===6){if(k===null)try{M.stateNode.nodeValue=C?"":M.memoizedProps}catch(j){wn(t,t.return,j)}}else if((M.tag!==22&&M.tag!==23||M.memoizedState===null||M===t)&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===t)break e;for(;M.sibling===null;){if(M.return===null||M.return===t)break e;k===M&&(k=null),M=M.return}k===M&&(k=null),M.sibling.return=M.return,M=M.sibling}}break;case 19:is(r,t),Cs(t),c&4&&DS(t);break;case 21:break;default:is(r,t),Cs(t)}}function Cs(t){var r=t.flags;if(r&2){try{e:{for(var a=t.return;a!==null;){if(sk(a)){var c=a;break e}a=a.return}throw Error(pt(160))}switch(c.tag){case 5:var f=c.stateNode;c.flags&32&&(Ep(f,""),c.flags&=-33);var _=zS(t);Wv(t,_,f);break;case 3:case 4:var b=c.stateNode.containerInfo,s=zS(t);$v(t,s,b);break;default:throw Error(pt(161))}}catch(S){wn(t,t.return,S)}t.flags&=-3}r&4096&&(t.flags&=-4097)}function t5(t,r,a){Dt=t,ck(t)}function ck(t,r,a){for(var c=(t.mode&1)!==0;Dt!==null;){var f=Dt,_=f.child;if(f.tag===22&&c){var b=f.memoizedState!==null||Vm;if(!b){var s=f.alternate,S=s!==null&&s.memoizedState!==null||vi;s=Vm;var C=vi;if(Vm=b,(vi=S)&&!C)for(Dt=f;Dt!==null;)b=Dt,S=b.child,b.tag===22&&b.memoizedState!==null?BS(f):S!==null?(S.return=b,Dt=S):BS(f);for(;_!==null;)Dt=_,ck(_),_=_.sibling;Dt=f,Vm=s,vi=C}MS(t)}else f.subtreeFlags&8772&&_!==null?(_.return=f,Dt=_):MS(t)}}function MS(t){for(;Dt!==null;){var r=Dt;if(r.flags&8772){var a=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:vi||bg(5,r);break;case 1:var c=r.stateNode;if(r.flags&4&&!vi)if(a===null)c.componentDidMount();else{var f=r.elementType===r.type?a.memoizedProps:os(r.type,a.memoizedProps);c.componentDidUpdate(f,a.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var _=r.updateQueue;_!==null&&_S(r,_,c);break;case 3:var b=r.updateQueue;if(b!==null){if(a=null,r.child!==null)switch(r.child.tag){case 5:a=r.child.stateNode;break;case 1:a=r.child.stateNode}_S(r,b,a)}break;case 5:var s=r.stateNode;if(a===null&&r.flags&4){a=s;var S=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":S.autoFocus&&a.focus();break;case"img":S.src&&(a.src=S.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var C=r.alternate;if(C!==null){var k=C.memoizedState;if(k!==null){var M=k.dehydrated;M!==null&&Cp(M)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(pt(163))}vi||r.flags&512&&jv(r)}catch(L){wn(r,r.return,L)}}if(r===t){Dt=null;break}if(a=r.sibling,a!==null){a.return=r.return,Dt=a;break}Dt=r.return}}function RS(t){for(;Dt!==null;){var r=Dt;if(r===t){Dt=null;break}var a=r.sibling;if(a!==null){a.return=r.return,Dt=a;break}Dt=r.return}}function BS(t){for(;Dt!==null;){var r=Dt;try{switch(r.tag){case 0:case 11:case 15:var a=r.return;try{bg(4,r)}catch(S){wn(r,a,S)}break;case 1:var c=r.stateNode;if(typeof c.componentDidMount=="function"){var f=r.return;try{c.componentDidMount()}catch(S){wn(r,f,S)}}var _=r.return;try{jv(r)}catch(S){wn(r,_,S)}break;case 5:var b=r.return;try{jv(r)}catch(S){wn(r,b,S)}}}catch(S){wn(r,r.return,S)}if(r===t){Dt=null;break}var s=r.sibling;if(s!==null){s.return=r.return,Dt=s;break}Dt=r.return}}var r5=Math.ceil,K0=ma.ReactCurrentDispatcher,W1=ma.ReactCurrentOwner,Do=ma.ReactCurrentBatchConfig,br=0,Jn=null,Bn=null,si=0,so=0,Vu=_l(0),Wn=0,Op=null,bc=0,wg=0,q1=0,xp=null,ji=null,G1=0,ih=1/0,ia=null,Y0=!1,qv=null,cl=null,jm=!1,nl=null,J0=0,vp=0,Gv=null,v0=-1,b0=0;function ki(){return br&6?Sn():v0!==-1?v0:v0=Sn()}function ul(t){return t.mode&1?br&2&&si!==0?si&-si:N3.transition!==null?(b0===0&&(b0=HC()),b0):(t=Fr,t!==0||(t=window.event,t=t===void 0?16:eI(t.type)),t):1}function cs(t,r,a,c){if(50<vp)throw vp=0,Gv=null,Error(pt(185));qp(t,a,c),(!(br&2)||t!==Jn)&&(t===Jn&&(!(br&2)&&(wg|=a),Wn===4&&tl(t,si)),Gi(t,c),a===1&&br===0&&!(r.mode&1)&&(ih=Sn()+500,yg&&yl()))}function Gi(t,r){var a=t.callbackNode;NM(t,r);var c=B0(t,t===Jn?si:0);if(c===0)a!==null&&W2(a),t.callbackNode=null,t.callbackPriority=0;else if(r=c&-c,t.callbackPriority!==r){if(a!=null&&W2(a),r===1)t.tag===0?O3(LS.bind(null,t)):xI(LS.bind(null,t)),R3(function(){!(br&6)&&yl()}),a=null;else{switch(ZC(c)){case 1:a=y1;break;case 4:a=qC;break;case 16:a=R0;break;case 536870912:a=GC;break;default:a=R0}a=_k(a,uk.bind(null,t))}t.callbackPriority=r,t.callbackNode=a}}function uk(t,r){if(v0=-1,b0=0,br&6)throw Error(pt(327));var a=t.callbackNode;if(Xu()&&t.callbackNode!==a)return null;var c=B0(t,t===Jn?si:0);if(c===0)return null;if(c&30||c&t.expiredLanes||r)r=Q0(t,c);else{r=c;var f=br;br|=2;var _=dk();(Jn!==t||si!==r)&&(ia=null,ih=Sn()+500,gc(t,r));do try{o5();break}catch(s){hk(t,s)}while(1);z1(),K0.current=_,br=f,Bn!==null?r=0:(Jn=null,si=0,r=Wn)}if(r!==0){if(r===2&&(f=xv(t),f!==0&&(c=f,r=Hv(t,f))),r===1)throw a=Op,gc(t,0),tl(t,c),Gi(t,Sn()),a;if(r===6)tl(t,c);else{if(f=t.current.alternate,!(c&30)&&!n5(f)&&(r=Q0(t,c),r===2&&(_=xv(t),_!==0&&(c=_,r=Hv(t,_))),r===1))throw a=Op,gc(t,0),tl(t,c),Gi(t,Sn()),a;switch(t.finishedWork=f,t.finishedLanes=c,r){case 0:case 1:throw Error(pt(345));case 2:uc(t,ji,ia);break;case 3:if(tl(t,c),(c&130023424)===c&&(r=G1+500-Sn(),10<r)){if(B0(t,0)!==0)break;if(f=t.suspendedLanes,(f&c)!==c){ki(),t.pingedLanes|=t.suspendedLanes&f;break}t.timeoutHandle=Cv(uc.bind(null,t,ji,ia),r);break}uc(t,ji,ia);break;case 4:if(tl(t,c),(c&4194240)===c)break;for(r=t.eventTimes,f=-1;0<c;){var b=31-ls(c);_=1<<b,b=r[b],b>f&&(f=b),c&=~_}if(c=f,c=Sn()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*r5(c/1960))-c,10<c){t.timeoutHandle=Cv(uc.bind(null,t,ji,ia),c);break}uc(t,ji,ia);break;case 5:uc(t,ji,ia);break;default:throw Error(pt(329))}}}return Gi(t,Sn()),t.callbackNode===a?uk.bind(null,t):null}function Hv(t,r){var a=xp;return t.current.memoizedState.isDehydrated&&(gc(t,r).flags|=256),t=Q0(t,r),t!==2&&(r=ji,ji=a,r!==null&&Zv(r)),t}function Zv(t){ji===null?ji=t:ji.push.apply(ji,t)}function n5(t){for(var r=t;;){if(r.flags&16384){var a=r.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var c=0;c<a.length;c++){var f=a[c],_=f.getSnapshot;f=f.value;try{if(!ds(_(),f))return!1}catch{return!1}}}if(a=r.child,r.subtreeFlags&16384&&a!==null)a.return=r,r=a;else{if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function tl(t,r){for(r&=~q1,r&=~wg,t.suspendedLanes|=r,t.pingedLanes&=~r,t=t.expirationTimes;0<r;){var a=31-ls(r),c=1<<a;t[a]=-1,r&=~c}}function LS(t){if(br&6)throw Error(pt(327));Xu();var r=B0(t,0);if(!(r&1))return Gi(t,Sn()),null;var a=Q0(t,r);if(t.tag!==0&&a===2){var c=xv(t);c!==0&&(r=c,a=Hv(t,c))}if(a===1)throw a=Op,gc(t,0),tl(t,r),Gi(t,Sn()),a;if(a===6)throw Error(pt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=r,uc(t,ji,ia),Gi(t,Sn()),null}function H1(t,r){var a=br;br|=1;try{return t(r)}finally{br=a,br===0&&(ih=Sn()+500,yg&&yl())}}function wc(t){nl!==null&&nl.tag===0&&!(br&6)&&Xu();var r=br;br|=1;var a=Do.transition,c=Fr;try{if(Do.transition=null,Fr=1,t)return t()}finally{Fr=c,Do.transition=a,br=r,!(br&6)&&yl()}}function Z1(){so=Vu.current,en(Vu)}function gc(t,r){t.finishedWork=null,t.finishedLanes=0;var a=t.timeoutHandle;if(a!==-1&&(t.timeoutHandle=-1,M3(a)),Bn!==null)for(a=Bn.return;a!==null;){var c=a;switch(I1(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&U0();break;case 3:rh(),en(Wi),en(wi),F1();break;case 5:L1(c);break;case 4:rh();break;case 13:en(gn);break;case 19:en(gn);break;case 10:D1(c.type._context);break;case 22:case 23:Z1()}a=a.return}if(Jn=t,Bn=t=hl(t.current,null),si=so=r,Wn=0,Op=null,q1=wg=bc=0,ji=xp=null,pc!==null){for(r=0;r<pc.length;r++)if(a=pc[r],c=a.interleaved,c!==null){a.interleaved=null;var f=c.next,_=a.pending;if(_!==null){var b=_.next;_.next=f,c.next=b}a.pending=c}pc=null}return t}function hk(t,r){do{var a=Bn;try{if(z1(),_0.current=X0,Z0){for(var c=_n.memoizedState;c!==null;){var f=c.queue;f!==null&&(f.pending=null),c=c.next}Z0=!1}if(vc=0,Yn=$n=_n=null,_p=!1,Bp=0,W1.current=null,a===null||a.return===null){Wn=1,Op=r,Bn=null;break}e:{var _=t,b=a.return,s=a,S=r;if(r=si,s.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){var C=S,k=s,M=k.tag;if(!(k.mode&1)&&(M===0||M===11||M===15)){var L=k.alternate;L?(k.updateQueue=L.updateQueue,k.memoizedState=L.memoizedState,k.lanes=L.lanes):(k.updateQueue=null,k.memoizedState=null)}var V=ES(b);if(V!==null){V.flags&=-257,SS(V,b,s,_,r),V.mode&1&&wS(_,C,r),r=V,S=C;var O=r.updateQueue;if(O===null){var j=new Set;j.add(S),r.updateQueue=j}else O.add(S);break e}else{if(!(r&1)){wS(_,C,r),X1();break e}S=Error(pt(426))}}else if(on&&s.mode&1){var H=ES(b);if(H!==null){!(H.flags&65536)&&(H.flags|=256),SS(H,b,s,_,r),k1(nh(S,s));break e}}_=S=nh(S,s),Wn!==4&&(Wn=2),xp===null?xp=[_]:xp.push(_),_=b;do{switch(_.tag){case 3:_.flags|=65536,r&=-r,_.lanes|=r;var Z=ZI(_,S,r);gS(_,Z);break e;case 1:s=S;var U=_.type,$=_.stateNode;if(!(_.flags&128)&&(typeof U.getDerivedStateFromError=="function"||$!==null&&typeof $.componentDidCatch=="function"&&(cl===null||!cl.has($)))){_.flags|=65536,r&=-r,_.lanes|=r;var J=XI(_,s,r);gS(_,J);break e}}_=_.return}while(_!==null)}fk(a)}catch(le){r=le,Bn===a&&a!==null&&(Bn=a=a.return);continue}break}while(1)}function dk(){var t=K0.current;return K0.current=X0,t===null?X0:t}function X1(){(Wn===0||Wn===3||Wn===2)&&(Wn=4),Jn===null||!(bc&268435455)&&!(wg&268435455)||tl(Jn,si)}function Q0(t,r){var a=br;br|=2;var c=dk();(Jn!==t||si!==r)&&(ia=null,gc(t,r));do try{i5();break}catch(f){hk(t,f)}while(1);if(z1(),br=a,K0.current=c,Bn!==null)throw Error(pt(261));return Jn=null,si=0,Wn}function i5(){for(;Bn!==null;)pk(Bn)}function o5(){for(;Bn!==null&&!PM();)pk(Bn)}function pk(t){var r=gk(t.alternate,t,so);t.memoizedProps=t.pendingProps,r===null?fk(t):Bn=r,W1.current=null}function fk(t){var r=t;do{var a=r.alternate;if(t=r.return,r.flags&32768){if(a=J3(a,r),a!==null){a.flags&=32767,Bn=a;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Wn=6,Bn=null;return}}else if(a=Y3(a,r,so),a!==null){Bn=a;return}if(r=r.sibling,r!==null){Bn=r;return}Bn=r=t}while(r!==null);Wn===0&&(Wn=5)}function uc(t,r,a){var c=Fr,f=Do.transition;try{Do.transition=null,Fr=1,s5(t,r,a,c)}finally{Do.transition=f,Fr=c}return null}function s5(t,r,a,c){do Xu();while(nl!==null);if(br&6)throw Error(pt(327));a=t.finishedWork;var f=t.finishedLanes;if(a===null)return null;if(t.finishedWork=null,t.finishedLanes=0,a===t.current)throw Error(pt(177));t.callbackNode=null,t.callbackPriority=0;var _=a.lanes|a.childLanes;if(UM(t,_),t===Jn&&(Bn=Jn=null,si=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||jm||(jm=!0,_k(R0,function(){return Xu(),null})),_=(a.flags&15990)!==0,a.subtreeFlags&15990||_){_=Do.transition,Do.transition=null;var b=Fr;Fr=1;var s=br;br|=4,W1.current=null,e5(t,a),lk(a,t),T3(Av),L0=!!Sv,Av=Sv=null,t.current=a,t5(a),zM(),br=s,Fr=b,Do.transition=_}else t.current=a;if(jm&&(jm=!1,nl=t,J0=f),_=t.pendingLanes,_===0&&(cl=null),RM(a.stateNode),Gi(t,Sn()),r!==null)for(c=t.onRecoverableError,a=0;a<r.length;a++)f=r[a],c(f.value,{componentStack:f.stack,digest:f.digest});if(Y0)throw Y0=!1,t=qv,qv=null,t;return J0&1&&t.tag!==0&&Xu(),_=t.pendingLanes,_&1?t===Gv?vp++:(vp=0,Gv=t):vp=0,yl(),null}function Xu(){if(nl!==null){var t=ZC(J0),r=Do.transition,a=Fr;try{if(Do.transition=null,Fr=16>t?16:t,nl===null)var c=!1;else{if(t=nl,nl=null,J0=0,br&6)throw Error(pt(331));var f=br;for(br|=4,Dt=t.current;Dt!==null;){var _=Dt,b=_.child;if(Dt.flags&16){var s=_.deletions;if(s!==null){for(var S=0;S<s.length;S++){var C=s[S];for(Dt=C;Dt!==null;){var k=Dt;switch(k.tag){case 0:case 11:case 15:yp(8,k,_)}var M=k.child;if(M!==null)M.return=k,Dt=M;else for(;Dt!==null;){k=Dt;var L=k.sibling,V=k.return;if(ok(k),k===C){Dt=null;break}if(L!==null){L.return=V,Dt=L;break}Dt=V}}}var O=_.alternate;if(O!==null){var j=O.child;if(j!==null){O.child=null;do{var H=j.sibling;j.sibling=null,j=H}while(j!==null)}}Dt=_}}if(_.subtreeFlags&2064&&b!==null)b.return=_,Dt=b;else e:for(;Dt!==null;){if(_=Dt,_.flags&2048)switch(_.tag){case 0:case 11:case 15:yp(9,_,_.return)}var Z=_.sibling;if(Z!==null){Z.return=_.return,Dt=Z;break e}Dt=_.return}}var U=t.current;for(Dt=U;Dt!==null;){b=Dt;var $=b.child;if(b.subtreeFlags&2064&&$!==null)$.return=b,Dt=$;else e:for(b=U;Dt!==null;){if(s=Dt,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:bg(9,s)}}catch(le){wn(s,s.return,le)}if(s===b){Dt=null;break e}var J=s.sibling;if(J!==null){J.return=s.return,Dt=J;break e}Dt=s.return}}if(br=f,yl(),Rs&&typeof Rs.onPostCommitFiberRoot=="function")try{Rs.onPostCommitFiberRoot(pg,t)}catch{}c=!0}return c}finally{Fr=a,Do.transition=r}}return!1}function FS(t,r,a){r=nh(a,r),r=ZI(t,r,1),t=ll(t,r,1),r=ki(),t!==null&&(qp(t,1,r),Gi(t,r))}function wn(t,r,a){if(t.tag===3)FS(t,t,a);else for(;r!==null;){if(r.tag===3){FS(r,t,a);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(cl===null||!cl.has(c))){t=nh(a,t),t=XI(r,t,1),r=ll(r,t,1),t=ki(),r!==null&&(qp(r,1,t),Gi(r,t));break}}r=r.return}}function a5(t,r,a){var c=t.pingCache;c!==null&&c.delete(r),r=ki(),t.pingedLanes|=t.suspendedLanes&a,Jn===t&&(si&a)===a&&(Wn===4||Wn===3&&(si&130023424)===si&&500>Sn()-G1?gc(t,0):q1|=a),Gi(t,r)}function mk(t,r){r===0&&(t.mode&1?(r=Dm,Dm<<=1,!(Dm&130023424)&&(Dm=4194304)):r=1);var a=ki();t=pa(t,r),t!==null&&(qp(t,r,a),Gi(t,a))}function l5(t){var r=t.memoizedState,a=0;r!==null&&(a=r.retryLane),mk(t,a)}function c5(t,r){var a=0;switch(t.tag){case 13:var c=t.stateNode,f=t.memoizedState;f!==null&&(a=f.retryLane);break;case 19:c=t.stateNode;break;default:throw Error(pt(314))}c!==null&&c.delete(r),mk(t,a)}var gk;gk=function(t,r,a){if(t!==null)if(t.memoizedProps!==r.pendingProps||Wi.current)$i=!0;else{if(!(t.lanes&a)&&!(r.flags&128))return $i=!1,K3(t,r,a);$i=!!(t.flags&131072)}else $i=!1,on&&r.flags&1048576&&vI(r,$0,r.index);switch(r.lanes=0,r.tag){case 2:var c=r.type;x0(t,r),t=r.pendingProps;var f=Qu(r,wi.current);Zu(r,a),f=N1(null,r,c,t,f,a);var _=U1();return r.flags|=1,typeof f=="object"&&f!==null&&typeof f.render=="function"&&f.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,qi(c)?(_=!0,V0(r)):_=!1,r.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,R1(r),f.updater=vg,r.stateNode=f,f._reactInternals=r,Rv(r,c,t,a),r=Fv(null,r,c,!0,_,a)):(r.tag=0,on&&_&&C1(r),Ii(null,r,f,a),r=r.child),r;case 16:c=r.elementType;e:{switch(x0(t,r),t=r.pendingProps,f=c._init,c=f(c._payload),r.type=c,f=r.tag=h5(c),t=os(c,t),f){case 0:r=Lv(null,r,c,t,a);break e;case 1:r=CS(null,r,c,t,a);break e;case 11:r=AS(null,r,c,t,a);break e;case 14:r=TS(null,r,c,os(c.type,t),a);break e}throw Error(pt(306,c,""))}return r;case 0:return c=r.type,f=r.pendingProps,f=r.elementType===c?f:os(c,f),Lv(t,r,c,f,a);case 1:return c=r.type,f=r.pendingProps,f=r.elementType===c?f:os(c,f),CS(t,r,c,f,a);case 3:e:{if(QI(r),t===null)throw Error(pt(387));c=r.pendingProps,_=r.memoizedState,f=_.element,TI(t,r),G0(r,c,null,a);var b=r.memoizedState;if(c=b.element,_.isDehydrated)if(_={element:c,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},r.updateQueue.baseState=_,r.memoizedState=_,r.flags&256){f=nh(Error(pt(423)),r),r=IS(t,r,c,a,f);break e}else if(c!==f){f=nh(Error(pt(424)),r),r=IS(t,r,c,a,f);break e}else for(ao=al(r.stateNode.containerInfo.firstChild),lo=r,on=!0,as=null,a=SI(r,null,c,a),r.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(eh(),c===f){r=fa(t,r,a);break e}Ii(t,r,c,a)}r=r.child}return r;case 5:return CI(r),t===null&&zv(r),c=r.type,f=r.pendingProps,_=t!==null?t.memoizedProps:null,b=f.children,Tv(c,f)?b=null:_!==null&&Tv(c,_)&&(r.flags|=32),JI(t,r),Ii(t,r,b,a),r.child;case 6:return t===null&&zv(r),null;case 13:return ek(t,r,a);case 4:return B1(r,r.stateNode.containerInfo),c=r.pendingProps,t===null?r.child=th(r,null,c,a):Ii(t,r,c,a),r.child;case 11:return c=r.type,f=r.pendingProps,f=r.elementType===c?f:os(c,f),AS(t,r,c,f,a);case 7:return Ii(t,r,r.pendingProps,a),r.child;case 8:return Ii(t,r,r.pendingProps.children,a),r.child;case 12:return Ii(t,r,r.pendingProps.children,a),r.child;case 10:e:{if(c=r.type._context,f=r.pendingProps,_=r.memoizedProps,b=f.value,Zr(W0,c._currentValue),c._currentValue=b,_!==null)if(ds(_.value,b)){if(_.children===f.children&&!Wi.current){r=fa(t,r,a);break e}}else for(_=r.child,_!==null&&(_.return=r);_!==null;){var s=_.dependencies;if(s!==null){b=_.child;for(var S=s.firstContext;S!==null;){if(S.context===c){if(_.tag===1){S=ua(-1,a&-a),S.tag=2;var C=_.updateQueue;if(C!==null){C=C.shared;var k=C.pending;k===null?S.next=S:(S.next=k.next,k.next=S),C.pending=S}}_.lanes|=a,S=_.alternate,S!==null&&(S.lanes|=a),Dv(_.return,a,r),s.lanes|=a;break}S=S.next}}else if(_.tag===10)b=_.type===r.type?null:_.child;else if(_.tag===18){if(b=_.return,b===null)throw Error(pt(341));b.lanes|=a,s=b.alternate,s!==null&&(s.lanes|=a),Dv(b,a,r),b=_.sibling}else b=_.child;if(b!==null)b.return=_;else for(b=_;b!==null;){if(b===r){b=null;break}if(_=b.sibling,_!==null){_.return=b.return,b=_;break}b=b.return}_=b}Ii(t,r,f.children,a),r=r.child}return r;case 9:return f=r.type,c=r.pendingProps.children,Zu(r,a),f=Mo(f),c=c(f),r.flags|=1,Ii(t,r,c,a),r.child;case 14:return c=r.type,f=os(c,r.pendingProps),f=os(c.type,f),TS(t,r,c,f,a);case 15:return KI(t,r,r.type,r.pendingProps,a);case 17:return c=r.type,f=r.pendingProps,f=r.elementType===c?f:os(c,f),x0(t,r),r.tag=1,qi(c)?(t=!0,V0(r)):t=!1,Zu(r,a),HI(r,c,f),Rv(r,c,f,a),Fv(null,r,c,!0,t,a);case 19:return tk(t,r,a);case 22:return YI(t,r,a)}throw Error(pt(156,r.tag))};function _k(t,r){return WC(t,r)}function u5(t,r,a,c){this.tag=t,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zo(t,r,a,c){return new u5(t,r,a,c)}function K1(t){return t=t.prototype,!(!t||!t.isReactComponent)}function h5(t){if(typeof t=="function")return K1(t)?1:0;if(t!=null){if(t=t.$$typeof,t===m1)return 11;if(t===g1)return 14}return 2}function hl(t,r){var a=t.alternate;return a===null?(a=zo(t.tag,r,t.key,t.mode),a.elementType=t.elementType,a.type=t.type,a.stateNode=t.stateNode,a.alternate=t,t.alternate=a):(a.pendingProps=r,a.type=t.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=t.flags&14680064,a.childLanes=t.childLanes,a.lanes=t.lanes,a.child=t.child,a.memoizedProps=t.memoizedProps,a.memoizedState=t.memoizedState,a.updateQueue=t.updateQueue,r=t.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},a.sibling=t.sibling,a.index=t.index,a.ref=t.ref,a}function w0(t,r,a,c,f,_){var b=2;if(c=t,typeof t=="function")K1(t)&&(b=1);else if(typeof t=="string")b=5;else e:switch(t){case zu:return _c(a.children,f,_,r);case f1:b=8,f|=8;break;case iv:return t=zo(12,a,r,f|2),t.elementType=iv,t.lanes=_,t;case ov:return t=zo(13,a,r,f),t.elementType=ov,t.lanes=_,t;case sv:return t=zo(19,a,r,f),t.elementType=sv,t.lanes=_,t;case CC:return Eg(a,f,_,r);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case AC:b=10;break e;case TC:b=9;break e;case m1:b=11;break e;case g1:b=14;break e;case Ja:b=16,c=null;break e}throw Error(pt(130,t==null?t:typeof t,""))}return r=zo(b,a,r,f),r.elementType=t,r.type=c,r.lanes=_,r}function _c(t,r,a,c){return t=zo(7,t,c,r),t.lanes=a,t}function Eg(t,r,a,c){return t=zo(22,t,c,r),t.elementType=CC,t.lanes=a,t.stateNode={isHidden:!1},t}function ex(t,r,a){return t=zo(6,t,null,r),t.lanes=a,t}function tx(t,r,a){return r=zo(4,t.children!==null?t.children:[],t.key,r),r.lanes=a,r.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},r}function d5(t,r,a,c,f){this.tag=r,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=By(0),this.expirationTimes=By(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=By(0),this.identifierPrefix=c,this.onRecoverableError=f,this.mutableSourceEagerHydrationData=null}function Y1(t,r,a,c,f,_,b,s,S){return t=new d5(t,r,a,s,S),r===1?(r=1,_===!0&&(r|=8)):r=0,_=zo(3,null,null,r),t.current=_,_.stateNode=t,_.memoizedState={element:c,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},R1(_),t}function p5(t,r,a){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pu,key:c==null?null:""+c,children:t,containerInfo:r,implementation:a}}function yk(t){if(!t)return pl;t=t._reactInternals;e:{if(Tc(t)!==t||t.tag!==1)throw Error(pt(170));var r=t;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(qi(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(pt(171))}if(t.tag===1){var a=t.type;if(qi(a))return yI(t,a,r)}return r}function xk(t,r,a,c,f,_,b,s,S){return t=Y1(a,c,!0,t,f,_,b,s,S),t.context=yk(null),a=t.current,c=ki(),f=ul(a),_=ua(c,f),_.callback=r??null,ll(a,_,f),t.current.lanes=f,qp(t,f,c),Gi(t,c),t}function Sg(t,r,a,c){var f=r.current,_=ki(),b=ul(f);return a=yk(a),r.context===null?r.context=a:r.pendingContext=a,r=ua(_,b),r.payload={element:t},c=c===void 0?null:c,c!==null&&(r.callback=c),t=ll(f,r,b),t!==null&&(cs(t,f,b,_),g0(t,f,b)),b}function eg(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function OS(t,r){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var a=t.retryLane;t.retryLane=a!==0&&a<r?a:r}}function J1(t,r){OS(t,r),(t=t.alternate)&&OS(t,r)}function f5(){return null}var vk=typeof reportError=="function"?reportError:function(t){console.error(t)};function Q1(t){this._internalRoot=t}Ag.prototype.render=Q1.prototype.render=function(t){var r=this._internalRoot;if(r===null)throw Error(pt(409));Sg(t,r,null,null)};Ag.prototype.unmount=Q1.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var r=t.containerInfo;wc(function(){Sg(null,t,null,null)}),r[da]=null}};function Ag(t){this._internalRoot=t}Ag.prototype.unstable_scheduleHydration=function(t){if(t){var r=YC();t={blockedOn:null,target:t,priority:r};for(var a=0;a<el.length&&r!==0&&r<el[a].priority;a++);el.splice(a,0,t),a===0&&QC(t)}};function eb(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Tg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function NS(){}function m5(t,r,a,c,f){if(f){if(typeof c=="function"){var _=c;c=function(){var C=eg(b);_.call(C)}}var b=xk(r,c,t,0,null,!1,!1,"",NS);return t._reactRootContainer=b,t[da]=b.current,Pp(t.nodeType===8?t.parentNode:t),wc(),b}for(;f=t.lastChild;)t.removeChild(f);if(typeof c=="function"){var s=c;c=function(){var C=eg(S);s.call(C)}}var S=Y1(t,0,!1,null,null,!1,!1,"",NS);return t._reactRootContainer=S,t[da]=S.current,Pp(t.nodeType===8?t.parentNode:t),wc(function(){Sg(r,S,a,c)}),S}function Cg(t,r,a,c,f){var _=a._reactRootContainer;if(_){var b=_;if(typeof f=="function"){var s=f;f=function(){var S=eg(b);s.call(S)}}Sg(r,b,t,f)}else b=m5(a,r,t,f,c);return eg(b)}XC=function(t){switch(t.tag){case 3:var r=t.stateNode;if(r.current.memoizedState.isDehydrated){var a=cp(r.pendingLanes);a!==0&&(x1(r,a|1),Gi(r,Sn()),!(br&6)&&(ih=Sn()+500,yl()))}break;case 13:wc(function(){var c=pa(t,1);if(c!==null){var f=ki();cs(c,t,1,f)}}),J1(t,1)}};v1=function(t){if(t.tag===13){var r=pa(t,134217728);if(r!==null){var a=ki();cs(r,t,134217728,a)}J1(t,134217728)}};KC=function(t){if(t.tag===13){var r=ul(t),a=pa(t,r);if(a!==null){var c=ki();cs(a,t,r,c)}J1(t,r)}};YC=function(){return Fr};JC=function(t,r){var a=Fr;try{return Fr=t,r()}finally{Fr=a}};gv=function(t,r,a){switch(r){case"input":if(cv(t,a),r=a.name,a.type==="radio"&&r!=null){for(a=t;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<a.length;r++){var c=a[r];if(c!==t&&c.form===t.form){var f=_g(c);if(!f)throw Error(pt(90));kC(c),cv(c,f)}}}break;case"textarea":zC(t,a);break;case"select":r=a.value,r!=null&&Wu(t,!!a.multiple,r,!1)}};OC=H1;NC=wc;var g5={usingClientEntryPoint:!1,Events:[Hp,Bu,_g,LC,FC,H1]},rp={findFiberByHostInstance:dc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},_5={bundleType:rp.bundleType,version:rp.version,rendererPackageName:rp.rendererPackageName,rendererConfig:rp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ma.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=jC(t),t===null?null:t.stateNode},findFiberByHostInstance:rp.findFiberByHostInstance||f5,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $m=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$m.isDisabled&&$m.supportsFiber)try{pg=$m.inject(_5),Rs=$m}catch{}}po.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=g5;po.createPortal=function(t,r){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!eb(r))throw Error(pt(200));return p5(t,r,null,a)};po.createRoot=function(t,r){if(!eb(t))throw Error(pt(299));var a=!1,c="",f=vk;return r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onRecoverableError!==void 0&&(f=r.onRecoverableError)),r=Y1(t,1,!1,null,null,a,!1,c,f),t[da]=r.current,Pp(t.nodeType===8?t.parentNode:t),new Q1(r)};po.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var r=t._reactInternals;if(r===void 0)throw typeof t.render=="function"?Error(pt(188)):(t=Object.keys(t).join(","),Error(pt(268,t)));return t=jC(r),t=t===null?null:t.stateNode,t};po.flushSync=function(t){return wc(t)};po.hydrate=function(t,r,a){if(!Tg(r))throw Error(pt(200));return Cg(null,t,r,!0,a)};po.hydrateRoot=function(t,r,a){if(!eb(t))throw Error(pt(405));var c=a!=null&&a.hydratedSources||null,f=!1,_="",b=vk;if(a!=null&&(a.unstable_strictMode===!0&&(f=!0),a.identifierPrefix!==void 0&&(_=a.identifierPrefix),a.onRecoverableError!==void 0&&(b=a.onRecoverableError)),r=xk(r,null,t,1,a??null,f,!1,_,b),t[da]=r.current,Pp(t),c)for(t=0;t<c.length;t++)a=c[t],f=a._getVersion,f=f(a._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[a,f]:r.mutableSourceEagerHydrationData.push(a,f);return new Ag(r)};po.render=function(t,r,a){if(!Tg(r))throw Error(pt(200));return Cg(null,t,r,!1,a)};po.unmountComponentAtNode=function(t){if(!Tg(t))throw Error(pt(40));return t._reactRootContainer?(wc(function(){Cg(null,null,t,!1,function(){t._reactRootContainer=null,t[da]=null})}),!0):!1};po.unstable_batchedUpdates=H1;po.unstable_renderSubtreeIntoContainer=function(t,r,a,c){if(!Tg(a))throw Error(pt(200));if(t==null||t._reactInternals===void 0)throw Error(pt(38));return Cg(t,r,a,!1,c)};po.version="18.3.1-next-f1338f8080-20240426";function bk(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(bk)}catch(t){console.error(t)}}bk(),bC.exports=po;var tb=bC.exports,wk,US=tb;wk=US.createRoot,US.hydrateRoot;const y5="Logging",x5="NoHubcallbackProvidedException";var oo;(function(t){t.DEBUG="DEBUG",t.ERROR="ERROR",t.INFO="INFO",t.WARN="WARN",t.VERBOSE="VERBOSE",t.NONE="NONE"})(oo||(oo={}));const VS={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,NONE:6};class us{constructor(r,a=oo.WARN){this.name=r,this.level=a,this._pluggables=[]}_padding(r){return r<10?"0"+r:""+r}_ts(){const r=new Date;return[this._padding(r.getMinutes()),this._padding(r.getSeconds())].join(":")+"."+r.getMilliseconds()}configure(r){return r?(this._config=r,this._config):this._config}_log(r,...a){let c=this.level;us.LOG_LEVEL&&(c=us.LOG_LEVEL),typeof window<"u"&&window.LOG_LEVEL&&(c=window.LOG_LEVEL);const f=VS[c];if(!(VS[r]>=f))return;let b=console.log.bind(console);r===oo.ERROR&&console.error&&(b=console.error.bind(console)),r===oo.WARN&&console.warn&&(b=console.warn.bind(console)),us.BIND_ALL_LOG_LEVELS&&(r===oo.INFO&&console.info&&(b=console.info.bind(console)),r===oo.DEBUG&&console.debug&&(b=console.debug.bind(console)));const s=`[${r}] ${this._ts()} ${this.name}`;let S="";if(a.length===1&&typeof a[0]=="string")S=`${s} - ${a[0]}`,b(S);else if(a.length===1)S=`${s} ${a[0]}`,b(s,a[0]);else if(typeof a[0]=="string"){let C=a.slice(1);C.length===1&&(C=C[0]),S=`${s} - ${a[0]} ${C}`,b(`${s} - ${a[0]}`,C)}else S=`${s} ${a}`,b(s,a);for(const C of this._pluggables){const k={message:S,timestamp:Date.now()};C.pushLogs([k])}}log(...r){this._log(oo.INFO,...r)}info(...r){this._log(oo.INFO,...r)}warn(...r){this._log(oo.WARN,...r)}error(...r){this._log(oo.ERROR,...r)}debug(...r){this._log(oo.DEBUG,...r)}verbose(...r){this._log(oo.VERBOSE,...r)}addPluggable(r){r&&r.getCategoryName()===y5&&(this._pluggables.push(r),r.configure(this._config))}listPluggables(){return this._pluggables}}us.LOG_LEVEL=null;us.BIND_ALL_LOG_LEVELS=!1;class Ls extends Error{constructor({message:r,name:a,recoverySuggestion:c,underlyingError:f,metadata:_}){if(super(r),this.name=a,this.underlyingError=f,this.recoverySuggestion=c,_){const{extendedRequestId:b,httpStatusCode:s,requestId:S}=_;this.metadata={extendedRequestId:b,httpStatusCode:s,requestId:S}}this.constructor=Ls,Object.setPrototypeOf(this,Ls.prototype)}}var Ec;(function(t){t.NoEndpointId="NoEndpointId",t.PlatformNotSupported="PlatformNotSupported",t.Unknown="Unknown",t.NetworkError="NetworkError"})(Ec||(Ec={}));const Ek=(t,r=Ls)=>(a,c,f)=>{const{message:_,recoverySuggestion:b}=t[c];if(!a)throw new r({name:c,message:f?`${_} ${f}`:_,recoverySuggestion:b})},tg=typeof Symbol<"u"?Symbol("amplify_default"):"@@amplify_default",np=new us("Hub");class v5{constructor(r){this.listeners=new Map,this.protectedChannels=["core","auth","api","analytics","interactions","pubsub","storage","ui","xr"],this.name=r}_remove(r,a){const c=this.listeners.get(r);if(!c){np.warn(`No listeners for ${r}`);return}this.listeners.set(r,[...c.filter(({callback:f})=>f!==a)])}dispatch(r,a,c,f){typeof r=="string"&&this.protectedChannels.indexOf(r)>-1&&(f===tg||np.warn(`WARNING: ${r} is protected and dispatching on it can have unintended consequences`));const _={channel:r,payload:{...a},source:c,patternInfo:[]};try{this._toListeners(_)}catch(b){np.error(b)}}listen(r,a,c="noname"){let f;if(typeof a!="function")throw new Ls({name:x5,message:"No callback supplied to Hub"});f=a;let _=this.listeners.get(r);return _||(_=[],this.listeners.set(r,_)),_.push({name:c,callback:f}),()=>{this._remove(r,f)}}_toListeners(r){const{channel:a,payload:c}=r,f=this.listeners.get(a);f&&f.forEach(_=>{np.debug(`Dispatching to ${a} with `,c);try{_.callback(r)}catch(b){np.error(b)}})}}const Xv=new v5("__default__"),b5=()=>{if(typeof window<"u"&&typeof window.atob=="function")return window.atob;if(typeof atob=="function")return atob;throw new Ls({name:"Base64EncoderError",message:"Cannot resolve the `atob` function from the environment."})},w5={convert(t,r){let a=t;return r!=null&&r.urlSafe&&(a=a.replace(/-/g,"+").replace(/_/g,"/")),b5()(a)}};var sa;(function(t){t.AuthTokenConfigException="AuthTokenConfigException",t.AuthUserPoolAndIdentityPoolException="AuthUserPoolAndIdentityPoolException",t.AuthUserPoolException="AuthUserPoolException",t.InvalidIdentityPoolIdException="InvalidIdentityPoolIdException",t.OAuthNotConfigureException="OAuthNotConfigureException"})(sa||(sa={}));const E5={[sa.AuthTokenConfigException]:{message:"Auth Token Provider not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app."},[sa.AuthUserPoolAndIdentityPoolException]:{message:"Auth UserPool or IdentityPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with UserPoolId and IdentityPoolId."},[sa.AuthUserPoolException]:{message:"Auth UserPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with userPoolId and userPoolClientId."},[sa.InvalidIdentityPoolIdException]:{message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."},[sa.OAuthNotConfigureException]:{message:"oauth param not configured.",recoverySuggestion:"Make sure to call Amplify.configure with oauth parameter in your app."}},Sk=Ek(E5);function Vi(t){let r=!0;t?r=!!t.userPoolId&&!!t.userPoolClientId:r=!1,Sk(r,sa.AuthUserPoolException)}function E0(t){const r=!!(t!=null&&t.identityPoolId);Sk(r,sa.InvalidIdentityPoolIdException)}function Np(t){const r=t.split(".");if(r.length!==3)throw new Error("Invalid token");try{const c=r[1].replace(/-/g,"+").replace(/_/g,"/"),f=decodeURIComponent(w5.convert(c).split("").map(b=>`%${`00${b.charCodeAt(0).toString(16)}`.slice(-2)}`).join("")),_=JSON.parse(f);return{toString:()=>t,payload:_}}catch{throw new Error("Invalid token payload")}}const Ak=t=>{const r=Reflect.ownKeys(t);for(const a of r){const c=t[a];(c&&typeof c=="object"||typeof c=="function")&&Ak(c)}return Object.freeze(t)},S5=new us("parseAWSExports"),A5={API_KEY:"apiKey",AWS_IAM:"iam",AMAZON_COGNITO_USER_POOLS:"userPool",OPENID_CONNECT:"oidc",NONE:"none",AWS_LAMBDA:"lambda",LAMBDA:"lambda"},T5=(t={})=>{var tt,ir,Zt,vr,Xt,qn;if(!Object.prototype.hasOwnProperty.call(t,"aws_project_region"))throw new Ls({name:"InvalidParameterException",message:"Invalid config parameter.",recoverySuggestion:"Ensure passing the config object imported from  `amplifyconfiguration.json`."});const{aws_appsync_apiKey:r,aws_appsync_authenticationType:a,aws_appsync_graphqlEndpoint:c,aws_appsync_region:f,aws_bots_config:_,aws_cognito_identity_pool_id:b,aws_cognito_sign_up_verification_method:s,aws_cognito_mfa_configuration:S,aws_cognito_mfa_types:C,aws_cognito_password_protection_settings:k,aws_cognito_verification_mechanisms:M,aws_cognito_signup_attributes:L,aws_cognito_social_providers:V,aws_cognito_username_attributes:O,aws_mandatory_sign_in:j,aws_mobile_analytics_app_id:H,aws_mobile_analytics_app_region:Z,aws_user_files_s3_bucket:U,aws_user_files_s3_bucket_region:$,aws_user_files_s3_dangerously_connect_to_http_endpoint_for_testing:J,aws_user_pools_id:le,aws_user_pools_web_client_id:pe,geo:ye,oauth:Te,predictions:Se,aws_cloud_logic_custom:Ae,Notifications:Ne,modelIntrospection:Ue}=t,je={};H&&(je.Analytics={Pinpoint:{appId:H,region:Z}});const{InAppMessaging:Ct,Push:zt}=Ne??{};if(Ct!=null&&Ct.AWSPinpoint||zt!=null&&zt.AWSPinpoint){if(Ct!=null&&Ct.AWSPinpoint){const{appId:cr,region:Ot}=Ct.AWSPinpoint;je.Notifications={InAppMessaging:{Pinpoint:{appId:cr,region:Ot}}}}if(zt!=null&&zt.AWSPinpoint){const{appId:cr,region:Ot}=zt.AWSPinpoint;je.Notifications={...je.Notifications,PushNotification:{Pinpoint:{appId:cr,region:Ot}}}}}if(Array.isArray(_)&&(je.Interactions={LexV1:Object.fromEntries(_.map(cr=>[cr.name,cr]))}),c){const cr=A5[a];cr||S5.debug(`Invalid authentication type ${a}. Falling back to IAM.`),je.API={GraphQL:{endpoint:c,apiKey:r,region:f,defaultAuthMode:cr??"iam"}},Ue&&(je.API.GraphQL.modelIntrospection=Ue)}const Ut=S?{status:S&&S.toLowerCase(),totpEnabled:(C==null?void 0:C.includes("TOTP"))??!1,smsEnabled:(C==null?void 0:C.includes("SMS"))??!1}:void 0,sr=k?{minLength:k.passwordPolicyMinLength,requireLowercase:((tt=k.passwordPolicyCharacters)==null?void 0:tt.includes("REQUIRES_LOWERCASE"))??!1,requireUppercase:((ir=k.passwordPolicyCharacters)==null?void 0:ir.includes("REQUIRES_UPPERCASE"))??!1,requireNumbers:((Zt=k.passwordPolicyCharacters)==null?void 0:Zt.includes("REQUIRES_NUMBERS"))??!1,requireSpecialCharacters:((vr=k.passwordPolicyCharacters)==null?void 0:vr.includes("REQUIRES_SYMBOLS"))??!1}:void 0,St=Array.from(new Set([...M??[],...L??[]])).reduce((cr,Ot)=>({...cr,[Ot.toLowerCase()]:{required:!0}}),{}),ft=(O==null?void 0:O.includes("EMAIL"))??!1,Ve=(O==null?void 0:O.includes("PHONE_NUMBER"))??!1;(b||le)&&(je.Auth={Cognito:{identityPoolId:b,allowGuestAccess:j!=="enable",signUpVerificationMethod:s,userAttributes:St,userPoolClientId:pe,userPoolId:le,mfa:Ut,passwordFormat:sr,loginWith:{username:!(ft||Ve),email:ft,phone:Ve}}});const Je=Te?Object.keys(Te).length>0:!1,et=V?V.length>0:!1;if(je.Auth&&Je&&(je.Auth.Cognito.loginWith={...je.Auth.Cognito.loginWith,oauth:{...C5(Te),...et&&{providers:I5(V)}}}),U&&(je.Storage={S3:{bucket:U,region:$,dangerouslyConnectToHttpEndpointForTesting:J}}),ye){const{amazon_location_service:cr}=ye;je.Geo={LocationService:{maps:cr.maps,geofenceCollections:cr.geofenceCollections,searchIndices:cr.search_indices,region:cr.region}}}if(Ae&&(je.API={...je.API,REST:Ae.reduce((cr,Ot)=>{const{name:li,endpoint:Br,region:tn,service:gr}=Ot;return{...cr,[li]:{endpoint:Br,...gr?{service:gr}:void 0,...tn?{region:tn}:void 0}}},{})}),Se){const{VoiceId:cr}=((qn=(Xt=Se==null?void 0:Se.convert)==null?void 0:Xt.speechGenerator)==null?void 0:qn.defaults)??{};je.Predictions=cr?{...Se,convert:{...Se.convert,speechGenerator:{...Se.convert.speechGenerator,defaults:{voiceId:cr}}}}:Se}return je},jS=t=>(t==null?void 0:t.split(","))??[],C5=({domain:t,scope:r,redirectSignIn:a,redirectSignOut:c,responseType:f})=>({domain:t,scopes:r,redirectSignIn:jS(a),redirectSignOut:jS(c),responseType:f}),I5=t=>t.map(r=>{const a=r.toLowerCase();return a.charAt(0).toUpperCase()+a.slice(1)}),k5=Symbol("oauth-listener");let Wm;const P5=new Uint8Array(16);function z5(){if(!Wm&&(Wm=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Wm))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Wm(P5)}const ni=[];for(let t=0;t<256;++t)ni.push((t+256).toString(16).slice(1));function D5(t,r=0){return ni[t[r+0]]+ni[t[r+1]]+ni[t[r+2]]+ni[t[r+3]]+"-"+ni[t[r+4]]+ni[t[r+5]]+"-"+ni[t[r+6]]+ni[t[r+7]]+"-"+ni[t[r+8]]+ni[t[r+9]]+"-"+ni[t[r+10]]+ni[t[r+11]]+ni[t[r+12]]+ni[t[r+13]]+ni[t[r+14]]+ni[t[r+15]]}const M5=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$S={randomUUID:M5};function R5(t,r,a){if($S.randomUUID&&!r&&!t)return $S.randomUUID();t=t||{};const c=t.random||(t.rng||z5)();if(c[6]=c[6]&15|64,c[8]=c[8]&63|128,r){a=a||0;for(let f=0;f<16;++f)r[a+f]=c[f];return r}return D5(c)}function B5(t){const{version:r}=t;return r?r.startsWith("1"):!1}function L5(t){if(!t)return;const{bucket_name:r,aws_region:a,buckets:c}=t;return{S3:{bucket:r,region:a,buckets:c&&H5(c)}}}function F5(t){if(!t)return;const{user_pool_id:r,user_pool_client_id:a,identity_pool_id:c,password_policy:f,mfa_configuration:_,mfa_methods:b,unauthenticated_identities_enabled:s,oauth:S,username_attributes:C,standard_required_attributes:k,groups:M}=t,L={Cognito:{userPoolId:r,userPoolClientId:a,groups:M}};return c&&(L.Cognito={...L.Cognito,identityPoolId:c}),f&&(L.Cognito.passwordFormat={requireLowercase:f.require_lowercase,requireNumbers:f.require_numbers,requireUppercase:f.require_uppercase,requireSpecialCharacters:f.require_symbols,minLength:f.min_length??6}),_&&(L.Cognito.mfa={status:G5(_),smsEnabled:b==null?void 0:b.includes("SMS"),totpEnabled:b==null?void 0:b.includes("TOTP")}),s&&(L.Cognito.allowGuestAccess=s),S&&(L.Cognito.loginWith={oauth:{domain:S.domain,redirectSignIn:S.redirect_sign_in_uri,redirectSignOut:S.redirect_sign_out_uri,responseType:S.response_type==="token"?"token":"code",scopes:S.scopes,providers:q5(S.identity_providers)}}),C&&(L.Cognito.loginWith={...L.Cognito.loginWith,email:C.includes("email"),phone:C.includes("phone_number"),username:C.includes("username")}),k&&(L.Cognito.userAttributes=k.reduce((V,O)=>({...V,[O]:{required:!0}}),{})),L}function O5(t){if(!(t!=null&&t.amazon_pinpoint))return;const{amazon_pinpoint:r}=t;return{Pinpoint:{appId:r.app_id,region:r.aws_region}}}function N5(t){if(!t)return;const{aws_region:r,geofence_collections:a,maps:c,search_indices:f}=t;return{LocationService:{region:r,searchIndices:f,geofenceCollections:a,maps:c}}}function U5(t){if(!t)return;const{aws_region:r,default_authorization_type:a,url:c,api_key:f,model_introspection:_}=t;return{GraphQL:{endpoint:c,defaultAuthMode:Tk(a),region:r,apiKey:f,modelIntrospection:_}}}function V5(t){if(!(t!=null&&t.events))return;const{url:r,aws_region:a,api_key:c,default_authorization_type:f}=t.events;return{Events:{endpoint:r,defaultAuthMode:Tk(f),region:a,apiKey:c}}}function j5(t){if(!t)return;const{aws_region:r,channels:a,amazon_pinpoint_app_id:c}=t,f=a.includes("IN_APP_MESSAGING"),_=a.includes("APNS")||a.includes("FCM");if(!(f||_))return;const b={};return f&&(b.InAppMessaging={Pinpoint:{appId:c,region:r}}),_&&(b.PushNotification={Pinpoint:{appId:c,region:r}}),b}function $5(t){const r={};if(t.storage&&(r.Storage=L5(t.storage)),t.auth&&(r.Auth=F5(t.auth)),t.analytics&&(r.Analytics=O5(t.analytics)),t.geo&&(r.Geo=N5(t.geo)),t.data&&(r.API=U5(t.data)),t.custom){const a=V5(t.custom);a&&"Events"in a&&(r.API={...r.API,...a})}return t.notifications&&(r.Notifications=j5(t.notifications)),r}const W5={AMAZON_COGNITO_USER_POOLS:"userPool",API_KEY:"apiKey",AWS_IAM:"iam",AWS_LAMBDA:"lambda",OPENID_CONNECT:"oidc"};function Tk(t){return W5[t]}const WS={GOOGLE:"Google",LOGIN_WITH_AMAZON:"Amazon",FACEBOOK:"Facebook",SIGN_IN_WITH_APPLE:"Apple"};function q5(t=[]){return t.reduce((r,a)=>(WS[a]!==void 0&&r.push(WS[a]),r),[])}function G5(t){return t==="OPTIONAL"?"optional":t==="REQUIRED"?"on":"off"}function H5(t){const r={};return t.forEach(({name:a,bucket_name:c,aws_region:f,paths:_})=>{if(a in r)throw new Error(`Duplicate friendly name found: ${a}. Name must be unique.`);const b=_?Object.entries(_).reduce((s,[S,C])=>(C!==void 0&&(s[S]=C),s),{}):void 0;r[a]={bucketName:c,region:f,paths:b}}),r}const Ck=t=>Object.keys(t).some(r=>r.startsWith("aws_"))?T5(t):B5(t)?$5(t):t,Z5=t=>new TextEncoder().encode(t);typeof Buffer<"u"&&Buffer.from;for(let t=0;t<256;t++){let r=t.toString(16).toLowerCase();r.length===1&&(r=`0${r}`)}var bn;(function(t){t.WebUnknown="0",t.React="1",t.NextJs="2",t.Angular="3",t.VueJs="4",t.Nuxt="5",t.Svelte="6",t.ServerSideUnknown="100",t.ReactSSR="101",t.NextJsSSR="102",t.AngularSSR="103",t.VueJsSSR="104",t.NuxtSSR="105",t.SvelteSSR="106",t.ReactNative="201",t.Expo="202"})(bn||(bn={}));var qS;(function(t){t.AI="ai",t.API="api",t.Auth="auth",t.Analytics="analytics",t.DataStore="datastore",t.Geo="geo",t.InAppMessaging="inappmessaging",t.Interactions="interactions",t.Predictions="predictions",t.PubSub="pubsub",t.PushNotification="pushnotification",t.Storage="storage"})(qS||(qS={}));var GS;(function(t){t.CreateConversation="1",t.GetConversation="2",t.ListConversations="3",t.DeleteConversation="4",t.SendMessage="5",t.ListMessages="6",t.OnMessage="7",t.Generation="8",t.UpdateConversation="9"})(GS||(GS={}));var HS;(function(t){t.Record="1",t.IdentifyUser="2"})(HS||(HS={}));var ZS;(function(t){t.GraphQl="1",t.Get="2",t.Post="3",t.Put="4",t.Patch="5",t.Del="6",t.Head="7"})(ZS||(ZS={}));var XS;(function(t){t.SignUp="1",t.ConfirmSignUp="2",t.ResendSignUpCode="3",t.SignIn="4",t.FetchMFAPreference="6",t.UpdateMFAPreference="7",t.SetUpTOTP="10",t.VerifyTOTPSetup="11",t.ConfirmSignIn="12",t.DeleteUserAttributes="15",t.DeleteUser="16",t.UpdateUserAttributes="17",t.FetchUserAttributes="18",t.ConfirmUserAttribute="22",t.SignOut="26",t.UpdatePassword="27",t.ResetPassword="28",t.ConfirmResetPassword="29",t.FederatedSignIn="30",t.RememberDevice="32",t.ForgetDevice="33",t.FetchDevices="34",t.SendUserAttributeVerificationCode="35",t.SignInWithRedirect="36",t.StartWebAuthnRegistration="37",t.CompleteWebAuthnRegistration="38",t.ListWebAuthnCredentials="39",t.DeleteWebAuthnCredential="40"})(XS||(XS={}));var KS;(function(t){t.Subscribe="1",t.GraphQl="2"})(KS||(KS={}));var YS;(function(t){t.SearchByText="0",t.SearchByCoordinates="1",t.SearchForSuggestions="2",t.SearchByPlaceId="3",t.SaveGeofences="4",t.GetGeofence="5",t.ListGeofences="6",t.DeleteGeofences="7"})(YS||(YS={}));var JS;(function(t){t.SyncMessages="1",t.IdentifyUser="2",t.NotifyMessageInteraction="3"})(JS||(JS={}));var QS;(function(t){t.None="0"})(QS||(QS={}));var eA;(function(t){t.Convert="1",t.Identify="2",t.Interpret="3"})(eA||(eA={}));var tA;(function(t){t.Subscribe="1"})(tA||(tA={}));var rA;(function(t){t.InitializePushNotifications="1",t.IdentifyUser="2"})(rA||(rA={}));var nA;(function(t){t.UploadData="1",t.DownloadData="2",t.List="3",t.Copy="4",t.Remove="5",t.GetProperties="6",t.GetUrl="7",t.GetDataAccess="8",t.ListCallerAccessGrants="9"})(nA||(nA={}));const Ik="6.14.1",Ig=()=>typeof global<"u",uh=()=>typeof window<"u",kk=()=>typeof document<"u",rb=()=>typeof process<"u",Up=(t,r)=>!!Object.keys(t).find(a=>a.startsWith(r));function X5(){const t=c=>c.startsWith("_react")||c.startsWith("__react"),r=c=>Object.keys(c).find(t),a=()=>Array.from(document.querySelectorAll("[id]"));return kk()&&a().some(r)}function K5(){return rb()&&typeof process.env<"u"&&!!Object.keys(process.env).find(t=>t.includes("react"))}function Y5(){return uh()&&Up(window,"__VUE")}function J5(){return Ig()&&Up(global,"__VUE")}function Q5(){return uh()&&Up(window,"__SVELTE")}function eR(){return rb()&&typeof process.env<"u"&&!!Object.keys(process.env).find(t=>t.includes("svelte"))}function tR(){return uh()&&window.next&&typeof window.next=="object"}function rR(){return Ig()&&(Up(global,"__next")||Up(global,"__NEXT"))}function nR(){return uh()&&(window.__NUXT__!==void 0||window.$nuxt!==void 0)}function iR(){return Ig()&&typeof global.__NUXT_PATHS__<"u"}function oR(){const t=!!(kk()&&document.querySelector("[ng-version]")),r=!!(uh()&&typeof window.ng<"u");return t||r}function sR(){var t;return rb()&&typeof process.env=="object"&&((t={}.npm_lifecycle_script)==null?void 0:t.startsWith("ng "))||!1}function aR(){return typeof navigator<"u"&&typeof navigator.product<"u"&&navigator.product==="ReactNative"}function lR(){return Ig()&&typeof global.expo<"u"}function cR(){return uh()}const uR=[{platform:bn.Expo,detectionMethod:lR},{platform:bn.ReactNative,detectionMethod:aR},{platform:bn.NextJs,detectionMethod:tR},{platform:bn.Nuxt,detectionMethod:nR},{platform:bn.Angular,detectionMethod:oR},{platform:bn.React,detectionMethod:X5},{platform:bn.VueJs,detectionMethod:Y5},{platform:bn.Svelte,detectionMethod:Q5},{platform:bn.WebUnknown,detectionMethod:cR},{platform:bn.NextJsSSR,detectionMethod:rR},{platform:bn.NuxtSSR,detectionMethod:iR},{platform:bn.ReactSSR,detectionMethod:K5},{platform:bn.VueJsSSR,detectionMethod:J5},{platform:bn.AngularSSR,detectionMethod:sR},{platform:bn.SvelteSSR,detectionMethod:eR}];function hR(){var t;return((t=uR.find(r=>r.detectionMethod()))==null?void 0:t.platform)||bn.ServerSideUnknown}let bp;const S0=[];let rg=!1;const dR=10,pR=10,fR=1e3,nb=()=>{var t;if(!bp){if(bp=hR(),rg)for(;S0.length;)(t=S0.pop())==null||t();else S0.forEach(r=>{r()});iA(bn.ServerSideUnknown,dR),iA(bn.WebUnknown,pR)}return bp},Pk=t=>{rg||S0.push(t)};function mR(){bp=void 0}function iA(t,r){bp===t&&!rg&&setTimeout(()=>{mR(),rg=!0,setTimeout(nb,fR)},r)}const gR={},_R=(t,r)=>{var a,c;return(c=(a=gR[t])==null?void 0:a[r])==null?void 0:c.additionalDetails},zk="aws-amplify",Dk=t=>t.replace(/\+.*/,"");class yR{constructor(){this.userAgent=`${zk}/${Dk(Ik)}`}get framework(){return nb()}get isReactNative(){return this.framework===bn.ReactNative||this.framework===bn.Expo}observeFrameworkChanges(r){Pk(r)}}new yR;const xR=({category:t,action:r}={})=>{const a=[[zk,Dk(Ik)]];if(t&&a.push([t,r]),a.push(["framework",nb()]),t&&r){const c=_R(t,r);c&&c.forEach(f=>{a.push(f)})}return a},ib=t=>xR(t).map(([c,f])=>c&&f?`${c}/${f}`:c).join(" "),vR=()=>typeof window<"u"&&typeof window.document<"u";class bR{configure(r,a){this.authConfig=r,this.authOptions=a}async fetchAuthSession(r={}){var _,b,s,S,C,k;let a,c;const f=await this.getTokens(r);return f?(c=(b=(_=f.accessToken)==null?void 0:_.payload)==null?void 0:b.sub,a=await((S=(s=this.authOptions)==null?void 0:s.credentialsProvider)==null?void 0:S.getCredentialsAndIdentityId({authConfig:this.authConfig,tokens:f,authenticated:!0,forceRefresh:r.forceRefresh}))):a=await((k=(C=this.authOptions)==null?void 0:C.credentialsProvider)==null?void 0:k.getCredentialsAndIdentityId({authConfig:this.authConfig,authenticated:!1,forceRefresh:r.forceRefresh})),{tokens:f,credentials:a==null?void 0:a.credentials,identityId:a==null?void 0:a.identityId,userSub:c}}async clearCredentials(){var r,a;await((a=(r=this.authOptions)==null?void 0:r.credentialsProvider)==null?void 0:a.clearCredentialsAndIdentityId())}async getTokens(r){var a,c;return await((c=(a=this.authOptions)==null?void 0:a.tokenProvider)==null?void 0:c.getTokens(r))??void 0}}class wR{constructor(){this.oAuthListener=void 0,this.resourcesConfig={},this.libraryOptions={},this.Auth=new bR}configure(r,a){const c=Ck(r);this.resourcesConfig=c,a&&(this.libraryOptions=a),this.resourcesConfig=Ak(this.resourcesConfig),this.Auth.configure(this.resourcesConfig.Auth,this.libraryOptions.Auth),Xv.dispatch("core",{event:"configure",data:this.resourcesConfig},"Configure",tg),this.notifyOAuthListener()}getConfig(){return this.resourcesConfig}[k5](r){var a,c,f;(c=(a=this.resourcesConfig.Auth)==null?void 0:a.Cognito.loginWith)!=null&&c.oauth?r((f=this.resourcesConfig.Auth)==null?void 0:f.Cognito):this.oAuthListener=r}notifyOAuthListener(){var r,a,c;!((a=(r=this.resourcesConfig.Auth)==null?void 0:r.Cognito.loginWith)!=null&&a.oauth)||!this.oAuthListener||(this.oAuthListener((c=this.resourcesConfig.Auth)==null?void 0:c.Cognito),this.oAuthListener=void 0)}}const Ha=new wR,kg=t=>{const{headers:r,statusCode:a}=t;return{...ER(t)?t.$metadata:{},httpStatusCode:a,requestId:r["x-amzn-requestid"]??r["x-amzn-request-id"]??r["x-amz-request-id"],extendedRequestId:r["x-amz-id-2"],cfId:r["x-amz-cf-id"]}},ER=t=>typeof(t==null?void 0:t.$metadata)=="object",Xp=async t=>{if(!t||t.statusCode<300)return;const r=await Pg(t),c=(b=>{const[s]=b.toString().split(/[,:]+/);return s.includes("#")?s.split("#")[1]:s})(t.headers["x-amzn-errortype"]??r.code??r.__type??"UnknownError"),f=r.message??r.Message??"Unknown error",_=new Error(f);return Object.assign(_,{name:c,$metadata:kg(t)})},Pg=async t=>{if(!t.body)throw new Error("Missing response payload");const r=await t.body.json();return Object.assign(r,{$metadata:kg(t)})},ob=(t,r,a,c)=>async(f,_)=>{const b={...c,...f},s=await b.endpointResolver(b,_),S=await r(_,s),C=await t(S,{...b});return a(C)},Mk={id:"aws",outputs:{dnsSuffix:"amazonaws.com"},regionRegex:"^(us|eu|ap|sa|ca|me|af)\\-\\w+\\-\\d+$",regions:["aws-global"]},SR={partitions:[Mk,{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn"},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:["aws-cn-global"]}]},Rk=t=>{const{partitions:r}=SR;for(const{regions:a,outputs:c,regionRegex:f}of r){const _=new RegExp(f);if(a.includes(t)||_.test(t))return c.dnsSuffix}return Mk.outputs.dnsSuffix},Bk=3,oA="amz-sdk-invocation-id",AR="amz-sdk-request",sA=5*60*1e3,TR=({maxAttempts:t=Bk,retryDecider:r,computeDelay:a,abortSignal:c})=>{if(t<1)throw new Error("maxAttempts must be greater than 0");return(f,_)=>async function(s){let S,C=_.attemptsCount??0,k;const M=()=>{if(k)return aA(k,C),k;throw aA(S,C),S};for(;!(c!=null&&c.aborted)&&C<t;){try{k=await f(s),S=void 0}catch(O){S=O,k=void 0}C=(_.attemptsCount??0)>C?_.attemptsCount??0:C+1,_.attemptsCount=C;const{isCredentialsExpiredError:L,retryable:V}=await r(k,S,_);if(V){if(_.isCredentialsExpired=!!L,!(c!=null&&c.aborted)&&C<t){const O=a(C);await CR(O,c)}continue}else return M()}if(c!=null&&c.aborted)throw new Error("Request aborted.");return M()}},CR=(t,r)=>{if(r!=null&&r.aborted)return Promise.resolve();let a,c;const f=new Promise(_=>{c=_,a=setTimeout(_,t)});return r==null||r.addEventListener("abort",function _(b){clearTimeout(a),r==null||r.removeEventListener("abort",_),c()}),f},aA=(t,r)=>{Object.prototype.toString.call(t)==="[object Object]"&&(t.$metadata={...t.$metadata??{},attempts:r})},IR=R5,kR=()=>t=>async function(a){return a.headers[oA]||(a.headers[oA]=IR()),t(a)},PR=({maxAttempts:t=Bk})=>(r,a)=>async function(f){const _=a.attemptsCount??0;return f.headers[AR]=`attempt=${_+1}; max=${t}`,r(f)},zR=({userAgentHeader:t="x-amz-user-agent",userAgentValue:r=""})=>a=>async function(f){if(r.trim().length===0)return await a(f);{const _=t.toLowerCase();return f.headers[_]=f.headers[_]?`${f.headers[_]} ${r}`:r,await a(f)}},sb=(t,r)=>(a,c)=>{const f={};let _=b=>t(b,c);for(let b=r.length-1;b>=0;b--){const s=r[b];_=s(c)(_,f)}return _(a)},rx=t=>{let r;return()=>(r||(r=t()),r)},DR=t=>!["HEAD","GET","DELETE"].includes(t.toUpperCase()),MR=async({url:t,method:r,headers:a,body:c},{abortSignal:f,cache:_,withCrossDomainCredentials:b})=>{var M;let s;try{s=await fetch(t,{method:r,headers:a,body:DR(r)?c:void 0,signal:f,cache:_,credentials:b?"include":"same-origin"})}catch(L){throw L instanceof TypeError?new Ls({name:Ec.NetworkError,message:"A network error has occurred.",underlyingError:L}):L}const S={};(M=s.headers)==null||M.forEach((L,V)=>{S[V.toLowerCase()]=L});const C={statusCode:s.status,headers:S,body:null},k=Object.assign(s.body??{},{text:rx(()=>s.text()),blob:rx(()=>s.blob()),json:rx(()=>s.json())});return{...C,body:k}},Lk=sb(MR,[zR,kR,TR,PR]),RR=5*60*1e3;function BR(t=RR){return c=>{const f=2**c*100+100*Math.random();return f>t?!1:f}}const Fk=t=>{const a=BR(sA)(t);return a===!1?sA:a},LR=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch","BadRequestException"],FR=t=>!!t&&LR.includes(t),Ok=t=>async(r,a)=>{const c=a??await t(r)??void 0,f=(c==null?void 0:c.code)||(c==null?void 0:c.name),_=r==null?void 0:r.statusCode;return{retryable:VR(a)||UR(_,f)||FR(f)||jR(_,f)}},OR=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException"],NR=["TimeoutError","RequestTimeout","RequestTimeoutException"],UR=(t,r)=>t===429||!!r&&OR.includes(r),VR=t=>[Ec.NetworkError,"ERR_NETWORK"].includes(t==null?void 0:t.name),jR=(t,r)=>!!t&&[500,502,503,504].includes(t)||!!r&&NR.includes(r),ab=URL,$R="cognito-identity",WR=({region:t})=>({url:new ab(`https://cognito-identity.${t}.${Rk(t)}`)}),qR=()=>t=>async function(a){return a.headers["cache-control"]="no-store",t(a)},Nk=sb(Lk,[qR]),lb={service:$R,endpointResolver:WR,retryDecider:Ok(Xp),computeDelay:Fk,userAgentValue:ib(),cache:"no-store"};Pk(()=>{lb.userAgentValue=ib()});const Uk=t=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityService.${t}`}),Vk=({url:t},r,a)=>({headers:r,url:t,body:a,method:"POST"}),GR=(t,r)=>{const a=Uk("GetId"),c=JSON.stringify(t);return Vk(r,a,c)},HR=async t=>{if(t.statusCode>=300)throw await Xp(t);return{IdentityId:(await Pg(t)).IdentityId,$metadata:kg(t)}},ZR=ob(Nk,GR,HR,lb),XR=(t,r)=>{const a=Uk("GetCredentialsForIdentity"),c=JSON.stringify(t);return Vk(r,a,c)},KR=async t=>{if(t.statusCode>=300)throw await Xp(t);{const r=await Pg(t);return{IdentityId:r.IdentityId,Credentials:YR(r.Credentials),$metadata:kg(t)}}},YR=({AccessKeyId:t,SecretKey:r,SessionToken:a,Expiration:c}={})=>({AccessKeyId:t,SecretKey:r,SessionToken:a,Expiration:c&&new Date(c*1e3)}),lA=ob(Nk,XR,KR,lb);class hp extends Ls{constructor(){super({name:Ec.PlatformNotSupported,message:"Function not supported on current platform"})}}class jk{constructor(r){this.storage=r}async setItem(r,a){if(!this.storage)throw new hp;this.storage.setItem(r,a)}async getItem(r){if(!this.storage)throw new hp;return this.storage.getItem(r)}async removeItem(r){if(!this.storage)throw new hp;this.storage.removeItem(r)}async clear(){if(!this.storage)throw new hp;this.storage.clear()}}class $k{constructor(){this.storage=new Map}get length(){return this.storage.size}key(r){return r>this.length-1?null:Array.from(this.storage.keys())[r]}setItem(r,a){this.storage.set(r,a)}getItem(r){return this.storage.get(r)??null}removeItem(r){this.storage.delete(r)}clear(){this.storage.clear()}}const Wk=new us("CoreStorageUtils"),JR=()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{Wk.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new $k},qk=()=>{try{if(typeof window<"u"&&window.sessionStorage)return window.sessionStorage.getItem("test"),window.sessionStorage;throw new Error("sessionStorage is not defined")}catch{return Wk.info("sessionStorage not found. InMemoryStorage is used as a fallback."),new $k}};class QR extends jk{constructor(){super(JR())}}class eB extends jk{constructor(){super(qk())}}class tB{constructor(r){this._storage=r}get storage(){if(!this._storage)throw new hp;return this._storage}setItem(r,a){this.storage.setItem(r,a)}getItem(r){return this.storage.getItem(r)}removeItem(r){this.storage.removeItem(r)}clear(){this.storage.clear()}}class rB extends tB{constructor(){super(qk())}}/*! js-cookie v3.0.5 | MIT */function qm(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)t[c]=a[c]}return t}var nB={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Kv(t,r){function a(f,_,b){if(!(typeof document>"u")){b=qm({},r,b),typeof b.expires=="number"&&(b.expires=new Date(Date.now()+b.expires*864e5)),b.expires&&(b.expires=b.expires.toUTCString()),f=encodeURIComponent(f).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var S in b)b[S]&&(s+="; "+S,b[S]!==!0&&(s+="="+b[S].split(";")[0]));return document.cookie=f+"="+t.write(_,f)+s}}function c(f){if(!(typeof document>"u"||arguments.length&&!f)){for(var _=document.cookie?document.cookie.split("; "):[],b={},s=0;s<_.length;s++){var S=_[s].split("="),C=S.slice(1).join("=");try{var k=decodeURIComponent(S[0]);if(b[k]=t.read(C,k),f===k)break}catch{}}return f?b[f]:b}}return Object.create({set:a,get:c,remove:function(f,_){a(f,"",qm({},_,{expires:-1}))},withAttributes:function(f){return Kv(this.converter,qm({},this.attributes,f))},withConverter:function(f){return Kv(qm({},this.converter,f),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}var Gm=Kv(nB,{path:"/"});class cA{constructor(r={}){const{path:a,domain:c,expires:f,sameSite:_,secure:b}=r;if(this.domain=c,this.path=a||"/",this.expires=Object.prototype.hasOwnProperty.call(r,"expires")?f:365,this.secure=Object.prototype.hasOwnProperty.call(r,"secure")?b:!0,Object.prototype.hasOwnProperty.call(r,"sameSite")){if(!_||!["strict","lax","none"].includes(_))throw new Error('The sameSite value of cookieStorage must be "lax", "strict" or "none".');if(_==="none"&&!this.secure)throw new Error("sameSite = None requires the Secure attribute in latest browser versions.");this.sameSite=_}}async setItem(r,a){Gm.set(r,a,this.getData())}async getItem(r){return Gm.get(r)??null}async removeItem(r){Gm.remove(r,this.getData())}async clear(){const r=Gm.get(),a=Object.keys(r).map(c=>this.removeItem(c));await Promise.all(a)}getData(){return{path:this.path,expires:this.expires,domain:this.domain,secure:this.secure,...this.sameSite&&{sameSite:this.sameSite}}}}const Vp=new QR;new eB;new rB;const iB=t=>{let r;return async(...a)=>r||(r=new Promise((c,f)=>{t(...a).then(_=>{c(_)}).catch(_=>{f(_)}).finally(()=>{r=void 0})}),r)};function uA({expiresAt:t,clockDrift:r,tolerance:a=5e3}){return Date.now()+r+a>t}class Xr extends Ls{constructor(r){super(r),this.constructor=Xr,Object.setPrototypeOf(this,Xr.prototype)}}function oB(t){const r=t==null?void 0:t.split("_")[0];if(!t||t.indexOf("_")<0||!r||typeof r!="string")throw new Xr({name:"InvalidUserPoolId",message:"Invalid user pool id provided."});return r}function Yv(t){if(!t||!t.includes(":"))throw new Xr({name:"InvalidIdentityPoolIdException",message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."});return t.split(":")[0]}const Gk="UserUnAuthenticatedException",sB="InvalidRedirectException",aB="InvalidAppSchemeException",lB="InvalidPreferredRedirectUrlException";new Xr({name:sB,message:"signInRedirect or signOutRedirect had an invalid format or was not found.",recoverySuggestion:"Please make sure the signIn/Out redirect in your oauth config is valid."});new Xr({name:aB,message:"A valid non-http app scheme was not found in the config.",recoverySuggestion:"Please make sure a valid custom app scheme is present in the config."});new Xr({name:lB,message:"The given preferredRedirectUrl does not match any items in the redirectSignOutUrls array from the config.",recoverySuggestion:"Please make sure a matching preferredRedirectUrl is provided."});const cB="InvalidOriginException";new Xr({name:cB,message:"redirect is coming from a different origin. The oauth flow needs to be initiated from the same origin",recoverySuggestion:"Please call signInWithRedirect from the same origin."});const uB="TokenRefreshException";function hB(t){if(!t||!t.idToken)throw new Xr({name:Gk,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."})}const dB=new Xr({name:uB,message:`Token refresh is not supported when authenticated with the 'implicit grant' (token) oauth flow. 
	Please change your oauth configuration to use 'code grant' flow.`,recoverySuggestion:`Please logout and change your Amplify configuration to use "code grant" flow. 
	E.g { responseType: 'code' }`}),pB=new Xr({name:Gk,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."});function fB(t){if(_B(t))throw dB;if(!gB(t))throw pB}const mB={inflightOAuth:"inflightOAuth",oauthSignIn:"oauthSignIn",oauthPKCE:"oauthPKCE",oauthState:"oauthState"};function Hk(t){return(t==null?void 0:t.accessToken)||(t==null?void 0:t.idToken)}function gB(t){return Hk(t)&&(t==null?void 0:t.refreshToken)}function _B(t){return Hk(t)&&!(t!=null&&t.refreshToken)}const yB=t=>(r,a)=>{const c=xB(t),f=JSON.stringify(r);return vB(a,c,f)},xB=t=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityProviderService.${t}`}),vB=({url:t},r,a)=>({headers:r,url:t,body:a,method:"POST"});function jp(t){if(!t||t.name==="Error"||t instanceof TypeError)throw new Xr({name:Ec.Unknown,message:"An unknown error has occurred.",underlyingError:t})}const bB=()=>async t=>{if(t.statusCode>=300){const r=await Xp(t);throw jp(r),new Xr({name:r.name,message:r.message,metadata:r.$metadata})}return Pg(t)},wB=()=>(t,r)=>async function(c){return c.headers["cache-control"]="no-store",t(c)},EB=sb(Lk,[wB]),Zk="cognito-idp",SB={service:Zk,retryDecider:Ok(Xp),computeDelay:Fk,userAgentValue:ib(),cache:"no-store"},AB=t=>ob(EB,yB("InitiateAuth"),bB(),{...SB,...t}),TB=({region:t})=>({url:new ab(`https://${Zk}.${t}.${Rk(t)}`)}),CB=({endpointOverride:t})=>r=>t?{url:new ab(t)}:TB(r);function IB({username:t,userPoolId:r,userPoolClientId:a}){if(typeof window>"u")return;const c=window.AmazonCognitoAdvancedSecurityData;if(typeof c>"u")return;const f=c.getData(t,r,a);return f?{EncodedData:f}:{}}const kB=async({tokens:t,authConfig:r,username:a})=>{var H;Vi(r==null?void 0:r.Cognito);const{userPoolId:c,userPoolClientId:f,userPoolEndpoint:_}=r.Cognito,b=oB(c);fB(t);const s=t.refreshToken,S={REFRESH_TOKEN:s};(H=t.deviceMetadata)!=null&&H.deviceKey&&(S.DEVICE_KEY=t.deviceMetadata.deviceKey);const C=IB({username:a,userPoolId:c,userPoolClientId:f}),k=AB({endpointResolver:CB({endpointOverride:_})}),{AuthenticationResult:M}=await k({region:b},{ClientId:f,AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:S,UserContextData:C}),L=Np((M==null?void 0:M.AccessToken)??""),V=M!=null&&M.IdToken?Np(M.IdToken):void 0,{iat:O}=L.payload;if(!O)throw new Xr({name:"iatNotFoundException",message:"iat not found in access token"});const j=O*1e3-new Date().getTime();return{accessToken:L,idToken:V,clockDrift:j,refreshToken:s,username:a}},PB=iB(kB),zB={accessToken:"accessToken",idToken:"idToken",oidcProvider:"oidcProvider",clockDrift:"clockDrift",refreshToken:"refreshToken",deviceKey:"deviceKey",randomPasswordKey:"randomPasswordKey",deviceGroupKey:"deviceGroupKey",signInDetails:"signInDetails",oauthMetadata:"oauthMetadata"};var ng;(function(t){t.InvalidAuthTokens="InvalidAuthTokens"})(ng||(ng={}));const DB={[ng.InvalidAuthTokens]:{message:"Invalid tokens.",recoverySuggestion:"Make sure the tokens are valid."}},MB=Ek(DB),hA="CognitoIdentityServiceProvider";class RB{getKeyValueStorage(){if(!this.keyValueStorage)throw new Xr({name:"KeyValueStorageNotFoundException",message:"KeyValueStorage was not found in TokenStore"});return this.keyValueStorage}setKeyValueStorage(r){this.keyValueStorage=r}setAuthConfig(r){this.authConfig=r}async loadTokens(){try{const r=await this.getAuthKeys(),a=await this.getKeyValueStorage().getItem(r.accessToken);if(!a)throw new Xr({name:"NoSessionFoundException",message:"Auth session was not found. Make sure to call signIn."});const c=Np(a),f=await this.getKeyValueStorage().getItem(r.idToken),_=f?Np(f):void 0,b=await this.getKeyValueStorage().getItem(r.refreshToken)??void 0,s=await this.getKeyValueStorage().getItem(r.clockDrift)??"0",S=Number.parseInt(s),C=await this.getKeyValueStorage().getItem(r.signInDetails),k={accessToken:c,idToken:_,refreshToken:b,deviceMetadata:await this.getDeviceMetadata()??void 0,clockDrift:S,username:await this.getLastAuthUser()};return C&&(k.signInDetails=JSON.parse(C)),k}catch{return null}}async storeTokens(r){MB(r!==void 0,ng.InvalidAuthTokens);const a=r.username;await this.getKeyValueStorage().setItem(this.getLastAuthUserKey(),a);const c=await this.getAuthKeys();await this.getKeyValueStorage().setItem(c.accessToken,r.accessToken.toString()),r.idToken?await this.getKeyValueStorage().setItem(c.idToken,r.idToken.toString()):await this.getKeyValueStorage().removeItem(c.idToken),r.refreshToken?await this.getKeyValueStorage().setItem(c.refreshToken,r.refreshToken):await this.getKeyValueStorage().removeItem(c.refreshToken),r.deviceMetadata&&(r.deviceMetadata.deviceKey&&await this.getKeyValueStorage().setItem(c.deviceKey,r.deviceMetadata.deviceKey),r.deviceMetadata.deviceGroupKey&&await this.getKeyValueStorage().setItem(c.deviceGroupKey,r.deviceMetadata.deviceGroupKey),await this.getKeyValueStorage().setItem(c.randomPasswordKey,r.deviceMetadata.randomPassword)),r.signInDetails?await this.getKeyValueStorage().setItem(c.signInDetails,JSON.stringify(r.signInDetails)):await this.getKeyValueStorage().removeItem(c.signInDetails),await this.getKeyValueStorage().setItem(c.clockDrift,`${r.clockDrift}`)}async clearTokens(){const r=await this.getAuthKeys();await Promise.all([this.getKeyValueStorage().removeItem(r.accessToken),this.getKeyValueStorage().removeItem(r.idToken),this.getKeyValueStorage().removeItem(r.clockDrift),this.getKeyValueStorage().removeItem(r.refreshToken),this.getKeyValueStorage().removeItem(r.signInDetails),this.getKeyValueStorage().removeItem(this.getLastAuthUserKey()),this.getKeyValueStorage().removeItem(r.oauthMetadata)])}async getDeviceMetadata(r){const a=await this.getAuthKeys(r),c=await this.getKeyValueStorage().getItem(a.deviceKey),f=await this.getKeyValueStorage().getItem(a.deviceGroupKey),_=await this.getKeyValueStorage().getItem(a.randomPasswordKey);return _&&f&&c?{deviceKey:c,deviceGroupKey:f,randomPassword:_}:null}async clearDeviceMetadata(r){const a=await this.getAuthKeys(r);await Promise.all([this.getKeyValueStorage().removeItem(a.deviceKey),this.getKeyValueStorage().removeItem(a.deviceGroupKey),this.getKeyValueStorage().removeItem(a.randomPasswordKey)])}async getAuthKeys(r){var c;Vi((c=this.authConfig)==null?void 0:c.Cognito);const a=r??await this.getLastAuthUser();return BB(hA,`${this.authConfig.Cognito.userPoolClientId}.${a}`)}getLastAuthUserKey(){var a;Vi((a=this.authConfig)==null?void 0:a.Cognito);const r=this.authConfig.Cognito.userPoolClientId;return`${hA}.${r}.LastAuthUser`}async getLastAuthUser(){return await this.getKeyValueStorage().getItem(this.getLastAuthUserKey())??"username"}async setOAuthMetadata(r){const{oauthMetadata:a}=await this.getAuthKeys();await this.getKeyValueStorage().setItem(a,JSON.stringify(r))}async getOAuthMetadata(){const{oauthMetadata:r}=await this.getAuthKeys(),a=await this.getKeyValueStorage().getItem(r);return a&&JSON.parse(a)}}const BB=(t,r)=>cb(zB)(`${t}`,r);function cb(t){const r=Object.values({...t});return(a,c)=>r.reduce((f,_)=>({...f,[_]:`${a}.${c}.${_}`}),{})}const dA="amplify-signin-with-hostedUI",Is="CognitoIdentityServiceProvider";class LB{constructor(r){this.keyValueStorage=r}async clearOAuthInflightData(){Vi(this.cognitoConfig);const r=ks(Is,this.cognitoConfig.userPoolClientId);await Promise.all([this.keyValueStorage.removeItem(r.inflightOAuth),this.keyValueStorage.removeItem(r.oauthPKCE),this.keyValueStorage.removeItem(r.oauthState)])}async clearOAuthData(){Vi(this.cognitoConfig);const r=ks(Is,this.cognitoConfig.userPoolClientId);return await this.clearOAuthInflightData(),await this.keyValueStorage.removeItem(dA),this.keyValueStorage.removeItem(r.oauthSignIn)}loadOAuthState(){Vi(this.cognitoConfig);const r=ks(Is,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(r.oauthState)}storeOAuthState(r){Vi(this.cognitoConfig);const a=ks(Is,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(a.oauthState,r)}loadPKCE(){Vi(this.cognitoConfig);const r=ks(Is,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(r.oauthPKCE)}storePKCE(r){Vi(this.cognitoConfig);const a=ks(Is,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(a.oauthPKCE,r)}setAuthConfig(r){this.cognitoConfig=r}async loadOAuthInFlight(){Vi(this.cognitoConfig);const r=ks(Is,this.cognitoConfig.userPoolClientId);return await this.keyValueStorage.getItem(r.inflightOAuth)==="true"}async storeOAuthInFlight(r){Vi(this.cognitoConfig);const a=ks(Is,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(a.inflightOAuth,`${r}`)}async loadOAuthSignIn(){var _;Vi(this.cognitoConfig);const r=ks(Is,this.cognitoConfig.userPoolClientId),a=await this.keyValueStorage.getItem(dA),[c,f]=((_=await this.keyValueStorage.getItem(r.oauthSignIn))==null?void 0:_.split(","))??[];return{isOAuthSignIn:c==="true"||a==="true",preferPrivateSession:f==="true"}}async storeOAuthSignIn(r,a=!1){Vi(this.cognitoConfig);const c=ks(Is,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(c.oauthSignIn,`${r},${a}`)}}const ks=(t,r)=>cb(mB)(t,r),pA=new LB(Vp),FB=[],OB=t=>{FB.push(t)};class NB{constructor(){this.waitForInflightOAuth=vR()?async()=>{if(await pA.loadOAuthInFlight())return this.inflightPromise?this.inflightPromise:(this.inflightPromise=new Promise((r,a)=>{OB(r)}),this.inflightPromise)}:async()=>{}}setAuthConfig(r){pA.setAuthConfig(r.Cognito),this.authConfig=r}setTokenRefresher(r){this.tokenRefresher=r}setAuthTokenStore(r){this.tokenStore=r}getTokenStore(){if(!this.tokenStore)throw new Xr({name:"EmptyTokenStoreException",message:"TokenStore not set"});return this.tokenStore}getTokenRefresher(){if(!this.tokenRefresher)throw new Xr({name:"EmptyTokenRefresherException",message:"TokenRefresher not set"});return this.tokenRefresher}async getTokens(r){var b,s,S,C,k;let a;try{Vi((b=this.authConfig)==null?void 0:b.Cognito)}catch{return null}await this.waitForInflightOAuth(),this.inflightPromise=void 0,a=await this.getTokenStore().loadTokens();const c=await this.getTokenStore().getLastAuthUser();if(a===null)return null;const f=!!(a!=null&&a.idToken)&&uA({expiresAt:(((S=(s=a.idToken)==null?void 0:s.payload)==null?void 0:S.exp)??0)*1e3,clockDrift:a.clockDrift??0}),_=uA({expiresAt:(((k=(C=a.accessToken)==null?void 0:C.payload)==null?void 0:k.exp)??0)*1e3,clockDrift:a.clockDrift??0});return(r!=null&&r.forceRefresh||f||_)&&(a=await this.refreshTokens({tokens:a,username:c}),a===null)?null:{accessToken:a==null?void 0:a.accessToken,idToken:a==null?void 0:a.idToken,signInDetails:a==null?void 0:a.signInDetails}}async refreshTokens({tokens:r,username:a}){try{const{signInDetails:c}=r,f=await this.getTokenRefresher()({tokens:r,authConfig:this.authConfig,username:a});return f.signInDetails=c,await this.setTokens({tokens:f}),Xv.dispatch("auth",{event:"tokenRefresh"},"Auth",tg),f}catch(c){return this.handleErrors(c)}}handleErrors(r){if(jp(r),r.name!==Ec.NetworkError&&this.clearTokens(),Xv.dispatch("auth",{event:"tokenRefresh_failure",data:{error:r}},"Auth",tg),r.name.startsWith("NotAuthorizedException"))return null;throw r}async setTokens({tokens:r}){return this.getTokenStore().storeTokens(r)}async clearTokens(){return this.getTokenStore().clearTokens()}getDeviceMetadata(r){return this.getTokenStore().getDeviceMetadata(r)}clearDeviceMetadata(r){return this.getTokenStore().clearDeviceMetadata(r)}setOAuthMetadata(r){return this.getTokenStore().setOAuthMetadata(r)}getOAuthMetadata(){return this.getTokenStore().getOAuthMetadata()}}class UB{constructor(){this.authTokenStore=new RB,this.authTokenStore.setKeyValueStorage(Vp),this.tokenOrchestrator=new NB,this.tokenOrchestrator.setAuthTokenStore(this.authTokenStore),this.tokenOrchestrator.setTokenRefresher(PB)}getTokens({forceRefresh:r}={forceRefresh:!1}){return this.tokenOrchestrator.getTokens({forceRefresh:r})}setKeyValueStorage(r){this.authTokenStore.setKeyValueStorage(r)}setAuthConfig(r){this.authTokenStore.setAuthConfig(r),this.tokenOrchestrator.setAuthConfig(r)}}const Hm=new UB,VB={identityId:"identityId"},jB=new us("DefaultIdentityIdStore");class $B{setAuthConfig(r){E0(r.Cognito),this.authConfig=r,this._authKeys=WB("Cognito",r.Cognito.identityPoolId)}constructor(r){this._authKeys={},this._hasGuestIdentityId=!1,this.keyValueStorage=r}async loadIdentityId(){var r;E0((r=this.authConfig)==null?void 0:r.Cognito);try{if(this._primaryIdentityId)return{id:this._primaryIdentityId,type:"primary"};{const a=await this.keyValueStorage.getItem(this._authKeys.identityId);return a?(this._hasGuestIdentityId=!0,{id:a,type:"guest"}):null}}catch(a){return jB.log("Error getting stored IdentityId.",a),null}}async storeIdentityId(r){var a;E0((a=this.authConfig)==null?void 0:a.Cognito),r.type==="guest"?(this.keyValueStorage.setItem(this._authKeys.identityId,r.id),this._primaryIdentityId=void 0,this._hasGuestIdentityId=!0):(this._primaryIdentityId=r.id,this._hasGuestIdentityId&&(this.keyValueStorage.removeItem(this._authKeys.identityId),this._hasGuestIdentityId=!1))}async clearIdentityId(){this._primaryIdentityId=void 0,await this.keyValueStorage.removeItem(this._authKeys.identityId)}}const WB=(t,r)=>cb(VB)(`com.amplify.${t}`,r);function Xk(t){const r=Np(t).payload.iss,a={};if(!r)throw new Xr({name:"InvalidIdTokenException",message:"Invalid Idtoken."});const c=r.replace(/(^\w+:|^)\/\//,"");return a[c]=t,a}async function qB({tokens:t,authConfig:r,identityIdStore:a}){a.setAuthConfig({Cognito:r});const c=await a.loadIdentityId();if(c)return c.id;const f=t!=null&&t.idToken?Xk(t.idToken.toString()):{},_=await GB(f,r);return a.storeIdentityId({id:_,type:t?"primary":"guest"}),_}async function GB(t,r){const a=r==null?void 0:r.identityPoolId,c=Yv(a);let f;try{f=(await ZR({region:c},{IdentityPoolId:a,Logins:t})).IdentityId}catch(_){throw jp(_),new Xr(_)}if(!f)throw new Xr({name:"GetIdResponseException",message:"Received undefined response from getId operation",recoverySuggestion:"Make sure to pass a valid identityPoolId in the configuration."});return f}const Zm=new us("CognitoCredentialsProvider"),fA=50*60*1e3;class HB{constructor(r){this._nextCredentialsRefresh=0,this._identityIdStore=r}async clearCredentialsAndIdentityId(){Zm.debug("Clearing out credentials and identityId"),this._credentialsAndIdentityId=void 0,await this._identityIdStore.clearIdentityId()}async clearCredentials(){Zm.debug("Clearing out in-memory credentials"),this._credentialsAndIdentityId=void 0}async getCredentialsAndIdentityId(r){const a=r.authenticated,{tokens:c}=r,{authConfig:f}=r;try{E0(f==null?void 0:f.Cognito)}catch{return}if(!a&&!f.Cognito.allowGuestAccess)return;const{forceRefresh:_}=r,b=this.hasTokenChanged(c),s=await qB({tokens:c,authConfig:f.Cognito,identityIdStore:this._identityIdStore});return(_||b)&&this.clearCredentials(),a?(hB(c),this.credsForOIDCTokens(f.Cognito,c,s)):this.getGuestCredentials(s,f.Cognito)}async getGuestCredentials(r,a){var _,b;if(this._credentialsAndIdentityId&&!this.isPastTTL()&&this._credentialsAndIdentityId.isAuthenticatedCreds===!1)return Zm.info("returning stored credentials as they neither past TTL nor expired."),this._credentialsAndIdentityId;this.clearCredentials();const c=Yv(a.identityPoolId);let f;try{f=await lA({region:c},{IdentityId:r})}catch(s){throw jp(s),new Xr(s)}if((_=f==null?void 0:f.Credentials)!=null&&_.AccessKeyId&&((b=f==null?void 0:f.Credentials)!=null&&b.SecretKey)){this._nextCredentialsRefresh=new Date().getTime()+fA;const s={credentials:{accessKeyId:f.Credentials.AccessKeyId,secretAccessKey:f.Credentials.SecretKey,sessionToken:f.Credentials.SessionToken,expiration:f.Credentials.Expiration},identityId:r};return f.IdentityId&&(s.identityId=f.IdentityId,this._identityIdStore.storeIdentityId({id:f.IdentityId,type:"guest"})),this._credentialsAndIdentityId={...s,isAuthenticatedCreds:!1},s}else throw new Xr({name:"CredentialsNotFoundException",message:"Cognito did not respond with either Credentials, AccessKeyId or SecretKey."})}async credsForOIDCTokens(r,a,c){var s,S,C;if(this._credentialsAndIdentityId&&!this.isPastTTL()&&this._credentialsAndIdentityId.isAuthenticatedCreds===!0)return Zm.debug("returning stored credentials as they neither past TTL nor expired."),this._credentialsAndIdentityId;this.clearCredentials();const f=a.idToken?Xk(a.idToken.toString()):{},_=Yv(r.identityPoolId);let b;try{b=await lA({region:_},{IdentityId:c,Logins:f})}catch(k){throw jp(k),new Xr(k)}if((s=b==null?void 0:b.Credentials)!=null&&s.AccessKeyId&&((S=b==null?void 0:b.Credentials)!=null&&S.SecretKey)){this._nextCredentialsRefresh=new Date().getTime()+fA;const k={credentials:{accessKeyId:b.Credentials.AccessKeyId,secretAccessKey:b.Credentials.SecretKey,sessionToken:b.Credentials.SessionToken,expiration:b.Credentials.Expiration},identityId:c};return b.IdentityId&&(k.identityId=b.IdentityId,this._identityIdStore.storeIdentityId({id:b.IdentityId,type:"primary"})),this._credentialsAndIdentityId={...k,isAuthenticatedCreds:!0,associatedIdToken:(C=a.idToken)==null?void 0:C.toString()},k}else throw new Xr({name:"CredentialsException",message:"Cognito did not respond with either Credentials, AccessKeyId or SecretKey."})}isPastTTL(){return this._nextCredentialsRefresh===void 0?!0:this._nextCredentialsRefresh<=Date.now()}hasTokenChanged(r){var a,c;return!!r&&!!((a=this._credentialsAndIdentityId)!=null&&a.associatedIdToken)&&((c=r.idToken)==null?void 0:c.toString())!==this._credentialsAndIdentityId.associatedIdToken}}const ZB=new HB(new $B(Vp)),XB={configure(t,r){const a=Ck(t);if(!a.Auth){Ha.configure(a,r);return}if(r!=null&&r.Auth){Ha.configure(a,r);return}if(!Ha.libraryOptions.Auth){Hm.setAuthConfig(a.Auth),Hm.setKeyValueStorage(r!=null&&r.ssr?new cA({sameSite:"lax"}):Vp),Ha.configure(a,{...r,Auth:{tokenProvider:Hm,credentialsProvider:ZB}});return}if(r){r.ssr!==void 0&&Hm.setKeyValueStorage(r.ssr?new cA({sameSite:"lax"}):Vp),Ha.configure(a,{Auth:Ha.libraryOptions.Auth,...r});return}Ha.configure(a)},getConfig(){return Ha.getConfig()}};/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */var KB={oauth:{domain:"authcori.auth.us-east-1.amazoncognito.com"}},YB="us-east-1",JB="us-east-1_QeA4600FA",QB="5eusi16g0o2q1g1rr5ehgudodm",eL="authcori.auth.us-east-1.amazoncognito.com",tL="us-east-1",rL="us-east-1:2194a76a-fa3d-4c33-999e-e3c4b2b049ee",nL=["EMAIL"],iL=["EMAIL","OPENID"],oL=["EMAIL","OPENID"],sL={passwordPolicyMinLength:8,passwordPolicyCharacters:["REQUIRES_NUMBERS","REQUIRES_LOWERCASE","REQUIRES_UPPERCASE","REQUIRES_SYMBOLS"]},aL="https://bdkxhfgus5dztobic7gvn5ymue.appsync-api.us-east-1.amazonaws.com/graphql",lL="us-east-1",cL="da2-yexc3mow25fc3amaendi4vscuq",uL="API_KEY",hL="AMAZON_COGNITO_USER_POOLS,AWS_IAM",dL={version:1,models:{Todo:{name:"Todo",fields:{id:{name:"id",isArray:!1,type:"ID",isRequired:!0,attributes:[]},content:{name:"content",isArray:!1,type:"String",isRequired:!1,attributes:[]},owner:{name:"owner",isArray:!1,type:"String",isRequired:!1,attributes:[]},createdAt:{name:"createdAt",isArray:!1,type:"AWSDateTime",isRequired:!0,attributes:[]},updatedAt:{name:"updatedAt",isArray:!1,type:"AWSDateTime",isRequired:!0,attributes:[]}},syncable:!0,pluralName:"Todos",attributes:[{type:"model",properties:{}},{type:"key",properties:{fields:["id"]}},{type:"auth",properties:{rules:[{provider:"userPools",ownerField:"owner",allow:"owner",identityClaim:"cognito:username",operations:["create","update","delete","read"]},{allow:"public",operations:["read"]}]}}],primaryKeyInfo:{isCustomPrimaryKey:!1,primaryKeyFieldName:"id",sortKeyFieldNames:[]}}},enums:{},nonModels:{}},pL={Auth:KB,aws_project_region:YB,aws_user_pools_id:JB,aws_user_pools_web_client_id:QB,aws_cognito_domain:eL,aws_cognito_region:tL,aws_cognito_identity_pool_id:rL,aws_cognito_signup_attributes:nL,aws_cognito_username_attributes:iL,aws_cognito_verification_mechanisms:oL,aws_cognito_password_protection_settings:sL,aws_appsync_graphqlEndpoint:aL,aws_appsync_region:lL,aws_appsync_apiKey:cL,aws_appsync_authenticationType:uL,aws_appsync_additionalAuthenticationTypes:hL,modelIntrospection:dL};/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */XB.configure(pL);const fL={domain:void 0,region:void 0,identityPoolId:void 0,userPoolId:void 0,userPoolClientId:void 0};wt.createContext(fL);function Kk(t,r){return function(){return t.apply(r,arguments)}}const{toString:mL}=Object.prototype,{getPrototypeOf:ub}=Object,zg=(t=>r=>{const a=mL.call(r);return t[a]||(t[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),ps=t=>(t=t.toLowerCase(),r=>zg(r)===t),Dg=t=>r=>typeof r===t,{isArray:hh}=Array,$p=Dg("undefined");function gL(t){return t!==null&&!$p(t)&&t.constructor!==null&&!$p(t.constructor)&&co(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Yk=ps("ArrayBuffer");function _L(t){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(t):r=t&&t.buffer&&Yk(t.buffer),r}const yL=Dg("string"),co=Dg("function"),Jk=Dg("number"),Mg=t=>t!==null&&typeof t=="object",xL=t=>t===!0||t===!1,A0=t=>{if(zg(t)!=="object")return!1;const r=ub(t);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},vL=ps("Date"),bL=ps("File"),wL=ps("Blob"),EL=ps("FileList"),SL=t=>Mg(t)&&co(t.pipe),AL=t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||co(t.append)&&((r=zg(t))==="formdata"||r==="object"&&co(t.toString)&&t.toString()==="[object FormData]"))},TL=ps("URLSearchParams"),[CL,IL,kL,PL]=["ReadableStream","Request","Response","Headers"].map(ps),zL=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Kp(t,r,{allOwnKeys:a=!1}={}){if(t===null||typeof t>"u")return;let c,f;if(typeof t!="object"&&(t=[t]),hh(t))for(c=0,f=t.length;c<f;c++)r.call(null,t[c],c,t);else{const _=a?Object.getOwnPropertyNames(t):Object.keys(t),b=_.length;let s;for(c=0;c<b;c++)s=_[c],r.call(null,t[s],s,t)}}function Qk(t,r){r=r.toLowerCase();const a=Object.keys(t);let c=a.length,f;for(;c-- >0;)if(f=a[c],r===f.toLowerCase())return f;return null}const mc=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),eP=t=>!$p(t)&&t!==mc;function Jv(){const{caseless:t}=eP(this)&&this||{},r={},a=(c,f)=>{const _=t&&Qk(r,f)||f;A0(r[_])&&A0(c)?r[_]=Jv(r[_],c):A0(c)?r[_]=Jv({},c):hh(c)?r[_]=c.slice():r[_]=c};for(let c=0,f=arguments.length;c<f;c++)arguments[c]&&Kp(arguments[c],a);return r}const DL=(t,r,a,{allOwnKeys:c}={})=>(Kp(r,(f,_)=>{a&&co(f)?t[_]=Kk(f,a):t[_]=f},{allOwnKeys:c}),t),ML=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),RL=(t,r,a,c)=>{t.prototype=Object.create(r.prototype,c),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),a&&Object.assign(t.prototype,a)},BL=(t,r,a,c)=>{let f,_,b;const s={};if(r=r||{},t==null)return r;do{for(f=Object.getOwnPropertyNames(t),_=f.length;_-- >0;)b=f[_],(!c||c(b,t,r))&&!s[b]&&(r[b]=t[b],s[b]=!0);t=a!==!1&&ub(t)}while(t&&(!a||a(t,r))&&t!==Object.prototype);return r},LL=(t,r,a)=>{t=String(t),(a===void 0||a>t.length)&&(a=t.length),a-=r.length;const c=t.indexOf(r,a);return c!==-1&&c===a},FL=t=>{if(!t)return null;if(hh(t))return t;let r=t.length;if(!Jk(r))return null;const a=new Array(r);for(;r-- >0;)a[r]=t[r];return a},OL=(t=>r=>t&&r instanceof t)(typeof Uint8Array<"u"&&ub(Uint8Array)),NL=(t,r)=>{const c=(t&&t[Symbol.iterator]).call(t);let f;for(;(f=c.next())&&!f.done;){const _=f.value;r.call(t,_[0],_[1])}},UL=(t,r)=>{let a;const c=[];for(;(a=t.exec(r))!==null;)c.push(a);return c},VL=ps("HTMLFormElement"),jL=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,c,f){return c.toUpperCase()+f}),mA=(({hasOwnProperty:t})=>(r,a)=>t.call(r,a))(Object.prototype),$L=ps("RegExp"),tP=(t,r)=>{const a=Object.getOwnPropertyDescriptors(t),c={};Kp(a,(f,_)=>{let b;(b=r(f,_,t))!==!1&&(c[_]=b||f)}),Object.defineProperties(t,c)},WL=t=>{tP(t,(r,a)=>{if(co(t)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const c=t[a];if(co(c)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},qL=(t,r)=>{const a={},c=f=>{f.forEach(_=>{a[_]=!0})};return hh(t)?c(t):c(String(t).split(r)),a},GL=()=>{},HL=(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r;function ZL(t){return!!(t&&co(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const XL=t=>{const r=new Array(10),a=(c,f)=>{if(Mg(c)){if(r.indexOf(c)>=0)return;if(!("toJSON"in c)){r[f]=c;const _=hh(c)?[]:{};return Kp(c,(b,s)=>{const S=a(b,f+1);!$p(S)&&(_[s]=S)}),r[f]=void 0,_}}return c};return a(t,0)},KL=ps("AsyncFunction"),YL=t=>t&&(Mg(t)||co(t))&&co(t.then)&&co(t.catch),rP=((t,r)=>t?setImmediate:r?((a,c)=>(mc.addEventListener("message",({source:f,data:_})=>{f===mc&&_===a&&c.length&&c.shift()()},!1),f=>{c.push(f),mc.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",co(mc.postMessage)),JL=typeof queueMicrotask<"u"?queueMicrotask.bind(mc):typeof process<"u"&&process.nextTick||rP,Xe={isArray:hh,isArrayBuffer:Yk,isBuffer:gL,isFormData:AL,isArrayBufferView:_L,isString:yL,isNumber:Jk,isBoolean:xL,isObject:Mg,isPlainObject:A0,isReadableStream:CL,isRequest:IL,isResponse:kL,isHeaders:PL,isUndefined:$p,isDate:vL,isFile:bL,isBlob:wL,isRegExp:$L,isFunction:co,isStream:SL,isURLSearchParams:TL,isTypedArray:OL,isFileList:EL,forEach:Kp,merge:Jv,extend:DL,trim:zL,stripBOM:ML,inherits:RL,toFlatObject:BL,kindOf:zg,kindOfTest:ps,endsWith:LL,toArray:FL,forEachEntry:NL,matchAll:UL,isHTMLForm:VL,hasOwnProperty:mA,hasOwnProp:mA,reduceDescriptors:tP,freezeMethods:WL,toObjectSet:qL,toCamelCase:jL,noop:GL,toFiniteNumber:HL,findKey:Qk,global:mc,isContextDefined:eP,isSpecCompliantForm:ZL,toJSONObject:XL,isAsyncFn:KL,isThenable:YL,setImmediate:rP,asap:JL};function nr(t,r,a,c,f){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),a&&(this.config=a),c&&(this.request=c),f&&(this.response=f,this.status=f.status?f.status:null)}Xe.inherits(nr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Xe.toJSONObject(this.config),code:this.code,status:this.status}}});const nP=nr.prototype,iP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{iP[t]={value:t}});Object.defineProperties(nr,iP);Object.defineProperty(nP,"isAxiosError",{value:!0});nr.from=(t,r,a,c,f,_)=>{const b=Object.create(nP);return Xe.toFlatObject(t,b,function(S){return S!==Error.prototype},s=>s!=="isAxiosError"),nr.call(b,t.message,r,a,c,f),b.cause=t,b.name=t.name,_&&Object.assign(b,_),b};const QL=null;function Qv(t){return Xe.isPlainObject(t)||Xe.isArray(t)}function oP(t){return Xe.endsWith(t,"[]")?t.slice(0,-2):t}function gA(t,r,a){return t?t.concat(r).map(function(f,_){return f=oP(f),!a&&_?"["+f+"]":f}).join(a?".":""):r}function eF(t){return Xe.isArray(t)&&!t.some(Qv)}const tF=Xe.toFlatObject(Xe,{},null,function(r){return/^is[A-Z]/.test(r)});function Rg(t,r,a){if(!Xe.isObject(t))throw new TypeError("target must be an object");r=r||new FormData,a=Xe.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(j,H){return!Xe.isUndefined(H[j])});const c=a.metaTokens,f=a.visitor||k,_=a.dots,b=a.indexes,S=(a.Blob||typeof Blob<"u"&&Blob)&&Xe.isSpecCompliantForm(r);if(!Xe.isFunction(f))throw new TypeError("visitor must be a function");function C(O){if(O===null)return"";if(Xe.isDate(O))return O.toISOString();if(!S&&Xe.isBlob(O))throw new nr("Blob is not supported. Use a Buffer instead.");return Xe.isArrayBuffer(O)||Xe.isTypedArray(O)?S&&typeof Blob=="function"?new Blob([O]):Buffer.from(O):O}function k(O,j,H){let Z=O;if(O&&!H&&typeof O=="object"){if(Xe.endsWith(j,"{}"))j=c?j:j.slice(0,-2),O=JSON.stringify(O);else if(Xe.isArray(O)&&eF(O)||(Xe.isFileList(O)||Xe.endsWith(j,"[]"))&&(Z=Xe.toArray(O)))return j=oP(j),Z.forEach(function($,J){!(Xe.isUndefined($)||$===null)&&r.append(b===!0?gA([j],J,_):b===null?j:j+"[]",C($))}),!1}return Qv(O)?!0:(r.append(gA(H,j,_),C(O)),!1)}const M=[],L=Object.assign(tF,{defaultVisitor:k,convertValue:C,isVisitable:Qv});function V(O,j){if(!Xe.isUndefined(O)){if(M.indexOf(O)!==-1)throw Error("Circular reference detected in "+j.join("."));M.push(O),Xe.forEach(O,function(Z,U){(!(Xe.isUndefined(Z)||Z===null)&&f.call(r,Z,Xe.isString(U)?U.trim():U,j,L))===!0&&V(Z,j?j.concat(U):[U])}),M.pop()}}if(!Xe.isObject(t))throw new TypeError("data must be an object");return V(t),r}function _A(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(c){return r[c]})}function hb(t,r){this._pairs=[],t&&Rg(t,this,r)}const sP=hb.prototype;sP.append=function(r,a){this._pairs.push([r,a])};sP.toString=function(r){const a=r?function(c){return r.call(this,c,_A)}:_A;return this._pairs.map(function(f){return a(f[0])+"="+a(f[1])},"").join("&")};function rF(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function aP(t,r,a){if(!r)return t;const c=a&&a.encode||rF;Xe.isFunction(a)&&(a={serialize:a});const f=a&&a.serialize;let _;if(f?_=f(r,a):_=Xe.isURLSearchParams(r)?r.toString():new hb(r,a).toString(c),_){const b=t.indexOf("#");b!==-1&&(t=t.slice(0,b)),t+=(t.indexOf("?")===-1?"?":"&")+_}return t}class nF{constructor(){this.handlers=[]}use(r,a,c){return this.handlers.push({fulfilled:r,rejected:a,synchronous:c?c.synchronous:!1,runWhen:c?c.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){Xe.forEach(this.handlers,function(c){c!==null&&r(c)})}}const yA=nF,lP={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},iF=typeof URLSearchParams<"u"?URLSearchParams:hb,oF=typeof FormData<"u"?FormData:null,sF=typeof Blob<"u"?Blob:null,aF={isBrowser:!0,classes:{URLSearchParams:iF,FormData:oF,Blob:sF},protocols:["http","https","file","blob","url","data"]},db=typeof window<"u"&&typeof document<"u",e1=typeof navigator=="object"&&navigator||void 0,lF=db&&(!e1||["ReactNative","NativeScript","NS"].indexOf(e1.product)<0),cF=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),uF=db&&window.location.href||"http://localhost",hF=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:db,hasStandardBrowserEnv:lF,hasStandardBrowserWebWorkerEnv:cF,navigator:e1,origin:uF},Symbol.toStringTag,{value:"Module"})),bi={...hF,...aF};function dF(t,r){return Rg(t,new bi.classes.URLSearchParams,Object.assign({visitor:function(a,c,f,_){return bi.isNode&&Xe.isBuffer(a)?(this.append(c,a.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},r))}function pF(t){return Xe.matchAll(/\w+|\[(\w*)]/g,t).map(r=>r[0]==="[]"?"":r[1]||r[0])}function fF(t){const r={},a=Object.keys(t);let c;const f=a.length;let _;for(c=0;c<f;c++)_=a[c],r[_]=t[_];return r}function cP(t){function r(a,c,f,_){let b=a[_++];if(b==="__proto__")return!0;const s=Number.isFinite(+b),S=_>=a.length;return b=!b&&Xe.isArray(f)?f.length:b,S?(Xe.hasOwnProp(f,b)?f[b]=[f[b],c]:f[b]=c,!s):((!f[b]||!Xe.isObject(f[b]))&&(f[b]=[]),r(a,c,f[b],_)&&Xe.isArray(f[b])&&(f[b]=fF(f[b])),!s)}if(Xe.isFormData(t)&&Xe.isFunction(t.entries)){const a={};return Xe.forEachEntry(t,(c,f)=>{r(pF(c),f,a,0)}),a}return null}function mF(t,r,a){if(Xe.isString(t))try{return(r||JSON.parse)(t),Xe.trim(t)}catch(c){if(c.name!=="SyntaxError")throw c}return(a||JSON.stringify)(t)}const pb={transitional:lP,adapter:["xhr","http","fetch"],transformRequest:[function(r,a){const c=a.getContentType()||"",f=c.indexOf("application/json")>-1,_=Xe.isObject(r);if(_&&Xe.isHTMLForm(r)&&(r=new FormData(r)),Xe.isFormData(r))return f?JSON.stringify(cP(r)):r;if(Xe.isArrayBuffer(r)||Xe.isBuffer(r)||Xe.isStream(r)||Xe.isFile(r)||Xe.isBlob(r)||Xe.isReadableStream(r))return r;if(Xe.isArrayBufferView(r))return r.buffer;if(Xe.isURLSearchParams(r))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let s;if(_){if(c.indexOf("application/x-www-form-urlencoded")>-1)return dF(r,this.formSerializer).toString();if((s=Xe.isFileList(r))||c.indexOf("multipart/form-data")>-1){const S=this.env&&this.env.FormData;return Rg(s?{"files[]":r}:r,S&&new S,this.formSerializer)}}return _||f?(a.setContentType("application/json",!1),mF(r)):r}],transformResponse:[function(r){const a=this.transitional||pb.transitional,c=a&&a.forcedJSONParsing,f=this.responseType==="json";if(Xe.isResponse(r)||Xe.isReadableStream(r))return r;if(r&&Xe.isString(r)&&(c&&!this.responseType||f)){const b=!(a&&a.silentJSONParsing)&&f;try{return JSON.parse(r)}catch(s){if(b)throw s.name==="SyntaxError"?nr.from(s,nr.ERR_BAD_RESPONSE,this,null,this.response):s}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:bi.classes.FormData,Blob:bi.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Xe.forEach(["delete","get","head","post","put","patch"],t=>{pb.headers[t]={}});const fb=pb,gF=Xe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_F=t=>{const r={};let a,c,f;return t&&t.split(`
`).forEach(function(b){f=b.indexOf(":"),a=b.substring(0,f).trim().toLowerCase(),c=b.substring(f+1).trim(),!(!a||r[a]&&gF[a])&&(a==="set-cookie"?r[a]?r[a].push(c):r[a]=[c]:r[a]=r[a]?r[a]+", "+c:c)}),r},xA=Symbol("internals");function ip(t){return t&&String(t).trim().toLowerCase()}function T0(t){return t===!1||t==null?t:Xe.isArray(t)?t.map(T0):String(t)}function yF(t){const r=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let c;for(;c=a.exec(t);)r[c[1]]=c[2];return r}const xF=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function nx(t,r,a,c,f){if(Xe.isFunction(c))return c.call(this,r,a);if(f&&(r=a),!!Xe.isString(r)){if(Xe.isString(c))return r.indexOf(c)!==-1;if(Xe.isRegExp(c))return c.test(r)}}function vF(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,a,c)=>a.toUpperCase()+c)}function bF(t,r){const a=Xe.toCamelCase(" "+r);["get","set","has"].forEach(c=>{Object.defineProperty(t,c+a,{value:function(f,_,b){return this[c].call(this,r,f,_,b)},configurable:!0})})}class Bg{constructor(r){r&&this.set(r)}set(r,a,c){const f=this;function _(s,S,C){const k=ip(S);if(!k)throw new Error("header name must be a non-empty string");const M=Xe.findKey(f,k);(!M||f[M]===void 0||C===!0||C===void 0&&f[M]!==!1)&&(f[M||S]=T0(s))}const b=(s,S)=>Xe.forEach(s,(C,k)=>_(C,k,S));if(Xe.isPlainObject(r)||r instanceof this.constructor)b(r,a);else if(Xe.isString(r)&&(r=r.trim())&&!xF(r))b(_F(r),a);else if(Xe.isHeaders(r))for(const[s,S]of r.entries())_(S,s,c);else r!=null&&_(a,r,c);return this}get(r,a){if(r=ip(r),r){const c=Xe.findKey(this,r);if(c){const f=this[c];if(!a)return f;if(a===!0)return yF(f);if(Xe.isFunction(a))return a.call(this,f,c);if(Xe.isRegExp(a))return a.exec(f);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,a){if(r=ip(r),r){const c=Xe.findKey(this,r);return!!(c&&this[c]!==void 0&&(!a||nx(this,this[c],c,a)))}return!1}delete(r,a){const c=this;let f=!1;function _(b){if(b=ip(b),b){const s=Xe.findKey(c,b);s&&(!a||nx(c,c[s],s,a))&&(delete c[s],f=!0)}}return Xe.isArray(r)?r.forEach(_):_(r),f}clear(r){const a=Object.keys(this);let c=a.length,f=!1;for(;c--;){const _=a[c];(!r||nx(this,this[_],_,r,!0))&&(delete this[_],f=!0)}return f}normalize(r){const a=this,c={};return Xe.forEach(this,(f,_)=>{const b=Xe.findKey(c,_);if(b){a[b]=T0(f),delete a[_];return}const s=r?vF(_):String(_).trim();s!==_&&delete a[_],a[s]=T0(f),c[s]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const a=Object.create(null);return Xe.forEach(this,(c,f)=>{c!=null&&c!==!1&&(a[f]=r&&Xe.isArray(c)?c.join(", "):c)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,a])=>r+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...a){const c=new this(r);return a.forEach(f=>c.set(f)),c}static accessor(r){const c=(this[xA]=this[xA]={accessors:{}}).accessors,f=this.prototype;function _(b){const s=ip(b);c[s]||(bF(f,b),c[s]=!0)}return Xe.isArray(r)?r.forEach(_):_(r),this}}Bg.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Xe.reduceDescriptors(Bg.prototype,({value:t},r)=>{let a=r[0].toUpperCase()+r.slice(1);return{get:()=>t,set(c){this[a]=c}}});Xe.freezeMethods(Bg);const hs=Bg;function ix(t,r){const a=this||fb,c=r||a,f=hs.from(c.headers);let _=c.data;return Xe.forEach(t,function(s){_=s.call(a,_,f.normalize(),r?r.status:void 0)}),f.normalize(),_}function uP(t){return!!(t&&t.__CANCEL__)}function dh(t,r,a){nr.call(this,t??"canceled",nr.ERR_CANCELED,r,a),this.name="CanceledError"}Xe.inherits(dh,nr,{__CANCEL__:!0});function hP(t,r,a){const c=a.config.validateStatus;!a.status||!c||c(a.status)?t(a):r(new nr("Request failed with status code "+a.status,[nr.ERR_BAD_REQUEST,nr.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function wF(t){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return r&&r[1]||""}function EF(t,r){t=t||10;const a=new Array(t),c=new Array(t);let f=0,_=0,b;return r=r!==void 0?r:1e3,function(S){const C=Date.now(),k=c[_];b||(b=C),a[f]=S,c[f]=C;let M=_,L=0;for(;M!==f;)L+=a[M++],M=M%t;if(f=(f+1)%t,f===_&&(_=(_+1)%t),C-b<r)return;const V=k&&C-k;return V?Math.round(L*1e3/V):void 0}}function SF(t,r){let a=0,c=1e3/r,f,_;const b=(C,k=Date.now())=>{a=k,f=null,_&&(clearTimeout(_),_=null),t.apply(null,C)};return[(...C)=>{const k=Date.now(),M=k-a;M>=c?b(C,k):(f=C,_||(_=setTimeout(()=>{_=null,b(f)},c-M)))},()=>f&&b(f)]}const ig=(t,r,a=3)=>{let c=0;const f=EF(50,250);return SF(_=>{const b=_.loaded,s=_.lengthComputable?_.total:void 0,S=b-c,C=f(S),k=b<=s;c=b;const M={loaded:b,total:s,progress:s?b/s:void 0,bytes:S,rate:C||void 0,estimated:C&&s&&k?(s-b)/C:void 0,event:_,lengthComputable:s!=null,[r?"download":"upload"]:!0};t(M)},a)},vA=(t,r)=>{const a=t!=null;return[c=>r[0]({lengthComputable:a,total:t,loaded:c}),r[1]]},bA=t=>(...r)=>Xe.asap(()=>t(...r)),AF=bi.hasStandardBrowserEnv?((t,r)=>a=>(a=new URL(a,bi.origin),t.protocol===a.protocol&&t.host===a.host&&(r||t.port===a.port)))(new URL(bi.origin),bi.navigator&&/(msie|trident)/i.test(bi.navigator.userAgent)):()=>!0,TF=bi.hasStandardBrowserEnv?{write(t,r,a,c,f,_){const b=[t+"="+encodeURIComponent(r)];Xe.isNumber(a)&&b.push("expires="+new Date(a).toGMTString()),Xe.isString(c)&&b.push("path="+c),Xe.isString(f)&&b.push("domain="+f),_===!0&&b.push("secure"),document.cookie=b.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function CF(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function IF(t,r){return r?t.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):t}function dP(t,r,a){let c=!CF(r);return t&&(c||a==!1)?IF(t,r):r}const wA=t=>t instanceof hs?{...t}:t;function Sc(t,r){r=r||{};const a={};function c(C,k,M,L){return Xe.isPlainObject(C)&&Xe.isPlainObject(k)?Xe.merge.call({caseless:L},C,k):Xe.isPlainObject(k)?Xe.merge({},k):Xe.isArray(k)?k.slice():k}function f(C,k,M,L){if(Xe.isUndefined(k)){if(!Xe.isUndefined(C))return c(void 0,C,M,L)}else return c(C,k,M,L)}function _(C,k){if(!Xe.isUndefined(k))return c(void 0,k)}function b(C,k){if(Xe.isUndefined(k)){if(!Xe.isUndefined(C))return c(void 0,C)}else return c(void 0,k)}function s(C,k,M){if(M in r)return c(C,k);if(M in t)return c(void 0,C)}const S={url:_,method:_,data:_,baseURL:b,transformRequest:b,transformResponse:b,paramsSerializer:b,timeout:b,timeoutMessage:b,withCredentials:b,withXSRFToken:b,adapter:b,responseType:b,xsrfCookieName:b,xsrfHeaderName:b,onUploadProgress:b,onDownloadProgress:b,decompress:b,maxContentLength:b,maxBodyLength:b,beforeRedirect:b,transport:b,httpAgent:b,httpsAgent:b,cancelToken:b,socketPath:b,responseEncoding:b,validateStatus:s,headers:(C,k,M)=>f(wA(C),wA(k),M,!0)};return Xe.forEach(Object.keys(Object.assign({},t,r)),function(k){const M=S[k]||f,L=M(t[k],r[k],k);Xe.isUndefined(L)&&M!==s||(a[k]=L)}),a}const pP=t=>{const r=Sc({},t);let{data:a,withXSRFToken:c,xsrfHeaderName:f,xsrfCookieName:_,headers:b,auth:s}=r;r.headers=b=hs.from(b),r.url=aP(dP(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),s&&b.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):"")));let S;if(Xe.isFormData(a)){if(bi.hasStandardBrowserEnv||bi.hasStandardBrowserWebWorkerEnv)b.setContentType(void 0);else if((S=b.getContentType())!==!1){const[C,...k]=S?S.split(";").map(M=>M.trim()).filter(Boolean):[];b.setContentType([C||"multipart/form-data",...k].join("; "))}}if(bi.hasStandardBrowserEnv&&(c&&Xe.isFunction(c)&&(c=c(r)),c||c!==!1&&AF(r.url))){const C=f&&_&&TF.read(_);C&&b.set(f,C)}return r},kF=typeof XMLHttpRequest<"u",PF=kF&&function(t){return new Promise(function(a,c){const f=pP(t);let _=f.data;const b=hs.from(f.headers).normalize();let{responseType:s,onUploadProgress:S,onDownloadProgress:C}=f,k,M,L,V,O;function j(){V&&V(),O&&O(),f.cancelToken&&f.cancelToken.unsubscribe(k),f.signal&&f.signal.removeEventListener("abort",k)}let H=new XMLHttpRequest;H.open(f.method.toUpperCase(),f.url,!0),H.timeout=f.timeout;function Z(){if(!H)return;const $=hs.from("getAllResponseHeaders"in H&&H.getAllResponseHeaders()),le={data:!s||s==="text"||s==="json"?H.responseText:H.response,status:H.status,statusText:H.statusText,headers:$,config:t,request:H};hP(function(ye){a(ye),j()},function(ye){c(ye),j()},le),H=null}"onloadend"in H?H.onloadend=Z:H.onreadystatechange=function(){!H||H.readyState!==4||H.status===0&&!(H.responseURL&&H.responseURL.indexOf("file:")===0)||setTimeout(Z)},H.onabort=function(){H&&(c(new nr("Request aborted",nr.ECONNABORTED,t,H)),H=null)},H.onerror=function(){c(new nr("Network Error",nr.ERR_NETWORK,t,H)),H=null},H.ontimeout=function(){let J=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded";const le=f.transitional||lP;f.timeoutErrorMessage&&(J=f.timeoutErrorMessage),c(new nr(J,le.clarifyTimeoutError?nr.ETIMEDOUT:nr.ECONNABORTED,t,H)),H=null},_===void 0&&b.setContentType(null),"setRequestHeader"in H&&Xe.forEach(b.toJSON(),function(J,le){H.setRequestHeader(le,J)}),Xe.isUndefined(f.withCredentials)||(H.withCredentials=!!f.withCredentials),s&&s!=="json"&&(H.responseType=f.responseType),C&&([L,O]=ig(C,!0),H.addEventListener("progress",L)),S&&H.upload&&([M,V]=ig(S),H.upload.addEventListener("progress",M),H.upload.addEventListener("loadend",V)),(f.cancelToken||f.signal)&&(k=$=>{H&&(c(!$||$.type?new dh(null,t,H):$),H.abort(),H=null)},f.cancelToken&&f.cancelToken.subscribe(k),f.signal&&(f.signal.aborted?k():f.signal.addEventListener("abort",k)));const U=wF(f.url);if(U&&bi.protocols.indexOf(U)===-1){c(new nr("Unsupported protocol "+U+":",nr.ERR_BAD_REQUEST,t));return}H.send(_||null)})},zF=(t,r)=>{const{length:a}=t=t?t.filter(Boolean):[];if(r||a){let c=new AbortController,f;const _=function(C){if(!f){f=!0,s();const k=C instanceof Error?C:this.reason;c.abort(k instanceof nr?k:new dh(k instanceof Error?k.message:k))}};let b=r&&setTimeout(()=>{b=null,_(new nr(`timeout ${r} of ms exceeded`,nr.ETIMEDOUT))},r);const s=()=>{t&&(b&&clearTimeout(b),b=null,t.forEach(C=>{C.unsubscribe?C.unsubscribe(_):C.removeEventListener("abort",_)}),t=null)};t.forEach(C=>C.addEventListener("abort",_));const{signal:S}=c;return S.unsubscribe=()=>Xe.asap(s),S}},DF=zF,MF=function*(t,r){let a=t.byteLength;if(!r||a<r){yield t;return}let c=0,f;for(;c<a;)f=c+r,yield t.slice(c,f),c=f},RF=async function*(t,r){for await(const a of BF(t))yield*MF(a,r)},BF=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const r=t.getReader();try{for(;;){const{done:a,value:c}=await r.read();if(a)break;yield c}}finally{await r.cancel()}},EA=(t,r,a,c)=>{const f=RF(t,r);let _=0,b,s=S=>{b||(b=!0,c&&c(S))};return new ReadableStream({async pull(S){try{const{done:C,value:k}=await f.next();if(C){s(),S.close();return}let M=k.byteLength;if(a){let L=_+=M;a(L)}S.enqueue(new Uint8Array(k))}catch(C){throw s(C),C}},cancel(S){return s(S),f.return()}},{highWaterMark:2})},Lg=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",fP=Lg&&typeof ReadableStream=="function",LF=Lg&&(typeof TextEncoder=="function"?(t=>r=>t.encode(r))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),mP=(t,...r)=>{try{return!!t(...r)}catch{return!1}},FF=fP&&mP(()=>{let t=!1;const r=new Request(bi.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),SA=64*1024,t1=fP&&mP(()=>Xe.isReadableStream(new Response("").body)),og={stream:t1&&(t=>t.body)};Lg&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(r=>{!og[r]&&(og[r]=Xe.isFunction(t[r])?a=>a[r]():(a,c)=>{throw new nr(`Response type '${r}' is not supported`,nr.ERR_NOT_SUPPORT,c)})})})(new Response);const OF=async t=>{if(t==null)return 0;if(Xe.isBlob(t))return t.size;if(Xe.isSpecCompliantForm(t))return(await new Request(bi.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(Xe.isArrayBufferView(t)||Xe.isArrayBuffer(t))return t.byteLength;if(Xe.isURLSearchParams(t)&&(t=t+""),Xe.isString(t))return(await LF(t)).byteLength},NF=async(t,r)=>{const a=Xe.toFiniteNumber(t.getContentLength());return a??OF(r)},UF=Lg&&(async t=>{let{url:r,method:a,data:c,signal:f,cancelToken:_,timeout:b,onDownloadProgress:s,onUploadProgress:S,responseType:C,headers:k,withCredentials:M="same-origin",fetchOptions:L}=pP(t);C=C?(C+"").toLowerCase():"text";let V=DF([f,_&&_.toAbortSignal()],b),O;const j=V&&V.unsubscribe&&(()=>{V.unsubscribe()});let H;try{if(S&&FF&&a!=="get"&&a!=="head"&&(H=await NF(k,c))!==0){let le=new Request(r,{method:"POST",body:c,duplex:"half"}),pe;if(Xe.isFormData(c)&&(pe=le.headers.get("content-type"))&&k.setContentType(pe),le.body){const[ye,Te]=vA(H,ig(bA(S)));c=EA(le.body,SA,ye,Te)}}Xe.isString(M)||(M=M?"include":"omit");const Z="credentials"in Request.prototype;O=new Request(r,{...L,signal:V,method:a.toUpperCase(),headers:k.normalize().toJSON(),body:c,duplex:"half",credentials:Z?M:void 0});let U=await fetch(O);const $=t1&&(C==="stream"||C==="response");if(t1&&(s||$&&j)){const le={};["status","statusText","headers"].forEach(Se=>{le[Se]=U[Se]});const pe=Xe.toFiniteNumber(U.headers.get("content-length")),[ye,Te]=s&&vA(pe,ig(bA(s),!0))||[];U=new Response(EA(U.body,SA,ye,()=>{Te&&Te(),j&&j()}),le)}C=C||"text";let J=await og[Xe.findKey(og,C)||"text"](U,t);return!$&&j&&j(),await new Promise((le,pe)=>{hP(le,pe,{data:J,headers:hs.from(U.headers),status:U.status,statusText:U.statusText,config:t,request:O})})}catch(Z){throw j&&j(),Z&&Z.name==="TypeError"&&/fetch/i.test(Z.message)?Object.assign(new nr("Network Error",nr.ERR_NETWORK,t,O),{cause:Z.cause||Z}):nr.from(Z,Z&&Z.code,t,O)}}),r1={http:QL,xhr:PF,fetch:UF};Xe.forEach(r1,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const AA=t=>`- ${t}`,VF=t=>Xe.isFunction(t)||t===null||t===!1,gP={getAdapter:t=>{t=Xe.isArray(t)?t:[t];const{length:r}=t;let a,c;const f={};for(let _=0;_<r;_++){a=t[_];let b;if(c=a,!VF(a)&&(c=r1[(b=String(a)).toLowerCase()],c===void 0))throw new nr(`Unknown adapter '${b}'`);if(c)break;f[b||"#"+_]=c}if(!c){const _=Object.entries(f).map(([s,S])=>`adapter ${s} `+(S===!1?"is not supported by the environment":"is not available in the build"));let b=r?_.length>1?`since :
`+_.map(AA).join(`
`):" "+AA(_[0]):"as no adapter specified";throw new nr("There is no suitable adapter to dispatch the request "+b,"ERR_NOT_SUPPORT")}return c},adapters:r1};function ox(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new dh(null,t)}function TA(t){return ox(t),t.headers=hs.from(t.headers),t.data=ix.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),gP.getAdapter(t.adapter||fb.adapter)(t).then(function(c){return ox(t),c.data=ix.call(t,t.transformResponse,c),c.headers=hs.from(c.headers),c},function(c){return uP(c)||(ox(t),c&&c.response&&(c.response.data=ix.call(t,t.transformResponse,c.response),c.response.headers=hs.from(c.response.headers))),Promise.reject(c)})}const _P="1.8.4",Fg={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{Fg[t]=function(c){return typeof c===t||"a"+(r<1?"n ":" ")+t}});const CA={};Fg.transitional=function(r,a,c){function f(_,b){return"[Axios v"+_P+"] Transitional option '"+_+"'"+b+(c?". "+c:"")}return(_,b,s)=>{if(r===!1)throw new nr(f(b," has been removed"+(a?" in "+a:"")),nr.ERR_DEPRECATED);return a&&!CA[b]&&(CA[b]=!0,console.warn(f(b," has been deprecated since v"+a+" and will be removed in the near future"))),r?r(_,b,s):!0}};Fg.spelling=function(r){return(a,c)=>(console.warn(`${c} is likely a misspelling of ${r}`),!0)};function jF(t,r,a){if(typeof t!="object")throw new nr("options must be an object",nr.ERR_BAD_OPTION_VALUE);const c=Object.keys(t);let f=c.length;for(;f-- >0;){const _=c[f],b=r[_];if(b){const s=t[_],S=s===void 0||b(s,_,t);if(S!==!0)throw new nr("option "+_+" must be "+S,nr.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new nr("Unknown option "+_,nr.ERR_BAD_OPTION)}}const C0={assertOptions:jF,validators:Fg},Ps=C0.validators;class sg{constructor(r){this.defaults=r,this.interceptors={request:new yA,response:new yA}}async request(r,a){try{return await this._request(r,a)}catch(c){if(c instanceof Error){let f={};Error.captureStackTrace?Error.captureStackTrace(f):f=new Error;const _=f.stack?f.stack.replace(/^.+\n/,""):"";try{c.stack?_&&!String(c.stack).endsWith(_.replace(/^.+\n.+\n/,""))&&(c.stack+=`
`+_):c.stack=_}catch{}}throw c}}_request(r,a){typeof r=="string"?(a=a||{},a.url=r):a=r||{},a=Sc(this.defaults,a);const{transitional:c,paramsSerializer:f,headers:_}=a;c!==void 0&&C0.assertOptions(c,{silentJSONParsing:Ps.transitional(Ps.boolean),forcedJSONParsing:Ps.transitional(Ps.boolean),clarifyTimeoutError:Ps.transitional(Ps.boolean)},!1),f!=null&&(Xe.isFunction(f)?a.paramsSerializer={serialize:f}:C0.assertOptions(f,{encode:Ps.function,serialize:Ps.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),C0.assertOptions(a,{baseUrl:Ps.spelling("baseURL"),withXsrfToken:Ps.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let b=_&&Xe.merge(_.common,_[a.method]);_&&Xe.forEach(["delete","get","head","post","put","patch","common"],O=>{delete _[O]}),a.headers=hs.concat(b,_);const s=[];let S=!0;this.interceptors.request.forEach(function(j){typeof j.runWhen=="function"&&j.runWhen(a)===!1||(S=S&&j.synchronous,s.unshift(j.fulfilled,j.rejected))});const C=[];this.interceptors.response.forEach(function(j){C.push(j.fulfilled,j.rejected)});let k,M=0,L;if(!S){const O=[TA.bind(this),void 0];for(O.unshift.apply(O,s),O.push.apply(O,C),L=O.length,k=Promise.resolve(a);M<L;)k=k.then(O[M++],O[M++]);return k}L=s.length;let V=a;for(M=0;M<L;){const O=s[M++],j=s[M++];try{V=O(V)}catch(H){j.call(this,H);break}}try{k=TA.call(this,V)}catch(O){return Promise.reject(O)}for(M=0,L=C.length;M<L;)k=k.then(C[M++],C[M++]);return k}getUri(r){r=Sc(this.defaults,r);const a=dP(r.baseURL,r.url,r.allowAbsoluteUrls);return aP(a,r.params,r.paramsSerializer)}}Xe.forEach(["delete","get","head","options"],function(r){sg.prototype[r]=function(a,c){return this.request(Sc(c||{},{method:r,url:a,data:(c||{}).data}))}});Xe.forEach(["post","put","patch"],function(r){function a(c){return function(_,b,s){return this.request(Sc(s||{},{method:r,headers:c?{"Content-Type":"multipart/form-data"}:{},url:_,data:b}))}}sg.prototype[r]=a(),sg.prototype[r+"Form"]=a(!0)});const I0=sg;class mb{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(_){a=_});const c=this;this.promise.then(f=>{if(!c._listeners)return;let _=c._listeners.length;for(;_-- >0;)c._listeners[_](f);c._listeners=null}),this.promise.then=f=>{let _;const b=new Promise(s=>{c.subscribe(s),_=s}).then(f);return b.cancel=function(){c.unsubscribe(_)},b},r(function(_,b,s){c.reason||(c.reason=new dh(_,b,s),a(c.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const a=this._listeners.indexOf(r);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const r=new AbortController,a=c=>{r.abort(c)};return this.subscribe(a),r.signal.unsubscribe=()=>this.unsubscribe(a),r.signal}static source(){let r;return{token:new mb(function(f){r=f}),cancel:r}}}const $F=mb;function WF(t){return function(a){return t.apply(null,a)}}function qF(t){return Xe.isObject(t)&&t.isAxiosError===!0}const n1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(n1).forEach(([t,r])=>{n1[r]=t});const GF=n1;function yP(t){const r=new I0(t),a=Kk(I0.prototype.request,r);return Xe.extend(a,I0.prototype,r,{allOwnKeys:!0}),Xe.extend(a,r,null,{allOwnKeys:!0}),a.create=function(f){return yP(Sc(t,f))},a}const Ln=yP(fb);Ln.Axios=I0;Ln.CanceledError=dh;Ln.CancelToken=$F;Ln.isCancel=uP;Ln.VERSION=_P;Ln.toFormData=Rg;Ln.AxiosError=nr;Ln.Cancel=Ln.CanceledError;Ln.all=function(r){return Promise.all(r)};Ln.spread=WF;Ln.isAxiosError=qF;Ln.mergeConfig=Sc;Ln.AxiosHeaders=hs;Ln.formToJSON=t=>cP(Xe.isHTMLForm(t)?new FormData(t):t);Ln.getAdapter=gP.getAdapter;Ln.HttpStatusCode=GF;Ln.default=Ln;const HF=Ln;/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */const ju="https://cori-data-api.ruralinnovation.us/";function sx(t){t(),window.alert("Please refresh this session by clicking the browser's reload button!"),window.location=window.location.protocol+"//"+window.location.host+window.location.pathname}const i1=HF.create({baseURL:ju,headers:{"Content-Type":"application/json"}}),ax={},xP={apiClient:i1,authenticated:!1,authenticated_user:null,autoSignOut:null,baseURL:ju,token:null,data:{get:()=>ax,set:t=>{for(const r in t)t.hasOwnProperty[r]&&(ax[r]=t)}},setData:t=>{for(const r in t)t.hasOwnProperty[r]&&(ax[r]=t)}},vP=wt.createContext(xP);let Xm=!1,IA=!1;function ZF(t){const[r,a]=wt.useState(Object.assign(Object.assign({},xP),{baseURL:t.baseURL?t.baseURL:ju,setData:c}));function c(f){const _=r;a(Object.assign(Object.assign({},_),{data:Object.assign(Object.assign({},_.data),f),setData:c}))}return t.baseURL&&t.baseURL.length>0&&i1.interceptors.request.use(f=>(f.baseURL=t.baseURL,console.log("API baseURL updated:",f.baseURL),f),f=>Promise.reject(f)),wt.useEffect(()=>{if(a(Object.assign(Object.assign({},r),{autoSignOut:t.signOut&&typeof t.signOut=="function"?()=>{console.log("autoSignOut defined in ApiContextProvider line 212"),t.signOut&&typeof t.signOut=="function"&&sx(t.signOut)}:null,baseURL:t.baseURL?t.baseURL:ju})),t.fetchAuthSession){const{fetchAuthSession:f}=t;f().then(b=>{if(!Xm){const s=b.tokens;if(console.log("API tokens:",s),s&&s.hasOwnProperty("idToken")&&(Xm=!0,console.log("API Session is authenticated:",Xm),console.log("API Session config:",b),console.log("idToken:",s.idToken),i1.interceptors.request.use(S=>{const C=s.idToken;return C&&(S.headers.Authorization=`Bearer ${C}`),t.baseURL&&(S.baseURL=t.baseURL),S},S=>Promise.reject(S)),a(Object.assign(Object.assign({},r),{authenticated:!0,autoSignOut:t.signOut&&typeof t.signOut=="function"?()=>{console.log("autoSignOut defined in ApiContextProvider line 263"),t.signOut&&typeof t.signOut=="function"&&sx(t.signOut)}:null,baseURL:t.baseURL||ju,token:s.idToken})),t.getCurrentUser)){const{getCurrentUser:S}=t;S().then(k=>{IA||(IA=!0,console.log("API User is authenticated:",Xm),console.log("API User:",k),console.log("API User type:",k.constructor.name),a(Object.assign(Object.assign({},r),{authenticated:!0,authenticated_user:k,autoSignOut:t.signOut&&typeof t.signOut=="function"?()=>{console.log("autoSignOut defined in ApiContextProvider line 339"),t.signOut&&typeof t.signOut=="function"&&sx(t.signOut)}:null,baseURL:t.baseURL||ju,token:s.idToken})))})}}})}},[]),Py.createElement(Py.Fragment,null,Py.createElement(vP.Provider,{value:r},t.children))}const XF="modulepreload",KF=function(t){return"/"+t},kA={},YF=function(r,a,c){if(!a||a.length===0)return r();const f=document.getElementsByTagName("link");return Promise.all(a.map(_=>{if(_=KF(_),_ in kA)return;kA[_]=!0;const b=_.endsWith(".css"),s=b?'[rel="stylesheet"]':"";if(!!c)for(let k=f.length-1;k>=0;k--){const M=f[k];if(M.href===_&&(!b||M.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_}"]${s}`))return;const C=document.createElement("link");if(C.rel=b?"stylesheet":XF,b||(C.as="script",C.crossOrigin=""),C.href=_,document.head.appendChild(C),b)return new Promise((k,M)=>{C.addEventListener("load",k),C.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${_}`)))})})).then(()=>r()).catch(_=>{const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=_,window.dispatchEvent(b),!b.defaultPrevented)throw _})},JF=wt.createContext(null);function QF(t,r){const a=Array.isArray(t)?t[0]:t?t.x:0,c=Array.isArray(t)?t[1]:t?t.y:0,f=Array.isArray(r)?r[0]:r?r.x:0,_=Array.isArray(r)?r[1]:r?r.y:0;return a===f&&c===_}function aa(t,r){if(t===r)return!0;if(!t||!r)return!1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let a=0;a<t.length;a++)if(!aa(t[a],r[a]))return!1;return!0}else if(Array.isArray(r))return!1;if(typeof t=="object"&&typeof r=="object"){const a=Object.keys(t),c=Object.keys(r);if(a.length!==c.length)return!1;for(const f of a)if(!r.hasOwnProperty(f)||!aa(t[f],r[f]))return!1;return!0}return!1}function e8(t){const r=t.clone();return r.pixelsToGLUnits=t.pixelsToGLUnits,r}function PA(t,r){if(!t.getProjection)return;const a=t.getProjection(),c=r.getProjection();aa(a,c)||r.setProjection(a)}function zA(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function DA(t,r){const a=r.viewState||r;let c=!1;if("zoom"in a){const f=t.zoom;t.zoom=a.zoom,c=c||f!==t.zoom}if("bearing"in a){const f=t.bearing;t.bearing=a.bearing,c=c||f!==t.bearing}if("pitch"in a){const f=t.pitch;t.pitch=a.pitch,c=c||f!==t.pitch}if(a.padding&&!t.isPaddingEqual(a.padding)&&(c=!0,t.padding=a.padding),"longitude"in a&&"latitude"in a){const f=t.center;t.center=new f.constructor(a.longitude,a.latitude),c=c||f!==t.center}return c}const t8=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function MA(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const r={};for(const c of t.layers)r[c.id]=c;const a=t.layers.map(c=>{let f=null;"interactive"in c&&(f=Object.assign({},c),delete f.interactive);const _=r[c.ref];if(_){f=f||Object.assign({},c),delete f.ref;for(const b of t8)b in _&&(f[b]=_[b])}return f||c});return{...t,layers:a}}const RA={version:8,sources:{},layers:[]},BA={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},lx={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},LA={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},r8=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],n8=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class oh{constructor(r,a,c){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=f=>{const _=this.props[LA[f.type]];_?_(f):f.type==="error"&&console.error(f.error)},this._onPointerEvent=f=>{(f.type==="mousemove"||f.type==="mouseout")&&this._updateHover(f);const _=this.props[BA[f.type]];_&&(this.props.interactiveLayerIds&&f.type!=="mouseover"&&f.type!=="mouseout"&&(f.features=this._hoveredFeatures||this._queryRenderedFeatures(f.point)),_(f),delete f.features)},this._onCameraEvent=f=>{if(!this._internalUpdate){const _=this.props[lx[f.type]];_&&_(f)}f.type in this._deferredEvents&&(this._deferredEvents[f.type]=!1)},this._MapClass=r,this.props=a,this._initialize(c)}get map(){return this._map}get transform(){return this._renderTransform}setProps(r){const a=this.props;this.props=r;const c=this._updateSettings(r,a);c&&this._createShadowTransform(this._map);const f=this._updateSize(r),_=this._updateViewState(r,!0);this._updateStyle(r,a),this._updateStyleComponents(r,a),this._updateHandlers(r,a),(c||f||_&&!this._map.isMoving())&&this.redraw()}static reuse(r,a){const c=oh.savedMaps.pop();if(!c)return null;const f=c.map,_=f.getContainer();for(a.className=_.className;_.childNodes.length>0;)a.appendChild(_.childNodes[0]);f._container=a;const b=f._resizeObserver;b&&(b.disconnect(),b.observe(a)),c.setProps({...r,styleDiffing:!1}),f.resize();const{initialViewState:s}=r;return s&&(s.bounds?f.fitBounds(s.bounds,{...s.fitBoundsOptions,duration:0}):c._updateViewState(s,!1)),f.isStyleLoaded()?f.fire("load"):f.once("styledata",()=>f.fire("load")),f._update(),c}_initialize(r){const{props:a}=this,{mapStyle:c=RA}=a,f={...a,...a.initialViewState,accessToken:a.mapboxAccessToken||i8()||null,container:r,style:MA(c)},_=f.initialViewState||f.viewState||f;if(Object.assign(f,{center:[_.longitude||0,_.latitude||0],zoom:_.zoom||0,pitch:_.pitch||0,bearing:_.bearing||0}),a.gl){const k=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=k,a.gl)}const b=new this._MapClass(f);_.padding&&b.setPadding(_.padding),a.cursor&&(b.getCanvas().style.cursor=a.cursor),this._createShadowTransform(b);const s=b._render;b._render=k=>{this._inRender=!0,s.call(b,k),this._inRender=!1};const S=b._renderTaskQueue.run;b._renderTaskQueue.run=k=>{S.call(b._renderTaskQueue,k),this._onBeforeRepaint()},b.on("render",()=>this._onAfterRepaint());const C=b.fire;b.fire=this._fireEvent.bind(this,C),b.on("resize",()=>{this._renderTransform.resize(b.transform.width,b.transform.height)}),b.on("styledata",()=>{this._updateStyleComponents(this.props,{}),PA(b.transform,this._renderTransform)}),b.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const k in BA)b.on(k,this._onPointerEvent);for(const k in lx)b.on(k,this._onCameraEvent);for(const k in LA)b.on(k,this._onEvent);this._map=b}recycle(){const a=this.map.getContainer().querySelector("[mapboxgl-children]");a==null||a.remove(),oh.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const r=this._map;!this._inRender&&r.style&&(r._frame&&(r._frame.cancel(),r._frame=null),r._render())}_createShadowTransform(r){const a=e8(r.transform);r.painter.transform=a,this._renderTransform=a}_updateSize(r){const{viewState:a}=r;if(a){const c=this._map;if(a.width!==c.transform.width||a.height!==c.transform.height)return c.resize(),!0}return!1}_updateViewState(r,a){if(this._internalUpdate)return!1;const c=this._map,f=this._renderTransform,{zoom:_,pitch:b,bearing:s}=f,S=c.isMoving();S&&(f.cameraElevationReference="sea");const C=DA(f,{...zA(c.transform),...r});if(S&&(f.cameraElevationReference="ground"),C&&a){const k=this._deferredEvents;k.move=!0,k.zoom||(k.zoom=_!==f.zoom),k.rotate||(k.rotate=s!==f.bearing),k.pitch||(k.pitch=b!==f.pitch)}return S||DA(c.transform,r),C}_updateSettings(r,a){const c=this._map;let f=!1;for(const _ of r8)if(_ in r&&!aa(r[_],a[_])){f=!0;const b=c[`set${_[0].toUpperCase()}${_.slice(1)}`];b==null||b.call(c,r[_])}return f}_updateStyle(r,a){if(r.cursor!==a.cursor&&(this._map.getCanvas().style.cursor=r.cursor||""),r.mapStyle!==a.mapStyle){const{mapStyle:c=RA,styleDiffing:f=!0}=r,_={diff:f};return"localIdeographFontFamily"in r&&(_.localIdeographFontFamily=r.localIdeographFontFamily),this._map.setStyle(MA(c),_),!0}return!1}_updateStyleComponents(r,a){const c=this._map;let f=!1;return c.isStyleLoaded()&&("light"in r&&c.setLight&&!aa(r.light,a.light)&&(f=!0,c.setLight(r.light)),"fog"in r&&c.setFog&&!aa(r.fog,a.fog)&&(f=!0,c.setFog(r.fog)),"terrain"in r&&c.setTerrain&&!aa(r.terrain,a.terrain)&&(!r.terrain||c.getSource(r.terrain.source))&&(f=!0,c.setTerrain(r.terrain))),f}_updateHandlers(r,a){var c,f;const _=this._map;let b=!1;for(const s of n8){const S=(c=r[s])!==null&&c!==void 0?c:!0,C=(f=a[s])!==null&&f!==void 0?f:!0;aa(S,C)||(b=!0,S?_[s].enable(S):_[s].disable())}return b}_queryRenderedFeatures(r){const a=this._map,c=a.transform,{interactiveLayerIds:f=[]}=this.props;try{return a.transform=this._renderTransform,a.queryRenderedFeatures(r,{layers:f.filter(a.getLayer.bind(a))})}catch{return[]}finally{a.transform=c}}_updateHover(r){var a;const{props:c}=this;if(c.interactiveLayerIds&&(c.onMouseMove||c.onMouseEnter||c.onMouseLeave)){const _=r.type,b=((a=this._hoveredFeatures)===null||a===void 0?void 0:a.length)>0,s=this._queryRenderedFeatures(r.point),S=s.length>0;!S&&b&&(r.type="mouseleave",this._onPointerEvent(r)),this._hoveredFeatures=s,S&&!b&&(r.type="mouseenter",this._onPointerEvent(r)),r.type=_}else this._hoveredFeatures=null}_fireEvent(r,a,c){const f=this._map,_=f.transform,b=typeof a=="string"?a:a.type;return b==="move"&&this._updateViewState(this.props,!1),b in lx&&(typeof a=="object"&&(a.viewState=zA(_)),this._map.isMoving())?(f.transform=this._renderTransform,r.call(f,a,c),f.transform=_,f):(r.call(f,a,c),f)}_onBeforeRepaint(){const r=this._map;this._internalUpdate=!0;for(const c in this._deferredEvents)this._deferredEvents[c]&&r.fire(c);this._internalUpdate=!1;const a=this._map.transform;r.transform=this._renderTransform,this._onAfterRepaint=()=>{PA(this._renderTransform,a),r.transform=a}}}oh.savedMaps=[];function i8(){let t=null;if(typeof location<"u"){const r=/access_token=([^&\/]*)/.exec(location.search);t=r&&r[1]}try{t=t||void 0}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const o8=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function s8(t){if(!t)return null;const r=t.map,a={getMap:()=>r,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:c=>{const f=r.transform;r.transform=t.transform;const _=r.project(c);return r.transform=f,_},unproject:c=>{const f=r.transform;r.transform=t.transform;const _=r.unproject(c);return r.transform=f,_},queryTerrainElevation:(c,f)=>{const _=r.transform;r.transform=t.transform;const b=r.queryTerrainElevation(c,f);return r.transform=_,b},queryRenderedFeatures:(c,f)=>{const _=r.transform;r.transform=t.transform;const b=r.queryRenderedFeatures(c,f);return r.transform=_,b}};for(const c of a8(r))!(c in a)&&!o8.includes(c)&&(a[c]=r[c].bind(r));return a}function a8(t){const r=new Set;let a=t;for(;a;){for(const c of Object.getOwnPropertyNames(a))c[0]!=="_"&&typeof t[c]=="function"&&c!=="fire"&&c!=="setEventedParent"&&r.add(c);a=Object.getPrototypeOf(a)}return Array.from(r)}const l8=typeof document<"u"?wt.useLayoutEffect:wt.useEffect,c8=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function u8(t,r){for(const c of c8)c in r&&(t[c]=r[c]);const{RTLTextPlugin:a="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=r;a&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(a,c=>{c&&console.error(c)},!0)}const Og=wt.createContext(null);function h8(t,r,a){const c=wt.useContext(JF),[f,_]=wt.useState(null),b=wt.useRef(),{current:s}=wt.useRef({mapLib:null,map:null});wt.useEffect(()=>{const k=t.mapLib;let M=!0,L;return Promise.resolve(k||a).then(V=>{if(!M)return;if(!V)throw new Error("Invalid mapLib");const O="Map"in V?V:V.default;if(!O.Map)throw new Error("Invalid mapLib");if(u8(O,t),!O.supported||O.supported(t))t.reuseMaps&&(L=oh.reuse(t,b.current)),L||(L=new oh(O.Map,t,b.current)),s.map=s8(L),s.mapLib=O,_(L),c==null||c.onMapMount(s.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(V=>{const{onError:O}=t;O?O({type:"error",target:null,originalEvent:null,error:V}):console.error(V)}),()=>{M=!1,L&&(c==null||c.onMapUnmount(t.id),t.reuseMaps?L.recycle():L.destroy())}},[]),l8(()=>{f&&f.setProps(t)}),wt.useImperativeHandle(r,()=>s.map,[f]);const S=wt.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),C={height:"100%"};return wt.createElement("div",{id:t.id,ref:b,style:S},f&&wt.createElement(Og.Provider,{value:s},wt.createElement("div",{"mapboxgl-children":"",style:C},t.children)))}const d8=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Cc(t,r){if(!t||!r)return;const a=t.style;for(const c in r){const f=r[c];Number.isFinite(f)&&!d8.test(c)?a[c]=`${f}px`:a[c]=f}}function p8(t,r){const{map:a,mapLib:c}=wt.useContext(Og),f=wt.useRef({props:t});f.current.props=t;const _=wt.useMemo(()=>{let j=!1;wt.Children.forEach(t.children,U=>{U&&(j=!0)});const H={...t,element:j?document.createElement("div"):null},Z=new c.Marker(H);return Z.setLngLat([t.longitude,t.latitude]),Z.getElement().addEventListener("click",U=>{var $,J;(J=($=f.current.props).onClick)===null||J===void 0||J.call($,{type:"click",target:Z,originalEvent:U})}),Z.on("dragstart",U=>{var $,J;const le=U;le.lngLat=_.getLngLat(),(J=($=f.current.props).onDragStart)===null||J===void 0||J.call($,le)}),Z.on("drag",U=>{var $,J;const le=U;le.lngLat=_.getLngLat(),(J=($=f.current.props).onDrag)===null||J===void 0||J.call($,le)}),Z.on("dragend",U=>{var $,J;const le=U;le.lngLat=_.getLngLat(),(J=($=f.current.props).onDragEnd)===null||J===void 0||J.call($,le)}),Z},[]);wt.useEffect(()=>(_.addTo(a.getMap()),()=>{_.remove()}),[]);const{longitude:b,latitude:s,offset:S,style:C,draggable:k=!1,popup:M=null,rotation:L=0,rotationAlignment:V="auto",pitchAlignment:O="auto"}=t;return wt.useEffect(()=>{Cc(_.getElement(),C)},[C]),wt.useImperativeHandle(r,()=>_,[]),(_.getLngLat().lng!==b||_.getLngLat().lat!==s)&&_.setLngLat([b,s]),S&&!QF(_.getOffset(),S)&&_.setOffset(S),_.isDraggable()!==k&&_.setDraggable(k),_.getRotation()!==L&&_.setRotation(L),_.getRotationAlignment()!==V&&_.setRotationAlignment(V),_.getPitchAlignment()!==O&&_.setPitchAlignment(O),_.getPopup()!==M&&_.setPopup(M),tb.createPortal(t.children,_.getElement())}const f8=wt.memo(wt.forwardRef(p8));function FA(t){return new Set(t?t.trim().split(/\s+/):[])}function m8(t,r){const{map:a,mapLib:c}=wt.useContext(Og),f=wt.useMemo(()=>document.createElement("div"),[]),_=wt.useRef({props:t});_.current.props=t;const b=wt.useMemo(()=>{const s={...t},S=new c.Popup(s);return S.setLngLat([t.longitude,t.latitude]),S.once("open",C=>{var k,M;(M=(k=_.current.props).onOpen)===null||M===void 0||M.call(k,C)}),S},[]);if(wt.useEffect(()=>{const s=S=>{var C,k;(k=(C=_.current.props).onClose)===null||k===void 0||k.call(C,S)};return b.on("close",s),b.setDOMContent(f).addTo(a.getMap()),()=>{b.off("close",s),b.isOpen()&&b.remove()}},[]),wt.useEffect(()=>{Cc(b.getElement(),t.style)},[t.style]),wt.useImperativeHandle(r,()=>b,[]),b.isOpen()&&((b.getLngLat().lng!==t.longitude||b.getLngLat().lat!==t.latitude)&&b.setLngLat([t.longitude,t.latitude]),t.offset&&!aa(b.options.offset,t.offset)&&b.setOffset(t.offset),(b.options.anchor!==t.anchor||b.options.maxWidth!==t.maxWidth)&&(b.options.anchor=t.anchor,b.setMaxWidth(t.maxWidth)),b.options.className!==t.className)){const s=FA(b.options.className),S=FA(t.className);for(const C of s)S.has(C)||b.removeClassName(C);for(const C of S)s.has(C)||b.addClassName(C);b.options.className=t.className}return tb.createPortal(t.children,f)}wt.memo(wt.forwardRef(m8));function ph(t,r,a,c){const f=wt.useContext(Og),_=wt.useMemo(()=>t(f),[]);return wt.useEffect(()=>{const b=c||a||r,s=typeof r=="function"&&typeof a=="function"?r:null,S=typeof a=="function"?a:typeof r=="function"?r:null,{map:C}=f;return C.hasControl(_)||(C.addControl(_,b==null?void 0:b.position),s&&s(f)),()=>{S&&S(f),C.hasControl(_)&&C.removeControl(_)}},[]),_}function g8(t){const r=ph(({mapLib:a})=>new a.AttributionControl(t),{position:t.position});return wt.useEffect(()=>{Cc(r._container,t.style)},[t.style]),null}wt.memo(g8);function _8(t){const r=ph(({mapLib:a})=>new a.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return wt.useEffect(()=>{Cc(r._controlContainer,t.style)},[t.style]),null}wt.memo(_8);function y8(t,r){const a=wt.useRef({props:t}),c=ph(({mapLib:f})=>{const _=new f.GeolocateControl(t),b=_._setupUI;return _._setupUI=s=>{_._container.hasChildNodes()||b(s)},_.on("geolocate",s=>{var S,C;(C=(S=a.current.props).onGeolocate)===null||C===void 0||C.call(S,s)}),_.on("error",s=>{var S,C;(C=(S=a.current.props).onError)===null||C===void 0||C.call(S,s)}),_.on("outofmaxbounds",s=>{var S,C;(C=(S=a.current.props).onOutOfMaxBounds)===null||C===void 0||C.call(S,s)}),_.on("trackuserlocationstart",s=>{var S,C;(C=(S=a.current.props).onTrackUserLocationStart)===null||C===void 0||C.call(S,s)}),_.on("trackuserlocationend",s=>{var S,C;(C=(S=a.current.props).onTrackUserLocationEnd)===null||C===void 0||C.call(S,s)}),_},{position:t.position});return a.current.props=t,wt.useImperativeHandle(r,()=>c,[]),wt.useEffect(()=>{Cc(c._container,t.style)},[t.style]),null}const x8=wt.memo(wt.forwardRef(y8));function v8(t){const r=ph(({mapLib:a})=>new a.NavigationControl(t),{position:t.position});return wt.useEffect(()=>{Cc(r._container,t.style)},[t.style]),null}const b8=wt.memo(v8);function w8(t){const r=ph(({mapLib:_})=>new _.ScaleControl(t),{position:t.position}),a=wt.useRef(t),c=a.current;a.current=t;const{style:f}=t;return t.maxWidth!==void 0&&t.maxWidth!==c.maxWidth&&(r.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==c.unit&&r.setUnit(t.unit),wt.useEffect(()=>{Cc(r._container,f)},[f]),null}const E8=wt.memo(w8),S8=YF(()=>Promise.resolve().then(()=>hN),void 0),A8=(()=>wt.forwardRef(function(r,a){return h8(r,a,S8)}))(),bP=f8,T8=b8,C8=x8,I8=E8;var fh=P8,k8=Object.prototype.hasOwnProperty;function P8(){for(var t={},r=0;r<arguments.length;r++){var a=arguments[r];for(var c in a)k8.call(a,c)&&(t[c]=a[c])}return t}var wP={exports:{}};(function(t,r){(function(){var a={};t.exports=a,a.simpleFilter=function(c,f){return f.filter(function(_){return a.test(c,_)})},a.test=function(c,f){return a.match(c,f)!==null},a.match=function(c,f,_){_=_||{};var b=0,s=[],S=f.length,C=0,k=0,M=_.pre||"",L=_.post||"",V=_.caseSensitive&&f||f.toLowerCase(),O;c=_.caseSensitive&&c||c.toLowerCase();for(var j=0;j<S;j++)O=f[j],V[j]===c[b]?(O=M+O+L,b+=1,k+=1+k):k=0,C+=k,s[s.length]=O;return b===c.length?(C=V===c?1/0:C,{rendered:s.join(""),score:C}):null},a.filter=function(c,f,_){return!f||f.length===0?[]:typeof c!="string"?f:(_=_||{},f.reduce(function(b,s,S,C){var k=s;_.extract&&(k=_.extract(s));var M=a.match(c,k,_);return M!=null&&(b[b.length]={string:M.rendered,score:M.score,index:S,original:s}),b},[]).sort(function(b,s){var S=s.score-b.score;return S||b.index-s.index}))}})()})(wP);var z8=wP.exports,Hi=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};Hi.prototype.show=function(){this.element.style.display="block"};Hi.prototype.hide=function(){this.element.style.display="none"};Hi.prototype.add=function(t){this.items.push(t)};Hi.prototype.clear=function(){this.items=[],this.active=0};Hi.prototype.isEmpty=function(){return!this.items.length};Hi.prototype.isVisible=function(){return this.element.style.display==="block"};Hi.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()};Hi.prototype.drawItem=function(t,r){var a=document.createElement("li"),c=document.createElement("a");r&&(a.className+=" active"),c.innerHTML=t.string,a.appendChild(c),this.element.appendChild(a),a.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),a.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,t)}).bind(this))};Hi.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()};Hi.prototype.move=function(t){this.active=t,this.draw()};Hi.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Hi.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Hi.prototype.drawError=function(t){var r=document.createElement("li");r.innerHTML=t,this.element.appendChild(r),this.show()};var D8=Hi,M8=fh,R8=z8,B8=D8,Ei=function(t,r,a){return a=a||{},this.options=M8({minLength:2,limit:5,filter:!0,hideOnBlur:!0},a),this.el=t,this.data=r||[],this.list=new B8(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(c){this.handleKeyUp(c.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(c){this.handleKeyDown(c)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(c){this.handlePaste(c)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Ei.prototype.handleKeyUp=function(t){t===40||t===38||t===27||t===13||t===9||this.handleInputChange(this.el.value)};Ei.prototype.handleKeyDown=function(t){switch(t.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&t.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Ei.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Ei.prototype.handlePaste=function(t){if(t.clipboardData)this.handleInputChange(t.clipboardData.getData("Text"));else{var r=this;setTimeout(function(){r.handleInputChange(t.target.value)},100)}};Ei.prototype.handleInputChange=function(t){if(this.query=this.normalize(t),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(r){for(var a=0;a<r.length&&(this.list.add(r[a]),a!==this.options.limit-1);a++);this.list.draw()}).bind(this))};Ei.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Ei.prototype.update=function(t){this.data=t,this.handleKeyUp()};Ei.prototype.clear=function(){this.data=[],this.list.clear()};Ei.prototype.normalize=function(t){return t=t.toLowerCase(),t};Ei.prototype.match=function(t,r){return t.indexOf(r)>-1};Ei.prototype.value=function(t){if(this.selected=t,this.el.value=this.getItemValue(t),document.createEvent){var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!1),this.el.dispatchEvent(r)}else this.el.fireEvent("onchange")};Ei.prototype.getCandidates=function(t){var r={pre:"<strong>",post:"</strong>",extract:(function(c){return this.getItemValue(c)}).bind(this)},a;this.options.filter?(a=R8.filter(this.query,this.data,r),a=a.map((function(c){return{original:c.original,string:this.render(c.original,c.string)}}).bind(this))):a=this.data.map((function(c){var f=this.render(c);return{original:c,string:f}}).bind(this)),t(a)};Ei.prototype.getItemValue=function(t){return t};Ei.prototype.render=function(t,r){if(r)return r;for(var a=t.original?this.getItemValue(t.original):this.getItemValue(t),c=this.normalize(a),f=c.lastIndexOf(this.query);f>-1;){var _=f+this.query.length;a=a.slice(0,f)+"<strong>"+a.slice(f,_)+"</strong>"+a.slice(_),f=c.slice(0,f).lastIndexOf(this.query)}return a};Ei.prototype.renderError=function(t){this.list.drawError(t)};var L8=Ei,EP=L8,F8=EP;typeof window<"u"&&(window.Suggestions=EP);var O8="Expected a function",OA=0/0,N8="[object Symbol]",U8=/^\s+|\s+$/g,V8=/^[-+]0x[0-9a-f]+$/i,j8=/^0b[01]+$/i,$8=/^0o[0-7]+$/i,W8=parseInt,q8=typeof gt=="object"&&gt&&gt.Object===Object&&gt,G8=typeof self=="object"&&self&&self.Object===Object&&self,H8=q8||G8||Function("return this")(),Z8=Object.prototype,X8=Z8.toString,K8=Math.max,Y8=Math.min,cx=function(){return H8.Date.now()};function J8(t,r,a){var c,f,_,b,s,S,C=0,k=!1,M=!1,L=!0;if(typeof t!="function")throw new TypeError(O8);r=NA(r)||0,o1(a)&&(k=!!a.leading,M="maxWait"in a,_=M?K8(NA(a.maxWait)||0,r):_,L="trailing"in a?!!a.trailing:L);function V(pe){var ye=c,Te=f;return c=f=void 0,C=pe,b=t.apply(Te,ye),b}function O(pe){return C=pe,s=setTimeout(Z,r),k?V(pe):b}function j(pe){var ye=pe-S,Te=pe-C,Se=r-ye;return M?Y8(Se,_-Te):Se}function H(pe){var ye=pe-S,Te=pe-C;return S===void 0||ye>=r||ye<0||M&&Te>=_}function Z(){var pe=cx();if(H(pe))return U(pe);s=setTimeout(Z,j(pe))}function U(pe){return s=void 0,L&&c?V(pe):(c=f=void 0,b)}function $(){s!==void 0&&clearTimeout(s),C=0,c=S=f=s=void 0}function J(){return s===void 0?b:U(cx())}function le(){var pe=cx(),ye=H(pe);if(c=arguments,f=this,S=pe,ye){if(s===void 0)return O(S);if(M)return s=setTimeout(Z,r),V(S)}return s===void 0&&(s=setTimeout(Z,r)),b}return le.cancel=$,le.flush=J,le}function o1(t){var r=typeof t;return!!t&&(r=="object"||r=="function")}function Q8(t){return!!t&&typeof t=="object"}function e6(t){return typeof t=="symbol"||Q8(t)&&X8.call(t)==N8}function NA(t){if(typeof t=="number")return t;if(e6(t))return OA;if(o1(t)){var r=typeof t.valueOf=="function"?t.valueOf():t;t=o1(r)?r+"":r}if(typeof t!="string")return t===0?t:+t;t=t.replace(U8,"");var a=j8.test(t);return a||$8.test(t)?W8(t.slice(2),a?2:8):V8.test(t)?OA:+t}var t6=J8,gb={exports:{}},Ku=typeof Reflect=="object"?Reflect:null,UA=Ku&&typeof Ku.apply=="function"?Ku.apply:function(r,a,c){return Function.prototype.apply.call(r,a,c)},k0;Ku&&typeof Ku.ownKeys=="function"?k0=Ku.ownKeys:Object.getOwnPropertySymbols?k0=function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:k0=function(r){return Object.getOwnPropertyNames(r)};function r6(t){console&&console.warn&&console.warn(t)}var SP=Number.isNaN||function(r){return r!==r};function jr(){jr.init.call(this)}gb.exports=jr;gb.exports.once=s6;jr.EventEmitter=jr;jr.prototype._events=void 0;jr.prototype._eventsCount=0;jr.prototype._maxListeners=void 0;var VA=10;function Ng(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(jr,"defaultMaxListeners",{enumerable:!0,get:function(){return VA},set:function(t){if(typeof t!="number"||t<0||SP(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");VA=t}});jr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};jr.prototype.setMaxListeners=function(r){if(typeof r!="number"||r<0||SP(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this};function AP(t){return t._maxListeners===void 0?jr.defaultMaxListeners:t._maxListeners}jr.prototype.getMaxListeners=function(){return AP(this)};jr.prototype.emit=function(r){for(var a=[],c=1;c<arguments.length;c++)a.push(arguments[c]);var f=r==="error",_=this._events;if(_!==void 0)f=f&&_.error===void 0;else if(!f)return!1;if(f){var b;if(a.length>0&&(b=a[0]),b instanceof Error)throw b;var s=new Error("Unhandled error."+(b?" ("+b.message+")":""));throw s.context=b,s}var S=_[r];if(S===void 0)return!1;if(typeof S=="function")UA(S,this,a);else for(var C=S.length,k=PP(S,C),c=0;c<C;++c)UA(k[c],this,a);return!0};function TP(t,r,a,c){var f,_,b;if(Ng(a),_=t._events,_===void 0?(_=t._events=Object.create(null),t._eventsCount=0):(_.newListener!==void 0&&(t.emit("newListener",r,a.listener?a.listener:a),_=t._events),b=_[r]),b===void 0)b=_[r]=a,++t._eventsCount;else if(typeof b=="function"?b=_[r]=c?[a,b]:[b,a]:c?b.unshift(a):b.push(a),f=AP(t),f>0&&b.length>f&&!b.warned){b.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+b.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=r,s.count=b.length,r6(s)}return t}jr.prototype.addListener=function(r,a){return TP(this,r,a,!1)};jr.prototype.on=jr.prototype.addListener;jr.prototype.prependListener=function(r,a){return TP(this,r,a,!0)};function n6(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function CP(t,r,a){var c={fired:!1,wrapFn:void 0,target:t,type:r,listener:a},f=n6.bind(c);return f.listener=a,c.wrapFn=f,f}jr.prototype.once=function(r,a){return Ng(a),this.on(r,CP(this,r,a)),this};jr.prototype.prependOnceListener=function(r,a){return Ng(a),this.prependListener(r,CP(this,r,a)),this};jr.prototype.removeListener=function(r,a){var c,f,_,b,s;if(Ng(a),f=this._events,f===void 0)return this;if(c=f[r],c===void 0)return this;if(c===a||c.listener===a)--this._eventsCount===0?this._events=Object.create(null):(delete f[r],f.removeListener&&this.emit("removeListener",r,c.listener||a));else if(typeof c!="function"){for(_=-1,b=c.length-1;b>=0;b--)if(c[b]===a||c[b].listener===a){s=c[b].listener,_=b;break}if(_<0)return this;_===0?c.shift():i6(c,_),c.length===1&&(f[r]=c[0]),f.removeListener!==void 0&&this.emit("removeListener",r,s||a)}return this};jr.prototype.off=jr.prototype.removeListener;jr.prototype.removeAllListeners=function(r){var a,c,f;if(c=this._events,c===void 0)return this;if(c.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):c[r]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete c[r]),this;if(arguments.length===0){var _=Object.keys(c),b;for(f=0;f<_.length;++f)b=_[f],b!=="removeListener"&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(a=c[r],typeof a=="function")this.removeListener(r,a);else if(a!==void 0)for(f=a.length-1;f>=0;f--)this.removeListener(r,a[f]);return this};function IP(t,r,a){var c=t._events;if(c===void 0)return[];var f=c[r];return f===void 0?[]:typeof f=="function"?a?[f.listener||f]:[f]:a?o6(f):PP(f,f.length)}jr.prototype.listeners=function(r){return IP(this,r,!0)};jr.prototype.rawListeners=function(r){return IP(this,r,!1)};jr.listenerCount=function(t,r){return typeof t.listenerCount=="function"?t.listenerCount(r):kP.call(t,r)};jr.prototype.listenerCount=kP;function kP(t){var r=this._events;if(r!==void 0){var a=r[t];if(typeof a=="function")return 1;if(a!==void 0)return a.length}return 0}jr.prototype.eventNames=function(){return this._eventsCount>0?k0(this._events):[]};function PP(t,r){for(var a=new Array(r),c=0;c<r;++c)a[c]=t[c];return a}function i6(t,r){for(;r+1<t.length;r++)t[r]=t[r+1];t.pop()}function o6(t){for(var r=new Array(t.length),a=0;a<r.length;++a)r[a]=t[a].listener||t[a];return r}function s6(t,r){return new Promise(function(a,c){function f(b){t.removeListener(r,_),c(b)}function _(){typeof t.removeListener=="function"&&t.removeListener("error",f),a([].slice.call(arguments))}zP(t,r,_,{once:!0}),r!=="error"&&a6(t,f,{once:!0})})}function a6(t,r,a){typeof t.on=="function"&&zP(t,"error",r,a)}function zP(t,r,a,c){if(typeof t.on=="function")c.once?t.once(r,a):t.on(r,a);else if(typeof t.addEventListener=="function")t.addEventListener(r,function f(_){c.once&&t.removeEventListener(r,f),a(_)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var l6=gb.exports,c6={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function u6(t){var r=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return r?{key:r[1],value:r[2]}:null}function h6(t){var r=t.match(/<?([^>]*)>(.*)/);if(!r)return null;var a=r[1],c=r[2].split(";"),f=null,_=c.reduce(function(b,s){var S=u6(s);return S?S.key==="rel"?(f||(f=S.value),b):(b[S.key]=S.value,b):b},{});return f?{url:a,rel:f,params:_}:null}function d6(t){return t?t.split(/,\s*</).reduce(function(r,a){var c=h6(a);if(!c)return r;var f=c.rel.split(/\s+/);return f.forEach(function(_){r[_]||(r[_]={url:c.url,params:c.params})}),r},{}):{}}var p6=d6,f6=p6;function _b(t,r){this.request=t,this.headers=r.headers,this.rawBody=r.body,this.statusCode=r.statusCode;try{this.body=JSON.parse(r.body||"{}")}catch{this.body=r.body}this.links=f6(this.headers.link)}_b.prototype.hasNextPage=function(){return!!this.links.next};_b.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var m6=_b,Ug={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},jA=Ug;function g6(t){var r=t.type||jA.ERROR_HTTP,a;if(t.body)try{a=JSON.parse(t.body)}catch{a=t.body}else a=null;var c=t.message||null;c||(typeof a=="string"?c=a:a&&typeof a.message=="string"?c=a.message:r===jA.ERROR_REQUEST_ABORTED&&(c="Request aborted")),this.message=c,this.type=r,this.statusCode=t.statusCode||null,this.request=t.request,this.body=a}var _6=g6;function y6(t){var r=t.indexOf(":"),a=t.substring(0,r).trim().toLowerCase(),c=t.substring(r+1).trim();return{name:a,value:c}}function x6(t){var r={};return t&&t.trim().split(/[\r|\n]+/).forEach(function(a){var c=y6(a);r[c.name]=c.value}),r}var v6=x6,b6=m6,$A=_6,ux=Ug,w6=v6,ag={};function E6(t){var r=ag[t.id];r&&(r.abort(),delete ag[t.id])}function S6(t,r){return new b6(t,{body:r.response,headers:w6(r.getAllResponseHeaders()),statusCode:r.status})}function WA(t){var r=t.total,a=t.loaded,c=100*a/r;return{total:r,transferred:a,percent:c}}function DP(t,r){return new Promise(function(a,c){r.onprogress=function(b){t.emitter.emit(ux.EVENT_PROGRESS_DOWNLOAD,WA(b))};var f=t.file;f&&(r.upload.onprogress=function(b){t.emitter.emit(ux.EVENT_PROGRESS_UPLOAD,WA(b))}),r.onerror=function(b){c(b)},r.onabort=function(){var b=new $A({request:t,type:ux.ERROR_REQUEST_ABORTED});c(b)},r.onload=function(){if(delete ag[t.id],r.status<200||r.status>=400){var b=new $A({request:t,body:r.response,statusCode:r.status});c(b);return}a(r)};var _=t.body;typeof _=="string"?r.send(_):_?r.send(JSON.stringify(_)):f?r.send(f):r.send(),ag[t.id]=r}).then(function(a){return S6(t,a)})}function MP(t,r){var a=t.url(r),c=new window.XMLHttpRequest;return c.open(t.method,a),Object.keys(t.headers).forEach(function(f){c.setRequestHeader(f,t.headers[f])}),c}function A6(t){return Promise.resolve().then(function(){var r=MP(t,t.client.accessToken);return DP(t,r)})}var T6={browserAbort:E6,sendRequestXhr:DP,browserSend:A6,createRequestXhr:MP},lg={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */lg.exports;(function(t,r){(function(a){var c=r,f=t&&t.exports==c&&t,_=typeof gt=="object"&&gt;(_.global===_||_.window===_)&&(a=_);var b=function(O){this.message=O};b.prototype=new Error,b.prototype.name="InvalidCharacterError";var s=function(O){throw new b(O)},S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",C=/[\t\n\f\r ]/g,k=function(O){O=String(O).replace(C,"");var j=O.length;j%4==0&&(O=O.replace(/==?$/,""),j=O.length),(j%4==1||/[^+a-zA-Z0-9/]/.test(O))&&s("Invalid character: the string to be decoded is not correctly encoded.");for(var H=0,Z,U,$="",J=-1;++J<j;)U=S.indexOf(O.charAt(J)),Z=H%4?Z*64+U:U,H++%4&&($+=String.fromCharCode(255&Z>>(-2*H&6)));return $},M=function(O){O=String(O),/[^\0-\xFF]/.test(O)&&s("The string to be encoded contains characters outside of the Latin1 range.");for(var j=O.length%3,H="",Z=-1,U,$,J,le,pe=O.length-j;++Z<pe;)U=O.charCodeAt(Z)<<16,$=O.charCodeAt(++Z)<<8,J=O.charCodeAt(++Z),le=U+$+J,H+=S.charAt(le>>18&63)+S.charAt(le>>12&63)+S.charAt(le>>6&63)+S.charAt(le&63);return j==2?(U=O.charCodeAt(Z)<<8,$=O.charCodeAt(++Z),le=U+$,H+=S.charAt(le>>10)+S.charAt(le>>4&63)+S.charAt(le<<2&63)+"="):j==1&&(le=O.charCodeAt(Z),H+=S.charAt(le>>2)+S.charAt(le<<4&63)+"=="),H},L={encode:M,decode:k,version:"0.1.0"};if(c&&!c.nodeType)if(f)f.exports=L;else for(var V in L)L.hasOwnProperty(V)&&(c[V]=L[V]);else a.base64=L})(gt)})(lg,lg.exports);var C6=lg.exports,I6=C6,hx={};function k6(t){if(hx[t])return hx[t];var r=t.split("."),a=r[0],c=r[1];if(!c)throw new Error("Invalid token");var f=P6(c),_={usage:a,user:f.u};return lc(f,"a")&&(_.authorization=f.a),lc(f,"exp")&&(_.expires=f.exp*1e3),lc(f,"iat")&&(_.created=f.iat*1e3),lc(f,"scopes")&&(_.scopes=f.scopes),lc(f,"client")&&(_.client=f.client),lc(f,"ll")&&(_.lastLogin=f.ll),lc(f,"iu")&&(_.impersonator=f.iu),hx[t]=_,_}function P6(t){try{return JSON.parse(I6.decode(t))}catch{throw new Error("Invalid token")}}function lc(t,r){return Object.prototype.hasOwnProperty.call(t,r)}var RP=k6,BP={exports:{}};(function(t){var r=Object.prototype.hasOwnProperty,a="~";function c(){}Object.create&&(c.prototype=Object.create(null),new c().__proto__||(a=!1));function f(S,C,k){this.fn=S,this.context=C,this.once=k||!1}function _(S,C,k,M,L){if(typeof k!="function")throw new TypeError("The listener must be a function");var V=new f(k,M||S,L),O=a?a+C:C;return S._events[O]?S._events[O].fn?S._events[O]=[S._events[O],V]:S._events[O].push(V):(S._events[O]=V,S._eventsCount++),S}function b(S,C){--S._eventsCount===0?S._events=new c:delete S._events[C]}function s(){this._events=new c,this._eventsCount=0}s.prototype.eventNames=function(){var C=[],k,M;if(this._eventsCount===0)return C;for(M in k=this._events)r.call(k,M)&&C.push(a?M.slice(1):M);return Object.getOwnPropertySymbols?C.concat(Object.getOwnPropertySymbols(k)):C},s.prototype.listeners=function(C){var k=a?a+C:C,M=this._events[k];if(!M)return[];if(M.fn)return[M.fn];for(var L=0,V=M.length,O=new Array(V);L<V;L++)O[L]=M[L].fn;return O},s.prototype.listenerCount=function(C){var k=a?a+C:C,M=this._events[k];return M?M.fn?1:M.length:0},s.prototype.emit=function(C,k,M,L,V,O){var j=a?a+C:C;if(!this._events[j])return!1;var H=this._events[j],Z=arguments.length,U,$;if(H.fn){switch(H.once&&this.removeListener(C,H.fn,void 0,!0),Z){case 1:return H.fn.call(H.context),!0;case 2:return H.fn.call(H.context,k),!0;case 3:return H.fn.call(H.context,k,M),!0;case 4:return H.fn.call(H.context,k,M,L),!0;case 5:return H.fn.call(H.context,k,M,L,V),!0;case 6:return H.fn.call(H.context,k,M,L,V,O),!0}for($=1,U=new Array(Z-1);$<Z;$++)U[$-1]=arguments[$];H.fn.apply(H.context,U)}else{var J=H.length,le;for($=0;$<J;$++)switch(H[$].once&&this.removeListener(C,H[$].fn,void 0,!0),Z){case 1:H[$].fn.call(H[$].context);break;case 2:H[$].fn.call(H[$].context,k);break;case 3:H[$].fn.call(H[$].context,k,M);break;case 4:H[$].fn.call(H[$].context,k,M,L);break;default:if(!U)for(le=1,U=new Array(Z-1);le<Z;le++)U[le-1]=arguments[le];H[$].fn.apply(H[$].context,U)}}return!0},s.prototype.on=function(C,k,M){return _(this,C,k,M,!1)},s.prototype.once=function(C,k,M){return _(this,C,k,M,!0)},s.prototype.removeListener=function(C,k,M,L){var V=a?a+C:C;if(!this._events[V])return this;if(!k)return b(this,V),this;var O=this._events[V];if(O.fn)O.fn===k&&(!L||O.once)&&(!M||O.context===M)&&b(this,V);else{for(var j=0,H=[],Z=O.length;j<Z;j++)(O[j].fn!==k||L&&!O[j].once||M&&O[j].context!==M)&&H.push(O[j]);H.length?this._events[V]=H.length===1?H[0]:H:b(this,V)}return this},s.prototype.removeAllListeners=function(C){var k;return C?(k=a?a+C:C,this._events[k]&&b(this,k)):(this._events=new c,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=a,s.EventEmitter=s,t.exports=s})(BP);var z6=BP.exports;function D6(t){return t.map(encodeURIComponent).join(",")}function LP(t){return Array.isArray(t)?D6(t):encodeURIComponent(String(t))}function FP(t,r,a){if(a===!1||a===null)return t;var c=/\?/.test(t)?"&":"?",f=encodeURIComponent(r);return a!==void 0&&a!==""&&a!==!0&&(f+="="+LP(a)),""+t+c+f}function M6(t,r){if(!r)return t;var a=t;return Object.keys(r).forEach(function(c){var f=r[c];f!==void 0&&(Array.isArray(f)&&(f=f.filter(function(_){return _!=null}).join(",")),a=FP(a,c,f))}),a}function R6(t,r){if(!r||t.slice(0,4)==="http")return t;var a=t[0]==="/"?"":"/";return""+r.replace(/\/$/,"")+a+t}function B6(t,r){return r?t.replace(/\/:([a-zA-Z0-9]+)/g,function(a,c){var f=r[c];if(f===void 0)throw new Error("Unspecified route parameter "+c);var _=LP(f);return"/"+_}):t}var L6={appendQueryObject:M6,appendQueryParam:FP,prependOrigin:R6,interpolateRouteParams:B6},F6=RP,yb=fh,O6=z6,Km=L6,qA=Ug,N6=1;function fl(t,r){if(!t)throw new Error("MapiRequest requires a client");if(!r||!r.path||!r.method)throw new Error("MapiRequest requires an options object with path and method properties");var a={};r.body&&(a["content-type"]="application/json");var c=yb(a,r.headers),f=Object.keys(c).reduce(function(_,b){return _[b.toLowerCase()]=c[b],_},{});this.id=N6++,this._options=r,this.emitter=new O6,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=r.path,this.method=r.method,this.origin=r.origin||t.origin,this.query=r.query||{},this.params=r.params||{},this.body=r.body||null,this.file=r.file||null,this.encoding=r.encoding||"utf8",this.sendFileAs=r.sendFileAs||null,this.headers=f}fl.prototype.url=function(r){var a=Km.prependOrigin(this.path,this.origin);a=Km.appendQueryObject(a,this.query);var c=this.params,f=r??this.client.accessToken;if(f){a=Km.appendQueryParam(a,"access_token",f);var _=F6(f).user;c=yb({ownerId:_},c)}return a=Km.interpolateRouteParams(a,c),a};fl.prototype.send=function(){var r=this;if(r.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return r.sent=!0,r.client.sendRequest(r).then(function(a){return r.response=a,r.emitter.emit(qA.EVENT_RESPONSE,a),a},function(a){throw r.error=a,r.emitter.emit(qA.EVENT_ERROR,a),a})};fl.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};fl.prototype.eachPage=function(r){var a=this;function c(b){function s(){delete a._nextPageRequest;var S=b.nextPage();S&&(a._nextPageRequest=S,_(S))}r(null,b,s)}function f(b){r(b,null,function(){})}function _(b){b.send().then(c,f)}_(this)};fl.prototype.clone=function(){return this._extend()};fl.prototype._extend=function(r){var a=yb(this._options,r);return new fl(this.client,a)};var U6=fl,V6=RP,j6=U6,$6=Ug;function OP(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");V6(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||$6.API_ORIGIN}OP.prototype.createRequest=function(r){return new j6(this,r)};var NP=OP,UP=T6,VP=NP;function sh(t){VP.call(this,t)}sh.prototype=Object.create(VP.prototype);sh.prototype.constructor=sh;sh.prototype.sendRequest=UP.browserSend;sh.prototype.abortRequest=UP.browserAbort;function W6(t){return new sh(t)}var jP=W6,q6=jP,G6=q6,H6=Object.prototype.toString,Z6=function(t){var r;return H6.call(t)==="[object Object]"&&(r=Object.getPrototypeOf(t),r===null||r===Object.getPrototypeOf({}))},X6=Z6,K6=fh,$P="value",dx=`
  `,Kr={};Kr.assert=function(t,r){return r=r||{},function(a){var c=ml(t,a);if(c){var f=xb(c,r);throw r.apiName&&(f=r.apiName+": "+f),new Error(f)}}};Kr.shape=function(r){var a=eO(r);return function(f){var _=ml(Kr.plainObject,f);if(_)return _;for(var b,s,S=[],C=0;C<a.length;C++)b=a[C].key,s=a[C].value,_=ml(s,f[b]),_&&S.push([b].concat(_));return S.length<2?S[0]:function(k){S=S.map(function(V){var O=V[0],j=xb(V,k).split(`
`).join(dx);return"- "+O+": "+j});var M=k.path.join("."),L=M===$P?"":" of "+M;return"The following properties"+L+" have invalid values:"+dx+S.join(dx)}}};Kr.strictShape=function(r){var a=Kr.shape(r);return function(f){var _=a(f);if(_)return _;var b=Object.keys(f).reduce(function(s,S){return r[S]===void 0&&s.push(S),s},[]);if(b.length!==0)return function(){return"The following keys are invalid: "+b.join(", ")}}};Kr.arrayOf=function(r){return WP(r)};Kr.tuple=function(){var r=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return WP(r)};function WP(t){var r=Array.isArray(t),a=function(c){return r?t[c]:t};return function(f){var _=ml(Kr.plainArray,f);if(_)return _;if(r&&f.length!==t.length)return"an array with "+t.length+" items";for(var b=0;b<f.length;b++)if(_=ml(a(b),f[b]),_)return[b].concat(_)}}Kr.required=function(r){function a(c){return c==null?function(f){return qP(f,GP(f.path)?"cannot be undefined/null.":"is required.")}:r.apply(this,arguments)}return a.__required=!0,a};Kr.oneOfType=function(){var r=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(c){var f=r.map(function(_){return ml(_,c)}).filter(Boolean);if(f.length===r.length)return f.every(function(_){return _.length===1&&typeof _[0]=="string"})?Y6(f.map(function(_){return _[0]})):f.reduce(function(_,b){return b.length>_.length?b:_})}};Kr.equal=function(r){return function(c){if(c!==r)return JSON.stringify(r)}};Kr.oneOf=function(){var r=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),a=r.map(function(c){return Kr.equal(c)});return Kr.oneOfType.apply(this,a)};Kr.range=function(r){var a=r[0],c=r[1];return function(_){var b=ml(Kr.number,_);if(b||_<a||_>c)return"number between "+a+" & "+c+" (inclusive)"}};Kr.any=function(){};Kr.boolean=function(r){if(typeof r!="boolean")return"boolean"};Kr.number=function(r){if(typeof r!="number")return"number"};Kr.plainArray=function(r){if(!Array.isArray(r))return"array"};Kr.plainObject=function(r){if(!X6(r))return"object"};Kr.string=function(r){if(typeof r!="string")return"string"};Kr.func=function(r){if(typeof r!="function")return"function"};function ml(t,r){if(!(r==null&&!t.hasOwnProperty("__required"))){var a=t(r);if(a)return Array.isArray(a)?a:[a]}}function xb(t,r){var a=t.length,c=t[a-1],f=t.slice(0,a-1);return f.length===0&&(f=[$P]),r=K6(r,{path:f}),typeof c=="function"?c(r):qP(r,J6(c))}function Y6(t){return t.length<2?t[0]:t.length===2?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function J6(t){return"must be "+Q6(t)+"."}function Q6(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function qP(t,r){var a=GP(t.path),c=t.path.join(".")+" "+r,f=a?"Item at position ":"";return f+c}function GP(t){return typeof t[t.length-1]=="number"||typeof t[0]=="number"}function eO(t){return Object.keys(t||{}).map(function(r){return{key:r,value:t[r]}})}Kr.validate=ml;Kr.processMessage=xb;var tO=Kr,rO=fh,Yu=tO;function nO(t){if(typeof window<"u")return t instanceof gt.Blob||t instanceof gt.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof t=="string"||t.pipe!==void 0))return"Filename or Readable stream"}function iO(t,r){return Yu.assert(Yu.strictShape(t),r)}function oO(t){var r="date";if(typeof t=="boolean")return r;try{var a=new Date(t);if(a.getTime&&isNaN(a.getTime()))return r}catch{return r}}function sO(t){return Yu.tuple(Yu.number,Yu.number)(t)}var aO=rO(Yu,{file:nO,date:oO,coordinates:sO,assertShape:iO});function lO(t,r){var a=function(c,f){return r.indexOf(c)!==-1&&f!==void 0};return typeof r=="function"&&(a=r),Object.keys(t).filter(function(c){return a(c,t[c])}).reduce(function(c,f){return c[f]=t[f],c},{})}var cO=lO;function uO(t,r){return Object.keys(t).reduce(function(a,c){return a[c]=r(c,t[c]),a},{})}var hO=uO,dO=hO;function pO(t){return dO(t,function(r,a){return typeof a=="boolean"?JSON.stringify(a):a})}var fO=pO,mO=NP,gO=jP;function _O(t){return function(r){var a;mO.prototype.isPrototypeOf(r)?a=r:a=gO(r);var c=Object.create(t);return c.client=a,c}}var yO=_O,HP=fh,dr=aO,cg=cO,ZP=fO,xO=yO,vb={},XP=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];vb.forwardGeocode=function(t){dr.assertShape({query:dr.required(dr.string),mode:dr.oneOf("mapbox.places","mapbox.places-permanent"),countries:dr.arrayOf(dr.string),proximity:dr.oneOf(dr.coordinates,"ip"),types:dr.arrayOf(dr.oneOf(XP)),autocomplete:dr.boolean,bbox:dr.arrayOf(dr.number),limit:dr.number,language:dr.arrayOf(dr.string),routing:dr.boolean,fuzzyMatch:dr.boolean,worldview:dr.string,session_token:dr.string})(t),t.mode=t.mode||"mapbox.places";var r=ZP(HP({country:t.countries},cg(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:cg(t,["mode","query"]),query:r})};vb.reverseGeocode=function(t){dr.assertShape({query:dr.required(dr.coordinates),mode:dr.oneOf("mapbox.places","mapbox.places-permanent"),countries:dr.arrayOf(dr.string),types:dr.arrayOf(dr.oneOf(XP)),bbox:dr.arrayOf(dr.number),limit:dr.number,language:dr.arrayOf(dr.string),reverseMode:dr.oneOf("distance","score"),routing:dr.boolean,worldview:dr.string,session_token:dr.string})(t),t.mode=t.mode||"mapbox.places";var r=ZP(HP({country:t.countries},cg(t,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:cg(t,["mode","query"]),query:r})};var vO=xO(vb);let bO="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",KP=t=>crypto.getRandomValues(new Uint8Array(t)),YP=(t,r,a)=>{let c=(2<<Math.log(t.length-1)/Math.LN2)-1,f=-~(1.6*c*r/t.length);return(_=r)=>{let b="";for(;;){let s=a(f),S=f|0;for(;S--;)if(b+=t[s[S]&c]||"",b.length===_)return b}}},wO=(t,r=21)=>YP(t,r,KP),EO=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((r,a)=>(a&=63,a<36?r+=a.toString(36):a<62?r+=(a-26).toString(36).toUpperCase():a>62?r+="-":r+="_",r),"");const SO=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:wO,customRandom:YP,nanoid:EO,random:KP,urlAlphabet:bO},Symbol.toStringTag,{value:"Module"})),AO=hC(SO);var TO=AO.nanoid;function JP(t){this.origin=t.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=t.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=t,this.send=this.send.bind(this),this.countries=t.countries?t.countries.split(","):null,this.types=t.types?t.types.split(","):null,this.bbox=t.bbox?t.bbox:null,this.language=t.language?t.language.split(","):null,this.limit=t.limit?+t.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(t),this.eventQueue=new Array,this.flushInterval=t.flushInterval||1e3,this.maxQueueSize=t.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}JP.prototype={select:function(t,r){var a=this.getEventPayload("search.select",r,{selectedFeature:t});if(a&&!(a.resultIndex===this.lastSentIndex&&a.queryString===this.lastSentInput||a.resultIndex==-1))return this.lastSentIndex=a.resultIndex,this.lastSentInput=a.queryString,this.push(a)},start:function(t){var r=this.getEventPayload("search.start",t);if(r)return this.push(r)},keyevent:function(t,r){if(t.key&&!(t.metaKey||[9,27,37,39,13,38,40].indexOf(t.keyCode)!==-1)){var a=this.getEventPayload("search.keystroke",r,{key:t.key});if(a)return this.push(a)}},send:function(t,r){if(!this.enableEventLogging)return r?r():void 0;var a=this.getRequestOptions(t);this.request(a,(function(c){if(c)return this.handleError(c,r);if(r)return r()}).bind(this))},getRequestOptions:function(t){Array.isArray(t)||(t=[t]);var r={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return r},getEventPayload:function(t,r,a={}){if(t==="search.select"&&!a.selectedFeature||t==="search.keystroke"&&!a.key)return null;var c;if(!r.options.proximity)c=null;else if(typeof r.options.proximity=="object")c=[r.options.proximity.longitude,r.options.proximity.latitude];else if(r.options.proximity==="ip"){var f=r._headers?r._headers["ip-proximity"]:null;f&&typeof f=="string"?c=f.split(",").map(parseFloat):c=[999,999]}else c=r.options.proximity;var _=r._map?r._map.getZoom():void 0,b={event:t,version:this.getEventSchemaVersion(t),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:r.options.autocomplete,fuzzyMatch:r.options.fuzzyMatch,proximity:c,limit:r.options.limit,routing:r.options.routing,worldview:r.options.worldview,mapZoom:_,keyboardLocale:this.locale};if(t==="search.select"?b.queryString=r.inputString:t!="search.select"&&r._inputEl?b.queryString=r._inputEl.value:b.queryString=r.inputString,["search.keystroke","search.select"].includes(t)&&(b.path="geocoding/v5/mapbox.places"),t==="search.keystroke"&&a.key)b.lastAction=a.key;else if(t==="search.select"&&a.selectedFeature){var s=a.selectedFeature,S=this.getSelectedIndex(s,r);if(b.resultIndex=S,b.resultPlaceName=s.place_name,b.resultId=s.id,s.properties&&(b.resultMapboxId=s.properties.mapbox_id),r._typeahead){var C=r._typeahead.data;C&&C.length>0&&(b.suggestionIds=this.getSuggestionIds(C),b.suggestionNames=this.getSuggestionNames(C),b.suggestionTypes=this.getSuggestionTypes(C),b.suggestionSources=this.getSuggestionSources(C))}}return this.validatePayload(b)?b:null},request:function(t,r){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(this.readyState==4)return this.status==204?r(null):r(this.statusText)},a.open(t.method,t.host+"/"+t.path,!0);for(var c in t.headers){var f=t.headers[c];a.setRequestHeader(c,f)}a.send(t.body)},handleError:function(t,r){if(r)return r(t)},generateSessionID:function(){return TO()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(t,r){if(r._typeahead){var a=r._typeahead.data,c=t.id,f=a.map(function(b){return b.id}),_=f.indexOf(c);return _}},getSuggestionIds:function(t){return t.map(function(r){return r.properties?r.properties.mapbox_id||"":r.id||""})},getSuggestionNames:function(t){return t.map(function(r){return r.place_name||""})},getSuggestionTypes:function(t){return t.map(function(r){return r.place_type&&Array.isArray(r.place_type)&&r.place_type[0]||""})},getSuggestionSources:function(t){return t.map(function(r){return r._source||""})},getEventSchemaVersion:function(t){return["search.keystroke","search.select"].includes(t)?"2.2":"2.0"},validatePayload:function(t){if(!t||!t.event)return!1;var r=["event","created","sessionIdentifier","queryString"],a=["event","created","sessionIdentifier","queryString","lastAction"],c=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],f=t.event;return f==="search.start"?this.objectHasRequiredProps(t,r):f==="search.keystroke"?this.objectHasRequiredProps(t,a):f==="search.select"?this.objectHasRequiredProps(t,c):!0},objectHasRequiredProps:function(t,r){return r.every(function(a){return a==="queryString"?typeof t[a]=="string"&&t[a].length>0:t[a]!==void 0})},shouldEnableLogging:function(t){return!(t.enableEventLogging===!1||t.origin&&t.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(t,r){this.eventQueue.push(t),(this.eventQueue.length>=this.maxQueueSize||r)&&this.flush()},remove:function(){this.flush()}};var CO=JP,IO={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},kO={placeholder:IO},QP={exports:{}};(function(t){(function(r,a,c){t.exports?t.exports=c():r[a]=c()})(gt,"subtag",function(){var r="",a=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function c(S){return S.match(a)||[]}function f(S){return c(S).filter(function(C,k){return C&&k})}function _(S){return S=c(S),{language:S[1]||r,extlang:S[2]||r,script:S[3]||r,region:S[4]||r}}function b(S,C,k){Object.defineProperty(S,C,{value:k,enumerable:!0})}function s(S,C,k){function M(L){return c(L)[S]||r}b(M,"pattern",C),b(_,k,M)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),b(_,"split",f),_})})(QP);var PO=QP.exports;function ez(){}ez.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const t={enableHighAccuracy:!0};return new Promise(function(r,a){window.navigator.geolocation.getCurrentPosition(r,a,t)})}};var zO=ez;function DO(t,r){const a=tz(t),c=["address","street","place","country"];var f;if(typeof r=="function")return r(a);const _=c.indexOf(r);return _===-1?f=c:f=c.slice(_),f.reduce(function(b,s){return a[s]?(b!==""&&(b=b+", "),b+a[s]):b},"")}function tz(t){const r=t.address||"",a=t.text||"",c=t.place_name||"",_={address:c.split(",")[0],houseNumber:r,street:a,placeName:c};return t.context.forEach(function(b){const s=b.id.split(".")[0];_[s]=b.text}),_}const MO=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var RO={transformFeatureToGeolocationText:DO,getAddressInfo:tz,REVERSE_GEOCODE_COORD_RGX:MO},BO=F8,LO=t6,hc=fh,FO=l6.EventEmitter,GA=c6,px=G6,fx=vO,OO=CO,NO=kO,UO=PO,VO=zO,HA=RO;const Za={FORWARD:0,LOCAL:1,REVERSE:2};function jO(){var t=document.createElement("div");return t.className="mapboxgl-ctrl-geocoder--powered-by",t.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',t}function rz(t){this._eventEmitter=new FO,this.options=hc({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new VO}rz.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(t){return t.place_name},render:function(t){var r=t.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+r[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+r.splice(1,r.length).join(",")+"</div></div>"}},_headers:{},addTo:function(t){function r(a,c){if(!document.body.contains(c))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const f=a.onAdd();c.appendChild(f)}if(t._controlContainer)t.addControl(this);else if(t instanceof HTMLElement)r(this,t);else if(typeof t=="string"){const a=document.querySelectorAll(t);if(a.length===0)throw new Error("Element ",t,"not found.");if(a.length>1)throw new Error("Geocoder can only be added to a single html element");r(this,a[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(t){if(t&&typeof t!="string"&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=fx(px({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new OO(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var r=this.container=document.createElement("div");r.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var a=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",LO(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(C){this.eventManager.keyevent(C,this)}).bind(this));var c=document.createElement("div");c.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var f=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(f),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),c.appendChild(this._clearEl),c.appendChild(this._loadingEl),r.appendChild(a),r.appendChild(this._inputEl),r.appendChild(c),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var _=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(_),c.appendChild(this._geolocateEl),this._showGeolocateButton()}var b=this._typeahead=new BO(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),b.getItemValue=this.options.getItemValue;var s=b.list.draw,S=this._footerNode=jO();return b.list.draw=function(){s.call(this),S.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),S.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(S)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),r},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(t){this._hideLoadingIcon();const r={geometry:{type:"Point",coordinates:[t.coords.longitude,t.coords.latitude]}};this._handleMarker(r),this._fly(r),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(r),this._showClearButton(),this.fresh=!1;const a={limit:1,language:[this.options.language],query:r.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const c=r.geometry.coordinates[0]+","+r.geometry.coordinates[1];this._setInputValue(c),this._eventEmitter.emit("result",{result:r})}else this.geocoderService.reverseGeocode(a).send().then((function(c){const f=c.body.features[0];if(f){const _=HA.transformFeatureToGeolocationText(f,this.options.addressAccuracy);this._setInputValue(_),f.user_coordinates=r.geometry.coordinates,this._eventEmitter.emit("result",{result:f})}else this._eventEmitter.emit("result",{result:{user_coordinates:r.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(t){t.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(t,r){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+t),a.setAttribute("viewBox","0 0 18 18"),a.setAttribute("xml:space","preserve"),a.setAttribute("width",18),a.setAttribute("height",18),a.innerHTML=r,a},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(t){this._inputEl.value=t,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(t){var r=(t.clipboardData||window.clipboardData).getData("text");r.length>=this.options.minLength&&this._geocode(r)},_onKeyDown:function(t){var r=27,a=9;if(t.keyCode===r&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();var c=t.target&&t.target.shadowRoot?t.target.shadowRoot.activeElement:t.target,f=c?c.value:"";if(!f)return this.fresh=!0,t.keyCode!==a&&this.clear(t),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(t.metaKey||[a,r,37,39,13,38,40].indexOf(t.keyCode)!==-1)&&c.value.length>=this.options.minLength&&this._geocode(c.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()},_onChange:function(){var t=this._typeahead.selected;t&&JSON.stringify(t)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(t),this.options.marker&&this._mapboxgl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._eventEmitter.emit("result",{result:t}),this.eventManager.select(t,this))},_fly:function(t){var r;if(t.properties&&GA[t.properties.short_code])r=hc({},this.options.flyTo),this._map&&this._map.fitBounds(GA[t.properties.short_code].bbox,r);else if(t.bbox){var a=t.bbox;r=hc({},this.options.flyTo),this._map&&this._map.fitBounds([[a[0],a[1]],[a[2],a[3]]],r)}else{var c={zoom:this.options.zoom};r=hc({},c,this.options.flyTo),t.center?r.center=t.center:t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&(r.center=t.geometry.coordinates),this._map&&this._map.flyTo(r)}},_requestType:function(t,r){var a;return t.localGeocoderOnly?a=Za.LOCAL:t.reverseGeocode&&HA.REVERSE_GEOCODE_COORD_RGX.test(r)?a=Za.REVERSE:a=Za.FORWARD,a},_setupConfig:function(t,r){const a=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],c=/[\s,]+/;var f=this,_=a.reduce(function(s,S){if(f.options[S]===void 0||f.options[S]===null)return s;["countries","types","language"].indexOf(S)>-1?s[S]=f.options[S].split(c):s[S]=f.options[S];const C=typeof f.options[S].longitude=="number"&&typeof f.options[S].latitude=="number";if(S==="proximity"&&C){const k=f.options[S].longitude,M=f.options[S].latitude;s[S]=[k,M]}return s},{});switch(t){case Za.REVERSE:{var b=r.split(c).map(function(s){return parseFloat(s,10)});f.options.flipCoordinates||b.reverse(),_.types&&_.types[0],_=hc(_,{query:b,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(s){s in _&&delete _[s]})}break;case Za.FORWARD:{const s=r.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(s)&&(r=r.replace(/,/g," ")),_=hc(_,{query:r})}break}return _.session_token=this.eventManager.getSessionId(),_},_geocode:function(t){this.inputString=t,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:t});const r=this._requestType(this.options,t),a=this._setupConfig(r,t);var c;switch(r){case Za.LOCAL:c=Promise.resolve();break;case Za.FORWARD:c=this.geocoderService.forwardGeocode(a).send();break;case Za.REVERSE:c=this.geocoderService.reverseGeocode(a).send();break}var f=this.options.localGeocoder?this.options.localGeocoder(t)||[]:[],_=[],b=null;return c.catch((function(s){b=s}).bind(this)).then((function(s){this._hideLoadingIcon();var S={};return s?s.statusCode=="200"&&(S=s.body,S.request=s.request,S.headers=s.headers,this._headers=s.headers):S={type:"FeatureCollection",features:[]},S.config=a,this.fresh&&(this.eventManager.start(this),this.fresh=!1),S.features&&S.features.length&&S.features.map(function(C){C._source="mapbox"}),S.features=S.features?f.concat(S.features):f,this.options.externalGeocoder?(_=this.options.externalGeocoder(t,S.features)||Promise.resolve([]),_.then(function(C){return S.features=S.features?C.concat(S.features):C,S},function(){return S})):S}).bind(this)).then((function(s){if(b)throw b;this.options.filter&&s.features.length&&(s.features=s.features.filter(this.options.filter)),s.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",s),this._typeahead.update(s.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",s))}).bind(this)).catch((function(s){this._hideLoadingIcon(),this._hideAttribution(),f.length&&this.options.localGeocoder||_.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(f)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:f}),this._eventEmitter.emit("error",{error:s})}).bind(this)),c},_clear:function(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(t){this._clear(t),this._inputEl.focus()},_clearOnBlur:function(t){var r=this;t.relatedTarget&&r._clear(t)},_onQueryResult:function(t){var r=t.body;if(r.features.length){var a=r.features[0];this._typeahead.selected=a,this._inputEl.value=a.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(t){return this._geocode(t).then(this._onQueryResult),this},_renderError:function(){var t="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(t)},_renderLocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(t)},_renderNoResults:function(){var t="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(t)},_renderUserDeniedGeolocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(t)},_renderMessage:function(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var t=this.options.language.split(",")[0],r=UO.language(t),a=NO.placeholder[r];if(a)return a}return"Search"},setInput:function(t,r){return r===void 0&&(r=!1),this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&(r?this._geocode(t):this._onChange()),this},setProximity:function(t,r=!0){return this.options.proximity=t,r&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(t){return t&&typeof t=="function"&&(this._typeahead.render=t),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(t){var r=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=t||this.options.language||r,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(t){return this.options.zoom=t,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(t){return this.options.flyTo=t,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(t){return this.options.placeholder=t||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(t){return this.options.bbox=t,this},getCountries:function(){return this.options.countries},setCountries:function(t){return this.options.countries=t,this},getTypes:function(){return this.options.types},setTypes:function(t){return this.options.types=t,this},getMinLength:function(){return this.options.minLength},setMinLength:function(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this},getLimit:function(){return this.options.limit},setLimit:function(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this},getFilter:function(){return this.options.filter},setFilter:function(t){return this.options.filter=t,this},setOrigin:function(t){return this.options.origin=t,this.geocoderService=fx(px({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(t){return this.options.accessToken=t,this.geocoderService=fx(px({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(t){return this.options.autocomplete=t,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(t){return this.options.fuzzyMatch=t,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(t){return this.options.routing=t,this},getRouting:function(){return this.options.routing},setWorldview:function(t){return this.options.worldview=t,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(t){if(this._map){this._removeMarker();var r={color:"#4668F2"},a=hc({},r,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(a),t.center?this.mapMarker.setLngLat(t.center).addTo(this._map):t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(t,r){return this._eventEmitter.on(t,r),this},off:function(t,r){return this._eventEmitter.removeListener(t,r),this.eventManager.remove(),this}};var $O=rz;const WO=s1($O);/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */function qO(t){const[r,a]=wt.useState(null),c=Object.assign({},t),f=ph(()=>{const _=new WO(Object.assign(Object.assign({},c),{marker:r||!1,accessToken:c.mapboxAccessToken}));return c.onLoading&&_.on("loading",c.onLoading),c.onResults&&_.on("results",c.onResults),c.onResult&&_.on("result",b=>{var s;c.onResult!==void 0&&c.onResult(b);const{result:S}=b,C=S&&(S.center||((s=S.geometry)===null||s===void 0?void 0:s.type)==="Point"&&S.geometry.coordinates);if(C&&c.marker){const k=typeof c.marker=="object"?c.marker:{};a(wt.createElement(bP,Object.assign({},k,{longitude:C[0],latitude:C[1]})))}else a(null)}),c.onError&&_.on("error",c.onError),_},{position:c.position});return f.hasOwnProperty("_map")&&f._map&&(f.getProximity()!==c.proximity&&c.proximity!==void 0&&f.setProximity(c.proximity),f.getRenderFunction()!==c.render&&c.render!==void 0&&f.setRenderFunction(c.render),f.getLanguage()!==c.language&&c.language!==void 0&&f.setLanguage(c.language),f.getZoom()!==c.zoom&&c.zoom!==void 0&&f.setZoom(c.zoom),f.getFlyTo()!==c.flyTo&&c.flyTo!==void 0&&f.setFlyTo(c.flyTo),f.getPlaceholder()!==c.placeholder&&c.placeholder!==void 0&&f.setPlaceholder(c.placeholder),f.getCountries()!==c.countries&&c.countries!==void 0&&f.setCountries(c.countries),f.getTypes()!==c.types&&c.types!==void 0&&f.setTypes(c.types),f.getMinLength()!==c.minLength&&c.minLength!==void 0&&f.setMinLength(c.minLength),f.getLimit()!==c.limit&&c.limit!==void 0&&f.setLimit(c.limit),f.getFilter()!==c.filter&&c.filter!==void 0&&f.setFilter(c.filter),f.getOrigin()!==c.origin&&c.origin!==void 0&&f.setOrigin(c.origin),f.getAutocomplete()!==c.autocomplete&&c.autocomplete!==void 0&&f.setAutocomplete(c.autocomplete),f.getFuzzyMatch()!==c.fuzzyMatch&&c.fuzzyMatch!==void 0&&f.setFuzzyMatch(c.fuzzyMatch),f.getRouting()!==c.routing&&c.routing!==void 0&&f.setRouting(c.routing),f.getWorldview()!==c.worldview&&c.worldview!==void 0&&f.setWorldview(c.worldview)),r}/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */var GO=8,HO="LIVE - CORI light basemap - county labels",ZO={"mapbox:type":"default","mapbox:origin":"light-v10","mapbox:autocomposite":!0,"mapbox:groups":{"1444855769305.6016":{name:"Tunnels",collapsed:!0},"1444855786460.0557":{name:"Roads",collapsed:!0},"1444855799204.86":{name:"Bridges",collapsed:!0},"1444934295202.7542":{name:"Admin boundaries",collapsed:!1}},"mapbox:sdk-support":{js:"0.54.0",android:"7.4.0",ios:"4.10.0"},"mapbox:uiParadigm":"layers","mapbox:thumb":"data:image/webp;base64,UklGRmAJAABXRUJQVlA4TFQJAAAvO8AOAPX4drZtmWTXts7/wMzUqCCLGZOCMjCzbfx/1jFYYr9m+zeF5Gqx8bj3bozqqoouhWLj6dCYQqn+K1W6Vb1HB+Nn+HqXMatDQowkSVJTM/xwkv+mwu1OF8S2kRxJ7PyjfbMzs6a7+j8Be9jFwDSO7Za6ajtXwy/CHsEeYqSRsWzFQAbkSKlndkzfLGcN0zHLlJYZyNmbaOFmTdM0apq3d+t5Y906dr68rJ16zskdY1kaCWdraPJQE8CKlJazrjk+nrVM2/y0Q8ZpQtFux7BmD3bG8fxnncEJvUfnnPObbeMBsKIKWwJLA5PS8njL3DLP4CPmpnkG4+PxuFaBT22n9wiwUuTNx93WpXE+s4bmwJJyWCFwVAX3SJuMZ8fb5ic/uYKb5qc/HY+XqSvlgEmPIYI91BF5/X6fOW3Hpn0x7BGCGMgOIUVMAPdLSmn8xk/+ddM0zT/NUlqmDDhHT0NSj4pzfDEiNh53M7rOC/ElKUxkESgctcF75jilNBuP35gtU2kUjLo1fQicFbF5v7lCb488VM7WALsaKYd2zVFMDJBTSmn50/F4uY8oH9g2dlja+Pv3HebWDpZz2CAZV8BymTpIaTYb/3SZ9qXU6tvEuVU4hpI2Xye6NVcGNl5gQmAtIFJK47Qcj4/vYUcXT2V/e+hiR0dKjfeJAXNqGGNjZyGHYGhSSrPZcjkbH+83Acwe6dm7BBtfXc6umi7y9rHj4OwwIMkKSw5gmVJqm/FsNhvPlmlc+PcAb+MGLpNvvzvdHEb//8OovHFcQ+Yq/v9FAAPYcsiPFeA6pdTGbLkcz8YpXVyWKaW1nwkYRs7diBfOOr8KN/XMr5rQ0a5ZP9bB2pgIyCgcIBlYpJT6JqXl+HicUjv5Y0rp+jbBBm1ktlJfyo4HjVCu55uvNWTWNgGEcRjHAhvXJeOfjmep/JFd4HvbAxzyF3Odt55noJNjJLBCyEgTLJk6peO0PB7PlmVLsAG10hVYoHr+7tb9Xnc+Gq9LkmUp5EAAOaWOWc5mhcmkYAH+9Y69oGxQ5rm+/blu2ZcnO8ieP+xiF/UnHn5CsSdvpGRwWo4fz5bj8QTIKdUqxA4DhjDSXN3bt/Ha18gPbdnClr2jx9/+C/GJd2vFG1e2C6uWywDw0KQAUNdOEHYNtdW/9Ppr//pCNFKyMNiw+I5lm+I8GpNlnQuACwNyDES2sNDdYzNgTqQqy4CycbYlyn/fGMJR56jXN5Bxl/k8lnLsCjmL/zgc0lfHoSnKIiaEXOZssAXrI0t7EE3HQLYenf4V9p3x7Le+duJxX2Uu4IN6w2A8AvZRYLMfBfv7gOs6f/4Qh9THjV3bkxx+9L5vzc/c983rz+06z4+BKDFWCKySTMgGEOW5ydRzy6pCJj76rcn68b9LrtNns3fqsW0A+cjYLlkRkjH3+nFcfyKbqtCX7v4vzs98Z5ulUMGaHrGvbYdldC/acUDMI+ogY9183D4xWa0atXp1Br1lYw5HKnGOiHB2CO/nHtr6vCTlx0cmz3Gsv3eHObHhVctqJNe877Ab7FbtEc2e1A6XKBS5tkS5X360Y9aVjhVZn9gJGwSNx7N9/c6ZCgLgO3R6exWZUku4tlww9q0U0NLnbVRPI7tw57hOOqLMqjr1TIaJXRYSZIVsii+vgOg4skLzlWTD3c//qfA+yp242/sFnDDP4So+huswWBjmlsucf4/xnfEEj8BG783+2+m1R/Cwpne5evS5sQcLGVuteLpeZ7t/G9xbff0Z2zLAfWyKHbTUtLDN0QHWoN5OvctX2717l9Pva6cXffKx4bCViTpG+tVNnNTa5To8WwdB2UMAAw2Zon5/ALs1zbroWo0Y4X6velAf1fMDOyYxtTE8CTd9B3XbZaOa7TodvmY9vT4jvkIrjFmfqvz74xFhs1bO88CeoLNJpRweGiaO6s0RMyD5SJu+O73drb1VV6tOo9aXe3UGdR4CQ54G9w7T69Pt06SzDDx8Hqf1kXqv+rVsSi2rSZ6bubRsjXZYAOrTBwatmpl3mvaI2tXLv/+bbsw9QFv16qXf50bdXd7OZbV7/XOnV6/3p9ml79Y1ZDzSwgXLPLmji9aluLFNAQ9oAxZdfaknii934lsv8XK2bcAjuF9Pr6/O5W/1a0BhTB523M/AWetlA3tmaFOmXUO5w1i2AQLY0+L3n6c4MEOlxchsfJZ6hhtxcSoAnriA7AlgABsJMGZOcfFHk+sMho1j6TdNfOzUi6rwNkXLqsFl2GDLMjmA36dexbYL3nzu+M2J8ZIFfPpBwZZCtilmwEVh+P79qDeifhpzKNl4Pvdv2mupHWSAAUPx+47wnrFx4b4NBocBs4uqJf0XpTady3fw3Mhy/nZW2/5EGHBYVRgb3IEpWqZ0BlsZA7aFW5fuMyencAAHhvuQ8ye+/fD/fvUw4/vvtso8oiDLYLhPX08oOgYl4u6xhubkBMIc/hqo+UQYYmWxr3MIq5CJN2mq5wDKOdew+XfldefSRoX6NZKV69dHAMXLeD/AddTuqU85SNTfH1s4fAR07k8ekrXJlWXqeDtMNhXYR0F5VQKOHGHxcnyJ79kMC/ousDIHp7Zm2CMaCsbK1psuubIKWlaZrZyzye1oO4cmYwCZty45t7eYTIB/AiMHWlV+U9yrjE3k/E/yv9chv6lqOrXQ2oyrr1lzZ8DyAuNQR28WDBhTqMAR7/7MEACWb5ubKeJ7VUxdW8haAAK7otSADZji39Rd2pUKxPyjO8HTp+AHDmFccMG5BLBsF7xYrOIWzjJtvVtw/sKHF/sLgL9vCYxs4YKHZh8Zm1U1nZqa/PTXBuwdMiLP7OLgrULXSAaBsYRs38GW/rtgyWyMlV9EMSMdAKtGqu7Td3BzPBgxAOrjqKZ0wj16DETYvrZc31VRqj24OoBzp4u7vpT7zvk4OqBEuT4seAG4DFeWbLQ+9ZJclv13AxI8+yvIA/qFKR+AwSIfCVAFYJdAoG99F0uAASJ+7Xi5EzjuZk6s0hOYTLCZqwIsl4NhOjk0QLgQkevcYqaLo5VxjzyzJ/ltOJTB8wgDqICNVX3/cUwBt5OcFdkG/4OAbDbok6v49AOAgnrQJKaTmMi5qmKxcLBaev4vkeePDFjAp+cUg2cm51YN1WMoN56HKE4rgx0vnz19+Fc/ub79ZLILKw5pa4UxHOSSqQE="},XO=[-72.26808525539167,43.37747275058169],KO=10.873762090608595,YO=0,JO=2,QO={composite:{url:"mapbox://mapbox.mapbox-terrain-v2,mapbox.mapbox-streets-v8,ruralinno.2pv0vm2z,ruralinno.3v9y79ly,ruralinno.5639ssfg,ruralinno.c504wkuy,ruralinno.7stpbs93,ruralinno.cwz2k5qc,ruralinno.1joudpqe",type:"vector"}},eN="mapbox://sprites/ruralinno/cl010e7b7001p15pe3l0306hv/68n9slz9mfbus83an19oqbf32",tN="mapbox://fonts/ruralinno/{fontstack}/{range}.pbf",rN=[{id:"land",type:"background",layout:{},paint:{"background-color":"hsl(55, 0%, 100%)"}},{id:"landcover",type:"fill",source:"composite","source-layer":"landcover",maxzoom:7,layout:{},paint:{"fill-color":"hsl(0, 0%, 100%)","fill-opacity":["interpolate",["exponential",1.5],["zoom"],2,.1,7,0],"fill-antialias":!1}},{id:"national-park",type:"fill",source:"composite","source-layer":"landuse_overlay",minzoom:5,filter:["==",["get","class"],"national_park"],layout:{},paint:{"fill-color":"hsla(150, 6%, 93%, 0.63)","fill-opacity":["interpolate",["linear"],["zoom"],5,0,6,.5]}},{id:"landuse",type:"fill",source:"composite","source-layer":"landuse",minzoom:5,filter:["match",["get","class"],["park","airport","glacier","pitch","sand"],!0,!1],layout:{},paint:{"fill-opacity":["interpolate",["linear"],["zoom"],5,0,6,["match",["get","class"],"glacier",.5,1]],"fill-color":"hsl(150, 0%, 100%)"}},{id:"water-shadow",type:"fill",source:"composite","source-layer":"water",layout:{},paint:{"fill-translate-anchor":"viewport","fill-translate":["interpolate",["exponential",1.2],["zoom"],7,["literal",[0,0]],16,["literal",[-1,-1]]],"fill-color":"hsl(185, 7%, 73%)"}},{id:"waterway",type:"line",source:"composite","source-layer":"waterway",minzoom:8,layout:{"line-cap":["step",["zoom"],"butt",11,"round"],"line-join":"round"},paint:{"line-color":"hsl(187, 9%, 81%)","line-width":["interpolate",["exponential",1.3],["zoom"],9,["match",["get","class"],["canal","river"],.1,0],20,["match",["get","class"],["canal","river"],8,3]],"line-opacity":["interpolate",["linear"],["zoom"],8,0,8.5,1]}},{id:"water",type:"fill",source:"composite","source-layer":"water",layout:{},paint:{"fill-color":"#cad2d3","fill-opacity":.5}},{id:"hillshade",type:"fill",source:"composite","source-layer":"hillshade",minzoom:6,layout:{},paint:{"fill-color":["match",["get","class"],"shadow","hsl(0, 0%, 35%)","hsl(0, 0%, 100%)"],"fill-opacity":["interpolate",["linear"],["zoom"],12,["match",["get","level"],[67,56],.02,[89,78],.01,.015],15,0]}},{id:"land-structure-polygon",type:"fill",source:"composite","source-layer":"structure",minzoom:21.1,filter:["all",["==",["geometry-type"],"Polygon"],["==",["get","class"],"land"]],layout:{},paint:{"fill-color":"hsl(156, 20%, 95%)"}},{id:"land-structure-line",type:"line",source:"composite","source-layer":"structure",minzoom:13,filter:["all",["==",["geometry-type"],"LineString"],["==",["get","class"],"land"]],layout:{"line-cap":"round"},paint:{"line-width":["interpolate",["exponential",1.99],["zoom"],14,.75,20,40],"line-color":"hsl(156, 20%, 95%)"}},{id:"aeroway-polygon",type:"fill",source:"composite","source-layer":"aeroway",minzoom:11,filter:["all",["==",["geometry-type"],"Polygon"],["match",["get","type"],["runway","taxiway","helipad"],!0,!1]],layout:{},paint:{"fill-opacity":["interpolate",["linear"],["zoom"],11,0,11.5,1],"fill-color":"hsl(0, 0%, 97%)"}},{id:"aeroway-line",type:"line",source:"composite","source-layer":"aeroway",minzoom:9,filter:["==",["geometry-type"],"LineString"],layout:{},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],9,["match",["get","type"],"runway",1,.5],18,["match",["get","type"],"runway",80,20]],"line-color":"hsl(0, 0%, 97%)"}},{id:"building-outline",type:"line",source:"composite","source-layer":"building",minzoom:15,filter:["all",["!=",["get","type"],"building:part"],["==",["get","underground"],"false"]],layout:{},paint:{"line-color":"hsl(55, 3%, 87%)","line-width":["interpolate",["exponential",1.5],["zoom"],15,.75,20,3],"line-opacity":["interpolate",["linear"],["zoom"],15,0,16,1]}},{id:"building",type:"fill",source:"composite","source-layer":"building",minzoom:15,filter:["all",["!=",["get","type"],"building:part"],["==",["get","underground"],"false"]],layout:{},paint:{"fill-outline-color":"hsl(55, 3%, 87%)","fill-opacity":["interpolate",["linear"],["zoom"],15,0,16,1],"fill-color":"hsl(55, 5%, 91%)"}},{id:"tunnel-street-minor-low",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(185, 7%, 88%)","line-opacity":["step",["zoom"],1,14,0]}},{id:"tunnel-street-minor-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(185, 12%, 89%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-opacity":["step",["zoom"],0,14,1],"line-dasharray":[3,3]}},{id:"tunnel-primary-secondary-tertiary-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,["match",["get","class"],"primary",1,.75],18,2],"line-color":"hsl(185, 12%, 89%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,.1],18,["match",["get","class"],"primary",32,26]],"line-dasharray":[3,3]}},{id:"tunnel-major-link-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(185, 12%, 89%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-dasharray":[3,3]}},{id:"tunnel-motorway-trunk-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(185, 12%, 89%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-dasharray":[3,3]}},{id:"tunnel-construction",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"construction"],["==",["geometry-type"],"LineString"]],layout:{},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,18],"line-color":"hsl(187, 7%, 88%)","line-dasharray":["step",["zoom"],["literal",[.4,.8]],15,["literal",[.3,.6]],16,["literal",[.2,.3]],17,["literal",[.2,.25]],18,["literal",[.15,.15]]]}},{id:"tunnel-path",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"path"],["!=",["get","type"],"steps"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,18,4],"line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[1,.5]]],"line-color":"hsl(0, 0%, 85%)"}},{id:"tunnel-steps",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"steps"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,16,1.6,18,6],"line-color":"hsl(0, 0%, 85%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[.3,.3]]]}},{id:"tunnel-major-link",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(187, 7%, 88%)"}},{id:"tunnel-pedestrian",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"pedestrian"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,18,12],"line-color":"hsl(187, 7%, 88%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.5,.4]],16,["literal",[1,.2]]]}},{id:"tunnel-street-minor",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(187, 7%, 88%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"tunnel-primary-secondary-tertiary",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,.1],18,["match",["get","class"],"primary",32,26]],"line-color":"hsl(187, 7%, 88%)"}},{id:"tunnel-motorway-trunk",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":"hsl(187, 7%, 88%)"}},{id:"road-pedestrian-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"pedestrian"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,14.5],"line-color":"hsl(156, 12%, 92%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"road-minor-low",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["step",["zoom"],["==",["get","class"],"track"],14,["match",["get","class"],["track","secondary_link","tertiary_link","service"],!0,!1]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,["match",["get","class"],"track",1,.5],18,12],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],1,14,0]}},{id:"road-street-low",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:11,filter:["all",["match",["get","class"],["street","street_limited","primary_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],1,14,0]}},{id:"road-minor-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["step",["zoom"],["==",["get","class"],"track"],14,["match",["get","class"],["track","secondary_link","tertiary_link","service"],!0,!1]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],14,["match",["get","class"],"track",1,.5],18,12],"line-opacity":["step",["zoom"],0,14,1]}},{id:"road-street-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:11,filter:["all",["match",["get","class"],["street","street_limited","primary_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-opacity":["step",["zoom"],0,14,1]}},{id:"road-secondary-tertiary-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:9.3,filter:["all",["match",["get","class"],["secondary","tertiary"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,.75,18,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.1,18,26]}},{id:"road-primary-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:9.9,filter:["all",["==",["get","class"],"primary"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32]}},{id:"road-major-link-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:10,filter:["all",["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-opacity":["step",["zoom"],0,11,1]}},{id:"road-motorway-trunk-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:8.5,filter:["all",["match",["get","class"],["motorway","trunk"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-opacity":["step",["zoom"],["match",["get","class"],"motorway",1,0],6,1]}},{id:"road-construction",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","class"],"construction"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,18],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[.4,.8]],15,["literal",[.3,.6]],16,["literal",[.2,.3]],17,["literal",[.2,.25]],18,["literal",[.15,.15]]]}},{id:"road-path",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"path"],["step",["zoom"],["!",["match",["get","type"],["steps","sidewalk","crossing"],!0,!1]],16,["!=",["get","type"],"steps"]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],13,.5,14,1,15,1,18,4],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[1,.5]]]}},{id:"road-steps",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","type"],"steps"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,16,1.6,18,6],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[.3,.3]]]}},{id:"road-major-link",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:10,filter:["all",["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(0, 0%, 100%)"}},{id:"road-pedestrian",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"pedestrian"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,18,12],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.5,.4]],16,["literal",[1,.2]]]}},{id:"road-minor",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["step",["zoom"],["==",["get","class"],"track"],14,["match",["get","class"],["track","secondary_link","tertiary_link","service"],!0,!1]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,["match",["get","class"],"track",1,.5],18,12],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"road-street",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:11,filter:["all",["match",["get","class"],["street","street_limited","primary_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"road-secondary-tertiary",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",filter:["all",["match",["get","class"],["secondary","tertiary"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.1,18,22],"line-color":"hsl(0, 0%, 100%)"}},{id:"road-primary",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:9,filter:["all",["==",["get","class"],"primary"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":"#f6eac1","line-opacity":["interpolate",["linear"],["zoom"],6,0,8,["match",["get","class"],["trunk"],.2,0],16,["match",["get","class"],["trunk"],1,.81]]}},{id:"road-motorway-trunk",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:8,filter:["all",["match",["get","class"],["motorway","trunk"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.5,18,32],"line-color":["match",["get","class"],["motorway"],"hsl(26, 100%, 68%)","#f2d163"],"line-opacity":["interpolate",["linear"],["zoom"],6,["match",["get","class"],["trunk"],.3,0],8,.4,18,.7]}},{id:"road-rail",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["match",["get","class"],["major_rail","minor_rail"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,20,1],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-pedestrian-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"pedestrian"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,14.5],"line-opacity":["step",["zoom"],0,14,1],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-street-minor-low",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],1,14,0]}},{id:"bridge-street-minor-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-opacity":["step",["zoom"],0,14,1],"line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-primary-secondary-tertiary-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,["match",["get","class"],"primary",1,.75],18,2],"line-opacity":["step",["zoom"],0,10,1],"line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,.1],18,["match",["get","class"],"primary",32,26]],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-major-link-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-motorway-trunk-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway","trunk"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-construction",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"construction"],["==",["geometry-type"],"LineString"]],layout:{},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,18],"line-dasharray":["step",["zoom"],["literal",[.4,.8]],15,["literal",[.3,.6]],16,["literal",[.2,.3]],17,["literal",[.2,.25]],18,["literal",[.15,.15]]],"line-color":"hsl(156, 0%, 100%)"}},{id:"bridge-path",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"path"],["!=",["get","type"],"steps"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,18,4],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[1,.5]]]}},{id:"bridge-steps",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","type"],"steps"],["==",["get","structure"],"bridge"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,16,1.6,18,6],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[.3,.3]]]}},{id:"bridge-major-link",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(0, 0%, 100%)"}},{id:"bridge-pedestrian",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"pedestrian"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,18,12],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.5,.4]],16,["literal",[1,.2]]]}},{id:"bridge-street-minor",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"bridge-primary-secondary-tertiary",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,.1],18,["match",["get","class"],"primary",32,26]],"line-color":"hsl(0, 0%, 100%)"}},{id:"bridge-motorway-trunk",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway","trunk"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":"hsl(0, 0%, 100%)"}},{id:"bridge-rail",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["major_rail","minor_rail"],!0,!1]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,20,1],"line-color":"hsl(156, 12%, 92%)"}},{id:"bridge-major-link-2-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18]}},{id:"bridge-motorway-trunk-2-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(156, 12%, 92%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32]}},{id:"bridge-major-link-2",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(0, 0%, 100%)"}},{id:"bridge-motorway-trunk-2",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":"hsl(0, 0%, 100%)"}},{id:"admin-1-boundary-bg",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",filter:["all",["==",["get","admin_level"],1],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"bevel"},paint:{"line-blur":["interpolate",["linear"],["zoom"],3,0,8,3],"line-width":["interpolate",["linear"],["zoom"],7,3.75,12,5.5],"line-opacity":["interpolate",["linear"],["zoom"],7,0,8,.75],"line-dasharray":[1,0],"line-translate":[0,0],"line-color":"hsl(0, 0%, 84%)"}},{id:"admin-0-boundary-bg",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",minzoom:1,filter:["all",["==",["get","admin_level"],0],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],paint:{"line-width":["interpolate",["linear"],["zoom"],3,3.5,10,8],"line-color":"hsl(0, 0%, 84%)","line-opacity":["interpolate",["linear"],["zoom"],3,0,4,.5],"line-translate":[0,0],"line-blur":["interpolate",["linear"],["zoom"],3,0,10,2]}},{id:"admin-1-boundary",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",filter:["all",["==",["get","admin_level"],1],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":["interpolate",["linear"],["zoom"],7,.75,12,1.5],"line-opacity":["interpolate",["linear"],["zoom"],2,0,3,1],"line-color":["interpolate",["linear"],["zoom"],3,"hsl(0, 0%, 80%)",7,"hsl(0, 0%, 70%)"]}},{id:"admin-0-boundary",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",minzoom:1,filter:["all",["==",["get","admin_level"],0],["==",["get","disputed"],"false"],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"hsl(0, 0%, 62%)","line-width":["interpolate",["linear"],["zoom"],3,.5,10,2]}},{id:"admin-0-boundary-disputed",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",minzoom:1,filter:["all",["==",["get","disputed"],"true"],["==",["get","admin_level"],0],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"round"},paint:{"line-dasharray":[1.5,1.5],"line-color":"hsl(0, 0%, 62%)","line-width":["interpolate",["linear"],["zoom"],3,.5,10,2]}},{id:"county_border",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"attr_county_labels_pg-155yvu",minzoom:6,maxzoom:12,paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,9,1.7,18,2],"line-color":"hsl(0, 0%, 59%)","line-opacity":["interpolate",["linear"],["zoom"],5,.2,9,.5,18,1]}},{id:"cousub_border",type:"line",source:"composite","source-layer":"attr_cousub_labels_less_pl-9lemol",minzoom:8,maxzoom:14,layout:{},paint:{"line-color":"hsl(0, 3%, 38%)","line-width":["interpolate",["linear"],["zoom"],0,1,6,1,22,1],"line-opacity":["interpolate",["linear"],["zoom"],7,.1,18,.2]}},{id:"place_border",type:"line",source:"composite","source-layer":"attr_place_labels_less_pl-0n1bxr",minzoom:8,maxzoom:14,paint:{"line-color":"hsla(0, 0%, 58%, 0.62)","line-dasharray":[3,2]}},{id:"road-label",type:"symbol",source:"composite","source-layer":"road",minzoom:10,filter:["step",["zoom"],["match",["get","class"],["motorway","trunk","primary","secondary","tertiary"],!0,!1],12,["match",["get","class"],["motorway","trunk","primary","secondary","tertiary","pedestrian","street","street_limited"],!0,!1],15,["match",["get","class"],["ferry","golf","path"],!1,!0]],layout:{"text-size":["interpolate",["linear"],["zoom"],10,["match",["get","class"],["motorway","trunk","primary","secondary","tertiary"],10,["motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","pedestrian","street","street_limited"],9,6.5],18,["match",["get","class"],["motorway","trunk","primary","secondary","tertiary"],16,["motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","pedestrian","street","street_limited"],14,13]],"text-max-angle":30,"text-font":["DIN Offc Pro Regular","Arial Unicode MS Regular"],"symbol-placement":"line","text-padding":1,"text-rotation-alignment":"map","text-pitch-alignment":"viewport","text-field":["coalesce",["get","name_en"],["get","name"]],"text-letter-spacing":.01},paint:{"text-color":"hsl(0, 0%, 42%)","text-halo-color":["match",["get","class"],["motorway","trunk"],"hsla(0, 0%, 100%, 0.75)","hsl(0, 0%, 100%)"],"text-halo-blur":1,"text-halo-width":.1}},{id:"waterway-label",type:"symbol",source:"composite","source-layer":"natural_label",minzoom:13,filter:["all",["match",["get","class"],["canal","river","stream"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"text-max-angle":30,"symbol-spacing":["interpolate",["linear",1],["zoom"],15,250,17,400],"text-size":["interpolate",["linear"],["zoom"],13,12,18,16],"symbol-placement":"line","text-pitch-alignment":"viewport","text-field":["coalesce",["get","name_en"],["get","name"]]},paint:{"text-color":"hsl(187, 7%, 51%)"}},{id:"natural-line-label",type:"symbol",source:"composite","source-layer":"natural_label",minzoom:4,filter:["all",["match",["get","class"],["glacier","landform"],!0,!1],["==",["geometry-type"],"LineString"],["<=",["get","filterrank"],1]],layout:{"text-size":["step",["zoom"],["step",["get","sizerank"],18,5,12],17,["step",["get","sizerank"],18,13,12]],"text-max-angle":30,"text-field":["coalesce",["get","name_en"],["get","name"]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"symbol-placement":"line-center","text-pitch-alignment":"viewport"},paint:{"text-halo-width":.5,"text-halo-color":"hsl(0, 0%, 100%)","text-halo-blur":.5,"text-color":"hsl(0, 0%, 42%)"}},{id:"natural-point-label",type:"symbol",source:"composite","source-layer":"natural_label",minzoom:4,filter:["all",["match",["get","class"],["dock","glacier","landform","water_feature","wetland"],!0,!1],["==",["geometry-type"],"Point"],["<=",["get","filterrank"],1]],layout:{"text-size":["step",["zoom"],["step",["get","sizerank"],18,5,12],17,["step",["get","sizerank"],18,13,12]],"text-field":["coalesce",["get","name_en"],["get","name"]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"text-offset":["literal",[0,0]]},paint:{"text-color":"hsl(0, 0%, 42%)","text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":.5,"text-halo-blur":.5}},{id:"water-line-label",type:"symbol",source:"composite","source-layer":"natural_label",filter:["all",["match",["get","class"],["bay","ocean","reservoir","sea","water"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"text-size":["interpolate",["linear"],["zoom"],7,["step",["get","sizerank"],24,6,18,12,12],10,["step",["get","sizerank"],18,9,12],18,["step",["get","sizerank"],18,9,16]],"text-max-angle":30,"text-letter-spacing":["match",["get","class"],"ocean",.25,["sea","bay"],.15,0],"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"symbol-placement":"line-center","text-pitch-alignment":"viewport","text-field":["coalesce",["get","name_en"],["get","name"]]},paint:{"text-color":"hsl(187, 7%, 51%)"}},{id:"water-point-label",type:"symbol",source:"composite","source-layer":"natural_label",filter:["all",["match",["get","class"],["bay","ocean","reservoir","sea","water"],!0,!1],["==",["geometry-type"],"Point"]],layout:{"text-line-height":1.3,"text-size":["interpolate",["linear"],["zoom"],7,["step",["get","sizerank"],24,6,18,12,12],10,["step",["get","sizerank"],18,9,12]],"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"text-field":["coalesce",["get","name_en"],["get","name"]],"text-letter-spacing":["match",["get","class"],"ocean",.25,["bay","sea"],.15,.01],"text-max-width":["match",["get","class"],"ocean",4,"sea",5,["bay","water"],7,10]},paint:{"text-color":"hsl(187, 7%, 51%)"}},{id:"poi-label",type:"symbol",source:"composite","source-layer":"poi_label",minzoom:6,filter:["<=",["get","filterrank"],1],layout:{"text-size":["step",["zoom"],["step",["get","sizerank"],18,5,12],17,["step",["get","sizerank"],18,13,12]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"text-field":["coalesce",["get","name_en"],["get","name"]]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":.1,"text-halo-blur":.5,"text-color":["step",["zoom"],["step",["get","sizerank"],"hsl(0, 0%, 66%)",5,"hsl(230, 0%, 56%)"],17,["step",["get","sizerank"],"hsl(0, 0%, 66%)",13,"hsl(0, 0%, 56%)"]]}},{id:"airport-label",type:"symbol",source:"composite","source-layer":"airport_label",minzoom:8,layout:{"text-line-height":1.1,"text-size":["step",["get","sizerank"],18,9,12],"icon-image":["step",["get","sizerank"],["concat",["get","maki"],"-15"],9,["concat",["get","maki"],"-11"]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],visibility:"none","text-offset":[0,.75],"text-rotation-alignment":"viewport","text-anchor":"top","text-field":["step",["get","sizerank"],["coalesce",["get","name_en"],["get","name"]],15,["get","ref"]],"text-letter-spacing":.01,"text-max-width":9},paint:{"text-color":"hsla(0, 0%, 42%, 0)","text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-opacity":0}},{id:"settlement-subdivision-label",type:"symbol",source:"composite","source-layer":"place_label",minzoom:10,maxzoom:15,filter:["all",["==",["get","class"],"settlement_subdivision"],["<=",["get","filterrank"],4]],layout:{"text-field":["coalesce",["get","name_en"],["get","name"]],"text-transform":"uppercase","text-font":["DIN Offc Pro Regular","Arial Unicode MS Regular"],"text-letter-spacing":["match",["get","type"],"suburb",.15,.1],"text-max-width":7,"text-padding":3,"text-size":["interpolate",["cubic-bezier",.5,0,1,1],["zoom"],11,["match",["get","type"],"suburb",11,10.5],15,["match",["get","type"],"suburb",17,16]],visibility:"none"},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-color":"hsl(0, 0%, 62%)","text-halo-blur":.5,"text-halo-width":.1}},{id:"state-label",type:"symbol",source:"composite","source-layer":"place_label",minzoom:3,maxzoom:9,filter:["==",["get","class"],"state"],layout:{"text-size":["interpolate",["cubic-bezier",.85,.7,.65,1],["zoom"],4,["step",["get","symbolrank"],10,6,9.5,7,9],9,["step",["get","symbolrank"],24,6,18,7,14]],"text-transform":"uppercase","text-font":["DIN Offc Pro Bold","Arial Unicode MS Bold"],"text-field":["step",["zoom"],["step",["get","symbolrank"],["coalesce",["get","name_en"],["get","name"]],5,["coalesce",["get","abbr"],["get","name_en"],["get","name"]]],5,["coalesce",["get","name_en"],["get","name"]]],"text-letter-spacing":.15,"text-max-width":6},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-color":"hsl(0, 0%, 66%)","text-halo-width":.1}},{id:"county_label",type:"symbol",source:"composite","source-layer":"attr_county_labels-5i5o0f",minzoom:7.5,maxzoom:14,layout:{"text-field":["step",["zoom"],["upcase",["to-string",["get","name"]]],6,["upcase",["to-string",["get","name"]]],10,["upcase",["to-string",["get","namelsad"]]],22,["upcase",["to-string",["get","namelsad"]]]],"text-font":["step",["zoom"],["literal",["Open Sans Regular","Arial Unicode MS Regular"]],6,["literal",["Montserrat Medium","Arial Unicode MS Regular"]],8,["literal",["Montserrat Medium","Arial Unicode MS Regular"]],11,["literal",["Montserrat Medium","Arial Unicode MS Regular"]],22,["literal",["Montserrat Medium","Arial Unicode MS Regular"]]],"text-size":["interpolate",["linear"],["zoom"],0,0,6,6,6.5,10,7.5,14,9,30,11,75,14,85],"text-allow-overlap":["step",["zoom"],!1,5,!1,10,!1,11,!0],"text-max-width":5,"text-ignore-placement":["step",["zoom"],!1,6,!1,9,!0,12,!0,22,!0]},paint:{"text-color":"hsl(0, 0%, 48%)","text-opacity":["interpolate",["linear"],["zoom"],6.49999,1,6.5,.7,8,.3,11,.1,16,.05]}},{id:"cousub_label",type:"symbol",source:"composite","source-layer":"attr_cousub_labels_plus_pt-0kx5lj",minzoom:9,layout:{"text-field":["upcase",["get","display_name"]],"text-size":["interpolate",["linear"],["zoom"],7.9,0,8,8,9,10,14,30],"text-max-width":5,"text-line-height":1.1,visibility:"none"},paint:{"text-color":"hsla(0, 0%, 31%, 0.76)","text-halo-width":10,"text-halo-color":"hsl(0, 0%, 100%)"}},{id:"place-label new",type:"symbol",source:"composite","source-layer":"rural_places-4rf4i9",minzoom:9,filter:["match",["get","census_boundary_year"],[2020],!0,!1],layout:{"text-line-height":1.1,"text-size":["interpolate",["cubic-bezier",.2,0,.9,1],["zoom"],3,["step",["get","symbolrank"],12,9,11,10,10.5,12,9.5,14,8.5,16,6.5,17,4],15,["step",["get","symbolrank"],28,9,26,10,23,11,21,12,20,13,19,15,17]],"icon-image":["case",["==",["get","capital"],2],"border-dot-13",["step",["get","symbolrank"],"dot-11",9,"dot-10",11,"dot-9"]],"text-font":["Montserrat Medium","Arial Unicode MS Regular"],"text-justify":["step",["zoom"],["match",["get","text_anchor"],["left","bottom-left","top-left"],"left",["right","bottom-right","top-right"],"right","center"],8,"center"],visibility:"none","text-offset":["step",["zoom"],["match",["get","capital"],2,["match",["get","text_anchor"],"bottom",["literal",[0,-.3]],"bottom-left",["literal",[.3,-.1]],"left",["literal",[.45,.1]],"top-left",["literal",[.3,.1]],"top",["literal",[0,.3]],"top-right",["literal",[-.3,.1]],"right",["literal",[-.45,0]],"bottom-right",["literal",[-.3,-.1]],["literal",[0,-.3]]],["match",["get","text_anchor"],"bottom",["literal",[0,-.25]],"bottom-left",["literal",[.2,-.05]],"left",["literal",[.4,.05]],"top-left",["literal",[.2,.05]],"top",["literal",[0,.25]],"top-right",["literal",[-.2,.05]],"right",["literal",[-.4,.05]],"bottom-right",["literal",[-.2,-.05]],["literal",[0,-.25]]]],8,["literal",[0,0]]],"text-anchor":["step",["zoom"],["get","text_anchor"],8,"center"],"text-field":["coalesce",["get","NAME"]],"text-max-width":7},paint:{"text-color":["step",["get","symbolrank"],"hsl(0, 2%, 61%)",11,"hsl(0, 1%, 68%)",16,"hsl(0, 1%, 75%)"],"text-halo-color":"hsl(0, 0%, 100%)","icon-opacity":["step",["zoom"],1,8,0],"text-halo-blur":1,"text-halo-width":.1}},{id:"settlement-label",type:"symbol",source:"composite","source-layer":"place_label",maxzoom:10.76,filter:["all",["<=",["get","filterrank"],3],["==",["get","class"],"settlement"],["step",["zoom"],!0,12,[">=",["get","symbolrank"],11],13,[">=",["get","symbolrank"],12]]],layout:{"text-line-height":1.1,"text-size":["interpolate",["cubic-bezier",.2,0,.9,1],["zoom"],3,["step",["get","symbolrank"],12,9,11,10,10.5,12,9.5,14,8.5,16,6.5,17,4],15,["step",["get","symbolrank"],28,9,26,10,23,11,21,12,20,13,19,15,17]],"icon-image":["case",["==",["get","capital"],2],"border-dot-13",["step",["get","symbolrank"],"dot-11",9,"dot-10",11,"dot-9"]],"text-font":["step",["zoom"],["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]],8,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],11,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],10,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],12,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],11,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],13,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],12,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],15,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],13,["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]]],"text-justify":["step",["zoom"],["match",["get","text_anchor"],["left","bottom-left","top-left"],"left",["right","bottom-right","top-right"],"right","center"],8,"center"],"text-offset":["step",["zoom"],["match",["get","capital"],2,["match",["get","text_anchor"],"bottom",["literal",[0,-.3]],"bottom-left",["literal",[.3,-.1]],"left",["literal",[.45,.1]],"top-left",["literal",[.3,.1]],"top",["literal",[0,.3]],"top-right",["literal",[-.3,.1]],"right",["literal",[-.45,0]],"bottom-right",["literal",[-.3,-.1]],["literal",[0,-.3]]],["match",["get","text_anchor"],"bottom",["literal",[0,-.25]],"bottom-left",["literal",[.2,-.05]],"left",["literal",[.4,.05]],"top-left",["literal",[.2,.05]],"top",["literal",[0,.25]],"top-right",["literal",[-.2,.05]],"right",["literal",[-.4,.05]],"bottom-right",["literal",[-.2,-.05]],["literal",[0,-.25]]]],8,["literal",[0,0]]],"text-anchor":["step",["zoom"],["get","text_anchor"],8,"center"],"text-field":["coalesce",["get","name_en"],["get","name"]],"text-max-width":7},paint:{"text-color":["step",["get","symbolrank"],"hsl(0, 0%, 42%)",11,"hsl(0, 0%, 55%)",16,"hsl(0, 0%, 62%)"],"text-halo-color":"hsl(0, 0%, 100%)","icon-opacity":["step",["zoom"],1,8,0],"text-halo-blur":1,"text-halo-width":.1}},{id:"wwb2s-places_lat_lon",type:"symbol",source:"composite","source-layer":"places_lat_lon-awryh9",minzoom:10.75,maxzoom:20,filter:["all",[">=",["get","pop"],101],[">",["get","pct_rural"],0],["step",["zoom"],!0,13,[">=",["get","symbolrank"],11],14,[">=",["get","symbolrank"],13]]],layout:{"text-line-height":1.1,"text-size":["step",["get","symbolrank"],20,9,18,10,16,11,14,12,12],"icon-image":["case",["==",["get","capital"],2],"border-dot-13",["step",["get","symbolrank"],"dot-11",9,"dot-10",11,"dot-9"]],"text-font":["step",["zoom"],["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]],8,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],11,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],10,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],12,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],11,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],13,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],12,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],15,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],13,["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]]],"text-justify":["step",["zoom"],["match",["get","text_anchor"],["left","bottom-left","top-left"],"left",["right","bottom-right","top-right"],"right","center"],8,"center"],"text-offset":["step",["zoom"],["match",["get","capital"],2,["match",["get","text_anchor"],"bottom",["literal",[0,-.3]],"bottom-left",["literal",[.3,-.1]],"left",["literal",[.45,.1]],"top-left",["literal",[.3,.1]],"top",["literal",[0,.3]],"top-right",["literal",[-.3,.1]],"right",["literal",[-.45,0]],"bottom-right",["literal",[-.3,-.1]],["literal",[0,-.3]]],["match",["get","text_anchor"],"bottom",["literal",[0,-.25]],"bottom-left",["literal",[.2,-.05]],"left",["literal",[.4,.05]],"top-left",["literal",[.2,.05]],"top",["literal",[0,.25]],"top-right",["literal",[-.2,.05]],"right",["literal",[-.4,.05]],"bottom-right",["literal",[-.2,-.05]],["literal",[0,-.25]]]],8,["literal",[0,0]]],"text-anchor":["step",["zoom"],["get","text_anchor"],8,"center"],"text-field":["coalesce",["get","NAME"],["get","name"]],"text-max-width":7},paint:{"text-halo-color":"hsl(0, 0%, 100%)","icon-opacity":["step",["zoom"],1,8,0],"text-halo-blur":1,"text-halo-width":.1,"text-color":["interpolate",["linear"],["zoom"],0,"hsl(0, 0%, 62%)",22,"#000000"],"text-opacity":["interpolate",["linear"],["zoom"],7,0,9,.97,22,1]}},{id:"custom-pattern",type:"fill",source:"composite","source-layer":"attr_county_labels_pg-155yvu",minzoom:6,layout:{visibility:"none"},paint:{"fill-color":"hsla(303, 73%, 74%, 0.66)","fill-pattern":"stripe-4"}}],nN="2022-02-24T13:16:14.872Z",iN="2024-07-11T16:18:50.102Z",oN="cl010e7b7001p15pe3l0306hv",sN="ruralinno",aN="private",lN=!1,cN={version:GO,name:HO,metadata:ZO,center:XO,zoom:KO,bearing:YO,pitch:JO,sources:QO,sprite:eN,glyphs:tN,layers:rN,created:nN,modified:iN,id:oN,owner:sN,visibility:aN,protected:!1,draft:lN};/*
 * Frontend UI component library for the CORI Data API 
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */Object.assign({},cN);var nz={exports:{}};(function(t,r){(function(a,c){t.exports=c()})(gt,function(){var a,c,f;function _(s,S){if(!a)a=S;else if(!c)c=S;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",k={};a(k),f=S(k),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}_(["exports"],function(s){var S=typeof self<"u"?self:{},C="2.15.0";let k;const M={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(k==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{k={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):n}catch{k=n}}return k},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!M.API_URL)return null;try{const n=new URL(M.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},L={supported:!1,testSupport:function(n){!j&&O&&(H?Z(n):V=n)}};let V,O,j=!1,H=!1;function Z(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,O),n.isContextLost())return;L.supported=!0}catch{}n.deleteTexture(e),j=!0}S.document&&(O=S.document.createElement("img"),O.onload=function(){V&&Z(V),V=null,H=!0},O.onerror=function(){j=!0,V=null},O.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const U="01";function $(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var J=le;function le(n,e,i,l){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=i,this.p2y=l}le.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(e===void 0&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,l=0;l<8;l++){var h=this.sampleCurveX(i)-n;if(Math.abs(h)<e)return i;var p=this.sampleCurveDerivativeX(i);if(Math.abs(p)<1e-6)break;i-=h/p}var g=0,x=1;for(i=n,l=0;l<20&&(h=this.sampleCurveX(i),!(Math.abs(h-n)<e));l++)n>h?g=i:x=i,i=.5*(x-g)+g;return i},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var pe=$(J),ye=Te;function Te(n,e){this.x=n,this.y=e}Te.prototype={clone:function(){return new Te(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),i=Math.sin(n),l=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=l,this},_rotateAround:function(n,e){var i=Math.cos(n),l=Math.sin(n),h=e.y+l*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-l*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Te.convert=function(n){return n instanceof Te?n:Array.isArray(n)?new Te(n[0],n[1]):n};var Se=$(ye);const Ae=Math.PI/180,Ne=180/Math.PI;function Ue(n){return n*Ae}function je(n){return n*Ne}const Ct=[[0,0],[1,0],[1,1],[0,1]];function zt(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function Ut(n,e,i,l){const h=new pe(n,e,i,l);return function(p){return h.solve(p)}}const sr=Ut(.25,.1,.25,1);function Ge(n,e,i){return Math.min(i,Math.max(e,n))}function St(n,e,i){return(i=Ge((i-n)/(e-n),0,1))*i*(3-2*i)}function ft(n,e,i){const l=i-e,h=((n-e)%l+l)%l+e;return h===e?i:h}function Ve(n,e,i){if(!n.length)return i(null,[]);let l=n.length;const h=new Array(n.length);let p=null;n.forEach((g,x)=>{e(g,(w,E)=>{w&&(p=w),h[x]=E,--l==0&&i(p,h)})})}function Je(n){const e=[];for(const i in n)e.push(n[i]);return e}function et(n,...e){for(const i of e)for(const l in i)n[l]=i[l];return n}let tt=1;function ir(){return tt++}function Zt(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function vr(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Xt(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function qn(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function cr(n,e){return n.indexOf(e,n.length-e.length)!==-1}function Ot(n,e,i){const l={};for(const h in n)l[h]=e.call(i||this,n[h],h,n);return l}function li(n,e,i){const l={};for(const h in n)e.call(i||this,n[h],h,n)&&(l[h]=n[h]);return l}function Br(n){return Array.isArray(n)?n.map(Br):typeof n=="object"&&n?Ot(n,Br):n}const tn={};function gr(n){tn[n]||(typeof console<"u"&&console.warn(n),tn[n]=!0)}function An(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Bo(n){let e=0;for(let i,l,h=0,p=n.length,g=p-1;h<p;g=h++)i=n[h],l=n[g],e+=(l.x-i.x)*(i.y+l.y);return e}function ei(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Fn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,l,h,p)=>{const g=h||p;return e[l]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Zi=null;function Tn(n){if(Zi==null){const e=n.navigator?n.navigator.userAgent:null;Zi=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Zi}function Cn(n){try{const e=S[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function On(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const Xi="mapbox-tiles";let Fs=500,Ki=50,In,mo;function fs(){try{return S.caches}catch{}}function go(){fs()&&!In&&(In=S.caches.open(Xi))}function Si(n){const e=n.indexOf("?");if(e<0)return n;const i=function(h){const p=h.indexOf("?");return p>0?h.slice(p+1).split("&"):[]}(n),l=i.filter(h=>{const p=h.split("=");return p[0]==="language"||p[0]==="worldview"});return l.length?`${n.slice(0,e)}?${l.join("&")}`:n.slice(0,e)}let Yi=1/0;const Lo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Lo);class Ji extends Error{constructor(e,i,l){i===401&&Pe(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const _o=ei()?()=>self.worker&&self.worker.referrer:()=>(S.location.protocol==="blob:"?S.parent:S).location.href,Fo=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(_o())&&!/^\w+:/.test(i))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return function(l,h){const p=new S.AbortController,g=new S.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:_o(),referrerPolicy:l.referrerPolicy,signal:p.signal});let x=!1,w=!1;const E=(I=g.url).indexOf("sku=")>0&&Pe(I);var I;l.type==="json"&&g.headers.set("Accept","application/json");const z=(F,N,G)=>{if(w)return;if(F&&F.message!=="SecurityError"&&gr(F.toString()),N&&G)return D(N);const Q=Date.now();S.fetch(g).then(oe=>{if(oe.ok){const fe=E?oe.clone():null;return D(oe,fe,Q)}return h(new Ji(oe.statusText,oe.status,l.url))}).catch(oe=>{oe.name!=="AbortError"&&h(new Error(`${oe.message} ${l.url}`))})},D=(F,N,G)=>{(l.type==="arrayBuffer"?F.arrayBuffer():l.type==="json"?F.json():F.text()).then(Q=>{w||(N&&G&&function(oe,fe,se){if(go(),!In)return;const he={status:fe.status,statusText:fe.statusText,headers:new S.Headers};fe.headers.forEach((Be,De)=>he.headers.set(De,Be));const ge=Fn(fe.headers.get("Cache-Control")||"");if(ge["no-store"])return;ge["max-age"]&&he.headers.set("Expires",new Date(se+1e3*ge["max-age"]).toUTCString());const me=he.headers.get("Expires");me&&(new Date(me).getTime()-se<42e4||function(Be,De){if(mo===void 0)try{new Response(new ReadableStream),mo=!0}catch{mo=!1}mo?De(Be.body):Be.blob().then(De)}(fe,Be=>{const De=new S.Response(Be,he);go(),In&&In.then(qe=>qe.put(Si(oe.url),De)).catch(qe=>gr(qe.message))}))}(g,N,G),x=!0,h(null,Q,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(Q=>{w||h(new Error(Q.message))})};return E?function(F,N){if(go(),!In)return N(null);const G=Si(F.url);In.then(Q=>{Q.match(G).then(oe=>{const fe=function(se){if(!se)return!1;const he=new Date(se.headers.get("Expires")||0),ge=Fn(se.headers.get("Cache-Control")||"");return he>Date.now()&&!ge["no-cache"]}(oe);Q.delete(G),fe&&Q.put(G,oe.clone()),N(null,oe,fe)}).catch(N)}).catch(N)}(g,z):z(null,null),{cancel:()=>{w=!0,x||p.abort()}}}(n,e);if(ei()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(l,h){const p=new S.XMLHttpRequest;p.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const g in l.headers)p.setRequestHeader(g,l.headers[g]);return l.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=l.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let g=p.response;if(l.type==="json")try{g=JSON.parse(p.response)}catch(x){return h(x)}h(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new Ji(p.statusText,p.status,l.url))},p.send(l.body),{cancel:()=>p.abort()}}(n,e)},ms=function(n,e){return Fo(et(n,{type:"arrayBuffer"}),e)};function Os(n){const e=S.document.createElement("a");return e.href=n,e.protocol===S.document.location.protocol&&e.host===S.document.location.host}const de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let X,K;X=[],K=0;const ue=function(n,e){if(L.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),K>=M.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return X.push(p),p}K++;let i=!1;const l=()=>{if(!i)for(i=!0,K--;X.length&&K<M.MAX_PARALLEL_IMAGE_REQUESTS;){const p=X.shift(),{requestParameters:g,callback:x,cancelled:w}=p;w||(p.cancel=ue(g,x).cancel)}},h=ms(n,(p,g,x,w)=>{l(),p?e(p):g&&(S.createImageBitmap?function(E,I){const z=new S.Blob([new Uint8Array(E)],{type:"image/png"});S.createImageBitmap(z).then(D=>{I(null,D)}).catch(D=>{I(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(E,I)=>e(E,I,x,w)):function(E,I){const z=new S.Image,D=S.URL;z.onload=()=>{I(null,z),D.revokeObjectURL(z.src),z.onload=null,S.requestAnimationFrame(()=>{z.src=de})},z.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new S.Blob([new Uint8Array(E)],{type:"image/png"});z.src=E.byteLength?D.createObjectURL(F):de}(g,(E,I)=>e(E,I,x,w)))});return{cancel:()=>{h.cancel(),l()}}},_e="NO_ACCESS_TOKEN";function Ee(n){return n.indexOf("mapbox:")===0}function Pe(n){return M.API_URL_REGEX.test(n)}function ke(n){return M.API_CDN_URL_REGEX.test(n)}function we(n){return M.API_STYLE_REGEX.test(n)&&!Le(n)}function Le(n){return M.API_SPRITE_REGEX.test(n)}const ct=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function dt(n){const e=n.match(ct);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function st(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}const Rt="mapbox.eventData";function Ft(n){if(!n)return null;const e=n.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Vt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Ft(M.ACCESS_TOKEN);let l="";return l=i&&i.u?S.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(+("0x"+p)))):M.ACCESS_TOKEN||"",e?`${Rt}.${e}:${l}`:`${Rt}:${l}`}fetchEventData(){const e=Cn("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{const h=S.localStorage.getItem(i);h&&(this.eventData=JSON.parse(h));const p=S.localStorage.getItem(l);p&&(this.anonId=p)}catch{gr("Unable to read from LocalStorage")}}saveEventData(){const e=Cn("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{S.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{gr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,l,h){if(!M.EVENTS_URL)return;const p=dt(M.EVENTS_URL);p.params.push(`access_token=${h||M.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString()},x=i?et(g,i):g,w={url:st(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=function(E,I){return Fo(et(E,{method:"POST"}),I)}(w,E=>{this.pendingRequest=null,l(E),this.saveEventData(),this.processRequests(h)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Kt=new class extends Vt{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){M.EVENTS_URL&&M.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>Ee(i)||Pe(i))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ft(M.ACCESS_TOKEN),i=e?e.u:M.ACCESS_TOKEN;let l=i!==this.eventData.tokenU;Xt(this.anonId)||(this.anonId=Zt(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),g=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;l=l||x>=1||x<-1||p.getDate()!==g.getDate()}else l=!0;l?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:U,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=i)},n):this.processRequests()}},rr=Kt.postTurnstileEvent.bind(Kt),Wr=new class extends Vt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,i,l){this.skuToken=e,this.errorCb=l,M.EVENTS_URL&&(i||M.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(_e)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Xt(this.anonId)||(this.anonId=Zt()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:U,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},n))}},sn=Wr.postMapLoadEvent.bind(Wr),Gn=new class extends Vt{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){M.EVENTS_URL&&(n||M.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),l=function(h){const p=S.performance.getEntriesByType("resource"),g=S.performance.getEntriesByType("mark"),x=function(D){const F={};if(D){for(const N in D)if(N!=="other")for(const G of D[N]){const Q=`${N}ResolveRangeMin`,oe=`${N}ResolveRangeMax`,fe=`${N}RequestCount`,se=`${N}RequestCachedCount`;F[Q]=Math.min(F[Q]||1/0,G.startTime),F[oe]=Math.max(F[oe]||-1/0,G.responseEnd);const he=ge=>{F[ge]===void 0&&(F[ge]=0),++F[ge]};G.transferSize!==void 0&&G.transferSize===0&&he(se),he(fe)}}return F}(function(D,F){const N={};if(D)for(const G of D){const Q=F(G);N[Q]===void 0&&(N[Q]=[]),N[Q].push(G)}return N}(p,tf)),w=S.devicePixelRatio,E=S.navigator.connection||S.navigator.mozConnection||S.navigator.webkitConnection,I={counters:[],metadata:[],attributes:[]},z=(D,F,N)=>{N!=null&&D.push({name:F,value:N.toString()})};for(const D in x)z(I.counters,D,x[D]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(z(I.counters,"interactionRangeMin",h.interactionRange[0]),z(I.counters,"interactionRangeMax",h.interactionRange[1])),g)for(const D of Object.keys(ga)){const F=ga[D],N=g.find(G=>G.name===F);N&&z(I.counters,F,N.startTime)}return z(I.counters,"visibilityHidden",h.visibilityHidden),z(I.attributes,"style",function(D){if(D)for(const F of D){const N=F.name.split("?")[0];if(we(N)){const G=N.split("/").slice(-2);if(G.length===2)return`mapbox://styles/${G[0]}/${G[1]}`}}}(p)),z(I.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),z(I.attributes,"fogEnabled",h.fogEnabled?"true":"false"),z(I.attributes,"projection",h.projection),z(I.attributes,"zoom",h.zoom),z(I.metadata,"devicePixelRatio",w),z(I.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),z(I.metadata,"navigatorUserAgent",S.navigator.userAgent),z(I.metadata,"screenWidth",S.screen.width),z(I.metadata,"screenHeight",S.screen.height),z(I.metadata,"windowWidth",S.innerWidth),z(I.metadata,"windowHeight",S.innerHeight),z(I.metadata,"mapWidth",h.width/w),z(I.metadata,"mapHeight",h.height/w),z(I.metadata,"webglRenderer",h.renderer),z(I.metadata,"webglVendor",h.vendor),z(I.metadata,"sdkVersion",C),z(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(i);for(const h of l.metadata);for(const h of l.counters);for(const h of l.attributes);this.postEvent(e,l,()=>{},n)}},xn=Gn.postPerformanceEvent.bind(Gn),yo=new class extends Vt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,i,l){if(!M.API_URL||!M.SESSION_PATH)return;const h=dt(M.API_URL+M.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${l||M.ACCESS_TOKEN||""}`);const p={url:st(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(g,x){return Fo(et(g,{method:"GET"}),x)}(p,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(l)})}getSessionAPI(n,e,i,l){this.skuToken=e,this.errorCb=l,M.SESSION_PATH&&M.API_URL&&(i||M.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(_e)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},n)}},kn=yo.getSessionAPI.bind(yo),ti=new Set,ga={create:"create",load:"load",fullLoad:"fullLoad"},Kg={mark(n){S.performance.mark(n)},measure(n,e,i){S.performance.measure(n,e,i)}};function tf(n){const e=n.name.split("?")[0];return ke(e)&&e.includes("mapbox-gl.js")?"javascript":ke(e)&&e.includes("mapbox-gl.css")?"css":function(i){return M.API_FONTS_REGEX.test(i)}(e)?"fontRange":Le(e)?"sprite":we(e)?"style":function(i){return M.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const fr=S.performance;function yh(n){const e=n?n.url.toString():void 0;return fr.getEntriesByName(e)}let bl,xh,zc,xo;const Oo={now:()=>zc!==void 0?zc:S.performance.now(),setNow(n){zc=n},restoreNow(){zc=void 0},frame(n){const e=S.requestAnimationFrame(n);return{cancel:()=>S.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:l}=n;xo||(xo=S.document.createElement("canvas"));const h=xo.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>xo.width||l>xo.height)&&(xo.width=i,xo.height=l),h.clearRect(-e,-e,i+2*e,l+2*e),h.drawImage(n,0,0,i,l),h.getImageData(-e,-e,i+2*e,l+2*e)},resolveURL:n=>(bl||(bl=S.document.createElement("a")),bl.href=n,bl.href),get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&(xh==null&&(xh=S.matchMedia("(prefers-reduced-motion: reduce)")),xh.matches)}};function vh(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function bh(n,e,i){if(i&&i[n]){const l=i[n].indexOf(e);l!==-1&&i[n].splice(l,1)}}class Ns{constructor(e,i={}){et(this,i),this.type=e}}class No extends Ns{constructor(e,i={}){super("error",et({error:e},i))}}class wl{on(e,i){return this._listeners=this._listeners||{},vh(e,i,this._listeners),this}off(e,i){return bh(e,i,this._listeners),bh(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},vh(e,i,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,i){typeof e=="string"&&(e=new Ns(e,i||{}));const l=e.type;if(this.listens(l)){e.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of h)x.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of p)bh(l,x,this._oneTimeListeners),x.call(this,e);const g=this._eventedParent;g&&(et(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof No&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var We=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Uo(n,...e){for(const i of e)for(const l in i)n[l]=i[l];return n}function an(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Pn(n){if(Array.isArray(n))return n.map(Pn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Pn(n[i]);return e}return an(n)}class rf extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var vo=rf;class wh{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[l,h]of i)this.bindings[l]=h}concat(e){return new wh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var nf=wh;const _a={kind:"null"},xt={kind:"number"},tr={kind:"string"},Jt={kind:"boolean"},Ai={kind:"color"},Qi={kind:"object"},Qt={kind:"value"},Ti={kind:"collator"},El={kind:"formatted"},Us={kind:"resolvedImage"};function Di(n,e){return{kind:"array",itemType:n,N:e}}function Nr(n){if(n.kind==="array"){const e=Nr(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const of=[_a,xt,tr,Jt,Ai,El,Qi,Di(Qt),Us];function Vo(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Vo(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of of)if(!Vo(i,e))return null}}return`Expected ${Nr(n)} but found ${Nr(e)} instead.`}function Sl(n,e){return e.some(i=>i.kind===n.kind)}function Al(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}var Eh,sf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Tl(n){return(n=Math.round(n))<0?0:n>255?255:n}function Cl(n){return Tl(n[n.length-1]==="%"?parseFloat(n)/100*255:parseInt(n))}function Dc(n){return(e=n[n.length-1]==="%"?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function ya(n,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?n+(e-n)*i*6:2*i<1?e:3*i<2?n+(e-n)*(2/3-i)*6:n}try{Eh={}.parseCSSColor=function(n){var e,i=n.replace(/ /g,"").toLowerCase();if(i in sf)return sf[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=i.indexOf("("),h=i.indexOf(")");if(l!==-1&&h+1===i.length){var p=i.substr(0,l),g=i.substr(l+1,h-(l+1)).split(","),x=1;switch(p){case"rgba":if(g.length!==4)return null;x=Dc(g.pop());case"rgb":return g.length!==3?null:[Cl(g[0]),Cl(g[1]),Cl(g[2]),x];case"hsla":if(g.length!==4)return null;x=Dc(g.pop());case"hsl":if(g.length!==3)return null;var w=(parseFloat(g[0])%360+360)%360/360,E=Dc(g[1]),I=Dc(g[2]),z=I<=.5?I*(E+1):I+E-I*E,D=2*I-z;return[Tl(255*ya(D,z,w+1/3)),Tl(255*ya(D,z,w)),Tl(255*ya(D,z,w-1/3)),x];default:return null}}return null}}catch{}class ci{constructor(e,i,l,h=1){this.r=e,this.g=i,this.b=l,this.a=h}static parse(e){if(!e)return;if(e instanceof ci)return e;if(typeof e!="string")return;const i=Eh(e);return i?new ci(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,l,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(l)},${h})`}toArray(){const{r:e,g:i,b:l,a:h}=this;return h===0?[0,0,0,0]:[255*e/h,255*i/h,255*l/h,h]}toArray01(){const{r:e,g:i,b:l,a:h}=this;return h===0?[0,0,0,0]:[e/h,i/h,l/h,h]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:l,a:h}=this;return[e,i,l,h]}}ci.black=new ci(0,0,0,1),ci.white=new ci(1,1,1,1),ci.transparent=new ci(0,0,0,0),ci.red=new ci(1,0,0,1),ci.blue=new ci(0,0,1,1);var rn=ci;class Sh{constructor(e,i,l){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ah{constructor(e,i,l,h,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=l,this.fontStack=h,this.textColor=p}}class ui{constructor(e){this.sections=e}static fromString(e){return new ui([new Ah(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ui?e:ui.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(l)}return e}}class Mi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Mi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function af(n,e,i,l){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[n,e,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[n,e,i,l]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Il(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof rn||n instanceof Sh||n instanceof ui||n instanceof Mi)return!0;if(Array.isArray(n)){for(const e of n)if(!Il(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Il(n[e]))return!1;return!0}return!1}function Yr(n){if(n===null)return _a;if(typeof n=="string")return tr;if(typeof n=="boolean")return Jt;if(typeof n=="number")return xt;if(n instanceof rn)return Ai;if(n instanceof Sh)return Ti;if(n instanceof ui)return El;if(n instanceof Mi)return Us;if(Array.isArray(n)){const e=n.length;let i;for(const l of n){const h=Yr(l);if(i){if(i===h)continue;i=Qt;break}i=h}return Di(i||Qt,e)}return Qi}function kl(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof rn||n instanceof ui||n instanceof Mi?n.toString():JSON.stringify(n)}class Th{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Il(e[1]))return i.error("invalid value");const l=e[1];let h=Yr(l);const p=i.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Th(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof rn?["rgba"].concat(this.value.toArray()):this.value instanceof ui?this.value.serialize():this.value}}var Vs=Th,Nn=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const Ch={string:tr,number:xt,boolean:Jt,object:Qi};class Ih{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let l,h=1;const p=e[0];if(p==="array"){let x,w;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in Ch)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=Ch[E],h++}else x=Qt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],h++}l=Di(x,w)}else l=Ch[p];const g=[];for(;h<e.length;h++){const x=i.parse(e[h],h,Qt);if(!x)return null;g.push(x)}return new Ih(l,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(e);if(!Vo(this.type,Yr(l)))return l;if(i===this.args.length-1)throw new Nn(`Expected value to be of type ${Nr(this.type)}, but found ${Nr(Yr(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(l=>l.serialize()))}}var jo=Ih;class gs{constructor(e){this.type=El,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const h=[];let p=!1;for(let g=1;g<=e.length-1;++g){const x=e[g];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let w=null;if(x["font-scale"]&&(w=i.parse(x["font-scale"],1,xt),!w))return null;let E=null;if(x["text-font"]&&(E=i.parse(x["text-font"],1,Di(tr)),!E))return null;let I=null;if(x["text-color"]&&(I=i.parse(x["text-color"],1,Ai),!I))return null;const z=h[h.length-1];z.scale=w,z.font=E,z.textColor=I}else{const w=i.parse(e[g],1,Qt);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new gs(h)}evaluate(e){return new ui(this.sections.map(i=>{const l=i.content.evaluate(e);return Yr(l)===Us?new Ah("",l,null,null,null):new Ah(kl(l),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),e.push(l)}return e}}class Mc{constructor(e){this.type=Us,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const l=i.parse(e[1],1,tr);return l?new Mc(l):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),l=Mi.fromString(i);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(i)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Yg={"to-boolean":Jt,"to-color":Ai,"to-number":xt,"to-string":tr};class kh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[0];if((l==="to-boolean"||l==="to-string")&&e.length!==2)return i.error("Expected one argument.");const h=Yg[l],p=[];for(let g=1;g<e.length;g++){const x=i.parse(e[g],g,Qt);if(!x)return null;p.push(x)}return new kh(h,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,l;for(const h of this.args){if(i=h.evaluate(e),l=null,i instanceof rn)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:af(i[0],i[1],i[2],i[3]),!l))return new rn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Nn(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Nn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ui.fromString(kl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Mi.fromString(kl(this.args[0].evaluate(e))):kl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new gs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Mc(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var xa=kh;const bo=["Unknown","Point","LineString","Polygon"];var Ph=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-n[0])+this.featureDistanceData.bearing[1]*(l*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=rn.parse(n)),e}};class js{constructor(e,i,l,h){this.name=e,this.type=i,this._evaluate=l,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const l=e[0],h=js.definitions[l];if(!h)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=g.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let w=null;for(const[E,I]of x){w=new Lh(i.registry,i.path,null,i.scope);const z=[];let D=!1;for(let F=1;F<e.length;F++){const N=e[F],G=Array.isArray(E)?E[F-1]:E.type,Q=w.parse(N,1+z.length,G);if(!Q){D=!0;break}z.push(Q)}if(!D)if(Array.isArray(E)&&E.length!==z.length)w.error(`Expected ${E.length} arguments, but found ${z.length} instead.`);else{for(let F=0;F<z.length;F++){const N=Array.isArray(E)?E[F]:E.type,G=z[F];w.concat(F+1).checkSubtype(N,G.type)}if(w.errors.length===0)return new js(l,p,I,z)}}if(x.length===1)i.errors.push(...w.errors);else{const E=(x.length?x:g).map(([z])=>{return D=z,Array.isArray(D)?`(${D.map(Nr).join(", ")})`:`(${Nr(D.type)}...)`;var D}).join(" | "),I=[];for(let z=1;z<e.length;z++){const D=i.parse(e[z],1+I.length);if(!D)return null;I.push(Nr(D.type))}i.error(`Expected arguments of type ${E}, but found (${I.join(", ")}) instead.`)}return null}static register(e,i){js.definitions=i;for(const l in i)e[l]=js}}var $o=js;class Pl{constructor(e,i,l){this.type=Ti,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const h=i.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Jt);if(!h)return null;const p=i.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Jt);if(!p)return null;let g=null;return l.locale&&(g=i.parse(l.locale,1,tr),!g)?null:new Pl(h,p,g)}evaluate(e){return new Sh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Wo=8192;function Rc(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function va(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function zl(n,e){const i=(180+n[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*Wo),Math.round(l*h*Wo)]}function lf(n,e,i){const l=n[0]-e[0],h=n[1]-e[1],p=n[0]-i[0],g=n[1]-i[1];return l*g-p*h==0&&l*p<=0&&h*g<=0}function Bc(n,e){let i=!1;for(let g=0,x=e.length;g<x;g++){const w=e[g];for(let E=0,I=w.length;E<I-1;E++){if(lf(n,w[E],w[E+1]))return!1;(h=w[E])[1]>(l=n)[1]!=(p=w[E+1])[1]>l[1]&&l[0]<(p[0]-h[0])*(l[1]-h[1])/(p[1]-h[1])+h[0]&&(i=!i)}}var l,h,p;return i}function zh(n,e){for(let i=0;i<e.length;i++)if(Bc(n,e[i]))return!0;return!1}function Dh(n,e,i,l){const h=l[0]-i[0],p=l[1]-i[1],g=(n[0]-i[0])*p-h*(n[1]-i[1]),x=(e[0]-i[0])*p-h*(e[1]-i[1]);return g>0&&x<0||g<0&&x>0}function ba(n,e,i){for(const E of i)for(let I=0;I<E.length-1;++I)if((x=[(g=E[I+1])[0]-(p=E[I])[0],g[1]-p[1]])[0]*(w=[(h=e)[0]-(l=n)[0],h[1]-l[1]])[1]-x[1]*w[0]!=0&&Dh(l,h,p,g)&&Dh(p,g,l,h))return!0;var l,h,p,g,x,w;return!1}function mr(n,e){for(let i=0;i<n.length;++i)if(!Bc(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(ba(n[i],n[i+1],e))return!1;return!0}function Jg(n,e){for(let i=0;i<e.length;i++)if(mr(n,e[i]))return!0;return!1}function Mh(n,e,i){const l=[];for(let h=0;h<n.length;h++){const p=[];for(let g=0;g<n[h].length;g++){const x=zl(n[h][g],i);Rc(e,x),p.push(x)}l.push(p)}return l}function cf(n,e,i){const l=[];for(let h=0;h<n.length;h++){const p=Mh(n[h],e,i);l.push(p)}return l}function Rh(n,e,i,l){if(n[0]<i[0]||n[0]>i[2]){const h=.5*l;let p=n[0]-i[0]>h?-l:i[0]-n[0]>h?l:0;p===0&&(p=n[0]-i[2]>h?-l:i[2]-n[0]>h?l:0),n[0]+=p}Rc(e,n)}function uf(n,e,i,l){const h=Math.pow(2,l.z)*Wo,p=[l.x*Wo,l.y*Wo],g=[];if(!n)return g;for(const x of n)for(const w of x){const E=[w.x+p[0],w.y+p[1]];Rh(E,e,i,h),g.push(E)}return g}function Bh(n,e,i,l){const h=Math.pow(2,l.z)*Wo,p=[l.x*Wo,l.y*Wo],g=[];if(!n)return g;for(const w of n){const E=[];for(const I of w){const z=[I.x+p[0],I.y+p[1]];Rc(e,z),E.push(z)}g.push(E)}if(e[2]-e[0]<=h/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of g)for(const E of w)Rh(E,e,i,h)}var x;return g}class wa{constructor(e,i){this.type=Jt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Il(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let h=0;h<l.features.length;++h){const p=l.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new wa(l,l.features[h].geometry)}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new wa(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new wa(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const x=Mh(l.coordinates,p,g),w=uf(i.geometry(),h,p,g);if(!va(h,p))return!1;for(const E of w)if(!Bc(E,x))return!1}if(l.type==="MultiPolygon"){const x=cf(l.coordinates,p,g),w=uf(i.geometry(),h,p,g);if(!va(h,p))return!1;for(const E of w)if(!zh(E,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const x=Mh(l.coordinates,p,g),w=Bh(i.geometry(),h,p,g);if(!va(h,p))return!1;for(const E of w)if(!mr(E,x))return!1}if(l.type==="MultiPolygon"){const x=cf(l.coordinates,p,g),w=Bh(i.geometry(),h,p,g);if(!va(h,p))return!1;for(const E of w)if(!Jg(E,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Lc=wa;function Ea(n){if(n instanceof $o&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Lc)return!1;let e=!0;return n.eachChild(i=>{e&&!Ea(i)&&(e=!1)}),e}function qo(n){if(n instanceof $o&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!qo(i)&&(e=!1)}),e}function $s(n,e){if(n instanceof $o&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(l=>{i&&!$s(l,e)&&(i=!1)}),i}class Fc{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=e[1];return i.scope.has(l)?new Fc(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var hf=Fc;class Dl{constructor(e,i=[],l,h=new nf,p=[]){this.registry=e,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=h,this.errors=p,this.expectedType=l}parse(e,i,l,h,p={}){return i?this.concat(i,l,h)._parse(e,p):this._parse(e,p)}_parse(e,i){function l(h,p,g){return g==="assert"?new jo(p,[h]):g==="coerce"?new xa(p,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[h];if(p){let g=p.parse(e,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,w=g.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||w.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(x,w))return null}else g=l(g,x,i.typeAnnotation||"coerce");else g=l(g,x,i.typeAnnotation||"assert")}if(!(g instanceof Vs)&&g.type.kind!=="resolvedImage"&&Fh(g)){const x=new Ph;try{g=new Vs(g.type,g.evaluate(x))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,l){const h=typeof e=="number"?this.path.concat(e):this.path,p=l?this.scope.concat(l):this.scope;return new Dl(this.registry,h,i||null,p,this.errors)}error(e,...i){const l=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new vo(l,e))}checkSubtype(e,i){const l=Vo(e,i);return l&&this.error(l),l}}var Lh=Dl;function Fh(n){if(n instanceof hf)return Fh(n.boundExpression);if(n instanceof $o&&n.name==="error"||n instanceof Pl||n instanceof Lc)return!1;const e=n instanceof xa||n instanceof jo;let i=!0;return n.eachChild(l=>{i=e?i&&Fh(l):i&&l instanceof Vs}),!!i&&Ea(n)&&$s(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Oc(n,e){const i=n.length-1;let l,h,p=0,g=i,x=0;for(;p<=g;)if(x=Math.floor((p+g)/2),l=n[x],h=n[x+1],l<=e){if(x===i||e<h)return x;p=x+1}else{if(!(l>e))throw new Nn("Input is not a number.");g=x-1}return 0}class Nc{constructor(e,i,l){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,p]of l)this.labels.push(h),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(e[1],1,xt);if(!l)return null;const h=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let g=1;g<e.length;g+=2){const x=g===1?-1/0:e[g],w=e[g+1],E=g,I=g+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const z=i.parse(w,I,p);if(!z)return null;p=p||z.type,h.push([x,z])}return new Nc(p,l,h)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return l[0].evaluate(e);const p=i.length;return h>=i[p-1]?l[p-1].evaluate(e):l[Oc(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Oh=Nc;function or(n,e,i){return n*(1-i)+e*i}var Ml=Object.freeze({__proto__:null,array:function(n,e,i){return n.map((l,h)=>or(l,e[h],i))},color:function(n,e,i){return new rn(or(n.r,e.r,i),or(n.g,e.g,i),or(n.b,e.b,i),or(n.a,e.a,i))},number:or});const df=.95047,Nh=1.08883,pf=4/29,Ws=6/29,Uh=3*Ws*Ws,Qg=Ws*Ws*Ws,e_=Math.PI/180,t_=180/Math.PI;function Vh(n){return n>Qg?Math.pow(n,1/3):n/Uh+pf}function jh(n){return n>Ws?n*n*n:Uh*(n-pf)}function $h(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Uc(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function ff(n){const e=Uc(n.r),i=Uc(n.g),l=Uc(n.b),h=Vh((.4124564*e+.3575761*i+.1804375*l)/df),p=Vh((.2126729*e+.7151522*i+.072175*l)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Vh((.0193339*e+.119192*i+.9503041*l)/Nh)),alpha:n.a}}function mf(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,l=isNaN(n.b)?e:e-n.b/200;return e=1*jh(e),i=df*jh(i),l=Nh*jh(l),new rn($h(3.2404542*i-1.5371385*e-.4985314*l),$h(-.969266*i+1.8760108*e+.041556*l),$h(.0556434*i-.2040259*e+1.0572252*l),n.alpha)}function r_(n,e,i){const l=e-n;return n+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const Rl={forward:ff,reverse:mf,interpolate:function(n,e,i){return{l:or(n.l,e.l,i),a:or(n.a,e.a,i),b:or(n.b,e.b,i),alpha:or(n.alpha,e.alpha,i)}}},Sa={forward:function(n){const{l:e,a:i,b:l}=ff(n),h=Math.atan2(l,i)*t_;return{h:h<0?h+360:h,c:Math.sqrt(i*i+l*l),l:e,alpha:n.a}},reverse:function(n){const e=n.h*e_,i=n.c;return mf({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:r_(n.h,e.h,i),c:or(n.c,e.c,i),l:or(n.l,e.l,i),alpha:or(n.alpha,e.alpha,i)}}};var Wh=Object.freeze({__proto__:null,hcl:Sa,lab:Rl});class Bl{constructor(e,i,l,h,p){this.type=e,this.operator=i,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[g,x]of p)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(e,i,l,h){let p=0;if(e.name==="exponential")p=qh(i,e.base,l,h);else if(e.name==="linear")p=qh(i,1,l,h);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new pe(g[0],g[1],g[2],g[3]).solve(qh(i,1,l,h))}return p}static parse(e,i){let[l,h,p,...g]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(I=>typeof I!="number"||I<0||I>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,xt),!p)return null;const x=[];let w=null;l==="interpolate-hcl"||l==="interpolate-lab"?w=Ai:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let E=0;E<g.length;E+=2){const I=g[E],z=g[E+1],D=E+3,F=E+4;if(typeof I!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(x.length&&x[x.length-1][0]>=I)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const N=i.parse(z,F,w);if(!N)return null;w=w||N.type,x.push([I,N])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new Bl(w,l,h,p,x):i.error(`Type ${Nr(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return l[0].evaluate(e);const p=i.length;if(h>=i[p-1])return l[p-1].evaluate(e);const g=Oc(i,h),x=Bl.interpolationFactor(this.interpolation,h,i[g],i[g+1]),w=l[g].evaluate(e),E=l[g+1].evaluate(e);return this.operator==="interpolate"?Ml[this.type.kind.toLowerCase()](w,E,x):this.operator==="interpolate-hcl"?Sa.reverse(Sa.interpolate(Sa.forward(w),Sa.forward(E),x)):Rl.reverse(Rl.interpolate(Rl.forward(w),Rl.forward(E),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function qh(n,e,i,l){const h=l-i,p=n-i;return h===0?0:e===1?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}var wo=Bl;class Vc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let l=null;const h=i.expectedType;h&&h.kind!=="value"&&(l=h);const p=[];for(const x of e.slice(1)){const w=i.parse(x,1+p.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,p.push(w)}const g=h&&p.some(x=>Vo(h,x.type));return new Vc(g?Qt:l,p)}evaluate(e){let i,l=null,h=0;for(const p of this.args){if(h++,l=p.evaluate(e),l&&l instanceof Mi&&!l.available&&(i||(i=l),l=null,h===this.args.length))return i;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Gh=Vc;class jc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=i.parse(e[p+1],p+1);if(!x)return null;l.push([g,x])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,l);return h?new jc(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,l]of this.bindings)e.push(i,l.serialize());return e.push(this.result.serialize()),e}}var gf=jc;class Hh{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,xt),h=i.parse(e[2],2,Di(i.expectedType||Qt));return l&&h?new Hh(h.type.itemType,l,h):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new Nn(`Array index out of bounds: ${i} < 0.`);if(i>=l.length)throw new Nn(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i!==Math.floor(i))throw new Nn(`Array index must be an integer, but found ${i} instead.`);return l[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var n_=Hh;class Zh{constructor(e,i){this.type=Jt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Qt),h=i.parse(e[2],2,Qt);return l&&h?Sl(l.type,[Jt,tr,xt,_a,Qt])?new Zh(l,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(l.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Al(i,["boolean","string","number","null"]))throw new Nn(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(Yr(i))} instead.`);if(!Al(l,["string","array"]))throw new Nn(`Expected second argument to be of type array or string, but found ${Nr(Yr(l))} instead.`);return l.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var $c=Zh;class Ll{constructor(e,i,l){this.type=xt,this.needle=e,this.haystack=i,this.fromIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Qt),h=i.parse(e[2],2,Qt);if(!l||!h)return null;if(!Sl(l.type,[Jt,tr,xt,_a,Qt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(l.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,xt);return p?new Ll(l,h,p):null}return new Ll(l,h)}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Al(i,["boolean","string","number","null"]))throw new Nn(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(Yr(i))} instead.`);if(!Al(l,["string","array"]))throw new Nn(`Expected second argument to be of type array or string, but found ${Nr(Yr(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return l.indexOf(i,h)}return l.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var _f=Ll;class Xh{constructor(e,i,l,h,p,g){this.inputType=e,this.type=i,this.input=l,this.cases=h,this.outputs=p,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let l,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const p={},g=[];for(let E=2;E<e.length-1;E+=2){let I=e[E];const z=e[E+1];Array.isArray(I)||(I=[I]);const D=i.concat(E);if(I.length===0)return D.error("Expected at least one branch label.");for(const N of I){if(typeof N!="number"&&typeof N!="string")return D.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return D.error("Numeric branch labels must be integer values.");if(l){if(D.checkSubtype(l,Yr(N)))return null}else l=Yr(N);if(p[String(N)]!==void 0)return D.error("Branch labels must be unique.");p[String(N)]=g.length}const F=i.parse(z,E,h);if(!F)return null;h=h||F.type,g.push(F)}const x=i.parse(e[1],1,Qt);if(!x)return null;const w=i.parse(e[e.length-1],e.length-1,h);return w?x.type.kind!=="value"&&i.concat(1).checkSubtype(l,x.type)?null:new Xh(l,h,x,p,g,w):null}evaluate(e){const i=this.input.evaluate(e);return(Yr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],h={};for(const g of i){const x=h[this.cases[g]];x===void 0?(h[this.cases[g]]=l.length,l.push([this.cases[g],[g]])):l[x][1].push(g)}const p=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,x]of l)e.push(x.length===1?p(x[0]):x.map(p)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}var i_=Xh;class Kh{constructor(e,i,l){this.type=e,this.branches=i,this.otherwise=l}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const h=[];for(let g=1;g<e.length-1;g+=2){const x=i.parse(e[g],g,Jt);if(!x)return null;const w=i.parse(e[g+1],g+1,l);if(!w)return null;h.push([x,w]),l=l||w.type}const p=i.parse(e[e.length-1],e.length-1,l);return p?new Kh(l,h,p):null}evaluate(e){for(const[i,l]of this.branches)if(i.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,l]of this.branches)e(i),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var yf=Kh;class Fl{constructor(e,i,l,h){this.type=e,this.input=i,this.beginIndex=l,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Qt),h=i.parse(e[2],2,xt);if(!l||!h)return null;if(!Sl(l.type,[Di(Qt),tr,Qt]))return i.error(`Expected first argument to be of type array or string, but found ${Nr(l.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,xt);return p?new Fl(l.type,l,h,p):null}return new Fl(l.type,l,h)}evaluate(e){const i=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Al(i,["string","array"]))throw new Nn(`Expected first argument to be of type array or string, but found ${Nr(Yr(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(l,h)}return i.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var xf=Fl;function Wc(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function vf(n,e,i,l){return l.compare(e,i)===0}function Aa(n,e,i){const l=n!=="=="&&n!=="!=";return class iz{constructor(p,g,x){this.type=Jt,this.lhs=p,this.rhs=g,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const x=p[0];let w=g.parse(p[1],1,Qt);if(!w)return null;if(!Wc(x,w.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${Nr(w.type)}'.`);let E=g.parse(p[2],2,Qt);if(!E)return null;if(!Wc(x,E.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${Nr(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${Nr(w.type)}' and '${Nr(E.type)}'.`);l&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new jo(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new jo(w.type,[E])));let I=null;if(p.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(I=g.parse(p[3],3,Ti),!I)return null}return new iz(w,E,I)}evaluate(p){const g=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(l&&this.hasUntypedArgument){const w=Yr(g),E=Yr(x);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new Nn(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=Yr(g),E=Yr(x);if(w.kind!=="string"||E.kind!=="string")return e(p,g,x)}return this.collator?i(p,g,x,this.collator.evaluate(p)):e(p,g,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[n];return this.eachChild(g=>{p.push(g.serialize())}),p}}}const o_=Aa("==",function(n,e,i){return e===i},vf),s_=Aa("!=",function(n,e,i){return e!==i},function(n,e,i,l){return!vf(0,e,i,l)}),a_=Aa("<",function(n,e,i){return e<i},function(n,e,i,l){return l.compare(e,i)<0}),l_=Aa(">",function(n,e,i){return e>i},function(n,e,i,l){return l.compare(e,i)>0}),c_=Aa("<=",function(n,e,i){return e<=i},function(n,e,i,l){return l.compare(e,i)<=0}),bf=Aa(">=",function(n,e,i){return e>=i},function(n,e,i,l){return l.compare(e,i)>=0});class qc{constructor(e,i,l,h,p,g){this.type=tr,this.number=e,this.locale=i,this.currency=l,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const l=i.parse(e[1],1,xt);if(!l)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=i.parse(h.locale,1,tr),!p))return null;let g=null;if(h.currency&&(g=i.parse(h.currency,1,tr),!g))return null;let x=null;if(h.unit&&(x=i.parse(h.unit,1,tr),!x))return null;let w=null;if(h["min-fraction-digits"]&&(w=i.parse(h["min-fraction-digits"],1,xt),!w))return null;let E=null;return h["max-fraction-digits"]&&(E=i.parse(h["max-fraction-digits"],1,xt),!E)?null:new qc(l,p,g,x,w,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ta{constructor(e){this.type=xt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=i.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Nr(l.type)} instead.`):new Ta(l):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Nn(`Expected value to be of type string or array, but found ${Nr(Yr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const wf={"==":o_,"!=":s_,">":l_,"<":a_,">=":bf,"<=":c_,array:jo,at:n_,boolean:jo,case:yf,coalesce:Gh,collator:Pl,format:gs,image:Mc,in:$c,"index-of":_f,interpolate:wo,"interpolate-hcl":wo,"interpolate-lab":wo,length:Ta,let:gf,literal:Vs,match:i_,number:jo,"number-format":qc,object:jo,slice:xf,step:Oh,string:jo,"to-boolean":xa,"to-color":xa,"to-number":xa,"to-string":xa,var:hf,within:Lc};function Ef(n,[e,i,l,h]){e=e.evaluate(n),i=i.evaluate(n),l=l.evaluate(n);const p=h?h.evaluate(n):1,g=af(e,i,l,p);if(g)throw new Nn(g);return new rn(e/255*p,i/255*p,l/255*p,p)}function Go(n,e){return n in e}function Gc(n,e){const i=e[n];return i===void 0?null:i}function Ri(n){return{type:n}}$o.register(wf,{error:[{kind:"error"},[tr],(n,[e])=>{throw new Nn(e.evaluate(n))}],typeof:[tr,[Qt],(n,[e])=>Nr(Yr(e.evaluate(n)))],"to-rgba":[Di(xt,4),[Ai],(n,[e])=>e.evaluate(n).toArray()],rgb:[Ai,[xt,xt,xt],Ef],rgba:[Ai,[xt,xt,xt,xt],Ef],has:{type:Jt,overloads:[[[tr],(n,[e])=>Go(e.evaluate(n),n.properties())],[[tr,Qi],(n,[e,i])=>Go(e.evaluate(n),i.evaluate(n))]]},get:{type:Qt,overloads:[[[tr],(n,[e])=>Gc(e.evaluate(n),n.properties())],[[tr,Qi],(n,[e,i])=>Gc(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Qt,[tr],(n,[e])=>Gc(e.evaluate(n),n.featureState||{})],properties:[Qi,[],n=>n.properties()],"geometry-type":[tr,[],n=>n.geometryType()],id:[Qt,[],n=>n.id()],zoom:[xt,[],n=>n.globals.zoom],pitch:[xt,[],n=>n.globals.pitch||0],"distance-from-center":[xt,[],n=>n.distanceFromCenter()],"heatmap-density":[xt,[],n=>n.globals.heatmapDensity||0],"line-progress":[xt,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[xt,[],n=>n.globals.skyRadialProgress||0],accumulated:[Qt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[xt,Ri(xt),(n,e)=>{let i=0;for(const l of e)i+=l.evaluate(n);return i}],"*":[xt,Ri(xt),(n,e)=>{let i=1;for(const l of e)i*=l.evaluate(n);return i}],"-":{type:xt,overloads:[[[xt,xt],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[xt],(n,[e])=>-e.evaluate(n)]]},"/":[xt,[xt,xt],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[xt,[xt,xt],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[xt,[],()=>Math.LN2],pi:[xt,[],()=>Math.PI],e:[xt,[],()=>Math.E],"^":[xt,[xt,xt],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[xt,[xt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[xt,[xt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[xt,[xt],(n,[e])=>Math.log(e.evaluate(n))],log2:[xt,[xt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[xt,[xt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[xt,[xt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[xt,[xt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[xt,[xt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[xt,[xt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[xt,[xt],(n,[e])=>Math.atan(e.evaluate(n))],min:[xt,Ri(xt),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[xt,Ri(xt),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[xt,[xt],(n,[e])=>Math.abs(e.evaluate(n))],round:[xt,[xt],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[xt,[xt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[xt,[xt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Jt,[tr,Qt],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Jt,[Qt],(n,[e])=>n.id()===e.value],"filter-type-==":[Jt,[tr],(n,[e])=>n.geometryType()===e.value],"filter-<":[Jt,[tr,Qt],(n,[e,i])=>{const l=n.properties()[e.value],h=i.value;return typeof l==typeof h&&l<h}],"filter-id-<":[Jt,[Qt],(n,[e])=>{const i=n.id(),l=e.value;return typeof i==typeof l&&i<l}],"filter->":[Jt,[tr,Qt],(n,[e,i])=>{const l=n.properties()[e.value],h=i.value;return typeof l==typeof h&&l>h}],"filter-id->":[Jt,[Qt],(n,[e])=>{const i=n.id(),l=e.value;return typeof i==typeof l&&i>l}],"filter-<=":[Jt,[tr,Qt],(n,[e,i])=>{const l=n.properties()[e.value],h=i.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[Jt,[Qt],(n,[e])=>{const i=n.id(),l=e.value;return typeof i==typeof l&&i<=l}],"filter->=":[Jt,[tr,Qt],(n,[e,i])=>{const l=n.properties()[e.value],h=i.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[Jt,[Qt],(n,[e])=>{const i=n.id(),l=e.value;return typeof i==typeof l&&i>=l}],"filter-has":[Jt,[Qt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Jt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Jt,[Di(tr)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Jt,[Di(Qt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Jt,[tr,Di(Qt)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Jt,[tr,Di(Qt)],(n,[e,i])=>function(l,h,p,g){for(;p<=g;){const x=p+g>>1;if(h[x]===l)return!0;h[x]>l?g=x-1:p=x+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[Ri(Jt),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[Ri(Jt),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Jt,[Jt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Jt,[tr],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[tr,[tr],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[tr,[tr],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[tr,Ri(Qt),(n,e)=>e.map(i=>kl(i.evaluate(n))).join("")],"resolved-locale":[tr,[Ti],(n,[e])=>e.evaluate(n).resolvedLocale()]});var Ol=wf;function Sf(n){return{result:"success",value:n}}function qs(n){return{result:"error",value:n}}function Ca(n){return n["property-type"]==="data-driven"}function Hc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Zc(n){return!!n.expression&&n.expression.interpolated}function ar(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Nl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Af(n){return n}function Xc(n,e){const i=e.type==="color",l=n.stops&&typeof n.stops[0][0]=="object",h=l||!(l||n.property!==void 0),p=n.type||(Zc(e)?"exponential":"interval");if(i&&((n=Uo({},n)).stops&&(n.stops=n.stops.map(E=>[E[0],rn.parse(E[1])])),n.default=rn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Wh[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,x,w;if(p==="exponential")g=Ho;else if(p==="interval")g=Kc;else if(p==="categorical"){g=Tf,x=Object.create(null);for(const E of n.stops)x[E[0]]=E[1];w=typeof n.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=Cf}if(l){const E={},I=[];for(let F=0;F<n.stops.length;F++){const N=n.stops[F],G=N[0].zoom;E[G]===void 0&&(E[G]={zoom:G,type:n.type,property:n.property,default:n.default,stops:[]},I.push(G)),E[G].stops.push([N[0].value,N[1]])}const z=[];for(const F of I)z.push([E[F].zoom,Xc(E[F],e)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:wo.interpolationFactor.bind(void 0,D),zoomStops:z.map(F=>F[0]),evaluate:({zoom:F},N)=>Ho({stops:z,base:n.base},e,F).evaluate(F,N)}}if(h){const E=p==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:wo.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(I=>I[0]),evaluate:({zoom:I})=>g(n,e,I,x,w)}}return{kind:"source",evaluate(E,I){const z=I&&I.properties?I.properties[n.property]:void 0;return z===void 0?Ia(n.default,e.default):g(n,e,z,x,w)}}}function Ia(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function Tf(n,e,i,l,h){return Ia(typeof i===h?l[i]:void 0,n.default,e.default)}function Kc(n,e,i){if(ar(i)!=="number")return Ia(n.default,e.default);const l=n.stops.length;if(l===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[l-1][0])return n.stops[l-1][1];const h=Oc(n.stops.map(p=>p[0]),i);return n.stops[h][1]}function Ho(n,e,i){const l=n.base!==void 0?n.base:1;if(ar(i)!=="number")return Ia(n.default,e.default);const h=n.stops.length;if(h===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[h-1][0])return n.stops[h-1][1];const p=Oc(n.stops.map(I=>I[0]),i),g=function(I,z,D,F){const N=F-D,G=I-D;return N===0?0:z===1?G/N:(Math.pow(z,G)-1)/(Math.pow(z,N)-1)}(i,l,n.stops[p][0],n.stops[p+1][0]),x=n.stops[p][1],w=n.stops[p+1][1];let E=Ml[e.type]||Af;if(n.colorSpace&&n.colorSpace!=="rgb"){const I=Wh[n.colorSpace];E=(z,D)=>I.reverse(I.interpolate(I.forward(z),I.forward(D),g))}return typeof x.evaluate=="function"?{evaluate(...I){const z=x.evaluate.apply(void 0,I),D=w.evaluate.apply(void 0,I);if(z!==void 0&&D!==void 0)return E(z,D,g)}}:E(x,w,g)}function Cf(n,e,i){return e.type==="color"?i=rn.parse(i):e.type==="formatted"?i=ui.fromString(i.toString()):e.type==="resolvedImage"?i=Mi.fromString(i.toString()):ar(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Ia(i,n.default,e.default)}class Yc{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new Ph,this._defaultValue=i?function(l){return l.type==="color"&&(Nl(l.default)||Array.isArray(l.default))?new rn(0,0,0,0):l.type==="color"?rn.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,l,h,p,g,x,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,l,h,p,g,x,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Nn(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function ka(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Ol}function Pa(n,e){const i=new Lh(Ol,[],e?function(h){const p={color:Ai,string:tr,number:xt,enum:tr,boolean:Jt,formatted:El,resolvedImage:Us};return h.type==="array"?Di(p[h.value]||Qt,h.length):p[h.type]}(e):void 0),l=i.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Sf(new Yc(l,e)):qs(i.errors)}class Yh{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!qo(i.expression)}evaluateWithoutErrorHandling(e,i,l,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,h,p,g)}evaluate(e,i,l,h,p,g){return this._styleExpression.evaluate(e,i,l,h,p,g)}}class Ul{constructor(e,i,l,h){this.kind=e,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!qo(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,l,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,h,p,g)}evaluate(e,i,l,h,p,g){return this._styleExpression.evaluate(e,i,l,h,p,g)}interpolationFactor(e,i,l){return this.interpolationType?wo.interpolationFactor(this.interpolationType,e,i,l):0}}function Vl(n,e){if((n=Pa(n,e)).result==="error")return n;const i=n.value.expression,l=Ea(i);if(!l&&!Ca(e))return qs([new vo("","data expressions not supported")]);const h=$s(i,["zoom","pitch","distance-from-center"]);if(!h&&!Hc(e))return qs([new vo("","zoom expressions not supported")]);const p=Qc(i);return p||h?p instanceof vo?qs([p]):p instanceof wo&&!Zc(e)?qs([new vo("",'"interpolate" expressions cannot be used with this property')]):Sf(p?new Ul(l?"camera":"composite",n.value,p.labels,p instanceof wo?p.interpolation:void 0):new Yh(l?"constant":"source",n.value)):qs([new vo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Jc{constructor(e,i){this._parameters=e,this._specification=i,Uo(this,Xc(this._parameters,this._specification))}static deserialize(e){return new Jc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Qc(n){let e=null;if(n instanceof gf)e=Qc(n.result);else if(n instanceof Gh){for(const i of n.args)if(e=Qc(i),e)break}else(n instanceof Oh||n instanceof wo)&&n.input instanceof $o&&n.input.name==="zoom"&&(e=n);return e instanceof vo||n.eachChild(i=>{const l=Qc(i);l instanceof vo?e=l:!e&&l?e=new vo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new vo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class bt{constructor(e,i,l,h){this.message=(e?`${e}: `:"")+l,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function eo(n){const e=n.key,i=n.value,l=n.valueSpec||{},h=n.objectElementValidators||{},p=n.style,g=n.styleSpec;let x=[];const w=ar(i);if(w!=="object")return[new bt(e,i,`object expected, ${w} found`)];for(const E in i){const I=E.split(".")[0];let z;h[I]?z=h[I]:l[I]?z=Hn:h["*"]?z=h["*"]:l["*"]&&(z=Hn),z?x=x.concat(z({key:(e&&`${e}.`)+E,value:i[E],valueSpec:l[I]||l["*"],style:p,styleSpec:g,object:i,objectKey:E},i)):x.push(new bt(e,i[E],`unknown property "${E}"`))}for(const E in l)h[E]||l[E].required&&l[E].default===void 0&&i[E]===void 0&&x.push(new bt(e,i,`missing required property "${E}"`));return x}function If(n){const e=n.value,i=n.valueSpec,l=n.style,h=n.styleSpec,p=n.key,g=n.arrayElementValidator||Hn;if(ar(e)!=="array")return[new bt(p,e,`array expected, ${ar(e)} found`)];if(i.length&&e.length!==i.length)return[new bt(p,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new bt(p,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let x={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};h.$version<7&&(x.function=i.function),ar(i.value)==="object"&&(x=i.value);let w=[];for(let E=0;E<e.length;E++)w=w.concat(g({array:e,arrayIndex:E,value:e[E],valueSpec:x,style:l,styleSpec:h,key:`${p}[${E}]`}));return w}function jl(n){const e=n.key,i=n.value,l=n.valueSpec;let h=ar(i);if(h==="number"&&i!=i&&(h="NaN"),h!=="number")return[new bt(e,i,`number expected, ${h} found`)];if("minimum"in l){let p=l.minimum;if(ar(l.minimum)==="array"&&(p=l.minimum[n.arrayIndex]),i<p)return[new bt(e,i,`${i} is less than the minimum value ${p}`)]}if("maximum"in l){let p=l.maximum;if(ar(l.maximum)==="array"&&(p=l.maximum[n.arrayIndex]),i>p)return[new bt(e,i,`${i} is greater than the maximum value ${p}`)]}return[]}function $l(n){const e=n.valueSpec,i=an(n.value.type);let l,h,p,g={};const x=i!=="categorical"&&n.value.property===void 0,w=!x,E=ar(n.value.stops)==="array"&&ar(n.value.stops[0])==="array"&&ar(n.value.stops[0][0])==="object",I=eo({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(F){if(i==="identity")return[new bt(F.key,F.value,'identity function may not have a "stops" property')];let N=[];const G=F.value;return N=N.concat(If({key:F.key,value:G,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:z})),ar(G)==="array"&&G.length===0&&N.push(new bt(F.key,G,"array must have at least one stop")),N},default:function(F){return Hn({key:F.key,value:F.value,valueSpec:e,style:F.style,styleSpec:F.styleSpec})}}});return i==="identity"&&x&&I.push(new bt(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||I.push(new bt(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!Zc(n.valueSpec)&&I.push(new bt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(w&&!Ca(n.valueSpec)?I.push(new bt(n.key,n.value,"property functions not supported")):x&&!Hc(n.valueSpec)&&I.push(new bt(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!E||n.value.property!==void 0||I.push(new bt(n.key,n.value,'"property" property is required')),I;function z(F){let N=[];const G=F.value,Q=F.key;if(ar(G)!=="array")return[new bt(Q,G,`array expected, ${ar(G)} found`)];if(G.length!==2)return[new bt(Q,G,`array length 2 expected, length ${G.length} found`)];if(E){if(ar(G[0])!=="object")return[new bt(Q,G,`object expected, ${ar(G[0])} found`)];if(G[0].zoom===void 0)return[new bt(Q,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new bt(Q,G,"object stop key must have value")];const oe=an(G[0].zoom);if(typeof oe!="number")return[new bt(Q,G[0].zoom,"stop zoom values must be numbers")];if(p&&p>oe)return[new bt(Q,G[0].zoom,"stop zoom values must appear in ascending order")];oe!==p&&(p=oe,h=void 0,g={}),N=N.concat(eo({key:`${Q}[0]`,value:G[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:jl,value:D}}))}else N=N.concat(D({key:`${Q}[0]`,value:G[0],valueSpec:{},style:F.style,styleSpec:F.styleSpec},G));return ka(Pn(G[1]))?N.concat([new bt(`${Q}[1]`,G[1],"expressions are not allowed in function stops.")]):N.concat(Hn({key:`${Q}[1]`,value:G[1],valueSpec:e,style:F.style,styleSpec:F.styleSpec}))}function D(F,N){const G=ar(F.value),Q=an(F.value),oe=F.value!==null?F.value:N;if(l){if(G!==l)return[new bt(F.key,oe,`${G} stop domain type must match previous stop domain type ${l}`)]}else l=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof Q!="number"&&typeof Q!="string"&&typeof Q!="boolean")return[new bt(F.key,oe,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&i!=="categorical"){let fe=`number expected, ${G} found`;return Ca(e)&&i===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new bt(F.key,oe,fe)]}return i!=="categorical"||G!=="number"||typeof Q=="number"&&isFinite(Q)&&Math.floor(Q)===Q?i!=="categorical"&&G==="number"&&typeof Q=="number"&&typeof h=="number"&&h!==void 0&&Q<h?[new bt(F.key,oe,"stop domain values must appear in ascending order")]:(h=Q,i==="categorical"&&Q in g?[new bt(F.key,oe,"stop domain values must be unique")]:(g[Q]=!0,[])):[new bt(F.key,oe,`integer expected, found ${String(Q)}`)]}}function zn(n){const e=(n.expressionContext==="property"?Vl:Pa)(Pn(n.value),n.valueSpec);if(e.result==="error")return e.value.map(l=>new bt(`${n.key}${l.key}`,n.value,l.message));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new bt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!qo(i))return[new bt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter")return Wl(i,n);if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!$s(i,["zoom","feature-state"]))return[new bt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ea(i))return[new bt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wl(n,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const h of e.valueSpec.expression.parameters)i.delete(h);if(i.size===0)return[];const l=[];return n instanceof $o&&i.has(n.name)?[new bt(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(h=>{l.push(...Wl(h,e))}),l)}function eu(n){const e=n.key,i=n.value,l=n.valueSpec,h=[];return Array.isArray(l.values)?l.values.indexOf(an(i))===-1&&h.push(new bt(e,i,`expected one of [${l.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(l.values).indexOf(an(i))===-1&&h.push(new bt(e,i,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function Jh(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Jh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function tu(n,e="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Jh(n)||(n=Da(n));const i=n;let l=!0;try{l=function(E){if(!za(E))return E;let I=Pn(E);return ru(I),I=kf(I),I}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const h=We[`filter_${e}`],p=Pa(l,h);let g=null;if(p.result==="error")throw new Error(p.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,I,z)=>p.value.evaluate(E,I,{},z);let x=null,w=null;if(l!==i){const E=Pa(i,h);if(E.result==="error")throw new Error(E.value.map(I=>`${I.key}: ${I.message}`).join(", "));x=(I,z,D,F,N)=>E.value.evaluate(I,z,{},D,void 0,void 0,F,N),w=!Ea(E.value.expression)}return{filter:g,dynamicFilter:x||void 0,needGeometry:Pf(l),needFeature:!!w}}function kf(n){if(!Array.isArray(n))return n;const e=function(i){if(Qh.has(i[0])){for(let l=1;l<i.length;l++)if(za(i[l]))return!0}return i}(n);return e===!0?e:e.map(i=>kf(i))}function ru(n){let e=!1;const i=[];if(n[0]==="case"){for(let l=1;l<n.length-1;l+=2)e=e||za(n[l]),i.push(n[l+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||za(n[1]);for(let l=2;l<n.length-1;l+=2)i.push(n[l+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||za(n[1]);for(let l=1;l<n.length-1;l+=2)i.push(n[l+1])}e&&(n.length=0,n.push("any",...i));for(let l=1;l<n.length;l++)ru(n[l])}function za(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(za(n[i]))return!0;return!1}const Qh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function u_(n,e){return n<e?-1:n>e?1:0}function Pf(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let e=1;e<n.length;e++)if(Pf(n[e]))return!0;return!1}function Da(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?ed(n[1],n[2],"=="):e==="!="?nu(ed(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ed(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Da))):e==="all"?["all"].concat(n.slice(1).map(Da)):e==="none"?["all"].concat(n.slice(1).map(Da).map(nu)):e==="in"?td(n[1],n.slice(2)):e==="!in"?nu(td(n[1],n.slice(2))):e==="has"?rd(n[1]):e==="!has"?nu(rd(n[1])):e!=="within"||n;var i}function ed(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function td(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(u_)]]:["filter-in-small",n,["literal",e]]}}function rd(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function nu(n){return["!",n]}function ql(n){return Jh(Pn(n.value))?zn(Uo({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Gl(n)}function Gl(n){const e=n.value,i=n.key;if(ar(e)!=="array")return[new bt(i,e,`array expected, ${ar(e)} found`)];const l=n.styleSpec;let h,p=[];if(e.length<1)return[new bt(i,e,"filter array must have at least 1 element")];switch(p=p.concat(eu({key:`${i}[0]`,value:e[0],valueSpec:l.filter_operator,style:n.style,styleSpec:n.styleSpec})),an(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&an(e[1])==="$type"&&p.push(new bt(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new bt(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=ar(e[1]),h!=="string"&&p.push(new bt(`${i}[1]`,e[1],`string expected, ${h} found`)));for(let g=2;g<e.length;g++)h=ar(e[g]),an(e[1])==="$type"?p=p.concat(eu({key:`${i}[${g}]`,value:e[g],valueSpec:l.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&p.push(new bt(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)p=p.concat(Gl({key:`${i}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=ar(e[1]),e.length!==2?p.push(new bt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&p.push(new bt(`${i}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=ar(e[1]),e.length!==2?p.push(new bt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="object"&&p.push(new bt(`${i}[1]`,e[1],`object expected, ${h} found`))}return p}function nd(n,e){const i=n.key,l=n.style,h=n.styleSpec,p=n.value,g=n.objectKey,x=h[`${e}_${n.layerType}`];if(!x)return[];const w=g.match(/^(.*)-transition$/);if(e==="paint"&&w&&x[w[1]]&&x[w[1]].transition)return Hn({key:i,value:p,valueSpec:h.transition,style:l,styleSpec:h});const E=n.valueSpec||x[g];if(!E)return[new bt(i,p,`unknown property "${g}"`)];let I;if(ar(p)==="string"&&Ca(E)&&!E.tokens&&(I=/^{([^}]+)}$/.exec(p))){const D=`\`{ "type": "identity", "property": ${I?JSON.stringify(I[1]):'"_"'} }\``;return[new bt(i,p,`"${g}" does not support interpolation syntax
Use an identity property function instead: ${D}.`)]}const z=[];return n.layerType==="symbol"&&(g==="text-field"&&l&&!l.glyphs&&z.push(new bt(i,p,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&Nl(Pn(p))&&an(p.type)==="identity"&&z.push(new bt(i,p,'"text-font" does not support identity functions'))),z.concat(Hn({key:n.key,value:p,valueSpec:E,style:l,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:g}))}function zf(n){return nd(n,"paint")}function id(n){return nd(n,"layout")}function Df(n){let e=[];const i=n.value,l=n.key,h=n.style,p=n.styleSpec;i.type||i.ref||e.push(new bt(l,i,'either "type" or "ref" is required'));let g=an(i.type);const x=an(i.ref);if(i.id){const w=an(i.id);for(let E=0;E<n.arrayIndex;E++){const I=h.layers[E];an(I.id)===w&&e.push(new bt(l,i.id,`duplicate layer id "${i.id}", previously used at line ${I.id.__line__}`))}}if("ref"in i){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in i&&e.push(new bt(l,i[E],`"${E}" is prohibited for ref layers`))}),h.layers.forEach(E=>{an(E.id)===x&&(w=E)}),w?w.ref?e.push(new bt(l,i.ref,"ref cannot reference another ref layer")):g=an(w.type):typeof x=="string"&&e.push(new bt(l,i.ref,`ref layer "${x}" not found`))}else if(g!=="background"&&g!=="sky")if(i.source){const w=h.sources&&h.sources[i.source],E=w&&an(w.type);w?E==="vector"&&g==="raster"?e.push(new bt(l,i.source,`layer "${i.id}" requires a raster source`)):E==="raster"&&g!=="raster"?e.push(new bt(l,i.source,`layer "${i.id}" requires a vector source`)):E!=="vector"||i["source-layer"]?E==="raster-dem"&&g!=="hillshade"?e.push(new bt(l,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||E==="geojson"&&w.lineMetrics||e.push(new bt(l,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new bt(l,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new bt(l,i.source,`source "${i.source}" not found`))}else e.push(new bt(l,i,'missing required property "source"'));return e=e.concat(eo({key:l,value:i,valueSpec:p.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Hn({key:`${l}.type`,value:i.type,valueSpec:p.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:w=>ql(Uo({layerType:g},w)),layout:w=>eo({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>id(Uo({layerType:g},E))}}),paint:w=>eo({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>zf(Uo({layerType:g},E))}})}})),e}function _s(n){const e=n.value,i=n.key,l=ar(e);return l!=="string"?[new bt(i,e,`string expected, ${l} found`)]:[]}const Mf={promoteId:function({key:n,value:e}){if(ar(e)==="string")return _s({key:n,value:e});{const i=[];for(const l in e)i.push(..._s({key:`${n}.${l}`,value:e[l]}));return i}}};function Rf(n){const e=n.value,i=n.key,l=n.styleSpec,h=n.style;if(!e.type)return[new bt(i,e,'"type" is required')];const p=an(e.type);let g;switch(p){case"vector":case"raster":case"raster-dem":return g=eo({key:i,value:e,valueSpec:l[`source_${p.replace("-","_")}`],style:n.style,styleSpec:l,objectElementValidators:Mf}),g;case"geojson":if(g=eo({key:i,value:e,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:Mf}),e.cluster)for(const x in e.clusterProperties){const[w,E]=e.clusterProperties[x],I=typeof w=="string"?[w,["accumulated"],["get",x]]:w;g.push(...zn({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),g.push(...zn({key:`${i}.${x}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return g;case"video":return eo({key:i,value:e,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return eo({key:i,value:e,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new bt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return eu({key:`${i}.type`,value:e.type,valueSpec:{values:h_(l)},style:h,styleSpec:l})}}function h_(n){return n.source.reduce((e,i)=>{const l=n[i];return l.type.type==="enum"&&(e=e.concat(Object.keys(l.type.values))),e},[])}function Bf(n){const e=n.value,i=n.styleSpec,l=i.light,h=n.style;let p=[];const g=ar(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new bt("light",e,`object expected, ${g} found`)]),p;for(const x in e){const w=x.match(/^(.*)-transition$/);p=p.concat(w&&l[w[1]]&&l[w[1]].transition?Hn({key:x,value:e[x],valueSpec:i.transition,style:h,styleSpec:i}):l[x]?Hn({key:x,value:e[x],valueSpec:l[x],style:h,styleSpec:i}):[new bt(x,e[x],`unknown property "${x}"`)])}return p}function od(n){const e=n.value,i=n.key,l=n.style,h=n.styleSpec,p=h.terrain;let g=[];const x=ar(e);if(e===void 0)return g;if(x!=="object")return g=g.concat([new bt("terrain",e,`object expected, ${x} found`)]),g;for(const w in e){const E=w.match(/^(.*)-transition$/);g=g.concat(E&&p[E[1]]&&p[E[1]].transition?Hn({key:w,value:e[w],valueSpec:h.transition,style:l,styleSpec:h}):p[w]?Hn({key:w,value:e[w],valueSpec:p[w],style:l,styleSpec:h}):[new bt(w,e[w],`unknown property "${w}"`)])}if(e.source){const w=l.sources&&l.sources[e.source],E=w&&an(w.type);w?E!=="raster-dem"&&g.push(new bt(i,e.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):g.push(new bt(i,e.source,`source "${e.source}" not found`))}else g.push(new bt(i,e,'terrain is missing required property "source"'));return g}function Lf(n){const e=n.value,i=n.style,l=n.styleSpec,h=l.fog;let p=[];const g=ar(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new bt("fog",e,`object expected, ${g} found`)]),p;for(const x in e){const w=x.match(/^(.*)-transition$/);p=p.concat(w&&h[w[1]]&&h[w[1]].transition?Hn({key:x,value:e[x],valueSpec:l.transition,style:i,styleSpec:l}):h[x]?Hn({key:x,value:e[x],valueSpec:h[x],style:i,styleSpec:l}):[new bt(x,e[x],`unknown property "${x}"`)])}return p}const Ff={"*":()=>[],array:If,boolean:function(n){const e=n.value,i=n.key,l=ar(e);return l!=="boolean"?[new bt(i,e,`boolean expected, ${l} found`)]:[]},number:jl,color:function(n){const e=n.key,i=n.value,l=ar(i);return l!=="string"?[new bt(e,i,`color expected, ${l} found`)]:Eh(i)===null?[new bt(e,i,`color expected, "${i}" found`)]:[]},enum:eu,filter:ql,function:$l,layer:Df,object:eo,source:Rf,light:Bf,terrain:od,fog:Lf,string:_s,formatted:function(n){return _s(n).length===0?[]:zn(n)},resolvedImage:function(n){return _s(n).length===0?[]:zn(n)},projection:function(n){const e=n.value,i=n.styleSpec,l=i.projection,h=n.style;let p=[];const g=ar(e);if(g==="object")for(const x in e)p=p.concat(Hn({key:x,value:e[x],valueSpec:l[x],style:h,styleSpec:i}));else g!=="string"&&(p=p.concat([new bt("projection",e,`object or string expected, ${g} found`)]));return p}};function Hn(n){const e=n.value,i=n.valueSpec,l=n.styleSpec;return i.expression&&Nl(an(e))?$l(n):i.expression&&ka(Pn(e))?zn(n):i.type&&Ff[i.type]?Ff[i.type](n):eo(Uo({},n,{valueSpec:i.type?l[i.type]:i}))}function d_(n){const e=n.value,i=n.key,l=_s(n);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new bt(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new bt(i,e,'"glyphs" url must include a "{range}" token'))),l}function Of(n,e=We){return Bi(Hn({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:d_,"*":()=>[]}}))}const p_=n=>Bi(zf(n)),f_=n=>Bi(id(n));function Bi(n){return n.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Nf(n,e){let i=!1;if(e&&e.length)for(const l of e)n.fire(new No(new Error(l.message))),i=!0;return i}var m_=Eo,to=3;function Eo(n,e,i){var l=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var h=new Int32Array(this.arrayBuffer);n=h[0],this.d=(e=h[1])+2*(i=h[2]);for(var p=0;p<this.d*this.d;p++){var g=h[to+p],x=h[to+p+1];l.push(g===x?null:h.subarray(g,x))}var w=h[to+l.length+1];this.keys=h.subarray(h[to+l.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var E=0;E<this.d*this.d;E++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=i,this.scale=e/n,this.uid=0;var I=i/e*n;this.min=-I,this.max=n+I}Eo.prototype.insert=function(n,e,i,l,h){this._forEachCell(e,i,l,h,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(h)},Eo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Eo.prototype._insertCell=function(n,e,i,l,h,p){this.cells[h].push(p)},Eo.prototype.query=function(n,e,i,l,h){var p=this.min,g=this.max;if(n<=p&&e<=p&&g<=i&&g<=l&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(n,e,i,l,this._queryCell,x,{},h),x},Eo.prototype._queryCell=function(n,e,i,l,h,p,g,x){var w=this.cells[h];if(w!==null)for(var E=this.keys,I=this.bboxes,z=0;z<w.length;z++){var D=w[z];if(g[D]===void 0){var F=4*D;(x?x(I[F+0],I[F+1],I[F+2],I[F+3]):n<=I[F+2]&&e<=I[F+3]&&i>=I[F+0]&&l>=I[F+1])?(g[D]=!0,p.push(E[D])):g[D]=!1}}},Eo.prototype._forEachCell=function(n,e,i,l,h,p,g,x){for(var w=this._convertToCellCoord(n),E=this._convertToCellCoord(e),I=this._convertToCellCoord(i),z=this._convertToCellCoord(l),D=w;D<=I;D++)for(var F=E;F<=z;F++){var N=this.d*F+D;if((!x||x(this._convertFromCellCoord(D),this._convertFromCellCoord(F),this._convertFromCellCoord(D+1),this._convertFromCellCoord(F+1)))&&h.call(this,n,e,i,l,N,p,g,x))return}},Eo.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Eo.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Eo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=to+this.cells.length+1+1,i=0,l=0;l<this.cells.length;l++)i+=this.cells[l].length;var h=new Int32Array(e+i+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=e,g=0;g<n.length;g++){var x=n[g];h[to+g]=p,h.set(x,p),p+=x.length}return h[to+n.length]=p,h.set(this.keys,p),h[to+n.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};var Gs=$(m_);const iu={};function Et(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),iu[e]={klass:n,omit:i.omit||[]}}Et(Object,"Object"),Gs.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.push(i),{buffer:i}},Gs.deserialize=function(n){return new Gs(n.buffer)},Object.defineProperty(Gs,"name",{value:"Grid"}),Et(Gs,"Grid"),Et(rn,"Color"),Et(Error,"Error"),Et(Ji,"AJAXError"),Et(Mi,"ResolvedImage"),Et(Jc,"StylePropertyFunction"),Et(Yc,"StyleExpression",{omit:["_evaluator"]}),Et(Ul,"ZoomDependentExpression"),Et(Yh,"ZoomConstantExpression"),Et($o,"CompoundExpression",{omit:["_evaluate"]});for(const n in Ol)iu[Ol[n]._classRegistryKey]||Et(Ol[n],`Expression${n}`);function sd(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function ad(n){return S.ImageBitmap&&n instanceof S.ImageBitmap}function Ma(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(sd(n)||ad(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.push(i.buffer),i}if(n instanceof S.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const l of n)i.push(Ma(l,e));return i}if(typeof n=="object"){const i=n.constructor,l=i._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const h=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const p in n)n.hasOwnProperty(p)&&(iu[l].omit.indexOf(p)>=0||(h[p]=Ma(n[p],e)));n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof n)}function Hs(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||sd(n)||ad(n)||ArrayBuffer.isView(n)||n instanceof S.ImageData)return n;if(Array.isArray(n))return n.map(Hs);if(typeof n=="object"){const e=n.$name||"Object",{klass:i}=iu[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const l=Object.create(i.prototype);for(const h of Object.keys(n))h!=="$name"&&(l[h]=Hs(n[h]));return l}throw new Error("can't deserialize object of type "+typeof n)}const yt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function ld(n){for(const e of n)if(cd(e.charCodeAt(0)))return!0;return!1}function g_(n){for(const e of n)if(!Uf(e.charCodeAt(0)))return!1;return!0}function Uf(n){return!(yt.Arabic(n)||yt["Arabic Supplement"](n)||yt["Arabic Extended-A"](n)||yt["Arabic Presentation Forms-A"](n)||yt["Arabic Presentation Forms-B"](n))}function cd(n){return!(n!==746&&n!==747&&(n<4352||!(yt["Bopomofo Extended"](n)||yt.Bopomofo(n)||yt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||yt["CJK Compatibility Ideographs"](n)||yt["CJK Compatibility"](n)||yt["CJK Radicals Supplement"](n)||yt["CJK Strokes"](n)||!(!yt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||yt["CJK Unified Ideographs Extension A"](n)||yt["CJK Unified Ideographs"](n)||yt["Enclosed CJK Letters and Months"](n)||yt["Hangul Compatibility Jamo"](n)||yt["Hangul Jamo Extended-A"](n)||yt["Hangul Jamo Extended-B"](n)||yt["Hangul Jamo"](n)||yt["Hangul Syllables"](n)||yt.Hiragana(n)||yt["Ideographic Description Characters"](n)||yt.Kanbun(n)||yt["Kangxi Radicals"](n)||yt["Katakana Phonetic Extensions"](n)||yt.Katakana(n)&&n!==12540||!(!yt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!yt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||yt["Unified Canadian Aboriginal Syllabics"](n)||yt["Unified Canadian Aboriginal Syllabics Extended"](n)||yt["Vertical Forms"](n)||yt["Yijing Hexagram Symbols"](n)||yt["Yi Syllables"](n)||yt["Yi Radicals"](n))))}function Vf(n){return!(cd(n)||function(e){return!!(yt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||yt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||yt["Letterlike Symbols"](e)||yt["Number Forms"](e)||yt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||yt["Control Pictures"](e)&&e!==9251||yt["Optical Character Recognition"](e)||yt["Enclosed Alphanumerics"](e)||yt["Geometric Shapes"](e)||yt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||yt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||yt["CJK Symbols and Punctuation"](e)||yt.Katakana(e)||yt["Private Use Area"](e)||yt["CJK Compatibility Forms"](e)||yt["Small Form Variants"](e)||yt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function jf(n){return n>=1424&&n<=2303||yt["Arabic Presentation Forms-A"](n)||yt["Arabic Presentation Forms-B"](n)}function __(n,e){return!(!e&&jf(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||yt.Khmer(n))}function y_(n){for(const e of n)if(jf(e.charCodeAt(0)))return!0;return!1}const ud="deferred",hd="loading",dd="loaded";let Ra=null,d="unavailable",o=null;const u=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(d="error"),Ra&&Ra(n)};function m(){y.fire(new Ns("pluginStateChange",{pluginStatus:d,pluginURL:o}))}const y=new wl,v=function(){return d},A=function(){if(d!==ud||!o)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=hd,m(),o&&ms({url:o},n=>{n?u(n):(d=dd,m())})},T={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===dd||T.applyArabicShaping!=null,isLoading:()=>d===hd,setState(n){d=n.pluginStatus,o=n.pluginURL},isParsed:()=>T.applyArabicShaping!=null&&T.processBidirectionalText!=null&&T.processStyledBidirectionalText!=null,getPluginURL:()=>o};class P{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,l){for(const h of i)if(!__(h.charCodeAt(0),l))return!1;return!0}(e,T.isLoaded())}}class B{constructor(e,i){this.property=e,this.value=i,this.expression=function(l,h){if(Nl(l))return new Jc(l,h);if(ka(l)){const p=Vl(l,h);if(p.result==="error")throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));return p.value}{let p=l;return typeof l=="string"&&h.type==="color"&&(p=rn.parse(l)),{kind:"constant",evaluate:()=>p}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,l){return this.property.possiblyEvaluate(this,e,i,l)}}class R{constructor(e){this.property=e,this.value=new B(e,void 0)}transitioned(e,i){return new Y(this.property,this.value,i,et({},e.transition,this.transition),e.now)}untransitioned(){return new Y(this.property,this.value,null,{},0)}}class W{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Br(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new R(this._values[e].property)),this._values[e].value=new B(this._values[e].property,i===null?void 0:Br(i))}getTransition(e){return Br(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new R(this._values[e].property)),this._values[e].transition=Br(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const l=new te(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(e,i._values[h]);return l}untransitioned(){const e=new te(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Y{constructor(e,i,l,h,p){const g=h.delay||0,x=h.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+g,this.end=this.begin+x,e.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(e,i,l){const h=e.now||0,p=this.value.possiblyEvaluate(e,i,l),g=this.prior;if(g){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return g.possiblyEvaluate(e,i,l);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,l),p,zt(x))}}return p}}class te{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,l){const h=new ie(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,i,l);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ne{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Br(this._values[e].value)}setValue(e,i){this._values[e]=new B(this._values[e].property,i===null?void 0:Br(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l)}return e}possiblyEvaluate(e,i,l){const h=new ie(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,i,l);return h}}class re{constructor(e,i,l){this.property=e,this.value=i,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,l,h){return this.property.evaluate(this.value,this.parameters,e,i,l,h)}}class ie{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class q{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,l){const h=Ml[this.specification.type];return h?h(e,i,l):e}}class ee{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,l,h){return new re(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},l,h)}:e.expression,i)}interpolate(e,i,l){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new re(this,{kind:"constant",value:void 0},e.parameters);const h=Ml[this.specification.type];return h?new re(this,{kind:"constant",value:h(e.value.value,i.value.value,l)},e.parameters):e}evaluate(e,i,l,h,p,g){return e.kind==="constant"?e.value:e.evaluate(i,l,h,p,g)}}class ae{constructor(e){this.specification=e}possiblyEvaluate(e,i,l,h){return!!e.expression.evaluate(i,null,{},l,h)}interpolate(){return!1}}class ce{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new P(0,{});for(const l in e){const h=e[l];h.specification.overridable&&this.overridableProperties.push(l);const p=this.defaultPropertyValues[l]=new B(h,void 0),g=this.defaultTransitionablePropertyValues[l]=new R(h);this.defaultTransitioningPropertyValues[l]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=p.possiblyEvaluate(i)}}}function xe(n,e){return 256*(n=Ge(Math.floor(n),0,255))+Ge(Math.floor(e),0,255)}Et(ee,"DataDrivenProperty"),Et(q,"DataConstantProperty"),Et(ae,"ColorRampProperty");const be={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ve{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ie{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ce(n,e=1){let i=0,l=0;return{members:n.map(h=>{const p=be[h.type].BYTES_PER_ELEMENT,g=i=Re(i,Math.max(e,p)),x=h.components||1;return l=Math.max(l,p),i+=p*x,{name:h.name,type:h.type,components:x,offset:g}}),size:Re(i,Math.max(l,e)),alignment:e}}function Re(n,e){return Math.ceil(n/e)*e}class it extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=l,e}}it.prototype.bytesPerElement=4,Et(it,"StructArrayLayout2i4");class ze extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=l,this.int16[p+2]=h,e}}ze.prototype.bytesPerElement=6,Et(ze,"StructArrayLayout3i6");class Ze extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h)}emplace(e,i,l,h,p){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=l,this.int16[g+2]=h,this.int16[g+3]=p,e}}Ze.prototype.bytesPerElement=8,Et(Ze,"StructArrayLayout4i8");class Fe extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,h,p,g,x)}emplace(e,i,l,h,p,g,x,w){const E=6*e,I=12*e,z=3*e;return this.int16[E+0]=i,this.int16[E+1]=l,this.uint8[I+4]=h,this.uint8[I+5]=p,this.uint8[I+6]=g,this.uint8[I+7]=x,this.float32[z+2]=w,e}}Fe.prototype.bytesPerElement=12,Et(Fe,"StructArrayLayout2i4ub1f12");class nt extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h)}emplace(e,i,l,h,p){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=l,this.float32[g+2]=h,this.float32[g+3]=p,e}}nt.prototype.bytesPerElement=16,Et(nt,"StructArrayLayout4f16");class Me extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,l,h,p)}emplace(e,i,l,h,p,g){const x=6*e,w=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=l,this.uint16[x+2]=h,this.uint16[x+3]=p,this.float32[w+2]=g,e}}Me.prototype.bytesPerElement=12,Et(Me,"StructArrayLayout4ui1f12");class He extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h)}emplace(e,i,l,h,p){const g=4*e;return this.uint16[g+0]=i,this.uint16[g+1]=l,this.uint16[g+2]=h,this.uint16[g+3]=p,e}}He.prototype.bytesPerElement=8,Et(He,"StructArrayLayout4ui8");class at extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,l,h,p,g)}emplace(e,i,l,h,p,g,x){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=h,this.int16[w+3]=p,this.int16[w+4]=g,this.int16[w+5]=x,e}}at.prototype.bytesPerElement=12,Et(at,"StructArrayLayout6i12");class Qe extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,x,w,E,I,z,D){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,l,h,p,g,x,w,E,I,z,D)}emplace(e,i,l,h,p,g,x,w,E,I,z,D,F){const N=12*e;return this.int16[N+0]=i,this.int16[N+1]=l,this.int16[N+2]=h,this.int16[N+3]=p,this.uint16[N+4]=g,this.uint16[N+5]=x,this.uint16[N+6]=w,this.uint16[N+7]=E,this.int16[N+8]=I,this.int16[N+9]=z,this.int16[N+10]=D,this.int16[N+11]=F,e}}Qe.prototype.bytesPerElement=24,Et(Qe,"StructArrayLayout4i4ui4i24");class lt extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,l,h,p,g)}emplace(e,i,l,h,p,g,x){const w=10*e,E=5*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=h,this.float32[E+2]=p,this.float32[E+3]=g,this.float32[E+4]=x,e}}lt.prototype.bytesPerElement=20,Et(lt,"StructArrayLayout3i3f20");class kt extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}kt.prototype.bytesPerElement=4,Et(kt,"StructArrayLayout1ul4");class Nt extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,x,w,E,I,z,D,F){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,l,h,p,g,x,w,E,I,z,D,F)}emplace(e,i,l,h,p,g,x,w,E,I,z,D,F,N){const G=20*e,Q=10*e;return this.int16[G+0]=i,this.int16[G+1]=l,this.int16[G+2]=h,this.int16[G+3]=p,this.int16[G+4]=g,this.float32[Q+3]=x,this.float32[Q+4]=w,this.float32[Q+5]=E,this.float32[Q+6]=I,this.int16[G+14]=z,this.uint32[Q+8]=D,this.uint16[G+18]=F,this.uint16[G+19]=N,e}}Nt.prototype.bytesPerElement=40,Et(Nt,"StructArrayLayout5i4f1i1ul2ui40");class At extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,h,p,g,x)}emplace(e,i,l,h,p,g,x,w){const E=8*e;return this.int16[E+0]=i,this.int16[E+1]=l,this.int16[E+2]=h,this.int16[E+4]=p,this.int16[E+5]=g,this.int16[E+6]=x,this.int16[E+7]=w,e}}At.prototype.bytesPerElement=16,Et(At,"StructArrayLayout3i2i2i16");class Bt extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,l,h,p)}emplace(e,i,l,h,p,g){const x=4*e,w=8*e;return this.float32[x+0]=i,this.float32[x+1]=l,this.float32[x+2]=h,this.int16[w+6]=p,this.int16[w+7]=g,e}}Bt.prototype.bytesPerElement=16,Et(Bt,"StructArrayLayout2f1f2i16");class er extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h)}emplace(e,i,l,h,p){const g=12*e,x=3*e;return this.uint8[g+0]=i,this.uint8[g+1]=l,this.float32[x+1]=h,this.float32[x+2]=p,e}}er.prototype.bytesPerElement=12,Et(er,"StructArrayLayout2ub2f12");class Yt extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=l,this.float32[p+2]=h,e}}Yt.prototype.bytesPerElement=12,Et(Yt,"StructArrayLayout3f12");class It extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=l,this.uint16[p+2]=h,e}}It.prototype.bytesPerElement=6,Et(It,"StructArrayLayout3ui6");class _r extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,x,w,E,I,z,D,F,N,G,Q,oe,fe,se,he,ge){const me=this.length;return this.resize(me+1),this.emplace(me,e,i,l,h,p,g,x,w,E,I,z,D,F,N,G,Q,oe,fe,se,he,ge)}emplace(e,i,l,h,p,g,x,w,E,I,z,D,F,N,G,Q,oe,fe,se,he,ge,me){const Be=30*e,De=15*e,qe=60*e;return this.int16[Be+0]=i,this.int16[Be+1]=l,this.int16[Be+2]=h,this.float32[De+2]=p,this.float32[De+3]=g,this.uint16[Be+8]=x,this.uint16[Be+9]=w,this.uint32[De+5]=E,this.uint32[De+6]=I,this.uint32[De+7]=z,this.uint16[Be+16]=D,this.uint16[Be+17]=F,this.uint16[Be+18]=N,this.float32[De+10]=G,this.float32[De+11]=Q,this.uint8[qe+48]=oe,this.uint8[qe+49]=fe,this.uint8[qe+50]=se,this.uint32[De+13]=he,this.int16[Be+28]=ge,this.uint8[qe+58]=me,e}}_r.prototype.bytesPerElement=60,Et(_r,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class wr extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,x,w,E,I,z,D,F,N,G,Q,oe,fe,se,he,ge,me,Be,De,qe,ot,Oe,Ke,Ye,rt){const ut=this.length;return this.resize(ut+1),this.emplace(ut,e,i,l,h,p,g,x,w,E,I,z,D,F,N,G,Q,oe,fe,se,he,ge,me,Be,De,qe,ot,Oe,Ke,Ye,rt)}emplace(e,i,l,h,p,g,x,w,E,I,z,D,F,N,G,Q,oe,fe,se,he,ge,me,Be,De,qe,ot,Oe,Ke,Ye,rt,ut){const $e=38*e,mt=19*e;return this.int16[$e+0]=i,this.int16[$e+1]=l,this.int16[$e+2]=h,this.float32[mt+2]=p,this.float32[mt+3]=g,this.int16[$e+8]=x,this.int16[$e+9]=w,this.int16[$e+10]=E,this.int16[$e+11]=I,this.int16[$e+12]=z,this.int16[$e+13]=D,this.uint16[$e+14]=F,this.uint16[$e+15]=N,this.uint16[$e+16]=G,this.uint16[$e+17]=Q,this.uint16[$e+18]=oe,this.uint16[$e+19]=fe,this.uint16[$e+20]=se,this.uint16[$e+21]=he,this.uint16[$e+22]=ge,this.uint16[$e+23]=me,this.uint16[$e+24]=Be,this.uint16[$e+25]=De,this.uint16[$e+26]=qe,this.uint16[$e+27]=ot,this.uint16[$e+28]=Oe,this.uint32[mt+15]=Ke,this.float32[mt+16]=Ye,this.float32[mt+17]=rt,this.float32[mt+18]=ut,e}}wr.prototype.bytesPerElement=76,Et(wr,"StructArrayLayout3i2f6i15ui1ul3f76");class Er extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Er.prototype.bytesPerElement=4,Et(Er,"StructArrayLayout1f4");class Sr extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,l,h,p)}emplace(e,i,l,h,p,g){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=l,this.float32[x+2]=h,this.float32[x+3]=p,this.float32[x+4]=g,e}}Sr.prototype.bytesPerElement=20,Et(Sr,"StructArrayLayout5f20");class Zn extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h)}emplace(e,i,l,h,p){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=l,this.uint16[g+3]=h,this.uint16[g+4]=p,e}}Zn.prototype.bytesPerElement=12,Et(Zn,"StructArrayLayout1ul3ui12");class Dn extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=l,e}}Dn.prototype.bytesPerElement=4,Et(Dn,"StructArrayLayout2ui4");class Li extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Li.prototype.bytesPerElement=2,Et(Li,"StructArrayLayout1ui2");class So extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=l,e}}So.prototype.bytesPerElement=8,Et(So,"StructArrayLayout2f8");class Ur extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ur.prototype.size=40;class Ar extends Nt{get(e){return new Ur(this,e)}}Et(Ar,"CollisionBoxArray");class ur extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ur.prototype.size=60;class ln extends _r{get(e){return new ur(this,e)}}Et(ln,"PlacedSymbolArray");class ri extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ri.prototype.size=76;class Lr extends wr{get(e){return new ri(this,e)}}Et(Lr,"SymbolInstanceArray");class hi extends Er{getoffsetX(e){return this.float32[1*e+0]}}Et(hi,"GlyphOffsetArray");class ou extends it{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Et(ou,"SymbolLineVertexArray");class Zs extends ve{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Zs.prototype.size=12;class Hl extends Zn{get(e){return new Zs(this,e)}}Et(Hl,"FeatureIndexArray");class Zo extends Dn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Et(Zo,"FillExtrusionCentroidArray");const ys=Ce([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Xs=Ce([{name:"a_dash",components:4,type:"Uint16"}]);var su={exports:{}},Zl={exports:{}};Zl.exports=function(n,e){var i,l,h,p,g,x,w,E;for(l=n.length-(i=3&n.length),h=e,g=3432918353,x=461845907,E=0;E<l;)w=255&n.charCodeAt(E)|(255&n.charCodeAt(++E))<<8|(255&n.charCodeAt(++E))<<16|(255&n.charCodeAt(++E))<<24,++E,h=27492+(65535&(p=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,i){case 3:w^=(255&n.charCodeAt(E+2))<<16;case 2:w^=(255&n.charCodeAt(E+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&n.charCodeAt(E)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var pd=Zl.exports,rw={exports:{}};rw.exports=function(n,e){for(var i,l=n.length,h=e^l,p=0;l>=4;)i=1540483477*(65535&(i=255&n.charCodeAt(p)|(255&n.charCodeAt(++p))<<8|(255&n.charCodeAt(++p))<<16|(255&n.charCodeAt(++p))<<24))+((1540483477*(i>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),l-=4,++p;switch(l){case 3:h^=(255&n.charCodeAt(p+2))<<16;case 2:h^=(255&n.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var nw=pd,Ez=rw.exports;su.exports=nw,su.exports.murmur3=nw,su.exports.murmur2=Ez;var x_=$(su.exports);class $f{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,l,h){this.ids.push(iw(e)),this.positions.push(i,l,h)}getPositions(e){const i=iw(e);let l=0,h=this.ids.length-1;for(;l<h;){const g=l+h>>1;this.ids[g]>=i?h=g:l=g+1}const p=[];for(;this.ids[l]===i;)p.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return p}static serialize(e,i){const l=new Float64Array(e.ids),h=new Uint32Array(e.positions);return v_(l,h,0,l.length-1),i&&i.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(e){const i=new $f;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function iw(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:x_(String(n))}function v_(n,e,i,l){for(;i<l;){const h=n[i+l>>1];let p=i-1,g=l+1;for(;;){do p++;while(n[p]<h);do g--;while(n[g]>h);if(p>=g)break;Wf(n,p,g),Wf(e,3*p,3*g),Wf(e,3*p+1,3*g+1),Wf(e,3*p+2,3*g+2)}g-i<l-g?(v_(n,e,i,g),i=g+1):(v_(n,e,g+1,l),l=g)}}function Wf(n,e,i){const l=n[e];n[e]=n[i],n[i]=l}Et($f,"FeaturePositionMap");class Ks{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class qf extends Ks{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class ow extends Ks{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class sw extends Ks{constructor(e){super(e),this.current=rn.transparent}set(e,i,l){this.fetchUniformLocation(e,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const Sz=new Float32Array(16),Az=new Float32Array(9),Tz=new Float32Array(4);function b_(n){return[xe(255*n.r,255*n.g),xe(255*n.b,255*n.a)]}class fd{constructor(e,i,l){this.value=e,this.uniformNames=i.map(h=>`u_${h}`),this.type=l}setUniform(e,i,l,h,p){i.set(e,p,h.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new sw(e):new qf(e)}}class au{constructor(e,i){this.uniformNames=i.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,l,h,p){const g=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;g&&i.set(e,p,g)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new ow(e):new qf(e)}}class Ys{constructor(e,i,l,h){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,l,h,p,g){const x=this.paintVertexArray.length,w=this.expression.evaluate(new P(0),i,{},p,h,g);this.paintVertexArray.resize(e),this._setPaintValue(x,e,w)}updatePaintArray(e,i,l,h,p){const g=this.expression.evaluate({zoom:0},l,h,void 0,p);this._setPaintValue(e,i,g)}_setPaintValue(e,i,l){if(this.type==="color"){const h=b_(l);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xo{constructor(e,i,l,h,p,g){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,l,h,p,g){const x=this.expression.evaluate(new P(this.zoom),i,{},p,h,g),w=this.expression.evaluate(new P(this.zoom+1),i,{},p,h,g),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,x,w)}updatePaintArray(e,i,l,h,p){const g=this.expression.evaluate({zoom:this.zoom},l,h,void 0,p),x=this.expression.evaluate({zoom:this.zoom+1},l,h,void 0,p);this._setPaintValue(e,i,g,x)}_setPaintValue(e,i,l,h){if(this.type==="color"){const p=b_(l),g=b_(h);for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,p[0],p[1],g[0],g[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,l,h,p){const g=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,x=Ge(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(e,p,x)}getBinding(e,i){return new qf(e)}}class Ba{constructor(e,i,l,h,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(l==="array"?Xs:ys).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new h}populatePaintArray(e,i,l){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(e,i,l,h,p,g){this._setPaintValues(e,i,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(e,i,l,h){if(!h||!l)return;const p=h[l];if(!p)return;const{tl:g,br:x,pixelRatio:w}=p;for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,g[0],g[1],x[0],x[1],w)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class La{constructor(e,i,l=()=>!0){this.binders={},this._buffers=[];const h=[];for(const p in e.paint._values){if(!l(p))continue;const g=e.paint.get(p);if(!(g instanceof re&&Ca(g.property.specification)))continue;const x=Iz(p,e.type),w=g.value,E=g.property.specification.type,I=!!g.property.useIntegerZoom,z=p==="line-dasharray"||p.endsWith("pattern"),D=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||D)if(w.kind==="source"||D||z){const F=aw(p,E,"source");this.binders[p]=z?new Ba(w,x,E,F,e.id):new Ys(w,x,E,F),h.push(`/a_${p}`)}else{const F=aw(p,E,"composite");this.binders[p]=new Xo(w,x,E,I,i,F),h.push(`/z_${p}`)}else this.binders[p]=z?new au(w.value,x):new fd(w.value,x,E),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Ys||i instanceof Xo?i.maxValue:0}populatePaintArrays(e,i,l,h,p,g){for(const x in this.binders){const w=this.binders[x];(w instanceof Ys||w instanceof Xo||w instanceof Ba)&&w.populatePaintArray(e,i,l,h,p,g)}}setConstantPatternPositions(e){for(const i in this.binders){const l=this.binders[i];l instanceof au&&l.setConstantPatternPositions(e)}}updatePaintArrays(e,i,l,h,p,g){let x=!1;for(const w in e){const E=i.getPositions(w);for(const I of E){const z=l.feature(I.index);for(const D in this.binders){const F=this.binders[D];if((F instanceof Ys||F instanceof Xo||F instanceof Ba)&&F.expression.isStateDependent===!0){const N=h.paint.get(D);F.expression=N.value,F.updatePaintArray(I.start,I.end,z,e[w],p,g),x=!0}}}}return x}defines(){const e=[];for(const i in this.binders){const l=this.binders[i];(l instanceof fd||l instanceof au)&&e.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof Ys||l instanceof Xo||l instanceof Ba)for(let h=0;h<l.paintVertexAttributes.length;h++)e.push(l.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof fd||l instanceof au||l instanceof Xo)for(const h of l.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof fd||h instanceof au||h instanceof Xo)for(const p of h.uniformNames)i.push({name:p,property:l,binding:h.getBinding(e,p)})}return i}setUniforms(e,i,l,h,p){for(const{name:g,property:x,binding:w}of l)this.binders[x].setUniform(e,w,p,h.get(x),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Ys||i instanceof Xo||i instanceof Ba)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const l=this.binders[i];(l instanceof Ys||l instanceof Xo||l instanceof Ba)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Ys||i instanceof Xo||i instanceof Ba)&&i.destroy()}}}class Xl{constructor(e,i,l=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new La(h,i,l);this.needsUpload=!1,this._featureMap=new $f,this._bufferOffset=0}populatePaintArrays(e,i,l,h,p,g,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,h,p,g,x);i.id!==void 0&&this._featureMap.add(i.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,l,h,p){for(const g of l)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,i,g,h,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Cz={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Iz(n,e){return Cz[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const kz={"line-pattern":{source:Me,composite:Me},"fill-pattern":{source:Me,composite:Me},"fill-extrusion-pattern":{source:Me,composite:Me},"line-dasharray":{source:He,composite:He}},Pz={color:{source:So,composite:nt},number:{source:Er,composite:So}};function aw(n,e,i){const l=kz[n];return l&&l[i]||Pz[e][i]}Et(fd,"ConstantBinder"),Et(au,"PatternConstantBinder"),Et(Ys,"SourceExpressionBinder"),Et(Ba,"PatternCompositeBinder"),Et(Xo,"CompositeExpressionBinder"),Et(La,"ProgramConfiguration",{omit:["_buffers"]}),Et(Xl,"ProgramConfigurationSet");const lw="-transition";class Ko extends wl{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new ne(i.layout)),i.paint)){this._transitionablePaint=new W(i.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ie(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,l={}){i!=null&&this._validate(f_,`layers.${this.id}.layout.${e}`,e,i,l)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return cr(e,lw)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,l={}){if(i!=null&&this._validate(p_,`layers.${this.id}.paint.${e}`,e,i,l))return!1;if(cr(e,lw))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const h=this._transitionablePaint._values[e],p=h.value.isDataDriven(),g=h.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value,w=x.isDataDriven(),E=cr(e,"pattern")||e==="line-dasharray";return w||p||E||this._handleOverridablePaintPropertyUpdate(e,g,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),li(e,(i,l)=>!(i===void 0||l==="layout"&&!Object.keys(i).length||l==="paint"&&!Object.keys(i).length))}_validate(e,i,l,h,p={}){return(!p||p.validate!==!1)&&Nf(this,e.call(Of,{key:i,layerType:this.type,objectKey:l,value:h,styleSpec:We,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof re&&Ca(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=tu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const zz=Ce([{name:"a_pos",components:2,type:"Int16"}],4),Dz=Ce([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class cn{constructor(e=[]){this.segments=e}prepareSegment(e,i,l,h){let p=this.segments[this.segments.length-1];return e>cn.MAX_VERTEX_ARRAY_LENGTH&&gr(`Max vertices per segment is ${cn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>cn.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:i.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,l,h){return new cn([{vertexOffset:e,primitiveOffset:i,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}cn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et(cn,"SegmentVector");var Mt=8192;class Fa{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Tr?new Tr(e.lng,e.lat):Tr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Tr?new Tr(e.lng,e.lat):Tr.convert(e),this}extend(e){const i=this._sw,l=this._ne;let h,p;if(e instanceof Tr)h=e,p=e;else{if(!(e instanceof Fa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Fa.convert(e)):this.extend(Tr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Tr.convert(e)):this;if(h=e._sw,p=e._ne,!h||!p)return this}return i||l?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new Tr(h.lng,h.lat),this._ne=new Tr(p.lng,p.lat)),this}getCenter(){return new Tr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Tr(this.getWest(),this.getNorth())}getSouthEast(){return new Tr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=Tr.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){return!e||e instanceof Fa?e:new Fa(e)}}var Gf=1e-6,Fi=typeof Float32Array<"u"?Float32Array:Array;function cw(){var n=new Fi(9);return Fi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function uw(n,e,i){var l=e[0],h=e[1],p=e[2],g=e[3],x=e[4],w=e[5],E=e[6],I=e[7],z=e[8],D=i[0],F=i[1],N=i[2],G=i[3],Q=i[4],oe=i[5],fe=i[6],se=i[7],he=i[8];return n[0]=D*l+F*g+N*E,n[1]=D*h+F*x+N*I,n[2]=D*p+F*w+N*z,n[3]=G*l+Q*g+oe*E,n[4]=G*h+Q*x+oe*I,n[5]=G*p+Q*w+oe*z,n[6]=fe*l+se*g+he*E,n[7]=fe*h+se*x+he*I,n[8]=fe*p+se*w+he*z,n}function Yo(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function w_(n,e){var i=e[0],l=e[1],h=e[2],p=e[3],g=e[4],x=e[5],w=e[6],E=e[7],I=e[8],z=e[9],D=e[10],F=e[11],N=e[12],G=e[13],Q=e[14],oe=e[15],fe=i*x-l*g,se=i*w-h*g,he=i*E-p*g,ge=l*w-h*x,me=l*E-p*x,Be=h*E-p*w,De=I*G-z*N,qe=I*Q-D*N,ot=I*oe-F*N,Oe=z*Q-D*G,Ke=z*oe-F*G,Ye=D*oe-F*Q,rt=fe*Ye-se*Ke+he*Oe+ge*ot-me*qe+Be*De;return rt?(n[0]=(x*Ye-w*Ke+E*Oe)*(rt=1/rt),n[1]=(h*Ke-l*Ye-p*Oe)*rt,n[2]=(G*Be-Q*me+oe*ge)*rt,n[3]=(D*me-z*Be-F*ge)*rt,n[4]=(w*ot-g*Ye-E*qe)*rt,n[5]=(i*Ye-h*ot+p*qe)*rt,n[6]=(Q*he-N*Be-oe*se)*rt,n[7]=(I*Be-D*he+F*se)*rt,n[8]=(g*Ke-x*ot+E*De)*rt,n[9]=(l*ot-i*Ke-p*De)*rt,n[10]=(N*me-G*he+oe*fe)*rt,n[11]=(z*he-I*me-F*fe)*rt,n[12]=(x*qe-g*Oe-w*De)*rt,n[13]=(i*Oe-l*qe+h*De)*rt,n[14]=(G*se-N*ge-Q*fe)*rt,n[15]=(I*ge-z*se+D*fe)*rt,n):null}function Kl(n,e,i){var l=e[0],h=e[1],p=e[2],g=e[3],x=e[4],w=e[5],E=e[6],I=e[7],z=e[8],D=e[9],F=e[10],N=e[11],G=e[12],Q=e[13],oe=e[14],fe=e[15],se=i[0],he=i[1],ge=i[2],me=i[3];return n[0]=se*l+he*x+ge*z+me*G,n[1]=se*h+he*w+ge*D+me*Q,n[2]=se*p+he*E+ge*F+me*oe,n[3]=se*g+he*I+ge*N+me*fe,n[4]=(se=i[4])*l+(he=i[5])*x+(ge=i[6])*z+(me=i[7])*G,n[5]=se*h+he*w+ge*D+me*Q,n[6]=se*p+he*E+ge*F+me*oe,n[7]=se*g+he*I+ge*N+me*fe,n[8]=(se=i[8])*l+(he=i[9])*x+(ge=i[10])*z+(me=i[11])*G,n[9]=se*h+he*w+ge*D+me*Q,n[10]=se*p+he*E+ge*F+me*oe,n[11]=se*g+he*I+ge*N+me*fe,n[12]=(se=i[12])*l+(he=i[13])*x+(ge=i[14])*z+(me=i[15])*G,n[13]=se*h+he*w+ge*D+me*Q,n[14]=se*p+he*E+ge*F+me*oe,n[15]=se*g+he*I+ge*N+me*fe,n}function md(n,e,i){var l,h,p,g,x,w,E,I,z,D,F,N,G=i[0],Q=i[1],oe=i[2];return e===n?(n[12]=e[0]*G+e[4]*Q+e[8]*oe+e[12],n[13]=e[1]*G+e[5]*Q+e[9]*oe+e[13],n[14]=e[2]*G+e[6]*Q+e[10]*oe+e[14],n[15]=e[3]*G+e[7]*Q+e[11]*oe+e[15]):(h=e[1],p=e[2],g=e[3],x=e[4],w=e[5],E=e[6],I=e[7],z=e[8],D=e[9],F=e[10],N=e[11],n[0]=l=e[0],n[1]=h,n[2]=p,n[3]=g,n[4]=x,n[5]=w,n[6]=E,n[7]=I,n[8]=z,n[9]=D,n[10]=F,n[11]=N,n[12]=l*G+x*Q+z*oe+e[12],n[13]=h*G+w*Q+D*oe+e[13],n[14]=p*G+E*Q+F*oe+e[14],n[15]=g*G+I*Q+N*oe+e[15]),n}function Yl(n,e,i){var l=i[0],h=i[1],p=i[2];return n[0]=e[0]*l,n[1]=e[1]*l,n[2]=e[2]*l,n[3]=e[3]*l,n[4]=e[4]*h,n[5]=e[5]*h,n[6]=e[6]*h,n[7]=e[7]*h,n[8]=e[8]*p,n[9]=e[9]*p,n[10]=e[10]*p,n[11]=e[11]*p,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function E_(n,e,i){var l=Math.sin(i),h=Math.cos(i),p=e[4],g=e[5],x=e[6],w=e[7],E=e[8],I=e[9],z=e[10],D=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=p*h+E*l,n[5]=g*h+I*l,n[6]=x*h+z*l,n[7]=w*h+D*l,n[8]=E*h-p*l,n[9]=I*h-g*l,n[10]=z*h-x*l,n[11]=D*h-w*l,n}function Hf(n,e,i){var l=Math.sin(i),h=Math.cos(i),p=e[0],g=e[1],x=e[2],w=e[3],E=e[8],I=e[9],z=e[10],D=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*h-E*l,n[1]=g*h-I*l,n[2]=x*h-z*l,n[3]=w*h-D*l,n[8]=p*l+E*h,n[9]=g*l+I*h,n[10]=x*l+z*h,n[11]=w*l+D*h,n}function hw(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function dw(n,e,i){var l,h,p,g=i[0],x=i[1],w=i[2],E=Math.hypot(g,x,w);return E<Gf?null:(g*=E=1/E,x*=E,w*=E,l=Math.sin(e),h=Math.cos(e),n[0]=g*g*(p=1-h)+h,n[1]=x*g*p+w*l,n[2]=w*g*p-x*l,n[3]=0,n[4]=g*x*p-w*l,n[5]=x*x*p+h,n[6]=w*x*p+g*l,n[7]=0,n[8]=g*w*p+x*l,n[9]=x*w*p-g*l,n[10]=w*w*p+h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Mz=Kl;function S_(){var n=new Fi(3);return Fi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function pw(n){var e=new Fi(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function gd(n){return Math.hypot(n[0],n[1],n[2])}function lu(n,e,i){var l=new Fi(3);return l[0]=n,l[1]=e,l[2]=i,l}function Js(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function A_(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function fw(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function _d(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function yd(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function ro(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function xd(n,e,i,l){return n[0]=e[0]+i[0]*l,n[1]=e[1]+i[1]*l,n[2]=e[2]+i[2]*l,n}function di(n,e){var i=e[0],l=e[1],h=e[2],p=i*i+l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),n[0]=e[0]*p,n[1]=e[1]*p,n[2]=e[2]*p,n}function Ao(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function T_(n,e,i){var l=e[0],h=e[1],p=e[2],g=i[0],x=i[1],w=i[2];return n[0]=h*w-p*x,n[1]=p*g-l*w,n[2]=l*x-h*g,n}function nn(n,e,i){var l=e[0],h=e[1],p=e[2],g=i[3]*l+i[7]*h+i[11]*p+i[15];return n[0]=(i[0]*l+i[4]*h+i[8]*p+i[12])/(g=g||1),n[1]=(i[1]*l+i[5]*h+i[9]*p+i[13])/g,n[2]=(i[2]*l+i[6]*h+i[10]*p+i[14])/g,n}function mw(n,e,i){var l=i[0],h=i[1],p=i[2],g=e[0],x=e[1],w=e[2],E=h*w-p*x,I=p*g-l*w,z=l*x-h*g,D=h*z-p*I,F=p*E-l*z,N=l*I-h*E,G=2*i[3];return I*=G,z*=G,F*=2,N*=2,n[0]=g+(E*=G)+(D*=2),n[1]=x+I+F,n[2]=w+z+N,n}var vd,Jo=A_,Rz=fw,Bz=gd;function gw(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function _w(n,e){var i=e[0],l=e[1],h=e[2],p=e[3],g=i*i+l*l+h*h+p*p;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=l*g,n[2]=h*g,n[3]=p*g,n}function Jl(n,e,i){var l=e[0],h=e[1],p=e[2],g=e[3];return n[0]=i[0]*l+i[4]*h+i[8]*p+i[12]*g,n[1]=i[1]*l+i[5]*h+i[9]*p+i[13]*g,n[2]=i[2]*l+i[6]*h+i[10]*p+i[14]*g,n[3]=i[3]*l+i[7]*h+i[11]*p+i[15]*g,n}function yw(){var n=new Fi(4);return Fi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function xw(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function vw(n,e,i){i*=.5;var l=e[0],h=e[1],p=e[2],g=e[3],x=Math.sin(i),w=Math.cos(i);return n[0]=l*w+g*x,n[1]=h*w+p*x,n[2]=p*w-h*x,n[3]=g*w-l*x,n}function bw(n,e,i){i*=.5;var l=e[0],h=e[1],p=e[2],g=e[3],x=Math.sin(i),w=Math.cos(i);return n[0]=l*w-p*x,n[1]=h*w+g*x,n[2]=p*w+l*x,n[3]=g*w-h*x,n}S_(),vd=new Fi(4),Fi!=Float32Array&&(vd[0]=0,vd[1]=0,vd[2]=0,vd[3]=0);var Lz=_w;S_(),lu(1,0,0),lu(0,1,0),yw(),yw(),cw();const Fz=Ce([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ww}=Fz,Ew=Ce([{name:"a_pos_3",components:3,type:"Int16"}]);var bd=Ce([{name:"a_pos",type:"Int16",components:2}]);class C_{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const h=Ao(i,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return l[0]=this.pos[0]+this.dir[0]*p,l[1]=this.pos[1]+this.dir[1]*p,l[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,l){if(function(F,N){var G=F[0],Q=F[1],oe=F[2],fe=N[0],se=N[1],he=N[2];return Math.abs(G-fe)<=Gf*Math.max(1,Math.abs(G),Math.abs(fe))&&Math.abs(Q-se)<=Gf*Math.max(1,Math.abs(Q),Math.abs(se))&&Math.abs(oe-he)<=Gf*Math.max(1,Math.abs(oe),Math.abs(he))}(this.pos,e)||i===0)return l[0]=l[1]=l[2]=0,!1;const[h,p,g]=this.dir,x=this.pos[0]-e[0],w=this.pos[1]-e[1],E=this.pos[2]-e[2],I=h*h+p*p+g*g,z=2*(x*h+w*p+E*g),D=z*z-4*I*(x*x+w*w+E*E-i*i);if(D<0){const F=Math.max(-z/2,0),N=x+h*F,G=w+p*F,Q=E+g*F,oe=Math.hypot(N,G,Q);return l[0]=N*i/oe,l[1]=G*i/oe,l[2]=Q*i/oe,!1}{const F=(-z-Math.sqrt(D))/(2*I);if(F<0){const N=Math.hypot(x,w,E);return l[0]=x*i/N,l[1]=w*i/N,l[2]=E*i/N,!1}return l[0]=x+h*F,l[1]=w+p*F,l[2]=E+g*F,!0}}}class I_{constructor(e,i,l,h,p){this.TL=e,this.TR=i,this.BR=l,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(e,i,l){const h=[-1,1,1],p=[1,1,1],g=[1,-1,1],x=[-1,-1,1],w=nn(h,h,e),E=nn(p,p,e),I=nn(g,g,e),z=nn(x,x,e);return new I_(w,E,I,z,i/l)}}class k_{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,l,h){const p=Math.pow(2,l),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=Jl([],w,e),I=1/E[3]/i*p;return function(z,D,F){return z[0]=D[0]*F[0],z[1]=D[1]*F[1],z[2]=D[2]*F[2],z[3]=D[3]*F[3],z}(E,E,[I,I,h?1/E[3]:I,I])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=di([],T_([],Jo([],g[w[0]],g[w[1]]),Jo([],g[w[2]],g[w[1]]))),I=-Ao(E,g[w[1]]);return E.concat(I)});return new k_(g,x)}}class pi{static fromPoints(e){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const h of e)_d(i,i,h),yd(l,l,h);return new pi(i,l)}static applyTransform(e,i){const l=e.getCorners();for(let h=0;h<l.length;++h)nn(l[h],l[h],i);return pi.fromPoints(l)}constructor(e,i){this.min=e,this.max=i,this.center=ro([],Js([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=pw(this.min),h=pw(this.max);for(let p=0;p<i.length;p++)l[p]=i[p]?this.min[p]:this.center[p],h[p]=i[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new pi(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let l=!0;for(let h=0;h<e.planes.length;h++){const p=e.planes[h];let g=0;for(let x=0;x<i.length;x++)g+=Ao(p,i[x])+p[3]>=0;if(g===0)return 0;g!==i.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let p=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const w=e.points[x][h]-this.min[h];p=Math.min(p,w),g=Math.max(g,w)}if(g<0||p>this.max[h]-this.min[h])return 0}return 1}}const P_=5,Sw=6,xs=Mt/Math.PI/2,Oz=16383,Ql=64,wd=[Ql,32,16],To=-xs,Co=xs,Nz=[new pi([To,To,To],[Co,Co,Co]),new pi([To,To,To],[0,0,Co]),new pi([0,To,To],[Co,0,Co]),new pi([To,0,To],[0,Co,Co]),new pi([0,0,To],[Co,Co,Co])];function Zf(n){return n*xs/Ad}function Aw(n,e,i,l=!0){const h=ro([],n._camera.position,n.worldSize),p=[e,i,1,1];Jl(p,p,n.pixelMatrixInverse),gw(p,p,1/p[3]);const g=di([],Jo([],p,h)),x=n.globeMatrix,w=[x[12],x[13],x[14]],E=Jo([],w,h),I=gd(E),z=di([],E),D=n.worldSize/(2*Math.PI),F=Ao(z,g),N=Math.asin(D/I);if(N<Math.acos(F)){if(!l)return null;const ot=[],Oe=[];ro(ot,g,I/F),di(Oe,Jo(Oe,ot,E)),di(g,Js(g,E,ro(g,Oe,Math.tan(N)*I)))}const G=[];new C_(h,g).closestPointOnSphere(w,D,G);const Q=di([],On(x,0)),oe=di([],On(x,1)),fe=di([],On(x,2)),se=Ao(Q,G),he=Ao(oe,G),ge=Ao(fe,G),me=je(Math.asin(-he/D));let Be=je(Math.atan2(se,ge));Be=n.center.lng+function(ot,Oe){const Ke=(Oe-ot+180)%360-180;return Ke<-180?Ke+360:Ke}(n.center.lng,Be);const De=bs(Be),qe=Ge(ws(me),0,1);return new du(De,qe)}class Uz{constructor(e,i,l){this.a=Jo([],e,l),this.b=Jo([],i,l),this.center=l;const h=di([],this.a),p=di([],this.b);this.angle=Math.acos(Ao(h,p))}}function z_(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(l,h,p,g){const x=Math.sin(p);return l*(Math.sin((1-g)*p)/x)+h*(Math.sin(g*p)/x)}(n.a[e],n.b[e],n.angle,Ge(i,0,1))+n.center[e]}function vs(n){if(n.z<=1)return Nz[n.z+2*n.y+n.x];const e=D_(Xf(n));return pi.fromPoints(e)}function ec(n,e,i){return ro(n,n,1-i),xd(n,n,e,i)}function Tw(n,e){const i=hu(e.zoom);if(i===0)return vs(n);const l=Xf(n),h=D_(l),p=bs(l.getWest())*e.worldSize,g=bs(l.getEast())*e.worldSize,x=ws(l.getNorth())*e.worldSize,w=ws(l.getSouth())*e.worldSize,E=[p,x,0],I=[g,x,0],z=[p,w,0],D=[g,w,0],F=w_([],e.globeMatrix);return nn(E,E,F),nn(I,I,F),nn(z,z,F),nn(D,D,F),h[0]=ec(h[0],z,i),h[1]=ec(h[1],D,i),h[2]=ec(h[2],I,i),h[3]=ec(h[3],E,i),pi.fromPoints(h)}function Cw(n,e,i){for(const l of n)nn(l,l,e),ro(l,l,i)}function Vz(n,e,i){const l=e/n.worldSize,h=n.globeMatrix;if(i.z<=1){const De=vs(i).getCorners();return Cw(De,h,l),pi.fromPoints(De)}const p=Xf(i),g=D_(p);Cw(g,h,l);const x=Number.MAX_VALUE,w=[-x,-x,-x],E=[x,x,x];if(p.contains(n.center)){for(const ot of g)_d(E,E,ot),yd(w,w,ot);w[2]=0;const De=n.point,qe=[De.x*l,De.y*l,0];return _d(E,E,qe),yd(w,w,qe),new pi(E,w)}const I=[h[12]*l,h[13]*l,h[14]*l],z=p.getCenter(),D=Ge(n.center.lat,-Kn,Kn),F=Ge(z.lat,-Kn,Kn),N=bs(n.center.lng),G=ws(D);let Q=N-bs(z.lng);const oe=G-ws(F);Q>.5?Q-=1:Q<-.5&&(Q+=1);let fe=0;Math.abs(Q)>Math.abs(oe)?fe=Q>=0?1:3:(fe=oe>=0?0:2,xd(I,I,[h[4]*l,h[5]*l,h[6]*l],-Math.sin(Ue(oe>=0?p.getSouth():p.getNorth()))*xs));const se=g[fe],he=g[(fe+1)%4],ge=new Uz(se,he,I),me=[z_(ge,0)||se[0],z_(ge,1)||se[1],z_(ge,2)||se[2]],Be=hu(n.zoom);if(Be>0){const De=function({x:ot,y:Oe,z:Ke},Ye,rt,ut,$e){const mt=1/(1<<Ke);let Tt=ot*mt,_t=Tt+mt,$t=Oe*mt,ht=$t+mt,Pt=0;const Wt=(Tt+_t)/2-ut;return Wt>.5?Pt=-1:Wt<-.5&&(Pt=1),Tt=((Tt+Pt)*Ye-(ut*=Ye))*rt+ut,_t=((_t+Pt)*Ye-ut)*rt+ut,$t=($t*Ye-($e*=Ye))*rt+$e,ht=(ht*Ye-$e)*rt+$e,[[Tt,ht,0],[_t,ht,0],[_t,$t,0],[Tt,$t,0]]}(i,e,n._pixelsPerMercatorPixel,N,G);for(let ot=0;ot<g.length;ot++)ec(g[ot],De[ot],Be);const qe=Js([],De[fe],De[(fe+1)%4]);ro(qe,qe,.5),ec(me,qe,Be)}for(const De of g)_d(E,E,De),yd(w,w,De);return E[2]=Math.min(se[2],he[2]),_d(E,E,me),yd(w,w,me),new pi(E,w)}function Xf({x:n,y:e,z:i}){const l=1/(1<<i),h=new Tr(no(n*l),Xn((e+1)*l)),p=new Tr(no((n+1)*l),Xn(e*l));return new Fa(h,p)}function D_(n){const e=Ue(n.getNorth()),i=Ue(n.getSouth()),l=Math.cos(e),h=Math.cos(i),p=Math.sin(e),g=Math.sin(i),x=n.getWest(),w=n.getEast();return[cu(h,g,x),cu(h,g,w),cu(l,p,w),cu(l,p,x)]}function cu(n,e,i,l=xs){return i=Ue(i),[n*Math.sin(i)*l,-e*l,n*Math.cos(i)*l]}function uu(n,e,i){return cu(Math.cos(Ue(n)),Math.sin(Ue(n)),e,i)}function Ed(n,e,i,l){const h=1<<i.z,p=(n/Mt+i.x)/h;return uu(Xn((e/Mt+i.y)/h),no(p),l)}function Kf({min:n,max:e}){return Oz/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Iw=new Float64Array(16);function Sd(n){const e=Kf(n),i=hw(Iw,[e,e,e]);return md(i,i,((l=[])[0]=-(h=n.min)[0],l[1]=-h[1],l[2]=-h[2],l));var l,h}function M_(n){const e=(l=n.min,(i=Iw)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=l[0],i[13]=l[1],i[14]=l[2],i[15]=1,i);var i,l;const h=1/Kf(n);return Yl(e,e,[h,h,h])}function kw(n,e,i,l,h){const p=function(w){const E=Mt/(2*Math.PI);return w/(2*Math.PI)/E}(i),g=[n,e,-i/(2*Math.PI)],x=Yo(new Float64Array(16));return md(x,x,g),Yl(x,x,[p,p,p]),E_(x,x,Ue(-h)),Hf(x,x,Ue(-l)),x}function hu(n){return St(P_,Sw,n)}function Pw(n,e){const i=uu(e.lat,e.lng),l=function(N){const G=uu(N._center.lat,N._center.lng);let Q=T_([],lu(0,1,0),G);const oe=dw([],-N.angle,G);Q=nn(Q,Q,oe),dw(oe,-N._pitch,Q);const fe=di([],G);return ro(fe,fe,Zf(N.cameraToCenterDistance/N.pixelsPerMeter)),nn(fe,fe,oe),Js([],G,fe)}(n);return g=(h=A_([],l,i))[0],x=h[1],w=h[2],E=(p=i)[0],I=p[1],z=p[2],F=(D=Math.sqrt(g*g+x*x+w*w)*Math.sqrt(E*E+I*I+z*z))&&Ao(h,p)/D,Math.acos(Math.min(Math.max(F,-1),1));var h,p,g,x,w,E,I,z,D,F}function R_(n,e){return Pw(n,e)>Math.PI/2*1.01}const zw=Ue(85),jz=Math.cos(zw),$z=Math.sin(zw),Ad=63710088e-1,Dw=2*Math.PI*Ad;class Oa{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oa(ft(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,l=this.lat*i,h=e.lat*i,p=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return Ad*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new Fa(new Oa(this.lng-l,this.lat-i),new Oa(this.lng+l,this.lat+i))}toEcef(e){const i=Zf(e);return uu(this.lat,this.lng,xs+i)}static convert(e){if(e instanceof Oa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Oa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Oa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Tr=Oa;function B_(n){return Dw*Math.cos(n*Math.PI/180)}function bs(n){return(180+n)/360}function ws(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Qo(n,e){return n/B_(e)}function no(n){return 360*n-180}function Xn(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Mw(n,e){return n*B_(Xn(e))}const Kn=85.051129;function Rw(n){return 1/Math.cos(n*Math.PI/180)}class du{constructor(e,i,l=0){this.x=+e,this.y=+i,this.z=+l}static fromLngLat(e,i=0){const l=Tr.convert(e);return new du(bs(l.lng),ws(l.lat),Qo(i,l.lat))}toLngLat(){return new Tr(no(this.x),Xn(this.y))}toAltitude(){return Mw(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Dw*Rw(Xn(this.y))}}function L_(n,e,i,l,h,p,g,x,w){const E=(e+l)/2,I=(i+h)/2,z=new Se(E,I);x(z),function(D,F,N,G,Q,oe){const fe=N-Q,se=G-oe;return Math.abs((G-F)*fe-(N-D)*se)/Math.hypot(fe,se)}(z.x,z.y,p.x,p.y,g.x,g.y)>=w?(L_(n,e,i,E,I,p,z,x,w),L_(n,E,I,l,h,z,g,x,w)):n.push(g)}function Bw(n,e,i){let l=n[0],h=l.x,p=l.y;e(l);const g=[l];for(let x=1;x<n.length;x++){const w=n[x],{x:E,y:I}=w;e(w),L_(g,h,p,E,I,l,w,e,i),h=E,p=I,l=w}return g}function F_(n,e,i,l){if(l(e,i)){const h=e.add(i)._mult(.5);F_(n,e,h,l),F_(n,h,i,l)}else n.push(i)}function Wz(n,e){let i=n[0];const l=[i];for(let h=1;h<n.length;h++){const p=n[h];F_(l,i,p,e),i=p}return l}const O_=Math.pow(2,14)-1,Lw=-O_-1;function qz(n,e){const i=Math.round(n.x*e),l=Math.round(n.y*e);return n.x=Ge(i,Lw,O_),n.y=Ge(l,Lw,O_),(i<n.x||i>n.x+1||l<n.y||l>n.y+1)&&gr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Qs(n,e,i){const l=n.loadGeometry(),h=n.extent,p=Mt/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:x,x:w,y:E,projection:I}=i,z=D=>{const F=no((e.x+D.x/h)/g),N=Xn((e.y+D.y/h)/g),G=I.project(F,N);D.x=(G.x*x-w)*h,D.y=(G.y*x-E)*h};for(let D=0;D<l.length;D++)if(n.type!==1)l[D]=Bw(l[D],z,1);else{const F=[];for(const N of l[D])N.x<0||N.x>=h||N.y<0||N.y>=h||(z(N),F.push(N));l[D]=F}}for(const g of l)for(const x of g)qz(x,p);return l}function tc(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Qs(n):[]}}function Yf(n,e,i,l,h){n.emplaceBack(2*e+(l+1)/2,2*i+(h+1)/2)}function Jf(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class N_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new it,this.indexArray=new It,this.segments=new cn,this.programConfigurations=new Xl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,l,h){const p=this.layers[0],g=[];let x=null;p.type==="circle"&&(x=p.layout.get("circle-sort-key"));for(const{feature:E,id:I,index:z,sourceLayerIndex:D}of e){const F=this.layers[0]._featureFilter.needGeometry,N=tc(E,F);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),N,l))continue;const G=x?x.evaluate(N,{},l):void 0,Q={id:I,properties:E.properties,type:E.type,sourceLayerIndex:D,index:z,geometry:F?N.geometry:Qs(E,l,h),patterns:{},sortKey:G};g.push(Q)}x&&g.sort((E,I)=>E.sortKey-I.sortKey);let w=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new at,w=h.projection);for(const E of g){const{geometry:I,index:z,sourceLayerIndex:D}=E,F=e[z].feature;this.addFeature(E,I,z,i.availableImages,l,w),i.featureIndex.insert(F,I,z,D,this.index)}}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Dz.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,l,h,p,g){for(const x of i)for(const w of x){const E=w.x,I=w.y;if(E<0||E>=Mt||I<0||I>=Mt)continue;if(g){const F=g.projectTilePoint(E,I,p),N=g.upVector(p,E,I),G=this.globeExtVertexArray;Jf(G,F,N),Jf(G,F,N),Jf(G,F,N),Jf(G,F,N)}const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),D=z.vertexLength;Yf(this.layoutVertexArray,E,I,-1,-1),Yf(this.layoutVertexArray,E,I,1,-1),Yf(this.layoutVertexArray,E,I,1,1),Yf(this.layoutVertexArray,E,I,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},h,p)}}function Fw(n,e){for(let i=0;i<n.length;i++)if(rc(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(rc(n,e[i]))return!0;return!!U_(n,e)}function Gz(n,e,i){return!!rc(n,e)||!!V_(e,n,i)}function Ow(n,e){if(n.length===1)return Uw(e,n[0]);for(let i=0;i<e.length;i++){const l=e[i];for(let h=0;h<l.length;h++)if(rc(n,l[h]))return!0}for(let i=0;i<n.length;i++)if(Uw(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(U_(n,e[i]))return!0;return!1}function Hz(n,e,i){if(n.length>1){if(U_(n,e))return!0;for(let l=0;l<e.length;l++)if(V_(e[l],n,i))return!0}for(let l=0;l<n.length;l++)if(V_(n[l],e,i))return!0;return!1}function U_(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const l=n[i],h=n[i+1];for(let p=0;p<e.length-1;p++)if(Zz(l,h,e[p],e[p+1]))return!0}return!1}function Zz(n,e,i,l){return An(n,i,l)!==An(e,i,l)&&An(n,e,i)!==An(n,e,l)}function V_(n,e,i){const l=i*i;if(e.length===1)return n.distSqr(e[0])<l;for(let h=1;h<e.length;h++)if(Nw(n,e[h-1],e[h])<l)return!0;return!1}function Nw(n,e,i){const l=e.distSqr(i);if(l===0)return n.distSqr(e);const h=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/l;return n.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function Uw(n,e){let i,l,h,p=!1;for(let g=0;g<n.length;g++){i=n[g];for(let x=0,w=i.length-1;x<i.length;w=x++)l=i[x],h=i[w],l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(p=!p)}return p}function rc(n,e){let i=!1;for(let l=0,h=n.length-1;l<n.length;h=l++){const p=n[l],g=n[h];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(i=!i)}return i}function Vw(n,e,i,l,h){for(const g of n)if(e<=g.x&&i<=g.y&&l>=g.x&&h>=g.y)return!0;const p=[new Se(e,i),new Se(e,h),new Se(l,h),new Se(l,i)];if(n.length>2){for(const g of p)if(rc(n,g))return!0}for(let g=0;g<n.length-1;g++)if(Xz(n[g],n[g+1],p))return!0;return!1}function Xz(n,e,i){const l=i[0],h=i[2];if(n.x<l.x&&e.x<l.x||n.x>h.x&&e.x>h.x||n.y<l.y&&e.y<l.y||n.y>h.y&&e.y>h.y)return!1;const p=An(n,e,i[0]);return p!==An(n,e,i[1])||p!==An(n,e,i[2])||p!==An(n,e,i[3])}function pu(n,e,i){const l=e.paint.get(n).value;return l.kind==="constant"?l.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Qf(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function jw(n,e,i,l,h){if(!e[0]&&!e[1])return n;const p=Se.convert(e)._mult(h);i==="viewport"&&p._rotate(-l);const g=[];for(let x=0;x<n.length;x++)g.push(n[x].sub(p));return g}function $w(n,e,i,l){const h=Se.convert(n)._mult(l);return e==="viewport"&&h._rotate(-i),h}Et(N_,"CircleBucket",{omit:["layers"]});const Kz=new ce({"circle-sort-key":new ee(We.layout_circle["circle-sort-key"])});var Yz={paint:new ce({"circle-radius":new ee(We.paint_circle["circle-radius"]),"circle-color":new ee(We.paint_circle["circle-color"]),"circle-blur":new ee(We.paint_circle["circle-blur"]),"circle-opacity":new ee(We.paint_circle["circle-opacity"]),"circle-translate":new q(We.paint_circle["circle-translate"]),"circle-translate-anchor":new q(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new q(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new q(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ee(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ee(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ee(We.paint_circle["circle-stroke-opacity"])}),layout:Kz};function Ww(n,e,i,l,h,p,g,x,w){if(p&&n.queryGeometry.isAboveHorizon)return!1;p&&(w*=n.pixelToTileUnitsFactor);const E=n.tileID.canonical,I=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const z of e)for(const D of z){const F=D.add(x),N=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(F.x,F.y,!0):0,G=i.projection.projectTilePoint(F.x,F.y,E);if(N>0){const se=i.projection.upVector(E,F.x,F.y);G.x+=se[0]*I*N,G.y+=se[1]*I*N,G.z+=se[2]*I*N}const Q=p?F:Jz(G.x,G.y,G.z,l),oe=p?n.tilespaceRays.map(se=>e4(se,N)):n.queryGeometry.screenGeometry,fe=Jl([],[G.x,G.y,G.z,1],l);if(!g&&p?w*=fe[3]/i.cameraToCenterDistance:g&&!p&&(w*=i.cameraToCenterDistance/fe[3]),p){const se=Xn((D.y/Mt+E.y)/(1<<E.z));w/=i.projection.pixelsPerMeter(se,1)/Qo(1,se)}if(Gz(oe,Q,w))return!0}return!1}function Jz(n,e,i,l){const h=Jl([],[n,e,i,1],l);return new Se(h[0]/h[3],h[1]/h[3])}const qw=lu(0,0,0),Qz=lu(0,0,1);function e4(n,e){const i=S_();return qw[2]=e,n.intersectsPlane(qw,Qz,i),new Se(i[0],i[1])}class Gw extends N_{}function Hw(n,{width:e,height:i},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*l);return n.width=e,n.height=i,n.data=h,n}function Zw(n,e,i){const{width:l,height:h}=e;l===n.width&&h===n.height||(j_(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,l),height:Math.min(n.height,h)},i),n.width=l,n.height=h,n.data=e.data)}function j_(n,e,i,l,h,p){if(h.width===0||h.height===0)return e;if(h.width>n.width||h.height>n.height||i.x>n.width-h.width||i.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||l.x>e.width-h.width||l.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,x=e.data;for(let w=0;w<h.height;w++){const E=((i.y+w)*n.width+i.x)*p,I=((l.y+w)*e.width+l.x)*p;for(let z=0;z<h.width*p;z++)x[I+z]=g[E+z]}return e}Et(Gw,"HeatmapBucket",{omit:["layers"]});class ea{constructor(e,i){Hw(this,e,1,i)}resize(e){Zw(this,new ea(e),1)}clone(){return new ea({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,h,p){j_(e,i,l,h,p,1)}}class Oi{constructor(e,i){Hw(this,e,4,i)}resize(e){Zw(this,new Oi(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Oi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,h,p){j_(e,i,l,h,p,4)}}Et(ea,"AlphaImage"),Et(Oi,"RGBAImage");var t4={paint:new ce({"heatmap-radius":new ee(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ee(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new q(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ae(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new q(We.paint_heatmap["heatmap-opacity"])})};function $_(n){const e={},i=n.resolution||256,l=n.clips?n.clips.length:1,h=n.image||new Oi({width:i,height:l}),p=(g,x,w)=>{e[n.evaluationKey]=w;const E=n.expression.evaluate(e);h.data[g+x+0]=Math.floor(255*E.r/E.a),h.data[g+x+1]=Math.floor(255*E.g/E.a),h.data[g+x+2]=Math.floor(255*E.b/E.a),h.data[g+x+3]=Math.floor(255*E.a)};if(n.clips)for(let g=0,x=0;g<l;++g,x+=4*i)for(let w=0,E=0;w<i;w++,E+=4){const I=w/(i-1),{start:z,end:D}=n.clips[g];p(x,E,z*(1-I)+D*I)}else for(let g=0,x=0;g<i;g++,x+=4)p(0,x,g/(i-1));return h}var r4={paint:new ce({"hillshade-illumination-direction":new q(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new q(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new q(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new q(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new q(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new q(We.paint_hillshade["hillshade-accent-color"])})};const n4=Ce([{name:"a_pos",components:2,type:"Int16"}],4),{members:i4}=n4;var W_={exports:{}};function em(n,e,i){i=i||2;var l,h,p,g,x,w,E,I=e&&e.length,z=I?e[0]*i:n.length,D=Xw(n,0,z,i,!0),F=[];if(!D||D.next===D.prev)return F;if(I&&(D=function(G,Q,oe,fe){var se,he,ge,me=[];for(se=0,he=Q.length;se<he;se++)(ge=Xw(G,Q[se]*fe,se<he-1?Q[se+1]*fe:G.length,fe,!1))===ge.next&&(ge.steiner=!0),me.push(d4(ge));for(me.sort(c4),se=0;se<me.length;se++)oe=u4(me[se],oe);return oe}(n,e,D,i)),n.length>80*i){l=p=n[0],h=g=n[1];for(var N=i;N<z;N+=i)(x=n[N])<l&&(l=x),(w=n[N+1])<h&&(h=w),x>p&&(p=x),w>g&&(g=w);E=(E=Math.max(p-l,g-h))!==0?32767/E:0}return Td(D,F,i,l,h,E,0),F}function Xw(n,e,i,l,h){var p,g;if(h===H_(n,e,i,l)>0)for(p=e;p<i;p+=l)g=Jw(p,n[p],n[p+1],g);else for(p=i-l;p>=e;p-=l)g=Jw(p,n[p],n[p+1],g);return g&&tm(g,g.next)&&(Id(g),g=g.next),g}function nc(n,e){if(!n)return n;e||(e=n);var i,l=n;do if(i=!1,l.steiner||!tm(l,l.next)&&un(l.prev,l,l.next)!==0)l=l.next;else{if(Id(l),(l=e=l.prev)===l.next)break;i=!0}while(i||l!==e);return e}function Td(n,e,i,l,h,p,g){if(n){!g&&p&&function(I,z,D,F){var N=I;do N.z===0&&(N.z=q_(N.x,N.y,z,D,F)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==I);N.prevZ.nextZ=null,N.prevZ=null,function(G){var Q,oe,fe,se,he,ge,me,Be,De=1;do{for(oe=G,G=null,he=null,ge=0;oe;){for(ge++,fe=oe,me=0,Q=0;Q<De&&(me++,fe=fe.nextZ);Q++);for(Be=De;me>0||Be>0&&fe;)me!==0&&(Be===0||!fe||oe.z<=fe.z)?(se=oe,oe=oe.nextZ,me--):(se=fe,fe=fe.nextZ,Be--),he?he.nextZ=se:G=se,se.prevZ=he,he=se;oe=fe}he.nextZ=null,De*=2}while(ge>1)}(N)}(n,l,h,p);for(var x,w,E=n;n.prev!==n.next;)if(x=n.prev,w=n.next,p?s4(n,l,h,p):o4(n))e.push(x.i/i|0),e.push(n.i/i|0),e.push(w.i/i|0),Id(n),n=w.next,E=w.next;else if((n=w)===E){g?g===1?Td(n=a4(nc(n),e,i),e,i,l,h,p,2):g===2&&l4(n,e,i,l,h,p):Td(nc(n),e,i,l,h,p,1);break}}}function o4(n){var e=n.prev,i=n,l=n.next;if(un(e,i,l)>=0)return!1;for(var h=e.x,p=i.x,g=l.x,x=e.y,w=i.y,E=l.y,I=h<p?h<g?h:g:p<g?p:g,z=x<w?x<E?x:E:w<E?w:E,D=h>p?h>g?h:g:p>g?p:g,F=x>w?x>E?x:E:w>E?w:E,N=l.next;N!==e;){if(N.x>=I&&N.x<=D&&N.y>=z&&N.y<=F&&fu(h,x,p,w,g,E,N.x,N.y)&&un(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function s4(n,e,i,l){var h=n.prev,p=n,g=n.next;if(un(h,p,g)>=0)return!1;for(var x=h.x,w=p.x,E=g.x,I=h.y,z=p.y,D=g.y,F=x<w?x<E?x:E:w<E?w:E,N=I<z?I<D?I:D:z<D?z:D,G=x>w?x>E?x:E:w>E?w:E,Q=I>z?I>D?I:D:z>D?z:D,oe=q_(F,N,e,i,l),fe=q_(G,Q,e,i,l),se=n.prevZ,he=n.nextZ;se&&se.z>=oe&&he&&he.z<=fe;){if(se.x>=F&&se.x<=G&&se.y>=N&&se.y<=Q&&se!==h&&se!==g&&fu(x,I,w,z,E,D,se.x,se.y)&&un(se.prev,se,se.next)>=0||(se=se.prevZ,he.x>=F&&he.x<=G&&he.y>=N&&he.y<=Q&&he!==h&&he!==g&&fu(x,I,w,z,E,D,he.x,he.y)&&un(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;se&&se.z>=oe;){if(se.x>=F&&se.x<=G&&se.y>=N&&se.y<=Q&&se!==h&&se!==g&&fu(x,I,w,z,E,D,se.x,se.y)&&un(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;he&&he.z<=fe;){if(he.x>=F&&he.x<=G&&he.y>=N&&he.y<=Q&&he!==h&&he!==g&&fu(x,I,w,z,E,D,he.x,he.y)&&un(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function a4(n,e,i){var l=n;do{var h=l.prev,p=l.next.next;!tm(h,p)&&Kw(h,l,l.next,p)&&Cd(h,p)&&Cd(p,h)&&(e.push(h.i/i|0),e.push(l.i/i|0),e.push(p.i/i|0),Id(l),Id(l.next),l=n=p),l=l.next}while(l!==n);return nc(l)}function l4(n,e,i,l,h,p){var g=n;do{for(var x=g.next.next;x!==g.prev;){if(g.i!==x.i&&p4(g,x)){var w=Yw(g,x);return g=nc(g,g.next),w=nc(w,w.next),Td(g,e,i,l,h,p,0),void Td(w,e,i,l,h,p,0)}x=x.next}g=g.next}while(g!==n)}function c4(n,e){return n.x-e.x}function u4(n,e){var i=function(h,p){var g,x=p,w=h.x,E=h.y,I=-1/0;do{if(E<=x.y&&E>=x.next.y&&x.next.y!==x.y){var z=x.x+(E-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(z<=w&&z>I&&(I=z,g=x.x<x.next.x?x:x.next,z===w))return g}x=x.next}while(x!==p);if(!g)return null;var D,F=g,N=g.x,G=g.y,Q=1/0;x=g;do w>=x.x&&x.x>=N&&w!==x.x&&fu(E<G?w:I,E,N,G,E<G?I:w,E,x.x,x.y)&&(D=Math.abs(E-x.y)/(w-x.x),Cd(x,h)&&(D<Q||D===Q&&(x.x>g.x||x.x===g.x&&h4(g,x)))&&(g=x,Q=D)),x=x.next;while(x!==F);return g}(n,e);if(!i)return e;var l=Yw(i,n);return nc(l,l.next),nc(i,i.next)}function h4(n,e){return un(n.prev,n,e.prev)<0&&un(e.next,n,n.next)<0}function q_(n,e,i,l,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function d4(n){var e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function fu(n,e,i,l,h,p,g,x){return(h-g)*(e-x)>=(n-g)*(p-x)&&(n-g)*(l-x)>=(i-g)*(e-x)&&(i-g)*(p-x)>=(h-g)*(l-x)}function p4(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,l){var h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==l.i&&h.next.i!==l.i&&Kw(h,h.next,i,l))return!0;h=h.next}while(h!==i);return!1}(n,e)&&(Cd(n,e)&&Cd(e,n)&&function(i,l){var h=i,p=!1,g=(i.x+l.x)/2,x=(i.y+l.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&g<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==i);return p}(n,e)&&(un(n.prev,n,e.prev)||un(n,e.prev,e))||tm(n,e)&&un(n.prev,n,n.next)>0&&un(e.prev,e,e.next)>0)}function un(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function tm(n,e){return n.x===e.x&&n.y===e.y}function Kw(n,e,i,l){var h=nm(un(n,e,i)),p=nm(un(n,e,l)),g=nm(un(i,l,n)),x=nm(un(i,l,e));return h!==p&&g!==x||!(h!==0||!rm(n,i,e))||!(p!==0||!rm(n,l,e))||!(g!==0||!rm(i,n,l))||!(x!==0||!rm(i,e,l))}function rm(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function nm(n){return n>0?1:n<0?-1:0}function Cd(n,e){return un(n.prev,n,n.next)<0?un(n,e,n.next)>=0&&un(n,n.prev,e)>=0:un(n,e,n.prev)<0||un(n,n.next,e)<0}function Yw(n,e){var i=new G_(n.i,n.x,n.y),l=new G_(e.i,e.x,e.y),h=n.next,p=e.prev;return n.next=e,e.prev=n,i.next=h,h.prev=i,l.next=i,i.prev=l,p.next=l,l.prev=p,l}function Jw(n,e,i,l){var h=new G_(n,e,i);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Id(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function G_(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function H_(n,e,i,l){for(var h=0,p=e,g=i-l;p<i;p+=l)h+=(n[g]-n[p])*(n[p+1]+n[g+1]),g=p;return h}W_.exports=em,W_.exports.default=em,em.deviation=function(n,e,i,l){var h=e&&e.length,p=Math.abs(H_(n,0,h?e[0]*i:n.length,i));if(h)for(var g=0,x=e.length;g<x;g++)p-=Math.abs(H_(n,e[g]*i,g<x-1?e[g+1]*i:n.length,i));var w=0;for(g=0;g<l.length;g+=3){var E=l[g]*i,I=l[g+1]*i,z=l[g+2]*i;w+=Math.abs((n[E]-n[z])*(n[I+1]-n[E+1])-(n[E]-n[I])*(n[z+1]-n[E+1]))}return p===0&&w===0?0:Math.abs((w-p)/p)},em.flatten=function(n){for(var e=n[0][0].length,i={vertices:[],holes:[],dimensions:e},l=0,h=0;h<n.length;h++){for(var p=0;p<n[h].length;p++)for(var g=0;g<e;g++)i.vertices.push(n[h][p][g]);h>0&&i.holes.push(l+=n[h-1].length)}return i};var Z_=$(W_.exports);function f4(n,e,i,l,h){Qw(n,e,i||0,l||n.length-1,h||m4)}function Qw(n,e,i,l,h){for(;l>i;){if(l-i>600){var p=l-i+1,g=e-i+1,x=Math.log(p),w=.5*Math.exp(2*x/3),E=.5*Math.sqrt(x*w*(p-w)/p)*(g-p/2<0?-1:1);Qw(n,e,Math.max(i,Math.floor(e-g*w/p+E)),Math.min(l,Math.floor(e+(p-g)*w/p+E)),h)}var I=n[e],z=i,D=l;for(kd(n,i,e),h(n[l],I)>0&&kd(n,i,l);z<D;){for(kd(n,z,D),z++,D--;h(n[z],I)<0;)z++;for(;h(n[D],I)>0;)D--}h(n[i],I)===0?kd(n,i,D):kd(n,++D,l),D<=e&&(i=D+1),e<=D&&(l=D-1)}}function kd(n,e,i){var l=n[e];n[e]=n[i],n[i]=l}function m4(n,e){return n<e?-1:n>e?1:0}function X_(n,e){const i=n.length;if(i<=1)return[n];const l=[];let h,p;for(let g=0;g<i;g++){const x=Bo(n[g]);x!==0&&(n[g].area=Math.abs(x),p===void 0&&(p=x<0),p===x<0?(h&&l.push(h),h=[n[g]]):h.push(n[g]))}if(h&&l.push(h),e>1)for(let g=0;g<l.length;g++)l[g].length<=e||(f4(l[g],e,1,l[g].length-1,g4),l[g]=l[g].slice(0,e));return l}function g4(n,e){return e.area-n.area}function K_(n,e,i){const l=i.patternDependencies;let h=!1;for(const p of e){const g=p.paint.get(`${n}-pattern`);g.isConstant()||(h=!0);const x=g.constantOr(null);x&&(h=!0,l[x]=!0)}return h}function Y_(n,e,i,l,h){const p=h.patternDependencies;for(const g of e){const x=g.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let w=x.evaluate({zoom:l},i,{},h.availableImages);w=w&&w.name?w.name:w,p[w]=!0,i.patterns[g.id]=w}}return i}class im{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new it,this.indexArray=new It,this.indexArray2=new Dn,this.programConfigurations=new Xl(e.layers,e.zoom),this.segments=new cn,this.segments2=new cn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,l,h){this.hasPattern=K_("fill",this.layers,i);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:x,id:w,index:E,sourceLayerIndex:I}of e){const z=this.layers[0]._featureFilter.needGeometry,D=tc(x,z);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),D,l))continue;const F=p?p.evaluate(D,{},l,i.availableImages):void 0,N={id:w,properties:x.properties,type:x.type,sourceLayerIndex:I,index:E,geometry:z?D.geometry:Qs(x,l,h),patterns:{},sortKey:F};g.push(N)}p&&g.sort((x,w)=>x.sortKey-w.sortKey);for(const x of g){const{geometry:w,index:E,sourceLayerIndex:I}=x;if(this.hasPattern){const z=Y_("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(z)}else this.addFeature(x,w,E,l,{},i.availableImages);i.featureIndex.insert(e[E].feature,w,E,I,this.index)}}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}addFeatures(e,i,l,h,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,i4),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,l,h,p,g=[]){for(const x of X_(i,500)){let w=0;for(const N of x)w+=N.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=E.vertexLength,z=[],D=[];for(const N of x){if(N.length===0)continue;N!==x[0]&&D.push(z.length/2);const G=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),Q=G.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(Q+N.length-1,Q),z.push(N[0].x),z.push(N[0].y);for(let oe=1;oe<N.length;oe++)this.layoutVertexArray.emplaceBack(N[oe].x,N[oe].y),this.indexArray2.emplaceBack(Q+oe-1,Q+oe),z.push(N[oe].x),z.push(N[oe].y);G.vertexLength+=N.length,G.primitiveLength+=N.length}const F=Z_(z,D);for(let N=0;N<F.length;N+=3)this.indexArray.emplaceBack(I+F[N],I+F[N+1],I+F[N+2]);E.vertexLength+=w,E.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,g,h)}}Et(im,"FillBucket",{omit:["layers","patternFeatures"]});const _4=new ce({"fill-sort-key":new ee(We.layout_fill["fill-sort-key"])});var y4={paint:new ce({"fill-antialias":new q(We.paint_fill["fill-antialias"]),"fill-opacity":new ee(We.paint_fill["fill-opacity"]),"fill-color":new ee(We.paint_fill["fill-color"]),"fill-outline-color":new ee(We.paint_fill["fill-outline-color"]),"fill-translate":new q(We.paint_fill["fill-translate"]),"fill-translate-anchor":new q(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new ee(We.paint_fill["fill-pattern"])}),layout:_4};const x4=Ce([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),v4=Ce([{name:"a_centroid_pos",components:2,type:"Uint16"}]),b4=Ce([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:w4}=x4;var om={},E4=ye,eE=mu;function mu(n,e,i,l,h){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=l,this._values=h,n.readFields(S4,this,e)}function S4(n,e,i){n==1?e.id=i.readVarint():n==2?function(l,h){for(var p=l.readVarint()+l.pos;l.pos<p;){var g=h._keys[l.readVarint()],x=h._values[l.readVarint()];h.properties[g]=x}}(i,e):n==3?e.type=i.readVarint():n==4&&(e._geometry=i.pos)}function A4(n){for(var e,i,l=0,h=0,p=n.length,g=p-1;h<p;g=h++)l+=((i=n[g]).x-(e=n[h]).x)*(e.y+i.y);return l}mu.types=["Unknown","Point","LineString","Polygon"],mu.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,i=n.readVarint()+n.pos,l=1,h=0,p=0,g=0,x=[];n.pos<i;){if(h<=0){var w=n.readVarint();l=7&w,h=w>>3}if(h--,l===1||l===2)p+=n.readSVarint(),g+=n.readSVarint(),l===1&&(e&&x.push(e),e=[]),e.push(new E4(p,g));else{if(l!==7)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&x.push(e),x},mu.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,i=1,l=0,h=0,p=0,g=1/0,x=-1/0,w=1/0,E=-1/0;n.pos<e;){if(l<=0){var I=n.readVarint();i=7&I,l=I>>3}if(l--,i===1||i===2)(h+=n.readSVarint())<g&&(g=h),h>x&&(x=h),(p+=n.readSVarint())<w&&(w=p),p>E&&(E=p);else if(i!==7)throw new Error("unknown command "+i)}return[g,w,x,E]},mu.prototype.toGeoJSON=function(n,e,i){var l,h,p=this.extent*Math.pow(2,i),g=this.extent*n,x=this.extent*e,w=this.loadGeometry(),E=mu.types[this.type];function I(F){for(var N=0;N<F.length;N++){var G=F[N];F[N]=[360*(G.x+g)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+x)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(l=0;l<w.length;l++)z[l]=w[l][0];I(w=z);break;case 2:for(l=0;l<w.length;l++)I(w[l]);break;case 3:for(w=function(F){var N=F.length;if(N<=1)return[F];for(var G,Q,oe=[],fe=0;fe<N;fe++){var se=A4(F[fe]);se!==0&&(Q===void 0&&(Q=se<0),Q===se<0?(G&&oe.push(G),G=[F[fe]]):G.push(F[fe]))}return G&&oe.push(G),oe}(w),l=0;l<w.length;l++)for(h=0;h<w[l].length;h++)I(w[l][h])}w.length===1?w=w[0]:E="Multi"+E;var D={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(D.id=this.id),D};var T4=eE,tE=rE;function rE(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(C4,this,e),this.length=this._features.length}function C4(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push(function(l){for(var h=null,p=l.readVarint()+l.pos;l.pos<p;){var g=l.readVarint()>>3;h=g===1?l.readString():g===2?l.readFloat():g===3?l.readDouble():g===4?l.readVarint64():g===5?l.readVarint():g===6?l.readSVarint():g===7?l.readBoolean():null}return h}(i))}rE.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new T4(this._pbf,e,this.extent,this._keys,this._values)};var I4=tE;function k4(n,e,i){if(n===3){var l=new I4(i,i.readVarint()+i.pos);l.length&&(e[l.name]=l)}}var J_=om.VectorTile=function(n,e){this.layers=n.readFields(k4,{},e)},sm=om.VectorTileFeature=eE;function am(n,e,i,l){const h=[],p=l===0?(g,x,w,E,I,z)=>{g.push(new Se(z,w+(z-x)/(E-x)*(I-w)))}:(g,x,w,E,I,z)=>{g.push(new Se(x+(z-w)/(I-w)*(E-x),z))};for(const g of n){const x=[];for(const w of g){if(w.length<=2)continue;const E=[];for(let D=0;D<w.length-1;D++){const F=w[D].x,N=w[D].y,G=w[D+1].x,Q=w[D+1].y,oe=l===0?F:N,fe=l===0?G:Q;oe<e?fe>e&&p(E,F,N,G,Q,e):oe>i?fe<i&&p(E,F,N,G,Q,i):E.push(w[D]),fe<e&&oe>=e&&p(E,F,N,G,Q,e),fe>i&&oe<=i&&p(E,F,N,G,Q,i)}let I=w[w.length-1];const z=l===0?I.x:I.y;z>=e&&z<=i&&E.push(I),E.length&&(I=E[E.length-1],E[0].x===I.x&&E[0].y===I.y||E.push(E[0]),x.push(E))}x.length&&h.push(x)}return h}om.VectorTileLayer=tE;const P4=sm.types,z4=Math.pow(2,13);function Pd(n,e,i,l,h,p,g,x){n.emplaceBack((e<<1)+g,(i<<1)+p,(Math.floor(l*z4)<<1)+h,Math.round(x))}function zd(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class nE{constructor(){this.acc=new Se(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Se(e.x,e.y),this.max=new Se(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const l=this.min,h=this.max;e.x<l.x?l.x=e.x:e.x>h.x&&(h.x=e.x),e.y<l.y?l.y=e.y:e.y>h.y&&(h.y=e.y),((e.x===0||e.x===Mt)&&e.x===i.x)!=((e.y===0||e.y===Mt)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,or(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Mt!=e.x>Mt&&this.addBorderIntersection(1,or(i.y,e.y,(Mt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,or(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Mt!=e.y>Mt&&this.addBorderIntersection(3,or(i.x,e.x,(Mt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,e.x)}}centroid(){const e=this.polyCount.reduce((i,l)=>i+l.edges,0);return e!==0?this.acc.div(e)._round():new Se(0,0)}span(){return new Se(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Dd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Ze,this.centroidVertexArray=new Zo,this.indexArray=new It,this.programConfigurations=new Xl(e.layers,e.zoom),this.segments=new cn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,l,h){this.features=[],this.hasPattern=K_("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const g=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*g/(g*g+1)/Mt/(1<<p.z)}(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:g,index:x,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,I=tc(p,E);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),I,l))continue;const z={id:g,sourceLayerIndex:w,index:x,geometry:E?I.geometry:Qs(p,l,h),properties:p.properties,type:p.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(Y_("fill-extrusion",this.layers,z,this.zoom,i)):this.addFeature(z,z.geometry,x,l,{},i.availableImages,h),i.featureIndex.insert(p,z.geometry,x,w,this.index,D)}this.sortBorders()}addFeatures(e,i,l,h,p){for(const g of this.features){const{geometry:x}=g;this.addFeature(g,x,g.index,i,l,h,p)}this.sortBorders()}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,w4),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,b4.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,v4.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,l,h,p,g,x){const w=[new Se(0,0),new Se(Mt,Mt)],E=x.projection,I=E.name==="globe",z=this.enableTerrain&&!I?new nE:null,D=P4[e.type]==="Polygon";I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new at);const F=X_(i,500);for(let oe=F.length-1;oe>=0;oe--){const fe=F[oe];(fe.length===0||(N=fe[0]).every(se=>se.x<=0)||N.every(se=>se.x>=Mt)||N.every(se=>se.y<=0)||N.every(se=>se.y>=Mt))&&F.splice(oe,1)}var N;let G;if(I)G=uE(F,w,h);else{G=[];for(const oe of F)G.push({polygon:oe,bounds:w})}const Q=D?this.edgeRadius:0;for(const{polygon:oe,bounds:fe}of G){let se=0,he=0;for(const me of oe)D&&!me[0].equals(me[me.length-1])&&me.push(me[0]),he+=D?me.length-1:me.length;const ge=this.segments.prepareSegment((D?5:4)*he,this.layoutVertexArray,this.indexArray);if(D){const me=[],Be=[];se=ge.vertexLength;for(const qe of oe){let ot,Oe;qe.length&&qe!==oe[0]&&Be.push(me.length/2),ot=qe[1].sub(qe[0])._perp()._unit();for(let Ke=1;Ke<qe.length;Ke++){const Ye=qe[Ke],rt=qe[Ke===qe.length-1?1:Ke+1];let{x:ut,y:$e}=Ye;if(Q){Oe=rt.sub(Ye)._perp()._unit();const mt=ot.add(Oe)._unit(),Tt=Q*Math.min(4,1/(ot.x*mt.x+ot.y*mt.y));ut+=Tt*mt.x,$e+=Tt*mt.y,ot=Oe}Pd(this.layoutVertexArray,ut,$e,0,0,1,1,0),ge.vertexLength++,me.push(Ye.x,Ye.y),I&&zd(this.layoutVertexExtArray,E.projectTilePoint(ut,$e,h),E.upVector(h,ut,$e))}}const De=Z_(me,Be);for(let qe=0;qe<De.length;qe+=3)this.indexArray.emplaceBack(se+De[qe],se+De[qe+2],se+De[qe+1]),ge.primitiveLength++}for(const me of oe){z&&me.length&&z.startRing(me[0]);let Be,De,qe,ot=me.length>4&&aE(me[me.length-2],me[0],me[1]),Oe=Q?D4(me[me.length-2],me[0],me[1],Q):0;De=me[1].sub(me[0])._perp()._unit();let Ke=!0;for(let Ye=1,rt=0;Ye<me.length;Ye++){let ut=me[Ye-1],$e=me[Ye];const mt=me[Ye===me.length-1?1:Ye+1];if(z&&D&&z.currentPolyCount.top++,sE($e,ut,fe)){Q&&(De=mt.sub($e)._perp()._unit(),Ke=!Ke);continue}z&&z.append($e,ut);const Tt=$e.sub(ut)._perp(),_t=Tt.x/(Math.abs(Tt.x)+Math.abs(Tt.y)),$t=Tt.y>0?1:0,ht=ut.dist($e);if(rt+ht>32768&&(rt=0),Q){qe=mt.sub($e)._perp()._unit();let qt=oE(ut,$e,mt,iE(De,qe),Q);isNaN(qt)&&(qt=0);const Lt=$e.sub(ut)._unit();ut=ut.add(Lt.mult(Oe))._round(),$e=$e.add(Lt.mult(-qt))._round(),Oe=qt,De=qe}const Pt=ge.vertexLength,Wt=me.length>4&&aE(ut,$e,mt);let lr=lE(rt,ot,Ke);if(Pd(this.layoutVertexArray,ut.x,ut.y,_t,$t,0,0,lr),Pd(this.layoutVertexArray,ut.x,ut.y,_t,$t,0,1,lr),rt+=ht,lr=lE(rt,Wt,!Ke),ot=Wt,Pd(this.layoutVertexArray,$e.x,$e.y,_t,$t,0,0,lr),Pd(this.layoutVertexArray,$e.x,$e.y,_t,$t,0,1,lr),ge.vertexLength+=4,this.indexArray.emplaceBack(Pt+0,Pt+1,Pt+2),this.indexArray.emplaceBack(Pt+1,Pt+3,Pt+2),ge.primitiveLength+=2,Q){const qt=se+(Ye===1?me.length-2:Ye-2),Lt=Ye===1?se:qt+1;if(this.indexArray.emplaceBack(Pt+1,qt,Pt+3),this.indexArray.emplaceBack(qt,Lt,Pt+3),ge.primitiveLength+=2,Be===void 0&&(Be=Pt),!sE(mt,me[Ye],fe)){const Rr=Ye===me.length-1?Be:ge.vertexLength;this.indexArray.emplaceBack(Pt+2,Pt+3,Rr),this.indexArray.emplaceBack(Pt+3,Rr+1,Rr),this.indexArray.emplaceBack(Pt+3,Lt,Rr+1),ge.primitiveLength+=3}Ke=!Ke}if(I){const qt=this.layoutVertexExtArray,Lt=E.projectTilePoint(ut.x,ut.y,h),Rr=E.projectTilePoint($e.x,$e.y,h),Gt=E.upVector(h,ut.x,ut.y),Ht=E.upVector(h,$e.x,$e.y);zd(qt,Lt,Gt),zd(qt,Lt,Gt),zd(qt,Rr,Ht),zd(qt,Rr,Ht)}}D&&(se+=me.length-1)}}if(z&&z.polyCount.length>0){if(z.borders){z.vertexArrayOffset=this.centroidVertexArray.length;const oe=z.borders,fe=this.featuresOnBorder.push(z)-1;for(let se=0;se<4;se++)oe[se][0]!==Number.MAX_VALUE&&this.borders[se].push(fe)}this.encodeCentroid(z.borders?void 0:z.centroid(),z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,g,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,l)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}encodeCentroid(e,i,l=!0){let h,p;if(e)if(e.y!==0){const x=i.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(e.x+450)),p=0;else h=0,p=+l;let g=l?this.centroidVertexArray.length:i.vertexArrayOffset;for(const x of i.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(g++,h,p);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(g++,0,p),this.centroidVertexArray.emplace(g++,h,p)}}}function iE(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function D4(n,e,i,l){const h=e.sub(n)._perp()._unit(),p=i.sub(e)._perp()._unit();return oE(n,e,i,iE(h,p),l)}function oE(n,e,i,l,h){const p=Math.sqrt(1-l*l);return Math.min(n.dist(e)/3,e.dist(i)/3,h*p/l)}function sE(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function aE(n,e,i){if(n.x<0||n.x>=Mt||e.x<0||e.x>=Mt||i.x<0||i.x>=Mt)return!1;const l=i.sub(e),h=l.perp(),p=n.sub(e);return(l.x*p.x+l.y*p.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function lE(n,e,i){const l=e?2|n:-3&n;return i?1|l:-2&l}function cE(){const n=Math.PI/32,e=Math.tan(n),i=Ad;return i*Math.sqrt(1+2*e*e)-i}function uE(n,e,i){const l=1<<i.z,h=no(i.x/l),p=no((i.x+1)/l),g=Xn(i.y/l),x=Xn((i.y+1)/l);return function(w,E,I,z,D=0,F){const N=[];if(!w.length||!I||!z)return N;const G=(me,Be)=>{for(const De of me)N.push({polygon:De,bounds:Be})},Q=Math.ceil(Math.log2(I)),oe=Math.ceil(Math.log2(z)),fe=Q-oe,se=[];for(let me=0;me<Math.abs(fe);me++)se.push(fe>0?0:1);for(let me=0;me<Math.min(Q,oe);me++)se.push(0),se.push(1);let he=w;if(he=am(he,E[0].y-D,E[1].y+D,1),he=am(he,E[0].x-D,E[1].x+D,0),!he.length)return N;const ge=[];for(se.length?ge.push({polygons:he,bounds:E,depth:0}):G(he,E);ge.length;){const me=ge.pop(),Be=me.depth,De=se[Be],qe=me.bounds[0],ot=me.bounds[1],Oe=De===0?qe.x:qe.y,Ke=De===0?ot.x:ot.y,Ye=F?F(De,Oe,Ke):.5*(Oe+Ke),rt=am(me.polygons,Oe-D,Ye+D,De),ut=am(me.polygons,Ye-D,Ke+D,De);if(rt.length){const $e=[qe,new Se(De===0?Ye:ot.x,De===1?Ye:ot.y)];se.length>Be+1?ge.push({polygons:rt,bounds:$e,depth:Be+1}):G(rt,$e)}if(ut.length){const $e=[new Se(De===0?Ye:qe.x,De===1?Ye:qe.y),ot];se.length>Be+1?ge.push({polygons:ut,bounds:$e,depth:Be+1}):G(ut,$e)}}return N}(n,e,Math.ceil((p-h)/11.25),Math.ceil((g-x)/11.25),1,(w,E,I)=>{if(w===0)return .5*(E+I);{const z=Xn((i.y+E/Mt)/l);return(ws(.5*(Xn((i.y+I/Mt)/l)+z))*l-i.y)*Mt}})}Et(Dd,"FillExtrusionBucket",{omit:["layers","features"]}),Et(nE,"PartMetadata");const M4=new ce({"fill-extrusion-edge-radius":new q(We["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var R4={paint:new ce({"fill-extrusion-opacity":new q(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ee(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new q(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new q(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ee(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ee(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ee(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new q(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new q(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new q(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new q(We["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:M4};function hE(n,e,i){var l=2*Math.PI*6378137/256/Math.pow(2,i);return[n*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class lm{constructor(e,i,l){this.z=e,this.x=i,this.y=l,this.key=Md(0,e,e,i,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const l=function(p,g,x){var w=hE(256*p,256*(g=Math.pow(2,x)-g-1),x),E=hE(256*(p+1),256*(g+1),x);return w[0]+","+w[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),h=function(p,g,x){let w,E="";for(let I=p;I>0;I--)w=1<<I-1,E+=(g&w?1:0)+(x&w?2:0);return E}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dE{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Md(e,i.z,i.z,i.x,i.y)}}class fi{constructor(e,i,l,h,p){this.overscaledZ=e,this.wrap=i,this.canonical=new lm(l,+h,+p),this.key=i===0&&e===l?this.canonical.key:Md(i,e,l,h,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new fi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fi(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Md(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Md(this.wrap*+i,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new fi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new fi(i,this.wrap,i,l,h),new fi(i,this.wrap,i,l+1,h),new fi(i,this.wrap,i,l,h+1),new fi(i,this.wrap,i,l+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new fi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new fi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dE(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Md(n,e,i,l,h){const p=1<<Math.min(i,22);let g=p*(h%p)+l%p;return n&&i<22&&(g+=p*p*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}Et(lm,"CanonicalTileID"),Et(fi,"OverscaledTileID",{omit:["projMatrix"]});class gu extends Se{constructor(e,i,l){super(e,i),this.z=l}}function Rd(n,e){return n.x*e.x+n.y*e.y}function pE(n,e){if(n.length===1){let i=0;const l=e[i++];let h;for(;!h||l.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const p=e[i],g=n[0],x=h.sub(l),w=p.sub(l),E=g.sub(l),I=Rd(x,x),z=Rd(x,w),D=Rd(w,w),F=Rd(E,x),N=Rd(E,w),G=I*D-z*z,Q=(D*F-z*N)/G,oe=(I*N-z*F)/G,fe=l.z*(1-Q-oe)+h.z*Q+p.z*oe;if(isFinite(fe))return fe}return 1/0}{let i=1/0;for(const l of e)i=Math.min(i,l.z);return i}}function fE(n,e,i,l,h,p,g,x){const w=g*h.getElevationAt(n,e,!0,!0),E=p[0]!==0,I=E?p[1]===0?g*(p[0]/7-450):g*function(z,D,F){const N=Math.floor(D[0]/8),G=Math.floor(D[1]/8),Q=10*(D[0]-8*N),oe=10*(D[1]-8*G),fe=z.getElevationAt(N,G,!0,!0),se=z.getMeterToDEM(F),he=Math.floor(.5*(Q*se-1)),ge=Math.floor(.5*(oe*se-1)),me=z.tileCoordToPixel(N,G),Be=2*he+1,De=2*ge+1,qe=function(ut,$e,mt,Tt,_t){return[ut.getElevationAtPixel($e,mt,!0),ut.getElevationAtPixel($e+_t,mt,!0),ut.getElevationAtPixel($e,mt+_t,!0),ut.getElevationAtPixel($e+Tt,mt+_t,!0)]}(z,me.x-he,me.y-ge,Be,De),ot=Math.abs(qe[0]-qe[1]),Oe=Math.abs(qe[2]-qe[3]),Ke=Math.abs(qe[0]-qe[2])+Math.abs(qe[1]-qe[3]),Ye=Math.min(.25,.5*se*(ot+Oe)/Be),rt=Math.min(.25,.5*se*Ke/De);return fe+Math.max(Ye*Q,rt*oe)}(h,p,x):w;return{base:w+(i===0)?-1:i,top:E?Math.max(I+l,w+i+2):w+l}}const B4=Ce([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:L4}=B4,F4=Ce([{name:"a_packed",components:4,type:"Float32"}]),{members:O4}=F4,N4=sm.types,U4=Math.cos(Math.PI/180*37.5);class cm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Fe,this.layoutVertexArray2=new nt,this.indexArray=new It,this.programConfigurations=new Xl(e.layers,e.zoom),this.segments=new cn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,l,h){this.hasPattern=K_("line",this.layers,i);const p=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:I,id:z,index:D,sourceLayerIndex:F}of e){const N=this.layers[0]._featureFilter.needGeometry,G=tc(I,N);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),G,l))continue;const Q=p?p.evaluate(G,{},l):void 0,oe={id:z,properties:I.properties,type:I.type,sourceLayerIndex:F,index:D,geometry:N?G.geometry:Qs(I,l,h),patterns:{},sortKey:Q};g.push(oe)}p&&g.sort((I,z)=>I.sortKey-z.sortKey);const{lineAtlas:x,featureIndex:w}=i,E=this.addConstantDashes(x);for(const I of g){const{geometry:z,index:D,sourceLayerIndex:F}=I;if(E&&this.addFeatureDashes(I,x),this.hasPattern){const N=Y_("line",this.layers,I,this.zoom,i);this.patternFeatures.push(N)}else this.addFeature(I,z,D,l,x.positions,i.availableImages);w.insert(e[D].feature,z,D,F,this.index)}}addConstantDashes(e){let i=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")i=!0;else{const g=p.value,x=h.value;if(!x)continue;e.addDash(x,g)}}return i}addFeatureDashes(e,i){const l=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(p.kind==="constant"&&g.kind==="constant")continue;let x,w;if(p.kind==="constant"){if(x=p.value,!x)continue}else x=p.evaluate({zoom:l},e);w=g.kind==="constant"?g.value:g.evaluate({zoom:l},e),i.addDash(x,w),e.patterns[h.id]=i.getKey(x,w)}}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}addFeatures(e,i,l,h,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,O4)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,L4),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,l,h,p,g){const x=this.layers[0].layout,w=x.get("line-join").evaluate(e,{}),E=x.get("line-cap").evaluate(e,{}),I=x.get("line-miter-limit"),z=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const D of i)this.addLine(D,e,w,E,I,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,g,h)}addLine(e,i,l,h,p,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<e.length-1;oe++)this.totalDistance+=e[oe].dist(e[oe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=N4[i.type]==="Polygon";let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let E=0;for(;E<w-1&&e[E].equals(e[E+1]);)E++;if(w<(x?3:2))return;l==="bevel"&&(p=1.05);const I=this.overscaling<=16?15*Mt/(512*this.overscaling):0,z=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let D,F,N,G,Q;this.e1=this.e2=-1,x&&(D=e[w-2],Q=e[E].sub(D)._unit()._perp());for(let oe=E;oe<w;oe++){if(N=oe===w-1?x?e[E+1]:void 0:e[oe+1],N&&e[oe].equals(N))continue;Q&&(G=Q),D&&(F=D),D=e[oe],Q=N?N.sub(D)._unit()._perp():G,G=G||Q;let fe=G.add(Q);fe.x===0&&fe.y===0||fe._unit();const se=G.x*Q.x+G.y*Q.y,he=fe.x*Q.x+fe.y*Q.y,ge=he!==0?1/he:1/0,me=2*Math.sqrt(2-2*he),Be=he<U4&&F&&N,De=G.x*Q.y-G.y*Q.x>0;if(Be&&oe>E){const Oe=D.dist(F);if(Oe>2*I){const Ke=D.sub(D.sub(F)._mult(I/Oe)._round());this.updateDistance(F,Ke),this.addCurrentVertex(Ke,G,0,0,z),F=Ke}}const qe=F&&N;let ot=qe?l:x?"butt":h;if(qe&&ot==="round"&&(ge<g?ot="miter":ge<=2&&(ot="fakeround")),ot==="miter"&&ge>p&&(ot="bevel"),ot==="bevel"&&(ge>2&&(ot="flipbevel"),ge<p&&(ot="miter")),F&&this.updateDistance(F,D),ot==="miter")fe._mult(ge),this.addCurrentVertex(D,fe,0,0,z);else if(ot==="flipbevel"){if(ge>100)fe=Q.mult(-1);else{const Oe=ge*G.add(Q).mag()/G.sub(Q).mag();fe._perp()._mult(Oe*(De?-1:1))}this.addCurrentVertex(D,fe,0,0,z),this.addCurrentVertex(D,fe.mult(-1),0,0,z)}else if(ot==="bevel"||ot==="fakeround"){const Oe=-Math.sqrt(ge*ge-1),Ke=De?Oe:0,Ye=De?0:Oe;if(F&&this.addCurrentVertex(D,G,Ke,Ye,z),ot==="fakeround"){const rt=Math.round(180*me/Math.PI/20);for(let ut=1;ut<rt;ut++){let $e=ut/rt;if($e!==.5){const Tt=$e-.5;$e+=$e*Tt*($e-1)*((1.0904+se*(se*(3.55645-1.43519*se)-3.2452))*Tt*Tt+(.848013+se*(.215638*se-1.06021)))}const mt=Q.sub(G)._mult($e)._add(G)._unit()._mult(De?-1:1);this.addHalfVertex(D,mt.x,mt.y,!1,De,0,z)}}N&&this.addCurrentVertex(D,Q,-Ke,-Ye,z)}else if(ot==="butt")this.addCurrentVertex(D,fe,0,0,z);else if(ot==="square"){const Oe=F?1:-1;F||this.addCurrentVertex(D,fe,Oe,Oe,z),this.addCurrentVertex(D,fe,0,0,z),F&&this.addCurrentVertex(D,fe,Oe,Oe,z)}else ot==="round"&&(F&&(this.addCurrentVertex(D,G,0,0,z),this.addCurrentVertex(D,G,1,1,z,!0)),N&&(this.addCurrentVertex(D,Q,-1,-1,z,!0),this.addCurrentVertex(D,Q,0,0,z)));if(Be&&oe<w-1){const Oe=D.dist(N);if(Oe>2*I){const Ke=D.add(N.sub(D)._mult(I/Oe)._round());this.updateDistance(D,Ke),this.addCurrentVertex(Ke,Q,0,0,z),D=Ke}}}}addCurrentVertex(e,i,l,h,p,g=!1){const x=i.y*h-i.x,w=-i.y-i.x*h;this.addHalfVertex(e,i.x+i.y*l,i.y-i.x*l,g,!1,l,p),this.addHalfVertex(e,x,w,g,!0,-h,p)}addHalfVertex({x:e,y:i},l,h,p,g,x,w){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(g?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Et(cm,"LineBucket",{omit:["layers","patternFeatures"]});const V4=new ce({"line-cap":new ee(We.layout_line["line-cap"]),"line-join":new ee(We.layout_line["line-join"]),"line-miter-limit":new q(We.layout_line["line-miter-limit"]),"line-round-limit":new q(We.layout_line["line-round-limit"]),"line-sort-key":new ee(We.layout_line["line-sort-key"])});var mE={paint:new ce({"line-opacity":new ee(We.paint_line["line-opacity"]),"line-color":new ee(We.paint_line["line-color"]),"line-translate":new q(We.paint_line["line-translate"]),"line-translate-anchor":new q(We.paint_line["line-translate-anchor"]),"line-width":new ee(We.paint_line["line-width"]),"line-gap-width":new ee(We.paint_line["line-gap-width"]),"line-offset":new ee(We.paint_line["line-offset"]),"line-blur":new ee(We.paint_line["line-blur"]),"line-dasharray":new ee(We.paint_line["line-dasharray"]),"line-pattern":new ee(We.paint_line["line-pattern"]),"line-gradient":new ae(We.paint_line["line-gradient"]),"line-trim-offset":new q(We.paint_line["line-trim-offset"])}),layout:V4};const gE=new class extends ee{possiblyEvaluate(n,e){return e=new P(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,i,l){return e=et({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,i,l)}}(mE.paint.properties["line-width"].specification);function _E(n,e){return e>0?e+2*n:n}gE.useIntegerZoom=!0;const j4=Ce([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$4=Ce([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),W4=Ce([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ce([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const q4=Ce([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),G4=Ce([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yE=Ce([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),H4=Ce([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ce([{name:"triangle",components:3,type:"Uint16"}]),Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ce([{type:"Float32",name:"offsetX"}]),Ce([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Un=24;const es=128;function Q_(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new P(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:h}=i;let p=0;for(;p<l.length&&l[p]<=n;)p++;p=Math.max(0,p-1);let g=p;for(;g<l.length&&l[g]<n+1;)g++;g=Math.min(l.length-1,g);const x=l[p],w=l[g];return i.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:w,minSize:i.evaluate(new P(x)),maxSize:i.evaluate(new P(w)),interpolationType:h}}}function um(n,{uSize:e,uSizeT:i},{lowerSize:l,upperSize:h}){return n.kind==="source"?l/es:n.kind==="composite"?or(l/es,h/es,i):e}function _u(n,e){let i=0,l=0;if(n.kind==="constant")l=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:g}=n,x=h?Ge(wo.interpolationFactor(h,e,p,g),0,1):0;n.kind==="camera"?l=or(n.minSize,n.maxSize,x):i=x}return{uSizeT:i,uSize:l}}var Z4=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:es,evaluateSizeForFeature:um,evaluateSizeForZoom:_u,getSizeData:Q_});function X4(n,e,i){return n.sections.forEach(l=>{l.text=function(h,p,g){const x=p.layout.get("text-transform").evaluate(g,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),T.applyArabicShaping&&(h=T.applyArabicShaping(h)),h}(l.text,e,i)}),n}const Bd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function K4(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function Y4(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}var xE=Pr,vE=function(n,e,i,l,h){var p,g,x=8*h-l-1,w=(1<<x)-1,E=w>>1,I=-7,z=i?h-1:0,D=i?-1:1,F=n[e+z];for(z+=D,p=F&(1<<-I)-1,F>>=-I,I+=x;I>0;p=256*p+n[e+z],z+=D,I-=8);for(g=p&(1<<-I)-1,p>>=-I,I+=l;I>0;g=256*g+n[e+z],z+=D,I-=8);if(p===0)p=1-E;else{if(p===w)return g?NaN:1/0*(F?-1:1);g+=Math.pow(2,l),p-=E}return(F?-1:1)*g*Math.pow(2,p-l)},bE=function(n,e,i,l,h,p){var g,x,w,E=8*p-h-1,I=(1<<E)-1,z=I>>1,D=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=l?0:p-1,N=l?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,g=I):(g=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-g))<1&&(g--,w*=2),(e+=g+z>=1?D/w:D*Math.pow(2,1-z))*w>=2&&(g++,w/=2),g+z>=I?(x=0,g=I):g+z>=1?(x=(e*w-1)*Math.pow(2,h),g+=z):(x=e*Math.pow(2,z-1)*Math.pow(2,h),g=0));h>=8;n[i+F]=255&x,F+=N,x/=256,h-=8);for(g=g<<h|x,E+=h;E>0;n[i+F]=255&g,F+=N,g/=256,E-=8);n[i+F-N]|=128*G};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Pr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Pr.Varint=0,Pr.Fixed64=1,Pr.Bytes=2,Pr.Fixed32=5;var ey=4294967296,wE=1/ey,EE=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ta(n){return n.type===Pr.Bytes?n.readVarint()+n.pos:n.pos+1}function yu(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function SE(n,e,i){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(l);for(var h=i.pos-1;h>=n;h--)i.buf[h+l]=i.buf[h]}function J4(n,e){for(var i=0;i<n.length;i++)e.writeVarint(n[i])}function Q4(n,e){for(var i=0;i<n.length;i++)e.writeSVarint(n[i])}function eD(n,e){for(var i=0;i<n.length;i++)e.writeFloat(n[i])}function tD(n,e){for(var i=0;i<n.length;i++)e.writeDouble(n[i])}function rD(n,e){for(var i=0;i<n.length;i++)e.writeBoolean(n[i])}function nD(n,e){for(var i=0;i<n.length;i++)e.writeFixed32(n[i])}function iD(n,e){for(var i=0;i<n.length;i++)e.writeSFixed32(n[i])}function oD(n,e){for(var i=0;i<n.length;i++)e.writeFixed64(n[i])}function sD(n,e){for(var i=0;i<n.length;i++)e.writeSFixed64(n[i])}function hm(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function xu(n,e,i){n[i]=e,n[i+1]=e>>>8,n[i+2]=e>>>16,n[i+3]=e>>>24}function AE(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}Pr.prototype={destroy:function(){this.buf=null},readFields:function(n,e,i){for(i=i||this.length;this.pos<i;){var l=this.readVarint(),h=l>>3,p=this.pos;this.type=7&l,n(h,e,this),this.pos===p&&this.skip(l)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=hm(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=AE(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=hm(this.buf,this.pos)+hm(this.buf,this.pos+4)*ey;return this.pos+=8,n},readSFixed64:function(){var n=hm(this.buf,this.pos)+AE(this.buf,this.pos+4)*ey;return this.pos+=8,n},readFloat:function(){var n=vE(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=vE(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,i,l=this.buf;return e=127&(i=l[this.pos++]),i<128?e:(e|=(127&(i=l[this.pos++]))<<7,i<128?e:(e|=(127&(i=l[this.pos++]))<<14,i<128?e:(e|=(127&(i=l[this.pos++]))<<21,i<128?e:function(h,p,g){var x,w,E=g.buf;if(x=(112&(w=E[g.pos++]))>>4,w<128||(x|=(127&(w=E[g.pos++]))<<3,w<128)||(x|=(127&(w=E[g.pos++]))<<10,w<128)||(x|=(127&(w=E[g.pos++]))<<17,w<128)||(x|=(127&(w=E[g.pos++]))<<24,w<128)||(x|=(1&(w=E[g.pos++]))<<31,w<128))return yu(h,x,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=l[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&EE?function(i,l,h){return EE.decode(i.subarray(l,h))}(this.buf,e,n):function(i,l,h){for(var p="",g=l;g<h;){var x,w,E,I=i[g],z=null,D=I>239?4:I>223?3:I>191?2:1;if(g+D>h)break;D===1?I<128&&(z=I):D===2?(192&(x=i[g+1]))==128&&(z=(31&I)<<6|63&x)<=127&&(z=null):D===3?(w=i[g+2],(192&(x=i[g+1]))==128&&(192&w)==128&&((z=(15&I)<<12|(63&x)<<6|63&w)<=2047||z>=55296&&z<=57343)&&(z=null)):D===4&&(w=i[g+2],E=i[g+3],(192&(x=i[g+1]))==128&&(192&w)==128&&(192&E)==128&&((z=(15&I)<<18|(63&x)<<12|(63&w)<<6|63&E)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,D=1):z>65535&&(z-=65536,p+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),p+=String.fromCharCode(z),g+=D}return p}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Pr.Bytes)return n.push(this.readVarint(e));var i=ta(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Pr.Bytes)return n.push(this.readSVarint());var e=ta(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Pr.Bytes)return n.push(this.readBoolean());var e=ta(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Pr.Bytes)return n.push(this.readFloat());var e=ta(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Pr.Bytes)return n.push(this.readDouble());var e=ta(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Pr.Bytes)return n.push(this.readFixed32());var e=ta(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Pr.Bytes)return n.push(this.readSFixed32());var e=ta(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Pr.Bytes)return n.push(this.readFixed64());var e=ta(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Pr.Bytes)return n.push(this.readSFixed64());var e=ta(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===Pr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Pr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Pr.Fixed32)this.pos+=4;else{if(e!==Pr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),xu(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),xu(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),xu(this.buf,-1&n,this.pos),xu(this.buf,Math.floor(n*wE),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),xu(this.buf,-1&n,this.pos),xu(this.buf,Math.floor(n*wE),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,i){var l,h;if(e>=0?(l=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(p,g,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)}(l,0,i),function(p,g){var x=(7&p)<<4;g.buf[g.pos++]|=x|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))}(h,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(l,h,p){for(var g,x,w=0;w<h.length;w++){if((g=h.charCodeAt(w))>55295&&g<57344){if(!x){g>56319||w+1===h.length?(l[p++]=239,l[p++]=191,l[p++]=189):x=g;continue}if(g<56320){l[p++]=239,l[p++]=191,l[p++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(l[p++]=239,l[p++]=191,l[p++]=189,x=null);g<128?l[p++]=g:(g<2048?l[p++]=g>>6|192:(g<65536?l[p++]=g>>12|224:(l[p++]=g>>18|240,l[p++]=g>>12&63|128),l[p++]=g>>6&63|128),l[p++]=63&g|128)}return p}(this.buf,n,this.pos);var i=this.pos-e;i>=128&&SE(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),bE(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),bE(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,e){this.pos++;var i=this.pos;n(e,this);var l=this.pos-i;l>=128&&SE(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeMessage:function(n,e,i){this.writeTag(n,Pr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,J4,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,Q4,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,rD,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,eD,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,tD,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,nD,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,iD,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,oD,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,sD,e)},writeBytesField:function(n,e){this.writeTag(n,Pr.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Pr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Pr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Pr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Pr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Pr.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Pr.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Pr.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Pr.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Pr.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};var dm=$(xE);const ty=3;function aD(n,e,i){e.glyphs=[],n===1&&i.readMessage(lD,e)}function lD(n,e,i){if(n===3){const{id:l,bitmap:h,width:p,height:g,left:x,top:w,advance:E}=i.readMessage(cD,{});e.glyphs.push({id:l,bitmap:new ea({width:p+2*ty,height:g+2*ty},h),metrics:{width:p,height:g,left:x,top:w,advance:E}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function cD(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const TE=ty;function ry(n){let e=0,i=0;for(const g of n)e+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,x)=>x.h-g.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,p=0;for(const g of n)for(let x=l.length-1;x>=0;x--){const w=l[x];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,p=Math.max(p,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===w.w&&g.h===w.h){const E=l.pop();x<l.length&&(l[x]=E)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(l.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}const Ci=1;class ny{constructor(e,{pixelRatio:i,version:l,stretchX:h,stretchY:p,content:g}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=h,this.stretchY=p,this.content=g,this.version=l}get tl(){return[this.paddedRect.x+Ci,this.paddedRect.y+Ci]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ci,this.paddedRect.y+this.paddedRect.h-Ci]}get displaySize(){return[(this.paddedRect.w-2*Ci)/this.pixelRatio,(this.paddedRect.h-2*Ci)/this.pixelRatio]}}class CE{constructor(e,i){const l={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,l,p),this.addImages(i,h,p);const{w:g,h:x}=ry(p),w=new Oi({width:g||1,height:x||1});for(const E in e){const I=e[E],z=l[E].paddedRect;Oi.copy(I.data,w,{x:0,y:0},{x:z.x+Ci,y:z.y+Ci},I.data)}for(const E in i){const I=i[E],z=h[E].paddedRect,D=z.x+Ci,F=z.y+Ci,N=I.data.width,G=I.data.height;Oi.copy(I.data,w,{x:0,y:0},{x:D,y:F},I.data),Oi.copy(I.data,w,{x:0,y:G-1},{x:D,y:F-1},{width:N,height:1}),Oi.copy(I.data,w,{x:0,y:0},{x:D,y:F+G},{width:N,height:1}),Oi.copy(I.data,w,{x:N-1,y:0},{x:D-1,y:F},{width:1,height:G}),Oi.copy(I.data,w,{x:0,y:0},{x:D+N,y:F},{width:1,height:G})}this.image=w,this.iconPositions=l,this.patternPositions=h}addImages(e,i,l){for(const h in e){const p=e[h],g={x:0,y:0,w:p.data.width+2*Ci,h:p.data.height+2*Ci};l.push(g),i[h]=new ny(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),i),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),i)}patchUpdatedImage(e,i,l){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,p]=e.tl;l.update(i.data,void 0,{x:h,y:p})}}Et(ny,"ImagePosition"),Et(CE,"ImageAtlas");const io={horizontal:1,vertical:2,horizontalOnly:3},IE=-17;class Ld{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const l=new Ld;return l.scale=e||1,l.fontStack=i,l}static forImage(e){const i=new Ld;return i.imageName=e,i}}class vu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const l=new vu;for(let h=0;h<e.sections.length;h++){const p=e.sections[h];p.image?l.addImageSection(p):l.addTextSection(p,i)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,l){let h="";for(let p=0;p<i.length;p++){const g=i.charCodeAt(p+1)||null,x=i.charCodeAt(p-1)||null;h+=!l&&(g&&Vf(g)&&!Bd[i[p+1]]||x&&Vf(x)&&!Bd[i[p-1]])||!Bd[i[p]]?i[p]:Bd[i[p]]}return h}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&pm[this.text.charCodeAt(l)];l++)e++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&pm[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const l=new vu;return l.text=this.text.substring(e,i),l.sectionIndex=this.sectionIndex.slice(e,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Ld.forText(e.scale,e.fontStack||i));const l=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(l)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void gr("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Ld.forImage(i)),this.sectionIndex.push(this.sections.length-1)):gr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function iy(n,e,i,l,h,p,g,x,w,E,I,z,D,F,N){const G=vu.fromFeature(n,h);z===io.vertical&&G.verticalizePunctuation(D);let Q=[];const oe=function(me,Be,De,qe,ot,Oe){if(!me)return[];const Ke=[],Ye=function(mt,Tt,_t,$t,ht,Pt){let Wt=0;for(let lr=0;lr<mt.length();lr++){const qt=mt.getSection(lr);Wt+=kE(mt.getCharCode(lr),qt,$t,ht,Tt,Pt)}return Wt/Math.max(1,Math.ceil(Wt/_t))}(me,Be,De,qe,ot,Oe),rt=me.text.indexOf("")>=0;let ut=0;for(let mt=0;mt<me.length();mt++){const Tt=me.getSection(mt),_t=me.getCharCode(mt);if(pm[_t]||(ut+=kE(_t,Tt,qe,ot,Be,Oe)),mt<me.length()-1){const $t=!(($e=_t)<11904||!(yt["Bopomofo Extended"]($e)||yt.Bopomofo($e)||yt["CJK Compatibility Forms"]($e)||yt["CJK Compatibility Ideographs"]($e)||yt["CJK Compatibility"]($e)||yt["CJK Radicals Supplement"]($e)||yt["CJK Strokes"]($e)||yt["CJK Symbols and Punctuation"]($e)||yt["CJK Unified Ideographs Extension A"]($e)||yt["CJK Unified Ideographs"]($e)||yt["Enclosed CJK Letters and Months"]($e)||yt["Halfwidth and Fullwidth Forms"]($e)||yt.Hiragana($e)||yt["Ideographic Description Characters"]($e)||yt["Kangxi Radicals"]($e)||yt["Katakana Phonetic Extensions"]($e)||yt.Katakana($e)||yt["Vertical Forms"]($e)||yt["Yi Radicals"]($e)||yt["Yi Syllables"]($e)));(uD[_t]||$t||Tt.imageName)&&Ke.push(zE(mt+1,ut,Ye,Ke,hD(_t,me.getCharCode(mt+1),$t&&rt),!1))}}var $e;return DE(zE(me.length(),ut,Ye,Ke,0,!0))}(G,E,p,e,l,F),{processBidirectionalText:fe,processStyledBidirectionalText:se}=T;if(fe&&G.sections.length===1){const me=fe(G.toString(),oe);for(const Be of me){const De=new vu;De.text=Be,De.sections=G.sections;for(let qe=0;qe<Be.length;qe++)De.sectionIndex.push(0);Q.push(De)}}else if(se){const me=se(G.text,G.sectionIndex,oe);for(const Be of me){const De=new vu;De.text=Be[0],De.sectionIndex=Be[1],De.sections=G.sections,Q.push(De)}}else Q=function(me,Be){const De=[],qe=me.text;let ot=0;for(const Oe of Be)De.push(me.substring(ot,Oe)),ot=Oe;return ot<qe.length&&De.push(me.substring(ot,qe.length)),De}(G,oe);const he=[],ge={positionedLines:he,text:G.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(me,Be,De,qe,ot,Oe,Ke,Ye,rt,ut,$e,mt){let Tt=0,_t=0,$t=0;const ht=Ye==="right"?1:Ye==="left"?0:.5;let Pt=!1;for(const Gt of ot){const Ht=Gt.getSections();for(const Cr of Ht){if(Cr.imageName)continue;const zr=Be[Cr.fontStack];if(zr&&(Pt=zr.ascender!==void 0&&zr.descender!==void 0,!Pt))break}if(!Pt)break}let Wt=0;for(const Gt of ot){Gt.trim();const Ht=Gt.getMaxScale(),Cr=(Ht-1)*Un,zr={positionedGlyphs:[],lineOffset:0};me.positionedLines[Wt]=zr;const Dr=zr.positionedGlyphs;let Ir=0;if(!Gt.length()){_t+=Oe,++Wt;continue}let qr=0,Jr=0;for(let kr=0;kr<Gt.length();kr++){const vn=Gt.getSection(kr),dn=Gt.getSectionIndex(kr),Hr=Gt.getCharCode(kr);let hr=vn.scale,pn=null,Mr=null,mi=null,fn=Un,Vn=0;const Mn=!(rt===io.horizontal||!$e&&!cd(Hr)||$e&&(pm[Hr]||(lr=Hr,yt.Arabic(lr)||yt["Arabic Supplement"](lr)||yt["Arabic Extended-A"](lr)||yt["Arabic Presentation Forms-A"](lr)||yt["Arabic Presentation Forms-B"](lr))));if(vn.imageName){const gi=qe[vn.imageName];if(!gi)continue;mi=vn.imageName,me.iconsInText=me.iconsInText||!0,Mr=gi.paddedRect;const Rn=gi.displaySize;hr=hr*Un/mt,pn={width:Rn[0],height:Rn[1],left:Ci,top:-TE,advance:Mn?Rn[1]:Rn[0],localGlyph:!1},Vn=Pt?-pn.height*hr:IE+Ht*Un-Rn[1]*hr,fn=pn.advance;const ns=(Mn?Rn[0]:Rn[1])*hr-Un*Ht;ns>0&&ns>Ir&&(Ir=ns)}else{const gi=De[vn.fontStack];if(!gi)continue;gi[Hr]&&(Mr=gi[Hr]);const Rn=Be[vn.fontStack];if(!Rn)continue;const ns=Rn.glyphs[Hr];if(!ns)continue;if(pn=ns.metrics,fn=Hr!==8203?Un:0,Pt){const Cu=Rn.ascender!==void 0?Math.abs(Rn.ascender):0,Gd=Rn.descender!==void 0?Math.abs(Rn.descender):0,Hd=(Cu+Gd)*hr;qr<Hd&&(qr=Hd,Jr=(Cu-Gd)/2*hr),Vn=-Cu*hr}else Vn=IE+(Ht-hr)*Un}Mn?(me.verticalizable=!0,Dr.push({glyph:Hr,imageName:mi,x:Tt,y:_t+Vn,vertical:Mn,scale:hr,localGlyph:pn.localGlyph,fontStack:vn.fontStack,sectionIndex:dn,metrics:pn,rect:Mr}),Tt+=fn*hr+ut):(Dr.push({glyph:Hr,imageName:mi,x:Tt,y:_t+Vn,vertical:Mn,scale:hr,localGlyph:pn.localGlyph,fontStack:vn.fontStack,sectionIndex:dn,metrics:pn,rect:Mr}),Tt+=pn.advance*hr+ut)}Dr.length!==0&&($t=Math.max(Tt-ut,$t),Pt?ME(Dr,ht,Ir,Jr,Oe*Ht/2):ME(Dr,ht,Ir,0,Oe/2)),Tt=0;const hn=Oe*Ht+Ir;zr.lineOffset=Math.max(Ir,Cr),_t+=hn,++Wt}var lr;const qt=_t,{horizontalAlign:Lt,verticalAlign:Rr}=oy(Ke);(function(Gt,Ht,Cr,zr,Dr,Ir){const qr=(Ht-Cr)*Dr,Jr=-Ir*zr;for(const hn of Gt)for(const kr of hn.positionedGlyphs)kr.x+=qr,kr.y+=Jr})(me.positionedLines,ht,Lt,Rr,$t,qt),me.top+=-Rr*qt,me.bottom=me.top+qt,me.left+=-Lt*$t,me.right=me.left+$t,me.hasBaseline=Pt}(ge,e,i,l,Q,g,x,w,z,E,D,N),!function(me){for(const Be of me)if(Be.positionedGlyphs.length!==0)return!1;return!0}(he)&&ge}const pm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uD={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function kE(n,e,i,l,h,p){if(e.imageName){const g=l[e.imageName];return g?g.displaySize[0]*e.scale*Un/p+h:0}{const g=i[e.fontStack],x=g&&g.glyphs[n];return x?x.metrics.advance*e.scale+h:0}}function PE(n,e,i,l){const h=Math.pow(n-e,2);return l?n<e?h/2:2*h:h+Math.abs(i)*i}function hD(n,e,i){let l=0;return n===10&&(l-=1e4),i&&(l+=150),n!==40&&n!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function zE(n,e,i,l,h,p){let g=null,x=PE(e,i,h,p);for(const w of l){const E=PE(e-w.x,i,h,p)+w.badness;E<=x&&(g=w,x=E)}return{index:n,x:e,priorBreak:g,badness:x}}function DE(n){return n?DE(n.priorBreak).concat(n.index):[]}function oy(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function ME(n,e,i,l,h){if(!(e||i||l||h))return;const p=n.length-1,g=n[p],x=(g.x+g.metrics.advance*g.scale)*e;for(let w=0;w<=p;w++)n[w].x-=x,n[w].y+=i+l+h}function dD(n,e,i){const{horizontalAlign:l,verticalAlign:h}=oy(i),p=e[0]-n.displaySize[0]*l,g=e[1]-n.displaySize[1]*h;return{image:n,top:g,bottom:g+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function RE(n,e,i,l,h,p){const g=n.image;let x;if(g.content){const Q=g.content,oe=g.pixelRatio||1;x=[Q[0]/oe,Q[1]/oe,g.displaySize[0]-Q[2]/oe,g.displaySize[1]-Q[3]/oe]}const w=e.left*p,E=e.right*p;let I,z,D,F;i==="width"||i==="both"?(F=h[0]+w-l[3],z=h[0]+E+l[1]):(F=h[0]+(w+E-g.displaySize[0])/2,z=F+g.displaySize[0]);const N=e.top*p,G=e.bottom*p;return i==="height"||i==="both"?(I=h[1]+N-l[0],D=h[1]+G+l[2]):(I=h[1]+(N+G-g.displaySize[1])/2,D=I+g.displaySize[1]),{image:g,top:I,right:z,bottom:D,left:F,collisionPadding:x}}class ra extends Se{constructor(e,i,l,h,p){super(e,i),this.angle=h,this.z=l,p!==void 0&&(this.segment=p)}clone(){return new ra(this.x,this.y,this.z,this.angle,this.segment)}}function BE(n,e,i,l,h){if(e.segment===void 0)return!0;let p=e,g=e.segment+1,x=0;for(;x>-i/2;){if(g--,g<0)return!1;x-=n[g].dist(p),p=n[g]}x+=n[g].dist(n[g+1]),g++;const w=[];let E=0;for(;x<i/2;){const I=n[g],z=n[g+1];if(!z)return!1;let D=n[g-1].angleTo(I)-I.angleTo(z);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:D}),E+=D;x-w[0].distance>l;)E-=w.shift().angleDelta;if(E>h)return!1;g++,x+=I.dist(z)}return!0}function LE(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function FE(n,e,i){return n?.6*e*i:0}function OE(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function pD(n,e,i,l,h,p){const g=FE(i,h,p),x=OE(i,l)*p;let w=0;const E=LE(n)/2;for(let I=0;I<n.length-1;I++){const z=n[I],D=n[I+1],F=z.dist(D);if(w+F>E){const N=(E-w)/F,G=or(z.x,D.x,N),Q=or(z.y,D.y,N),oe=new ra(G,Q,0,D.angleTo(z),I);return!g||BE(n,oe,x,g,e)?oe:void 0}w+=F}}function fD(n,e,i,l,h,p,g,x,w){const E=FE(l,p,g),I=OE(l,h),z=I*g,D=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return e-z<e/4&&(e=z+e/4),NE(n,D?e/2*x%e:(I/2+2*p)*g*x%e,e,E,i,z,D,!1,w)}function NE(n,e,i,l,h,p,g,x,w){const E=p/2,I=LE(n);let z=0,D=e-i,F=[];for(let N=0;N<n.length-1;N++){const G=n[N],Q=n[N+1],oe=G.dist(Q),fe=Q.angleTo(G);for(;D+i<z+oe;){D+=i;const se=(D-z)/oe,he=or(G.x,Q.x,se),ge=or(G.y,Q.y,se);if(he>=0&&he<w&&ge>=0&&ge<w&&D-E>=0&&D+E<=I){const me=new ra(he,ge,0,fe,N);me._round(),l&&!BE(n,me,p,l,h)||F.push(me)}}z+=oe}return x||F.length||g||(F=NE(n,z/2,i,l,h,p,g,!0,w)),F}function UE(n,e,i,l,h){const p=[];for(let g=0;g<n.length;g++){const x=n[g];let w;for(let E=0;E<x.length-1;E++){let I=x[E],z=x[E+1];I.x<e&&z.x<e||(I.x<e?I=new Se(e,I.y+(e-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x<e&&(z=new Se(e,I.y+(e-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y<i&&z.y<i||(I.y<i?I=new Se(I.x+(i-I.y)/(z.y-I.y)*(z.x-I.x),i)._round():z.y<i&&(z=new Se(I.x+(i-I.y)/(z.y-I.y)*(z.x-I.x),i)._round()),I.x>=l&&z.x>=l||(I.x>=l?I=new Se(l,I.y+(l-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x>=l&&(z=new Se(l,I.y+(l-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y>=h&&z.y>=h||(I.y>=h?I=new Se(I.x+(h-I.y)/(z.y-I.y)*(z.x-I.x),h)._round():z.y>=h&&(z=new Se(I.x+(h-I.y)/(z.y-I.y)*(z.x-I.x),h)._round()),w&&I.equals(w[w.length-1])||(w=[I],p.push(w)),w.push(z)))))}}return p}Et(ra,"Anchor");const Fd=1e20;function VE(n,e,i,l,h,p,g,x,w){for(let E=e;E<e+l;E++)jE(n,i*p+E,p,h,g,x,w);for(let E=i;E<i+h;E++)jE(n,E*p+e,1,l,g,x,w)}function jE(n,e,i,l,h,p,g){p[0]=0,g[0]=-Fd,g[1]=Fd,h[0]=n[e];for(let x=1,w=0,E=0;x<l;x++){h[x]=n[e+x*i];const I=x*x;do{const z=p[w];E=(h[x]-h[z]+I-z*z)/(x-z)/2}while(E<=g[w]&&--w>-1);w++,p[w]=x,g[w]=E,g[w+1]=Fd}for(let x=0,w=0;x<l;x++){for(;g[w+1]<x;)w++;const E=p[w],I=x-E;n[e+x*i]=h[E]+I*I}}const ts=2,sy={none:0,ideographs:1,all:2};class bu{constructor(e,i,l){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const l=[];for(const h in e)for(const p of e[h])l.push({stack:h,id:p});Ve(l,({stack:h,id:p},g)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[p];if(w!==void 0)return void g(null,{stack:h,id:p,glyph:w});if(w=this._tinySDF(x,h,p),w)return x.glyphs[p]=w,void g(null,{stack:h,id:p,glyph:w});const E=Math.floor(p/256);if(256*E>65535)return void g(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void g(null,{stack:h,id:p,glyph:w});let I=x.requests[E];I||(I=x.requests[E]=[],bu.loadGlyphRange(h,E,this.url,this.requestManager,(z,D)=>{if(D){x.ascender=D.ascender,x.descender=D.descender;for(const F in D.glyphs)this._doesCharSupportLocalGlyph(+F)||(x.glyphs[+F]=D.glyphs[+F]);x.ranges[E]=!0}for(const F of I)F(z,D);delete x.requests[E]})),I.push((z,D)=>{z?g(z):D&&g(null,{stack:h,id:p,glyph:D.glyphs[p]||null})})},(h,p)=>{if(h)i(h);else if(p){const g={};for(const{stack:x,id:w,glyph:E}of p)g[x]===void 0&&(g[x]={}),g[x].glyphs===void 0&&(g[x].glyphs={}),g[x].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},g[x].ascender=this.entries[x].ascender,g[x].descender=this.entries[x].descender;i(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==sy.none&&(this.localGlyphMode===sy.all?!!this.localFontFamily:!!this.localFontFamily&&(yt["CJK Unified Ideographs"](e)||yt["Hangul Syllables"](e)||yt.Hiragana(e)||yt.Katakana(e)||yt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,i,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let G="400";/bold/i.test(i)?G="900":/medium/i.test(i)?G="500":/light/i.test(i)&&(G="200"),p=e.tinySDF=new bu.TinySDF({fontFamily:h,fontWeight:G,fontSize:24*ts,buffer:3*ts,radius:8*ts}),p.fontWeight=G}if(this.localGlyphs[p.fontWeight][l])return this.localGlyphs[p.fontWeight][l];const g=String.fromCharCode(l),{data:x,width:w,height:E,glyphWidth:I,glyphHeight:z,glyphLeft:D,glyphTop:F,glyphAdvance:N}=p.draw(g);return this.localGlyphs[p.fontWeight][l]={id:l,bitmap:new ea({width:w,height:E},x),metrics:{width:I/ts,height:z/ts,left:D/ts,top:F/ts-27,advance:N/ts,localGlyph:!0}}}}bu.loadGlyphRange=function(n,e,i,l,h){const p=256*e,g=p+255,x=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${p}-${g}`),Lo.Glyphs);ms(x,(w,E)=>{if(w)h(w);else if(E){const I={},z=function(D){return new dm(D).readFields(aD,{})}(E);for(const D of z.glyphs)I[D.id]=D;h(null,{glyphs:I,ascender:z.ascender,descender:z.descender})}})},bu.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=i;const x=this.size=n+4*e,w=this._createCanvas(x),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${g} ${p} ${n}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(n),g=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),w=Math.min(this.size-this.buffer,g+Math.ceil(l)),E=x+2*this.buffer,I=w+2*this.buffer,z=Math.max(E*I,0),D=new Uint8ClampedArray(z),F={data:D,width:E,height:I,glyphWidth:x,glyphHeight:w,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(x===0||w===0)return F;const{ctx:N,buffer:G,gridInner:Q,gridOuter:oe}=this;N.clearRect(G,G,x,w),N.fillText(n,G,G+g);const fe=N.getImageData(G,G,x,w);oe.fill(Fd,0,z),Q.fill(0,0,z);for(let se=0;se<w;se++)for(let he=0;he<x;he++){const ge=fe.data[4*(se*x+he)+3]/255;if(ge===0)continue;const me=(se+G)*E+he+G;if(ge===1)oe[me]=0,Q[me]=Fd;else{const Be=.5-ge;oe[me]=Be>0?Be*Be:0,Q[me]=Be<0?Be*Be:0}}VE(oe,0,0,E,I,E,this.f,this.v,this.z),VE(Q,G,G,x,w,E,this.f,this.v,this.z);for(let se=0;se<z;se++){const he=Math.sqrt(oe[se])-Math.sqrt(Q[se]);D[se]=Math.round(255-255*(he/this.radius+this.cutoff))}return F}};const wu=Ci;function $E(n,e,i,l){const h=[],p=n.image,g=p.pixelRatio,x=p.paddedRect.w-2*wu,w=p.paddedRect.h-2*wu,E=n.right-n.left,I=n.bottom-n.top,z=p.stretchX||[[0,x]],D=p.stretchY||[[0,w]],F=(Oe,Ke)=>Oe+Ke[1]-Ke[0],N=z.reduce(F,0),G=D.reduce(F,0),Q=x-N,oe=w-G;let fe=0,se=N,he=0,ge=G,me=0,Be=Q,De=0,qe=oe;if(p.content&&l){const Oe=p.content;fe=fm(z,0,Oe[0]),he=fm(D,0,Oe[1]),se=fm(z,Oe[0],Oe[2]),ge=fm(D,Oe[1],Oe[3]),me=Oe[0]-fe,De=Oe[1]-he,Be=Oe[2]-Oe[0]-se,qe=Oe[3]-Oe[1]-ge}const ot=(Oe,Ke,Ye,rt)=>{const ut=mm(Oe.stretch-fe,se,E,n.left),$e=gm(Oe.fixed-me,Be,Oe.stretch,N),mt=mm(Ke.stretch-he,ge,I,n.top),Tt=gm(Ke.fixed-De,qe,Ke.stretch,G),_t=mm(Ye.stretch-fe,se,E,n.left),$t=gm(Ye.fixed-me,Be,Ye.stretch,N),ht=mm(rt.stretch-he,ge,I,n.top),Pt=gm(rt.fixed-De,qe,rt.stretch,G),Wt=new Se(ut,mt),lr=new Se(_t,mt),qt=new Se(_t,ht),Lt=new Se(ut,ht),Rr=new Se($e/g,Tt/g),Gt=new Se($t/g,Pt/g),Ht=e*Math.PI/180;if(Ht){const Dr=Math.sin(Ht),Ir=Math.cos(Ht),qr=[Ir,-Dr,Dr,Ir];Wt._matMult(qr),lr._matMult(qr),Lt._matMult(qr),qt._matMult(qr)}const Cr=Oe.stretch+Oe.fixed,zr=Ke.stretch+Ke.fixed;return{tl:Wt,tr:lr,bl:Lt,br:qt,tex:{x:p.paddedRect.x+wu+Cr,y:p.paddedRect.y+wu+zr,w:Ye.stretch+Ye.fixed-Cr,h:rt.stretch+rt.fixed-zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rr,pixelOffsetBR:Gt,minFontScaleX:Be/g/E,minFontScaleY:qe/g/I,isSDF:i}};if(l&&(p.stretchX||p.stretchY)){const Oe=WE(z,Q,N),Ke=WE(D,oe,G);for(let Ye=0;Ye<Oe.length-1;Ye++){const rt=Oe[Ye],ut=Oe[Ye+1];for(let $e=0;$e<Ke.length-1;$e++)h.push(ot(rt,Ke[$e],ut,Ke[$e+1]))}}else h.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return h}function fm(n,e,i){let l=0;for(const h of n)l+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return l}function WE(n,e,i){const l=[{fixed:-wu,stretch:0}];for(const[h,p]of n){const g=l[l.length-1];l.push({fixed:h-g.stretch,stretch:g.stretch}),l.push({fixed:h-g.stretch,stretch:g.stretch+(p-h)})}return l.push({fixed:e+wu,stretch:i}),l}function mm(n,e,i,l){return n/e*i+l}function gm(n,e,i,l){return n-e*i/l}function mD(n,e,i,l){const h=e+n.positionedLines[l].lineOffset;return l===0?i+h/2:i+(h+(e+n.positionedLines[l-1].lineOffset))/2}class gD{constructor(e=[],i=_D){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:l}=this,h=i[e];for(;e>0;){const p=e-1>>1,g=i[p];if(l(h,g)>=0)break;i[e]=g,e=p}i[e]=h}_down(e){const{data:i,compare:l}=this,h=this.length>>1,p=i[e];for(;e<h;){let g=1+(e<<1),x=i[g];const w=g+1;if(w<this.length&&l(i[w],x)<0&&(g=w,x=i[w]),l(x,p)>=0)break;i[e]=x,e=g}i[e]=p}}function _D(n,e){return n<e?-1:n>e?1:0}function yD(n,e=1,i=!1){let l=1/0,h=1/0,p=-1/0,g=-1/0;const x=n[0];for(let F=0;F<x.length;F++){const N=x[F];(!F||N.x<l)&&(l=N.x),(!F||N.y<h)&&(h=N.y),(!F||N.x>p)&&(p=N.x),(!F||N.y>g)&&(g=N.y)}const w=Math.min(p-l,g-h);let E=w/2;const I=new gD([],xD);if(w===0)return new Se(l,h);for(let F=l;F<p;F+=w)for(let N=h;N<g;N+=w)I.push(new Eu(F+E,N+E,E,n));let z=function(F){let N=0,G=0,Q=0;const oe=F[0];for(let fe=0,se=oe.length,he=se-1;fe<se;he=fe++){const ge=oe[fe],me=oe[he],Be=ge.x*me.y-me.x*ge.y;G+=(ge.x+me.x)*Be,Q+=(ge.y+me.y)*Be,N+=3*Be}return new Eu(G/N,Q/N,0,F)}(n),D=I.length;for(;I.length;){const F=I.pop();(F.d>z.d||!z.d)&&(z=F,i&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,D)),F.max-z.d<=e||(E=F.h/2,I.push(new Eu(F.p.x-E,F.p.y-E,E,n)),I.push(new Eu(F.p.x+E,F.p.y-E,E,n)),I.push(new Eu(F.p.x-E,F.p.y+E,E,n)),I.push(new Eu(F.p.x+E,F.p.y+E,E,n)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${z.d}`)),z.p}function xD(n,e){return e.max-n.max}class Eu{constructor(e,i,l,h){this.p=new Se(e,i),this.h=l,this.d=function(p,g){let x=!1,w=1/0;for(let E=0;E<g.length;E++){const I=g[E];for(let z=0,D=I.length,F=D-1;z<D;F=z++){const N=I[z],G=I[F];N.y>p.y!=G.y>p.y&&p.x<(G.x-N.x)*(p.y-N.y)/(G.y-N.y)+N.x&&(x=!x),w=Math.min(w,Nw(p,N,G))}}return(x?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const Su=7,ay=Number.POSITIVE_INFINITY,vD=Math.sqrt(2);function qE(n,[e,i]){let l=0,h=0;if(i===ay){e<0&&(e=0);const p=e/vD;switch(n){case"top-right":case"top-left":h=p-Su;break;case"bottom-right":case"bottom-left":h=-p+Su;break;case"bottom":h=-e+Su;break;case"top":h=e-Su}switch(n){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":h=i-Su;break;case"bottom-right":case"bottom-left":case"bottom":h=-i+Su}switch(n){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,h]}function bD(n,e,i,l,h,p,g,x,w,E){n.createArrays(),n.tilePixelRatio=Mt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const I=n.layers[0].layout,z=n.layers[0]._unevaluatedLayout._values,D={};if(n.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:Q}=n.textSizeData;D.compositeTextSizes=[z["text-size"].possiblyEvaluate(new P(G),x),z["text-size"].possiblyEvaluate(new P(Q),x)]}if(n.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:Q}=n.iconSizeData;D.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new P(G),x),z["icon-size"].possiblyEvaluate(new P(Q),x)]}D.layoutTextSize=z["text-size"].possiblyEvaluate(new P(w+1),x),D.layoutIconSize=z["icon-size"].possiblyEvaluate(new P(w+1),x),D.textMaxSize=z["text-size"].possiblyEvaluate(new P(18),x);const F=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",N=I.get("text-size");for(const G of n.features){const Q=I.get("text-font").evaluate(G,{},x).join(","),oe=N.evaluate(G,{},x),fe=D.layoutTextSize.evaluate(G,{},x),se=(D.layoutIconSize.evaluate(G,{},x),{horizontal:{},vertical:void 0}),he=G.text;let ge,me=[0,0];if(he){const qe=he.toString(),ot=I.get("text-letter-spacing").evaluate(G,{},x)*Un,Oe=I.get("text-line-height").evaluate(G,{},x)*Un,Ke=g_(qe)?ot:0,Ye=I.get("text-anchor").evaluate(G,{},x),rt=I.get("text-variable-anchor");if(!rt){const _t=I.get("text-radial-offset").evaluate(G,{},x);me=_t?qE(Ye,[_t*Un,ay]):I.get("text-offset").evaluate(G,{},x).map($t=>$t*Un)}let ut=F?"center":I.get("text-justify").evaluate(G,{},x);const $e=I.get("symbol-placement")==="point",mt=$e?I.get("text-max-width").evaluate(G,{},x)*Un:1/0,Tt=_t=>{n.allowVerticalPlacement&&ld(qe)&&(se.vertical=iy(he,e,i,h,Q,mt,Oe,Ye,_t,Ke,me,io.vertical,!0,fe,oe))};if(!F&&rt){const _t=ut==="auto"?rt.map(ht=>ly(ht)):[ut];let $t=!1;for(let ht=0;ht<_t.length;ht++){const Pt=_t[ht];if(!se.horizontal[Pt])if($t)se.horizontal[Pt]=se.horizontal[0];else{const Wt=iy(he,e,i,h,Q,mt,Oe,"center",Pt,Ke,me,io.horizontal,!1,fe,oe);Wt&&(se.horizontal[Pt]=Wt,$t=Wt.positionedLines.length===1)}}Tt("left")}else{if(ut==="auto"&&(ut=ly(Ye)),$e||I.get("text-writing-mode").indexOf("horizontal")>=0||!ld(qe)){const _t=iy(he,e,i,h,Q,mt,Oe,Ye,ut,Ke,me,io.horizontal,!1,fe,oe);_t&&(se.horizontal[ut]=_t)}Tt($e?"left":ut)}}let Be=!1;if(G.icon&&G.icon.name){const qe=l[G.icon.name];qe&&(ge=dD(h[G.icon.name],I.get("icon-offset").evaluate(G,{},x),I.get("icon-anchor").evaluate(G,{},x)),Be=qe.sdf,n.sdfIcons===void 0?n.sdfIcons=qe.sdf:n.sdfIcons!==qe.sdf&&gr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(qe.pixelRatio!==n.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const De=HE(se.horizontal)||se.vertical;n.iconsInText||(n.iconsInText=!!De&&De.iconsInText),(De||ge)&&wD(n,G,se,ge,l,D,fe,0,me,Be,g,x,E)}p&&n.generateCollisionDebugBuffers(w,n.collisionBoxArray)}function ly(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wD(n,e,i,l,h,p,g,x,w,E,I,z,D){let F=p.textMaxSize.evaluate(e,{},z);F===void 0&&(F=g);const N=n.layers[0].layout,G=N.get("icon-offset").evaluate(e,{},z),Q=HE(i.horizontal)||i.vertical,oe=D.name==="globe",fe=Un,se=g/fe,he=n.tilePixelRatio*F/fe,ge=(Ye=n.overscaling,n.zoom>18&&Ye>2&&(Ye>>=1),Math.max(Mt/(512*Ye),1)*N.get("symbol-spacing")),me=N.get("text-padding")*n.tilePixelRatio,Be=N.get("icon-padding")*n.tilePixelRatio,De=Ue(N.get("text-max-angle")),qe=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",ot=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Oe=N.get("symbol-placement"),Ke=ge/2;var Ye;const rt=N.get("icon-text-fit");let ut;l&&rt!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(ut=RE(l,i.vertical,rt,N.get("icon-text-fit-padding"),G,se)),Q&&(l=RE(l,Q,rt,N.get("icon-text-fit-padding"),G,se)));const $e=(mt,Tt,_t)=>{if(Tt.x<0||Tt.x>=Mt||Tt.y<0||Tt.y>=Mt)return;let $t=null;if(oe){const{x:ht,y:Pt,z:Wt}=D.projectTilePoint(Tt.x,Tt.y,_t);$t={anchor:new ra(ht,Pt,Wt,0,void 0),up:D.upVector(_t,Tt.x,Tt.y)}}(function(ht,Pt,Wt,lr,qt,Lt,Rr,Gt,Ht,Cr,zr,Dr,Ir,qr,Jr,hn,kr,vn,dn,Hr,hr,pn,Mr,mi,fn){const Vn=ht.addToLineVertexArray(Pt,lr);let Mn,gi,Rn,ns,Cu,Gd,Hd,T2=0,C2=0,I2=0,k2=0,Ey=-1,Sy=-1;const Ts={};let P2=x_("");const sc=Wt?Wt.anchor:Pt;let Ay=0,Ty=0;if(Ht._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ay,Ty]=Ht.layout.get("text-offset").evaluate(hr,{},fn).map(Ni=>Ni*Un):(Ay=Ht.layout.get("text-radial-offset").evaluate(hr,{},fn)*Un,Ty=ay),ht.allowVerticalPlacement&&qt.vertical){const Ni=qt.vertical;if(Jr)Gd=cy(Ni),Gt&&(Hd=cy(Gt));else{const Ui=Ht.layout.get("text-rotate").evaluate(hr,{},fn)+90;Rn=_m(Cr,sc,Pt,zr,Dr,Ir,Ni,qr,Ui,hn),Gt&&(ns=_m(Cr,sc,Pt,zr,Dr,Ir,Gt,vn,Ui))}}if(Lt){const Ni=Ht.layout.get("icon-rotate").evaluate(hr,{},fn),Ui=Ht.layout.get("icon-text-fit")!=="none",Zd=$E(Lt,Ni,Mr,Ui),Iy=Gt?$E(Gt,Ni,Mr,Ui):void 0;gi=_m(Cr,sc,Pt,zr,Dr,Ir,Lt,vn,Ni),T2=4*Zd.length;const z2=ht.iconSizeData;let ac=null;z2.kind==="source"?(ac=[es*Ht.layout.get("icon-size").evaluate(hr,{},fn)],ac[0]>Na&&gr(`${ht.layerIds[0]}: Value for "icon-size" is >= ${Od}. Reduce your "icon-size".`)):z2.kind==="composite"&&(ac=[es*pn.compositeIconSizes[0].evaluate(hr,{},fn),es*pn.compositeIconSizes[1].evaluate(hr,{},fn)],(ac[0]>Na||ac[1]>Na)&&gr(`${ht.layerIds[0]}: Value for "icon-size" is >= ${Od}. Reduce your "icon-size".`)),ht.addSymbols(ht.icon,Zd,ac,Hr,dn,hr,!1,Wt,Pt,Vn.lineStartIndex,Vn.lineLength,-1,mi,fn),Ey=ht.icon.placedSymbolArray.length-1,Iy&&(C2=4*Iy.length,ht.addSymbols(ht.icon,Iy,ac,Hr,dn,hr,io.vertical,Wt,Pt,Vn.lineStartIndex,Vn.lineLength,-1,mi,fn),Sy=ht.icon.placedSymbolArray.length-1)}for(const Ni in qt.horizontal){const Ui=qt.horizontal[Ni];Mn||(P2=x_(Ui.text),Jr?Cu=cy(Ui):Mn=_m(Cr,sc,Pt,zr,Dr,Ir,Ui,qr,Ht.layout.get("text-rotate").evaluate(hr,{},fn),hn));const Zd=Ui.positionedLines.length===1;if(I2+=GE(ht,Wt,Pt,Ui,Rr,Ht,Jr,hr,hn,Vn,qt.vertical?io.horizontal:io.horizontalOnly,Zd?Object.keys(qt.horizontal):[Ni],Ts,Ey,pn,mi,fn),Zd)break}qt.vertical&&(k2+=GE(ht,Wt,Pt,qt.vertical,Rr,Ht,Jr,hr,hn,Vn,io.vertical,["vertical"],Ts,Sy,pn,mi,fn));let qa=-1;const Cy=(Ni,Ui)=>Ni?Math.max(Ni,Ui):Ui;qa=Cy(Cu,qa),qa=Cy(Gd,qa),qa=Cy(Hd,qa);const KD=qa>-1?1:0;ht.glyphOffsetArray.length>=Va.MAX_GLYPHS&&gr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hr.sortKey!==void 0&&ht.addToSortKeyRanges(ht.symbolInstances.length,hr.sortKey),ht.symbolInstances.emplaceBack(sc.x,sc.y,sc.z,Pt.x,Pt.y,Ts.right>=0?Ts.right:-1,Ts.center>=0?Ts.center:-1,Ts.left>=0?Ts.left:-1,Ts.vertical>=0?Ts.vertical:-1,Ey,Sy,P2,Mn!==void 0?Mn:ht.collisionBoxArray.length,Mn!==void 0?Mn+1:ht.collisionBoxArray.length,Rn!==void 0?Rn:ht.collisionBoxArray.length,Rn!==void 0?Rn+1:ht.collisionBoxArray.length,gi!==void 0?gi:ht.collisionBoxArray.length,gi!==void 0?gi+1:ht.collisionBoxArray.length,ns||ht.collisionBoxArray.length,ns?ns+1:ht.collisionBoxArray.length,zr,I2,k2,T2,C2,KD,0,Ay,Ty,qa)})(n,Tt,$t,mt,i,l,h,ut,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,me,qe,w,0,Be,ot,G,e,p,E,I,z)};if(Oe==="line")for(const mt of UE(e.geometry,0,0,Mt,Mt)){const Tt=fD(mt,ge,De,i.vertical||Q,l,fe,he,n.overscaling,Mt);for(const _t of Tt)Q&&ED(n,Q.text,Ke,_t)||$e(mt,_t,z)}else if(Oe==="line-center"){for(const mt of e.geometry)if(mt.length>1){const Tt=pD(mt,De,i.vertical||Q,l,fe,he);Tt&&$e(mt,Tt,z)}}else if(e.type==="Polygon")for(const mt of X_(e.geometry,0)){const Tt=yD(mt,16);$e(mt[0],new ra(Tt.x,Tt.y,0,0,void 0),z)}else if(e.type==="LineString")for(const mt of e.geometry)$e(mt,new ra(mt[0].x,mt[0].y,0,0,void 0),z);else if(e.type==="Point")for(const mt of e.geometry)for(const Tt of mt)$e([Tt],new ra(Tt.x,Tt.y,0,0,void 0),z)}const Od=255,Na=Od*es;function GE(n,e,i,l,h,p,g,x,w,E,I,z,D,F,N,G,Q){const oe=function(he,ge,me,Be,De,qe,ot,Oe){const Ke=[];if(ge.positionedLines.length===0)return Ke;const Ye=Be.layout.get("text-rotate").evaluate(qe,{})*Math.PI/180,rt=function(_t){const $t=_t[0],ht=_t[1],Pt=$t*ht;return Pt>0?[$t,-ht]:Pt<0?[-$t,ht]:$t===0?[ht,$t]:[ht,-$t]}(me);let ut=Math.abs(ge.top-ge.bottom);for(const _t of ge.positionedLines)ut-=_t.lineOffset;const $e=ge.positionedLines.length,mt=ut/$e;let Tt=ge.top-me[1];for(let _t=0;_t<$e;++_t){const $t=ge.positionedLines[_t];Tt=mD(ge,mt,Tt,_t);for(const ht of $t.positionedGlyphs){if(!ht.rect)continue;const Pt=ht.rect||{};let Wt=TE+1,lr=!0,qt=1,Lt=0;if(ht.imageName){const Mr=ot[ht.imageName];if(!Mr)continue;if(Mr.sdf){gr("SDF images are not supported in formatted text and will be ignored.");continue}lr=!1,qt=Mr.pixelRatio,Wt=Ci/qt}const Rr=(De||Oe)&&ht.vertical,Gt=ht.metrics.advance*ht.scale/2,Ht=ht.metrics,Cr=ht.rect;if(Cr===null)continue;Oe&&ge.verticalizable&&(Lt=ht.imageName?Gt-ht.metrics.width*ht.scale/2:0);const zr=De?[ht.x+Gt,ht.y]:[0,0];let Dr=[0,0],Ir=[0,0],qr=!1;De||(Rr?(Ir=[ht.x+Gt+rt[0],ht.y+rt[1]-Lt],qr=!0):Dr=[ht.x+Gt+me[0],ht.y+me[1]-Lt]);const Jr=Cr.w*ht.scale/(qt*(ht.localGlyph?ts:1)),hn=Cr.h*ht.scale/(qt*(ht.localGlyph?ts:1));let kr,vn,dn,Hr;if(Rr){const Mr=ht.y-Tt,mi=new Se(-Gt,Gt-Mr),fn=-Math.PI/2,Vn=new Se(...Ir);kr=new Se(-Gt+Dr[0],Dr[1]),kr._rotateAround(fn,mi)._add(Vn),kr.x+=-Mr+Gt,kr.y-=(Ht.left-Wt)*ht.scale;const Mn=ht.imageName?Ht.advance*ht.scale:Un*ht.scale,gi=String.fromCharCode(ht.glyph);K4(gi)?kr.x+=(1-Wt)*ht.scale:Y4(gi)?kr.x+=Mn-Ht.height*ht.scale+(-Wt-1)*ht.scale:kr.x+=ht.imageName||Ht.width+2*Wt===Cr.w&&Ht.height+2*Wt===Cr.h?(Mn-hn)/2:(Mn-(Ht.height+2*Wt)*ht.scale)/2,vn=new Se(kr.x,kr.y-Jr),dn=new Se(kr.x+hn,kr.y),Hr=new Se(kr.x+hn,kr.y-Jr)}else{const Mr=(Ht.left-Wt)*ht.scale-Gt+Dr[0],mi=(-Ht.top-Wt)*ht.scale+Dr[1],fn=Mr+Jr,Vn=mi+hn;kr=new Se(Mr,mi),vn=new Se(fn,mi),dn=new Se(Mr,Vn),Hr=new Se(fn,Vn)}if(Ye){let Mr;Mr=De?new Se(0,0):qr?new Se(rt[0],rt[1]):new Se(me[0],me[1]),kr._rotateAround(Ye,Mr),vn._rotateAround(Ye,Mr),dn._rotateAround(Ye,Mr),Hr._rotateAround(Ye,Mr)}const hr=new Se(0,0),pn=new Se(0,0);Ke.push({tl:kr,tr:vn,bl:dn,br:Hr,tex:Pt,writingMode:ge.writingMode,glyphOffset:zr,sectionIndex:ht.sectionIndex,isSDF:lr,pixelOffsetTL:hr,pixelOffsetBR:pn,minFontScaleX:0,minFontScaleY:0})}}return Ke}(0,l,w,p,g,x,h,n.allowVerticalPlacement),fe=n.textSizeData;let se=null;fe.kind==="source"?(se=[es*p.layout.get("text-size").evaluate(x,{},Q)],se[0]>Na&&gr(`${n.layerIds[0]}: Value for "text-size" is >= ${Od}. Reduce your "text-size".`)):fe.kind==="composite"&&(se=[es*N.compositeTextSizes[0].evaluate(x,{},Q),es*N.compositeTextSizes[1].evaluate(x,{},Q)],(se[0]>Na||se[1]>Na)&&gr(`${n.layerIds[0]}: Value for "text-size" is >= ${Od}. Reduce your "text-size".`)),n.addSymbols(n.text,oe,se,w,g,x,I,e,i,E.lineStartIndex,E.lineLength,F,G,Q);for(const he of z)D[he]=n.text.placedSymbolArray.length-1;return 4*oe.length}function HE(n){for(const e in n)return n[e];return null}function _m(n,e,i,l,h,p,g,x,w,E){let I=g.top,z=g.bottom,D=g.left,F=g.right;const N=g.collisionPadding;if(N&&(D-=N[0],I-=N[1],F+=N[2],z+=N[3]),w){const G=new Se(D,I),Q=new Se(F,I),oe=new Se(D,z),fe=new Se(F,z),se=Ue(w);let he=new Se(0,0);E&&(he=new Se(E[0],E[1])),G._rotateAround(se,he),Q._rotateAround(se,he),oe._rotateAround(se,he),fe._rotateAround(se,he),D=Math.min(G.x,Q.x,oe.x,fe.x),F=Math.max(G.x,Q.x,oe.x,fe.x),I=Math.min(G.y,Q.y,oe.y,fe.y),z=Math.max(G.y,Q.y,oe.y,fe.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,D,I,F,z,x,l,h,p),n.length-1}function cy(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function ED(n,e,i,l){const h=n.compareText;if(e in h){const p=h[e];for(let g=p.length-1;g>=0;g--)if(l.dist(p[g])<i)return!0}else h[e]=[];return h[e].push(l),!1}function ZE(n,e){const i=n.fovAboveCenter,l=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,h=(n._camera.position[2]*n.worldSize-l)/Math.cos(n._pitch),p=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01)),g=Math.sin(n._pitch)*p+h;return Math.min(1.01*g,h*(1/n._horizonShift))}function ic(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),l=n.x*i,h=(n.x+1)*i,p=n.y*i,g=(n.y+1)*i,x=no(l),w=no(h),E=Xn(p),I=Xn(g),z=e.project(x,E),D=e.project(w,E),F=e.project(w,I),N=e.project(x,I);let G=Math.min(z.x,D.x,F.x,N.x),Q=Math.min(z.y,D.y,F.y,N.y),oe=Math.max(z.x,D.x,F.x,N.x),fe=Math.max(z.y,D.y,F.y,N.y);const se=i/16;function he(me,Be,De,qe,ot,Oe){const Ke=(De+ot)/2,Ye=(qe+Oe)/2,rt=e.project(no(Ke),Xn(Ye)),ut=Math.max(0,G-rt.x,Q-rt.y,rt.x-oe,rt.y-fe);G=Math.min(G,rt.x),oe=Math.max(oe,rt.x),Q=Math.min(Q,rt.y),fe=Math.max(fe,rt.y),ut>se&&(he(me,rt,De,qe,Ke,Ye),he(rt,Be,Ke,Ye,ot,Oe))}he(z,D,l,p,h,p),he(D,F,h,p,h,g),he(F,N,h,g,l,g),he(N,z,l,g,l,p),G-=se,Q-=se,oe+=se,fe+=se;const ge=1/Math.max(oe-G,fe-Q);return{scale:ge,x:G*ge,y:Q*ge,x2:oe*ge,y2:fe*ge,projection:e}}const SD=Yo(new Float32Array(16));class Ua{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Tr(0,0)}projectTilePoint(e,i,l){return{x:e,y:i,z:0}}locationPoint(e,i,l=!0){return e._coordinatePoint(e.locationCoordinate(i),l)}pixelsPerMeter(e,i){return Qo(1,e)*i}pixelSpaceConversion(e,i,l){return 1}farthestPixelDistance(e){return ZE(e,e.pixelsPerMeter)}pointCoordinate(e,i,l,h){const p=e.horizonLineFromTop(!1),g=new Se(i,Math.max(p,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,h))}pointCoordinate3D(e,i,l){const h=new Se(i,l);if(e.elevation)return e.elevation.pointCoordinate(h);{const p=this.pointCoordinate(e,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const l=e.horizonLineFromTop();return i.y<l}createInversionMatrix(e,i){return SD}createTileMatrix(e,i,l){let h,p,g;const x=l.canonical,w=Yo(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=ic(x,this);h=1,p=E.x+l.wrap*E.scale,g=E.y,Yl(w,w,[h/E.scale,h/E.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(x.z),p=(x.x+Math.pow(2,x.z)*l.wrap)*h,g=x.y*h;return md(w,w,[p,g,0]),Yl(w,w,[h/Mt,h/Mt,1]),w}upVector(e,i,l){return[0,0,1]}upVectorScale(e,i,l){return{metersToTile:1}}}class AD extends Ua{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,l]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Ue(i));this.n=(h+Math.sin(Ue(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:l,c:h,r0:p}=this,g=Ue(e-this.center[0]),x=Ue(i),w=Math.sqrt(h-2*l*Math.sin(x))/l;return{x:w*Math.sin(g*l),y:w*Math.cos(g*l)-p,z:0}}unproject(e,i){const{n:l,c:h,r0:p}=this,g=p+i;let x=Math.atan2(e,Math.abs(g))*Math.sign(g);g*l<0&&(x-=Math.PI*Math.sign(e)*Math.sign(g));const w=Ue(this.center[0])*l;x=ft(x,-Math.PI-w,Math.PI-w);const E=Ge(je(x/l)+this.center[0],-180,180),I=Math.asin(Ge((h-(e*e+g*g)*l*l)/(2*l),-1,1)),z=Ge(je(I),-Kn,Kn);return new Tr(E,z)}}const Nd=1.340264,Ud=-.081106,Vd=893e-6,jd=.003796,ym=Math.sqrt(3)/2;class TD extends Ua{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(ym*Math.sin(i)),h=l*l,p=h*h*h;return{x:.5*(e*Math.cos(l)/(ym*(Nd+3*Ud*h+p*(7*Vd+9*jd*h)))/Math.PI+.5),y:1-.5*(l*(Nd+Ud*h+p*(Vd+jd*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=l*l,p=h*h*h;for(let I,z,D,F=0;F<12&&(z=l*(Nd+Ud*h+p*(Vd+jd*h))-i,D=Nd+3*Ud*h+p*(7*Vd+9*jd*h),I=z/D,l=Ge(l-I,-Math.PI/3,Math.PI/3),h=l*l,p=h*h*h,!(Math.abs(I)<1e-12));++F);const g=ym*e*(Nd+3*Ud*h+p*(7*Vd+9*jd*h))/Math.cos(l),x=Math.asin(Math.sin(l)/ym),w=Ge(180*g/Math.PI,-180,180),E=Ge(180*x/Math.PI,-Kn,Kn);return new Tr(w,E)}}class CD extends Ua{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const l=360*(e-.5),h=Ge(360*(.5-i),-Kn,Kn);return new Tr(l,h)}}const Au=Math.PI/2;function xm(n){return Math.tan((Au+n)/2)}class ID extends Ua{constructor(e){super(e),this.center=e.center||[0,30];const[i,l]=this.parallels=e.parallels||[30,30];let h=Ue(i),p=Ue(l);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const g=Math.cos(h),x=xm(h);this.n=h===p?Math.sin(h):Math.log(g/Math.cos(p))/Math.log(xm(p)/x),this.f=g*Math.pow(xm(h),this.n)/this.n}project(e,i){i=Ue(i),this.southernCenter&&(i=-i),e=Ue(e-this.center[0]);const l=1e-6,{n:h,f:p}=this;p>0?i<-Au+l&&(i=-Au+l):i>Au-l&&(i=Au-l);const g=p/Math.pow(xm(i),h);let x=g*Math.sin(h*e),w=p-g*Math.cos(h*e);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:h}=this,p=h-i,g=Math.sign(p),x=Math.sign(l)*Math.sqrt(e*e+p*p);let w=Math.atan2(e,Math.abs(p))*g;p*l<0&&(w-=Math.PI*Math.sign(e)*g);const E=Ge(je(w/l)+this.center[0],-180,180),I=Ge(je(2*Math.atan(Math.pow(h/x,1/l))-Au),-Kn,Kn);return new Tr(E,this.southernCenter?-I:I)}}class XE extends Ua{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:bs(e),y:ws(i),z:0}}unproject(e,i){const l=no(e),h=Xn(i);return new Tr(l,h)}}const KE=Ue(Kn);class kD extends Ua{project(e,i){const l=(i=Ue(i))*i,h=l*l;return{x:.5*((e=Ue(e))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=25,p=0,g=l*l;do{g=l*l;const E=g*g;p=(l*(1.007226+g*(.015085+E*(.028874*g-.044475-.005916*E)))-i)/(1.007226+g*(.045255+E*(.259866*g-.311325-.005916*11*E))),l=Ge(l-p,-KE,KE)}while(Math.abs(p)>1e-6&&--h>0);g=l*l;const x=Ge(je(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),w=je(l);return new Tr(x,w)}}const YE=Ue(Kn);class PD extends Ua{project(e,i){i=Ue(i),e=Ue(e);const l=Math.cos(i),h=2/Math.PI,p=Math.acos(l*Math.cos(e/2)),g=Math.sin(p)/p,x=.5*(e*h+2*l*Math.sin(e/2)/g)||0,w=.5*(i+Math.sin(i)/g)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let l=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,p=25;const g=1e-6;let x=0,w=0;do{const E=Math.cos(h),I=Math.sin(h),z=2*I*E,D=I*I,F=E*E,N=Math.cos(l/2),G=Math.sin(l/2),Q=2*N*G,oe=G*G,fe=1-F*N*N,se=fe?1/fe:0,he=fe?Math.acos(E*N)*Math.sqrt(1/fe):0,ge=.5*(2*he*E*G+2*l/Math.PI)-e,me=.5*(he*I+h)-i,Be=.5*se*(F*oe+he*E*N*D)+1/Math.PI,De=se*(Q*z/4-he*I*G),qe=.125*se*(z*G-he*I*F*Q),ot=.5*se*(D*N+he*oe*E)+.5,Oe=De*qe-ot*Be;x=(me*De-ge*ot)/Oe,w=(ge*qe-me*Be)/Oe,l=Ge(l-x,-Math.PI,Math.PI),h=Ge(h-w,-YE,YE)}while((Math.abs(x)>g||Math.abs(w)>g)&&--p>0);return new Tr(je(l),je(h))}}class JE extends Ua{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ue(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:l,cosPhi:h}=this;return{x:Ue(e)*h*l+.5,y:-Math.sin(Ue(i))/h*l+.5,z:0}}unproject(e,i){const{scale:l,cosPhi:h}=this,p=-(i-.5)/l,g=Ge(je((e-.5)/l)/h,-180,180),x=Math.asin(Ge(p*h,-1,1)),w=Ge(je(x),-Kn,Kn);return new Tr(g,w)}}class zD extends XE{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,l){const h=Ed(e,i,l);return nn(h,h,Sd(vs(l))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i){const l=uu(i.lat,i.lng),h=di([],l),p=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;xd(l,l,h,Qo(1,0)*Mt*p);const g=Yo(new Float64Array(16));return Kl(g,e.pixelMatrix,e.globeMatrix),nn(l,l,g),new Se(l[0],l[1])}pixelsPerMeter(e,i){return Qo(1,0)*i}pixelSpaceConversion(e,i,l){const h=Qo(1,e)*i,p=or(Qo(1,45)*i,h,l);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,l){const h=M_(vs(l.canonical));return Kl(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:l}=e,h=Sd(vs(i));return Hf(h,h,Ue(l.lng)),E_(h,h,Ue(l.lat)),Yl(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,l,h){return Aw(e,i,l,!0)||new du(0,0)}pointCoordinate3D(e,i,l){const h=this.pointCoordinate(e,i,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!Aw(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(h,p){const g=h.cameraToCenterDistance,x=h._centerAltitude*p,w=h._camera,E=h._camera.forward(),I=Js([],ro([],E,-g),[0,0,x]),z=h.worldSize/(2*Math.PI),D=[0,0,-z],F=h.width/h.height,N=Math.tan(h.fovAboveCenter),G=ro([],w.up(),N),Q=ro([],w.right(),N*F),oe=di([],Js([],Js([],E,G),Q)),fe=[];let se;if(new C_(I,oe).closestPointOnSphere(D,z,fe)){const he=Js([],fe,D),ge=Jo([],he,I);se=Math.cos(h.fovAboveCenter)*gd(ge)}else{const he=Jo([],I,D),ge=Jo([],D,I);di(ge,ge);const me=gd(he)-z;se=Math.sqrt(me*(me+2*z));const Be=Math.acos(se/(z+me))-Math.acos(Ao(E,ge));se*=Math.cos(Be)}return 1.01*se}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=hu(e.zoom);if(l>0){const h=ZE(e,Qo(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return or(i,h+p*(1-Math.cos(g)),Math.pow(l,10))}return i}upVector(e,i,l){return Ed(i,l,e,1)}upVectorScale(e){return{metersToTile:Zf(Kf(vs(e)))}}}function QE(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new XE(n);case"equirectangular":return new CD(n);case"naturalEarth":return new kD(n);case"equalEarth":return new TD(n);case"winkelTripel":return new PD(n);case"albers":return i?new JE(n):new AD(n);case"lambertConformalConic":return i?new JE(n):new ID(n);case"globe":return new zD(n)}throw new Error(`Invalid projection name: ${n.name}`)}const DD=sm.types,MD=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vm(n,e,i,l,h,p,g,x,w,E,I,z,D){const F=x?Math.min(Na,Math.round(x[0])):0,N=x?Math.min(Na,Math.round(x[1])):0;n.emplaceBack(e,i,Math.round(32*l),Math.round(32*h),p,g,(F<<1)+(w?1:0),N,16*E,16*I,256*z,256*D)}function bm(n,e,i,l,h,p,g){n.emplaceBack(e,i,l,h,p,g)}function wm(n,e,i,l,h){n.emplaceBack(e,i,l,h),n.emplaceBack(e,i,l,h),n.emplaceBack(e,i,l,h),n.emplaceBack(e,i,l,h)}function RD(n){for(const e of n.sections)if(y_(e.text))return!0;return!1}class uy{constructor(e){this.layoutVertexArray=new Qe,this.indexArray=new It,this.programConfigurations=e,this.segments=new cn,this.dynamicLayoutVertexArray=new nt,this.opacityVertexArray=new kt,this.placedSymbolArray=new ln,this.globeExtVertexArray=new lt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,j4.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,W4.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,MD,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$4.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Et(uy,"SymbolBuffers");class hy{constructor(e,i,l){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new l,this.segments=new cn,this.collisionVertexArray=new er,this.collisionVertexArrayExt=new Yt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,q4.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,G4.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Et(hy,"CollisionBuffers");class Va{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Yo([]),this.placementViewportMatrix=Yo([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Q_(this.zoom,i["text-size"]),this.iconSizeData=Q_(this.zoom,i["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),p=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(g=>io[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new uy(new Xl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new uy(new Xl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new hi,this.lineVertexArray=new ou,this.symbolInstances=new Lr}calculateGlyphDependencies(e,i,l,h,p){for(let g=0;g<e.length;g++)if(i[e.charCodeAt(g)]=!0,h&&p){const x=Bd[e.charAt(g)];x&&(i[x.charCodeAt(0)]=!0)}}populate(e,i,l,h){const p=this.layers[0],g=p.layout,x=this.projection.name==="globe",w=g.get("text-font"),E=g.get("text-field"),I=g.get("icon-image"),z=(E.value.kind!=="constant"||E.value.value instanceof ui&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),D=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,F=g.get("symbol-sort-key");if(this.features=[],!z&&!D)return;const N=i.iconDependencies,G=i.glyphDependencies,Q=i.availableImages,oe=new P(this.zoom);for(const{feature:fe,id:se,index:he,sourceLayerIndex:ge}of e){const me=p._featureFilter.needGeometry,Be=tc(fe,me);if(!p._featureFilter.filter(oe,Be,l))continue;if(me||(Be.geometry=Qs(fe,l,h)),x&&fe.type!==1&&l.z<=5){const Oe=Be.geometry,Ke=.98078528056,Ye=(rt,ut)=>Ao(Ed(rt.x,rt.y,l,1),Ed(ut.x,ut.y,l,1))<Ke;for(let rt=0;rt<Oe.length;rt++)Oe[rt]=Wz(Oe[rt],Ye)}let De,qe;if(z){const Oe=p.getValueAndResolveTokens("text-field",Be,l,Q),Ke=ui.factory(Oe);RD(Ke)&&(this.hasRTLText=!0),(!this.hasRTLText||v()==="unavailable"||this.hasRTLText&&T.isParsed())&&(De=X4(Ke,p,Be))}if(D){const Oe=p.getValueAndResolveTokens("icon-image",Be,l,Q);qe=Oe instanceof Mi?Oe:Mi.fromString(Oe)}if(!De&&!qe)continue;const ot=this.sortFeaturesByKey?F.evaluate(Be,{},l):void 0;if(this.features.push({id:se,text:De,icon:qe,index:he,sourceLayerIndex:ge,geometry:Be.geometry,properties:fe.properties,type:DD[fe.type],sortKey:ot}),qe&&(N[qe.name]=!0),De){const Oe=w.evaluate(Be,{},l).join(","),Ke=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(io.vertical)>=0;for(const Ye of De.sections)if(Ye.image)N[Ye.image.name]=!0;else{const rt=ld(De.toString()),ut=Ye.fontStack||Oe,$e=G[ut]=G[ut]||{};this.calculateGlyphDependencies(Ye.text,$e,Ke,this.allowVerticalPlacement,rt)}}}g.get("symbol-placement")==="line"&&(this.features=function(fe){const se={},he={},ge=[];let me=0;function Be(Oe){ge.push(fe[Oe]),me++}function De(Oe,Ke,Ye){const rt=he[Oe];return delete he[Oe],he[Ke]=rt,ge[rt].geometry[0].pop(),ge[rt].geometry[0]=ge[rt].geometry[0].concat(Ye[0]),rt}function qe(Oe,Ke,Ye){const rt=se[Ke];return delete se[Ke],se[Oe]=rt,ge[rt].geometry[0].shift(),ge[rt].geometry[0]=Ye[0].concat(ge[rt].geometry[0]),rt}function ot(Oe,Ke,Ye){const rt=Ye?Ke[0][Ke[0].length-1]:Ke[0][0];return`${Oe}:${rt.x}:${rt.y}`}for(let Oe=0;Oe<fe.length;Oe++){const Ke=fe[Oe],Ye=Ke.geometry,rt=Ke.text?Ke.text.toString():null;if(!rt){Be(Oe);continue}const ut=ot(rt,Ye),$e=ot(rt,Ye,!0);if(ut in he&&$e in se&&he[ut]!==se[$e]){const mt=qe(ut,$e,Ye),Tt=De(ut,$e,ge[mt].geometry);delete se[ut],delete he[$e],he[ot(rt,ge[Tt].geometry,!0)]=Tt,ge[mt].geometry=null}else ut in he?De(ut,$e,Ye):$e in se?qe(ut,$e,Ye):(Be(Oe),se[ut]=me-1,he[$e]=me-1)}return ge.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((fe,se)=>fe.sortKey-se.sortKey)}update(e,i,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,l,h),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,l,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=QE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:p}of i)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,i,l,h,p,g,x,w,E,I,z,D,F,N){const G=e.indexArray,Q=e.layoutVertexArray,oe=e.globeExtVertexArray,fe=e.segments.prepareSegment(4*i.length,Q,G,this.canOverlap?g.sortKey:void 0),se=this.glyphOffsetArray.length,he=fe.vertexLength,ge=this.allowVerticalPlacement&&x===io.vertical?Math.PI/2:0,me=g.text&&g.text.sections;for(let De=0;De<i.length;De++){const{tl:qe,tr:ot,bl:Oe,br:Ke,tex:Ye,pixelOffsetTL:rt,pixelOffsetBR:ut,minFontScaleX:$e,minFontScaleY:mt,glyphOffset:Tt,isSDF:_t,sectionIndex:$t}=i[De],ht=fe.vertexLength,Pt=Tt[1];if(vm(Q,E.x,E.y,qe.x,Pt+qe.y,Ye.x,Ye.y,l,_t,rt.x,rt.y,$e,mt),vm(Q,E.x,E.y,ot.x,Pt+ot.y,Ye.x+Ye.w,Ye.y,l,_t,ut.x,rt.y,$e,mt),vm(Q,E.x,E.y,Oe.x,Pt+Oe.y,Ye.x,Ye.y+Ye.h,l,_t,rt.x,ut.y,$e,mt),vm(Q,E.x,E.y,Ke.x,Pt+Ke.y,Ye.x+Ye.w,Ye.y+Ye.h,l,_t,ut.x,ut.y,$e,mt),w){const{x:Wt,y:lr,z:qt}=w.anchor,[Lt,Rr,Gt]=w.up;bm(oe,Wt,lr,qt,Lt,Rr,Gt),bm(oe,Wt,lr,qt,Lt,Rr,Gt),bm(oe,Wt,lr,qt,Lt,Rr,Gt),bm(oe,Wt,lr,qt,Lt,Rr,Gt),wm(e.dynamicLayoutVertexArray,Wt,lr,qt,ge)}else wm(e.dynamicLayoutVertexArray,E.x,E.y,E.z,ge);G.emplaceBack(ht,ht+1,ht+2),G.emplaceBack(ht+1,ht+2,ht+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Tt[0]),De!==i.length-1&&$t===i[De+1].sectionIndex||e.programConfigurations.populatePaintArrays(Q.length,g,g.index,{},F,N,me&&me[$t])}const Be=w?w.anchor:E;e.placedSymbolArray.emplaceBack(Be.x,Be.y,Be.z,E.x,E.y,se,this.glyphOffsetArray.length-se,he,I,z,E.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],x,0,!1,0,D,0)}_commitLayoutVertex(e,i,l,h,p,g,x){e.emplaceBack(i,l,h,p,g,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,l,h,p,g,x){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),E=w.vertexLength,I=x.tileAnchorX,z=x.tileAnchorY;for(let F=0;F<4;F++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),l.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,I,z,new Se(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,I,z,new Se(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,I,z,new Se(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,I,z,new Se(e.x1,e.y2)),w.vertexLength+=4;const D=l.indexArray;D.emplaceBack(E,E+1),D.emplaceBack(E+1,E+2),D.emplaceBack(E+2,E+3),D.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,l,h,p,g){for(let x=h;x<p;x++){const w=l.get(x),E=this.getSymbolInstanceTextSize(e,g,i,x);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,l,h,p,g){for(let x=h;x<p;x++){const w=l.get(x),E=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hy(At,yE.members,Dn),this.iconCollisionBox=new hy(At,yE.members,Dn);const l=_u(this.iconSizeData,e),h=_u(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(h,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,l,h){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),g=um(this.textSizeData,e,p)/Un;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,l){const h=this.icon.placedSymbolArray.get(l),p=um(this.iconSizeData,e,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,l){e.emplaceBack(i,-l,-l),e.emplaceBack(i,l,-l),e.emplaceBack(i,l,l),e.emplaceBack(i,-l,l)}_updateTextDebugCollisionBoxes(e,i,l,h,p,g){for(let x=h;x<p;x++){const w=l.get(x),E=this.getSymbolInstanceTextSize(e,g,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(e,i,l,h,p,g){for(let x=h;x<p;x++){const w=l.get(x),E=this.getSymbolInstanceIconSize(e,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=_u(this.iconSizeData,e),h=_u(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(h,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(l,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(l,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,l,h,p,g,x,w,E){const I={};if(i<l){const{x1:z,y1:D,x2:F,y2:N,padding:G,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:se,tileAnchorY:he,featureIndex:ge}=e.get(i);I.textBox={x1:z,y1:D,x2:F,y2:N,padding:G,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:se,tileAnchorY:he},I.textFeatureIndex=ge}if(h<p){const{x1:z,y1:D,x2:F,y2:N,padding:G,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:se,tileAnchorY:he,featureIndex:ge}=e.get(h);I.verticalTextBox={x1:z,y1:D,x2:F,y2:N,padding:G,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:se,tileAnchorY:he},I.verticalTextFeatureIndex=ge}if(g<x){const{x1:z,y1:D,x2:F,y2:N,padding:G,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:se,tileAnchorY:he,featureIndex:ge}=e.get(g);I.iconBox={x1:z,y1:D,x2:F,y2:N,padding:G,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:se,tileAnchorY:he},I.iconFeatureIndex=ge}if(w<E){const{x1:z,y1:D,x2:F,y2:N,padding:G,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:se,tileAnchorY:he,featureIndex:ge}=e.get(w);I.verticalIconBox={x1:z,y1:D,x2:F,y2:N,padding:G,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:fe,tileAnchorX:se,tileAnchorY:he},I.verticalIconFeatureIndex=ge}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const l=e.placedSymbolArray.get(i),h=l.vertexStartIndex+4*l.numGlyphs;for(let p=l.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),l=Math.cos(e),h=[],p=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const w=this.symbolInstances.get(x);h.push(0|Math.round(i*w.tileAnchorX+l*w.tileAnchorY)),p.push(w.featureIndex)}return g.sort((x,w)=>h[x]-h[w]||p[w]-p[x]),g}addToSortKeyRanges(e,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=l;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Et(Va,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Va.MAX_GLYPHS=65535,Va.addDynamicAttributes=wm;const BD=new ce({"symbol-placement":new q(We.layout_symbol["symbol-placement"]),"symbol-spacing":new q(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new q(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ee(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new q(We.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new q(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new q(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new q(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new q(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new ee(We.layout_symbol["icon-size"]),"icon-text-fit":new q(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new q(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new ee(We.layout_symbol["icon-image"]),"icon-rotate":new ee(We.layout_symbol["icon-rotate"]),"icon-padding":new q(We.layout_symbol["icon-padding"]),"icon-keep-upright":new q(We.layout_symbol["icon-keep-upright"]),"icon-offset":new ee(We.layout_symbol["icon-offset"]),"icon-anchor":new ee(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new q(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new q(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new q(We.layout_symbol["text-rotation-alignment"]),"text-field":new ee(We.layout_symbol["text-field"]),"text-font":new ee(We.layout_symbol["text-font"]),"text-size":new ee(We.layout_symbol["text-size"]),"text-max-width":new ee(We.layout_symbol["text-max-width"]),"text-line-height":new ee(We.layout_symbol["text-line-height"]),"text-letter-spacing":new ee(We.layout_symbol["text-letter-spacing"]),"text-justify":new ee(We.layout_symbol["text-justify"]),"text-radial-offset":new ee(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new q(We.layout_symbol["text-variable-anchor"]),"text-anchor":new ee(We.layout_symbol["text-anchor"]),"text-max-angle":new q(We.layout_symbol["text-max-angle"]),"text-writing-mode":new q(We.layout_symbol["text-writing-mode"]),"text-rotate":new ee(We.layout_symbol["text-rotate"]),"text-padding":new q(We.layout_symbol["text-padding"]),"text-keep-upright":new q(We.layout_symbol["text-keep-upright"]),"text-transform":new ee(We.layout_symbol["text-transform"]),"text-offset":new ee(We.layout_symbol["text-offset"]),"text-allow-overlap":new q(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new q(We.layout_symbol["text-ignore-placement"]),"text-optional":new q(We.layout_symbol["text-optional"])});var dy={paint:new ce({"icon-opacity":new ee(We.paint_symbol["icon-opacity"]),"icon-color":new ee(We.paint_symbol["icon-color"]),"icon-halo-color":new ee(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new ee(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ee(We.paint_symbol["icon-halo-blur"]),"icon-translate":new q(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new q(We.paint_symbol["icon-translate-anchor"]),"text-opacity":new ee(We.paint_symbol["text-opacity"]),"text-color":new ee(We.paint_symbol["text-color"],{runtimeType:Ai,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new ee(We.paint_symbol["text-halo-color"]),"text-halo-width":new ee(We.paint_symbol["text-halo-width"]),"text-halo-blur":new ee(We.paint_symbol["text-halo-blur"]),"text-translate":new q(We.paint_symbol["text-translate"]),"text-translate-anchor":new q(We.paint_symbol["text-translate-anchor"])}),layout:BD};class e2{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:_a,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et(e2,"FormatSectionOverride",{omit:["defaultValue"]});class Em extends Ko{constructor(e){super(e,dy)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const p of l)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,l,h){const p=this.layout.get(e).evaluate(i,{},l,h),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||ka(g.value)||!p?p:function(x,w){return w.replace(/{([^{}]+)}/g,(E,I)=>I in x?String(x[I]):"")}(i.properties,p)}createBucket(e){return new Va(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of dy.paint.overridableProperties){if(!Em.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),l=new e2(i),h=new Yc(l,i.property.specification);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new Yh("source",h):new Ul("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new re(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&Em.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const l=e.get("text-field"),h=dy.paint.properties[i];let p=!1;const g=x=>{for(const w of x)if(h.overrides&&h.overrides.hasOverride(w))return void(p=!0)};if(l.value.kind==="constant"&&l.value.value instanceof ui)g(l.value.value.sections);else if(l.value.kind==="source"){const x=E=>{p||(E instanceof Vs&&Yr(E.value)===El?g(E.value.sections):E instanceof gs?g(E.sections):E.eachChild(x))},w=l.value;w._styleExpression&&x(w._styleExpression.expression)}return p}getProgramConfiguration(e){return new La(this,e)}}var LD={paint:new ce({"background-color":new q(We.paint_background["background-color"]),"background-pattern":new q(We.paint_background["background-pattern"]),"background-opacity":new q(We.paint_background["background-opacity"])})},FD={paint:new ce({"raster-opacity":new q(We.paint_raster["raster-opacity"]),"raster-hue-rotate":new q(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new q(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new q(We.paint_raster["raster-brightness-max"]),"raster-saturation":new q(We.paint_raster["raster-saturation"]),"raster-contrast":new q(We.paint_raster["raster-contrast"]),"raster-resampling":new q(We.paint_raster["raster-resampling"]),"raster-fade-duration":new q(We.paint_raster["raster-fade-duration"])})};class OD extends Ko{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var ND={paint:new ce({"sky-type":new q(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new q(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new q(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new q(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new q(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new ae(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new q(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new q(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new q(We.paint_sky["sky-opacity"])})};function py(n,e,i){const l=[0,0,1],h=xw([]);return bw(h,h,i?-Ue(n)+Math.PI:Ue(n)),vw(h,h,-Ue(e)),mw(l,l,h),di(l,l)}const UD={circle:class extends Ko{constructor(n){super(n,Yz)}createBucket(n){return new N_(n)}queryRadius(n){const e=n;return pu("circle-radius",this,e)+pu("circle-stroke-width",this,e)+Qf(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,l,h,p,g,x){const w=$w(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Ww(n,l,p,g,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new La(this,n)}},heatmap:class extends Ko{createBucket(n){return new Gw(n)}constructor(n){super(n,t4),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return pu("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,l,h,p,g,x){const w=this.paint.get("heatmap-radius").evaluate(e,i);return Ww(n,l,p,g,x,!0,!0,new Se(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new La(this,n)}},hillshade:class extends Ko{constructor(n){super(n,r4)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ko{constructor(n){super(n,y4)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new La(this,n)}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new im(n)}queryRadius(){return Qf(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,l,h,p){return!n.queryGeometry.isAboveHorizon&&Ow(jw(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Ko{constructor(n){super(n,R4)}createBucket(n){return new Dd(n)}queryRadius(){return Qf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new La(this,n)}queryIntersectsFeature(n,e,i,l,h,p,g,x,w){const E=$w(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,i),z=this.paint.get("fill-extrusion-base").evaluate(e,i),D=[0,0],F=x&&p.elevation,N=p.elevation?p.elevation.exaggeration():1,G=n.tile.getBucket(this);if(F&&G instanceof Dd){const he=G.centroidVertexArray,ge=w+1;ge<he.length&&(D[0]=he.geta_centroid_pos0(ge),D[1]=he.geta_centroid_pos1(ge))}if(D[0]===0&&D[1]===1)return!1;p.projection.name==="globe"&&(l=uE([l],[new Se(0,0),new Se(Mt,Mt)],n.tileID.canonical).map(he=>he.polygon).flat());const Q=F?x:null,[oe,fe]=function(he,ge,me,Be,De,qe,ot,Oe,Ke,Ye,rt){return he.projection.name==="globe"?function(ut,$e,mt,Tt,_t,$t,ht,Pt,Wt,lr,qt){const Lt=[],Rr=[],Gt=ut.projection.upVectorScale(qt,ut.center.lat,ut.worldSize).metersToTile,Ht=[0,0,0,1],Cr=[0,0,0,1],zr=(Ir,qr,Jr,hn)=>{Ir[0]=qr,Ir[1]=Jr,Ir[2]=hn,Ir[3]=1},Dr=cE();mt>0&&(mt+=Dr),Tt+=Dr;for(const Ir of $e){const qr=[],Jr=[];for(const hn of Ir){const kr=hn.x+_t.x,vn=hn.y+_t.y,dn=ut.projection.projectTilePoint(kr,vn,qt),Hr=ut.projection.upVector(qt,hn.x,hn.y);let hr=mt,pn=Tt;if(ht){const Mr=fE(kr,vn,mt,Tt,ht,Pt,Wt,lr);hr+=Mr.base,pn+=Mr.top}mt!==0?zr(Ht,dn.x+Hr[0]*Gt*hr,dn.y+Hr[1]*Gt*hr,dn.z+Hr[2]*Gt*hr):zr(Ht,dn.x,dn.y,dn.z),zr(Cr,dn.x+Hr[0]*Gt*pn,dn.y+Hr[1]*Gt*pn,dn.z+Hr[2]*Gt*pn),nn(Ht,Ht,$t),nn(Cr,Cr,$t),qr.push(new gu(Ht[0],Ht[1],Ht[2])),Jr.push(new gu(Cr[0],Cr[1],Cr[2]))}Lt.push(qr),Rr.push(Jr)}return[Lt,Rr]}(he,ge,me,Be,De,qe,ot,Oe,Ke,Ye,rt):ot?function(ut,$e,mt,Tt,_t,$t,ht,Pt,Wt){const lr=[],qt=[],Lt=[0,0,0,1];for(const Rr of ut){const Gt=[],Ht=[];for(const Cr of Rr){const zr=Cr.x+Tt.x,Dr=Cr.y+Tt.y,Ir=fE(zr,Dr,$e,mt,$t,ht,Pt,Wt);Lt[0]=zr,Lt[1]=Dr,Lt[2]=Ir.base,Lt[3]=1,Jl(Lt,Lt,_t),Lt[3]=Math.max(Lt[3],1e-5);const qr=new gu(Lt[0]/Lt[3],Lt[1]/Lt[3],Lt[2]/Lt[3]);Lt[0]=zr,Lt[1]=Dr,Lt[2]=Ir.top,Lt[3]=1,Jl(Lt,Lt,_t),Lt[3]=Math.max(Lt[3],1e-5);const Jr=new gu(Lt[0]/Lt[3],Lt[1]/Lt[3],Lt[2]/Lt[3]);Gt.push(qr),Ht.push(Jr)}lr.push(Gt),qt.push(Ht)}return[lr,qt]}(ge,me,Be,De,qe,ot,Oe,Ke,Ye):function(ut,$e,mt,Tt,_t){const $t=[],ht=[],Pt=_t[8]*$e,Wt=_t[9]*$e,lr=_t[10]*$e,qt=_t[11]*$e,Lt=_t[8]*mt,Rr=_t[9]*mt,Gt=_t[10]*mt,Ht=_t[11]*mt;for(const Cr of ut){const zr=[],Dr=[];for(const Ir of Cr){const qr=Ir.x+Tt.x,Jr=Ir.y+Tt.y,hn=_t[0]*qr+_t[4]*Jr+_t[12],kr=_t[1]*qr+_t[5]*Jr+_t[13],vn=_t[2]*qr+_t[6]*Jr+_t[14],dn=_t[3]*qr+_t[7]*Jr+_t[15],Hr=hn+Pt,hr=kr+Wt,pn=vn+lr,Mr=Math.max(dn+qt,1e-5),mi=hn+Lt,fn=kr+Rr,Vn=vn+Gt,Mn=Math.max(dn+Ht,1e-5);zr.push(new gu(Hr/Mr,hr/Mr,pn/Mr)),Dr.push(new gu(mi/Mn,fn/Mn,Vn/Mn))}$t.push(zr),ht.push(Dr)}return[$t,ht]}(ge,me,Be,De,qe)}(p,l,z,I,E,g,Q,D,N,p.center.lat,n.tileID.canonical),se=n.queryGeometry;return function(he,ge,me){let Be=1/0;Ow(me,ge)&&(Be=pE(me,ge[0]));for(let De=0;De<ge.length;De++){const qe=ge[De],ot=he[De];for(let Oe=0;Oe<qe.length-1;Oe++){const Ke=qe[Oe],Ye=[Ke,qe[Oe+1],ot[Oe+1],ot[Oe],Ke];Fw(me,Ye)&&(Be=Math.min(Be,pE(me,Ye)))}}return Be!==1/0&&Be}(oe,fe,se.isPointQuery()?se.screenBounds:se.screenGeometry)}},line:class extends Ko{constructor(n){super(n,mE),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Oh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=gE.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new cm(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new La(this,n)}queryRadius(n){const e=n,i=_E(pu("line-width",this,e),pu("line-gap-width",this,e)),l=pu("line-offset",this,e);return i/2+Math.abs(l)+Qf(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,l,h,p){if(n.queryGeometry.isAboveHorizon)return!1;const g=jw(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),x=n.pixelToTileUnitsFactor/2*_E(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(l=function(E,I){const z=[],D=new Se(0,0);for(let F=0;F<E.length;F++){const N=E[F],G=[];for(let Q=0;Q<N.length;Q++){const oe=N[Q],fe=N[Q+1],se=Q===0?D:oe.sub(N[Q-1])._unit()._perp(),he=Q===N.length-1?D:fe.sub(oe)._unit()._perp(),ge=se._add(he)._unit();ge._mult(1/(ge.x*he.x+ge.y*he.y)),G.push(ge._mult(I)._add(oe))}z.push(G)}return z}(l,w*n.pixelToTileUnitsFactor)),function(E,I,z){for(let D=0;D<I.length;D++){const F=I[D];if(E.length>=3){for(let N=0;N<F.length;N++)if(rc(E,F[N]))return!0}if(Hz(E,F,z))return!0}return!1}(g,l,x)}isTileClipped(){return!0}},symbol:Em,background:class extends Ko{constructor(n){super(n,LD)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ko{constructor(n){super(n,FD)}getProgramIds(){return["raster"]}},sky:class extends Ko{constructor(n){super(n,ND),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),h=!l,p=n.style.light,g=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&gr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?py(g.azimuthal,90-g.polar,e):py(l[0],90-l[1],e)}const i=this.paint.get("sky-gradient-center");return py(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}}};class $d{constructor(e,i,l,h){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(i,h)}update(e,i,l){const{width:h,height:p}=e,{context:g}=this,{gl:x}=g,{HTMLImageElement:w,HTMLCanvasElement:E,HTMLVideoElement:I,ImageData:z,ImageBitmap:D}=S;if(x.bindTexture(x.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),l||this.size&&this.size[0]===h&&this.size[1]===p){const{x:F,y:N}=l||{x:0,y:0};e instanceof w||e instanceof E||e instanceof I||e instanceof z||D&&e instanceof D?x.texSubImage2D(x.TEXTURE_2D,0,F,N,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,F,N,h,p,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[h,p],e instanceof w||e instanceof E||e instanceof I||e instanceof z||D&&e instanceof D?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,h,p,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,i){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class VD{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class jD{constructor(){this.tasks={},this.taskQueue=[],qn(["process"],this),this.invoker=new VD(this.process),this.nextId=0}add(e,i){const l=this.nextId++,h=function({type:p,isSymbolTile:g,zoom:x}){return x=x||0,p==="message"?0:p!=="maybePrepare"||g?p!=="parseTile"||g?p==="parseTile"&&g?300-x:p==="maybePrepare"&&g?400-x:500:200-x:100-x}(i);if(h===0){ei();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:e,metadata:i,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){ei();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<i&&(i=p.priority,e=h)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class t2{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const l=e[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const $D=["tile","layer","source","sourceLayer","state"];class r2{constructor(e,i,l,h,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=l,this._y=h,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of $D)this[i]!==void 0&&(e[i]=this[i]);return e}}const Io=32,Es=33,ja=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,i=0,l=0,h=0,p=0,g=0,x=0;for(1&e?h=p=g=Io:i=l=x=Io;(e>>=1)>1;){const E=i+h>>1,I=l+p>>1;1&e?(h=i,p=l,i=g,l=x):(i=h,l=p,h=g,p=x),g=E,x=I}const w=4*n;ja[w+0]=i,ja[w+1]=l,ja[w+2]=h,ja[w+3]=p}const Ss=new Uint16Array(2178),$a=new Uint8Array(1089),Sm=new Uint16Array(1089);function n2(n){return n===0?-.03125:n===32?.03125:0}var i2=Ce([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const o2={type:2,extent:Mt,loadGeometry:()=>[[new Se(0,0),new Se(Mt+1,0),new Se(Mt+1,Mt+1),new Se(0,Mt+1),new Se(0,0)]]};class fy{constructor(e,i,l,h,p){this.tileID=e,this.uid=ir(),this.uses=0,this.tileSize=i,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Oo.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=ic(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,l){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,p){const g={};if(!p)return g;for(const x of h){const w=x.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(w.length!==0){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(E=>w.filter(I=>I.id===E)[0]));for(const E of w)g[E.id]=x}}return g}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof Va){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof Va&&p.hasRTLText){this.hasRTLText=!0,T.isLoading()||T.isLoaded()||v()!=="deferred"||A();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(h).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ar}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new $d(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new $d(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new $d(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,l,h,p,g,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:g,params:p,tileTransform:this.tileTransform},e,i,l):{}}querySourceFeatures(e,i){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),p=i?i.sourceLayer:"",g=h._geojsonTileLayer||h[p];if(!g)return;const x=tu(i&&i.filter),{z:w,x:E,y:I}=this.tileID.canonical,z={z:w,x:E,y:I};for(let D=0;D<g.length;D++){const F=g.feature(D);if(x.needGeometry){const Q=tc(F,!0);if(!x.filter(new P(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!x.filter(new P(this.tileID.overscaledZ),F))continue;const N=l.getId(F,p),G=new r2(F,w,E,I,N);G.tile=z,e.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const l=Fn(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(i)if(this.expirationTime<i)h=!0;else{const p=this.expirationTime-i;p?this.expirationTime=l+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const l=this.latestFeatureIndex.loadVTLayers(),h=i.style.listImages();for(const p in this.buckets){if(!i.style.hasLayer(p))continue;const g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",w=l[x],E=e[x];if(!w||!E||Object.keys(E).length===0)continue;if(g.update(E,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof cm||g instanceof im){const z=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&z&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(z.id,this.tileID)}const I=i&&i.style&&i.style.getLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Oo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Oo.now()+e}setTexture(e,i){const l=i.context,h=l.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new $d(l,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(e,i){const l={};for(const h of i)l[h]=!0;this.dependencies[e]=l}hasDependency(e,i){for(const l of e){const h=this.dependencies[l];if(h){for(const p of i)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const l=Qs(o2,this.tileID.canonical,this.tileTransform)[0],h=new it,p=new Li;for(let g=0;g<l.length;g++){const{x,y:w}=l[g];h.emplaceBack(x,w),p.emplaceBack(g)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(h,bd.members),this._tileDebugSegments=cn.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const l=Qs(o2,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const g=function(x,w){const E=ic(x,w),I=Math.pow(2,x.z);for(let Q=0;Q<Es;Q++)for(let oe=0;oe<Es;oe++){const fe=no((x.x+(oe+n2(oe))/Io)/I),se=Xn((x.y+(Q+n2(Q))/Io)/I),he=w.project(fe,se),ge=Q*Es+oe;Ss[2*ge+0]=Math.round((he.x*E.scale-E.x)*Mt),Ss[2*ge+1]=Math.round((he.y*E.scale-E.y)*Mt)}$a.fill(0),Sm.fill(0);for(let Q=2045;Q>=0;Q--){const oe=4*Q,fe=ja[oe+0],se=ja[oe+1],he=ja[oe+2],ge=ja[oe+3],me=fe+he>>1,Be=se+ge>>1,De=me+Be-se,qe=Be+fe-me,ot=se*Es+fe,Oe=ge*Es+he,Ke=Be*Es+me,Ye=Math.hypot((Ss[2*ot+0]+Ss[2*Oe+0])/2-Ss[2*Ke+0],(Ss[2*ot+1]+Ss[2*Oe+1])/2-Ss[2*Ke+1])>=16;$a[Ke]=$a[Ke]||(Ye?1:0),Q<1022&&($a[Ke]=$a[Ke]||$a[(se+qe>>1)*Es+(fe+De>>1)]||$a[(ge+qe>>1)*Es+(he+De>>1)])}const z=new Ze,D=new It;let F=0;function N(Q,oe){const fe=oe*Es+Q;return Sm[fe]===0&&(z.emplaceBack(Ss[2*fe+0],Ss[2*fe+1],Q*Mt/Io,oe*Mt/Io),Sm[fe]=++F),Sm[fe]-1}function G(Q,oe,fe,se,he,ge){const me=Q+fe>>1,Be=oe+se>>1;if(Math.abs(Q-he)+Math.abs(oe-ge)>1&&$a[Be*Es+me])G(he,ge,Q,oe,me,Be),G(fe,se,he,ge,me,Be);else{const De=N(Q,oe),qe=N(fe,se),ot=N(he,ge);D.emplaceBack(De,qe,ot)}}return G(0,0,Io,Io,Io,0),G(Io,Io,0,0,0,Io),{vertices:z,indices:D}}(this.tileID.canonical,i);h=g.vertices,p=g.indices}else{h=new Ze,p=new It;for(const{x,y:w}of l)h.emplaceBack(x,w,0,0);const g=Z_(h.int16,void 0,4);for(let x=0;x<g.length;x+=3)p.emplaceBack(g[x],g[x+1],g[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,i2.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=cn.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(e,i){const l=i.projection;if(!l||l.name!=="globe"||i.freezeTileCoverage)return;const h=this.tileID.canonical,p=Sd(Tw(h,i)),g=hu(i.zoom);let x;g>0&&(x=w_(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,i,p,x,g),this._makeGlobeTileDebugTextBuffer(e,h,i,p,x,g)}_globePoint(e,i,l,h,p,g,x){let w=Ed(e,i,l);if(g){const E=1<<l.z,I=bs(h.center.lng),z=ws(h.center.lat),D=(l.x+.5)/E-I;let F=0;D>.5?F=-1:D<-.5&&(F=1);let N=(e/Mt+l.x)/E+F,G=(i/Mt+l.y)/E;N=(N-I)*h._pixelsPerMercatorPixel+I,G=(G-z)*h._pixelsPerMercatorPixel+z;const Q=[N*h.worldSize,G*h.worldSize,0];nn(Q,Q,g),w=ec(w,Q,x)}return nn(w,w,p)}_makeGlobeTileDebugBorderBuffer(e,i,l,h,p,g){const x=new it,w=new Li,E=new ze,I=(D,F,N,G,Q)=>{const oe=(N-D)/(Q-1),fe=(G-F)/(Q-1),se=x.length;for(let he=0;he<Q;he++){const ge=D+he*oe,me=F+he*fe;x.emplaceBack(ge,me);const Be=this._globePoint(ge,me,i,l,h,p,g);E.emplaceBack(Be[0],Be[1],Be[2]),w.emplaceBack(se+he)}},z=Mt;I(0,0,z,0,16),I(z,0,z,z,16),I(z,z,0,z,16),I(0,z,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(w),this._tileDebugBuffer=e.createVertexBuffer(x,bd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(E,Ew.members),this._tileDebugSegments=cn.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugTextBuffer(e,i,l,h,p,g){const x=Mt/4,w=new it,E=new It,I=new ze,z=25;E.reserve(32),w.reserve(z),I.reserve(z);const D=(F,N)=>z*F+N;for(let F=0;F<z;F++){const N=F*x;for(let G=0;G<z;G++){const Q=G*x;w.emplaceBack(Q,N);const oe=this._globePoint(Q,N,i,l,h,p,g);I.emplaceBack(oe[0],oe[1],oe[2])}}for(let F=0;F<4;F++)for(let N=0;N<4;N++){const G=D(F,N),Q=D(F,N+1),oe=D(F+1,N),fe=D(F+1,N+1);E.emplaceBack(G,Q,oe),E.emplaceBack(oe,Q,fe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(E),this._tileDebugTextBuffer=e.createVertexBuffer(w,bd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(I,Ew.members),this._tileDebugTextSegments=cn.simpleSegment(0,0,z,32)}}class WD{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,l){const h=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},et(this.stateChanges[e][h],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==h&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const p in this.state[e][h])l[p]||(this.deletedStates[e][h][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][p]===null&&delete this.deletedStates[e][h][p]}removeFeatureState(e,i,l){if(this.deletedStates[e]===null)return;const h=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&i!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][l]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(l in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][l]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,i){const l=String(i),h=et({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][i];if(p===null)return{};for(const g in p)delete h[g]}return h}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const g in this.stateChanges[h])this.state[h][g]||(this.state[h][g]={}),et(this.state[h][g],this.stateChanges[h][g]),p[g]=this.state[h][g];l[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(this.deletedStates[h]===null)for(const g in this.state[h])p[g]={},this.state[h][g]={};else for(const g in this.deletedStates[h]){if(this.deletedStates[h][g]===null)this.state[h][g]={};else if(this.state[h][g])for(const x of Object.keys(this.deletedStates[h][g]))delete this.state[h][g][x];p[g]=this.state[h][g]}l[h]=l[h]||{},et(l[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in e)e[h].setFeatureState(l,i)}}class s2{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const l=this.toIdx(e,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function a2(n,e,i,l){let h=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(l[g])<1e-15){if(i[g]<n[g]||i[g]>e[g])return null}else{const x=1/l[g];let w=(n[g]-i[g])*x,E=(e[g]-i[g])*x;if(w>E){const I=w;w=E,E=I}if(w>h&&(h=w),E<p&&(p=E),h>p)return null}return h}function l2(n,e,i,l,h,p,g,x,w,E,I){const z=l-n,D=h-e,F=p-i,N=g-n,G=x-e,Q=w-i,oe=I[1]*Q-I[2]*G,fe=I[2]*N-I[0]*Q,se=I[0]*G-I[1]*N,he=z*oe+D*fe+F*se;if(Math.abs(he)<1e-15)return null;const ge=1/he,me=E[0]-n,Be=E[1]-e,De=E[2]-i,qe=(me*oe+Be*fe+De*se)*ge;if(qe<0||qe>1)return null;const ot=Be*F-De*D,Oe=De*z-me*F,Ke=me*D-Be*z,Ye=(I[0]*ot+I[1]*Oe+I[2]*Ke)*ge;return Ye<0||qe+Ye>1?null:(N*ot+G*Oe+Q*Ke)*ge}function c2(n,e,i){return(n-e)/(i-e)}function u2(n,e,i,l,h,p,g,x,w){const E=1<<i,I=p-l,z=g-h,D=(n+1)/E*I+l,F=(e+0)/E*z+h,N=(e+1)/E*z+h;x[0]=(n+0)/E*I+l,x[1]=F,w[0]=D,w[1]=N}class h2{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const g=Math.ceil(Math.log2(p.dim/8)),x=[];let w=Math.ceil(Math.pow(2,g));const E=1/w,I=(F,N,G,Q,oe)=>{const fe=Q?1:0,se=(F+1)*G-fe,he=N*G,ge=(N+1)*G-fe;oe[0]=F*G,oe[1]=he,oe[2]=se,oe[3]=ge};let z=new s2(w);const D=[];for(let F=0;F<w*w;F++){I(F%w,Math.floor(F/w),E,!1,D);const N=Wa(D[0],D[1],p),G=Wa(D[2],D[1],p),Q=Wa(D[2],D[3],p),oe=Wa(D[0],D[3],p);z.minimums.push(Math.min(N,G,Q,oe)),z.maximums.push(Math.max(N,G,Q,oe)),z.leaves.push(1)}for(x.push(z),w/=2;w>=1;w/=2){const F=x[x.length-1];z=new s2(w);for(let N=0;N<w*w;N++){I(N%w,Math.floor(N/w),2,!0,D);const G=F.getElevation(D[0],D[1]),Q=F.getElevation(D[2],D[1]),oe=F.getElevation(D[2],D[3]),fe=F.getElevation(D[0],D[3]),se=F.isLeaf(D[0],D[1]),he=F.isLeaf(D[2],D[1]),ge=F.isLeaf(D[2],D[3]),me=F.isLeaf(D[0],D[3]),Be=Math.min(G.min,Q.min,oe.min,fe.min),De=Math.max(G.max,Q.max,oe.max,fe.max),qe=se&&he&&ge&&me;z.maximums.push(De),z.minimums.push(Be),z.leaves.push(De-Be<=5&&qe?1:0)}x.push(z)}return x}(this.dem),l=i.length-1,h=i[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(e,i,l,h,p,g,x=1){return a2([e,i,-100],[l,h,this.maximums[0]*x],p,g)}raycast(e,i,l,h,p,g,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,l,h,p,g,x);if(w==null)return null;const E=[],I=[],z=[],D=[],F=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:N,t:G,nodex:Q,nodey:oe,depth:fe}=F.pop();if(this.leaves[N]){u2(Q,oe,fe,e,i,l,h,z,D);const he=1<<fe,ge=(Q+0)/he,me=(Q+1)/he,Be=(oe+0)/he,De=(oe+1)/he,qe=Wa(ge,Be,this.dem)*x,ot=Wa(me,Be,this.dem)*x,Oe=Wa(me,De,this.dem)*x,Ke=Wa(ge,De,this.dem)*x,Ye=l2(z[0],z[1],qe,D[0],z[1],ot,D[0],D[1],Oe,p,g),rt=l2(D[0],D[1],Oe,z[0],D[1],Ke,z[0],z[1],qe,p,g),ut=Math.min(Ye!==null?Ye:Number.MAX_VALUE,rt!==null?rt:Number.MAX_VALUE);if(ut!==Number.MAX_VALUE)return ut;{const $e=xd([],p,g,G);if(d2(qe,ot,Ke,Oe,c2($e[0],z[0],D[0]),c2($e[1],z[1],D[1]))>=$e[2])return G}continue}let se=0;for(let he=0;he<this._siblingOffset.length;he++){u2((Q<<1)+this._siblingOffset[he][0],(oe<<1)+this._siblingOffset[he][1],fe+1,e,i,l,h,z,D),z[2]=-100,D[2]=this.maximums[this.childOffsets[N]+he]*x;const ge=a2(z,D,p,g);if(ge!=null){const me=ge;E[he]=me;let Be=!1;for(let De=0;De<se&&!Be;De++)me>=E[I[De]]&&(I.splice(De,0,he),Be=!0);Be||(I[se]=he),se++}}for(let he=0;he<se;he++){const ge=I[he];F.push({idx:this.childOffsets[N]+ge,t:E[ge],nodex:(Q<<1)+this._siblingOffset[ge][0],nodey:(oe<<1)+this._siblingOffset[ge][1],depth:fe+1})}}return null}_addNode(e,i,l){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,l,h,p){if(e[h].isLeaf(i,l)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=h-1,x=e[g];let w=0,E=0;for(let I=0;I<this._siblingOffset.length;I++){const z=2*i+this._siblingOffset[I][0],D=2*l+this._siblingOffset[I][1],F=x.getElevation(z,D),N=x.isLeaf(z,D),G=this._addNode(F.min,F.max,N);N&&(w|=1<<I),E||(E=G)}for(let I=0;I<this._siblingOffset.length;I++)w&1<<I||this._construct(e,2*i+this._siblingOffset[I][0],2*l+this._siblingOffset[I][1],g,E+I)}}function d2(n,e,i,l,h,p){return or(or(n,i,p),or(e,l,p),h)}function Wa(n,e,i){const l=i.dim,h=Ge(n*l-.5,0,l-1),p=Ge(e*l-.5,0,l-1),g=Math.floor(h),x=Math.floor(p),w=Math.min(g+1,l-1),E=Math.min(x+1,l-1);return d2(i.get(g,x),i.get(w,x),i.get(g,E),i.get(w,E),h-g,p-x)}const p2={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function qD(n,e,i){return(256*n*256+256*e+i)/10-1e4}function GD(n,e,i){return 256*n+e+i/256-32768}class Am{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,l,h=!1,p=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return gr(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,x=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=l||"mapbox",this.borderReady=h,!h){for(let w=0;w<g;w++)x[this._idx(-1,w)]=x[this._idx(0,w)],x[this._idx(g,w)]=x[this._idx(g-1,w)],x[this._idx(w,-1)]=x[this._idx(w,0)],x[this._idx(w,g)]=x[this._idx(w,g-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(g,-1)]=x[this._idx(g-1,0)],x[this._idx(-1,g)]=x[this._idx(0,g-1)],x[this._idx(g,g)]=x[this._idx(g-1,g-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new h2(this)}get(e,i,l=!1){l&&(e=Ge(e,-1,this.dim),i=Ge(i,-1,this.dim));const h=4*this._idx(e,i);return(this.encoding==="terrarium"?GD:qD)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(e){return p2[e]}get unpackVector(){return p2[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const l=[0,0,0,0],h=Am.getUnpackVector(i);let p=Math.floor((e+h[3])/h[2]);return l[2]=p%256,p=Math.floor(p/256),l[1]=p%256,p=Math.floor(p/256),l[0]=p,l}getPixels(){return new Oi({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,p=i*this.dim+this.dim,g=l*this.dim,x=l*this.dim+this.dim;switch(i){case-1:h=p-1;break;case 1:p=h+1}switch(l){case-1:g=x-1;break;case 1:x=g+1}const w=-i*this.dim,E=-l*this.dim;for(let I=g;I<x;I++)for(let z=h;z<p;z++){const D=4*this._idx(z,I),F=4*this._idx(z+w,I+E);this.pixels[D+0]=e.pixels[F+0],this.pixels[D+1]=e.pixels[F+1],this.pixels[D+2]=e.pixels[F+2],this.pixels[D+3]=e.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Et(Am,"DEMData"),Et(h2,"DemMinMaxQuadTree",{omit:["dem"]});class HD{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,l){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:i,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},l)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const l=e.wrapped().key,h=i===void 0?0:this.data[l].indexOf(i),p=this.data[l][h];return this.data[l].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const l in this.data)for(const h of this.data[l])e(h.value)||i.push(h);for(const l of i)this.remove(l.value.tileID,l)}}class Tu{constructor(e,i,l){this.func=e,this.mask=i,this.range=l}}Tu.ReadOnly=!1,Tu.ReadWrite=!0,Tu.disabled=new Tu(519,Tu.ReadOnly,[0,1]);const my=7680;class gy{constructor(e,i,l,h,p,g){this.test=e,this.ref=i,this.mask=l,this.fail=h,this.depthFail=p,this.pass=g}}gy.disabled=new gy({func:519,mask:0},0,0,my,my,my);class As{constructor(e,i,l){this.blendFunction=e,this.blendColor=i,this.mask=l}}As.Replace=[1,0],As.disabled=new As(As.Replace,rn.transparent,[!1,!1,!1,!1]),As.unblended=new As(As.Replace,rn.transparent,[!0,!0,!0,!0]),As.alphaBlended=new As([1,771],rn.transparent,[!0,!0,!0,!0]);const _y=1029,yy=2305;class rs{constructor(e,i,l){this.enable=e,this.mode=i,this.frontFace=l}}rs.disabled=new rs(!1,_y,yy),rs.backCCW=new rs(!0,_y,yy),rs.backCW=new rs(!0,_y,2304),rs.frontCW=new rs(!0,1028,2304),rs.frontCCW=new rs(!0,1028,yy);class oc extends wl{constructor(e,i,l){super(),this.id=e,this._onlySymbols=l,i.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new HD(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new WD,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const l=this._tiles[i];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Je(this._tiles).map(e=>e.tileID).sort(f2).map(e=>e.key)}getRenderableIds(e){const i=[];for(const l in this._tiles)this._isIdRenderable(+l,e)&&i.push(this._tiles[l]);return e?i.sort((l,h)=>{const p=l.tileID,g=h.tileID,x=new Se(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new Se(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-g.overscaledZ||w.y-x.y||w.x-x.x}).map(l=>l.tileID.key):i.map(l=>l.tileID).sort(f2).map(l=>l.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=i),this._loadTile(l,this._tileLoaded.bind(this,l,e,i)))}_tileLoaded(e,i,l,h){if(h)if(e.state="errored",h.status!==404)this._source.fire(new No(h,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Oo.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ns("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let h=0;h<i.length;h++){const p=i[h];if(e.neighboringTiles&&e.neighboringTiles[p]){const g=this.getTileByID(p);l(e,g),l(g,e)}}function l(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let g=p.tileID.canonical.x-h.tileID.canonical.x;const x=p.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),E=p.tileID.key;g===0&&x===0||Math.abs(x)>1||(Math.abs(g)>1&&(Math.abs(g+w)===1?g+=w:Math.abs(g-w)===1&&(g-=w)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,g,x),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,l,h){for(const p in this._tiles){let g=this._tiles[p];if(h[p]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>l)continue;let x=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const E=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[E.key],g&&g.hasData()&&(x=E)}let w=x;for(;w.overscaledZ>i;)if(w=w.scaledTo(w.overscaledZ-1),e[w.key]){h[x.key]=x;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=i?l:null}for(let l=e.overscaledZ-1;l>=i;l--){const h=e.scaledTo(l),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const l=Math.ceil(e.width/i)+1,h=Math.ceil(e.height/i)+1,p=Math.floor(l*h*5),g=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(x)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const l={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+i),l[p.tileID.key]=p}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,i,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let h;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new fi(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const p=this._updateRetainedTiles(h);if(m2(this._source.type)&&h.length!==0){const x={},w={},E=Object.keys(p);for(const z of E){const D=p[z],F=this._tiles[z];if(!F||F.fadeEndTime&&F.fadeEndTime<=Oo.now())continue;const N=this.findLoadedParent(D,Math.max(D.overscaledZ-oc.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),x[N.tileID.key]=N.tileID),w[z]=D}const I=h[h.length-1].overscaledZ;for(const z in this._tiles){const D=this._tiles[z];if(p[z]||!D.hasData())continue;let F=D.tileID;for(;F.overscaledZ>I;){F=F.scaledTo(F.overscaledZ-1);const N=this._tiles[F.key];if(N&&N.hasData()&&w[F.key]){p[z]=D.tileID;break}}}for(const z in x)p[z]||(this._coveredTiles[z]=!0,p[z]=x[z])}for(const x in p)this._tiles[x].clearFadeHold();const g=function(x,w){const E=[];for(const I in x)I in w||E.push(I);return E}(this._tiles,p);for(const x of g){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const l={},h=e.reduce((E,I)=>Math.min(E,I.overscaledZ),1/0),p=e[0].overscaledZ,g=Math.max(p-oc.maxOverzooming,this._source.minzoom),x=Math.max(p+oc.maxUnderzooming,this._source.minzoom),w={};for(const E of e){const I=this._addTile(E);i[E.key]=E,I.hasData()||h<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,h,x,i);for(const E of e){let I=this._tiles[E.key];if(I.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const D=E.children(this._source.maxzoom)[0],F=this.getTile(D);if(F&&F.hasData()){i[D.key]=D;continue}}else{const D=E.children(this._source.maxzoom);if(i[D[0].key]&&i[D[1].key]&&i[D[2].key]&&i[D[3].key])continue}let z=I.wasRequested();for(let D=E.overscaledZ-1;D>=g;--D){const F=E.scaledTo(D);if(l[F.key]||(l[F.key]=!0,I=this.getTile(F),!I&&z&&(I=this._addTile(F)),I&&(i[F.key]=F,z=I.wasRequested(),I.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let l,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}i.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;h=p}for(const p of i)this._loadedParentTiles[p]=l}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const l=!!i;if(!l){const h=this.map?this.map.painter:null;i=new fy(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,l||this._source.fire(new Ns("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=i.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,l){const h=[],p=this.transform;if(!p)return h;const g=p.projection.name==="globe",x=bs(p.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(l&&E.clearQueryDebugViz(),E.holdingForFade())continue;let I;if(g){const z=E.tileID.canonical;if(z.z===0){const D=[Math.abs(Ge(x,...Wd(z,-1))-x),Math.abs(Ge(x,...Wd(z,1))-x)];I=[0,2*D.indexOf(Math.min(...D))-1]}else{const D=[Math.abs(Ge(x,...Wd(z,-1))-x),Math.abs(Ge(x,...Wd(z,0))-x),Math.abs(Ge(x,...Wd(z,1))-x)];I=[D.indexOf(Math.min(...D))-1]}}else I=[0];for(const z of I){const D=e.containsTile(E,p,i,z);D&&h.push(D)}}return h}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of i)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(m2(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Oo.now())return!0}return!1}setFeatureState(e,i,l){this._state.updateState(e=e||"_geojsonTileLayer",i,l)}removeFeatureState(e,i,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,l)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,l){const h=this._tiles[e];h&&h.setDependencies(i,l)}reloadTilesForDependencies(e,i){for(const l in this._tiles)this._tiles[l].hasDependency(e,i)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(e,i))};return void this._source.on("data",x)}const l=new Map,h=Array.isArray(e)?e:[e],p=this.map.painter.terrain,g=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const x of h){const w=x.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)l.set(E.key,E);this.usedForTerrain&&x.updateElevation(!1)}Ve(Array.from(l.values()),(x,w)=>{const E=new fy(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,I=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(I,E)})},i)}}function f2(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||l-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function m2(n){return n==="raster"||n==="image"||n==="video"||n==="custom"}function Wd(n,e){const i=1<<n.z;return[n.x/i+e,(n.x+1)/i+e]}oc.maxOverzooming=10,oc.maxUnderzooming=3;class Tm{constructor(e,i,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(e,i,l){const h=l||e.findDEMTileFor(i);if(!h||!h.dem)return;const p=h.dem,g=h.tileID,x=1<<i.canonical.z-g.canonical.z;return new Tm(h,h.tileSize/Mt/x,[(i.canonical.x/x-g.canonical.x)*p.dim,(i.canonical.y/x-g.canonical.y)*p.dim])}tileCoordToPixel(e,i){const l=i*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(l);return new Se(h,p)}getElevationAt(e,i,l,h){const p=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],x=Math.floor(p),w=Math.floor(g),E=this._dem;return h=!!h,l?or(or(E.get(x,w,h),E.get(x,w+1,h),g-w),or(E.get(x+1,w,h),E.get(x+1,w+1,h),g-w),p-x):E.get(x,w,h)}getElevationAtPixel(e,i,l){return this._dem.get(e,i,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Qo(1,e)*this._dem.stride}}class g2{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Gs(Mt,16,0),this.featureIndexArray=new Hl,this.promoteId=i}insert(e,i,l,h,p,g=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,p,g);const w=this.grid;for(let E=0;E<i.length;E++){const I=i[E],z=[1/0,1/0,-1/0,-1/0];for(let D=0;D<I.length;D++){const F=I[D];z[0]=Math.min(z[0],F.x),z[1]=Math.min(z[1],F.y),z[2]=Math.max(z[2],F.x),z[3]=Math.max(z[3],F.y)}z[0]<Mt&&z[1]<Mt&&z[2]>=0&&z[3]>=0&&w.insert(x,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new J_(new dm(this.rawTileData)).layers,this.sourceLayerCoder=new t2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,l,h){this.loadVTLayers();const p=e.params||{},g=tu(p.filter),x=e.tileResult,w=e.transform,E=x.bufferedTilespaceBounds,I=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(N,G,Q,oe)=>Vw(x.bufferedTilespaceGeometry,N,G,Q,oe));I.sort(ZD);let z=null;w.elevation&&I.length>0&&(z=Tm.create(w.elevation,this.tileID));const D={};let F;for(let N=0;N<I.length;N++){const G=I[N];if(G===F)continue;F=G;const Q=this.featureIndexArray.get(G);let oe=null;this.loadMatchingFeature(D,Q,g,p.layers,p.availableImages,i,l,h,(fe,se,he,ge=0)=>(oe||(oe=Qs(fe,this.tileID.canonical,e.tileTransform)),se.queryIntersectsFeature(x,fe,he,oe,this.z,e.transform,e.pixelPosMatrix,z,ge)))}return D}loadMatchingFeature(e,i,l,h,p,g,x,w,E){const{featureIndex:I,bucketIndex:z,sourceLayerIndex:D,layoutVertexArrayOffset:F}=i,N=this.bucketLayerIDs[z];if(h&&!function(fe,se){for(let he=0;he<fe.length;he++)if(se.indexOf(fe[he])>=0)return!0;return!1}(h,N))return;const G=this.sourceLayerCoder.decode(D),Q=this.vtLayers[G].feature(I);if(l.needGeometry){const fe=tc(Q,!0);if(!l.filter(new P(this.tileID.overscaledZ),fe,this.tileID.canonical))return}else if(!l.filter(new P(this.tileID.overscaledZ),Q))return;const oe=this.getId(Q,G);for(let fe=0;fe<N.length;fe++){const se=N[fe];if(h&&h.indexOf(se)<0)continue;const he=g[se];if(!he)continue;let ge={};oe!==void 0&&w&&(ge=w.getState(he.sourceLayer||"_geojsonTileLayer",oe));const me=et({},x[se]);me.paint=_2(me.paint,he.paint,Q,ge,p),me.layout=_2(me.layout,he.layout,Q,ge,p);const Be=!E||E(Q,he,ge,F);if(!Be)continue;const De=new r2(Q,this.z,this.x,this.y,oe);De.layer=me;let qe=e[se];qe===void 0&&(qe=e[se]=[]),qe.push({featureIndex:I,feature:De,intersectionZ:Be})}}lookupSymbolFeatures(e,i,l,h,p,g,x,w){const E={};this.loadVTLayers();const I=tu(p);for(const z of e)this.loadMatchingFeature(E,{bucketIndex:l,sourceLayerIndex:h,featureIndex:z,layoutVertexArrayOffset:0},I,g,x,w,i);return E}loadFeature(e){const{featureIndex:i,sourceLayerIndex:l}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),p=this.vtFeatures[h];if(p[i])return p[i];const g=this.vtLayers[h].feature(i);return p[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const l of i)if(e===l)return!0;return!1}getId(e,i){let l=e.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];h!=null&&(l=e.properties[h]),typeof l=="boolean"&&(l=Number(l))}return l}}function _2(n,e,i,l,h){return Ot(n,(p,g)=>{const x=e instanceof ie?e.get(g):null;return x&&x.evaluate?x.evaluate(i,l,h):x})}function ZD(n,e){return e-n}Et(g2,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class y2{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new ea({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const l=this.getKey(e,i);return this.positions[l]}trim(){const e=this.width,i=this.height=vr(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,l){const h=[];let p=e.length%2==1?-e[e.length-1]*l:0,g=e[0]*l,x=!0;h.push({left:p,right:g,isDash:x,zeroLength:e[0]===0});let w=e[0];for(let E=1;E<e.length;E++){x=!x;const I=e[E];p=w*l,w+=I,g=w*l,h.push({left:p,right:g,isDash:x,zeroLength:I===0})}return h}addRoundDash(e,i,l){const h=i/2;for(let p=-l;p<=l;p++){const g=this.width*(this.nextRow+l+p);let x=0,w=e[x];for(let E=0;E<this.width;E++){E/w.right>1&&(w=e[++x]);const I=Math.abs(E-w.left),z=Math.abs(E-w.right),D=Math.min(I,z);let F;const N=p/l*(h+1);if(w.isDash){const G=h-Math.abs(N);F=Math.sqrt(D*D+G*G)}else F=h-Math.sqrt(D*D+N*N);this.image.data[g+E]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const E=e[w],I=e[w+1];E.zeroLength?e.splice(w,1):I&&I.isDash===E.isDash&&(I.left=E.left,e.splice(w,1))}const l=e[0],h=e[e.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const p=this.width*this.nextRow;let g=0,x=e[g];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++g]);const E=Math.abs(w-x.left),I=Math.abs(w-x.right),z=Math.min(E,I);this.image.data[p+w]=Math.max(0,Math.min(255,(x.isDash?z:-z)+i+128))}}addDash(e,i){const l=this.getKey(e,i);if(this.positions[l])return this.positions[l];const h=i==="round",p=h?7:0,g=2*p+1;if(this.nextRow+g>this.height)return gr("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let I=0;I<e.length;I++)e[I]<0&&(gr("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),x+=e[I];if(x!==0){const I=this.width/x,z=this.getDashRanges(e,this.width,I);h?this.addRoundDash(z,I,p):this.addRegularDash(z,i==="square"?.5*I:0)}const w=this.nextRow+p;this.nextRow+=g;const E={tl:[w,p],br:[x,0]};return this.positions[l]=E,E}}Et(y2,"LineAtlas");const x2=1*ts;class v2{constructor(e){const i={},l=[];for(const x in e){const w=e[x],E=i[x]={};for(const I in w.glyphs){const z=w.glyphs[+I];if(!z||z.bitmap.width===0||z.bitmap.height===0)continue;const D=z.metrics.localGlyph?x2:1,F={x:0,y:0,w:z.bitmap.width+2*D,h:z.bitmap.height+2*D};l.push(F),E[I]=F}}const{w:h,h:p}=ry(l),g=new ea({width:h||1,height:p||1});for(const x in e){const w=e[x];for(const E in w.glyphs){const I=w.glyphs[+E];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const z=i[x][E],D=I.metrics.localGlyph?x2:1;ea.copy(I.bitmap,g,{x:0,y:0},{x:z.x+D,y:z.y+D},I.bitmap)}}this.image=g,this.positions=i}}Et(v2,"GlyphAtlas");class XD{constructor(e){this.tileID=new fi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=ic(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,l,h,p){this.status="parsing",this.data=e,this.collisionBoxArray=new Ar;const g=new t2(Object.keys(e.layers).sort()),x=new g2(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},E=new y2(256,256),I={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:l},z=i.familiesBySource[this.source];for(const ge in z){const me=e.layers[ge];if(!me)continue;let Be=!1,De=!1;for(const Oe of z[ge])Oe[0].type==="symbol"?Be=!0:De=!0;if(this.isSymbolTile===!0&&!Be||this.isSymbolTile===!1&&!De)continue;me.version===1&&gr(`Vector tile source "${this.source}" layer "${ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const qe=g.encode(ge),ot=[];for(let Oe=0;Oe<me.length;Oe++){const Ke=me.feature(Oe),Ye=x.getId(Ke,ge);ot.push({feature:Ke,id:Ye,index:Oe,sourceLayerIndex:qe})}for(const Oe of z[ge]){const Ke=Oe[0];this.isSymbolTile!==void 0&&Ke.type==="symbol"!==this.isSymbolTile||Ke.minzoom&&this.zoom<Math.floor(Ke.minzoom)||Ke.maxzoom&&this.zoom>=Ke.maxzoom||Ke.visibility!=="none"&&(xy(Oe,this.zoom,l),(w[Ke.id]=Ke.createBucket({index:x.bucketLayerIDs.length,layers:Oe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:qe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:l})).populate(ot,I,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Oe.map(Ye=>Ye.id)))}}let D,F,N,G;E.trim();const Q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},oe=()=>{if(D)return p(D);if(F&&N&&G){const ge=new v2(F),me=new CE(N,G);for(const Be in w){const De=w[Be];De instanceof Va?(xy(De.layers,this.zoom,l),bD(De,F,ge.positions,N,me.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection)):De.hasPattern&&(De instanceof cm||De instanceof im||De instanceof Dd)&&(xy(De.layers,this.zoom,l),De.addFeatures(I,this.tileID.canonical,me.patternPositions,l,this.tileTransform))}this.status="done",p(null,{buckets:Je(w).filter(Be=>!Be.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ge.image,lineAtlas:E,imageAtlas:me,glyphMap:this.returnDependencies?F:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?ge.positions:null})}},fe=Ot(I.glyphDependencies,ge=>Object.keys(ge).map(Number));Object.keys(fe).length?h.send("getGlyphs",{uid:this.uid,stacks:fe},(ge,me)=>{D||(D=ge,F=me,oe())},void 0,!1,Q):F={};const se=Object.keys(I.iconDependencies);se.length?h.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"icons"},(ge,me)=>{D||(D=ge,N=me,oe())},void 0,!1,Q):N={};const he=Object.keys(I.patternDependencies);he.length?h.send("getImages",{icons:he,source:this.source,tileID:this.tileID,type:"patterns"},(ge,me)=>{D||(D=ge,G=me,oe())},void 0,!1,Q):G={},oe()}}function xy(n,e,i){const l=new P(e);for(const h of n)h.recalculate(l,i)}class b2{constructor(e){this.entries={},this.scheduler=e}request(e,i,l,h){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[g,x]=p.result;return this.scheduler?this.scheduler.add(()=>{h(g,x)},i):h(g,x),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=l((g,x)=>{p.result=[g,x];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(g,x)},i):w(g,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(g=>g!==h),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function w2(n,e,i){const l=JSON.stringify(n.request);return n.data&&(this.deduped.entries[l]={result:[null,n.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},h=>{const p=ms(n.request,(g,x,w,E)=>{g?h(g):x&&h(null,{vectorTile:i?void 0:new J_(new dm(x)),rawData:x,cacheControl:w,expires:E})});return()=>{p.cancel(),h()}},e)}const E2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vy{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,l]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=E2[15&l];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new vy(x,g,p,e)}constructor(e,i=64,l=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=E2.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+x+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=i,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return by(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:x}=this,w=[0,p.length-1,0],E=[];for(;w.length;){const I=w.pop()||0,z=w.pop()||0,D=w.pop()||0;if(z-D<=x){for(let Q=D;Q<=z;Q++){const oe=g[2*Q],fe=g[2*Q+1];oe>=e&&oe<=l&&fe>=i&&fe<=h&&E.push(p[Q])}continue}const F=D+z>>1,N=g[2*F],G=g[2*F+1];N>=e&&N<=l&&G>=i&&G<=h&&E.push(p[F]),(I===0?e<=N:i<=G)&&(w.push(D),w.push(F-1),w.push(1-I)),(I===0?l>=N:h>=G)&&(w.push(F+1),w.push(z),w.push(1-I))}return E}within(e,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:g}=this,x=[0,h.length-1,0],w=[],E=l*l;for(;x.length;){const I=x.pop()||0,z=x.pop()||0,D=x.pop()||0;if(z-D<=g){for(let Q=D;Q<=z;Q++)A2(p[2*Q],p[2*Q+1],e,i)<=E&&w.push(h[Q]);continue}const F=D+z>>1,N=p[2*F],G=p[2*F+1];A2(N,G,e,i)<=E&&w.push(h[F]),(I===0?e-l<=N:i-l<=G)&&(x.push(D),x.push(F-1),x.push(1-I)),(I===0?e+l>=N:i+l>=G)&&(x.push(F+1),x.push(z),x.push(1-I))}return w}}function by(n,e,i,l,h,p){if(h-l<=i)return;const g=l+h>>1;S2(n,e,g,l,h,p),by(n,e,i,l,g-1,1-p),by(n,e,i,g+1,h,1-p)}function S2(n,e,i,l,h,p){for(;h>l;){if(h-l>600){const E=h-l+1,I=i-l+1,z=Math.log(E),D=.5*Math.exp(2*z/3),F=.5*Math.sqrt(z*D*(E-D)/E)*(I-E/2<0?-1:1);S2(n,e,i,Math.max(l,Math.floor(i-I*D/E+F)),Math.min(h,Math.floor(i+(E-I)*D/E+F)),p)}const g=e[2*i+p];let x=l,w=h;for(qd(n,e,l,i),e[2*h+p]>g&&qd(n,e,l,h);x<w;){for(qd(n,e,x,w),x++,w--;e[2*x+p]<g;)x++;for(;e[2*w+p]>g;)w--}e[2*l+p]===g?qd(n,e,l,w):(w++,qd(n,e,w,h)),w<=i&&(l=w+1),i<=w&&(h=w-1)}}function qd(n,e,i,l){wy(n,i,l),wy(e,2*i,2*l),wy(e,2*i+1,2*l+1)}function wy(n,e,i){const l=n[e];n[e]=n[i],n[i]=l}function A2(n,e,i,l){const h=n-i,p=e-l;return h*h+p*p}s.ARRAY_TYPE=Fi,s.AUTH_ERR_MSG=_e,s.Aabb=pi,s.Actor=class{constructor(n,e,i){this.target=n,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},qn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ei()?n:S,this.scheduler=new jD}send(n,e,i,l,h=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=p,this.callbacks[g]=i);const x=Tn(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:n,hasCallback:!!i,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:Ma(e,x)},x),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(n){const e=n.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const l=this.cancelCallbacks[i];delete this.cancelCallbacks[i],l&&l.cancel()}else if(e.mustQueue||ei()){const l=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),l&&l.metadata||{type:"message"})}else this.processTask(i,e)}processTask(n,e){if(e.type==="<response>"){const i=this.callbacks[n];delete this.callbacks[n],i&&(e.error?i(Hs(e.error)):i(null,Hs(e.data)))}else{const i=Tn(this.globalScope)?void 0:[],l=e.hasCallback?(p,g)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:p?Ma(p):null,data:Ma(g,i)},i)}:p=>{},h=Hs(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,l);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],h.source)[p[1]](h,l)}else l(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=lm,s.Color=rn,s.ColorMode=As,s.CullFaceMode=rs,s.DEMData=Am,s.DataConstantProperty=q,s.DedupedRequest=b2,s.DepthMode=Tu,s.EXTENT=Mt,s.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,l=1<<i,h=Math.floor(n.x),p=Math.floor((n.x-h)*l),g=Math.floor(n.y*l),x=this.findDEMTileFor(new fi(i,h,i,p,g));return!(!x||!x.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||n.y<0||n.y>1)return e;const h=l.getSource().maxzoom,p=1<<h,g=Math.floor(n.x),x=n.x-g,w=new fi(h,g,h,Math.floor(x*p),Math.floor(n.y*p)),E=this.findDEMTileFor(w);if(!E||!E.dem)return e;const I=E.dem,z=1<<E.tileID.canonical.z,D=(x*z-E.tileID.canonical.x)*I.dim,F=(n.y*z-E.tileID.canonical.y)*I.dim,N=Math.floor(D),G=Math.floor(F);return(i?this.exaggeration():1)*or(or(I.get(N,G),I.get(N,G+1),F-G),or(I.get(N+1,G),I.get(N+1,G+1),F-G),D-N)}getAtTileOffset(n,e,i){const l=1<<n.canonical.z;return this.getAtPointOrZero(new du(n.wrap+(n.canonical.x+e/Mt)/l,(n.canonical.y+i/Mt)/l))}getAtTileOffsetFunc(n,e,i,l){return h=>{const p=this.getAtTileOffset(n,h.x,h.y),g=l.upVector(n.canonical,h.x,h.y);return ro(g,g,p*l.upVectorScale(n.canonical,e,i).metersToTile),g}}getForTilePoints(n,e,i,l){if(this.isUsingMockSource())return!1;const h=Tm.create(this,n,l);return!!h&&(e.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,l=e.tileID,h=1<<n.canonical.z-l.canonical.z;let p=n.canonical.x/h-l.canonical.x,g=n.canonical.y/h-l.canonical.y,x=0;for(let w=0;w<n.canonical.z-l.canonical.z&&!i.leaves[x];w++){p*=2,g*=2;const E=2*Math.floor(g)+Math.floor(p);x=i.childOffsets[x]+E,p%=1,g%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=No,s.EvaluationParameters=P,s.Event=Ns,s.Evented=wl,s.FillExtrusionBucket=Dd,s.Frustum=k_,s.FrustumCorners=I_,s.GLOBE_RADIUS=xs,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=Sw,s.GLOBE_ZOOM_THRESHOLD_MIN=P_,s.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_fillGridMeshWithLods(n,e){const i=new it,l=new It,h=[],p=n+1+2,g=e[0]+1,x=e[0]+1+(1+e.length),w=(E,I,z)=>{let D=E===p-1?E-2:E===0?E:E-1;return D+=z?24575:0,[D,I]};for(let E=0;E<p;++E)i.emplaceBack(...w(E,0,!0));for(let E=0;E<g;++E)for(let I=0;I<p;++I)i.emplaceBack(...w(I,E,(I===0||I===p-1)&&!0));for(let E=0;E<e.length;++E){const I=e[E];for(let z=0;z<p;++z)i.emplaceBack(...w(z,I,!0))}for(let E=0;E<e.length;++E){const I=l.length,z=e[E]+1+2,D=new It;for(let G=0;G<z-1;G++){const Q=G===z-2,oe=Q?p*(x-e.length+E-G):p;for(let fe=0;fe<p-1;fe++){const se=G*p+fe;G===0||Q||fe===0||fe===p-2?(D.emplaceBack(se+1,se,se+oe),D.emplaceBack(se+oe,se+oe+1,se+1)):(l.emplaceBack(se+1,se,se+oe),l.emplaceBack(se+oe,se+oe+1,se+1))}}const F=cn.simpleSegment(0,I,i.length,l.length-I);for(let G=0;G<D.uint16.length;G+=3)l.emplaceBack(D.uint16[G],D.uint16[G+1],D.uint16[G+2]);const N=cn.simpleSegment(0,I,i.length,l.length-I);h.push({withoutSkirts:F,withSkirts:N})}return{vertices:i,indices:l,segments:h}}_createGrid(n){const e=this._fillGridMeshWithLods(Ql,wd);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,bd.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new It;for(let h=0;h<=Ql;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Sr,l=new Sr;this._poleSegments=[];for(let h=0,p=0;h<P_;h++){const g=360/(1<<h);i.emplaceBack(0,-xs,0,.5,0),l.emplaceBack(0,-xs,0,.5,1);for(let x=0;x<=Ql;x++){const w=x/Ql,E=or(0,g,w),[I,z,D]=cu(jz,$z,E,xs);i.emplaceBack(I,z,D,w,0),l.emplaceBack(I,z,D,w,1)}this._poleSegments.push(cn.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,ww,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(l,ww,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const i=new Dn,l=Ql,h=l+1+2,p=1;this._wireframeSegments=[];for(let g=0,x=0;g<wd.length;g++){const w=wd[g];for(let I=p;I<w+p;I++)for(let z=p;z<l+p;z++){const D=I*h+z;i.emplaceBack(D,D+1),i.emplaceBack(D,D+h),i.emplaceBack(D,D+h+1)}const E=w*l*3;this._wireframeSegments.push(cn.simpleSegment(0,x,(w+1)*h,E)),x+=E}this._wireframeIndexBuffer=n.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=bu,s.ImagePosition=ny,s.KDBush=vy,s.LivePerformanceUtils=Kg,s.LngLat=Tr,s.LngLatBounds=Fa,s.LocalGlyphMode=sy,s.MAX_MERCATOR_LATITUDE=Kn,s.MercatorCoordinate=du,s.ONE_EM=Un,s.OverscaledTileID=fi,s.PerformanceMarkers=ga,s.Point=Se,s.Properties=ce,s.RGBAImage=Oi,s.Ray=C_,s.RequestManager=class{constructor(n,e,i){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",U,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!Ee(n))return n;const i=dt(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!Ee(n))return n;const i=dt(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(n,e,i,l){if(!Ee(n))return n;const h=dt(n);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),i&&h.params.push(`language=${i}`),l&&h.params.push(`worldview=${l}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(n,e,i,l){const h=dt(n);return Ee(n)?(h.path=`/styles/v1${h.path}/sprite${e}${i}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${e}${i}`,st(h))}normalizeTileURL(n,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!Ee(n))return n;const l=dt(n);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&l.authority!=="raster"&&i===512?"@2x":""}${L.supported?".webp":"$1"}`),l.authority==="raster"?l.path=`/${M.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${M.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(p){for(const g of p){const x=g.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(l.params)||M.ACCESS_TOKEN;return M.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(n,e){const i=dt(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let l="mapbox://";i.path.match(/^\/raster\/v1\//)?l+=`raster/${i.path.replace(`/${M.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${i.path.replace(`/${M.TILE_URL_VERSION}/`,"")}`;let h=i.params;return e&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(n,e){const i=!!e&&Ee(e),l=[];for(const h of n.tiles||[])Pe(h)?l.push(this.canonicalizeTileURL(h,i)):l.push(h);return l}_makeAPIURL(n,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=dt(M.API_URL);if(n.protocol=l.protocol,n.authority=l.authority,n.protocol==="http"){const h=n.params.indexOf("secure");h>=0&&n.params.splice(h,1)}if(l.path!=="/"&&(n.path=`${l.path}${n.path}`),!M.REQUIRE_ACCESS_TOKEN)return st(n);if(e=e||M.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(h=>h.indexOf("access_token")===-1),n.params.push(`access_token=${e||""}`),st(n)}},s.ResourceType=Lo,s.SegmentVector=cn,s.SourceCache=oc,s.StencilMode=gy,s.StructArrayLayout1ui2=Li,s.StructArrayLayout2f1f2i16=Bt,s.StructArrayLayout2i4=it,s.StructArrayLayout2ui4=Dn,s.StructArrayLayout3f12=Yt,s.StructArrayLayout3ui6=It,s.StructArrayLayout4i8=Ze,s.StructArrayLayout5f20=Sr,s.Texture=$d,s.Tile=fy,s.Transitionable=W,s.Uniform1f=qf,s.Uniform1i=class extends Ks{constructor(n){super(n),this.current=0}set(n,e,i){this.fetchUniformLocation(n,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.Uniform2f=class extends Ks{constructor(n){super(n),this.current=[0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},s.Uniform3f=class extends Ks{constructor(n){super(n),this.current=[0,0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},s.Uniform4f=ow,s.UniformColor=sw,s.UniformMatrix2f=class extends Ks{constructor(n){super(n),this.current=Tz}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let l=0;l<4;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},s.UniformMatrix3f=class extends Ks{constructor(n){super(n),this.current=Az}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.UniformMatrix4f=class extends Ks{constructor(n){super(n),this.current=Sz}set(n,e,i){if(this.fetchUniformLocation(n,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let l=1;l<16;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},s.UnwrappedTileID=dE,s.ValidationError=bt,s.VectorTileFeature=sm,s.VectorTileWorkerSource=class extends wl{constructor(n,e,i,l,h){super(),this.actor=n,this.layerIndex=e,this.availableImages=i,this.loadVectorData=h||w2,this.loading={},this.loaded={},this.deduped=new b2(n.scheduler),this.isSpriteLoaded=l,this.scheduler=n.scheduler}loadTile(n,e){const i=n.uid,l=n&&n.request,h=l&&l.collectResourceTiming,p=this.loading[i]=new XD(n);p.abort=this.loadVectorData(n,(g,x)=>{const w=!this.loading[i];if(delete this.loading[i],w||g||!x)return p.status="done",w||(this.loaded[i]=p),e(g);const E=x.rawData,I={};x.expires&&(I.expires=x.expires),x.cacheControl&&(I.cacheControl=x.cacheControl),p.vectorTile=x.vectorTile||new J_(new dm(E));const z=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(D,F)=>{if(D||!F)return e(D);const N={};if(h){const G=yh(l);G.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify(G)))}e(null,et({rawTileData:E.slice(0)},F,I,N))})};this.isSpriteLoaded?z():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(z,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):z()}),this.loaded=this.loaded||{},this.loaded[i]=p})}reloadTile(n,e){const i=this.loaded,l=n.uid,h=this;if(i&&i[l]){const p=i[l];p.showCollisionBoxes=n.showCollisionBoxes,p.enableTerrain=!!n.enableTerrain,p.projection=n.projection,p.tileTransform=ic(n.tileID.canonical,n.projection);const g=(x,w)=>{const E=p.reloadCallback;E&&(delete p.reloadCallback,p.parse(p.vectorTile,h.layerIndex,this.availableImages,h.actor,E)),e(x,w)};p.status==="parsing"?p.reloadCallback=g:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(n,e){const i=n.uid,l=this.loading[i];l&&(l.abort&&l.abort(),delete this.loading[i]),e()}removeTile(n,e){const i=this.loaded,l=n.uid;i&&i[l]&&delete i[l],e()}},s.WritingMode=io,s.ZoomDependentExpression=Ul,s.add=Js,s.addDynamicAttributes=wm,s.adjoint=function(n,e){var i=e[0],l=e[1],h=e[2],p=e[3],g=e[4],x=e[5],w=e[6],E=e[7],I=e[8];return n[0]=g*I-x*E,n[1]=h*E-l*I,n[2]=l*x-h*g,n[3]=x*w-p*I,n[4]=i*I-h*w,n[5]=h*p-i*x,n[6]=p*E-g*w,n[7]=l*w-i*E,n[8]=i*g-l*p,n},s.asyncAll=Ve,s.bezier=Ut,s.bindAll=qn,s.boundsAttributes=i2,s.bufferConvexPolygon=function(n,e){const i=[];for(let l=0;l<n.length;l++){const h=ft(l-1,-1,n.length-1),p=ft(l+1,-1,n.length-1),g=n[l],x=n[p],w=n[h].sub(g).unit(),E=x.sub(g).unit(),I=E.angleWithSep(w.x,w.y),z=w.add(E).unit().mult(-1*e/Math.sin(I/2));i.push(g.add(z))}return i},s.cacheEntryPossiblyAdded=function(n){Yi++,Yi>Ki&&(n.getActor().send("enforceCacheSizeLimit",Fs),Yi=0)},s.calculateGlobeLabelMatrix=function(n,e){const{x:i,y:l}=n.point,h=kw(i,l,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Kl(h,h,M_(vs(e)))},s.calculateGlobeMatrix=function(n){const{x:e,y:i}=n.point,{lng:l,lat:h}=n._center;return kw(e,i,n.worldSize,l,h)},s.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,i=e/Qo(1,n.center.lat),l=Yo(new Float64Array(16));return md(l,l,[n.point.x,n.point.y,0]),Yl(l,l,[i,i,e]),Float32Array.from(l)},s.circumferenceAtLatitude=B_,s.clamp=Ge,s.clearTileCache=function(n){if(!fs())return;const e=S.caches.delete(Xi);n&&e.catch(n).then(()=>n())},s.clipLine=UE,s.clone=function(n){var e=new Fi(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},s.clone$1=Br,s.collisionCircleLayout=H4,s.config=M,s.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},s.create=function(){var n=new Fi(16);return Fi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},s.create$1=cw,s.createExpression=Pa,s.createLayout=Ce,s.createStyleLayer=function(n){return n.type==="custom"?new OD(n):new UD[n.type](n)},s.cross=T_,s.degToRad=Ue,s.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},s.div=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},s.dot=Ao,s.earthRadius=Ad,s.ease=sr,s.easeCubicInOut=zt,s.ecefToLatLng=function([n,e,i]){const l=Math.hypot(n,e,i),h=Math.atan2(n,i),p=.5*Math.PI-Math.acos(-e/l);return new Tr(je(h),je(p))},s.emitValidationErrors=Nf,s.endsWith=cr,s.enforceCacheSizeLimit=function(n){go(),In&&In.then(e=>{e.keys().then(i=>{for(let l=0;l<i.length-n;l++)e.delete(i[l])})})},s.evaluateSizeForFeature=um,s.evaluateSizeForZoom=_u,s.evaluateVariableOffset=qE,s.evented=y,s.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},s.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},s.exported=Oo,s.exported$1=L,s.extend=et,s.extend$1=Uo,s.fillExtrusionHeightLift=cE,s.filterObject=li,s.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},s.fromQuat=function(n,e){var i=e[0],l=e[1],h=e[2],p=e[3],g=i+i,x=l+l,w=h+h,E=i*g,I=l*g,z=l*x,D=h*g,F=h*x,N=h*w,G=p*g,Q=p*x,oe=p*w;return n[0]=1-z-N,n[1]=I+oe,n[2]=D-Q,n[3]=0,n[4]=I-oe,n[5]=1-E-N,n[6]=F+G,n[7]=0,n[8]=D+Q,n[9]=F-G,n[10]=1-E-z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},s.fromRotation=function(n,e){var i=Math.sin(e),l=Math.cos(e);return n[0]=l,n[1]=i,n[2]=0,n[3]=-i,n[4]=l,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},s.fromScaling=hw,s.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return Ct[e]},s.getAABBPointSquareDist=function(n,e,i){let l=0;for(let h=0;h<2;++h){const p=i?i[h]:0;n[h]>p&&(l+=(n[h]-p)*(n[h]-p)),e[h]<p&&(l+=(p-e[h])*(p-e[h]))}return l},s.getAnchorAlignment=oy,s.getAnchorJustification=ly,s.getBounds=function(n){let e=1/0,i=1/0,l=-1/0,h=-1/0;for(const p of n)e=Math.min(e,p.x),i=Math.min(i,p.y),l=Math.max(l,p.x),h=Math.max(h,p.y);return{min:new Se(e,i),max:new Se(l,h)}},s.getColumn=On,s.getDefaultExportFromCjs=$,s.getGridMatrix=function(n,e,i,l){const h=e.getNorth(),p=e.getSouth(),g=e.getWest(),x=e.getEast(),w=1<<n.z,E=x-g,I=h-p,z=E/Ql,D=-I/wd[i],F=[0,z,0,D,0,0,h,g,0];if(n.z>0){const N=180/l;uw(F,F,[N/E+1,0,0,0,N/I+1,0,-.5*N/z,.5*N/D,1])}return F[2]=w,F[5]=n.x,F[8]=n.y,F},s.getImage=ue,s.getJSON=function(n,e){return Fo(et(n,{type:"json"}),e)},s.getLatitudinalLod=function(n){const e=Kn-5;n=Ge(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Ue(n))),3);return Math.round(i*(wd.length-1))},s.getMapSessionAPI=kn,s.getPerformanceMeasurement=yh,s.getProjection=QE,s.getRTLTextPluginStatus=v,s.getReferrer=_o,s.getTilePoint=function(n,{x:e,y:i},l=0){return new Se(((e-l)*n.scale-n.x)*Mt,(i*n.scale-n.y)*Mt)},s.getTileVec3=function(n,e,i=0){return lu(((e.x-i)*n.scale-n.x)*Mt,(e.y*n.scale-n.y)*Mt,Mw(e.z,e.y))},s.getVideo=function(n,e){const i=S.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let l=0;l<n.length;l++){const h=S.document.createElement("source");Os(n[l])||(i.crossOrigin="Anonymous"),h.src=n[l],i.appendChild(h)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(n){const e=[0,0,0],i=Yo(new Float64Array(16));return Kl(i,n.pixelMatrix,n.globeMatrix),nn(e,e,i),new Se(e[0],e[1])},s.globeDenormalizeECEF=M_,s.globeECEFOrigin=function(n,e){const i=[0,0,0];return nn(i,i,Sd(vs(e.canonical))),nn(i,i,n),i},s.globeMetersToEcef=Zf,s.globeNormalizeECEF=Sd,s.globePixelsToTileUnits=function(n,e){return Mt/(512*Math.pow(2,n))*Kf(vs(e))},s.globePoleMatrixForTile=function(n,e,i){const l=Yo(new Float64Array(16)),h=(e/(1<<n)-.5)*Math.PI*2;return Hf(l,i.globeMatrix,h),Float32Array.from(l)},s.globeTileBounds=vs,s.globeTiltAtLngLat=Pw,s.globeToMercatorTransition=hu,s.globeUseCustomAntiAliasing=function(n,e,i){const l=hu(i.zoom),h=n.style.map._antialias,p=!!e.extStandardDerivatives,g=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return l===0&&!h&&!g&&p},s.identity=Yo,s.identity$1=xw,s.invert=w_,s.isFullscreen=function(){return!!S.document.fullscreenElement||!!S.document.webkitFullscreenElement},s.isLngLatBehindGlobe=R_,s.isMapAuthenticated=function(n){return ti.has(n)},s.isMapboxURL=Ee,s.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!Tn(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Xn,s.latLngToECEF=uu,s.len=Bz,s.length=gd,s.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},s.lngFromMercatorX=no,s.loadVectorTile=w2,s.makeRequest=Fo,s.mapValue=function(n,e,i,l,h){return Ge((n-e)/(i-e)*(h-l)+l,l,h)},s.mercatorScale=Rw,s.mercatorXfromLng=bs,s.mercatorYfromLat=ws,s.mercatorZfromAltitude=Qo,s.mul=Mz,s.mul$1=Rz,s.multiply=Kl,s.multiply$1=uw,s.multiply$2=fw,s.nextPowerOfTwo=vr,s.normalize=di,s.normalize$1=Lz,s.normalize$2=_w,s.number=or,s.ortho=function(n,e,i,l,h,p,g){var x=1/(e-i),w=1/(l-h),E=1/(p-g);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*E,n[11]=0,n[12]=(e+i)*x,n[13]=(h+l)*w,n[14]=(g+p)*E,n[15]=1,n},s.pbf=xE,s.perspective=function(n,e,i,l,h){var p,g=1/Math.tan(e/2);return n[0]=g/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+l)*(p=1/(l-h)),n[14]=2*h*l*p):(n[10]=-1,n[14]=-2*l),n},s.pick=function(n,e){const i={};for(let l=0;l<e.length;l++){const h=e[l];h in n&&(i[h]=n[h])}return i},s.plugin=T,s.pointGeometry=ye,s.polesInViewport=function(n){const e=Yo(new Float64Array(16));Kl(e,n.pixelMatrix,n.globeMatrix);const i=[0,To,0],l=[0,Co,0];return nn(i,i,e),nn(l,l,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!R_(n,new Tr(n.center.lat,90)),l[0]>0&&l[0]<=n.width&&l[1]>0&&l[1]<=n.height&&!R_(n,new Tr(n.center.lat,-90))]},s.polygonContainsPoint=rc,s.polygonIntersectsBox=Vw,s.polygonIntersectsPolygon=Fw,s.polygonizeBounds=function(n,e,i=0,l=!0){const h=new Se(i,i),p=n.sub(h),g=e.add(h),x=[p,new Se(g.x,p.y),g,new Se(p.x,g.y)];return l&&x.push(p.clone()),x},s.posAttributes=bd,s.postMapLoadEvent=sn,s.postPerformanceEvent=xn,s.postTurnstileEvent=rr,s.potpack=ry,s.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},s.radToDeg=je,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(n){return n({pluginStatus:d,pluginURL:o}),y.on("pluginStateChange",n),n},s.removeAuthState=function(n){ti.delete(n)},s.renderColorRamp=$_,s.resample=Bw,s.rotateX=E_,s.rotateX$1=vw,s.rotateY=Hf,s.rotateY$1=bw,s.rotateZ=function(n,e,i){var l=Math.sin(i),h=Math.cos(i),p=e[0],g=e[1],x=e[2],w=e[3],E=e[4],I=e[5],z=e[6],D=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*h+E*l,n[1]=g*h+I*l,n[2]=x*h+z*l,n[3]=w*h+D*l,n[4]=E*h-p*l,n[5]=I*h-g*l,n[6]=z*h-x*l,n[7]=D*h-w*l,n},s.rotateZ$1=function(n,e,i){i*=.5;var l=e[0],h=e[1],p=e[2],g=e[3],x=Math.sin(i),w=Math.cos(i);return n[0]=l*w+h*x,n[1]=h*w-l*x,n[2]=p*w+g*x,n[3]=g*w-p*x,n},s.scale=Yl,s.scale$1=gw,s.scale$2=ro,s.scaleAndAdd=xd,s.set=function(n,e,i,l){return n[0]=e,n[1]=i,n[2]=l,n},s.setCacheLimits=function(n,e){Fs=n,Ki=e},s.setColumn=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},s.setRTLTextPlugin=function(n,e,i=!1){if(d===ud||d===hd||d===dd)throw new Error("setRTLTextPlugin cannot be called multiple times.");o=Oo.resolveURL(n),d=ud,Ra=e,m(),i||A()},s.smoothstep=St,s.spec=We,s.squaredLength=function(n){var e=n[0],i=n[1],l=n[2];return e*e+i*i+l*l},s.storeAuthState=function(n,e){e?ti.add(n):ti.delete(n)},s.sub=Jo,s.subtract=A_,s.symbolSize=Z4,s.tileAABB=function(n,e,i,l,h,p,g,x,w){if(w.name==="globe")return Vz(n,e,new lm(i,l,h));const E=ic({z:i,x:l,y:h},w);return new pi([(p+E.x/E.scale)*e,e*(E.y/E.scale),g],[(p+E.x2/E.scale)*e,e*(E.y2/E.scale),x])},s.tileCornersToBounds=Xf,s.tileTransform=ic,s.transformMat3=function(n,e,i){var l=e[0],h=e[1],p=e[2];return n[0]=l*i[0]+h*i[3]+p*i[6],n[1]=l*i[1]+h*i[4]+p*i[7],n[2]=l*i[2]+h*i[5]+p*i[8],n},s.transformMat4=nn,s.transformMat4$1=Jl,s.transformQuat=mw,s.transitionTileAABBinECEF=Tw,s.translate=md,s.transpose=function(n,e){if(n===e){var i=e[1],l=e[2],h=e[5];n[1]=e[3],n[2]=e[6],n[3]=i,n[5]=e[7],n[6]=l,n[7]=h}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},s.triggerPluginCompletionEvent=u,s.uniqueId=ir,s.updateGlobeVertexNormal=function(n,e,i,l,h){const p=5*e+2;n.float32[p+0]=i,n.float32[p+1]=l,n.float32[p+2]=h},s.validateCustomStyleLayer=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=n=>Bi(ql(n)),s.validateFog=n=>Bi(Lf(n)),s.validateLayer=n=>Bi(Df(n)),s.validateLight=n=>Bi(Bf(n)),s.validateSource=n=>Bi(Rf(n)),s.validateStyle=Of,s.validateTerrain=n=>Bi(od(n)),s.values=Je,s.vectorTile=om,s.version=C,s.warnOnce=gr,s.window=S,s.wrap=ft}),_(["./shared"],function(s){function S(de){if(typeof de=="number"||typeof de=="boolean"||typeof de=="string"||de==null)return JSON.stringify(de);if(Array.isArray(de)){let K="[";for(const ue of de)K+=`${S(ue)},`;return`${K}]`}let X="{";for(const K of Object.keys(de).sort())X+=`${K}:${S(de[K])},`;return`${X}}`}function C(de){let X="";for(const K of s.refProperties)X+=`/${S(de[K])}`;return X}class k{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,K){for(const _e of X)this._layerConfigs[_e.id]=_e,(this._layers[_e.id]=s.createStyleLayer(_e)).compileFilter(),this.keyCache[_e.id]&&delete this.keyCache[_e.id];for(const _e of K)delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e];this.familiesBySource={};const ue=function(_e,Ee){const Pe={};for(let we=0;we<_e.length;we++){const Le=Ee&&Ee[_e[we].id]||C(_e[we]);Ee&&(Ee[_e[we].id]=Le);let ct=Pe[Le];ct||(ct=Pe[Le]=[]),ct.push(_e[we])}const ke=[];for(const we in Pe)ke.push(Pe[we]);return ke}(s.values(this._layerConfigs),this.keyCache);for(const _e of ue){const Ee=_e.map(dt=>this._layers[dt.id]),Pe=Ee[0];if(Pe.visibility==="none")continue;const ke=Pe.source||"";let we=this.familiesBySource[ke];we||(we=this.familiesBySource[ke]={});const Le=Pe.sourceLayer||"_geojsonTileLayer";let ct=we[Le];ct||(ct=we[Le]=[]),ct.push(Ee)}}}class M{loadTile(X,K){const{uid:ue,encoding:_e,rawImageData:Ee,padding:Pe,buildQuadTree:ke}=X,we=s.window.ImageBitmap&&Ee instanceof s.window.ImageBitmap?this.getImageData(Ee,Pe):Ee;K(null,new s.DEMData(ue,we,_e,Pe<1,ke))}getImageData(X,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const ue=this.offscreenCanvasContext.getImageData(-K,-K,X.width+2*K,X.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}function L(de,X){if(de.length!==0){V(de[0],X);for(var K=1;K<de.length;K++)V(de[K],!X)}}function V(de,X){for(var K=0,ue=0,_e=0,Ee=de.length,Pe=Ee-1;_e<Ee;Pe=_e++){var ke=(de[_e][0]-de[Pe][0])*(de[Pe][1]+de[_e][1]),we=K+ke;ue+=Math.abs(K)>=Math.abs(ke)?K-we+ke:ke-we+K,K=we}K+ue>=0!=!!X&&de.reverse()}var O=s.getDefaultExportFromCjs(function de(X,K){var ue,_e=X&&X.type;if(_e==="FeatureCollection")for(ue=0;ue<X.features.length;ue++)de(X.features[ue],K);else if(_e==="GeometryCollection")for(ue=0;ue<X.geometries.length;ue++)de(X.geometries[ue],K);else if(_e==="Feature")de(X.geometry,K);else if(_e==="Polygon")L(X.coordinates,K);else if(_e==="MultiPolygon")for(ue=0;ue<X.coordinates.length;ue++)L(X.coordinates[ue],K);return X});const j=s.VectorTileFeature.prototype.toGeoJSON;var H={exports:{}},Z=s.pointGeometry,U=s.vectorTile.VectorTileFeature,$=J;function J(de,X){this.options=X||{},this.features=de,this.length=de.length}function le(de,X){this.id=typeof de.id=="number"?de.id:void 0,this.type=de.type,this.rawGeometry=de.type===1?[de.geometry]:de.geometry,this.properties=de.tags,this.extent=X||4096}J.prototype.feature=function(de){return new le(this.features[de],this.options.extent)},le.prototype.loadGeometry=function(){var de=this.rawGeometry;this.geometry=[];for(var X=0;X<de.length;X++){for(var K=de[X],ue=[],_e=0;_e<K.length;_e++)ue.push(new Z(K[_e][0],K[_e][1]));this.geometry.push(ue)}return this.geometry},le.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var de=this.geometry,X=1/0,K=-1/0,ue=1/0,_e=-1/0,Ee=0;Ee<de.length;Ee++)for(var Pe=de[Ee],ke=0;ke<Pe.length;ke++){var we=Pe[ke];X=Math.min(X,we.x),K=Math.max(K,we.x),ue=Math.min(ue,we.y),_e=Math.max(_e,we.y)}return[X,ue,K,_e]},le.prototype.toGeoJSON=U.prototype.toGeoJSON;var pe=s.pbf,ye=$;function Te(de){var X=new pe;return function(K,ue){for(var _e in K.layers)ue.writeMessage(3,Se,K.layers[_e])}(de,X),X.finish()}function Se(de,X){var K;X.writeVarintField(15,de.version||1),X.writeStringField(1,de.name||""),X.writeVarintField(5,de.extent||4096);var ue={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<de.length;K++)ue.feature=de.feature(K),X.writeMessage(2,Ae,ue);var _e=ue.keys;for(K=0;K<_e.length;K++)X.writeStringField(3,_e[K]);var Ee=ue.values;for(K=0;K<Ee.length;K++)X.writeMessage(4,zt,Ee[K])}function Ae(de,X){var K=de.feature;K.id!==void 0&&X.writeVarintField(1,K.id),X.writeMessage(2,Ne,de),X.writeVarintField(3,K.type),X.writeMessage(4,Ct,K)}function Ne(de,X){var K=de.feature,ue=de.keys,_e=de.values,Ee=de.keycache,Pe=de.valuecache;for(var ke in K.properties){var we=K.properties[ke],Le=Ee[ke];if(we!==null){Le===void 0&&(ue.push(ke),Ee[ke]=Le=ue.length-1),X.writeVarint(Le);var ct=typeof we;ct!=="string"&&ct!=="boolean"&&ct!=="number"&&(we=JSON.stringify(we));var dt=ct+":"+we,st=Pe[dt];st===void 0&&(_e.push(we),Pe[dt]=st=_e.length-1),X.writeVarint(st)}}}function Ue(de,X){return(X<<3)+(7&de)}function je(de){return de<<1^de>>31}function Ct(de,X){for(var K=de.loadGeometry(),ue=de.type,_e=0,Ee=0,Pe=K.length,ke=0;ke<Pe;ke++){var we=K[ke],Le=1;ue===1&&(Le=we.length),X.writeVarint(Ue(1,Le));for(var ct=ue===3?we.length-1:we.length,dt=0;dt<ct;dt++){dt===1&&ue!==1&&X.writeVarint(Ue(2,ct-1));var st=we[dt].x-_e,Rt=we[dt].y-Ee;X.writeVarint(je(st)),X.writeVarint(je(Rt)),_e+=st,Ee+=Rt}ue===3&&X.writeVarint(Ue(7,1))}}function zt(de,X){var K=typeof de;K==="string"?X.writeStringField(1,de):K==="boolean"?X.writeBooleanField(7,de):K==="number"&&(de%1!=0?X.writeDoubleField(3,de):de<0?X.writeSVarintField(6,de):X.writeVarintField(5,de))}H.exports=Te,H.exports.fromVectorTileJs=Te,H.exports.fromGeojsonVt=function(de,X){X=X||{};var K={};for(var ue in de)K[ue]=new ye(de[ue].features,X),K[ue].name=ue,K[ue].version=X.version,K[ue].extent=X.extent;return Te({layers:K})},H.exports.GeoJSONWrapper=ye;var Ut=s.getDefaultExportFromCjs(H.exports);const sr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:de=>de},Ge=Math.fround||(St=new Float32Array(1),de=>(St[0]=+de,St[0]));var St;const ft=3,Ve=5,Je=6;class et{constructor(X){this.options=Object.assign(Object.create(sr),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:K,minZoom:ue,maxZoom:_e}=this.options;K&&console.time("total time");const Ee=`prepare ${X.length} points`;K&&console.time(Ee),this.points=X;const Pe=[];for(let we=0;we<X.length;we++){const Le=X[we];if(!Le.geometry)continue;const[ct,dt]=Le.geometry.coordinates,st=Ge(Zt(ct)),Rt=Ge(vr(dt));Pe.push(st,Rt,1/0,we,-1,1),this.options.reduce&&Pe.push(0)}let ke=this.trees[_e+1]=this._createTree(Pe);K&&console.timeEnd(Ee);for(let we=_e;we>=ue;we--){const Le=+Date.now();ke=this.trees[we]=this._createTree(this._cluster(ke,we)),K&&console.log("z%d: %d clusters in %dms",we,ke.numItems,+Date.now()-Le)}return K&&console.timeEnd("total time"),this}getClusters(X,K){let ue=((X[0]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,X[1]));let Ee=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)ue=-180,Ee=180;else if(ue>Ee){const dt=this.getClusters([ue,_e,180,Pe],K),st=this.getClusters([-180,_e,Ee,Pe],K);return dt.concat(st)}const ke=this.trees[this._limitZoom(K)],we=ke.range(Zt(ue),vr(Pe),Zt(Ee),vr(_e)),Le=ke.data,ct=[];for(const dt of we){const st=this.stride*dt;ct.push(Le[st+Ve]>1?tt(Le,st,this.clusterProps):this.points[Le[st+ft]])}return ct}getChildren(X){const K=this._getOriginId(X),ue=this._getOriginZoom(X),_e="No cluster with the specified id.",Ee=this.trees[ue];if(!Ee)throw new Error(_e);const Pe=Ee.data;if(K*this.stride>=Pe.length)throw new Error(_e);const ke=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),we=Ee.within(Pe[K*this.stride],Pe[K*this.stride+1],ke),Le=[];for(const ct of we){const dt=ct*this.stride;Pe[dt+4]===X&&Le.push(Pe[dt+Ve]>1?tt(Pe,dt,this.clusterProps):this.points[Pe[dt+ft]])}if(Le.length===0)throw new Error(_e);return Le}getLeaves(X,K,ue){const _e=[];return this._appendLeaves(_e,X,K=K||10,ue=ue||0,0),_e}getTile(X,K,ue){const _e=this.trees[this._limitZoom(X)],Ee=Math.pow(2,X),{extent:Pe,radius:ke}=this.options,we=ke/Pe,Le=(ue-we)/Ee,ct=(ue+1+we)/Ee,dt={features:[]};return this._addTileFeatures(_e.range((K-we)/Ee,Le,(K+1+we)/Ee,ct),_e.data,K,ue,Ee,dt),K===0&&this._addTileFeatures(_e.range(1-we/Ee,Le,1,ct),_e.data,Ee,ue,Ee,dt),K===Ee-1&&this._addTileFeatures(_e.range(0,Le,we/Ee,ct),_e.data,-1,ue,Ee,dt),dt.features.length?dt:null}getClusterExpansionZoom(X){let K=this._getOriginZoom(X)-1;for(;K<=this.options.maxZoom;){const ue=this.getChildren(X);if(K++,ue.length!==1)break;X=ue[0].properties.cluster_id}return K}_appendLeaves(X,K,ue,_e,Ee){const Pe=this.getChildren(K);for(const ke of Pe){const we=ke.properties;if(we&&we.cluster?Ee+we.point_count<=_e?Ee+=we.point_count:Ee=this._appendLeaves(X,we.cluster_id,ue,_e,Ee):Ee<_e?Ee++:X.push(ke),X.length===ue)break}return Ee}_createTree(X){const K=new s.KDBush(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ue=0;ue<X.length;ue+=this.stride)K.add(X[ue],X[ue+1]);return K.finish(),K.data=X,K}_addTileFeatures(X,K,ue,_e,Ee,Pe){for(const ke of X){const we=ke*this.stride,Le=K[we+Ve]>1;let ct,dt,st;if(Le)ct=ir(K,we,this.clusterProps),dt=K[we],st=K[we+1];else{const Vt=this.points[K[we+ft]];ct=Vt.properties;const[Kt,rr]=Vt.geometry.coordinates;dt=Zt(Kt),st=vr(rr)}const Rt={type:1,geometry:[[Math.round(this.options.extent*(dt*Ee-ue)),Math.round(this.options.extent*(st*Ee-_e))]],tags:ct};let Ft;Ft=Le||this.options.generateId?K[we+ft]:this.points[K[we+ft]].id,Ft!==void 0&&(Rt.id=Ft),Pe.features.push(Rt)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,K){const{radius:ue,extent:_e,reduce:Ee,minPoints:Pe}=this.options,ke=ue/(_e*Math.pow(2,K)),we=X.data,Le=[],ct=this.stride;for(let dt=0;dt<we.length;dt+=ct){if(we[dt+2]<=K)continue;we[dt+2]=K;const st=we[dt],Rt=we[dt+1],Ft=X.within(we[dt],we[dt+1],ke),Vt=we[dt+Ve];let Kt=Vt;for(const rr of Ft){const Wr=rr*ct;we[Wr+2]>K&&(Kt+=we[Wr+Ve])}if(Kt>Vt&&Kt>=Pe){let rr,Wr=st*Vt,sn=Rt*Vt,Gn=-1;const xn=((dt/ct|0)<<5)+(K+1)+this.points.length;for(const yo of Ft){const kn=yo*ct;if(we[kn+2]<=K)continue;we[kn+2]=K;const ti=we[kn+Ve];Wr+=we[kn]*ti,sn+=we[kn+1]*ti,we[kn+4]=xn,Ee&&(rr||(rr=this._map(we,dt,!0),Gn=this.clusterProps.length,this.clusterProps.push(rr)),Ee(rr,this._map(we,kn)))}we[dt+4]=xn,Le.push(Wr/Kt,sn/Kt,1/0,xn,-1,Kt),Ee&&Le.push(Gn)}else{for(let rr=0;rr<ct;rr++)Le.push(we[dt+rr]);if(Kt>1)for(const rr of Ft){const Wr=rr*ct;if(!(we[Wr+2]<=K)){we[Wr+2]=K;for(let sn=0;sn<ct;sn++)Le.push(we[Wr+sn])}}}}return Le}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,K,ue){if(X[K+Ve]>1){const Pe=this.clusterProps[X[K+Je]];return ue?Object.assign({},Pe):Pe}const _e=this.points[X[K+ft]].properties,Ee=this.options.map(_e);return ue&&Ee===_e?Object.assign({},Ee):Ee}}function tt(de,X,K){return{type:"Feature",id:de[X+ft],properties:ir(de,X,K),geometry:{type:"Point",coordinates:[(ue=de[X],360*(ue-.5)),Xt(de[X+1])]}};var ue}function ir(de,X,K){const ue=de[X+Ve],_e=ue>=1e4?`${Math.round(ue/1e3)}k`:ue>=1e3?Math.round(ue/100)/10+"k":ue,Ee=de[X+Je],Pe=Ee===-1?{}:Object.assign({},K[Ee]);return Object.assign(Pe,{cluster:!0,cluster_id:de[X+ft],point_count:ue,point_count_abbreviated:_e})}function Zt(de){return de/360+.5}function vr(de){const X=Math.sin(de*Math.PI/180),K=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return K<0?0:K>1?1:K}function Xt(de){const X=(180-360*de)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function qn(de,X,K,ue){for(var _e,Ee=ue,Pe=K-X>>1,ke=K-X,we=de[X],Le=de[X+1],ct=de[K],dt=de[K+1],st=X+3;st<K;st+=3){var Rt=cr(de[st],de[st+1],we,Le,ct,dt);if(Rt>Ee)_e=st,Ee=Rt;else if(Rt===Ee){var Ft=Math.abs(st-Pe);Ft<ke&&(_e=st,ke=Ft)}}Ee>ue&&(_e-X>3&&qn(de,X,_e,ue),de[_e+2]=Ee,K-_e>3&&qn(de,_e,K,ue))}function cr(de,X,K,ue,_e,Ee){var Pe=_e-K,ke=Ee-ue;if(Pe!==0||ke!==0){var we=((de-K)*Pe+(X-ue)*ke)/(Pe*Pe+ke*ke);we>1?(K=_e,ue=Ee):we>0&&(K+=Pe*we,ue+=ke*we)}return(Pe=de-K)*Pe+(ke=X-ue)*ke}function Ot(de,X,K,ue){var _e={id:de===void 0?null:de,type:X,geometry:K,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ee){var Pe=Ee.geometry,ke=Ee.type;if(ke==="Point"||ke==="MultiPoint"||ke==="LineString")li(Ee,Pe);else if(ke==="Polygon"||ke==="MultiLineString")for(var we=0;we<Pe.length;we++)li(Ee,Pe[we]);else if(ke==="MultiPolygon")for(we=0;we<Pe.length;we++)for(var Le=0;Le<Pe[we].length;Le++)li(Ee,Pe[we][Le])}(_e),_e}function li(de,X){for(var K=0;K<X.length;K+=3)de.minX=Math.min(de.minX,X[K]),de.minY=Math.min(de.minY,X[K+1]),de.maxX=Math.max(de.maxX,X[K]),de.maxY=Math.max(de.maxY,X[K+1])}function Br(de,X,K,ue){if(X.geometry){var _e=X.geometry.coordinates,Ee=X.geometry.type,Pe=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),ke=[],we=X.id;if(K.promoteId?we=X.properties[K.promoteId]:K.generateId&&(we=ue||0),Ee==="Point")tn(_e,ke);else if(Ee==="MultiPoint")for(var Le=0;Le<_e.length;Le++)tn(_e[Le],ke);else if(Ee==="LineString")gr(_e,ke,Pe,!1);else if(Ee==="MultiLineString"){if(K.lineMetrics){for(Le=0;Le<_e.length;Le++)gr(_e[Le],ke=[],Pe,!1),de.push(Ot(we,"LineString",ke,X.properties));return}An(_e,ke,Pe,!1)}else if(Ee==="Polygon")An(_e,ke,Pe,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(Le=0;Le<X.geometry.geometries.length;Le++)Br(de,{id:we,geometry:X.geometry.geometries[Le],properties:X.properties},K,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Le=0;Le<_e.length;Le++){var ct=[];An(_e[Le],ct,Pe,!0),ke.push(ct)}}de.push(Ot(we,Ee,ke,X.properties))}}function tn(de,X){X.push(Bo(de[0])),X.push(ei(de[1])),X.push(0)}function gr(de,X,K,ue){for(var _e,Ee,Pe=0,ke=0;ke<de.length;ke++){var we=Bo(de[ke][0]),Le=ei(de[ke][1]);X.push(we),X.push(Le),X.push(0),ke>0&&(Pe+=ue?(_e*Le-we*Ee)/2:Math.sqrt(Math.pow(we-_e,2)+Math.pow(Le-Ee,2))),_e=we,Ee=Le}var ct=X.length-3;X[2]=1,qn(X,0,ct,K),X[ct+2]=1,X.size=Math.abs(Pe),X.start=0,X.end=X.size}function An(de,X,K,ue){for(var _e=0;_e<de.length;_e++){var Ee=[];gr(de[_e],Ee,K,ue),X.push(Ee)}}function Bo(de){return de/360+.5}function ei(de){var X=Math.sin(de*Math.PI/180),K=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return K<0?0:K>1?1:K}function Fn(de,X,K,ue,_e,Ee,Pe,ke){if(ue/=X,Ee>=(K/=X)&&Pe<ue)return de;if(Pe<K||Ee>=ue)return null;for(var we=[],Le=0;Le<de.length;Le++){var ct=de[Le],dt=ct.geometry,st=ct.type,Rt=_e===0?ct.minX:ct.minY,Ft=_e===0?ct.maxX:ct.maxY;if(Rt>=K&&Ft<ue)we.push(ct);else if(!(Ft<K||Rt>=ue)){var Vt=[];if(st==="Point"||st==="MultiPoint")Zi(dt,Vt,K,ue,_e);else if(st==="LineString")Tn(dt,Vt,K,ue,_e,!1,ke.lineMetrics);else if(st==="MultiLineString")On(dt,Vt,K,ue,_e,!1);else if(st==="Polygon")On(dt,Vt,K,ue,_e,!0);else if(st==="MultiPolygon")for(var Kt=0;Kt<dt.length;Kt++){var rr=[];On(dt[Kt],rr,K,ue,_e,!0),rr.length&&Vt.push(rr)}if(Vt.length){if(ke.lineMetrics&&st==="LineString"){for(Kt=0;Kt<Vt.length;Kt++)we.push(Ot(ct.id,st,Vt[Kt],ct.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(Vt.length===1?(st="LineString",Vt=Vt[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=Vt.length===3?"Point":"MultiPoint"),we.push(Ot(ct.id,st,Vt,ct.tags))}}}return we.length?we:null}function Zi(de,X,K,ue,_e){for(var Ee=0;Ee<de.length;Ee+=3){var Pe=de[Ee+_e];Pe>=K&&Pe<=ue&&(X.push(de[Ee]),X.push(de[Ee+1]),X.push(de[Ee+2]))}}function Tn(de,X,K,ue,_e,Ee,Pe){for(var ke,we,Le=Cn(de),ct=_e===0?Fs:Ki,dt=de.start,st=0;st<de.length-3;st+=3){var Rt=de[st],Ft=de[st+1],Vt=de[st+2],Kt=de[st+3],rr=de[st+4],Wr=_e===0?Rt:Ft,sn=_e===0?Kt:rr,Gn=!1;Pe&&(ke=Math.sqrt(Math.pow(Rt-Kt,2)+Math.pow(Ft-rr,2))),Wr<K?sn>K&&(we=ct(Le,Rt,Ft,Kt,rr,K),Pe&&(Le.start=dt+ke*we)):Wr>ue?sn<ue&&(we=ct(Le,Rt,Ft,Kt,rr,ue),Pe&&(Le.start=dt+ke*we)):Xi(Le,Rt,Ft,Vt),sn<K&&Wr>=K&&(we=ct(Le,Rt,Ft,Kt,rr,K),Gn=!0),sn>ue&&Wr<=ue&&(we=ct(Le,Rt,Ft,Kt,rr,ue),Gn=!0),!Ee&&Gn&&(Pe&&(Le.end=dt+ke*we),X.push(Le),Le=Cn(de)),Pe&&(dt+=ke)}var xn=de.length-3;Rt=de[xn],Ft=de[xn+1],Vt=de[xn+2],(Wr=_e===0?Rt:Ft)>=K&&Wr<=ue&&Xi(Le,Rt,Ft,Vt),xn=Le.length-3,Ee&&xn>=3&&(Le[xn]!==Le[0]||Le[xn+1]!==Le[1])&&Xi(Le,Le[0],Le[1],Le[2]),Le.length&&X.push(Le)}function Cn(de){var X=[];return X.size=de.size,X.start=de.start,X.end=de.end,X}function On(de,X,K,ue,_e,Ee){for(var Pe=0;Pe<de.length;Pe++)Tn(de[Pe],X,K,ue,_e,Ee,!1)}function Xi(de,X,K,ue){de.push(X),de.push(K),de.push(ue)}function Fs(de,X,K,ue,_e,Ee){var Pe=(Ee-X)/(ue-X);return de.push(Ee),de.push(K+(_e-K)*Pe),de.push(1),Pe}function Ki(de,X,K,ue,_e,Ee){var Pe=(Ee-K)/(_e-K);return de.push(X+(ue-X)*Pe),de.push(Ee),de.push(1),Pe}function In(de,X){for(var K=[],ue=0;ue<de.length;ue++){var _e,Ee=de[ue],Pe=Ee.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")_e=mo(Ee.geometry,X);else if(Pe==="MultiLineString"||Pe==="Polygon"){_e=[];for(var ke=0;ke<Ee.geometry.length;ke++)_e.push(mo(Ee.geometry[ke],X))}else if(Pe==="MultiPolygon")for(_e=[],ke=0;ke<Ee.geometry.length;ke++){for(var we=[],Le=0;Le<Ee.geometry[ke].length;Le++)we.push(mo(Ee.geometry[ke][Le],X));_e.push(we)}K.push(Ot(Ee.id,Pe,_e,Ee.tags))}return K}function mo(de,X){var K=[];K.size=de.size,de.start!==void 0&&(K.start=de.start,K.end=de.end);for(var ue=0;ue<de.length;ue+=3)K.push(de[ue]+X,de[ue+1],de[ue+2]);return K}function fs(de,X){if(de.transformed)return de;var K,ue,_e,Ee=1<<de.z,Pe=de.x,ke=de.y;for(K=0;K<de.features.length;K++){var we=de.features[K],Le=we.geometry,ct=we.type;if(we.geometry=[],ct===1)for(ue=0;ue<Le.length;ue+=2)we.geometry.push(go(Le[ue],Le[ue+1],X,Ee,Pe,ke));else for(ue=0;ue<Le.length;ue++){var dt=[];for(_e=0;_e<Le[ue].length;_e+=2)dt.push(go(Le[ue][_e],Le[ue][_e+1],X,Ee,Pe,ke));we.geometry.push(dt)}}return de.transformed=!0,de}function go(de,X,K,ue,_e,Ee){return[Math.round(K*(de*ue-_e)),Math.round(K*(X*ue-Ee))]}function Si(de,X,K,ue,_e){for(var Ee=X===_e.maxZoom?0:_e.tolerance/((1<<X)*_e.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:K,y:ue,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ke=0;ke<de.length;ke++){Pe.numFeatures++,Yi(Pe,de[ke],Ee,_e);var we=de[ke].minX,Le=de[ke].minY,ct=de[ke].maxX,dt=de[ke].maxY;we<Pe.minX&&(Pe.minX=we),Le<Pe.minY&&(Pe.minY=Le),ct>Pe.maxX&&(Pe.maxX=ct),dt>Pe.maxY&&(Pe.maxY=dt)}return Pe}function Yi(de,X,K,ue){var _e=X.geometry,Ee=X.type,Pe=[];if(Ee==="Point"||Ee==="MultiPoint")for(var ke=0;ke<_e.length;ke+=3)Pe.push(_e[ke]),Pe.push(_e[ke+1]),de.numPoints++,de.numSimplified++;else if(Ee==="LineString")Lo(Pe,_e,de,K,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(ke=0;ke<_e.length;ke++)Lo(Pe,_e[ke],de,K,Ee==="Polygon",ke===0);else if(Ee==="MultiPolygon")for(var we=0;we<_e.length;we++){var Le=_e[we];for(ke=0;ke<Le.length;ke++)Lo(Pe,Le[ke],de,K,!0,ke===0)}if(Pe.length){var ct=X.tags||null;if(Ee==="LineString"&&ue.lineMetrics){for(var dt in ct={},X.tags)ct[dt]=X.tags[dt];ct.mapbox_clip_start=_e.start/_e.size,ct.mapbox_clip_end=_e.end/_e.size}var st={geometry:Pe,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:ct};X.id!==null&&(st.id=X.id),de.features.push(st)}}function Lo(de,X,K,ue,_e,Ee){var Pe=ue*ue;if(ue>0&&X.size<(_e?Pe:ue))K.numPoints+=X.length/3;else{for(var ke=[],we=0;we<X.length;we+=3)(ue===0||X[we+2]>Pe)&&(K.numSimplified++,ke.push(X[we]),ke.push(X[we+1])),K.numPoints++;_e&&function(Le,ct){for(var dt=0,st=0,Rt=Le.length,Ft=Rt-2;st<Rt;Ft=st,st+=2)dt+=(Le[st]-Le[Ft])*(Le[st+1]+Le[Ft+1]);if(dt>0===ct)for(st=0,Rt=Le.length;st<Rt/2;st+=2){var Vt=Le[st],Kt=Le[st+1];Le[st]=Le[Rt-2-st],Le[st+1]=Le[Rt-1-st],Le[Rt-2-st]=Vt,Le[Rt-1-st]=Kt}}(ke,Ee),de.push(ke)}}function Ji(de,X){var K=(X=this.options=function(_e,Ee){for(var Pe in Ee)_e[Pe]=Ee[Pe];return _e}(Object.create(this.options),X)).debug;if(K&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var ue=function(_e,Ee){var Pe=[];if(_e.type==="FeatureCollection")for(var ke=0;ke<_e.features.length;ke++)Br(Pe,_e.features[ke],Ee,ke);else Br(Pe,_e.type==="Feature"?_e:{geometry:_e},Ee);return Pe}(de,X);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=function(_e,Ee){var Pe=Ee.buffer/Ee.extent,ke=_e,we=Fn(_e,1,-1-Pe,Pe,0,-1,2,Ee),Le=Fn(_e,1,1-Pe,2+Pe,0,-1,2,Ee);return(we||Le)&&(ke=Fn(_e,1,-Pe,1+Pe,0,-1,2,Ee)||[],we&&(ke=In(we,1).concat(ke)),Le&&(ke=ke.concat(In(Le,-1)))),ke}(ue,X),ue.length&&this.splitTile(ue,0,0,0),K&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _o(de,X,K){return 32*((1<<de)*K+X)+de}function Fo(de,X){const K=de.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const ue=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ue)return X(null,null);const _e=new class{constructor(Pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=Pe.length,this._features=Pe}feature(Pe){return new class{constructor(ke){this._feature=ke,this.extent=s.EXTENT,this.type=ke.type,this.properties=ke.tags,"id"in ke&&!isNaN(ke.id)&&(this.id=parseInt(ke.id,10))}loadGeometry(){if(this._feature.type===1){const ke=[];for(const we of this._feature.geometry)ke.push([new s.Point(we[0],we[1])]);return ke}{const ke=[];for(const we of this._feature.geometry){const Le=[];for(const ct of we)Le.push(new s.Point(ct[0],ct[1]));ke.push(Le)}return ke}}toGeoJSON(ke,we,Le){return j.call(this,ke,we,Le)}}(this._features[Pe])}}(ue.features);let Ee=Ut(_e);Ee.byteOffset===0&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),X(null,{vectorTile:_e,rawData:Ee.buffer})}Ji.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ji.prototype.splitTile=function(de,X,K,ue,_e,Ee,Pe){for(var ke=[de,X,K,ue],we=this.options,Le=we.debug;ke.length;){ue=ke.pop(),K=ke.pop(),X=ke.pop(),de=ke.pop();var ct=1<<X,dt=_o(X,K,ue),st=this.tiles[dt];if(!st&&(Le>1&&console.time("creation"),st=this.tiles[dt]=Si(de,X,K,ue,we),this.tileCoords.push({z:X,x:K,y:ue}),Le)){Le>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,K,ue,st.numFeatures,st.numPoints,st.numSimplified),console.timeEnd("creation"));var Rt="z"+X;this.stats[Rt]=(this.stats[Rt]||0)+1,this.total++}if(st.source=de,_e){if(X===we.maxZoom||X===_e)continue;var Ft=1<<_e-X;if(K!==Math.floor(Ee/Ft)||ue!==Math.floor(Pe/Ft))continue}else if(X===we.indexMaxZoom||st.numPoints<=we.indexMaxPoints)continue;if(st.source=null,de.length!==0){Le>1&&console.time("clipping");var Vt,Kt,rr,Wr,sn,Gn,xn=.5*we.buffer/we.extent,yo=.5-xn,kn=.5+xn,ti=1+xn;Vt=Kt=rr=Wr=null,sn=Fn(de,ct,K-xn,K+kn,0,st.minX,st.maxX,we),Gn=Fn(de,ct,K+yo,K+ti,0,st.minX,st.maxX,we),de=null,sn&&(Vt=Fn(sn,ct,ue-xn,ue+kn,1,st.minY,st.maxY,we),Kt=Fn(sn,ct,ue+yo,ue+ti,1,st.minY,st.maxY,we),sn=null),Gn&&(rr=Fn(Gn,ct,ue-xn,ue+kn,1,st.minY,st.maxY,we),Wr=Fn(Gn,ct,ue+yo,ue+ti,1,st.minY,st.maxY,we),Gn=null),Le>1&&console.timeEnd("clipping"),ke.push(Vt||[],X+1,2*K,2*ue),ke.push(Kt||[],X+1,2*K,2*ue+1),ke.push(rr||[],X+1,2*K+1,2*ue),ke.push(Wr||[],X+1,2*K+1,2*ue+1)}}},Ji.prototype.getTile=function(de,X,K){var ue=this.options,_e=ue.extent,Ee=ue.debug;if(de<0||de>24)return null;var Pe=1<<de,ke=_o(de,X=(X%Pe+Pe)%Pe,K);if(this.tiles[ke])return fs(this.tiles[ke],_e);Ee>1&&console.log("drilling down to z%d-%d-%d",de,X,K);for(var we,Le=de,ct=X,dt=K;!we&&Le>0;)Le--,ct=Math.floor(ct/2),dt=Math.floor(dt/2),we=this.tiles[_o(Le,ct,dt)];return we&&we.source?(Ee>1&&console.log("found parent tile z%d-%d-%d",Le,ct,dt),Ee>1&&console.time("drilling down"),this.splitTile(we.source,Le,ct,dt,de,X,K),Ee>1&&console.timeEnd("drilling down"),this.tiles[ke]?fs(this.tiles[ke],_e):null):null};class ms extends s.VectorTileWorkerSource{constructor(X,K,ue,_e,Ee){super(X,K,ue,_e,Fo),Ee&&(this.loadGeoJSON=Ee)}loadData(X,K){const ue=X&&X.request,_e=ue&&ue.collectResourceTiming;this.loadGeoJSON(X,(Ee,Pe)=>{if(Ee||!Pe)return K(Ee);if(typeof Pe!="object")return K(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{O(Pe,!0);try{if(X.filter){const we=s.createExpression(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(we.result==="error")throw new Error(we.value.map(ct=>`${ct.key}: ${ct.message}`).join(", "));Pe={type:"FeatureCollection",features:Pe.features.filter(ct=>we.value.evaluate({zoom:0},ct))}}this._geoJSONIndex=X.cluster?new et(function({superclusterOptions:we,clusterProperties:Le}){if(!Le||!we)return we;const ct={},dt={},st={accumulated:null,zoom:0},Rt={properties:null},Ft=Object.keys(Le);for(const Vt of Ft){const[Kt,rr]=Le[Vt],Wr=s.createExpression(rr),sn=s.createExpression(typeof Kt=="string"?[Kt,["accumulated"],["get",Vt]]:Kt);ct[Vt]=Wr.value,dt[Vt]=sn.value}return we.map=Vt=>{Rt.properties=Vt;const Kt={};for(const rr of Ft)Kt[rr]=ct[rr].evaluate(st,Rt);return Kt},we.reduce=(Vt,Kt)=>{Rt.properties=Kt;for(const rr of Ft)st.accumulated=Vt[rr],Vt[rr]=dt[rr].evaluate(st,Rt)},we}(X)).load(Pe.features):function(we,Le){return new Ji(we,Le)}(Pe,X.geojsonVtOptions)}catch(we){return K(we)}this.loaded={};const ke={};if(_e){const we=s.getPerformanceMeasurement(ue);we&&(ke.resourceTiming={},ke.resourceTiming[X.source]=JSON.parse(JSON.stringify(we)))}K(null,ke)}})}reloadTile(X,K){const ue=this.loaded;return ue&&ue[X.uid]?super.reloadTile(X,K):this.loadTile(X,K)}loadGeoJSON(X,K){if(X.request)s.getJSON(X.request,K);else{if(typeof X.data!="string")return K(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(X.data))}catch{return K(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(ue){K(ue)}}getClusterChildren(X,K){try{K(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(ue){K(ue)}}getClusterLeaves(X,K){try{K(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(ue){K(ue)}}}class Os{constructor(X){this.self=X,this.actor=new s.Actor(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:ms},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ue)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ue},this.self.registerRTLTextPlugin=K=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=K.applyArabicShaping,s.plugin.processBidirectionalText=K.processBidirectionalText,s.plugin.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(X,K,ue){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],ue()}checkIfReady(X,K,ue){ue()}setReferrer(X,K){this.referrer=K}spriteLoaded(X,K){this.isSpriteLoaded[X]=K;for(const ue in this.workerSources[X]){const _e=this.workerSources[X][ue];for(const Ee in _e)_e[Ee]instanceof s.VectorTileWorkerSource&&(_e[Ee].isSpriteLoaded=K,_e[Ee].fire(new s.Event("isSpriteLoaded")))}}setImages(X,K,ue){this.availableImages[X]=K;for(const _e in this.workerSources[X]){const Ee=this.workerSources[X][_e];for(const Pe in Ee)Ee[Pe].availableImages=K}ue()}enableTerrain(X,K,ue){this.terrain=K,ue()}setProjection(X,K){this.projections[X]=s.getProjection(K)}setLayers(X,K,ue){this.getLayerIndex(X).replace(K),ue()}updateLayers(X,K,ue){this.getLayerIndex(X).update(K.layers,K.removedIds),ue()}loadTile(X,K,ue){const _e=this.enableTerrain?s.extend({enableTerrain:this.terrain},K):K;_e.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,K.type,K.source).loadTile(_e,ue)}loadDEMTile(X,K,ue){const _e=this.enableTerrain?s.extend({buildQuadTree:this.terrain},K):K;this.getDEMWorkerSource(X,K.source).loadTile(_e,ue)}reloadTile(X,K,ue){const _e=this.enableTerrain?s.extend({enableTerrain:this.terrain},K):K;_e.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,K.type,K.source).reloadTile(_e,ue)}abortTile(X,K,ue){this.getWorkerSource(X,K.type,K.source).abortTile(K,ue)}removeTile(X,K,ue){this.getWorkerSource(X,K.type,K.source).removeTile(K,ue)}removeSource(X,K,ue){if(!this.workerSources[X]||!this.workerSources[X][K.type]||!this.workerSources[X][K.type][K.source])return;const _e=this.workerSources[X][K.type][K.source];delete this.workerSources[X][K.type][K.source],_e.removeSource!==void 0?_e.removeSource(K,ue):ue()}loadWorkerSource(X,K,ue){try{this.self.importScripts(K.url),ue()}catch(_e){ue(_e.toString())}}syncRTLPluginState(X,K,ue){try{s.plugin.setState(K);const _e=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&_e!=null){this.self.importScripts(_e);const Ee=s.plugin.isParsed();ue(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${_e}`),Ee)}}catch(_e){ue(_e.toString())}}getAvailableImages(X){let K=this.availableImages[X];return K||(K=[]),K}getLayerIndex(X){let K=this.layerIndexes[X];return K||(K=this.layerIndexes[X]=new k),K}getWorkerSource(X,K,ue){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][K]||(this.workerSources[X][K]={}),!this.workerSources[X][K][ue]){const _e={send:(Ee,Pe,ke,we,Le,ct)=>{this.actor.send(Ee,Pe,ke,X,Le,ct)},scheduler:this.actor.scheduler};this.workerSources[X][K][ue]=new this.workerSourceTypes[K](_e,this.getLayerIndex(X),this.getAvailableImages(X),this.isSpriteLoaded[X])}return this.workerSources[X][K][ue]}getDEMWorkerSource(X,K){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][K]||(this.demWorkerSources[X][K]=new M),this.demWorkerSources[X][K]}enforceCacheSizeLimit(X,K){s.enforceCacheSizeLimit(K)}getWorkerPerformanceMetrics(X,K,ue){ue(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Os(self)),Os}),_(["./shared"],function(s){function S(d,o){if(Array.isArray(d)){if(!Array.isArray(o)||d.length!==o.length)return!1;for(let u=0;u<d.length;u++)if(!S(d[u],o[u]))return!1;return!0}if(typeof d=="object"&&d!==null&&o!==null){if(typeof o!="object"||Object.keys(d).length!==Object.keys(o).length)return!1;for(const u in d)if(!S(d[u],o[u]))return!1;return!0}return d===o}var C=k;function k(d){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,v=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(v);try{y=new Worker(A),m=!0}catch{m=!1}return y&&y.terminate(),URL.revokeObjectURL(A),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var v=y.getImageData(0,0,1,1);return v&&v.width===m.width}()?(M[u=o&&o.failIfMajorPerformanceCaveat]===void 0&&(M[u]=function(m){var y,v=function(A){var T=document.createElement("canvas"),P=Object.create(k.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=A,T.getContext("webgl",P)||T.getContext("experimental-webgl",P)}(m);if(!v)return!1;try{y=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!y||v.isContextLost())&&(v.shaderSource(y,"void main() {}"),v.compileShader(y),v.getShaderParameter(y,v.COMPILE_STATUS)===!0)}(u)),M[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var u}(d)}var M={};function L(d,o,u){const m=s.window.document.createElement(d);return o!==void 0&&(m.className=o),u&&u.appendChild(m),m}function V(d,o,u){const m=s.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const y of Object.keys(o))m.setAttributeNS(null,y,o[y]);return u&&u.appendChild(m),m}k.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const O=s.window.document&&s.window.document.documentElement.style,j=O&&O.userSelect!==void 0?"userSelect":"WebkitUserSelect";let H;function Z(){O&&j&&(H=O[j],O[j]="none")}function U(){O&&j&&(O[j]=H)}function $(d){d.preventDefault(),d.stopPropagation(),s.window.removeEventListener("click",$,!0)}function J(){s.window.addEventListener("click",$,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",$,!0)},0)}function le(d,o){const u=d.getBoundingClientRect();return Te(d,u,o)}function pe(d,o){const u=d.getBoundingClientRect(),m=[];for(let y=0;y<o.length;y++)m.push(Te(d,u,o[y]));return m}function ye(d){return s.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function Te(d,o,u){const m=d.offsetWidth===o.width?1:d.offsetWidth/o.width;return new s.Point((u.clientX-o.left)*m,(u.clientY-o.top)*m)}function Se(d,o){var u=o[0],m=o[1],y=o[2],v=o[3],A=u*v-y*m;return A?(d[0]=v*(A=1/A),d[1]=-m*A,d[2]=-y*A,d[3]=u*A,d):null}function Ae(d){const{userImage:o}=d;return!!(o&&o.render&&o.render())&&(d.data.replace(new Uint8Array(o.data.buffer)),!0)}class Ne extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:u,callback:m}of this.requestors)this._notify(u,m);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,u){this._validate(o,u)&&(this.images[o]=u)}_validate(o,u){let m=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),m=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),m=!1),this._validateContent(u.content,u)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),m=!1),m}_validateStretch(o,u){if(!o)return!0;let m=0;for(const y of o){if(y[0]<m||y[1]<y[0]||u<y[1])return!1;m=y[1]}return!0}_validateContent(o,u){return!(o&&(o.length!==4||o[0]<0||u.data.width<o[0]||o[1]<0||u.data.height<o[1]||o[2]<0||u.data.width<o[2]||o[3]<0||u.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,u){u.version=this.images[o].version+1,this.images[o]=u,this.updatedImages[o]=!0}removeImage(o){const u=this.images[o];delete this.images[o],delete this.patterns[o],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,u){let m=!0;if(!this.isLoaded())for(const y of o)this.images[y]||(m=!1);this.isLoaded()||m?this._notify(o,u):this.requestors.push({ids:o,callback:u})}_notify(o,u){const m={};for(const y of o){this.images[y]||this.fire(new s.Event("styleimagemissing",{id:y}));const v=this.images[y];v?m[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:s.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,m)}getPixelSize(){const{width:o,height:u}=this.atlasImage;return{width:o,height:u}}getPattern(o){const u=this.patterns[o],m=this.getImage(o);if(!m)return null;if(u&&u.position.version===m.version)return u.position;if(u)u.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},v=new s.ImagePosition(y,m);this.patterns[o]={bin:y,position:v}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const u=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(o,this.atlasImage,u.RGBA),this.atlasTexture&&this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const v in this.patterns)o.push(this.patterns[v].bin);const{w:u,h:m}=s.potpack(o),y=this.atlasImage;y.resize({width:u||1,height:m||1});for(const v in this.patterns){const{bin:A}=this.patterns[v],T=A.x+1,P=A.y+1,B=this.images[v].data,R=B.width,W=B.height;s.RGBAImage.copy(B,y,{x:0,y:0},{x:T,y:P},{width:R,height:W}),s.RGBAImage.copy(B,y,{x:0,y:W-1},{x:T,y:P-1},{width:R,height:1}),s.RGBAImage.copy(B,y,{x:0,y:0},{x:T,y:P+W},{width:R,height:1}),s.RGBAImage.copy(B,y,{x:R-1,y:0},{x:T-1,y:P},{width:1,height:W}),s.RGBAImage.copy(B,y,{x:0,y:0},{x:T+R,y:P},{width:1,height:W})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const u of o){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const m=this.images[u];Ae(m)&&this.updateImage(u,m)}}}const Ue=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(d,o){return function([u,m,y]){const v=s.degToRad(m+90),A=s.degToRad(y);return{x:u*Math.cos(v)*Math.sin(A),y:u*Math.sin(v)*Math.sin(A),z:u*Math.cos(A),azimuthal:m,polar:y}}(d.expression.evaluate(o))}interpolate(d,o,u){return{x:s.number(d.x,o.x,u),y:s.number(d.y,o.y,u),z:s.number(d.z,o.z,u),azimuthal:s.number(d.azimuthal,o.azimuthal,u),polar:s.number(d.polar,o.polar,u)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)});class je extends s.Evented{constructor(o){super(),this._transitionable=new s.Transitionable(Ue),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u={}){if(!this._validate(s.validateLight,o,u))for(const m in o){const y=o[m];s.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,m){return(!m||m.validate!==!1)&&s.emitValidationErrors(this,o.call(s.validateStyle,s.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Ct=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)});let zt=class extends s.Evented{constructor(d,o){super(),this._transitionable=new s.Transitionable(Ct),this.set(d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(d){for(const o in d){const u=d[o];s.endsWith(o,"-transition")?this._transitionable.setTransition(o.slice(0,-11),u):this._transitionable.setValue(o,u)}}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}};function Ut(d,o,u,m){const y=s.smoothstep(45,65,u),[v,A]=sr(d,m),T=s.length(o);let P=1-Math.min(1,Math.exp((T-v)/(A-v)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*y*d.alpha}function sr(d,o){const u=.5/Math.tan(.5*o);return[d.range[0]+u,d.range[1]+u]}const Ge=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])});class St extends s.Evented{constructor(o,u){super(),this._transitionable=new s.Transitionable(Ge),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const o=this._transform,u=o.projection.name==="globe",m=s.globeToMercatorTransition(o.zoom),y=this.properties.get("range"),v=[.5,3];return{range:u?[s.number(v[0],y[0],m),s.number(v[1],y[1],m)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,u={}){if(!this._validate(s.validateFog,o,u)){for(const m of Object.keys(s.spec.fog))o&&o[m]===void 0&&(o[m]=s.spec.fog[m].default);for(const m in o){const y=o[m];s.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,o))*u.a}getOpacityAtLatLng(o,u){return this._transform.projection.supportsFog?function(m,y,v){const A=s.MercatorCoordinate.fromLngLat(y),T=v.elevation?v.elevation.getAtPointOrZero(A):0,P=[A.x,A.y,T];return s.transformMat4(P,P,v.mercatorFogMatrix),Ut(m,P,v.pitch,v._fov)}(this.state,o,u):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?sr(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,m){return(!m||m.validate!==!1)&&s.emitValidationErrors(this,o.call(s.validateStyle,s.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class ft{constructor(o,u){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const m=this.workerPool.acquire(this.id);for(let y=0;y<m.length;y++){const v=new ft.Actor(m[y],u,this.id);v.name=`Worker ${y}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,u,m){s.asyncAll(this.actors,(y,v)=>{y.send(o,u,v)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ve(d,o,u){return o*(s.EXTENT/(d.tileSize*Math.pow(2,u-d.tileID.overscaledZ)))}ft.Actor=s.Actor;class Je{constructor(o,u,m,y){this.screenBounds=o,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(o,u){let m,y;if(o instanceof s.Point||typeof o[0]=="number"){const v=s.Point.convert(o);m=[v],y=u.isPointAboveHorizon(v)}else{const v=s.Point.convert(o[0]),A=s.Point.convert(o[1]);m=[v,A],y=s.polygonizeBounds(v,A).every(T=>u.isPointAboveHorizon(T))}return new Je(m,u.getCameraPoint(),y,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const u=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],y=s.polygonizeBounds(u,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(y[3]=this.cameraPoint)),s.bufferConvexPolygon(y,o)}bufferedCameraGeometryGlobe(o){const u=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],y=s.polygonizeBounds(u,m,o),v=this.cameraPoint.clone();switch(3*((v.y>u.y)+(v.y>m.y))+((v.x>u.x)+(v.x>m.x))){case 0:y[0]=v,y[4]=v.clone();break;case 1:y.splice(1,0,v);break;case 2:y[1]=v;break;case 3:y.splice(4,0,v);break;case 5:y.splice(2,0,v);break;case 6:y[3]=v;break;case 7:y.splice(3,0,v);break;case 8:y[2]=v}return y}containsTile(o,u,m,y=0){const v=o.queryPadding/u._pixelsPerMercatorPixel+1,A=m?this._bufferedCameraMercator(v,u):this._bufferedScreenMercator(v,u);let T=o.tileID.wrap+(A.unwrapped?y:0);const P=A.polygon.map(ie=>s.getTilePoint(o.tileTransform,ie,T));if(!s.polygonIntersectsBox(P,0,0,s.EXTENT,s.EXTENT))return;T=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const B=this.screenGeometryMercator.polygon.map(ie=>s.getTileVec3(o.tileTransform,ie,T)),R=B.map(ie=>new s.Point(ie[0],ie[1])),W=u.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),Y=s.getTileVec3(o.tileTransform,W,T),te=B.map(ie=>{const q=s.sub(ie,ie,Y);return s.normalize(q,q),new s.Ray(Y,q)}),ne=Ve(o,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:te,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(re=s.getBounds(P),re.min.x=s.clamp(re.min.x,0,s.EXTENT),re.min.y=s.clamp(re.min.y,0,s.EXTENT),re.max.x=s.clamp(re.max.x,0,s.EXTENT),re.max.y=s.clamp(re.max.y,0,s.EXTENT),re),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:ne};var re}_bufferedScreenMercator(o,u){const m=ir(o);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let y;return y=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),u):{polygon:this.bufferedScreenGeometry(o).map(v=>u.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(o,u){const m=ir(o);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let y;return y=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),u):{polygon:this.bufferedCameraGeometry(o).map(v=>u.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[m]=y,y}}_projectAndResample(o,u){const m=function(v,A){const T=s.multiply([],A.pixelMatrix,A.globeMatrix),P=[0,-s.GLOBE_RADIUS,0,1],B=[0,s.GLOBE_RADIUS,0,1],R=[0,0,0,1];s.transformMat4$1(P,P,T),s.transformMat4$1(B,B,T),s.transformMat4$1(R,R,T);const W=new s.Point(P[0]/P[3],P[1]/P[3]),Y=new s.Point(B[0]/B[3],B[1]/B[3]),te=s.polygonContainsPoint(v,W)&&P[3]<R[3],ne=s.polygonContainsPoint(v,Y)&&B[3]<R[3];if(!te&&!ne)return null;const re=function(ve,Ie,Ce){for(let Re=1;Re<ve.length;Re++){const it=tt(Ie.pointCoordinate3D(ve[Re-1]).x),ze=tt(Ie.pointCoordinate3D(ve[Re]).x);if(Ce<0){if(it<ze)return{idx:Re,t:-it/(ze-1-it)}}else if(ze<it)return{idx:Re,t:(1-it)/(ze+1-it)}}return null}(v,A,te?-1:1);if(!re)return null;const{idx:ie,t:q}=re;let ee=ie>1?et(v.slice(0,ie),A):[],ae=ie<v.length?et(v.slice(ie),A):[];ee=ee.map(ve=>new s.Point(tt(ve.x),ve.y)),ae=ae.map(ve=>new s.Point(tt(ve.x),ve.y));const ce=[...ee];ce.length===0&&ce.push(ae[ae.length-1]);const xe=s.number(ce[ce.length-1].y,(ae.length===0?ee[0]:ae[0]).y,q);let be;return be=te?[new s.Point(0,xe),new s.Point(0,0),new s.Point(1,0),new s.Point(1,xe)]:[new s.Point(1,xe),new s.Point(1,1),new s.Point(0,1),new s.Point(0,xe)],ce.push(...be),ae.length===0?ce.push(ee[0]):ce.push(...ae),{polygon:ce.map(ve=>new s.MercatorCoordinate(ve.x,ve.y)),unwrapped:!1}}(o,u);if(m)return m;const y=function(v,A){let T=!1,P=-1/0,B=0;for(let W=0;W<v.length-1;W++)v[W].x>P&&(P=v[W].x,B=W);for(let W=0;W<v.length-1;W++){const Y=(B+W)%(v.length-1),te=v[Y],ne=v[Y+1];Math.abs(te.x-ne.x)>.5&&(te.x<ne.x?(te.x+=1,Y===0&&(v[v.length-1].x+=1)):(ne.x+=1,Y+1===v.length-1&&(v[0].x+=1)),T=!0)}const R=s.mercatorXfromLng(A.center.lng);return T&&R<Math.abs(R-1)&&v.forEach(W=>{W.x-=1}),{polygon:v,unwrapped:T}}(et(o,u).map(v=>new s.Point(tt(v.x),v.y)),u);return{polygon:y.polygon.map(v=>new s.MercatorCoordinate(v.x,v.y)),unwrapped:y.unwrapped}}}function et(d,o){return s.resample(d,u=>{const m=o.pointCoordinate3D(u);u.x=m.x,u.y=m.y},1/256)}function tt(d){return d<0?1+d%1:d%1}function ir(d){return 100*d|0}function Zt(d,o,u,m,y){const v=function(A,T){if(A)return y(A);if(T){d.url&&T.tiles&&d.tiles&&delete d.tiles;const P=s.pick(s.extend(T,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(P.vectorLayers=T.vector_layers,P.vectorLayerIds=P.vectorLayers.map(B=>B.id)),P.tiles=o.canonicalizeTileset(P,d.url),y(null,P)}};return d.url?s.getJSON(o.transformRequest(o.normalizeSourceURL(d.url,null,u,m),s.ResourceType.Source),v):s.exported.frame(()=>v(null,d))}class vr{constructor(o,u,m){this.bounds=s.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=u||0,this.maxzoom=m||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const u=Math.pow(2,o.z),m=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*u),y=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*u),v=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*u),A=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*u);return o.x>=m&&o.x<v&&o.y>=y&&o.y<A}}class Xt{constructor(o,u,m){this.context=o;const y=o.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cr{constructor(o,u,m,y){this.length=u.length,this.attributes=m,this.itemSize=u.bytesPerElement,this.dynamicDraw=y,this.context=o;const v=o.gl;this.buffer=v.createBuffer(),o.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let m=0;m<this.attributes.length;m++){const y=u.attributes[this.attributes[m].name];y!==void 0&&o.enableVertexAttribArray(y)}}setVertexAttribPointers(o,u,m){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],A=u.attributes[v.name];A!==void 0&&o.vertexAttribPointer(A,v.components,o[qn[v.type]],!1,this.itemSize,v.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ot{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class li extends Ot{getDefault(){return s.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Br extends Ot{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class tn extends Ot{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class gr extends Ot{getDefault(){return[!0,!0,!0,!0]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class An extends Ot{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Bo extends Ot{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class ei extends Ot{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Fn extends Ot{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Zi extends Ot{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class Tn extends Ot{getDefault(){return[0,1]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Cn extends Ot{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class On extends Ot{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Xi extends Ot{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class Fs extends Ot{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ki extends Ot{getDefault(){return s.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class In extends Ot{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class mo extends Ot{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class fs extends Ot{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class go extends Ot{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let Si,Yi=class extends Ot{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Lo extends Ot{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ji extends Ot{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class _o extends Ot{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Fo extends Ot{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class ms extends Ot{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Os extends Ot{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class de extends Ot{getDefault(){return null}set(o){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class X extends Ot{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class K extends Ot{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class ue extends Ot{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class _e extends Ot{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Ee extends Ot{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class Pe extends Ee{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class ke extends Ee{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class we extends ke{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Le{constructor(o,u,m,y){this.context=o,this.width=u,this.height=m;const v=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new Pe(o,v),y&&(this.depthAttachment=new ke(o,v))}destroy(){const o=this.context.gl,u=this.colorAttachment.get();if(u&&o.deleteTexture(u),this.depthAttachment){const m=this.depthAttachment.get();m&&o.deleteRenderbuffer(m)}o.deleteFramebuffer(this.framebuffer)}}class ct{constructor(o,u=!1){if(this.gl=o,this.isWebGL2=u,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),u){const m=o;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(o),deleteVertexArrayOES:m.deleteVertexArray.bind(o),bindVertexArrayOES:m.bindVertexArray.bind(o)}}this.clearColor=new li(this),this.clearDepth=new Br(this),this.clearStencil=new tn(this),this.colorMask=new gr(this),this.depthMask=new An(this),this.stencilMask=new Bo(this),this.stencilFunc=new ei(this),this.stencilOp=new Fn(this),this.stencilTest=new Zi(this),this.depthRange=new Tn(this),this.depthTest=new Cn(this),this.depthFunc=new On(this),this.blend=new Xi(this),this.blendFunc=new Fs(this),this.blendColor=new Ki(this),this.blendEquation=new In(this),this.cullFace=new mo(this),this.cullFaceSide=new fs(this),this.frontFace=new go(this),this.program=new Yi(this),this.activeTexture=new Lo(this),this.viewport=new Ji(this),this.bindFramebuffer=new _o(this),this.bindRenderbuffer=new Fo(this),this.bindTexture=new ms(this),this.bindVertexBuffer=new Os(this),this.bindElementBuffer=new de(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new X(this),this.pixelStoreUnpack=new K(this),this.pixelStoreUnpackPremultiplyAlpha=new ue(this),this.pixelStoreUnpackFlipY=new _e(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),u||(this.extTextureHalfFloat=o.getExtension("OES_texture_half_float")),(u||this.extTextureHalfFloat&&o.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=u||o.getExtension("OES_standard_derivatives"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u){return new Xt(this,o,u)}createVertexBuffer(o,u,m){return new cr(this,o,u,m)}createRenderbuffer(o,u,m){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,o,u,m),this.bindRenderbuffer.set(null),v}createFramebuffer(o,u,m){return new Le(this,o,u,m)}clear({color:o,depth:u,stencil:m}){const y=this.gl;let v=0;o&&(v|=y.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(v|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),m!==void 0&&(v|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(v)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){S(o.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class dt extends s.Evented{constructor(o,u,m,y){if(super(),this.id=o,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(u,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(o){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=Zt(this._options,this.map._requestManager,u,m,(y,v)=>{this._tileJSONRequest=null,this._loaded=!0,y?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new s.ErrorEvent(y))):v&&(s.extend(this,v),v.bounds&&(this.tileBounds=new vr(v.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),o&&o(y)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(o,u){const m=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(m,s.ResourceType.Tile),data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=u:o.request=o.actor.send("reloadTile",y,v.bind(this));else if(o.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",y,v.bind(this),void 0,!0);else{const A=s.loadVectorTile.call({deduped:this._deduped},y,(T,P)=>{T||!P?v.call(this,T):(y.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},o.actor&&o.actor.send("loadTile",y,v.bind(this),void 0,!0))},!0);o.request={cancel:A}}function v(A,T){return delete o.request,o.aborted?u(null):A&&A.status!==404?u(A):(T&&T.resourceTiming&&(o.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&o.setExpiryData(T),o.loadVectorData(T,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),u(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id})}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class st extends s.Evented{constructor(o,u,m,y){super(),this.id=o,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},u),s.extend(this,s.pick(u,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Zt(this._options,this.map._requestManager,null,null,(u,m)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new s.ErrorEvent(u)):m&&(s.extend(this,m),m.bounds&&(this.tileBounds=new vr(m.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(m.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),o&&o(u)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,u){const m=s.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);o.request=s.getImage(this.map._requestManager.transformRequest(y,s.ResourceType.Tile),(v,A,T,P)=>(delete o.request,o.aborted?(o.state="unloaded",u(null)):v?(o.state="errored",u(v)):A?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:T,expires:P}),o.setTexture(A,this.map.painter),o.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(o,u,m){o.setTexture(u,m)}static unloadTileData(o,u){o.texture&&u.saveTileTexture(o.texture)}abortTile(o,u){o.request&&(o.request.cancel(),delete o.request),u()}unloadTile(o,u){o.texture&&this.map.painter.saveTileTexture(o.texture),u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Rt(d,o,u,m,y,v,A,T){const P=[d,u,y,o,m,v,1,1,1],B=[A,T,1],R=s.adjoint([],P),[W,Y,te]=s.transformMat3(B,B,s.transpose(R,R));return s.multiply$1(P,[W,0,0,0,Y,0,0,0,te],P)}class Ft extends s.Evented{constructor(o,u,m,y){super(),this.id=o,this.dispatcher=m,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=u,this._dirty=!1}load(o,u){this._loaded=u||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(m,y)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new s.ErrorEvent(m));else if(y){const{HTMLImageElement:v}=s.window;this.image=y instanceof v?s.exported.getImageData(y):y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const u=o.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let y=1/0,v=1/0,A=-1/0,T=-1/0;for(const W of m)y=Math.min(y,W.x),v=Math.min(v,W.y),A=Math.max(A,W.x),T=Math.max(T,W.y);const P=Math.max(A-y,T-v),B=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),R=Math.pow(2,B);return new s.CanonicalTileID(B,Math.floor((y+A)/2*R),Math.floor((v+T)/2*R))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const P in this.tiles){const B=this.tiles[P];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray)return;const u=s.tileTransform(this.tileID,this.map.transform.projection),[m,y,v,A]=this.coordinates.map(P=>{const B=u.projection.project(P[0],P[1]);return s.getTilePoint(u,B)._round()});this.perspectiveTransform=function(P,B,R,W,Y,te,ne,re,ie,q){const ee=Rt(0,0,P,0,0,B,P,B),ae=Rt(R,W,Y,te,ne,re,ie,q);return s.multiply$1(ae,s.adjoint(ee,ee),ae),[ae[6]/ae[8]*P/s.EXTENT,ae[7]/ae[8]*B/s.EXTENT]}(this.width,this.height,m.x,m.y,y.x,y.y,A.x,A.y,v.x,v.y);const T=this._boundsArray=new s.StructArrayLayout4i8;T.emplaceBack(m.x,m.y,0,0),T.emplaceBack(y.x,y.y,s.EXTENT,0),T.emplaceBack(A.x,A.y,0,s.EXTENT),T.emplaceBack(v.x,v.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(T,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,u=o.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(o)}loadTile(o,u){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},u(null)):(o.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Vt={vector:dt,raster:st,"raster-dem":class extends st{constructor(d,o,u,m){super(d,o,u,m),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(d,o){const u=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,v){y&&(d.state="errored",o(y)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",o(null))}d.request=s.getImage(this.map._requestManager.transformRequest(u,s.ResourceType.Tile),(function(y,v,A,T){if(delete d.request,d.aborted)d.state="unloaded",o(null);else if(y)d.state="errored",o(y);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:A,expires:T});const P=s.window.ImageBitmap&&v instanceof s.window.ImageBitmap&&(Si==null&&(Si=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),Si),B=1-(v.width-s.prevPowerOfTwo(v.width))/2;B<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const R=P?v:s.exported.getImageData(v,B),W={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:B};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",W,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const o=d.canonical,u=Math.pow(2,o.z),m=(o.x-1+u)%u,y=o.x===0?d.wrap-1:d.wrap,v=(o.x+1+u)%u,A=o.x+1===u?d.wrap+1:d.wrap,T={};return T[new s.OverscaledTileID(d.overscaledZ,y,o.z,m,o.y).key]={backfilled:!1},T[new s.OverscaledTileID(d.overscaledZ,A,o.z,v,o.y).key]={backfilled:!1},o.y>0&&(T[new s.OverscaledTileID(d.overscaledZ,y,o.z,m,o.y-1).key]={backfilled:!1},T[new s.OverscaledTileID(d.overscaledZ,d.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},T[new s.OverscaledTileID(d.overscaledZ,A,o.z,v,o.y-1).key]={backfilled:!1}),o.y+1<u&&(T[new s.OverscaledTileID(d.overscaledZ,y,o.z,m,o.y+1).key]={backfilled:!1},T[new s.OverscaledTileID(d.overscaledZ,d.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},T[new s.OverscaledTileID(d.overscaledZ,A,o.z,v,o.y+1).key]={backfilled:!1}),T}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends s.Evented{constructor(d,o,u,m){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(m),this._data=o.data,this._options=s.extend({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const y=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*y,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*y,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:s.EXTENT,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*y,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},o),this}getClusterChildren(d,o){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},o),this}getClusterLeaves(d,o,u,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:o,offset:u},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=s.extend({},this.workerOptions),o=this._data;typeof o=="string"?(d.request=this.map._requestManager.transformRequest(s.exported.resolveURL(o),s.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(u,m)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new s.ErrorEvent(u));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),this.fire(new s.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,o){const u=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(u,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,y)=>(delete d.request,d.unloadVectorData(),d.aborted?o(null):m?o(m):(d.loadVectorData(y,this.map.painter,u==="reloadTile"),o(null))),void 0,u==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ft{constructor(d,o,u,m){super(d,o,u,m),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const o of d.urls)this.urls.push(this.map._requestManager.transformRequest(o,s.ResourceType.Source).url);s.getVideo(this.urls,(o,u)=>{this._loaded=!0,o?this.fire(new s.ErrorEvent(o)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const o=this.video.seekable;d<o.start(0)||d>o.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,o=d.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(d,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ft,canvas:class extends Ft{constructor(d,o,u,m){super(d,o,u,m),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(v=>typeof v!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends s.Evented{constructor(d,o,u,m){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=o,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new vr(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:o,y:u,z:m}=d.canonical;return this._implementation.hasTile({x:o,y:u,z:m})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,o){const{x:u,y:m,z:y}=d.tileID.canonical,v=new s.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:u,y:m,z:y},{signal:v.signal})).then((function(A){return delete d.request,d.aborted?(d.state="unloaded",o(null)):A===void 0?(d.state="errored",o(null)):A===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",o(null)):function(T){return T instanceof s.window.ImageData||T instanceof s.window.HTMLCanvasElement||T instanceof s.window.ImageBitmap||T instanceof s.window.HTMLImageElement}(A)?(this.loadTileData(d,A),d.state="loaded",void o(null)):(d.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(A=>{A.code!==20&&(d.state="errored",o(A))}),d.request.cancel=()=>v.abort()}loadTileData(d,o){st.loadTileData(d,o,this._map.painter)}unloadTileData(d){st.unloadTileData(d,this._map.painter)}unloadTile(d,o){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:u,y:m,z:y}=d.tileID.canonical;this._implementation.unloadTile({x:u,y:m,z:y})}o()}abortTile(d,o){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Kt=function(d,o,u,m){const y=new Vt[o.type](d,o,u,m);if(y.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${y.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],y),y};function rr(d,o){const u=s.identity([]);return s.scale(u,u,[.5*d.width,.5*-d.height,1]),s.translate(u,u,[1,-1,0]),s.multiply(u,u,d.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(u)}function Wr(d,o,u,m,y,v,A,T=!1){const P=d.tilesIn(m,A,T);P.sort(Gn);const B=[];for(const W of P)B.push({wrappedTileID:W.tile.tileID.wrapped().key,queryResults:W.tile.queryRenderedFeatures(o,u,d._state,W,y,v,rr(d.transform,W.tile.tileID),T)});const R=function(W){const Y={},te={};for(const ne of W){const re=ne.queryResults,ie=ne.wrappedTileID,q=te[ie]=te[ie]||{};for(const ee in re){const ae=re[ee],ce=q[ee]=q[ee]||{},xe=Y[ee]=Y[ee]||[];for(const be of ae)ce[be.featureIndex]||(ce[be.featureIndex]=!0,xe.push(be))}}return Y}(B);for(const W in R)R[W].forEach(Y=>{const te=Y.feature,ne=te.layer;ne&&ne.type!=="background"&&ne.type!=="sky"&&(te.source=ne.source,ne["source-layer"]&&(te.sourceLayer=ne["source-layer"]),te.state=te.id!==void 0?d.getFeatureState(ne["source-layer"],te.id):{})});return R}function sn(d,o){const u=d.getRenderableIds().map(v=>d.getTileByID(v)),m=[],y={};for(let v=0;v<u.length;v++){const A=u[v],T=A.tileID.canonical.key;y[T]||(y[T]=!0,A.querySourceFeatures(m,o))}return m}function Gn(d,o){const u=d.tileID,m=o.tileID;return u.overscaledZ-m.overscaledZ||u.canonical.y-m.canonical.y||u.wrap-m.wrap||u.canonical.x-m.canonical.x}function xn(){return Ra.workerClass!=null?new Ra.workerClass:new s.window.Worker(Ra.workerUrl)}const yo="mapboxgl_preloaded_worker_pool";class kn{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<kn.workerCount;)this.workers.push(new xn);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yo]}numActive(){return Object.keys(this.active).length}}let ti;function ga(){return ti||(ti=new kn),ti}function Kg(d,o){const u={};for(const m in d)m!=="ref"&&(u[m]=d[m]);return s.refProperties.forEach(m=>{m in o&&(u[m]=o[m])}),u}function tf(d){d=d.slice();const o=Object.create(null);for(let u=0;u<d.length;u++)o[d[u].id]=d[u];for(let u=0;u<d.length;u++)"ref"in d[u]&&(d[u]=Kg(d[u],o[d[u].ref]));return d}kn.workerCount=2;const fr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function yh(d,o,u){u.push({command:fr.addSource,args:[d,o[d]]})}function bl(d,o,u){o.push({command:fr.removeSource,args:[d]}),u[d]=!0}function xh(d,o,u,m){bl(d,u,m),yh(d,o,u)}function zc(d,o,u){let m;for(m in d[u])if(d[u].hasOwnProperty(m)&&m!=="data"&&!S(d[u][m],o[u][m]))return!1;for(m in o[u])if(o[u].hasOwnProperty(m)&&m!=="data"&&!S(d[u][m],o[u][m]))return!1;return!0}function xo(d,o,u,m,y,v){let A;for(A in o=o||{},d=d||{})d.hasOwnProperty(A)&&(S(d[A],o[A])||u.push({command:v,args:[m,A,o[A],y]}));for(A in o)o.hasOwnProperty(A)&&!d.hasOwnProperty(A)&&(S(d[A],o[A])||u.push({command:v,args:[m,A,o[A],y]}))}function Oo(d){return d.id}function vh(d,o){return d[o.id]=o,d}class bh{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.clamp(o,0,1);let u=1,m=this._distances[u];const y=o*this.paddedLength+this.padding;for(;m<y&&u<this._distances.length;)m=this._distances[++u];const v=u-1,A=this._distances[v],T=m-A,P=T>0?(y-A)/T:0;return this.points[v].mult(1-P).add(this.points[u].mult(P))}}class Ns{constructor(o,u,m){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(o/m),this.yCellCount=Math.ceil(u/m);for(let A=0;A<this.xCellCount*this.yCellCount;A++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,m,y,v){this._forEachCell(u,m,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(o,u,m,y){this._forEachCell(u-y,m-y,u+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(m),this.circles.push(y)}_insertBoxCell(o,u,m,y,v,A){this.boxCells[v].push(A)}_insertCircleCell(o,u,m,y,v,A){this.circleCells[v].push(A)}_query(o,u,m,y,v,A){if(m<0||o>this.width||y<0||u>this.height)return!v&&[];const T=[];if(o<=0&&u<=0&&this.width<=m&&this.height<=y){if(v)return!0;for(let P=0;P<this.boxKeys.length;P++)T.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const B=this.circles[3*P],R=this.circles[3*P+1],W=this.circles[3*P+2];T.push({key:this.circleKeys[P],x1:B-W,y1:R-W,x2:B+W,y2:R+W})}return A?T.filter(A):T}return this._forEachCell(o,u,m,y,this._queryCell,T,{hitTest:v,seenUids:{box:{},circle:{}}},A),v?T.length>0:T}_queryCircle(o,u,m,y,v){const A=o-m,T=o+m,P=u-m,B=u+m;if(T<0||A>this.width||B<0||P>this.height)return!y&&[];const R=[];return this._forEachCell(A,P,T,B,this._queryCellCircle,R,{hitTest:y,circle:{x:o,y:u,radius:m},seenUids:{box:{},circle:{}}},v),y?R.length>0:R}query(o,u,m,y,v){return this._query(o,u,m,y,!1,v)}hitTest(o,u,m,y,v){return this._query(o,u,m,y,!0,v)}hitTestCircle(o,u,m,y){return this._queryCircle(o,u,m,!0,y)}_queryCell(o,u,m,y,v,A,T,P){const B=T.seenUids,R=this.boxCells[v];if(R!==null){const Y=this.bboxes;for(const te of R)if(!B.box[te]){B.box[te]=!0;const ne=4*te;if(o<=Y[ne+2]&&u<=Y[ne+3]&&m>=Y[ne+0]&&y>=Y[ne+1]&&(!P||P(this.boxKeys[te]))){if(T.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[te],x1:Y[ne],y1:Y[ne+1],x2:Y[ne+2],y2:Y[ne+3]})}}}const W=this.circleCells[v];if(W!==null){const Y=this.circles;for(const te of W)if(!B.circle[te]){B.circle[te]=!0;const ne=3*te;if(this._circleAndRectCollide(Y[ne],Y[ne+1],Y[ne+2],o,u,m,y)&&(!P||P(this.circleKeys[te]))){if(T.hitTest)return A.push(!0),!0;{const re=Y[ne],ie=Y[ne+1],q=Y[ne+2];A.push({key:this.circleKeys[te],x1:re-q,y1:ie-q,x2:re+q,y2:ie+q})}}}}}_queryCellCircle(o,u,m,y,v,A,T,P){const B=T.circle,R=T.seenUids,W=this.boxCells[v];if(W!==null){const te=this.bboxes;for(const ne of W)if(!R.box[ne]){R.box[ne]=!0;const re=4*ne;if(this._circleAndRectCollide(B.x,B.y,B.radius,te[re+0],te[re+1],te[re+2],te[re+3])&&(!P||P(this.boxKeys[ne])))return A.push(!0),!0}}const Y=this.circleCells[v];if(Y!==null){const te=this.circles;for(const ne of Y)if(!R.circle[ne]){R.circle[ne]=!0;const re=3*ne;if(this._circlesCollide(te[re],te[re+1],te[re+2],B.x,B.y,B.radius)&&(!P||P(this.circleKeys[ne])))return A.push(!0),!0}}}_forEachCell(o,u,m,y,v,A,T,P){const B=this._convertToXCellCoord(o),R=this._convertToYCellCoord(u),W=this._convertToXCellCoord(m),Y=this._convertToYCellCoord(y);for(let te=B;te<=W;te++)for(let ne=R;ne<=Y;ne++)if(v.call(this,o,u,m,y,this.xCellCount*ne+te,A,T,P))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,m,y,v,A){const T=y-o,P=v-u,B=m+A;return B*B>T*T+P*P}_circleAndRectCollide(o,u,m,y,v,A,T){const P=(A-y)/2,B=Math.abs(o-(y+P));if(B>P+m)return!1;const R=(T-v)/2,W=Math.abs(u-(v+R));if(W>R+m)return!1;if(B<=P||W<=R)return!0;const Y=B-P,te=W-R;return Y*Y+te*te<=m*m}}const No={unknown:0,flipRequired:1,flipNotRequired:2},wl=Math.tan(85*Math.PI/180);function We(d,o,u,m,y,v,A){const T=s.create();if(u)if(v.name==="globe"){const P=s.calculateGlobeLabelMatrix(y,o);s.multiply(T,T,P)}else{const P=Se([],A);T[0]=P[0],T[1]=P[1],T[4]=P[2],T[5]=P[3],m||s.rotateZ(T,T,y.angle)}else s.multiply(T,y.labelPlaneMatrix,d);return T}function Uo(d,o,u,m,y,v,A){const T=We(d,o,u,m,y,v,A);return v.name==="globe"&&u||(T[2]=T[6]=T[10]=T[14]=0),T}function an(d,o,u,m,y,v,A){if(u){if(v.name==="globe"){const T=We(d,o,u,m,y,v,A);return s.invert(T,T),s.multiply(T,d,T),T}{const T=s.clone(d),P=s.identity([]);return P[0]=A[0],P[1]=A[1],P[4]=A[2],P[5]=A[3],s.multiply(T,T,P),m||s.rotateZ(T,T,-y.angle),T}}return y.glCoordMatrix}function Pn(d,o,u,m){const y=[d,o,u,1];u?s.transformMat4$1(y,y,m):Qt(y,y,m);const v=y[3];return y[0]/=v,y[1]/=v,y[2]/=v,y}function rf(d,o){return Math.min(.5+d/o*.5,1.5)}function vo(d,o){const u=d[0]/d[3],m=d[1]/d[3];return u>=-o[0]&&u<=o[0]&&m>=-o[1]&&m<=o[1]}function wh(d,o,u,m,y,v,A,T,P,B){const R=u.transform,W=m?d.textSizeData:d.iconSizeData,Y=s.evaluateSizeForZoom(W,u.transform.zoom),te=R.projection.name==="globe",ne=[256/u.width*2+1,256/u.height*2+1],re=m?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;re.clear();let ie=null;te&&(ie=m?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const q=d.lineVertexArray,ee=m?d.text.placedSymbolArray:d.icon.placedSymbolArray,ae=u.transform.width/u.transform.height;let ce,xe=!1;for(let be=0;be<ee.length;be++){const ve=ee.get(be),{numGlyphs:Ie,writingMode:Ce}=ve;if(Ce!==s.WritingMode.vertical||xe||ce===s.WritingMode.horizontal||(xe=!0),ce=Ce,(ve.hidden||Ce===s.WritingMode.vertical)&&!xe){Qi(Ie,re);continue}xe=!1;const Re=new s.Point(ve.tileAnchorX,ve.tileAnchorY);let{x:it,y:ze,z:Ze}=R.projection.projectTilePoint(Re.x,Re.y,B.canonical);if(P){const[Nt,At,Bt]=P(Re);it+=Nt,ze+=At,Ze+=Bt}const Fe=[it,ze,Ze,1];if(s.transformMat4$1(Fe,Fe,o),!vo(Fe,ne)){Qi(Ie,re);continue}const nt=rf(u.transform.cameraToCenterDistance,Fe[3]),Me=s.evaluateSizeForFeature(W,Y,ve),He=A?Me/nt:Me*nt,at=Pn(it,ze,Ze,y);if(at[3]<=0){Qi(Ie,re);continue}let Qe={};const lt=A?null:P,kt=xt(ve,He,!1,T,o,y,v,d.glyphOffsetArray,q,re,ie,at,Re,Qe,ae,lt,R.projection,B,A);xe=kt.useVertical,lt&&kt.needsFlipping&&(Qe={}),(kt.notEnoughRoom||xe||kt.needsFlipping&&xt(ve,He,!0,T,o,y,v,d.glyphOffsetArray,q,re,ie,at,Re,Qe,ae,lt,R.projection,B,A).notEnoughRoom)&&Qi(Ie,re)}m?(d.text.dynamicLayoutVertexBuffer.updateData(re),ie&&d.text.globeExtVertexBuffer.updateData(ie)):(d.icon.dynamicLayoutVertexBuffer.updateData(re),ie&&d.icon.globeExtVertexBuffer.updateData(ie))}function nf(d,o,u,m,y,v,A,T,P,B,R,W,Y,te,ne,re){const{lineStartIndex:ie,glyphStartIndex:q,segment:ee}=T,ae=q+T.numGlyphs,ce=ie+T.lineLength,xe=o.getoffsetX(q),be=o.getoffsetX(ae-1),ve=Ai(d*xe,u,m,y,v,A,ee,ie,ce,P,B,R,W,Y,!0,te,ne,re);if(!ve)return null;const Ie=Ai(d*be,u,m,y,v,A,ee,ie,ce,P,B,R,W,Y,!0,te,ne,re);return Ie?{first:ve,last:Ie}:null}function _a(d,o,u,m){return d===s.WritingMode.horizontal&&Math.abs(m)>Math.abs(u)?{useVertical:!0}:d===s.WritingMode.vertical?m>0?{needsFlipping:!0}:null:o!==No.unknown&&function(y,v){return y===0||Math.abs(v/y)>wl}(u,m)?o===No.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function xt(d,o,u,m,y,v,A,T,P,B,R,W,Y,te,ne,re,ie,q,ee){const ae=o/24,ce=d.lineOffsetX*ae,xe=d.lineOffsetY*ae,{lineStartIndex:be,glyphStartIndex:ve,numGlyphs:Ie,segment:Ce,writingMode:Re,flipState:it}=d,ze=be+d.lineLength,Ze=Fe=>{if(R){const[at,Qe,lt]=Fe.up,kt=B.length;s.updateGlobeVertexNormal(R,kt+0,at,Qe,lt),s.updateGlobeVertexNormal(R,kt+1,at,Qe,lt),s.updateGlobeVertexNormal(R,kt+2,at,Qe,lt),s.updateGlobeVertexNormal(R,kt+3,at,Qe,lt)}const[nt,Me,He]=Fe.point;s.addDynamicAttributes(B,nt,Me,He,Fe.angle)};if(Ie>1){const Fe=nf(ae,T,ce,xe,u,W,Y,d,P,v,te,re,!1,ie,q,ee);if(!Fe)return{notEnoughRoom:!0};if(m&&!u){let[nt,Me,He]=Fe.first.point,[at,Qe,lt]=Fe.last.point;[nt,Me]=Pn(nt,Me,He,A),[at,Qe]=Pn(at,Qe,lt,A);const kt=_a(Re,it,(at-nt)*ne,Qe-Me);if(d.flipState=kt&&kt.needsFlipping?No.flipRequired:No.flipNotRequired,kt)return kt}Ze(Fe.first);for(let nt=ve+1;nt<ve+Ie-1;nt++){const Me=Ai(ae*T.getoffsetX(nt),ce,xe,u,W,Y,Ce,be,ze,P,v,te,re,!1,!1,ie,q,ee);if(!Me)return B.length-=4*(nt-ve),{notEnoughRoom:!0};Ze(Me)}Ze(Fe.last)}else{if(m&&!u){const nt=Pn(Y.x,Y.y,0,y),Me=be+Ce+1,He=new s.Point(P.getx(Me),P.gety(Me)),at=Pn(He.x,He.y,0,y),Qe=at[3]>0?at:Jt(Y,He,nt,1,y,void 0,ie,q.canonical),lt=_a(Re,it,(Qe[0]-nt[0])*ne,Qe[1]-nt[1]);if(d.flipState=lt&&lt.needsFlipping?No.flipRequired:No.flipNotRequired,lt)return lt}const Fe=Ai(ae*T.getoffsetX(ve),ce,xe,u,W,Y,Ce,be,ze,P,v,te,re,!1,!1,ie,q,ee);if(!Fe)return{notEnoughRoom:!0};Ze(Fe)}return{}}function tr(d,o,u,m,y){const{x:v,y:A,z:T}=m.projectTilePoint(d.x,d.y,o);if(!y)return Pn(v,A,T,u);const[P,B,R]=y(d);return Pn(v+P,A+B,T+R,u)}function Jt(d,o,u,m,y,v,A,T){const P=tr(d.sub(o)._unit()._add(d),T,y,A,v);return s.sub(P,u,P),s.normalize(P,P),s.scaleAndAdd(P,u,P,m)}function Ai(d,o,u,m,y,v,A,T,P,B,R,W,Y,te,ne,re,ie,q){const ee=m?d-o:d+o;let ae=ee>0?1:-1,ce=0;m&&(ae*=-1,ce=Math.PI),ae<0&&(ce+=Math.PI);let xe=T+A+(ae>0?0:1)|0,be=y,ve=y,Ie=0,Ce=0;const Re=Math.abs(ee),it=[],ze=[];let Ze=v,Fe=Ze;const nt=()=>Jt(Fe,Ze,ve,Re-Ie+1,R,Y,re,ie.canonical);for(;Ie+Ce<=Re;){if(xe+=ae,xe<T||xe>=P)return null;if(ve=be,Fe=Ze,it.push(ve),te&&ze.push(Fe),Ze=new s.Point(B.getx(xe),B.gety(xe)),be=W[xe],!be){const Bt=tr(Ze,ie.canonical,R,re,Y);be=Bt[3]>0?W[xe]=Bt:nt()}Ie+=Ce,Ce=s.distance(ve,be)}ne&&Y&&(W[xe]&&(be=nt(),Ce=s.distance(ve,be)),W[xe]=be);const Me=(Re-Ie)/Ce,He=Ze.sub(Fe)._mult(Me)._add(Fe),at=s.sub([],be,ve),Qe=s.scaleAndAdd([],ve,at,Me);let lt=[0,0,1],kt=at[0],Nt=at[1];if(q&&(lt=re.upVector(ie.canonical,He.x,He.y),lt[0]!==0||lt[1]!==0||lt[2]!==1)){const Bt=[lt[2],0,-lt[0]],er=s.cross([],lt,Bt);s.normalize(Bt,Bt),s.normalize(er,er),kt=s.dot(at,Bt),Nt=s.dot(at,er)}if(u){const Bt=s.cross([],lt,at);s.normalize(Bt,Bt),s.scaleAndAdd(Qe,Qe,Bt,u*ae)}const At=ce+Math.atan2(Nt,kt);return it.push(Qe),te&&ze.push(He),{point:Qe,angle:At,path:it,tilePath:ze,up:lt}}function Qi(d,o){const u=o.length,m=u+4*d;o.resize(m),o.float32.fill(-1/0,4*u,4*m)}function Qt(d,o,u){const m=o[0],y=o[1];return d[0]=u[0]*m+u[4]*y+u[12],d[1]=u[1]*m+u[5]*y+u[13],d[3]=u[3]*m+u[7]*y+u[15],d}const Ti=100;class El{constructor(o,u,m=new Ns(o.width+200,o.height+200,25),y=new Ns(o.width+200,o.height+200,25)){this.transform=o,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Ti,this.screenBottomBoundary=o.height+Ti,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=u}placeCollisionBox(o,u,m,y,v,A,T,P){let B=m.projectedAnchorX,R=m.projectedAnchorY,W=m.projectedAnchorZ;const Y=m.elevation,te=m.tileID,ne=o.getProjection();if(Y&&te){const[be,ve,Ie]=ne.upVector(te.canonical,m.tileAnchorX,m.tileAnchorY),Ce=ne.upVectorScale(te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=be*Y*Ce,R+=ve*Y*Ce,W+=Ie*Y*Ce}const re=this.projectAndGetPerspectiveRatio(T,B,R,W,m.tileID,ne.name==="globe"||!!Y||this.transform.pitch>0,ne),ie=A*re.perspectiveRatio,q=(m.x1*u+y.x-m.padding)*ie+re.point.x,ee=(m.y1*u+y.y-m.padding)*ie+re.point.y,ae=(m.x2*u+y.x+m.padding)*ie+re.point.x,ce=(m.y2*u+y.y+m.padding)*ie+re.point.y,xe=re.perspectiveRatio<=.55||re.occluded;return!this.isInsideGrid(q,ee,ae,ce)||!v&&this.grid.hitTest(q,ee,ae,ce,P)||xe?{box:[],offscreen:!1,occluded:re.occluded}:{box:[q,ee,ae,ce],offscreen:this.isOffscreen(q,ee,ae,ce),occluded:!1}}placeCollisionCircles(o,u,m,y,v,A,T,P,B,R,W,Y,te,ne,re){const ie=[],q=this.transform.elevation,ee=o.getProjection(),ae=q?q.getAtTileOffsetFunc(re,this.transform.center.lat,this.transform.worldSize,ee):null,ce=new s.Point(m.tileAnchorX,m.tileAnchorY);let{x:xe,y:be,z:ve}=ee.projectTilePoint(ce.x,ce.y,re.canonical);if(ae){const[He,at,Qe]=ae(ce);xe+=He,be+=at,ve+=Qe}const Ie=ee.name==="globe",Ce=this.projectAndGetPerspectiveRatio(T,xe,be,ve,re,Ie||!!q||this.transform.pitch>0,ee),{perspectiveRatio:Re}=Ce,it=(W?A/Re:A*Re)/s.ONE_EM,ze=Pn(xe,be,ve,P),Ze=Ce.signedDistanceFromCamera>0?nf(it,v,m.lineOffsetX*it,m.lineOffsetY*it,!1,ze,ce,m,y,P,{},q&&!W?ae:null,W&&!!q,ee,re,W):null;let Fe=!1,nt=!1,Me=!0;if(Ze&&!Ce.occluded){const He=.5*te*Re+ne,at=new s.Point(-100,-100),Qe=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),lt=new bh,{first:kt,last:Nt}=Ze,At=kt.path.length;let Bt=[];for(let It=At-1;It>=1;It--)Bt.push(kt.path[It]);for(let It=1;It<Nt.path.length;It++)Bt.push(Nt.path[It]);const er=2.5*He;B&&(Bt=Bt.map(([It,_r,wr],Er)=>(ae&&!Ie&&(wr=ae(Er<At-1?kt.tilePath[At-1-Er]:Nt.tilePath[Er-At+2])[2]),Pn(It,_r,wr,B))),Bt.some(It=>It[3]<=0)&&(Bt=[]));let Yt=[];if(Bt.length>0){let It=1/0,_r=-1/0,wr=1/0,Er=-1/0;for(const Sr of Bt)It=Math.min(It,Sr[0]),wr=Math.min(wr,Sr[1]),_r=Math.max(_r,Sr[0]),Er=Math.max(Er,Sr[1]);_r>=at.x&&It<=Qe.x&&Er>=at.y&&wr<=Qe.y&&(Yt=[Bt.map(Sr=>new s.Point(Sr[0],Sr[1]))],(It<at.x||_r>Qe.x||wr<at.y||Er>Qe.y)&&(Yt=s.clipLine(Yt,at.x,at.y,Qe.x,Qe.y)))}for(const It of Yt){lt.reset(It,.25*He);let _r=0;_r=lt.length<=.5*He?1:Math.ceil(lt.paddedLength/er)+1;for(let wr=0;wr<_r;wr++){const Er=wr/Math.max(_r-1,1),Sr=lt.lerp(Er),Zn=Sr.x+Ti,Dn=Sr.y+Ti;ie.push(Zn,Dn,He,0);const Li=Zn-He,So=Dn-He,Ur=Zn+He,Ar=Dn+He;if(Me=Me&&this.isOffscreen(Li,So,Ur,Ar),nt=nt||this.isInsideGrid(Li,So,Ur,Ar),!u&&this.grid.hitTestCircle(Zn,Dn,He,Y)&&(Fe=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Fe,occluded:!1}}}}return{circles:!R&&Fe||!nt?[]:ie,offscreen:Me,collisionDetected:Fe,occluded:Ce.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let m=1/0,y=1/0,v=-1/0,A=-1/0;for(const R of o){const W=new s.Point(R.x+Ti,R.y+Ti);m=Math.min(m,W.x),y=Math.min(y,W.y),v=Math.max(v,W.x),A=Math.max(A,W.y),u.push(W)}const T=this.grid.query(m,y,v,A).concat(this.ignoredGrid.query(m,y,v,A)),P={},B={};for(const R of T){const W=R.key;if(P[W.bucketInstanceId]===void 0&&(P[W.bucketInstanceId]={}),P[W.bucketInstanceId][W.featureIndex])continue;const Y=[new s.Point(R.x1,R.y1),new s.Point(R.x2,R.y1),new s.Point(R.x2,R.y2),new s.Point(R.x1,R.y2)];s.polygonIntersectsPolygon(u,Y)&&(P[W.bucketInstanceId][W.featureIndex]=!0,B[W.bucketInstanceId]===void 0&&(B[W.bucketInstanceId]=[]),B[W.bucketInstanceId].push(W.featureIndex))}return B}insertCollisionBox(o,u,m,y,v){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:v},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,m,y,v){const A=u?this.ignoredGrid:this.grid,T={bucketInstanceId:m,featureIndex:y,collisionGroupID:v};for(let P=0;P<o.length;P+=4)A.insertCircle(T,o[P],o[P+1],o[P+2])}projectAndGetPerspectiveRatio(o,u,m,y,v,A,T){const P=[u,m,y,1];let B=!1;y||this.transform.pitch>0?(s.transformMat4$1(P,P,o),this.fogState&&v&&T.name!=="globe"&&(B=function(Y,te,ne,re,ie,q){const ee=q.calculateFogTileMatrix(ie),ae=[te,ne,re];return s.transformMat4(ae,ae,ee),Ut(Y,ae,q.pitch,q._fov)}(this.fogState,u,m,y,v.toUnwrapped(),this.transform)>.9)):Qt(P,P,o);const R=P[3];return{point:new s.Point((P[0]/R+1)/2*this.transform.width+Ti,(-P[1]/R+1)/2*this.transform.height+Ti),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/R*.5,1.5),signedDistanceFromCamera:R,occluded:A&&P[2]>R||B}}isOffscreen(o,u,m,y){return m<Ti||o>=this.screenRightBoundary||y<Ti||u>this.screenBottomBoundary}isInsideGrid(o,u,m,y){return m>=0&&o<this.gridRightBoundary&&y>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const o=s.identity([]);return s.translate(o,o,[-100,-100,0]),o}}function Us(d,o,u){const m=o.createTileMatrix(d,d.worldSize,u.toUnwrapped());return s.multiply(new Float32Array(16),d.projMatrix,m)}function Di(d,o,u){if(o.projection.name===u.projection.name)return d.projMatrix;const m=u.clone();return m.setProjection(o.projection),Us(m,o.getProjection(),d)}function Nr(d,o,u){return o.name===u.projection.name?d.projMatrix:Us(u,o,d)}class of{constructor(o,u,m,y){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Vo{constructor(o,u,m,y,v,A=!1){this.text=new of(o?o.text:null,u,m,v),this.icon=new of(o?o.icon:null,u,y,v),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Sl{constructor(o,u,m,y=!1){this.text=o,this.icon=u,this.skipFade=m,this.clipped=y}}class Al{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Eh{constructor(o,u,m,y,v){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=v}}class sf{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:m=>m.collisionGroupID===u}}return this.collisionGroups[o]}}function Tl(d,o,u,m,y){const{horizontalAlign:v,verticalAlign:A}=s.getAnchorAlignment(d),T=-(v-.5)*o,P=-(A-.5)*u,B=s.evaluateVariableOffset(d,m);return new s.Point(T+B[0]*y,P+B[1]*y)}function Cl(d,o,u,m,y){const v=new s.Point(d,o);return u&&v._rotate(m?y:-y),v}class Dc{constructor(o,u,m,y,v){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new El(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new sf(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,u,m,y){const v=m.getBucket(u),A=m.latestFeatureIndex;if(!v||!A||u.id!==v.layerIds[0])return;const T=v.layers[0].layout,P=m.collisionBoxArray,B=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),R=m.tileSize/s.EXTENT,W=m.tileID.toUnwrapped();this.transform.setProjection(v.projection);const Y=(te=m.tileID,ne=v.getProjection(),re=this.transform,ne.name===this.projection?re.calculateProjMatrix(te.toUnwrapped()):Us(re,ne,te));var te,ne,re;const ie=T.get("text-pitch-alignment")==="map",q=T.get("text-rotation-alignment")==="map";u.compileFilter();const ee=u.dynamicFilter(),ae=u.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(m),xe=Uo(Y,m.tileID.canonical,ie,q,this.transform,v.getProjection(),ce);let be=null;if(ie){const Ce=an(Y,m.tileID.canonical,ie,q,this.transform,v.getProjection(),ce);be=s.multiply([],this.transform.labelPlaneMatrix,Ce)}let ve=null;ee&&m.latestFeatureIndex&&(ve={unwrappedTileID:W,dynamicFilter:ee,dynamicFilterNeedsFeature:ae,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Eh(v.bucketInstanceId,A,v.sourceLayerIndex,v.index,m.tileID);const Ie={bucket:v,layout:T,posMatrix:Y,textLabelPlaneMatrix:xe,labelToScreenMatrix:be,clippingData:ve,scale:B,textPixelRatio:R,holdingForFade:m.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(y)for(const Ce of v.sortKeyRanges){const{sortKey:Re,symbolInstanceStart:it,symbolInstanceEnd:ze}=Ce;o.push({sortKey:Re,symbolInstanceStart:it,symbolInstanceEnd:ze,parameters:Ie})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Ie})}attemptAnchorPlacement(o,u,m,y,v,A,T,P,B,R,W,Y,te,ne,re,ie,q,ee){const{textOffset0:ae,textOffset1:ce,crossTileID:xe}=Y,be=[ae,ce],ve=Tl(o,m,y,be,v),Ie=this.collisionIndex.placeCollisionBox(ne,v,u,Cl(ve.x,ve.y,A,T,this.transform.angle),W,P,B,R.predicate);if(ie){const Ce=ne.getSymbolInstanceIconSize(ee,this.transform.zoom,Y.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ne,Ce,ie,Cl(ve.x,ve.y,A,T,this.transform.angle),W,P,B,R.predicate).box.length===0)return}if(Ie.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[xe]&&this.prevPlacement.placements[xe]&&this.prevPlacement.placements[xe].text&&(Ce=this.prevPlacement.variableOffsets[xe].anchor),this.variableOffsets[xe]={textOffset:be,width:m,height:y,anchor:o,textScale:v,prevAnchor:Ce},this.markUsedJustification(ne,o,Y,re),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,re,Y),this.placedOrientations[xe]=re),{shift:ve,placedGlyphBoxes:Ie}}}placeLayerBucketPart(o,u,m,y){const{bucket:v,layout:A,posMatrix:T,textLabelPlaneMatrix:P,labelToScreenMatrix:B,clippingData:R,textPixelRatio:W,holdingForFade:Y,collisionBoxArray:te,partiallyEvaluatedTextSize:ne,partiallyEvaluatedIconSize:re,collisionGroup:ie}=o.parameters,q=A.get("text-optional"),ee=A.get("icon-optional"),ae=A.get("text-allow-overlap"),ce=A.get("icon-allow-overlap"),xe=A.get("text-rotation-alignment")==="map",be=A.get("text-pitch-alignment")==="map",ve=A.get("icon-text-fit")!=="none",Ie=A.get("symbol-z-order")==="viewport-y";this.transform.setProjection(v.projection);let Ce=ae&&(ce||!v.hasIconData()||ee),Re=ce&&(ae||!v.hasTextData()||q);!v.collisionArrays&&te&&v.deserializeCollisionBoxes(te),m&&y&&v.updateCollisionDebugBuffers(this.transform.zoom,te);const it=(ze,Ze,Fe)=>{const{crossTileID:nt,numVerticalGlyphVertices:Me}=ze;if(R){const Ur={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ar=null;if(R.dynamicFilterNeedsFeature){const ur=this.retainedQueryData[v.bucketInstanceId];Ar=R.featureIndex.loadFeature({featureIndex:ze.featureIndex,bucketIndex:ur.bucketIndex,sourceLayerIndex:ur.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(Ur,Ar,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new s.Point(ze.tileAnchorX,ze.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[nt]=new Sl(!1,!1,!1,!0),void u.add(nt)}if(u.has(nt))return;if(Y)return void(this.placements[nt]=new Sl(!1,!1,!1));let He=!1,at=!1,Qe=!0,lt=!1,kt=!1,Nt=null,At={box:null,offscreen:null,occluded:null},Bt={box:null,offscreen:null,occluded:null},er=null,Yt=null,It=null,_r=0,wr=0,Er=0;Fe.textFeatureIndex?_r=Fe.textFeatureIndex:ze.useRuntimeCollisionCircles&&(_r=ze.featureIndex),Fe.verticalTextFeatureIndex&&(wr=Fe.verticalTextFeatureIndex);const Sr=Ur=>{Ur.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const Ar=this.transform.elevation;(Ar||Ur.elevation)&&(Ur.elevation=Ar?Ar.getAtTileOffset(Ur.tileID,Ur.tileAnchorX,Ur.tileAnchorY):0)},Zn=Fe.textBox;if(Zn){Sr(Zn);const Ur=ur=>{let ln=s.WritingMode.horizontal;if(v.allowVerticalPlacement&&!ur&&this.prevPlacement){const ri=this.prevPlacement.placedOrientations[nt];ri&&(this.placedOrientations[nt]=ri,ln=ri,this.markUsedOrientation(v,ln,ze))}return ln},Ar=(ur,ln)=>{if(v.allowVerticalPlacement&&Me>0&&Fe.verticalTextBox){for(const ri of v.writingModes)if(ri===s.WritingMode.vertical?(At=ln(),Bt=At):At=ur(),At&&At.box&&At.box.length)break}else At=ur()};if(A.get("text-variable-anchor")){let ur=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[nt]){const Lr=this.prevPlacement.variableOffsets[nt];ur.indexOf(Lr.anchor)>0&&(ur=ur.filter(hi=>hi!==Lr.anchor),ur.unshift(Lr.anchor))}const ln=(Lr,hi,ou)=>{const Zs=v.getSymbolInstanceTextSize(ne,ze,this.transform.zoom,Ze),Hl=(Lr.x2-Lr.x1)*Zs+2*Lr.padding,Zo=(Lr.y2-Lr.y1)*Zs+2*Lr.padding,ys=ve&&!ce?hi:null;ys&&Sr(ys);let Xs={box:[],offscreen:!1,occluded:!1};const su=ae?2*ur.length:ur.length;for(let Zl=0;Zl<su;++Zl){const pd=this.attemptAnchorPlacement(ur[Zl%ur.length],Lr,Hl,Zo,Zs,xe,be,W,T,ie,Zl>=ur.length,ze,Ze,v,ou,ys,ne,re);if(pd&&(Xs=pd.placedGlyphBoxes,Xs&&Xs.box&&Xs.box.length)){He=!0,Nt=pd.shift;break}}return Xs};Ar(()=>ln(Zn,Fe.iconBox,s.WritingMode.horizontal),()=>{const Lr=Fe.verticalTextBox;return Lr&&Sr(Lr),v.allowVerticalPlacement&&!(At&&At.box&&At.box.length)&&Me>0&&Lr?ln(Lr,Fe.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),At&&(He=At.box,Qe=At.offscreen,lt=At.occluded);const ri=Ur(!(!At||!At.box));if(!He&&this.prevPlacement){const Lr=this.prevPlacement.variableOffsets[nt];Lr&&(this.variableOffsets[nt]=Lr,this.markUsedJustification(v,Lr.anchor,ze,ri))}}else{const ur=(ln,ri)=>{const Lr=v.getSymbolInstanceTextSize(ne,ze,this.transform.zoom,Ze),hi=this.collisionIndex.placeCollisionBox(v,Lr,ln,new s.Point(0,0),ae,W,T,ie.predicate);return hi&&hi.box&&hi.box.length&&(this.markUsedOrientation(v,ri,ze),this.placedOrientations[nt]=ri),hi};Ar(()=>ur(Zn,s.WritingMode.horizontal),()=>{const ln=Fe.verticalTextBox;return v.allowVerticalPlacement&&Me>0&&ln?(Sr(ln),ur(ln,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Ur(!!(At&&At.box&&At.box.length))}}if(er=At,He=er&&er.box&&er.box.length>0,Qe=er&&er.offscreen,lt=er&&er.occluded,ze.useRuntimeCollisionCircles){const Ur=v.text.placedSymbolArray.get(ze.centerJustifiedTextSymbolIndex>=0?ze.centerJustifiedTextSymbolIndex:ze.verticalPlacedTextSymbolIndex),Ar=s.evaluateSizeForFeature(v.textSizeData,ne,Ur),ur=A.get("text-padding");Yt=this.collisionIndex.placeCollisionCircles(v,ae,Ur,v.lineVertexArray,v.glyphOffsetArray,Ar,T,P,B,m,be,ie.predicate,ze.collisionCircleDiameter*Ar/s.ONE_EM,ur,this.retainedQueryData[v.bucketInstanceId].tileID),He=ae||Yt.circles.length>0&&!Yt.collisionDetected,Qe=Qe&&Yt.offscreen,lt=Yt.occluded}if(Fe.iconFeatureIndex&&(Er=Fe.iconFeatureIndex),Fe.iconBox){const Ur=Ar=>{Sr(Ar);const ur=ve&&Nt?Cl(Nt.x,Nt.y,xe,be,this.transform.angle):new s.Point(0,0),ln=v.getSymbolInstanceIconSize(re,this.transform.zoom,ze.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,ln,Ar,ur,ce,W,T,ie.predicate)};Bt&&Bt.box&&Bt.box.length&&Fe.verticalIconBox?(It=Ur(Fe.verticalIconBox),at=It.box.length>0):(It=Ur(Fe.iconBox),at=It.box.length>0),Qe=Qe&&It.offscreen,kt=It.occluded}const Dn=q||ze.numHorizontalGlyphVertices===0&&Me===0,Li=ee||ze.numIconVertices===0;if(Dn||Li?Li?Dn||(at=at&&He):He=at&&He:at=He=at&&He,He&&er&&er.box&&this.collisionIndex.insertCollisionBox(er.box,A.get("text-ignore-placement"),v.bucketInstanceId,Bt&&Bt.box&&wr?wr:_r,ie.ID),at&&It&&this.collisionIndex.insertCollisionBox(It.box,A.get("icon-ignore-placement"),v.bucketInstanceId,Er,ie.ID),Yt&&(He&&this.collisionIndex.insertCollisionCircles(Yt.circles,A.get("text-ignore-placement"),v.bucketInstanceId,_r,ie.ID),m)){const Ur=v.bucketInstanceId;let Ar=this.collisionCircleArrays[Ur];Ar===void 0&&(Ar=this.collisionCircleArrays[Ur]=new Al);for(let ur=0;ur<Yt.circles.length;ur+=4)Ar.circles.push(Yt.circles[ur+0]),Ar.circles.push(Yt.circles[ur+1]),Ar.circles.push(Yt.circles[ur+2]),Ar.circles.push(Yt.collisionDetected?1:0)}const So=v.projection.name!=="globe";Ce=Ce&&(So||!lt),Re=Re&&(So||!kt),this.placements[nt]=new Sl(He||Ce,at||Re,Qe||v.justReloaded),u.add(nt)};if(Ie){const ze=v.getSortedSymbolIndexes(this.transform.angle);for(let Ze=ze.length-1;Ze>=0;--Ze){const Fe=ze[Ze];it(v.symbolInstances.get(Fe),Fe,v.collisionArrays[Fe])}}else for(let ze=o.symbolInstanceStart;ze<o.symbolInstanceEnd;ze++)it(v.symbolInstances.get(ze),ze,v.collisionArrays[ze]);if(m&&v.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[v.bucketInstanceId];s.invert(ze.invProjMatrix,T),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(o,u,m,y){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:P,crossTileID:B}=m,R=s.getAnchorJustification(u),W=y===s.WritingMode.vertical?P:R==="left"?v:R==="center"?A:R==="right"?T:-1;v>=0&&(o.text.placedSymbolArray.get(v).crossTileID=W>=0&&v!==W?0:B),A>=0&&(o.text.placedSymbolArray.get(A).crossTileID=W>=0&&A!==W?0:B),T>=0&&(o.text.placedSymbolArray.get(T).crossTileID=W>=0&&T!==W?0:B),P>=0&&(o.text.placedSymbolArray.get(P).crossTileID=W>=0&&P!==W?0:B)}markUsedOrientation(o,u,m){const y=u===s.WritingMode.horizontal||u===s.WritingMode.horizontalOnly?u:0,v=u===s.WritingMode.vertical?u:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:B}=m,R=o.text.placedSymbolArray;A>=0&&(R.get(A).placedOrientation=y),T>=0&&(R.get(T).placedOrientation=y),P>=0&&(R.get(P).placedOrientation=y),B>=0&&(R.get(B).placedOrientation=v)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let m=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const y=u?u.symbolFadeChange(o):1,v=u?u.opacities:{},A=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(const P in this.placements){const B=this.placements[P],R=v[P];R?(this.opacities[P]=new Vo(R,y,B.text,B.icon,null,B.clipped),m=m||B.text!==R.text.placed||B.icon!==R.icon.placed):(this.opacities[P]=new Vo(null,y,B.text,B.icon,B.skipFade,B.clipped),m=m||B.text||B.icon)}for(const P in v){const B=v[P];if(!this.opacities[P]){const R=new Vo(B,y,!1,!1);R.isHidden()||(this.opacities[P]=R,m=m||B.text.placed||B.icon.placed)}}for(const P in A)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=A[P]);for(const P in T)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=T[P]);m?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u){const m=new Set;for(const y of u){const v=y.getBucket(o);v&&y.latestFeatureIndex&&o.id===v.layerIds[0]&&this.updateBucketOpacities(v,m,y.collisionBoxArray)}}updateBucketOpacities(o,u,m){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const y=o.layers[0].layout,v=!!o.layers[0].dynamicFilter(),A=new Vo(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),P=y.get("icon-allow-overlap"),B=y.get("text-variable-anchor"),R=y.get("text-rotation-alignment")==="map",W=y.get("text-pitch-alignment")==="map",Y=y.get("icon-text-fit")!=="none",te=new Vo(null,0,T&&(P||!o.hasIconData()||y.get("icon-optional")),P&&(T||!o.hasTextData()||y.get("text-optional")),!0);!o.collisionArrays&&m&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(m);const ne=(ie,q,ee)=>{for(let ae=0;ae<q/4;ae++)ie.opacityVertexArray.emplaceBack(ee)};let re=0;for(let ie=0;ie<o.symbolInstances.length;ie++){const q=o.symbolInstances.get(ie),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:ae,crossTileID:ce,numIconVertices:xe}=q,be=u.has(ce);let ve=this.opacities[ce];be?ve=A:ve||(ve=te,this.opacities[ce]=ve),u.add(ce);const Ie=ee>0||ae>0,Ce=xe>0,Re=this.placedOrientations[ce],it=Re===s.WritingMode.vertical,ze=Re===s.WritingMode.horizontal||Re===s.WritingMode.horizontalOnly;if(!Ie&&!Ce||ve.isHidden()||re++,Ie){const Ze=Il(ve.text);ne(o.text,ee,it?Yr:Ze),ne(o.text,ae,ze?Yr:Ze);const Fe=ve.text.isHidden(),{leftJustifiedTextSymbolIndex:nt,centerJustifiedTextSymbolIndex:Me,rightJustifiedTextSymbolIndex:He,verticalPlacedTextSymbolIndex:at}=q,Qe=o.text.placedSymbolArray,lt=Fe||it?1:0;nt>=0&&(Qe.get(nt).hidden=lt),Me>=0&&(Qe.get(Me).hidden=lt),He>=0&&(Qe.get(He).hidden=lt),at>=0&&(Qe.get(at).hidden=Fe||ze?1:0);const kt=this.variableOffsets[ce];kt&&this.markUsedJustification(o,kt.anchor,q,Re);const Nt=this.placedOrientations[ce];Nt&&(this.markUsedJustification(o,"left",q,Nt),this.markUsedOrientation(o,Nt,q))}if(Ce){const Ze=Il(ve.icon),{placedIconSymbolIndex:Fe,verticalPlacedIconSymbolIndex:nt}=q,Me=o.icon.placedSymbolArray,He=ve.icon.isHidden()?1:0;Fe>=0&&(ne(o.icon,xe,it?Yr:Ze),Me.get(Fe).hidden=He),nt>=0&&(ne(o.icon,q.numVerticalIconVertices,ze?Yr:Ze),Me.get(nt).hidden=He)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ze=o.collisionArrays[ie];if(Ze){let Fe=new s.Point(0,0),nt=!0;if(Ze.textBox||Ze.verticalTextBox){if(B){const He=this.variableOffsets[ce];He?(Fe=Tl(He.anchor,He.width,He.height,He.textOffset,He.textScale),R&&Fe._rotate(W?this.transform.angle:-this.transform.angle)):nt=!1}v&&(nt=!ve.clipped),Ze.textBox&&ya(o.textCollisionBox.collisionVertexArray,ve.text.placed,!nt||it,Fe.x,Fe.y),Ze.verticalTextBox&&ya(o.textCollisionBox.collisionVertexArray,ve.text.placed,!nt||ze,Fe.x,Fe.y)}const Me=nt&&!!(!ze&&Ze.verticalIconBox);Ze.iconBox&&ya(o.iconCollisionBox.collisionVertexArray,ve.icon.placed,Me,Y?Fe.x:0,Y?Fe.y:0),Ze.verticalIconBox&&ya(o.iconCollisionBox.collisionVertexArray,ve.icon.placed,!Me,Y?Fe.x:0,Y?Fe.y:0)}}}if(o.fullyClipped=re===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ie.invProjMatrix,o.placementViewportMatrix=ie.viewportMatrix,o.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){const m=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*m>o}setStale(){this.stale=!0}}function ya(d,o,u,m,y){d.emplaceBack(o?1:0,u?1:0,m||0,y||0),d.emplaceBack(o?1:0,u?1:0,m||0,y||0),d.emplaceBack(o?1:0,u?1:0,m||0,y||0),d.emplaceBack(o?1:0,u?1:0,m||0,y||0)}const ci=Math.pow(2,25),rn=Math.pow(2,24),Sh=Math.pow(2,17),Ah=Math.pow(2,16),ui=Math.pow(2,9),Mi=Math.pow(2,8),af=Math.pow(2,1);function Il(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const o=d.placed?1:0,u=Math.floor(127*d.opacity);return u*ci+o*rn+u*Sh+o*Ah+u*ui+o*Mi+u*af+o}const Yr=0;class kl{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,u,m,y,v){const A=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(A,y,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((T,P)=>T.sortKey-P.sortKey));this._currentPartIndex<A.length;){const T=A[this._currentPartIndex];if(u.placeLayerBucketPart(T,this._seenCrossTileIDs,m,T.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class Th{constructor(o,u,m,y,v,A,T,P){this.placement=new Dc(o,v,A,T,P),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(o,u,m){const y=s.exported.now(),v=()=>{const A=s.exported.now()-y;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=u[o[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=T)&&(!A.maxzoom||A.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new kl(A)),this._inProgressLayer.continuePlacement(m[A.source],this.placement,this._showCollisionBoxes,A,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Vs=512/s.EXTENT/2;class Nn{constructor(o,u,m){this.tileID=o,this.bucketInstanceId=m,this.index=new s.KDBush(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=o.canonical.x*s.EXTENT,v=o.canonical.y*s.EXTENT;for(let A=0;A<u.length;A++){const{key:T,crossTileID:P,tileAnchorX:B,tileAnchorY:R}=u.get(A),W=Math.floor((y+B)*Vs),Y=Math.floor((v+R)*Vs);this.index.add(W,Y),this.keys.push(T),this.crossTileIDs.push(P)}this.index.finish()}findMatches(o,u,m){const y=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),v=Vs/Math.pow(2,u.canonical.z-this.tileID.canonical.z),A=u.canonical.x*s.EXTENT,T=u.canonical.y*s.EXTENT;for(let P=0;P<o.length;P++){const B=o.get(P);if(B.crossTileID)continue;const{key:R,tileAnchorX:W,tileAnchorY:Y}=B,te=Math.floor((A+W)*v),ne=Math.floor((T+Y)*v),re=this.index.range(te-y,ne-y,te+y,ne+y);for(const ie of re){const q=this.crossTileIDs[ie];if(this.keys[ie]===R&&!m.has(q)){m.add(q),B.crossTileID=q;break}}}}}class Ch{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ih{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const u=Math.round((o-this.lng)/360);if(u!==0)for(const m in this.indexes){const y=this.indexes[m],v={};for(const A in y){const T=y[A];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),v[T.tileID.key]=T}this.indexes[m]=v}this.lng=o}addBucket(o,u,m){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let v=0;v<u.symbolInstances.length;v++)u.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const y=this.usedCrossTileIDs[o.overscaledZ];for(const v in this.indexes){const A=this.indexes[v];if(Number(v)>o.overscaledZ)for(const T in A){const P=A[T];P.tileID.isChildOf(o)&&P.findMatches(u.symbolInstances,o,y)}else{const T=A[o.scaledTo(Number(v)).key];T&&T.findMatches(u.symbolInstances,o,y)}}for(let v=0;v<u.symbolInstances.length;v++){const A=u.symbolInstances.get(v);A.crossTileID||(A.crossTileID=m.generate(),y.add(A.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Nn(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(const m of u.crossTileIDs)this.usedCrossTileIDs[o].delete(m)}removeStaleBuckets(o){let u=!1;for(const m in this.indexes){const y=this.indexes[m];for(const v in y)o[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[v]),delete y[v],u=!0)}return u}}class jo{constructor(){this.layerIndexes={},this.crossTileIDs=new Ch,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,m,y){let v=this.layerIndexes[o.id];v===void 0&&(v=this.layerIndexes[o.id]=new Ih);let A=!1;const T={};y.name!=="globe"&&v.handleWrapJump(m);for(const P of u){const B=P.getBucket(o);B&&o.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(P.tileID,B,this.crossTileIDs)&&(A=!0),T[B.bucketInstanceId]=!0)}return v.removeStaleBuckets(T)&&(A=!0),A}pruneUnusedLayers(o){const u={};o.forEach(m=>{u[m]=!0});for(const m in this.layerIndexes)u[m]||delete this.layerIndexes[m]}}const gs=(d,o)=>s.emitValidationErrors(d,o&&o.filter(u=>u.identifier!=="source.canvas")),Mc=s.pick(fr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Yg=s.pick(fr,["setCenter","setZoom","setBearing","setPitch"]),kh={version:8,layers:[],sources:{}},xa={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class bo extends s.Evented{constructor(o,u={}){super(),this.map=o,this.dispatcher=new ft(ga(),this),this.imageManager=new Ne,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(o._requestManager,u.localFontFamily?s.LocalGlyphMode.all:u.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.crossTileSymbolIndex=new jo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const m=this;this._rtlTextPluginCallback=bo.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,A)=>{if(s.triggerPluginCompletionEvent(v),A&&A.every(T=>T))for(const T in m._sourceCaches){const P=m._sourceCaches[T],B=P.getSource().type;B!=="vector"&&B!=="geojson"||P.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const v=this.getSource(y.sourceId);if(v&&v.vectorLayerIds)for(const A in this._layers){const T=this._layers[A];T.source===v.id&&this._validateLayer(T)}})}loadURL(o,u={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const m=typeof u.validate=="boolean"?u.validate:!s.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,u.accessToken);const y=this.map._requestManager.transformRequest(o,s.ResourceType.Style);this._request=s.getJSON(y,(v,A)=>{this._request=null,v?this.fire(new s.ErrorEvent(v)):A&&this._load(A,m)})}loadJSON(o,u={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(o,u.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(kh,!1)}_updateLayerCount(o,u){const m=u?1:-1;o.is3D()&&(this._num3DLayers+=m),o.type==="circle"&&(this._numCircleLayers+=m),o.type==="symbol"&&(this._numSymbolLayers+=m)}_load(o,u){if(u&&gs(this,s.validateStyle(o)))return;this._loaded=!0,this.stylesheet=s.clone$1(o),this._updateMapProjection();for(const y in o.sources)this.addSource(y,o.sources[y],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const m=tf(this.stylesheet.layers);this._order=m.map(y=>y.id),this._layers={},this._serializedLayers={};for(const y of m){const v=s.createStyleLayer(y);v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new je(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(o){this._spriteRequest=function(u,m,y){let v,A,T;const P=s.exported.devicePixelRatio>1?"@2x":"";let B=s.getJSON(m.transformRequest(m.normalizeSpriteURL(u,P,".json"),s.ResourceType.SpriteJSON),(Y,te)=>{B=null,T||(T=Y,v=te,W())}),R=s.getImage(m.transformRequest(m.normalizeSpriteURL(u,P,".png"),s.ResourceType.SpriteImage),(Y,te)=>{R=null,T||(T=Y,A=te,W())});function W(){if(T)y(T);else if(v&&A){const Y=s.exported.getImageData(A),te={};for(const ne in v){const{width:re,height:ie,x:q,y:ee,sdf:ae,pixelRatio:ce,stretchX:xe,stretchY:be,content:ve}=v[ne],Ie=new s.RGBAImage({width:re,height:ie});s.RGBAImage.copy(Y,Ie,{x:q,y:ee},{x:0,y:0},{width:re,height:ie}),te[ne]={data:Ie,pixelRatio:ce,sdf:ae,stretchX:xe,stretchY:be,content:ve}}y(null,te)}}return{cancel(){B&&(B.cancel(),B=null),R&&(R.cancel(),R=null)}}}(o,this.map._requestManager,(u,m)=>{if(this._spriteRequest=null,u)this.fire(new s.ErrorEvent(u));else if(m)for(const y in m)this.imageManager.addImage(y,m[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(o){const u=this.getSource(o.source);if(!u)return;const m=o.sourceLayer;m&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(m)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${u.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const u=[];for(const m of o){const y=this._layers[m];y.type!=="custom"&&u.push(y.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&(typeof o.isLayerDraped=="function"?o.isLayerDraped():xa[o.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const u=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(y.length||v.length)&&this._updateWorkerLayers(y,v);for(const A in this._updatedSources){const T=this._updatedSources[A];T==="reload"?this._reloadSource(A):T==="clear"&&this._clearSource(A)}this._updateTilesForChangedImages();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const m={};for(const y in this._sourceCaches){const v=this._sourceCaches[y];m[y]=v.used,v.used=!1}for(const y of this._order){const v=this._layers[y];if(v.recalculate(o,this._availableImages),!v.isHidden(o.zoom)){const T=this._getLayerSourceCache(v);T&&(T.used=!0)}const A=this.map.painter;if(A){const T=v.getProgramIds();if(!T)continue;const P=v.getProgramConfiguration(o.zoom);for(const B of T)A.useProgram(B,P)}}for(const y in m){const v=this._sourceCaches[y];m[y]!==v.used&&v.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),gs(this,s.validateStyle(o)))return!1;(o=s.clone$1(o)).layers=tf(o.layers);const u=function(y,v){if(!y)return[{command:fr.setStyle,args:[v]}];let A=[];try{if(!S(y.version,v.version))return[{command:fr.setStyle,args:[v]}];S(y.center,v.center)||A.push({command:fr.setCenter,args:[v.center]}),S(y.zoom,v.zoom)||A.push({command:fr.setZoom,args:[v.zoom]}),S(y.bearing,v.bearing)||A.push({command:fr.setBearing,args:[v.bearing]}),S(y.pitch,v.pitch)||A.push({command:fr.setPitch,args:[v.pitch]}),S(y.sprite,v.sprite)||A.push({command:fr.setSprite,args:[v.sprite]}),S(y.glyphs,v.glyphs)||A.push({command:fr.setGlyphs,args:[v.glyphs]}),S(y.transition,v.transition)||A.push({command:fr.setTransition,args:[v.transition]}),S(y.light,v.light)||A.push({command:fr.setLight,args:[v.light]}),S(y.fog,v.fog)||A.push({command:fr.setFog,args:[v.fog]}),S(y.projection,v.projection)||A.push({command:fr.setProjection,args:[v.projection]});const T={},P=[];(function(W,Y,te,ne){let re;for(re in Y=Y||{},W=W||{})W.hasOwnProperty(re)&&(Y.hasOwnProperty(re)||bl(re,te,ne));for(re in Y){if(!Y.hasOwnProperty(re))continue;const ie=Y[re];W.hasOwnProperty(re)?S(W[re],ie)||(W[re].type==="geojson"&&ie.type==="geojson"&&zc(W,Y,re)?te.push({command:fr.setGeoJSONSourceData,args:[re,ie.data]}):xh(re,Y,te,ne)):yh(re,Y,te)}})(y.sources,v.sources,P,T);const B=[];y.layers&&y.layers.forEach(W=>{W.source&&T[W.source]?A.push({command:fr.removeLayer,args:[W.id]}):B.push(W)});let R=y.terrain;R&&T[R.source]&&(A.push({command:fr.setTerrain,args:[void 0]}),R=void 0),A=A.concat(P),S(R,v.terrain)||A.push({command:fr.setTerrain,args:[v.terrain]}),function(W,Y,te){Y=Y||[];const ne=(W=W||[]).map(Oo),re=Y.map(Oo),ie=W.reduce(vh,{}),q=Y.reduce(vh,{}),ee=ne.slice(),ae=Object.create(null);let ce,xe,be,ve,Ie,Ce,Re;for(ce=0,xe=0;ce<ne.length;ce++)be=ne[ce],q.hasOwnProperty(be)?xe++:(te.push({command:fr.removeLayer,args:[be]}),ee.splice(ee.indexOf(be,xe),1));for(ce=0,xe=0;ce<re.length;ce++)be=re[re.length-1-ce],ee[ee.length-1-ce]!==be&&(ie.hasOwnProperty(be)?(te.push({command:fr.removeLayer,args:[be]}),ee.splice(ee.lastIndexOf(be,ee.length-xe),1)):xe++,Ce=ee[ee.length-ce],te.push({command:fr.addLayer,args:[q[be],Ce]}),ee.splice(ee.length-ce,0,be),ae[be]=!0);for(ce=0;ce<re.length;ce++)if(be=re[ce],ve=ie[be],Ie=q[be],!ae[be]&&!S(ve,Ie))if(S(ve.source,Ie.source)&&S(ve["source-layer"],Ie["source-layer"])&&S(ve.type,Ie.type)){for(Re in xo(ve.layout,Ie.layout,te,be,null,fr.setLayoutProperty),xo(ve.paint,Ie.paint,te,be,null,fr.setPaintProperty),S(ve.filter,Ie.filter)||te.push({command:fr.setFilter,args:[be,Ie.filter]}),S(ve.minzoom,Ie.minzoom)&&S(ve.maxzoom,Ie.maxzoom)||te.push({command:fr.setLayerZoomRange,args:[be,Ie.minzoom,Ie.maxzoom]}),ve)ve.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?xo(ve[Re],Ie[Re],te,be,Re.slice(6),fr.setPaintProperty):S(ve[Re],Ie[Re])||te.push({command:fr.setLayerProperty,args:[be,Re,Ie[Re]]}));for(Re in Ie)Ie.hasOwnProperty(Re)&&!ve.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?xo(ve[Re],Ie[Re],te,be,Re.slice(6),fr.setPaintProperty):S(ve[Re],Ie[Re])||te.push({command:fr.setLayerProperty,args:[be,Re,Ie[Re]]}))}else te.push({command:fr.removeLayer,args:[be]}),Ce=ee[ee.lastIndexOf(be)+1],te.push({command:fr.addLayer,args:[Ie,Ce]})}(B,v.layers,A)}catch(T){console.warn("Unable to compute style diff:",T),A=[{command:fr.setStyle,args:[v]}]}return A}(this.serialize(),o).filter(y=>!(y.command in Yg));if(u.length===0)return!1;const m=u.filter(y=>!(y.command in Mc));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);return u.forEach(y=>{y.command!=="setTransition"&&y.command!=="setProjection"&&this[y.command].apply(this,y.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,u){return this.getImage(o)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,u),this._afterImageUpdated(o),this)}updateImage(o,u){this.imageManager.updateImage(o,u)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,u,m={}){if(this._checkLoaded(),this.getSource(o)!==void 0)throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(s.validateSource,`sources.${o}`,u,null,m))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const y=Kt(o,u,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:y.serialize(),sourceId:o}));const v=A=>{const T=(A?"symbol:":"other:")+o,P=this._sourceCaches[T]=new s.SourceCache(T,y,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[o]=P,P.style=this,P.onAdd(this.map)};v(!1),u.type!=="vector"&&u.type!=="geojson"||v(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const u=this.getSource(o);if(!u)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===o)return this.fire(new s.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new s.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(o);for(const y of m)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,u){this._checkLoaded(),this.getSource(o).setData(u),this._changed=!0}getSource(o){const u=this._getSourceCache(o);return u&&u.getSource()}_getSources(){const o=[];for(const u in this._otherSourceCaches){const m=this._getSourceCache(u);m&&o.push(m.getSource())}return o}addLayer(o,u,m={}){this._checkLoaded();const y=o.id;if(this.getLayer(y))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let v;if(o.type==="custom"){if(gs(this,s.validateCustomStyleLayer(o)))return;v=s.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(y,o.source),o=s.clone$1(o),o=s.extend(o,{source:y})),this._validate(s.validateLayer,`layers.${y}`,o,{arrayIndex:-1},m))return;v=s.createStyleLayer(o),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const A=u?this._order.indexOf(u):this._order.length;if(u&&A===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(A,0,y),this._layerOrderChanged=!0,this._layers[y]=v;const T=this._getLayerSourceCache(v);if(this._removedLayers[y]&&v.source&&T&&v.type!=="custom"){const P=this._removedLayers[y];delete this._removedLayers[y],P.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",T.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,u){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===u)return;const m=this._order.indexOf(o);this._order.splice(m,1);const y=u?this._order.indexOf(u):this._order.length;u&&y===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(y,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const u=this._layers[o];if(!u)return void this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const m=this._order.indexOf(o);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=u,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const u in this._layers)if(this._layers[u].type===o)return!0;return!1}setLayerZoomRange(o,u,m){this._checkLoaded();const y=this.getLayer(o);y?y.minzoom===u&&y.maxzoom===m||(u!=null&&(y.minzoom=u),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,u,m={}){this._checkLoaded();const y=this.getLayer(o);if(y){if(!S(y.filter,u))return u==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(s.validateFilter,`layers.${y.id}.filter`,u,{layerType:y.type},m)||(y.filter=s.clone$1(u),this._updateLayer(y)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const u=this.getLayer(o);return u&&s.clone$1(u.filter)}setLayoutProperty(o,u,m,y={}){this._checkLoaded();const v=this.getLayer(o);v?S(v.getLayoutProperty(u),m)||(v.setLayoutProperty(u,m,y),this._updateLayer(v)):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,u){const m=this.getLayer(o);if(m)return m.getLayoutProperty(u);this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,u,m,y={}){this._checkLoaded();const v=this.getLayer(o);v?S(v.getPaintProperty(u),m)||(v.setPaintProperty(u,m,y)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,u){const m=this.getLayer(o);return m&&m.getPaintProperty(u)}setFeatureState(o,u){this._checkLoaded();const m=o.source,y=o.sourceLayer,v=this.getSource(m);if(!v)return void this.fire(new s.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const A=v.type;if(A==="geojson"&&y)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!y)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const T=this._getSourceCaches(m);for(const P of T)P.setFeatureState(y,o.id,u)}removeFeatureState(o,u){this._checkLoaded();const m=o.source,y=this.getSource(m);if(!y)return void this.fire(new s.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const v=y.type,A=v==="vector"?o.sourceLayer:void 0;if(v==="vector"&&!A)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const T=this._getSourceCaches(m);for(const P of T)P.removeFeatureState(A,o.id,u)}getFeatureState(o){this._checkLoaded();const u=o.source,m=o.sourceLayer,y=this.getSource(u);if(y){if(y.type!=="vector"||m)return o.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(m,o.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const u in this._sourceCaches){const m=this._sourceCaches[u].getSource();o[m.id]||(o[m.id]=m.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0;const u=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&u&&u.getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",u.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const u=A=>this._layers[A].type==="fill-extrusion",m={},y=[];for(let A=this._order.length-1;A>=0;A--){const T=this._order[A];if(u(T)){m[T]=A;for(const P of o){const B=P[T];if(B)for(const R of B)y.push(R)}}}y.sort((A,T)=>T.intersectionZ-A.intersectionZ);const v=[];for(let A=this._order.length-1;A>=0;A--){const T=this._order[A];if(u(T))for(let P=y.length-1;P>=0;P--){const B=y[P].feature;if(m[B.layer.id]<A)break;v.push(B),y.pop()}else for(const P of o){const B=P[T];if(B)for(const R of B)v.push(R.feature)}}return v}queryRenderedFeatures(o,u,m){u&&u.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const y={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of u.layers){const B=this._layers[P];if(!B)return this.fire(new s.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];y[B.source]=!0}}const v=[];u.availableImages=this._availableImages;const A=u&&u.layers?u.layers.some(P=>{const B=this.getLayer(P);return B&&B.is3D()}):this.has3DLayers(),T=Je.createFromScreenPoints(o,m);for(const P in this._sourceCaches){const B=this._sourceCaches[P].getSource().id;u.layers&&!y[B]||v.push(Wr(this._sourceCaches[P],this._layers,this._serializedLayers,T,u,m,A,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(P,B,R,W,Y,te,ne){const re={},ie=te.queryRenderedSymbols(W),q=[];for(const ee of Object.keys(ie).map(Number))q.push(ne[ee]);q.sort(Gn);for(const ee of q){const ae=ee.featureIndex.lookupSymbolFeatures(ie[ee.bucketInstanceId],B,ee.bucketIndex,ee.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,P);for(const ce in ae){const xe=re[ce]=re[ce]||[],be=ae[ce];be.sort((ve,Ie)=>{const Ce=ee.featureSortOrder;if(Ce){const Re=Ce.indexOf(ve.featureIndex);return Ce.indexOf(Ie.featureIndex)-Re}return Ie.featureIndex-ve.featureIndex});for(const ve of be)xe.push(ve)}}for(const ee in re)re[ee].forEach(ae=>{const ce=ae.feature,xe=R(P[ee]);if(!xe)return;const be=xe.getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=be});return re}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),T.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(o,u){u&&u.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const m=this._getSourceCaches(o);let y=[];for(const v of m)y=y.concat(sn(v,u));return y}addSourceType(o,u,m){return bo.getSourceType(o)?m(new Error(`A source type called "${o}" already exists.`)):(bo.setSourceType(o,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:u.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(o,u={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const A in o)if(!S(o[A],m[A])){y=!0;break}if(!y)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(o,u),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,u=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=o;if(u===1){if(typeof m.source=="object"){const y="terrain-dem-src";this.addSource(y,m.source),m=s.clone$1(m),m=s.extend(m,{source:y})}if(this._validate(s.validateTerrain,"terrain",m))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,u)}else{const y=this.terrain,v=y.get();for(const A of Object.keys(s.spec.terrain))!m.hasOwnProperty(A)&&s.spec.terrain[A].default&&(m[A]=s.spec.terrain[A].default);for(const A in m)if(!S(m[A],v[A])){y.set(m),this.stylesheet.terrain=m;const T=this._setTransitionParameters({duration:0});y.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const u=this.fog=new St(o,this.map.transform);this.stylesheet.fog=o;const m=this._setTransitionParameters({duration:0});u.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,m=u.get();Object.keys(o).length===0&&u.set(o);for(const y in o)if(!S(o[y],m[y])){u.set(o),this.stylesheet.fog=o;const v=this._setTransitionParameters({duration:0});u.updateTransitions(v);break}}else this._createFog(o);this._markersNeedUpdate=!0}_setTransitionParameters(o){return{now:s.exported.now(),transition:s.extend(o,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(m=>this.isLayerDraped(this._layers[m])),u=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...u)}_createTerrain(o,u){const m=this.terrain=new zt(o,u);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const y=this._setTransitionParameters({duration:0});m.updateTransitions(y)}_force3DLayerUpdate(){for(const o in this._layers){const u=this._layers[o];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const u=this._layers[o];u.type==="symbol"&&this._updateLayer(u)}}_validate(o,u,m,y,v={}){return(!v||v.validate!==!1)&&gs(this,o.call(s.validateStyle,s.extend({key:u,style:this.serialize(),value:m,styleSpec:s.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const u=this._getSourceCaches(o);for(const m of u)m.clearTiles()}_reloadSource(o){const u=this._getSourceCaches(o);for(const m of u)m.resume(),m.reload()}_reloadSources(){for(const o of this._getSources())o.reload&&o.reload()}_updateSources(o){for(const u in this._sourceCaches)this._sourceCaches[u].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const u=this._sourceCaches[o];u.resume(),u.reload()}}_updatePlacement(o,u,m,y,v=!1){let A=!1,T=!1;const P={};for(const B of this._order){const R=this._layers[B];if(R.type!=="symbol")continue;if(!P[R.source]){const Y=this._getLayerSourceCache(R);if(!Y)continue;P[R.source]=Y.getRenderableIds(!0).map(te=>Y.getTileByID(te)).sort((te,ne)=>ne.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ne.tileID)?-1:1))}const W=this.crossTileSymbolIndex.addLayer(R,P[R.source],o.center.lng,o.projection);A=A||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),o.zoom))&&(this.pauseablePlacement=new Th(o,this._order,v,u,m,y,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),T=!0),A&&this.pauseablePlacement.placement.setStale()),T||A)for(const B of this._order){const R=this._layers[B];R.type==="symbol"&&this.placement.updateLayerOpacities(R,P[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,u,m){this.imageManager.getImages(u.icons,m),this._updateTilesForChangedImages();const y=v=>{v&&v.setDependencies(u.tileID.key,u.type,u.icons)};y(this._otherSourceCaches[u.source]),y(this._symbolSourceCaches[u.source])}getGlyphs(o,u,m){this.glyphManager.getGlyphs(u.stacks,m)}getResource(o,u,m){return s.makeRequest(u,m)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const u=[];return this._otherSourceCaches[o]&&u.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&u.push(this._symbolSourceCaches[o]),u}_isSourceCacheLoaded(o){const u=this._getSourceCaches(o);return u.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):u.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}bo.getSourceType=function(d){return Vt[d]},bo.setSourceType=function(d,o){Vt[d]=o},bo.registerForPluginStateChange=s.registerForPluginStateChange;var Ph=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,js="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",$o=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Pl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Wo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Rc={},va={};const zl=[];ba(Ph,zl),ba($o,zl),ba(Pl,zl),ba(Wo,zl),Rc=mr("",$o),va=mr(Wo,Pl);const lf=mr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Bc=Ph,zh=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Dh={background:mr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:mr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:mr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:mr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:mr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:mr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:mr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:mr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:mr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:mr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:mr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:mr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:mr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:mr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:mr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:mr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:mr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:mr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:mr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:mr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:mr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:mr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:mr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:mr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,js),skyboxGradient:mr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,js),skyboxCapture:mr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:mr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:mr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ba(d,o){const u=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of u)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=m.split(" ");for(const v of y)o.includes(v)||o.push(v)}}function mr(d,o){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),y={},v=[...zl];return ba(d,v),ba(o,v),{fragmentSource:d=d.replace(u,(A,T,P,B,R)=>(y[R]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${R}
varying ${P} ${B} ${R};
#else
uniform ${P} ${B} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${P} ${B} ${R} = u_${R};
#endif
`)),vertexSource:o=o.replace(u,(A,T,P,B,R)=>{const W=B==="float"?"vec2":"vec4",Y=R.match(/color/)?"color":W;return y[R]?T==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${P} ${W} a_${R};
varying ${P} ${B} ${R};
#else
uniform ${P} ${B} u_${R};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${P} ${B} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${Y}(a_${R}, u_${R}_t);
#else
    ${P} ${B} ${R} = u_${R};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${P} ${W} a_${R};
#else
uniform ${P} ${B} u_${R};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${P} ${B} ${R} = a_${R};
#else
    ${P} ${B} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${P} ${B} ${R} = unpack_mix_${Y}(a_${R}, u_${R}_t);
#else
    ${P} ${B} ${R} = u_${R};
#endif
`}),staticAttributes:m,usedDefines:v}}class Jg{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,u,m,y,v,A,T){this.context=o;let P=this.boundPaintVertexBuffers.length!==y.length;for(let R=0;!P&&R<y.length;R++)this.boundPaintVertexBuffers[R]!==y[R]&&(P=!0);let B=this.boundDynamicVertexBuffers.length!==T.length;for(let R=0;!B&&R<T.length;R++)this.boundDynamicVertexBuffers[R]!==T[R]&&(B=!0);if(!o.extVertexArrayObject||!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==m||P||B||this.boundIndexBuffer!==v||this.boundVertexOffset!==A)this.freshBind(u,m,y,v,A,T);else{o.bindVertexArrayOES.set(this.vao);for(const R of T)R&&R.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(o,u,m,y,v,A){let T;const P=o.numAttributes,B=this.context,R=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),T=0,this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=A;else{T=B.currentNumAttributes||0;for(let W=P;W<T;W++)R.disableVertexAttribArray(W)}u.enableAttributes(R,o),u.bind(),u.setVertexAttribPointers(R,o,v);for(const W of m)W.enableAttributes(R,o),W.bind(),W.setVertexAttribPointers(R,o,v);for(const W of A)W&&(W.enableAttributes(R,o),W.bind(),W.setVertexAttribPointers(R,o,v));y&&y.bind(),B.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Mh(d,o){const u=Math.pow(2,o.canonical.z),m=o.canonical.y;return[new s.MercatorCoordinate(0,m/u).toLngLat().lat,new s.MercatorCoordinate(0,(m+1)/u).toLngLat().lat]}function cf(d,o,u,m,y,v,A){const T=d.context,P=T.gl,B=u.fbo;if(!B)return;d.prepareDrawTile();const R=d.useProgram("hillshade");T.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,B.colorAttachment.get());const W=((re,ie,q,ee)=>{const ae=q.paint.get("hillshade-shadow-color"),ce=q.paint.get("hillshade-highlight-color"),xe=q.paint.get("hillshade-accent-color");let be=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);q.paint.get("hillshade-illumination-anchor")==="viewport"&&(be-=re.transform.angle);const ve=!re.options.moving;return{u_matrix:ee||re.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),ve),u_image:0,u_latrange:Mh(0,ie.tileID),u_light:[q.paint.get("hillshade-exaggeration"),be],u_shadow:ae,u_highlight:ce,u_accent:xe}})(d,u,m,d.terrain?o.projMatrix:null);d.prepareDrawProgram(T,R,o.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:te,tileBoundsSegments:ne}=d.getTileBoundsBuffers(u);R.draw(T,P.TRIANGLES,y,v,A,s.CullFaceMode.disabled,W,m.id,Y,te,ne)}function Rh(d,o,u){if(!o.needsDEMTextureUpload)return;const m=d.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||d.getTileTexture(u.stride);const v=u.getPixels();o.demTexture?o.demTexture.update(v,{premultiply:!1}):o.demTexture=new s.Texture(m,v,y.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function uf(d,o,u,m,y,v){const A=d.context,T=A.gl;if(!o.dem)return;const P=o.dem;if(A.activeTexture.set(T.TEXTURE1),Rh(d,o,P),!o.demTexture)return;o.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);const B=P.dim;A.activeTexture.set(T.TEXTURE0);let R=o.fbo;if(!R){const ne=new s.Texture(A,{width:B,height:B,data:null},T.RGBA);ne.bind(T.LINEAR,T.CLAMP_TO_EDGE),R=o.fbo=A.createFramebuffer(B,B,!0),R.colorAttachment.set(ne.texture)}A.bindFramebuffer.set(R.framebuffer),A.viewport.set([0,0,B,B]);const{tileBoundsBuffer:W,tileBoundsIndexBuffer:Y,tileBoundsSegments:te}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(A,T.TRIANGLES,m,y,v,s.CullFaceMode.disabled,((ne,re)=>{const ie=re.stride,q=s.create();return s.ortho(q,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(q,q,[0,-s.EXTENT,0]),{u_matrix:q,u_image:1,u_dimension:[ie,ie],u_zoom:ne.overscaledZ,u_unpack:re.unpackVector}})(o.tileID,P),u.id,W,Y,te),o.needsHillshadePrepare=!1}const Bh=d=>({u_matrix:new s.UniformMatrix4f(d),u_image0:new s.Uniform1i(d),u_skirt_height:new s.Uniform1f(d)}),wa=(d,o)=>({u_matrix:d,u_image0:0,u_skirt_height:o}),Lc=(d,o,u,m,y,v,A,T,P,B,R,W,Y,te,ne)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:u,u_zoom_transition:y,u_merc_center:v,u_image0:0,u_frustum_tl:A,u_frustum_tr:T,u_frustum_br:P,u_frustum_bl:B,u_globe_pos:R,u_globe_radius:W,u_viewport:Y,u_grid_matrix:ne?Float32Array.from(ne):new Float32Array(9),u_skirt_height:te});function Ea(d,o){return d!=null&&o!=null&&!(!d.hasData()||!o.hasData())&&d.demTexture!=null&&o.demTexture!=null&&d.tileID.key!==o.tileID.key}const qo=new class{constructor(){this.operations={}}newMorphing(d,o,u,m,y){if(d in this.operations){const v=this.operations[d];v.to.tileID.key!==u.tileID.key&&(v.queued=u)}else this.operations[d]={startTime:m,phase:0,duration:y,from:o,to:u,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const o=this.operations[d];return{from:o.from,to:o.to,phase:o.phase}}update(d){for(const o in this.operations){const u=this.operations[o];for(u.phase=(d-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,d)){delete this.operations[o];break}}}_nextOp(d,o){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=o,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},$s={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Fc(d){return 6*Math.pow(1.5,22-d)}function hf(d,o){const u=1<<d.z;return!o&&(d.x===0||d.x===u-1)||d.y===0||d.y===u-1}const Dl=d=>({u_matrix:d});function Lh(d,o,u,m,y){if(y>0){const v=s.exported.now(),A=(v-d.timeAdded)/y,T=o?(v-o.timeAdded)/y:-1,P=u.getSource(),B=m.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),R=!o||Math.abs(o.tileID.overscaledZ-B)>Math.abs(d.tileID.overscaledZ-B),W=R&&d.refreshedUponExpiration?1:s.clamp(R?A:1-T,0,1);return d.refreshedUponExpiration&&A>=1&&(d.refreshedUponExpiration=!1),o?{opacity:1,mix:1-W}:{opacity:W,mix:0}}return{opacity:1,mix:0}}class Fh extends s.SourceCache{constructor(o){const u={type:"raster-dem",maxzoom:o.transform.maxZoom},m=new ft(ga(),null),y=Kt("mock-dem",u,m,o.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,u){o.state="loaded",u(null)}}class Oc extends s.SourceCache{constructor(o){const u=Kt("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new ft(ga(),null),o.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,u,m){if(o.freezeTileCoverage)return;this.transform=o;const y=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,A)=>{if(v[A.key]="",!this._tiles[A.key]){const T=new s.Tile(A,this._source.tileSize*A.overscaleFactor(),o.tileZoom);T.state="loaded",this._tiles[A.key]=T}return v},{});for(const v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(o){const u=this.proxyCachedFBO[o];if(u!==void 0){const m=Object.values(u);this.renderCachePool.push(...m),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Nc extends s.OverscaledTileID{constructor(o,u,m){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=u,this.projMatrix=m}}class Oh extends s.Elevation{constructor(o,u){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,y,v]=function(P){const B=new s.StructArrayLayout2i4,R=new s.StructArrayLayout3ui6,W=131;B.reserve(17161),R.reserve(33800);const Y=s.EXTENT/128,te=s.EXTENT+Y/2,ne=te+Y;for(let ie=-Y;ie<ne;ie+=Y)for(let q=-Y;q<ne;q+=Y){const ee=q<0||q>te||ie<0||ie>te?24575:0,ae=s.clamp(Math.round(q),0,s.EXTENT),ce=s.clamp(Math.round(ie),0,s.EXTENT);B.emplaceBack(ae+ee,ce)}const re=(ie,q)=>{const ee=q*W+ie;R.emplaceBack(ee+1,ee,ee+W),R.emplaceBack(ee+W,ee+W+1,ee+1)};for(let ie=1;ie<129;ie++)for(let q=1;q<129;q++)re(q,ie);return[0,129].forEach(ie=>{for(let q=0;q<130;q++)re(q,ie),re(ie,q)}),[B,R,32768]}(),A=o.context;this.gridBuffer=A.createVertexBuffer(m,s.posAttributes.members),this.gridIndexBuffer=A.createIndexBuffer(y),this.gridSegments=s.SegmentVector.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,m.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Oc(u.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const T=A.gl;this._overlapStencilMode=new s.StencilMode({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Fh(u.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,u,m){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const y=o.terrain.properties;this.sourceCache=o.terrain.drapeRenderMode===0?this._mockSourceCache:o._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const v=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const A=this.getScaledDemTileSize();this.sourceCache.update(u,A,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),u.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||o.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=u.getIds().map(P=>{const B=u.getTileByID(P).tileID;return B.projMatrix=m.calculateProjMatrix(B.toUnwrapped()),B});(function(P,B){const R=B.transform.pointCoordinate(B.transform.getCameraPoint()),W=new s.Point(R.x,R.y);P.sort((Y,te)=>{if(te.overscaledZ-Y.overscaledZ)return te.overscaledZ-Y.overscaledZ;const ne=new s.Point(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),re=new s.Point(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),ie=W.mult(1<<Y.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(ne)-ie.distSqr(re)})})(y,this.painter),this._previousZoom=m.zoom;const v=this.proxyToSource||{};this.proxyToSource={},y.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const A=this._style._sourceCaches;for(const P in A){const B=A[P];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,o[P],v),B.usedForTerrain))continue;const R=o[P];B.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[u.id]=y.map(P=>new Nc(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const T={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const B=this.terrainTileForTile[P.key];if(!B)continue;const R=B.tileID.key;R in T||(this._visibleDemTiles.push(B),T[R]=R)}}_assignTerrainTiles(o){this._initializing||o.forEach(u=>{if(this.terrainTileForTile[u.key])return;const m=this._findTileCoveringTileID(u,this.sourceCache);m&&(this.terrainTileForTile[u.key]=m)})}_prepareDEMTextures(){const o=this.painter.context,u=o.gl;for(const m in this.terrainTileForTile){const y=this.terrainTileForTile[m],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(o.activeTexture.set(u.TEXTURE1),Rh(this.painter,y,v))}}_prepareDemTileUniforms(o,u,m,y){if(!u||u.demTexture==null)return!1;const v=o.tileID.canonical,A=Math.pow(2,u.tileID.canonical.z-v.z),T=y||"";return m[`u_dem_tl${T}`]=[v.x*A%1,v.y*A%1],m[`u_dem_scale${T}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,u=o.gl;if(!this._emptyDepthBufferTexture){const m=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(o,m,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const u=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;const v=y.dem.tree.minimums[0];return v>0&&o++,m+v},0);return o?u/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,u=o.gl;o.activeTexture.set(u.TEXTURE2);const m=this._getLoadedAreaMinimum(),y=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new s.Texture(o,y,u.RGBA,{premultiply:!1}),v}setupElevationDraw(o,u,m){const y=this.painter.context,v=y.gl,A=(T=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(T),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var T;A.u_dem_size=this.sourceCache.getSource().tileSize,A.u_exaggeration=this.exaggeration();let P=null,B=null,R=1;if(m&&m.morphing&&this._useVertexMorphing){const W=m.morphing.srcDemTile,Y=m.morphing.dstDemTile;R=m.morphing.phase,W&&Y&&(this._prepareDemTileUniforms(o,W,A,"_prev")&&(B=W),this._prepareDemTileUniforms(o,Y,A)&&(P=Y))}if(B&&P?(y.activeTexture.set(v.TEXTURE2),P.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),y.activeTexture.set(v.TEXTURE4),B.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),A.u_dem_lerp=R):(P=this.terrainTileForTile[o.tileID.key],y.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(o,P,A)?P.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),y.activeTexture.set(v.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&P){const W=(1<<P.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=W}if(m&&m.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),u.setTerrainUniformValues(y,A),this.painter.transform.projection.name==="globe"){const W=this.globeUniformValues(this.painter.transform,o.tileID.canonical,m&&m.useDenormalizedUpVectorScale);u.setGlobeUniformValues(y,W)}}globeUniformValues(o,u,m){const y=o.projection;return{u_tile_tl_up:y.upVector(u,0,0),u_tile_tr_up:y.upVector(u,s.EXTENT,0),u_tile_br_up:y.upVector(u,s.EXTENT,s.EXTENT),u_tile_bl_up:y.upVector(u,0,s.EXTENT),u_tile_up_scale:m?s.globeMetersToEcef(1):y.upVectorScale(u,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const u=this.painter,m=this.painter.context;o.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,v,A,T,P){if(y.transform.projection.name==="globe")(function(B,R,W,Y,te){const ne=B.context,re=ne.gl;let ie,q;const ee=B.options.showTerrainWireframe?2:0,ae=B.transform,ce=s.globeUseCustomAntiAliasing(B,ne,ae),xe=(nt,Me)=>{if(q===nt)return;const He=[$s[nt],"PROJECTION_GLOBE_VIEW"];ce&&He.push("CUSTOM_ANTIALIASING"),Me&&He.push($s[ee]),ie=B.useProgram("globeRaster",null,He),q=nt},be=B.colorModeForRenderPass(),ve=new s.DepthMode(re.LEQUAL,s.DepthMode.ReadWrite,B.depthRangeFor3D);qo.update(te);const Ie=s.calculateGlobeMercatorMatrix(ae),Ce=[s.mercatorXfromLng(ae.center.lng),s.mercatorYfromLat(ae.center.lat)],Re=ee?[!1,!0]:[!1],it=B.globeSharedBuffers,ze=[ae.width*s.exported.devicePixelRatio,ae.height*s.exported.devicePixelRatio],Ze=Float32Array.from(ae.globeMatrix),Fe={useDenormalizedUpVectorScale:!0};if(Re.forEach(nt=>{const Me=B.transform,He=Fc(Me.zoom)*R.exaggeration();q=-1;const at=nt?re.LINES:re.TRIANGLES;for(const Qe of Y){const lt=W.getTile(Qe),kt=s.StencilMode.disabled,Nt=R.prevTerrainTileForTile[Qe.key],At=R.terrainTileForTile[Qe.key];Ea(Nt,At)&&qo.newMorphing(Qe.key,Nt,At,te,250),ne.activeTexture.set(re.TEXTURE0),lt.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);const Bt=qo.getMorphValuesForProxy(Qe.key),er=Bt?1:0;Bt&&s.extend$1(Fe,{morphing:{srcDemTile:Bt.from,dstDemTile:Bt.to,phase:s.easeCubicInOut(Bt.phase)}});const Yt=s.tileCornersToBounds(Qe.canonical),It=s.getLatitudinalLod(Yt.getCenter().lat),_r=s.getGridMatrix(Qe.canonical,Yt,It,Me.worldSize/Me._pixelsPerMercatorPixel),wr=s.globeNormalizeECEF(s.globeTileBounds(Qe.canonical)),Er=Lc(Me.projMatrix,Ze,Ie,wr,s.globeToMercatorTransition(Me.zoom),Ce,Me.frustumCorners.TL,Me.frustumCorners.TR,Me.frustumCorners.BR,Me.frustumCorners.BL,Me.globeCenterInViewSpace,Me.globeRadius,ze,He,_r);if(xe(er,nt),R.setupElevationDraw(lt,ie,Fe),B.prepareDrawProgram(ne,ie,Qe.toUnwrapped()),it){const[Sr,Zn,Dn]=nt?it.getWirefameBuffers(B.context,It):it.getGridBuffers(It,He!==0);ie.draw(ne,at,ve,kt,be,s.CullFaceMode.backCCW,Er,"globe_raster",Sr,Zn,Dn)}}}),it){const nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&nt.push("CUSTOM_ANTIALIASING"),ie=B.useProgram("globeRaster",null,nt);for(const Me of Y){const{x:He,y:at,z:Qe}=Me.canonical,lt=at===0,kt=at===(1<<Qe)-1,[Nt,At,Bt,er]=it.getPoleBuffers(Qe);if(er&&(lt||kt)){const Yt=W.getTile(Me);ne.activeTexture.set(re.TEXTURE0),Yt.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);let It=s.globePoleMatrixForTile(Qe,He,ae);const _r=s.globeNormalizeECEF(s.globeTileBounds(Me.canonical)),wr=(Er,Sr)=>Er.draw(ne,re.TRIANGLES,ve,s.StencilMode.disabled,be,s.CullFaceMode.disabled,Lc(ae.projMatrix,It,It,_r,0,Ce,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,ze,0),"globe_pole_raster",Sr,Bt,er);R.setupElevationDraw(Yt,ie,Fe),B.prepareDrawProgram(ne,ie,Me.toUnwrapped()),lt&&wr(ie,Nt),kt&&(It=s.scale(s.create(),It,[1,-1,1]),wr(ie,At))}}}})(y,v,A,T,P);else{const B=y.context,R=B.gl;let W,Y;const te=y.options.showTerrainWireframe?2:0,ne=(ae,ce)=>{if(Y===ae)return;const xe=[$s[ae]];ce&&xe.push($s[te]),W=y.useProgram("terrainRaster",null,xe),Y=ae},re=y.colorModeForRenderPass(),ie=new s.DepthMode(R.LEQUAL,s.DepthMode.ReadWrite,y.depthRangeFor3D);qo.update(P);const q=y.transform,ee=Fc(q.zoom)*v.exaggeration();(te?[!1,!0]:[!1]).forEach(ae=>{Y=-1;const ce=ae?R.LINES:R.TRIANGLES,[xe,be]=ae?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const ve of T){const Ie=A.getTile(ve),Ce=s.StencilMode.disabled,Re=v.prevTerrainTileForTile[ve.key],it=v.terrainTileForTile[ve.key];Ea(Re,it)&&qo.newMorphing(ve.key,Re,it,P,250),B.activeTexture.set(R.TEXTURE0),Ie.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const ze=qo.getMorphValuesForProxy(ve.key),Ze=ze?1:0;let Fe;ze&&(Fe={morphing:{srcDemTile:ze.from,dstDemTile:ze.to,phase:s.easeCubicInOut(ze.phase)}});const nt=wa(ve.projMatrix,hf(ve.canonical,q.renderWorldCopies)?ee/10:ee);ne(Ze,ae),v.setupElevationDraw(Ie,W,Fe),y.prepareDrawProgram(B,W,ve.toUnwrapped()),W.draw(B,ce,ie,Ce,re,s.CullFaceMode.backCCW,nt,"terrain_raster",v.gridBuffer,xe,be)}})}}(u,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const u=this.painter,m=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],A=this._drapedRenderBatches.shift(),T=[],P=u.style.order;let B=0;for(const R of v){const W=y.getTileByID(R.proxyTileKey),Y=y.proxyCachedFBO[R.key]?y.proxyCachedFBO[R.key][o]:void 0,te=Y!==void 0?y.renderCache[Y]:this.pool[B++],ne=Y!==void 0;if(W.texture=te.tex,ne&&!te.dirty){T.push(W.tileID);continue}let re;m.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(m.clear({color:s.Color.transparent,stencil:0}),te.dirty=!1);for(let ie=A.start;ie<=A.end;++ie){const q=u.style._layers[P[ie]];if(q.isHidden(u.transform.zoom))continue;const ee=u.style._getLayerSourceCache(q),ae=ee?this.proxyToSource[R.key][ee.id]:[R];if(!ae)continue;const ce=ae;m.viewport.set([0,0,te.fb.width,te.fb.height]),re!==(ee?ee.id:null)&&(this._setupStencil(te,ae,q,ee),re=ee?ee.id:null),u.renderLayer(u,ee,q,ce)}this.renderedToTile?(te.dirty=!0,T.push(W.tileID)):ne||--B,B===5&&(B=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),A.end+1}postRender(){}renderCacheEfficiency(o){const u=o.order.length;if(u===0)return{efficiency:100};let m,y=0,v=0,A=!1;for(let T=0;T<u;++T){const P=o._layers[o.order[T]];this._style.isLayerDraped(P)?(A&&++y,++v):A||(A=!0,m=P.id)}return v===0?{efficiency:100}:{efficiency:100*(1-y/v),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{o=Math.min(o,u.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,u,m){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const A=v.tileID,T=1<<A.overscaledZ,{x:P,y:B}=A.canonical,R=P/T,W=(P+1)/T,Y=B/T,te=(B+1)/T;return{minx:R,miny:Y,maxx:W,maxy:te,t:v.dem.tree.raycastRoot(R,Y,W,te,o,u,m),tile:v}});y.sort((v,A)=>(v.t!==null?v.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const v of y){if(v.t==null)return null;const A=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,o,u,m);if(A!=null)return A}return null}_createFBO(){const o=this.painter.context,u=o.gl,m=this.drapeBufferSize;o.activeTexture.set(u.TEXTURE0);const y=new s.Texture(o,{width:m[0],height:m[1],data:null},u.RGBA);y.bind(u.LINEAR,u.CLAMP_TO_EDGE);const v=o.createFramebuffer(m[0],m[1],!1);return v.colorAttachment.set(y.texture),v.depthAttachment=new we(o,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const u=this._style._layers[o],m=u.isHidden(this.painter.transform.zoom);return u.type==="custom"?!m&&u.shouldRedrape():!m&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const m of this._style._getSources())if(m instanceof dt){o=!0;break}if(!o)return;const u={};for(let m=0;m<this._style.order.length;++m){const y=this._style._layers[this._style.order[m]],v=this._style._getLayerSourceCache(y);if(v&&!u[v.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof s.ZoomDependentExpression){u[v.id]=!0;for(const A of this.proxyCoords){const T=this.proxyToSource[A.key][v.id];if(T)for(const P of T)this._clearRenderCacheForTile(v.id,P)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof st){o=!0;break}if(!o)return;const u={};for(let m=0;m<this._style.order.length;++m){const y=this._style._layers[this._style.order[m]],v=this._style._getLayerSourceCache(y);if(!v||u[v.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const A=y.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const P=this.proxyToSource[T.key][v.id];if(P)for(const B of P){const R=Lh(v.getTile(B),v.findLoadedParent(B,0),v,this.painter.transform,A);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(v.id,B)}}}}_setupDrapedRenderBatches(){const o=this._style.order,u=o.length;if(u===0)return;const m=[];let y,v=0,A=this._style._layers[o[v]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++v<u;)A=this._style._layers[o[v]];for(;v<u;++v){const T=this._style._layers[o[v]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?y===void 0&&(y=v):y!==void 0&&(m.push({start:y,end:v-1}),y=void 0))}y!==void 0&&m.push({start:y,end:v-1}),this._drapedRenderBatches=m}_setupRenderCache(o){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const A=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let T=0;T<A.length;++T){const P=Object.values(A[T]);u.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,y=this._tilesDirty;for(let A=m.length-1;A>=0;A--){const T=m[A];if(u.getTileByID(T.key),u.proxyCachedFBO[T.key]!==void 0){const P=o[T.key],B=this.proxyToSource[T.key];let R=0;for(const W in B){const Y=B[W],te=P[W];if(!te||te.length!==Y.length||Y.some((ne,re)=>ne!==te[re]||y[W]&&y[W].hasOwnProperty(ne.key))){R=-1;break}++R}for(const W in u.proxyCachedFBO[T.key])u.renderCache[u.proxyCachedFBO[T.key][W]].dirty=R<0||R!==Object.values(P).length}}const v=[...this._drapedRenderBatches];v.sort((A,T)=>T.end-T.start-(A.end-A.start));for(const A of v)for(const T of m){if(u.proxyCachedFBO[T.key])continue;let P=u.renderCachePool.pop();P===void 0&&u.renderCache.length<50&&(P=u.renderCache.length,u.renderCache.push(this._createFBO())),P!==void 0&&(u.proxyCachedFBO[T.key]={},u.proxyCachedFBO[T.key][A.start]=P,u.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(o,u,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,A=v.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let T;if(m.isTileClipped())T=u.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(o,u){const m=this.painter,y=this.painter.context,v=y.gl;m._tileClippingMaskIDs={},y.setColorMode(s.ColorMode.disabled),y.setDepthMode(s.DepthMode.disabled);const A=m.useProgram("clippingMask");for(const T of o){const P=m._tileClippingMaskIDs[T.key]=--u;A.draw(y,v.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:v.ALWAYS,mask:0},P,255,v.KEEP,v.KEEP,v.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Dl(T.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(o){const u=this.painter.transform;if(o.x<0||o.x>u.width||o.y<0||o.y>u.height)return null;const m=[o.x,o.y,1,1];s.transformMat4$1(m,m,u.pixelMatrixInverse),s.scale$1(m,m,1/m[3]),m[0]/=u.worldSize,m[1]/=u.worldSize;const y=u._camera.position,v=s.mercatorZfromAltitude(1,u.center.lat),A=[y[0],y[1],y[2]/v,0],T=s.subtract([],m.slice(0,3),A);s.normalize(T,T);const P=this.raycast(A,T,this._exaggeration);return P!==null&&P?(s.scaleAndAdd(A,A,T,P),A[3]=A[2],A[2]*=v,A):null}drawDepth(){const o=this.painter,u=o.context,m=this.proxySourceCache,y=Math.ceil(o.width),v=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const A=u.gl,T=u.createFramebuffer(y,v,!0);u.activeTexture.set(A.TEXTURE0);const P=new s.Texture(u,{width:y,height:v,data:null},A.RGBA);P.bind(A.NEAREST,A.CLAMP_TO_EDGE),T.colorAttachment.set(P.texture);const B=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,y,v);T.depthAttachment.set(B),this._depthFBO=T,this._depthTexture=P}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,y,v]),function(A,T,P,B){if(A.transform.projection.name==="globe")return;const R=A.context,W=R.gl;R.clear({depth:1});const Y=A.useProgram("terrainDepth"),te=new s.DepthMode(W.LESS,s.DepthMode.ReadWrite,A.depthRangeFor3D);for(const ne of B){const re=P.getTile(ne),ie=wa(ne.projMatrix,0);T.setupElevationDraw(re,Y),Y.draw(R,W.TRIANGLES,te,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,ie,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(o,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,u,m){if(o.getSource()instanceof Ft)return this._setupProxiedCoordsForImageSource(o,u,m);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const y=this.proxiedCoords[o.id]=[],v=this.proxyCoords;for(let T=0;T<v.length;T++){const P=v[T],B=this._findTileCoveringTileID(P,o);if(B){const R=this._createProxiedId(P,B,m[P.key]&&m[P.key][o.id]);y.push(R),this.proxyToSource[P.key][o.id]=[R]}}let A=!1;for(let T=0;T<u.length;T++){const P=o.getTile(u[T]);if(!P||!P.hasData())continue;const B=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==P.tileID.canonical.z){const R=this.proxyToSource[B.tileID.key][o.id],W=this._createProxiedId(B.tileID,P,m[B.tileID.key]&&m[B.tileID.key][o.id]);R?R.splice(R.length-1,0,W):this.proxyToSource[B.tileID.key][o.id]=[W],y.push(W),A=!0}}this._sourceTilesOverlap[o.id]=A}_setupProxiedCoordsForImageSource(o,u,m){if(!o.getSource().loaded())return;const y=this.proxiedCoords[o.id]=[],v=this.proxyCoords,A=o.getSource(),T=new s.Point(A.tileID.x,A.tileID.y)._div(1<<A.tileID.z),P=A.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((R,W)=>(R.min.x=Math.min(R.min.x,W.x-T.x),R.min.y=Math.min(R.min.y,W.y-T.y),R.max.x=Math.max(R.max.x,W.x-T.x),R.max.y=Math.max(R.max.y,W.y-T.y),R),{min:new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(R,W)=>{const Y=R.wrap+R.canonical.x/(1<<R.canonical.z),te=R.canonical.y/(1<<R.canonical.z),ne=s.EXTENT/(1<<R.canonical.z),re=W.wrap+W.canonical.x/(1<<W.canonical.z),ie=W.canonical.y/(1<<W.canonical.z);return Y+ne<re+P.min.x||Y>re+P.max.x||te+ne<ie+P.min.y||te>ie+P.max.y};for(let R=0;R<v.length;R++){const W=v[R];for(let Y=0;Y<u.length;Y++){const te=o.getTile(u[Y]);if(!te||!te.hasData()||B(W,te.tileID))continue;const ne=this._createProxiedId(W,te,m[W.key]&&m[W.key][o.id]),re=this.proxyToSource[W.key][o.id];re?re.push(ne):this.proxyToSource[W.key][o.id]=[ne],y.push(ne)}}}_createProxiedId(o,u,m){let y=this.orthoMatrix;if(m){const v=m.find(A=>A.key===u.tileID.key);if(v)return v}if(u.tileID.key!==o.key){const v=o.canonical.z-u.tileID.canonical.z;let A,T,P;y=s.create();const B=u.tileID.wrap-o.wrap<<o.overscaledZ;v>0?(A=s.EXTENT>>v,T=A*((u.tileID.canonical.x<<v)-o.canonical.x+B),P=A*((u.tileID.canonical.y<<v)-o.canonical.y)):(A=s.EXTENT<<-v,T=s.EXTENT*(u.tileID.canonical.x-(o.canonical.x+B<<-v)),P=s.EXTENT*(u.tileID.canonical.y-(o.canonical.y<<-v))),s.ortho(y,0,A,0,A,0,1),s.translate(y,y,[T,P,0])}return new Nc(u.tileID,o.key,y)}_findTileCoveringTileID(o,u){let m=u.getTile(o);if(m&&m.hasData())return m;const y=this._findCoveringTileCache[u.id],v=y[o.key];if(m=v?u.getTileByID(v):null,m&&m.hasData()||v===null)return m;let A=m?m.tileID:o,T=A.overscaledZ;const P=u.getSource().minzoom,B=[];if(!v){const W=u.getSource().maxzoom;if(o.canonical.z>=W){const Y=o.canonical.z-W;u.getSource().reparseOverscaled?(T=Math.max(o.canonical.z+2,u.transform.tileZoom),A=new s.OverscaledTileID(T,o.wrap,W,o.canonical.x>>Y,o.canonical.y>>Y)):Y!==0&&(T=W,A=new s.OverscaledTileID(T,o.wrap,W,o.canonical.x>>Y,o.canonical.y>>Y))}A.key!==o.key&&(B.push(A.key),m=u.getTile(A))}const R=W=>{B.forEach(Y=>{y[Y]=W}),B.length=0};for(T-=1;T>=P&&(!m||!m.hasData());T--){m&&R(m.tileID.key);const W=A.calculateScaledKey(T);if(m=u.getTileByID(W),m&&m.hasData())break;const Y=y[W];if(Y===null)break;Y===void 0?B.push(W):m=u.getTileByID(Y)}return R(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,u){let m=this._tilesDirty[o];m||(m=this._tilesDirty[o]={}),m[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(u){let m=0;const y=new s.StructArrayLayout2ui4,v=131;for(let A=1;A<129;A++){for(let T=1;T<129;T++)m=A*v+T,y.emplaceBack(m,m+1),y.emplaceBack(m,m+v),y.emplaceBack(m+1,m+v),A===128&&y.emplaceBack(m+v,m+v+1);y.emplaceBack(m+1,m+1+v)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class or{static cacheKey(o,u,m,y){let v=`${u}${y?y.cacheKey:""}`;for(const A of m)o.usedDefines.includes(A)&&(v+=`/${A}`);return v}constructor(o,u,m,y,v,A){const T=o.gl;this.program=T.createProgram();const P=function(q){const ee=[];for(let ae=0;ae<q.length;ae++){if(q[ae]===null)continue;const ce=q[ae].split(" ");ee.push(ce.pop())}return ee}(m.staticAttributes),B=y?y.getBinderAttributes():[],R=P.concat(B);let W=y?y.defines():[];W=W.concat(A.map(q=>`#define ${q}`));const Y=o.isWebGL2?`#version 300 es
`:"",te=Y+W.concat(o.extStandardDerivatives&&Y.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(zh):zh,zh,Bc,lf.fragmentSource,va.fragmentSource,m.fragmentSource).join(`
`),ne=Y+W.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Bc,lf.vertexSource,va.vertexSource,Rc.vertexSource,m.vertexSource).join(`
`),re=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(re,te),T.compileShader(re),T.attachShader(this.program,re);const ie=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(ie,ne),T.compileShader(ie),T.attachShader(this.program,ie),this.attributes={},this.numAttributes=R.length;for(let q=0;q<this.numAttributes;q++)R[q]&&(T.bindAttribLocation(this.program,q,R[q]),this.attributes[R[q]]=q);T.linkProgram(this.program),T.deleteShader(ie),T.deleteShader(re),this.fixedUniforms=v(o),this.binderUniforms=y?y.getUniforms(o):[],A.includes("TERRAIN")&&(this.terrainUniforms=(q=>({u_dem:new s.Uniform1i(q),u_dem_prev:new s.Uniform1i(q),u_dem_unpack:new s.Uniform4f(q),u_dem_tl:new s.Uniform2f(q),u_dem_scale:new s.Uniform1f(q),u_dem_tl_prev:new s.Uniform2f(q),u_dem_scale_prev:new s.Uniform1f(q),u_dem_size:new s.Uniform1f(q),u_dem_lerp:new s.Uniform1f(q),u_exaggeration:new s.Uniform1f(q),u_depth:new s.Uniform1i(q),u_depth_size_inv:new s.Uniform2f(q),u_meter_to_dem:new s.Uniform1f(q),u_label_plane_matrix_inv:new s.UniformMatrix4f(q)}))(o)),A.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new s.Uniform3f(q),u_tile_tr_up:new s.Uniform3f(q),u_tile_br_up:new s.Uniform3f(q),u_tile_bl_up:new s.Uniform3f(q),u_tile_up_scale:new s.Uniform1f(q)}))(o)),A.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new s.UniformMatrix4f(q),u_fog_range:new s.Uniform2f(q),u_fog_color:new s.Uniform4f(q),u_fog_horizon_blend:new s.Uniform1f(q),u_fog_temporal_offset:new s.Uniform1f(q),u_frustum_tl:new s.Uniform3f(q),u_frustum_tr:new s.Uniform3f(q),u_frustum_br:new s.Uniform3f(q),u_frustum_bl:new s.Uniform3f(q),u_globe_pos:new s.Uniform3f(q),u_globe_radius:new s.Uniform1f(q),u_globe_transition:new s.Uniform1f(q),u_is_globe:new s.Uniform1i(q),u_viewport:new s.Uniform2f(q)}))(o))}}setTerrainUniformValues(o,u){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const y in u)m[y]&&m[y].set(this.program,y,u[y])}}setGlobeUniformValues(o,u){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const y in u)m[y]&&m[y].set(this.program,y,u[y])}}setFogUniformValues(o,u){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const y in u)m[y].set(this.program,y,u[y])}}draw(o,u,m,y,v,A,T,P,B,R,W,Y,te,ne,re){const ie=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(m),o.setStencilMode(y),o.setColorMode(v),o.setCullFace(A);for(const ee of Object.keys(this.fixedUniforms))this.fixedUniforms[ee].set(this.program,ee,T[ee]);ne&&ne.setUniforms(this.program,o,this.binderUniforms,Y,{zoom:te});const q={[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[u];for(const ee of W.get()){const ae=ee.vaos||(ee.vaos={});(ae[P]||(ae[P]=new Jg)).bind(o,this,B,ne?ne.getPaintVertexBuffers():[],R,ee.vertexOffset,re||[]),ie.drawElements(u,ee.primitiveLength*q,ie.UNSIGNED_SHORT,ee.primitiveOffset*q*2)}}}function Ml(d,o){const u=Math.pow(2,o.tileID.overscaledZ),m=o.tileSize*Math.pow(2,d.transform.tileZoom)/u,y=m*(o.tileID.canonical.x+o.tileID.wrap*u),v=m*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_tile_units_to_pixels:1/Ve(o,1,d.transform.tileZoom),u_pixel_coord_upper:[y>>16,v>>16],u_pixel_coord_lower:[65535&y,65535&v]}}const df=s.create(),Nh=(d,o,u,m,y,v,A,T,P,B,R)=>{const W=o.style.light,Y=W.properties.get("position"),te=[Y.x,Y.y,Y.z],ne=s.create$1();W.properties.get("anchor")==="viewport"&&(s.fromRotation(ne,-o.transform.angle),s.transformMat3(te,te,ne));const re=W.properties.get("color"),ie=o.transform,q={u_matrix:d,u_lightpos:te,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[re.r,re.g,re.b],u_vertical_gradient:+u,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:df,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:v};return ie.projection.name==="globe"&&(q.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],q.u_zoom_transition=P,q.u_inv_rot_matrix=R,q.u_merc_center=B,q.u_up_dir=ie.projection.upVector(new s.CanonicalTileID(0,0,0),B[0]*s.EXTENT,B[1]*s.EXTENT),q.u_height_lift=T),q},pf=(d,o,u,m,y,v,A,T,P,B,R,W)=>{const Y=Nh(d,o,u,m,y,v,A,P,B,R,W),te={u_height_factor:-Math.pow(2,A.overscaledZ)/T.tileSize/8};return s.extend(Y,Ml(o,T),te)},Ws=d=>({u_matrix:d}),Uh=(d,o,u)=>s.extend(Ws(d),Ml(o,u)),Qg=(d,o)=>({u_matrix:d,u_world:o}),e_=(d,o,u,m)=>s.extend(Uh(d,o,u),{u_world:m}),t_=s.create(),Vh=(d,o,u,m,y,v)=>{const A=d.transform,T=A.projection.name==="globe";let P;if(v.paint.get("circle-pitch-alignment")==="map")if(T){const R=s.globePixelsToTileUnits(A.zoom,o.canonical)*A._pixelsPerMercatorPixel;P=Float32Array.from([R,0,0,R])}else P=A.calculatePixelsToTileUnitsMatrix(u);else P=new Float32Array([A.pixelsToGLUnits[0],0,0,A.pixelsToGLUnits[1]]);const B={u_camera_to_center_distance:A.cameraToCenterDistance,u_matrix:d.translatePosMatrix(o.projMatrix,u,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:t_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){B.u_inv_rot_matrix=m,B.u_merc_center=y,B.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],B.u_zoom_transition=s.globeToMercatorTransition(A.zoom);const R=y[0]*s.EXTENT,W=y[1]*s.EXTENT;B.u_up_dir=A.projection.upVector(new s.CanonicalTileID(0,0,0),R,W)}return B},jh=d=>{const o=[];return d.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o},$h=(d,o,u,m)=>{const y=s.EXTENT/u.tileSize;return{u_matrix:d,u_camera_to_center_distance:o.getCameraToCenterDistance(m),u_extrude_scale:[o.pixelsToGLUnits[0]/y,o.pixelsToGLUnits[1]/y]}},Uc=(d,o,u=1)=>({u_matrix:d,u_color:o,u_overlay:0,u_overlay_scale:u}),ff=s.create(),mf=(d,o,u,m,y,v,A)=>{const T=d.transform,P=T.projection.name==="globe",B=P?s.globePixelsToTileUnits(T.zoom,o.canonical)*T._pixelsPerMercatorPixel:Ve(u,1,v),R={u_matrix:o.projMatrix,u_extrude_scale:B,u_intensity:A,u_inv_rot_matrix:ff,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){R.u_inv_rot_matrix=m,R.u_merc_center=y,R.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],R.u_zoom_transition=s.globeToMercatorTransition(T.zoom);const W=y[0]*s.EXTENT,Y=y[1]*s.EXTENT;R.u_up_dir=T.projection.upVector(new s.CanonicalTileID(0,0,0),W,Y)}return R},r_=(d,o,u,m,y,v,A)=>{const T=d.transform,P=T.calculatePixelsToTileUnitsMatrix(o);return{u_matrix:Wh(d,o,u,m),u_pixels_to_tile_units:P,u_device_pixel_ratio:v,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:Bl(u)?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Sa(o,d.transform),u_alpha_discard_threshold:0,u_trim_offset:A}},Rl=(d,o,u,m,y)=>{const v=d.transform;return{u_matrix:Wh(d,o,u,m),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:y,u_image:0,u_tile_units_to_pixels:Sa(o,v),u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Sa(d,o){return 1/Ve(d,1,o.tileZoom)}function Wh(d,o,u,m){return d.translatePosMatrix(m||o.tileID.projMatrix,o,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function Bl(d){const o=d.paint.get("line-dasharray").value;return o.value||o.kind!=="constant"}const qh=(d,o,u,m,y,v)=>{return{u_matrix:d,u_tl_parent:o,u_scale_parent:u,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(T=y.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(A=y.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:wo(y.paint.get("raster-hue-rotate")),u_perspective_transform:v};var A,T};function wo(d){d*=Math.PI/180;const o=Math.sin(d),u=Math.cos(d);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}const Vc=s.create(),Gh=(d,o,u,m,y,v,A,T,P,B,R,W,Y,te,ne,re)=>{const ie=y.transform,q={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:ie.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:ie.width/ie.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:A,u_coord_matrix:T,u_is_text:+P,u_pitch_with_map:+m,u_texsize:B,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Vc,u_up_vector:[0,-1,0]};return re.name==="globe"&&(q.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],q.u_zoom_transition=W,q.u_inv_rot_matrix=te,q.u_merc_center=Y,q.u_camera_forward=ie._camera.forward(),q.u_ecef_origin=s.globeECEFOrigin(ie.globeMatrix,R.toUnwrapped()),q.u_tile_matrix=Float32Array.from(ie.globeMatrix),q.u_up_vector=ne),q},jc=(d,o,u,m,y,v,A,T,P,B,R,W,Y,te,ne,re,ie)=>s.extend(Gh(d,o,u,m,y,v,A,T,P,B,W,Y,te,ne,re,ie),{u_gamma_scale:m?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+R}),gf=(d,o,u,m,y,v,A,T,P,B,R,W,Y,te,ne,re)=>s.extend(jc(d,o,u,m,y,v,A,T,!0,P,!0,R,W,Y,te,ne,re),{u_texsize_icon:B,u_texture_icon:1}),Hh=(d,o,u)=>({u_matrix:d,u_opacity:o,u_color:u}),n_=(d,o,u,m,y)=>s.extend(function(v,A,T){const P=A.imageManager.getPattern(v.toString()),{width:B,height:R}=A.imageManager.getPixelSize(),W=Math.pow(2,T.tileID.overscaledZ),Y=T.tileSize*Math.pow(2,A.transform.tileZoom)/W,te=Y*(T.tileID.canonical.x+T.tileID.wrap*W),ne=Y*T.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[B,R],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/Ve(T,1,A.transform.tileZoom),u_pixel_coord_upper:[te>>16,ne>>16],u_pixel_coord_lower:[65535&te,65535&ne]}}(m,u,y),{u_matrix:d,u_opacity:o}),Zh={fillExtrusion:d=>({u_matrix:new s.UniformMatrix4f(d),u_lightpos:new s.Uniform3f(d),u_lightintensity:new s.Uniform1f(d),u_lightcolor:new s.Uniform3f(d),u_vertical_gradient:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d),u_edge_radius:new s.Uniform1f(d),u_ao:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_up_dir:new s.Uniform3f(d),u_height_lift:new s.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_lightpos:new s.Uniform3f(d),u_lightintensity:new s.Uniform1f(d),u_lightcolor:new s.Uniform3f(d),u_vertical_gradient:new s.Uniform1f(d),u_height_factor:new s.Uniform1f(d),u_edge_radius:new s.Uniform1f(d),u_ao:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_up_dir:new s.Uniform3f(d),u_height_lift:new s.Uniform1f(d),u_image:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d)}),fill:d=>({u_matrix:new s.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_image:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d)}),fillOutline:d=>({u_matrix:new s.UniformMatrix4f(d),u_world:new s.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_world:new s.Uniform2f(d),u_image:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new s.Uniform1f(d),u_extrude_scale:new s.UniformMatrix2f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_up_dir:new s.Uniform3f(d)}),collisionBox:d=>({u_matrix:new s.UniformMatrix4f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_extrude_scale:new s.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new s.UniformMatrix4f(d),u_inv_matrix:new s.UniformMatrix4f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_viewport_size:new s.Uniform2f(d)}),debug:d=>({u_color:new s.UniformColor(d),u_matrix:new s.UniformMatrix4f(d),u_overlay:new s.Uniform1i(d),u_overlay_scale:new s.Uniform1f(d)}),clippingMask:d=>({u_matrix:new s.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new s.Uniform1f(d),u_intensity:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_up_dir:new s.Uniform3f(d)}),heatmapTexture:d=>({u_image:new s.Uniform1i(d),u_color_ramp:new s.Uniform1i(d),u_opacity:new s.Uniform1f(d)}),hillshade:d=>({u_matrix:new s.UniformMatrix4f(d),u_image:new s.Uniform1i(d),u_latrange:new s.Uniform2f(d),u_light:new s.Uniform2f(d),u_shadow:new s.UniformColor(d),u_highlight:new s.UniformColor(d),u_accent:new s.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new s.UniformMatrix4f(d),u_image:new s.Uniform1i(d),u_dimension:new s.Uniform2f(d),u_zoom:new s.Uniform1f(d),u_unpack:new s.Uniform4f(d)}),line:d=>({u_matrix:new s.UniformMatrix4f(d),u_pixels_to_tile_units:new s.UniformMatrix2f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_units_to_pixels:new s.Uniform2f(d),u_dash_image:new s.Uniform1i(d),u_gradient_image:new s.Uniform1i(d),u_image_height:new s.Uniform1f(d),u_texsize:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d),u_alpha_discard_threshold:new s.Uniform1f(d),u_trim_offset:new s.Uniform2f(d)}),linePattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_texsize:new s.Uniform2f(d),u_pixels_to_tile_units:new s.UniformMatrix2f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_image:new s.Uniform1i(d),u_units_to_pixels:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d),u_alpha_discard_threshold:new s.Uniform1f(d)}),raster:d=>({u_matrix:new s.UniformMatrix4f(d),u_tl_parent:new s.Uniform2f(d),u_scale_parent:new s.Uniform1f(d),u_fade_t:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d),u_image0:new s.Uniform1i(d),u_image1:new s.Uniform1i(d),u_brightness_low:new s.Uniform1f(d),u_brightness_high:new s.Uniform1f(d),u_saturation_factor:new s.Uniform1f(d),u_contrast_factor:new s.Uniform1f(d),u_spin_weights:new s.Uniform3f(d),u_perspective_transform:new s.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new s.Uniform1i(d),u_is_size_feature_constant:new s.Uniform1i(d),u_size_t:new s.Uniform1f(d),u_size:new s.Uniform1f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_rotate_symbol:new s.Uniform1i(d),u_aspect_ratio:new s.Uniform1f(d),u_fade_change:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_label_plane_matrix:new s.UniformMatrix4f(d),u_coord_matrix:new s.UniformMatrix4f(d),u_is_text:new s.Uniform1i(d),u_pitch_with_map:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_camera_forward:new s.Uniform3f(d),u_tile_matrix:new s.UniformMatrix4f(d),u_up_vector:new s.Uniform3f(d),u_ecef_origin:new s.Uniform3f(d),u_texture:new s.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new s.Uniform1i(d),u_is_size_feature_constant:new s.Uniform1i(d),u_size_t:new s.Uniform1f(d),u_size:new s.Uniform1f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_rotate_symbol:new s.Uniform1i(d),u_aspect_ratio:new s.Uniform1f(d),u_fade_change:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_label_plane_matrix:new s.UniformMatrix4f(d),u_coord_matrix:new s.UniformMatrix4f(d),u_is_text:new s.Uniform1i(d),u_pitch_with_map:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_texture:new s.Uniform1i(d),u_gamma_scale:new s.Uniform1f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_camera_forward:new s.Uniform3f(d),u_tile_matrix:new s.UniformMatrix4f(d),u_up_vector:new s.Uniform3f(d),u_ecef_origin:new s.Uniform3f(d),u_is_halo:new s.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new s.Uniform1i(d),u_is_size_feature_constant:new s.Uniform1i(d),u_size_t:new s.Uniform1f(d),u_size:new s.Uniform1f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_rotate_symbol:new s.Uniform1i(d),u_aspect_ratio:new s.Uniform1f(d),u_fade_change:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_label_plane_matrix:new s.UniformMatrix4f(d),u_coord_matrix:new s.UniformMatrix4f(d),u_is_text:new s.Uniform1i(d),u_pitch_with_map:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_texsize_icon:new s.Uniform2f(d),u_texture:new s.Uniform1i(d),u_texture_icon:new s.Uniform1i(d),u_gamma_scale:new s.Uniform1f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_is_halo:new s.Uniform1i(d)}),background:d=>({u_matrix:new s.UniformMatrix4f(d),u_opacity:new s.Uniform1f(d),u_color:new s.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_opacity:new s.Uniform1f(d),u_image:new s.Uniform1i(d),u_pattern_tl:new s.Uniform2f(d),u_pattern_br:new s.Uniform2f(d),u_texsize:new s.Uniform2f(d),u_pattern_size:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d)}),terrainRaster:Bh,terrainDepth:Bh,skybox:d=>({u_matrix:new s.UniformMatrix4f(d),u_sun_direction:new s.Uniform3f(d),u_cubemap:new s.Uniform1i(d),u_opacity:new s.Uniform1f(d),u_temporal_offset:new s.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new s.UniformMatrix4f(d),u_color_ramp:new s.Uniform1i(d),u_center_direction:new s.Uniform3f(d),u_radius:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d),u_temporal_offset:new s.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new s.UniformMatrix3f(d),u_sun_direction:new s.Uniform3f(d),u_sun_intensity:new s.Uniform1f(d),u_color_tint_r:new s.Uniform4f(d),u_color_tint_m:new s.Uniform4f(d),u_luminance:new s.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new s.UniformMatrix4f(d),u_globe_matrix:new s.UniformMatrix4f(d),u_normalize_matrix:new s.UniformMatrix4f(d),u_merc_matrix:new s.UniformMatrix4f(d),u_zoom_transition:new s.Uniform1f(d),u_merc_center:new s.Uniform2f(d),u_image0:new s.Uniform1i(d),u_grid_matrix:new s.UniformMatrix3f(d),u_skirt_height:new s.Uniform1f(d),u_frustum_tl:new s.Uniform3f(d),u_frustum_tr:new s.Uniform3f(d),u_frustum_br:new s.Uniform3f(d),u_frustum_bl:new s.Uniform3f(d),u_globe_pos:new s.Uniform3f(d),u_globe_radius:new s.Uniform1f(d),u_viewport:new s.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new s.Uniform3f(d),u_frustum_tr:new s.Uniform3f(d),u_frustum_br:new s.Uniform3f(d),u_frustum_bl:new s.Uniform3f(d),u_horizon:new s.Uniform1f(d),u_transition:new s.Uniform1f(d),u_fadeout_range:new s.Uniform1f(d),u_color:new s.Uniform4f(d),u_high_color:new s.Uniform4f(d),u_space_color:new s.Uniform4f(d),u_star_intensity:new s.Uniform1f(d),u_star_density:new s.Uniform1f(d),u_star_size:new s.Uniform1f(d),u_temporal_offset:new s.Uniform1f(d),u_horizon_angle:new s.Uniform1f(d),u_rotation_matrix:new s.UniformMatrix4f(d)})};let $c;function Ll(d,o,u,m,y,v,A){const T=d.context,P=T.gl,B=d.transform,R=d.useProgram("collisionBox"),W=[];let Y=0,te=0;for(let ce=0;ce<m.length;ce++){const xe=m[ce],be=o.getTile(xe),ve=be.getBucket(u);if(!ve)continue;const Ie=Di(xe,ve,B);let Ce=Ie;y[0]===0&&y[1]===0||(Ce=d.translatePosMatrix(Ie,be,y,v));const Re=A?ve.textCollisionBox:ve.iconCollisionBox,it=ve.collisionCircleArray;if(it.length>0){const ze=s.create(),Ze=Ce;s.mul(ze,ve.placementInvProjMatrix,B.glCoordMatrix),s.mul(ze,ze,ve.placementViewportMatrix),W.push({circleArray:it,circleOffset:te,transform:Ze,invTransform:ze,projection:ve.getProjection()}),Y+=it.length/4,te=Y}Re&&(d.terrain&&d.terrain.setupElevationDraw(be,R),R.draw(T,P.LINES,s.DepthMode.disabled,s.StencilMode.disabled,d.colorModeForRenderPass(),s.CullFaceMode.disabled,$h(Ce,B,be,ve.getProjection()),u.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,B.zoom,null,[Re.collisionVertexBuffer,Re.collisionVertexBufferExt]))}if(!A||!W.length)return;const ne=d.useProgram("collisionCircle"),re=new s.StructArrayLayout2f1f2i16;re.resize(4*Y),re._trim();let ie=0;for(const ce of W)for(let xe=0;xe<ce.circleArray.length/4;xe++){const be=4*xe,ve=ce.circleArray[be+0],Ie=ce.circleArray[be+1],Ce=ce.circleArray[be+2],Re=ce.circleArray[be+3];re.emplace(ie++,ve,Ie,Ce,Re,0),re.emplace(ie++,ve,Ie,Ce,Re,1),re.emplace(ie++,ve,Ie,Ce,Re,2),re.emplace(ie++,ve,Ie,Ce,Re,3)}(!$c||$c.length<2*Y)&&($c=function(ce){const xe=2*ce,be=new s.StructArrayLayout3ui6;be.resize(xe),be._trim();for(let ve=0;ve<xe;ve++){const Ie=6*ve;be.uint16[Ie+0]=4*ve+0,be.uint16[Ie+1]=4*ve+1,be.uint16[Ie+2]=4*ve+2,be.uint16[Ie+3]=4*ve+2,be.uint16[Ie+4]=4*ve+3,be.uint16[Ie+5]=4*ve+0}return be}(Y));const q=T.createIndexBuffer($c,!0),ee=T.createVertexBuffer(re,s.collisionCircleLayout.members,!0);for(const ce of W){const xe={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(ae=B).getCameraToCenterDistance(ce.projection),u_viewport_size:[ae.width,ae.height]};ne.draw(T,P.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,d.colorModeForRenderPass(),s.CullFaceMode.disabled,xe,u.id,ee,q,s.SegmentVector.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,B.zoom)}var ae;ee.destroy(),q.destroy()}const _f=s.create();function Xh({width:d,height:o,anchor:u,textOffset:m,textScale:y},v){const{horizontalAlign:A,verticalAlign:T}=s.getAnchorAlignment(u),P=-(A-.5)*d,B=-(T-.5)*o,R=s.evaluateVariableOffset(u,m);return new s.Point((P/y+R[0])*v,(B/y+R[1])*v)}function i_(d,o,u,m,y,v,A,T,P,B,R){const W=d.text.placedSymbolArray,Y=d.text.dynamicLayoutVertexArray,te=d.icon.dynamicLayoutVertexArray,ne={},re=d.getProjection(),ie=Nr(T,re,v),q=v.elevation,ee=re.upVectorScale(T.canonical,v.center.lat,v.worldSize).metersToTile;Y.clear();for(let ae=0;ae<W.length;ae++){const ce=W.get(ae),{tileAnchorX:xe,tileAnchorY:be,numGlyphs:ve}=ce,Ie=ce.hidden||!ce.crossTileID||d.allowVerticalPlacement&&!ce.placedOrientation?null:m[ce.crossTileID];if(Ie){let Ce=0,Re=0,it=0;if(q){const lt=q?q.getAtTileOffset(T,xe,be):0,[kt,Nt,At]=re.upVector(T.canonical,xe,be);Ce=lt*kt*ee,Re=lt*Nt*ee,it=lt*At*ee}let[ze,Ze,Fe,nt]=Pn(ce.projectedAnchorX+Ce,ce.projectedAnchorY+Re,ce.projectedAnchorZ+it,u?ie:A);const Me=rf(v.getCameraToCenterDistance(re),nt);let He=y.evaluateSizeForFeature(d.textSizeData,B,ce)*Me/s.ONE_EM;u&&(He*=d.tilePixelRatio/P);const at=Xh(Ie,He);u?({x:ze,y:Ze,z:Fe}=re.projectTilePoint(xe+at.x,be+at.y,T.canonical),[ze,Ze,Fe]=Pn(ze+Ce,Ze+Re,Fe+it,A)):(o&&at._rotate(-v.angle),ze+=at.x,Ze+=at.y,Fe=0);const Qe=d.allowVerticalPlacement&&ce.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let lt=0;lt<ve;lt++)s.addDynamicAttributes(Y,ze,Ze,Fe,Qe);R&&ce.associatedIconIndex>=0&&(ne[ce.associatedIconIndex]={x:ze,y:Ze,z:Fe,angle:Qe})}else Qi(ve,Y)}if(R){te.clear();const ae=d.icon.placedSymbolArray;for(let ce=0;ce<ae.length;ce++){const xe=ae.get(ce),{numGlyphs:be}=xe,ve=ne[ce];if(xe.hidden||!ve)Qi(be,te);else{const{x:Ie,y:Ce,z:Re,angle:it}=ve;for(let ze=0;ze<be;ze++)s.addDynamicAttributes(te,Ie,Ce,Re,it)}}d.icon.dynamicLayoutVertexBuffer.updateData(te)}d.text.dynamicLayoutVertexBuffer.updateData(Y)}function Kh(d,o,u){return u.iconsInText&&o?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function yf(d,o,u,m,y,v,A,T,P,B,R,W){const Y=d.context,te=Y.gl,ne=d.transform,re=T==="map",ie=P==="map",q=re&&u.layout.get("symbol-placement")!=="point",ee=re&&!ie&&!q,ae=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ce=!1;const xe=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),be=[s.mercatorXfromLng(ne.center.lng),s.mercatorYfromLat(ne.center.lat)],ve=u.layout.get("text-variable-anchor"),Ie=ne.projection.name==="globe",Ce=[],Re=[0,-1,0];let it=Re;!Ie&&!ne.mercatorFromTransition||re||(it=function(ze){const Ze=ze._camera.getWorldToCamera(ze.worldSize,1),Fe=s.multiply([],Ze,ze.globeMatrix);s.invert(Fe,Fe);const nt=[0,0,0],Me=[0,1,0,0];return s.transformMat4$1(Me,Me,Fe),nt[0]=Me[0],nt[1]=Me[1],nt[2]=Me[2],s.normalize(nt,nt),nt}(ne));for(const ze of m){const Ze=o.getTile(ze),Fe=Ze.getBucket(u);if(!Fe||Fe.projection.name==="mercator"&&Ie)continue;const nt=y?Fe.text:Fe.icon;if(!nt||Fe.fullyClipped||!nt.segments.get().length)continue;const Me=nt.programConfigurations.get(u.id),He=y||Fe.sdfIcons,at=y?Fe.textSizeData:Fe.iconSizeData,Qe=ie||ne.pitch!==0,lt=s.evaluateSizeForZoom(at,ne.zoom);let kt,Nt,At,Bt,er=[0,0],Yt=null;if(y)Nt=Ze.glyphAtlasTexture,At=te.LINEAR,kt=Ze.glyphAtlasTexture.size,Fe.iconsInText&&(er=Ze.imageAtlasTexture.size,Yt=Ze.imageAtlasTexture,Bt=Qe||d.options.rotating||d.options.zooming||at.kind==="composite"||at.kind==="camera"?te.LINEAR:te.NEAREST);else{const Zo=u.layout.get("icon-size").constantOr(0)!==1||Fe.iconsNeedLinear;Nt=Ze.imageAtlasTexture,At=He||d.options.rotating||d.options.zooming||Zo||Qe?te.LINEAR:te.NEAREST,kt=Ze.imageAtlasTexture.size}const It=Fe.projection.name==="globe",_r=It?it:Re,wr=It?s.globeToMercatorTransition(ne.zoom):0,Er=Nr(ze,Fe.getProjection(),ne),Sr=ne.calculatePixelsToTileUnitsMatrix(Ze),Zn=We(Er,Ze.tileID.canonical,ie,re,ne,Fe.getProjection(),Sr),Dn=d.terrain&&ie&&q?s.invert(s.create(),Zn):_f,Li=an(Er,Ze.tileID.canonical,ie,re,ne,Fe.getProjection(),Sr),So=ve&&Fe.hasTextData(),Ur=u.layout.get("icon-text-fit")!=="none"&&So&&Fe.hasIconData();if(q){const Zo=ne.elevation,ys=Zo?Zo.getAtTileOffsetFunc(ze,ne.center.lat,ne.worldSize,Fe.getProjection()):null,Xs=Uo(Er,Ze.tileID.canonical,ie,re,ne,Fe.getProjection(),Sr);wh(Fe,Er,d,y,Xs,Li,ie,B,ys,ze)}const Ar=q||y&&ve||Ur,ur=d.translatePosMatrix(Er,Ze,v,A),ln=Ar?_f:Zn,ri=d.translatePosMatrix(Li,Ze,v,A,!0),Lr=Fe.getProjection().createInversionMatrix(ne,ze.canonical),hi=[];d.terrainRenderModeElevated()&&ie&&hi.push("PITCH_WITH_MAP_TERRAIN"),It&&hi.push("PROJECTION_GLOBE_VIEW"),Ar&&hi.push("PROJECTED_POS_ON_VIEWPORT");const ou=He&&u.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Zs;Zs=He?Fe.iconsInText?gf(at.kind,lt,ee,ie,d,ur,ln,ri,kt,er,ze,wr,be,Lr,_r,Fe.getProjection()):jc(at.kind,lt,ee,ie,d,ur,ln,ri,y,kt,!0,ze,wr,be,Lr,_r,Fe.getProjection()):Gh(at.kind,lt,ee,ie,d,ur,ln,ri,y,kt,ze,wr,be,Lr,_r,Fe.getProjection());const Hl={program:d.useProgram(Kh(He,y,Fe),Me,hi),buffers:nt,uniformValues:Zs,atlasTexture:Nt,atlasTextureIcon:Yt,atlasInterpolation:At,atlasInterpolationIcon:Bt,isSDF:He,hasHalo:ou,tile:Ze,labelPlaneMatrixInv:Dn};if(ae&&Fe.canOverlap){ce=!0;const Zo=nt.segments.get();for(const ys of Zo)Ce.push({segments:new s.SegmentVector([ys]),sortKey:ys.sortKey,state:Hl})}else Ce.push({segments:nt.segments,sortKey:0,state:Hl})}ce&&Ce.sort((ze,Ze)=>ze.sortKey-Ze.sortKey);for(const ze of Ce){const Ze=ze.state;if(d.terrain&&d.terrain.setupElevationDraw(Ze.tile,Ze.program,{useDepthForOcclusion:!Ie,labelPlaneMatrixInv:Ze.labelPlaneMatrixInv}),Y.activeTexture.set(te.TEXTURE0),Ze.atlasTexture.bind(Ze.atlasInterpolation,te.CLAMP_TO_EDGE),Ze.atlasTextureIcon&&(Y.activeTexture.set(te.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),Ze.isSDF){const Fe=Ze.uniformValues;Ze.hasHalo&&(Fe.u_is_halo=1,Fl(Ze.buffers,ze.segments,u,d,Ze.program,xe,R,W,Fe)),Fe.u_is_halo=0}Fl(Ze.buffers,ze.segments,u,d,Ze.program,xe,R,W,Ze.uniformValues)}}function Fl(d,o,u,m,y,v,A,T,P){const B=m.context,R=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];y.draw(B,B.gl.TRIANGLES,v,A,T,s.CullFaceMode.disabled,P,u.id,d.layoutVertexBuffer,d.indexBuffer,o,u.paint,m.transform.zoom,d.programConfigurations.get(u.id),R)}function xf(d,o,u,m,y,v,A){const T=d.context.gl,P=u.paint.get("fill-pattern"),B=P&&P.constantOr(1);let R,W,Y,te,ne;A?(W=B&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=T.LINES):(W=B?"fillPattern":"fill",R=T.TRIANGLES);for(const re of m){const ie=o.getTile(re);if(B&&!ie.patternsLoaded())continue;const q=ie.getBucket(u);if(!q)continue;d.prepareDrawTile();const ee=q.programConfigurations.get(u.id),ae=d.useProgram(W,ee);B&&(d.context.activeTexture.set(T.TEXTURE0),ie.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),ee.updatePaintBuffers());const ce=P.constantOr(null);if(ce&&ie.imageAtlas){const be=ie.imageAtlas.patternPositions[ce.toString()];be&&ee.setConstantPatternPositions(be)}const xe=d.translatePosMatrix(re.projMatrix,ie,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(A){te=q.indexBuffer2,ne=q.segments2;const be=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];Y=W==="fillOutlinePattern"&&B?e_(xe,d,ie,be):Qg(xe,be)}else te=q.indexBuffer,ne=q.segments,Y=B?Uh(xe,d,ie):Ws(xe);d.prepareDrawProgram(d.context,ae,re.toUnwrapped()),ae.draw(d.context,R,y,d.stencilModeForClipping(re),v,s.CullFaceMode.disabled,Y,u.id,q.layoutVertexBuffer,te,ne,u.paint,d.transform.zoom,ee)}}function Wc(d,o,u,m,y,v,A){const T=d.context,P=T.gl,B=d.transform,R=u.paint.get("fill-extrusion-pattern"),W=R.constantOr(1),Y=u.paint.get("fill-extrusion-opacity"),te=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),u.paint.get("fill-extrusion-ambient-occlusion-radius")],ne=u.layout.get("fill-extrusion-edge-radius"),re=ne>0&&!u.paint.get("fill-extrusion-rounded-roof"),ie=re?0:ne,q=B.projection.name==="globe"?s.fillExtrusionHeightLift():0,ee=B.projection.name==="globe",ae=ee?s.globeToMercatorTransition(B.zoom):0,ce=[s.mercatorXfromLng(B.center.lng),s.mercatorYfromLat(B.center.lat)],xe=[];ee&&xe.push("PROJECTION_GLOBE_VIEW"),te[0]>0&&xe.push("FAUX_AO"),re&&xe.push("ZERO_ROOF_RADIUS");for(const be of m){const ve=o.getTile(be),Ie=ve.getBucket(u);if(!Ie||Ie.projection.name!==B.projection.name)continue;const Ce=Ie.programConfigurations.get(u.id),Re=d.useProgram(W?"fillExtrusionPattern":"fillExtrusion",Ce,xe);if(d.terrain){const He=d.terrain;if(d.style.terrainSetForDrapingOnly())He.setupElevationDraw(ve,Re,{useMeterToDem:!0});else{if(!Ie.enableTerrain)continue;if(He.setupElevationDraw(ve,Re,{useMeterToDem:!0}),vf(T,o,be,Ie,u,He),!Ie.centroidVertexBuffer){const at=Re.attributes.a_centroid_pos;at!==void 0&&P.vertexAttrib2f(at,0,0)}}}W&&(d.context.activeTexture.set(P.TEXTURE0),ve.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Ce.updatePaintBuffers());const it=R.constantOr(null);if(it&&ve.imageAtlas){const He=ve.imageAtlas.patternPositions[it.toString()];He&&Ce.setConstantPatternPositions(He)}const ze=d.translatePosMatrix(be.projMatrix,ve,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ze=B.projection.createInversionMatrix(B,be.canonical),Fe=u.paint.get("fill-extrusion-vertical-gradient"),nt=W?pf(ze,d,Fe,Y,te,ie,be,ve,q,ae,ce,Ze):Nh(ze,d,Fe,Y,te,ie,be,q,ae,ce,Ze);d.prepareDrawProgram(T,Re,be.toUnwrapped());const Me=[];d.terrain&&Me.push(Ie.centroidVertexBuffer),ee&&Me.push(Ie.layoutVertexExtBuffer),Re.draw(T,T.gl.TRIANGLES,y,v,A,s.CullFaceMode.backCCW,nt,u.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,u.paint,d.transform.zoom,Ce,Me)}}function vf(d,o,u,m,y,v){const A=[q=>{let ee=q.canonical.x-1,ae=q.wrap;return ee<0&&(ee=(1<<q.canonical.z)-1,ae--),new s.OverscaledTileID(q.overscaledZ,ae,q.canonical.z,ee,q.canonical.y)},q=>{let ee=q.canonical.x+1,ae=q.wrap;return ee===1<<q.canonical.z&&(ee=0,ae++),new s.OverscaledTileID(q.overscaledZ,ae,q.canonical.z,ee,q.canonical.y)},q=>new s.OverscaledTileID(q.overscaledZ,q.wrap,q.canonical.z,q.canonical.x,(q.canonical.y===0?1<<q.canonical.z:q.canonical.y)-1),q=>new s.OverscaledTileID(q.overscaledZ,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y===(1<<q.canonical.z)-1?0:q.canonical.y+1)],T=q=>{const ee=o.getSource().minzoom,ae=xe=>{const be=o.getTileByID(xe);if(be&&be.hasData())return be.getBucket(y)},ce=[0,-1,1];for(const xe of ce){if(q.overscaledZ+xe<ee)continue;const be=ae(q.calculateScaledKey(q.overscaledZ+xe));if(be)return be}},P=[0,0,0],B=(q,ee)=>(P[0]=Math.min(q.min.y,ee.min.y),P[1]=Math.max(q.max.y,ee.max.y),P[2]=s.EXTENT-ee.min.x>q.max.x?ee.min.x-s.EXTENT:q.max.x,P),R=(q,ee)=>(P[0]=Math.min(q.min.x,ee.min.x),P[1]=Math.max(q.max.x,ee.max.x),P[2]=s.EXTENT-ee.min.y>q.max.y?ee.min.y-s.EXTENT:q.max.y,P),W=[(q,ee)=>B(q,ee),(q,ee)=>B(ee,q),(q,ee)=>R(q,ee),(q,ee)=>R(ee,q)],Y=new s.Point(0,0);let te,ne,re;const ie=(q,ee,ae,ce,xe)=>{const be=[[ce?ae:q,ce?q:ae,0],[ce?ae:ee,ce?ee:ae,0]],ve=xe<0?s.EXTENT+xe:xe,Ie=[ce?ve:(q+ee)/2,ce?(q+ee)/2:ve,0];return ae===0&&xe<0||ae!==0&&xe>0?v.getForTilePoints(re,[Ie],!0,ne):be.push(Ie),v.getForTilePoints(u,be,!0,te),Math.max(be[0][2],be[1][2],Ie[2])/v.exaggeration()};for(let q=0;q<4;q++){const ee=(q<2?1:5)-q,ae=m.borders[q];if(ae.length===0)continue;const ce=re=A[q](u),xe=T(ce);if(!(xe&&xe instanceof s.FillExtrusionBucket&&xe.enableTerrain)||m.borderDoneWithNeighborZ[q]===xe.canonical.z&&xe.borderDoneWithNeighborZ[ee]===m.canonical.z||(ne=v.findDEMTileFor(ce),!ne||!ne.dem))continue;if(!te){const Ce=v.findDEMTileFor(u);if(!Ce||!Ce.dem)return;te=Ce}const be=xe.borders[ee];let ve=0;const Ie=xe.borderDoneWithNeighborZ[ee]!==m.canonical.z;if(m.canonical.z===xe.canonical.z){for(let Ce=0;Ce<ae.length;Ce++){const Re=m.featuresOnBorder[ae[Ce]],it=Re.borders[q];let ze;for(;ve<be.length&&(ze=xe.featuresOnBorder[be[ve]],!(ze.borders[ee][1]>it[0]+3));)Ie&&xe.encodeCentroid(void 0,ze,!1),ve++;if(ze&&ve<be.length){const Ze=ve;let Fe=0;for(;!(ze.borders[ee][0]>it[1]-3)&&(Fe++,++ve!==be.length);)ze=xe.featuresOnBorder[be[ve]];if(ze=xe.featuresOnBorder[be[Ze]],Re.intersectsCount()>1||ze.intersectsCount()>1||Fe!==1){Fe!==1&&(ve=Ze),m.encodeCentroid(void 0,Re,!1),Ie&&xe.encodeCentroid(void 0,ze,!1);continue}const nt=W[q](Re,ze),Me=q%2?s.EXTENT-1:0;Y.x=ie(nt[0],Math.min(s.EXTENT-1,nt[1]),Me,q<2,nt[2]),Y.y=0,m.encodeCentroid(Y,Re,!1),Ie&&xe.encodeCentroid(Y,ze,!1)}else m.encodeCentroid(void 0,Re,!1)}m.borderDoneWithNeighborZ[q]=xe.canonical.z,m.needsCentroidUpdate=!0,Ie&&(xe.borderDoneWithNeighborZ[ee]=m.canonical.z,xe.needsCentroidUpdate=!0)}else{for(const Ce of ae)m.encodeCentroid(void 0,m.featuresOnBorder[Ce],!1);if(Ie){for(const Ce of be)xe.encodeCentroid(void 0,xe.featuresOnBorder[Ce],!1);xe.borderDoneWithNeighborZ[ee]=m.canonical.z,xe.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[q]=xe.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(d)}const Aa=new s.Color(1,0,0,1),o_=new s.Color(0,1,0,1),s_=new s.Color(0,0,1,1),a_=new s.Color(1,0,1,1),l_=new s.Color(0,1,1,1);function c_(d,o,u){const m=d.context,y=d.transform,v=m.gl,A=y.projection.name==="globe",T=A?["PROJECTION_GLOBE_VIEW"]:null;let P=u.projMatrix;if(A&&s.globeToMercatorTransition(y.zoom)>0){const Re=s.transitionTileAABBinECEF(u.canonical,y),it=s.globeDenormalizeECEF(Re);P=s.multiply(new Float32Array(16),y.globeMatrix,it),s.multiply(P,y.projMatrix,P)}const B=d.useProgram("debug",null,T),R=o.getTileByID(u.key);d.terrain&&d.terrain.setupElevationDraw(R,B);const W=s.DepthMode.disabled,Y=s.StencilMode.disabled,te=d.colorModeForRenderPass(),ne="$debug";m.activeTexture.set(v.TEXTURE0),d.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),A?R._makeGlobeTileDebugBuffers(d.context,y):R._makeDebugTileBoundsBuffers(d.context,y.projection);const re=R._tileDebugBuffer||d.debugBuffer,ie=R._tileDebugIndexBuffer||d.debugIndexBuffer,q=R._tileDebugSegments||d.debugSegments;B.draw(m,v.LINE_STRIP,W,Y,te,s.CullFaceMode.disabled,Uc(P,s.Color.red),ne,re,ie,q,null,null,null,[R._globeTileDebugBorderBuffer]);const ee=R.latestRawTileData,ae=Math.floor((ee&&ee.byteLength||0)/1024),ce=o.getTile(u).tileSize,xe=512/Math.min(ce,512)*(u.overscaledZ/y.zoom)*.5;let be=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(be+=` => ${u.overscaledZ}`),be+=` ${ae}kb`,function(Re,it){Re.initDebugOverlayCanvas();const ze=Re.debugOverlayCanvas,Ze=Re.context.gl,Fe=Re.debugOverlayCanvas.getContext("2d");Fe.clearRect(0,0,ze.width,ze.height),Fe.shadowColor="white",Fe.shadowBlur=2,Fe.lineWidth=1.5,Fe.strokeStyle="white",Fe.textBaseline="top",Fe.font="bold 36px Open Sans, sans-serif",Fe.fillText(it,5,5),Fe.strokeText(it,5,5),Re.debugOverlayTexture.update(ze),Re.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(d,be);const ve=R._tileDebugTextBuffer||d.debugBuffer,Ie=R._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Ce=R._tileDebugTextSegments||d.debugSegments;B.draw(m,v.TRIANGLES,W,Y,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,Uc(P,s.Color.transparent,xe),ne,ve,Ie,Ce,null,null,null,[R._globeTileDebugTextBuffer])}function bf(d,o,u,m){Ta(d,0,o+u/2,d.transform.width,u,m)}function qc(d,o,u,m){Ta(d,o-u/2,0,u,d.transform.height,m)}function Ta(d,o,u,m,y,v){const A=d.context,T=A.gl;T.enable(T.SCISSOR_TEST),T.scissor(o*s.exported.devicePixelRatio,u*s.exported.devicePixelRatio,m*s.exported.devicePixelRatio,y*s.exported.devicePixelRatio),A.clear({color:v}),T.disable(T.SCISSOR_TEST)}const wf=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ef}=wf;function Go(d,o,u,m){d.emplaceBack(o,u,m)}class Gc{constructor(o){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Go(this.vertexArray,-1,-1,1),Go(this.vertexArray,1,-1,1),Go(this.vertexArray,-1,1,1),Go(this.vertexArray,1,1,1),Go(this.vertexArray,-1,-1,-1),Go(this.vertexArray,1,-1,-1),Go(this.vertexArray,-1,1,-1),Go(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Ef),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function Ri(d,o,u,m,y,v){const A=d.gl,T=o.paint.get("sky-atmosphere-color"),P=o.paint.get("sky-atmosphere-halo-color"),B=o.paint.get("sky-atmosphere-sun-intensity"),R=((W,Y,te,ne,re)=>({u_matrix_3f:W,u_sun_direction:Y,u_sun_intensity:te,u_color_tint_r:[ne.r,ne.g,ne.b,ne.a],u_color_tint_m:[re.r,re.g,re.b,re.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),m),y,B,T,P);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+v,o.skyboxTexture,0),u.draw(d,A.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,R,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const Ol=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Sf{constructor(o){const u=new s.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const m=new s.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(u,Ol.members),this.indexBuffer=o.createIndexBuffer(m),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const qs={symbol:function(d,o,u,m,y){if(d.renderPass!=="translucent")return;const v=s.StencilMode.disabled,A=d.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(T,P,B,R,W,Y,te){const ne=P.transform,re=W==="map",ie=Y==="map";for(const q of T){const ee=R.getTile(q),ae=ee.getBucket(B);if(!ae||!ae.text||!ae.text.segments.get().length)continue;const ce=s.evaluateSizeForZoom(ae.textSizeData,ne.zoom),xe=Nr(q,ae.getProjection(),ne),be=ne.calculatePixelsToTileUnitsMatrix(ee),ve=We(xe,ee.tileID.canonical,ie,re,ne,ae.getProjection(),be),Ie=B.layout.get("icon-text-fit")!=="none"&&ae.hasIconData();if(ce){const Ce=Math.pow(2,ne.zoom-ee.tileID.overscaledZ);i_(ae,re,ie,te,s.symbolSize,ne,ve,q,Ce,ce,Ie)}}}(m,d,u,o,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),y),u.paint.get("icon-opacity").constantOr(1)!==0&&yf(d,o,u,m,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),v,A),u.paint.get("text-opacity").constantOr(1)!==0&&yf(d,o,u,m,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),v,A),o.map.showCollisionBoxes&&(Ll(d,o,u,m,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Ll(d,o,u,m,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(d,o,u,m){if(d.renderPass!=="translucent")return;const y=u.paint.get("circle-opacity"),v=u.paint.get("circle-stroke-width"),A=u.paint.get("circle-stroke-opacity"),T=u.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(v.constantOr(1)===0||A.constantOr(1)===0))return;const P=d.context,B=P.gl,R=d.transform,W=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),Y=s.StencilMode.disabled,te=d.colorModeForRenderPass(),ne=R.projection.name==="globe",re=[s.mercatorXfromLng(R.center.lng),s.mercatorYfromLat(R.center.lat)],ie=[];for(let ee=0;ee<m.length;ee++){const ae=m[ee],ce=o.getTile(ae),xe=ce.getBucket(u);if(!xe||xe.projection.name!==R.projection.name)continue;const be=xe.programConfigurations.get(u.id),ve=jh(u);ne&&ve.push("PROJECTION_GLOBE_VIEW");const Ie=d.useProgram("circle",be,ve),Ce=xe.layoutVertexBuffer,Re=xe.globeExtVertexBuffer,it=xe.indexBuffer,ze=R.projection.createInversionMatrix(R,ae.canonical),Ze={programConfiguration:be,program:Ie,layoutVertexBuffer:Ce,globeExtVertexBuffer:Re,indexBuffer:it,uniformValues:Vh(d,ae,ce,ze,re,u),tile:ce};if(T){const Fe=xe.segments.get();for(const nt of Fe)ie.push({segments:new s.SegmentVector([nt]),sortKey:nt.sortKey,state:Ze})}else ie.push({segments:xe.segments,sortKey:0,state:Ze})}T&&ie.sort((ee,ae)=>ee.sortKey-ae.sortKey);const q={useDepthForOcclusion:!ne};for(const ee of ie){const{programConfiguration:ae,program:ce,layoutVertexBuffer:xe,globeExtVertexBuffer:be,indexBuffer:ve,uniformValues:Ie,tile:Ce}=ee.state,Re=ee.segments;d.terrain&&d.terrain.setupElevationDraw(Ce,ce,q),d.prepareDrawProgram(P,ce,Ce.tileID.toUnwrapped()),ce.draw(P,B.TRIANGLES,W,Y,te,s.CullFaceMode.disabled,Ie,u.id,xe,ve,Re,u.paint,R.zoom,ae,[be])}},heatmap:function(d,o,u,m){if(u.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const y=d.context,v=y.gl,A=s.StencilMode.disabled,T=new s.ColorMode([v.ONE,v.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(te,ne,re,ie){const q=te.gl,ee=ne.width*ie,ae=ne.height*ie;te.activeTexture.set(q.TEXTURE1),te.viewport.set([0,0,ee,ae]);let ce=re.heatmapFbo;if(!ce||ce&&(ce.width!==ee||ce.height!==ae)){ce&&ce.destroy();const xe=q.createTexture();q.bindTexture(q.TEXTURE_2D,xe),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),ce=re.heatmapFbo=te.createFramebuffer(ee,ae,!1),function(be,ve,Ie,Ce,Re,it){const ze=be.gl;ze.texImage2D(ze.TEXTURE_2D,0,be.isWebGL2&&be.extRenderToTextureHalfFloat?ze.RGBA16F:ze.RGBA,Re,it,0,ze.RGBA,be.extRenderToTextureHalfFloat?be.isWebGL2?ze.HALF_FLOAT:be.extTextureHalfFloat.HALF_FLOAT_OES:ze.UNSIGNED_BYTE,null),Ce.colorAttachment.set(Ie)}(te,0,xe,ce,ee,ae)}else q.bindTexture(q.TEXTURE_2D,ce.colorAttachment.get()),te.bindFramebuffer.set(ce.framebuffer)})(y,d,u,d.transform.projection.name==="globe"?.5:.25),y.clear({color:s.Color.transparent});const P=d.transform,B=P.projection.name==="globe",R=B?["PROJECTION_GLOBE_VIEW"]:null,W=B?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,Y=[s.mercatorXfromLng(P.center.lng),s.mercatorYfromLat(P.center.lat)];for(let te=0;te<m.length;te++){const ne=m[te];if(o.hasRenderableParent(ne))continue;const re=o.getTile(ne),ie=re.getBucket(u);if(!ie||ie.projection.name!==P.projection.name)continue;const q=ie.programConfigurations.get(u.id),ee=d.useProgram("heatmap",q,R),{zoom:ae}=d.transform;d.terrain&&d.terrain.setupElevationDraw(re,ee),d.prepareDrawProgram(y,ee,ne.toUnwrapped());const ce=P.projection.createInversionMatrix(P,ne.canonical);ee.draw(y,v.TRIANGLES,s.DepthMode.disabled,A,T,W,mf(d,ne,re,ce,Y,ae,u.paint.get("heatmap-intensity")),u.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,u.paint,d.transform.zoom,q,B?[ie.globeExtVertexBuffer]:null)}y.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(y,v){const A=y.context,T=A.gl,P=v.heatmapFbo;if(!P)return;A.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,P.colorAttachment.get()),A.activeTexture.set(T.TEXTURE1);let B=v.colorRampTexture;B||(B=v.colorRampTexture=new s.Texture(A,v.colorRamp,T.RGBA)),B.bind(T.LINEAR,T.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(A,T.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,y.colorModeForRenderPass(),s.CullFaceMode.disabled,((R,W,Y,te)=>({u_image:0,u_color_ramp:1,u_opacity:W.paint.get("heatmap-opacity")}))(0,v),v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(d,u))},line:function(d,o,u,m){if(d.renderPass!=="translucent")return;const y=u.paint.get("line-opacity"),v=u.paint.get("line-width");if(y.constantOr(1)===0||v.constantOr(1)===0)return;const A=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),T=d.colorModeForRenderPass(),P=d.terrain&&d.terrain.renderingToTexture?1:s.exported.devicePixelRatio,B=u.paint.get("line-dasharray"),R=B.constantOr(1),W=u.layout.get("line-cap"),Y=u.paint.get("line-pattern"),te=Y.constantOr(1),ne=u.paint.get("line-gradient"),re=te?"linePattern":"line",ie=d.context,q=ie.gl,ee=(ce=>{const xe=[];Bl(ce)&&xe.push("RENDER_LINE_DASH"),ce.paint.get("line-gradient")&&xe.push("RENDER_LINE_GRADIENT");const be=ce.paint.get("line-trim-offset");be[0]===0&&be[1]===0||xe.push("RENDER_LINE_TRIM_OFFSET");const ve=ce.paint.get("line-pattern").constantOr(1),Ie=ce.paint.get("line-opacity").constantOr(1)!==1;return!ve&&Ie&&xe.push("RENDER_LINE_ALPHA_DISCARD"),xe})(u);let ae=ee.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(ae=!1);for(const ce of m){const xe=o.getTile(ce);if(te&&!xe.patternsLoaded())continue;const be=xe.getBucket(u);if(!be)continue;d.prepareDrawTile();const ve=be.programConfigurations.get(u.id),Ie=d.useProgram(re,ve,ee),Ce=Y.constantOr(null);if(Ce&&xe.imageAtlas){const He=xe.imageAtlas.patternPositions[Ce.toString()];He&&ve.setConstantPatternPositions(He)}const Re=B.constantOr(null),it=W.constantOr(null);if(!te&&Re&&it&&xe.lineAtlas){const He=xe.lineAtlas.getDash(Re,it);He&&ve.setConstantPatternPositions(He)}let[ze,Ze]=u.paint.get("line-trim-offset");(it==="round"||it==="square")&&ze!==Ze&&(ze===0&&(ze-=1),Ze===1&&(Ze+=1));const Fe=d.terrain?ce.projMatrix:null,nt=te?Rl(d,xe,u,Fe,P):r_(d,xe,u,Fe,be.lineClipsArray.length,P,[ze,Ze]);if(ne){const He=be.gradients[u.id];let at=He.texture;if(u.gradientVersion!==He.version){let Qe=256;if(u.stepInterpolant){const lt=o.getSource().maxzoom,kt=ce.canonical.z===lt?Math.ceil(1<<d.transform.maxZoom-ce.canonical.z):1;Qe=s.clamp(s.nextPowerOfTwo(be.maxLineLength/s.EXTENT*1024*kt),256,ie.maxTextureSize)}He.gradient=s.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Qe,image:He.gradient||void 0,clips:be.lineClipsArray}),He.texture?He.texture.update(He.gradient):He.texture=new s.Texture(ie,He.gradient,q.RGBA),He.version=u.gradientVersion,at=He.texture}ie.activeTexture.set(q.TEXTURE1),at.bind(u.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}R&&(ie.activeTexture.set(q.TEXTURE0),xe.lineAtlasTexture.bind(q.LINEAR,q.REPEAT),ve.updatePaintBuffers()),te&&(ie.activeTexture.set(q.TEXTURE0),xe.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),ve.updatePaintBuffers()),d.prepareDrawProgram(ie,Ie,ce.toUnwrapped());const Me=He=>{Ie.draw(ie,q.TRIANGLES,A,He,T,s.CullFaceMode.disabled,nt,u.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,u.paint,d.transform.zoom,ve,[be.layoutVertexBuffer2])};if(ae){const He=d.stencilModeForClipping(ce).ref;He===0&&d.terrain&&ie.clear({stencil:0});const at={func:q.EQUAL,mask:255};nt.u_alpha_discard_threshold=.8,Me(new s.StencilMode(at,He,255,q.KEEP,q.KEEP,q.INVERT)),nt.u_alpha_discard_threshold=0,Me(new s.StencilMode(at,He,255,q.KEEP,q.KEEP,q.KEEP))}else Me(d.stencilModeForClipping(ce))}ae&&(d.resetStencilClippingMasks(),d.terrain&&ie.clear({stencil:0}))},fill:function(d,o,u,m){const y=u.paint.get("fill-color"),v=u.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const A=d.colorModeForRenderPass(),T=u.paint.get("fill-pattern"),P=d.opaquePassEnabledForLayer()&&!T.constantOr(1)&&y.constantOr(s.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===P){const B=d.depthModeForSublayer(1,d.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);xf(d,o,u,m,B,A,!1)}if(d.renderPass==="translucent"&&u.paint.get("fill-antialias")){const B=d.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);xf(d,o,u,m,B,A,!0)}},"fill-extrusion":function(d,o,u,m){const y=u.paint.get("fill-extrusion-opacity");if(y!==0&&d.renderPass==="translucent"){const v=new s.DepthMode(d.context.gl.LEQUAL,s.DepthMode.ReadWrite,d.depthRangeFor3D);if(y!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))Wc(d,o,u,m,v,s.StencilMode.disabled,s.ColorMode.disabled),Wc(d,o,u,m,v,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const A=d.colorModeForRenderPass();Wc(d,o,u,m,v,s.StencilMode.disabled,A)}}},hillshade:function(d,o,u,m){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const y=d.context,v=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),A=d.colorModeForRenderPass(),T=d.terrain&&d.terrain.renderingToTexture,[P,B]=d.renderPass!=="translucent"||T?[{},m]:d.stencilConfigForOverlap(m);for(const R of B){const W=o.getTile(R);if(W.needsHillshadePrepare&&d.renderPass==="offscreen")uf(d,W,u,v,s.StencilMode.disabled,A);else if(d.renderPass==="translucent"){const Y=T&&d.terrain?d.terrain.stencilModeForRTTOverlap(R):P[R.overscaledZ];cf(d,R,W,u,v,Y,A)}}y.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,o,u,m,y,v){if(d.renderPass!=="translucent"||u.paint.get("raster-opacity")===0||!m.length)return;const A=d.context,T=A.gl,P=o.getSource(),B=d.useProgram("raster"),R=d.colorModeForRenderPass(),W=d.terrain&&d.terrain.renderingToTexture,[Y,te]=P instanceof Ft||W?[{},m]:d.stencilConfigForOverlap(m),ne=te[te.length-1].overscaledZ,re=!d.options.moving;for(const ie of te){const q=W?s.DepthMode.disabled:d.depthModeForSublayer(ie.overscaledZ-ne,u.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,T.LESS),ee=ie.toUnwrapped(),ae=o.getTile(ie);if(W&&(!ae||!ae.hasData()))continue;const ce=W?ie.projMatrix:d.transform.calculateProjMatrix(ee,re),xe=d.terrain&&W?d.terrain.stencilModeForRTTOverlap(ie):Y[ie.overscaledZ],be=v?0:u.paint.get("raster-fade-duration");ae.registerFadeDuration(be);const ve=o.findLoadedParent(ie,0),Ie=Lh(ae,ve,o,d.transform,be);let Ce,Re;d.terrain&&d.terrain.prepareDrawTile();const it=u.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;A.activeTexture.set(T.TEXTURE0),ae.texture.bind(it,T.CLAMP_TO_EDGE),A.activeTexture.set(T.TEXTURE1),ve?(ve.texture.bind(it,T.CLAMP_TO_EDGE),Ce=Math.pow(2,ve.tileID.overscaledZ-ae.tileID.overscaledZ),Re=[ae.tileID.canonical.x*Ce%1,ae.tileID.canonical.y*Ce%1]):ae.texture.bind(it,T.CLAMP_TO_EDGE),ae.texture.useMipmap&&A.extTextureFilterAnisotropic&&d.transform.pitch>20&&T.texParameterf(T.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const ze=qh(ce,Re||[0,0],Ce||1,Ie,u,P instanceof Ft?P.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(A,B,ee),P instanceof Ft)P.boundsBuffer&&P.boundsSegments&&B.draw(A,T.TRIANGLES,q,s.StencilMode.disabled,R,s.CullFaceMode.disabled,ze,u.id,P.boundsBuffer,d.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:Ze,tileBoundsIndexBuffer:Fe,tileBoundsSegments:nt}=d.getTileBoundsBuffers(ae);B.draw(A,T.TRIANGLES,q,xe,R,s.CullFaceMode.disabled,ze,u.id,Ze,Fe,nt)}}d.resetStencilClippingMasks()},background:function(d,o,u,m){const y=u.paint.get("background-color"),v=u.paint.get("background-opacity");if(v===0)return;const A=d.context,T=A.gl,P=d.transform,B=P.tileSize,R=u.paint.get("background-pattern");if(d.isPatternMissing(R))return;const W=!R&&y.a===1&&v===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==W)return;const Y=s.StencilMode.disabled,te=d.depthModeForSublayer(0,W==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),ne=d.colorModeForRenderPass(),re=d.useProgram(R?"backgroundPattern":"background");let ie,q=m;q||(ie=d.getBackgroundTiles(),q=Object.values(ie).map(ee=>ee.tileID)),R&&(A.activeTexture.set(T.TEXTURE0),d.imageManager.bind(d.context));for(const ee of q){const ae=ee.toUnwrapped(),ce=m?ee.projMatrix:d.transform.calculateProjMatrix(ae);d.prepareDrawTile();const xe=o?o.getTile(ee):ie?ie[ee.key]:new s.Tile(ee,B,P.zoom,d),be=R?n_(ce,v,d,R,{tileID:ee,tileSize:B}):Hh(ce,v,y);d.prepareDrawProgram(A,re,ae);const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:Ie,tileBoundsSegments:Ce}=d.getTileBoundsBuffers(xe);re.draw(A,T.TRIANGLES,te,Y,ne,s.CullFaceMode.disabled,be,u.id,ve,Ie,Ce)}},sky:function(d,o,u){const m=d.transform,y=m.projection.name==="mercator"||m.projection.name==="globe"?1:s.smoothstep(7,8,m.zoom),v=u.paint.get("sky-opacity")*y;if(v===0)return;const A=d.context,T=u.paint.get("sky-type"),P=new s.DepthMode(A.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),B=d.frameCounter/1e3%1;T==="atmosphere"?d.renderPass==="offscreen"?u.needsSkyboxCapture(d)&&(function(R,W,Y,te){const ne=R.context,re=ne.gl;let ie=W.skyboxFbo;if(!ie){ie=W.skyboxFbo=ne.createFramebuffer(32,32,!1),W.skyboxGeometry=new Gc(ne),W.skyboxTexture=ne.gl.createTexture(),re.bindTexture(re.TEXTURE_CUBE_MAP,W.skyboxTexture),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MAG_FILTER,re.LINEAR);for(let ce=0;ce<6;++ce)re.texImage2D(re.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,re.RGBA,32,32,0,re.RGBA,re.UNSIGNED_BYTE,null)}ne.bindFramebuffer.set(ie.framebuffer),ne.viewport.set([0,0,32,32]);const q=W.getCenter(R,!0),ee=R.useProgram("skyboxCapture"),ae=new Float64Array(16);s.identity(ae),s.rotateY(ae,ae,.5*-Math.PI),Ri(ne,W,ee,ae,q,0),s.identity(ae),s.rotateY(ae,ae,.5*Math.PI),Ri(ne,W,ee,ae,q,1),s.identity(ae),s.rotateX(ae,ae,.5*-Math.PI),Ri(ne,W,ee,ae,q,2),s.identity(ae),s.rotateX(ae,ae,.5*Math.PI),Ri(ne,W,ee,ae,q,3),s.identity(ae),Ri(ne,W,ee,ae,q,4),s.identity(ae),s.rotateY(ae,ae,Math.PI),Ri(ne,W,ee,ae,q,5),ne.viewport.set([0,0,R.width,R.height])}(d,u),u.markSkyboxValid(d)):d.renderPass==="sky"&&function(R,W,Y,te,ne){const re=R.context,ie=re.gl,q=R.transform,ee=R.useProgram("skybox");re.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,W.skyboxTexture);const ae=((ce,xe,be,ve,Ie)=>({u_matrix:ce,u_sun_direction:xe,u_cubemap:0,u_opacity:ve,u_temporal_offset:Ie}))(q.skyboxMatrix,W.getCenter(R,!1),0,te,ne);R.prepareDrawProgram(re,ee),ee.draw(re,ie.TRIANGLES,Y,s.StencilMode.disabled,R.colorModeForRenderPass(),s.CullFaceMode.backCW,ae,"skybox",W.skyboxGeometry.vertexBuffer,W.skyboxGeometry.indexBuffer,W.skyboxGeometry.segment)}(d,u,P,v,B):T==="gradient"&&d.renderPass==="sky"&&function(R,W,Y,te,ne){const re=R.context,ie=re.gl,q=R.transform,ee=R.useProgram("skyboxGradient");W.skyboxGeometry||(W.skyboxGeometry=new Gc(re)),re.activeTexture.set(ie.TEXTURE0);let ae=W.colorRampTexture;ae||(ae=W.colorRampTexture=new s.Texture(re,W.colorRamp,ie.RGBA)),ae.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const ce=((xe,be,ve,Ie,Ce)=>({u_matrix:xe,u_color_ramp:0,u_center_direction:be,u_radius:s.degToRad(ve),u_opacity:Ie,u_temporal_offset:Ce}))(q.skyboxMatrix,W.getCenter(R,!1),W.paint.get("sky-gradient-radius"),te,ne);R.prepareDrawProgram(re,ee),ee.draw(re,ie.TRIANGLES,Y,s.StencilMode.disabled,R.colorModeForRenderPass(),s.CullFaceMode.backCW,ce,"skyboxGradient",W.skyboxGeometry.vertexBuffer,W.skyboxGeometry.indexBuffer,W.skyboxGeometry.segment)}(d,u,P,v,B)},debug:function(d,o,u){for(let m=0;m<u.length;m++)c_(d,o,u[m])},custom:function(d,o,u,m){const y=d.context,v=u.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&u.isLayerDraped()){if(d.renderPass==="offscreen"){const A=v.prerender;if(A){if(d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const T=d.transform.pointMerc;A.call(v,y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(d.transform.zoom),[T.x,T.y],d.transform.pixelsPerMeterRatio)}else A.call(v,y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const T=v.renderToTile;if(T){const P=m[0].canonical,B=new s.MercatorCoordinate(P.x+m[0].wrap*(1<<P.z),P.y,P.z);y.setDepthMode(s.DepthMode.disabled),y.setStencilMode(s.StencilMode.disabled),y.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),T.call(v,y.gl,B),y.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),y.setStencilMode(s.StencilMode.disabled);const A=v.renderingMode==="3d"?new s.DepthMode(d.context.gl.LEQUAL,s.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(y.setDepthMode(A),d.transform.projection.name==="globe"){const T=d.transform.pointMerc;v.render(y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(d.transform.zoom),[T.x,T.y],d.transform.pixelsPerMeterRatio)}else v.render(y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState(),y.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ca{constructor(o,u,m=!1){this.context=new ct(o,m),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,u){const m=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Oh(this,o));const y=this._terrain;this.transform.elevation=m?y:null,y.update(o,this.transform,u)}_updateFog(o){const u=o.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,y]=u.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);const v=m+.78*(y-m);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,u){if(this.width=o*s.exported.devicePixelRatio,this.height=u*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const o=this.context,u=new s.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(s.EXTENT,0),u.emplaceBack(0,s.EXTENT),u.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(u,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const m=new s.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(s.EXTENT,0),m.emplaceBack(0,s.EXTENT),m.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=o.createVertexBuffer(m,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const y=new s.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(y,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const v=new s.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(s.EXTENT,0,s.EXTENT,0),v.emplaceBack(0,s.EXTENT,0,s.EXTENT),v.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(v,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const A=new s.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(A);const T=new s.StructArrayLayout1ui2;for(const B of[0,1,3,2,0])T.emplaceBack(B);this.debugIndexBuffer=o.createIndexBuffer(T),this.emptyTexture=new s.Texture(o,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=s.create();const P=this.context.gl;this.stencilClearMode=new s.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new Sf(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,u=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,u.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,Dl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,u,m){if(!u||this.currentStencilSource===u.id||!o.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const P of m)if(this._tileClippingMaskIDs[P.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=u.id;const y=this.context,v=y.gl;this.nextStencilID+m.length>256&&this.clearStencil(),y.setColorMode(s.ColorMode.disabled),y.setDepthMode(s.DepthMode.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of m){const P=u.getTile(T),B=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:W,tileBoundsSegments:Y}=this.getTileBoundsBuffers(P);A.draw(y,v.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:v.ALWAYS,mask:0},B,255,v.KEEP,v.KEEP,v.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Dl(T.projMatrix),"$clipping",R,W,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,u=this.context.gl;return new s.StencilMode({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const u=this.context.gl;return new s.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(o){const u=this.context.gl,m=o.sort((A,T)=>T.overscaledZ-A.overscaledZ),y=m[m.length-1].overscaledZ,v=m[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const A={};for(let T=0;T<v;T++)A[T+y]=new s.StencilMode({func:u.GEQUAL,mask:255},T+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=v,[A,m]}return[{[y]:s.StencilMode.disabled},m]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([o.CONSTANT_COLOR,o.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(o,u,m){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new s.DepthMode(m||this.context.gl.LEQUAL,u,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,u){this.style=o,this.options=u,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const m=this.style.order,y=this.style._sourceCaches;for(const B in y){const R=y[B];R.used&&R.prepare(this.context)}const v={},A={},T={};for(const B in y){const R=y[B];v[B]=R.getVisibleCoordinates(),A[B]=v[B].slice().reverse(),T[B]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<m.length;B++)if(this.style._layers[m[B]].is3D()){this.opaquePassCutoff=B;break}if(this.terrain&&(this.terrain.updateTileBinding(T),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const B of m){const R=this.style._layers[B],W=o._getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const Y=W?A[W.id]:void 0;(R.type==="custom"||R.isSky()||Y&&Y.length)&&this.renderLayer(this,W,R,Y)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon];const P=this.terrain;if(P&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&P.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[m[this.currentLayer]],R=o._getLayerSourceCache(B);if(B.isSky())continue;const W=R?A[R.id]:void 0;this._renderTileClippingMasks(B,R,W),this.renderLayer(this,R,B,W)}if(this.style.fog&&this.transform.projection.supportsFog&&function(B,R){const W=B.context,Y=W.gl,te=B.transform,ne=new s.DepthMode(Y.LEQUAL,s.DepthMode.ReadOnly,[0,1]),re=B.useProgram("globeAtmosphere",null,te.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ie=s.globeToMercatorTransition(te.zoom),q=R.properties.get("color").toArray01(),ee=R.properties.get("high-color").toArray01(),ae=R.properties.get("space-color").toArray01PremultipliedAlpha(),ce=s.identity$1([]);s.rotateY$1(ce,ce,-s.degToRad(te._center.lng)),s.rotateX$1(ce,ce,s.degToRad(te._center.lat)),s.rotateZ$1(ce,ce,te.angle),s.rotateX$1(ce,ce,-te._pitch);const xe=s.fromQuat(new Float32Array(16),ce),be=s.mapValue(R.properties.get("star-intensity"),0,1,0,.25),ve=5e-4,Ie=s.mapValue(R.properties.get("horizon-blend"),0,1,ve,.25),Ce=s.globeUseCustomAntiAliasing(B,W,te)&&Ie===ve?te.worldSize/(2*Math.PI*1.025)-1:te.globeRadius,Re=B.frameCounter/1e3%1,it=s.length(te.globeCenterInViewSpace),ze=Math.sqrt(Math.pow(it,2)-Math.pow(Ce,2)),Ze=Math.acos(ze/it),Fe=((Me,He,at,Qe,lt,kt,Nt,At,Bt,er,Yt,It,_r,wr)=>({u_frustum_tl:Me,u_frustum_tr:He,u_frustum_br:at,u_frustum_bl:Qe,u_horizon:lt,u_transition:kt,u_fadeout_range:Nt,u_color:At,u_high_color:Bt,u_space_color:er,u_star_intensity:Yt,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:It,u_horizon_angle:_r,u_rotation_matrix:wr}))(te.frustumCorners.TL,te.frustumCorners.TR,te.frustumCorners.BR,te.frustumCorners.BL,te.frustumCorners.horizon,ie,Ie,q,ee,ae,be,Re,Ze,xe);B.prepareDrawProgram(W,re);const nt=B.atmosphereBuffer;nt&&re.draw(W,Y.TRIANGLES,ne,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Fe,"skybox",nt.vertexBuffer,nt.indexBuffer,nt.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const B=this.style._layers[m[this.currentLayer]],R=o._getLayerSourceCache(B);B.isSky()&&this.renderLayer(this,R,B,R?A[R.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const B=this.style._layers[m[this.currentLayer]],R=o._getLayerSourceCache(B);if(B.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(B)){if(B.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const W=R?(B.type==="symbol"?T:A)[R.id]:void 0;this._renderTileClippingMasks(B,R,R?v[R.id]:void 0),this.renderLayer(this,R,B,W),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let B=null;s.values(this.style._layers).forEach(R=>{const W=o._getLayerSourceCache(R);W&&!R.isHidden(this.transform.zoom)&&(!B||B.getSource().maxzoom<W.getSource().maxzoom)&&(B=W)}),B&&this.options.showTileBoundaries&&qs.debug(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const R=B.transform.padding;bf(B,B.transform.height-(R.top||0),3,Aa),bf(B,R.bottom||0,3,o_),qc(B,R.left||0,3,s_),qc(B,B.transform.width-(R.right||0),3,a_);const W=B.transform.centerPoint;(function(Y,te,ne,re){Ta(Y,te-1,ne-10,2,20,re),Ta(Y,te-10,ne-1,20,2,re)})(B,W.x,B.transform.height-W.y,l_)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,u,m,y){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),(!o.transform.projection.unsupportedLayers||!o.transform.projection.unsupportedLayers.includes(m.type)||o.terrain&&m.type==="custom")&&qs[m.type](o,u,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let m=this.gpuTimers[o.id];m||(m=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),m.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,u=o.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),o.beginQueryEXT(o.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const u={};for(const m in o){const y=o[m],v=this.context.extTimerQuery,A=v.getQueryObjectEXT(y.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(y.query),u[m]=A}return u}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let m=0;for(const y of o)m+=u.getQueryObjectEXT(y,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(y);return m}translatePosMatrix(o,u,m,y,v){if(!m[0]&&!m[1])return o;const A=v?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(A){const B=Math.sin(A),R=Math.cos(A);m=[m[0]*R-m[1]*B,m[0]*B+m[1]*R]}const T=[v?m[0]:Ve(u,m[0],this.transform.zoom),v?m[1]:Ve(u,m[1],this.transform.zoom),0],P=new Float32Array(16);return s.translate(P,o,T),P}saveTileTexture(o){const u=this._tileTextures[o.size[0]];u?u.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const u=this._tileTextures[o];return u&&u.length>0?u.pop():null}isPatternMissing(o){return o===null||o!==void 0&&!this.imageManager.getPattern(o.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,u=this.terrain&&this.terrain.exaggeration()===0,m=this.style&&this.style.fog,y=[];return this.terrainRenderModeElevated()&&y.push("TERRAIN"),this.transform.projection.name==="globe"&&y.push("GLOBE"),u&&y.push("ZERO_EXAGGERATION"),m&&!o&&m.getOpacity(this.transform.pitch)!==0&&y.push("FOG"),o&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(o,u,m){this.cache=this.cache||{};const y=m||[],v=this.currentGlobalDefines().concat(y),A=or.cacheKey(Dh[o],o,v,u);return this.cache[A]||(this.cache[A]=new or(this.context,o,Dh[o],u,Zh[o],v)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,u,m){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const v=y.getOpacity(this.transform.pitch),A=((T,P,B,R,W,Y,te,ne,re,ie,q)=>{const ee=T.transform,ae=P.properties.get("color").toArray01();ae[3]=R;const ce=T.frameCounter/1e3%1;return{u_fog_matrix:B?ee.calculateFogTileMatrix(B):T.identityMat,u_fog_range:P.getFovAdjustedRange(ee._fov),u_fog_color:ae,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:ce,u_frustum_tl:W,u_frustum_tr:Y,u_frustum_br:te,u_frustum_bl:ne,u_globe_pos:re,u_globe_radius:ie,u_viewport:q,u_globe_transition:s.globeToMercatorTransition(ee.zoom),u_is_globe:+(ee.projection.name==="globe")}})(this,y,m,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);u.setFogUniformValues(o,A)}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,u=o.createTexture();return o.bindTexture(o.TEXTURE_2D,u),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,u=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const y of m)u[y.key]=o[y.key]||new s.Tile(y,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class Hc{constructor(o=0,u=0,m=0,y=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=m,this.right=y}interpolate(o,u,m){return u.top!=null&&o.top!=null&&(this.top=s.number(o.top,u.top,m)),u.bottom!=null&&o.bottom!=null&&(this.bottom=s.number(o.bottom,u.bottom,m)),u.left!=null&&o.left!=null&&(this.left=s.number(o.left,u.left,m)),u.right!=null&&o.right!=null&&(this.right=s.number(o.right,u.right,m)),this}getCenter(o,u){const m=s.clamp((this.left+o-this.right)/2,0,o),y=s.clamp((this.top+u-this.bottom)/2,0,u);return new s.Point(m,y)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Hc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Zc(d,o){const u=s.getColumn(d,3);s.fromQuat(d,o),s.setColumn(d,3,u)}function ar(d,o){const u=s.identity$1([]);return s.rotateZ$1(u,u,-o),s.rotateX$1(u,u,-d),u}function Nl(d,o){const u=[d[0],d[1],0],m=[o[0],o[1],0];if(s.length(u)>=1e-15){const A=s.normalize([],u);s.scale$2(m,A,s.dot(m,A)),o[0]=m[0],o[1]=m[1]}const y=s.cross([],o,d);if(s.len(y)<1e-15)return null;const v=Math.atan2(-y[1],y[0]);return ar(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}class Af{constructor(o,u){this.position=o,this.orientation=u}get position(){return this._position}set position(o){if(o){const u=o instanceof s.MercatorCoordinate?o:new s.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(u.x=s.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(o,u){if(this.orientation=null,!this.position)return;const m=this.position,y=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(o)):0,v=s.MercatorCoordinate.fromLngLat(o,y),A=[v.x-m.x,v.y-m.y,v.z-m.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Nl(A,u)}setPitchBearing(o,u){this.orientation=ar(s.degToRad(o),s.degToRad(-u))}}class Xc{constructor(o,u){this._transform=s.identity([]),this.orientation=u,this.position=o}get mercatorPosition(){const o=this.position;return new s.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=s.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var u;o&&s.setColumn(this._transform,3,[(u=o)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||s.identity$1([]),o&&Zc(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,u){this._orientation=ar(o,u),Zc(this._transform,this._orientation)}forward(){const o=s.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=s.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=s.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,u){const m=new Float64Array(16);return s.invert(m,this.getWorldToCamera(o,u)),m}getWorldToCameraPosition(o,u,m){const y=this.position;s.scale$2(y,y,-o);const v=new Float64Array(16);return s.fromScaling(v,[m,m,m]),s.translate(v,v,y),v[10]*=u,v}getWorldToCamera(o,u){const m=new Float64Array(16),y=new Float64Array(4),v=this.position;return s.conjugate(y,this._orientation),s.scale$2(v,v,-o),s.fromQuat(m,y),s.translate(m,m,v),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=u,m[9]*=u,m[10]*=u,m[11]*=u,m}getCameraToClipPerspective(o,u,m,y){const v=new Float64Array(16);return s.perspective(v,o,u,m,y),v}getDistanceToElevation(o,u=!1){const m=o===0?0:s.mercatorZfromAltitude(o,u?s.latFromMercatorY(this.position[1]):this.position[1]),y=this.forward();return(m-this.position[2])/y[2]}clone(){return new Xc([...this.position],[...this.orientation])}}function Ia(d,o){const u=Kc(d.projection,d.zoom,d.width,d.height),m=function(v,A,T,P,B){const R=new s.LngLat(T.lng-180*Ho,T.lat),W=new s.LngLat(T.lng+180*Ho,T.lat),Y=v.project(R.lng,R.lat),te=v.project(W.lng,W.lat),ne=-Math.atan2(te.y-Y.y,te.x-Y.x),re=s.MercatorCoordinate.fromLngLat(T);re.y=s.clamp(re.y,-1+Ho,1-Ho);const ie=re.toLngLat(),q=v.project(ie.lng,ie.lat),ee=s.MercatorCoordinate.fromLngLat(ie);ee.x+=Ho;const ae=ee.toLngLat(),ce=v.project(ae.lng,ae.lat),xe=Yc(ce.x-q.x,ce.y-q.y,ne),be=s.MercatorCoordinate.fromLngLat(ie);be.y+=Ho;const ve=be.toLngLat(),Ie=v.project(ve.lng,ve.lat),Ce=Yc(Ie.x-q.x,Ie.y-q.y,ne),Re=Math.abs(xe.x)/Math.abs(Ce.y),it=s.identity([]);s.rotateZ(it,it,-ne*(1-(B?0:P)));const ze=s.identity([]);return s.scale(ze,ze,[1,1-(1-Re)*P,1]),ze[4]=-Ce.x/Ce.y*P,s.rotateZ(ze,ze,ne),s.multiply(ze,it,ze),ze}(d.projection,0,d.center,u,o),y=Tf(d);return s.scale(m,m,[y,y,1]),m}function Tf(d){const o=d.projection,u=Kc(d.projection,d.zoom,d.width,d.height),m=Cf(o,d.center),y=Cf(o,s.LngLat.convert(o.center));return Math.pow(2,m*u+(1-u)*y)}function Kc(d,o,u,m,y=1/0){const v=d.range;if(!v)return 0;const A=Math.min(y,Math.max(u,m)),T=Math.log(A/1024)/Math.LN2;return s.smoothstep(v[0]+T,v[1]+T,o)}const Ho=1/4e4;function Cf(d,o){const u=s.clamp(o.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),m=new s.LngLat(o.lng-180*Ho,u),y=new s.LngLat(o.lng+180*Ho,u),v=d.project(m.lng,u),A=d.project(y.lng,u),T=s.MercatorCoordinate.fromLngLat(m),P=s.MercatorCoordinate.fromLngLat(y),B=A.x-v.x,R=A.y-v.y,W=P.x-T.x,Y=P.y-T.y,te=Math.sqrt((W*W+Y*Y)/(B*B+R*R));return Math.log(te)/Math.LN2}function Yc(d,o,u){const m=Math.cos(u),y=Math.sin(u);return{x:d*m-o*y,y:d*y+o*m}}class ka{constructor(o,u,m,y,v,A,T){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=o||0,this._maxZoom=u||22,this._minPitch=m??0,this._maxPitch=y??60,this.setProjection(A),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Hc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Xc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const o=new ka(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o,u=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(o||m)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const m=!S(u,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const u=o!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const u=-o*Math.PI/180;var m;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(m=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(y,v,A){var T=v[0],P=v[1],B=v[2],R=v[3],W=Math.sin(A),Y=Math.cos(A);y[0]=T*Y+B*W,y[1]=P*Y+R*W,y[2]=T*-W+B*Y,y[3]=P*-W+R*Y}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const u=s.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=s.degToRad(o),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const u=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let y=0,v=0;for(let A=0;A<u.length;A++){const T=new s.Point(u[A][0]*this.width,m+u[A][1]*(this.height-m)),P=o.pointCoordinate(T);if(!P)continue;const B=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);y+=P[3]*B,v+=B}return v===0?NaN:y/v}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*u,y=this._mercatorZfromZoom(o),v=this._mercatorZfromZoom(this._maxZoom),A=Math.max(y-m,v);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let m;m=o.z<this._camera.position[2]?[u.x,u.y,u.z]:[o.x,o.y,o.z];const y=s.length(s.sub([],this._camera.position,m));return s.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let u=!1;if(o.orientation&&!s.exactEquals(o.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(o.orientation)),o.position){const m=[o.position.x,o.position.y,o.position.z];s.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,u=new Af;return u.position=new s.MercatorCoordinate(o[0],o[1],o[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(o){if(!s.length$1(o))return!1;s.normalize$1(o,o);const u=s.transformQuat([],[0,0,-1],o),m=s.transformQuat([],[0,-1,0],o);if(m[2]<0)return!1;const y=Nl(u,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(o){const u=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;o[2]=s.clamp(o[2],y/m,y/u),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,m){this._unmodified=!1,this._edgeInsets.interpolate(o,u,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const u=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(o){const u=[new s.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const m=this.pointCoordinate(new s.Point(0,0)),y=this.pointCoordinate(new s.Point(this.width,0)),v=this.pointCoordinate(new s.Point(this.width,this.height)),A=this.pointCoordinate(new s.Point(0,this.height)),T=Math.floor(Math.min(m.x,y.x,v.x,A.x)),P=Math.floor(Math.max(m.x,y.x,v.x,A.x)),B=1;for(let R=T-B;R<=P+B;R++)R!==0&&u.push(new s.UnwrappedTileID(R,o))}return u}coveringTiles(o){let u=this.coveringZoomLevel(o);const m=u,y=this.elevation&&!o.isTerrainDEM,v=this.projection.name==="mercator";if(o.minzoom!==void 0&&u<o.minzoom)return[];o.maxzoom!==void 0&&u>o.maxzoom&&(u=o.maxzoom);const A=this.locationCoordinate(this.center),T=this.center.lat,P=1<<u,B=[P*A.x,P*A.y,0],R=this.projection.name==="globe",W=!R,Y=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,W),te=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ne=P*s.mercatorZfromAltitude(1,this.center.lat),re=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),ie=[P*te.x,P*te.y,re*(W?1:ne)],q=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),ee=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,ae=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ce=o.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,xe=this.projection.isReprojectedInTileSpace?Tf(this):1,be=Me=>{const at=new s.MercatorCoordinate(Me.x+25e-6,Me.y,Me.z),Qe=new s.MercatorCoordinate(Me.x,Me.y+25e-6,Me.z),lt=Me.toLngLat(),kt=at.toLngLat(),Nt=Qe.toLngLat(),At=this.locationCoordinate(lt),Bt=this.locationCoordinate(kt),er=this.locationCoordinate(Nt),Yt=Math.hypot(Bt.x-At.x,Bt.y-At.y),It=Math.hypot(er.x-At.x,er.y-At.y);return Math.sqrt(Yt*It)*xe/25e-6},ve=Me=>{const He=ae,at=ce;return{aabb:s.tileAABB(this,P,0,0,0,Me,at,He,this.projection),zoom:0,x:0,y:0,minZ:at,maxZ:He,wrap:Me,fullyVisible:!1}},Ie=[];let Ce=[];const Re=u,it=o.reparseOverscaled?m:u,ze=Me=>Me*Me,Ze=ze((re-this._centerAltitude)*ne),Fe=Me=>{if(!this._elevation||!Me.tileID||!v)return;const He=this._elevation.getMinMaxForTile(Me.tileID),at=Me.aabb;He?(at.min[2]=He.min,at.max[2]=He.max,at.center[2]=(at.min[2]+at.max[2])/2):(Me.shouldSplit=nt(Me),Me.shouldSplit||(at.min[2]=at.max[2]=at.center[2]=this._centerAltitude))},nt=Me=>{if(Me.zoom<ee)return!0;if(Me.zoom===Re)return!1;if(Me.shouldSplit!=null)return Me.shouldSplit;const He=Me.aabb.distanceX(ie),at=Me.aabb.distanceY(ie);let Qe=Ze,lt=1;if(R){Qe=ze(Me.aabb.distanceZ(ie));const At=Math.pow(2,Me.zoom),Bt=s.latFromMercatorY((Me.y+1)/At),er=s.latFromMercatorY(Me.y/At),Yt=Math.min(Math.max(T,Bt),er),It=s.circumferenceAtLatitude(Yt)/s.circumferenceAtLatitude(T);if(lt=Yt===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,It/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&Me.zoom===Re-1&&It>=.9)return!0}else if(y&&(Qe=ze(Me.aabb.distanceZ(ie)*ne)),this.projection.isReprojectedInTileSpace&&m<=5){const At=Math.pow(2,Me.zoom),Bt=be(new s.MercatorCoordinate((Me.x+.5)/At,(Me.y+.5)/At));lt=Bt>.85?1:Bt}const kt=He*He+at*at+Qe,Nt=ze((1<<Re-Me.zoom)*q*lt*((At,Bt)=>{if(Bt*ze(.707)<At)return 1;const er=Math.sqrt(Bt/At);return er/(1.4144271570014144+(Math.pow(1.1,er-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Qe,Ze),kt));return kt<Nt};if(this.renderWorldCopies)for(let Me=1;Me<=3;Me++)Ie.push(ve(-Me)),Ie.push(ve(Me));for(Ie.push(ve(0));Ie.length>0;){const Me=Ie.pop(),He=Me.x,at=Me.y;let Qe=Me.fullyVisible;if(!Qe){const lt=Me.aabb.intersects(Y);if(lt===0)continue;Qe=lt===2}if(Me.zoom!==Re&&nt(Me))for(let lt=0;lt<4;lt++){const kt=(He<<1)+lt%2,Nt=(at<<1)+(lt>>1),At={aabb:v?Me.aabb.quadrant(lt):s.tileAABB(this,P,Me.zoom+1,kt,Nt,Me.wrap,Me.minZ,Me.maxZ,this.projection),zoom:Me.zoom+1,x:kt,y:Nt,wrap:Me.wrap,fullyVisible:Qe,tileID:void 0,shouldSplit:void 0,minZ:Me.minZ,maxZ:Me.maxZ};y&&!R&&(At.tileID=new s.OverscaledTileID(Me.zoom+1===Re?it:Me.zoom+1,Me.wrap,Me.zoom+1,kt,Nt),Fe(At)),Ie.push(At)}else{const lt=Me.zoom===Re?it:Me.zoom;if(o.minzoom&&o.minzoom>lt)continue;const kt=B[0]-(.5+He+(Me.wrap<<Me.zoom))*(1<<u-Me.zoom),Nt=B[1]-.5-at,At=Me.tileID?Me.tileID:new s.OverscaledTileID(lt,Me.wrap,Me.zoom,He,at);Ce.push({tileID:At,distanceSq:kt*kt+Nt*Nt})}}if(this.fogCullDistSq){const Me=this.fogCullDistSq,He=this.horizonLineFromTop();Ce=Ce.filter(at=>{const Qe=[0,0,0,1],lt=[s.EXTENT,s.EXTENT,0,1],kt=this.calculateFogTileMatrix(at.tileID.toUnwrapped());s.transformMat4$1(Qe,Qe,kt),s.transformMat4$1(lt,lt,kt);const Nt=s.getAABBPointSquareDist(Qe,lt);if(Nt===0)return!0;let At=!1;const Bt=this._elevation;if(Bt&&Nt>Me&&He!==0){const er=this.calculateProjMatrix(at.tileID.toUnwrapped());let Yt;o.isTerrainDEM||(Yt=Bt.getMinMaxForTile(at.tileID)),Yt||(Yt={min:ce,max:ae});const It=s.furthestTileCorner(this.rotation),_r=[It[0]*s.EXTENT,It[1]*s.EXTENT,Yt.max];s.transformMat4(_r,_r,er),At=(1-_r[1])*this.height*.5<He}return Nt<Me||At})}return Ce.sort((Me,He)=>Me.distanceSq-He.distanceSq).map(Me=>Me.tileID)}resize(o,u){this.width=o,this.height=u,this.pixelsToGLUnits=[2/o,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const u=s.clamp(o.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),m=this.projection.project(o.lng,u);return new s.Point(m.x*this.worldSize,m.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,u){let m,y;const v=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;m=(u.x-v.x)/T,y=(u.y-v.y)/T}else{const T=this.pointCoordinate(u),P=this.pointCoordinate(v);m=T.x-P.x,y=T.y-P.y}const A=this.locationCoordinate(o);this.setLocation(new s.MercatorCoordinate(A.x-m,A.y-y))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,u){const m=u?s.mercatorZfromAltitude(u,o.lat):void 0,y=this.projection.project(o.lng,o.lat);return new s.MercatorCoordinate(y.x,y.y,m)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,u){const m=u??this._centerAltitude,y=[o.x,o.y,0,1],v=[o.x,o.y,1,1];s.transformMat4$1(y,y,this.pixelMatrixInverse),s.transformMat4$1(v,v,this.pixelMatrixInverse);const A=v[3];s.scale$1(y,y,1/y[3]),s.scale$1(v,v,1/A);const T=y[2],P=v[2];return{p0:y,p1:v,t:T===P?0:(m-T)/(P-T)}}screenPointToMercatorRay(o){const u=[o.x,o.y,0,1],m=[o.x,o.y,1,1];return s.transformMat4$1(u,u,this.pixelMatrixInverse),s.transformMat4$1(m,m,this.pixelMatrixInverse),s.scale$1(u,u,1/u[3]),s.scale$1(m,m,1/m[3]),u[2]=s.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,m[2]=s.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,s.scale$1(u,u,1/this.worldSize),s.scale$1(m,m,1/this.worldSize),new s.Ray([u[0],u[1],u[2]],s.normalize([],s.sub([],m,u)))}rayIntersectionCoordinate(o){const{p0:u,p1:m,t:y}=o,v=s.mercatorZfromAltitude(u[2],this._center.lat),A=s.mercatorZfromAltitude(m[2],this._center.lat);return new s.MercatorCoordinate(s.number(u[0],m[0],y)/this.worldSize,s.number(u[1],m[1],y)/this.worldSize,s.number(v,A,y))}pointCoordinate(o,u=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,u)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let u=this.projection.pointCoordinate3D(this,o.x,o.y);if(u)return new s.MercatorCoordinate(u[0],u[1],u[2]);let m=0,y=this.horizonLineFromTop();if(o.y>y)return this.pointCoordinate(o);const v=.02*y,A=o.clone();for(let T=0;T<10&&y-m>v;T++){A.y=s.number(m,y,.66);const P=this.projection.pointCoordinate3D(this,A.x,A.y);P?(y=A.y,u=P):m=A.y}return u?new s.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(o);const u=this.pointCoordinate(o);return u.y>=0&&u.y<=1}_coordinatePoint(o,u){const m=u&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,y=[o.x*this.worldSize,o.y*this.worldSize,m+o.toAltitude(),1];return s.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new s.Point(y[0]/y[3],y[1]/y[3]):new s.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:u}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,v=this.pointLocation3D(new s.Point(u,o)),A=this.pointLocation3D(new s.Point(y,o)),T=this.pointLocation3D(new s.Point(y,m)),P=this.pointLocation3D(new s.Point(u,m));let B=Math.min(v.lng,A.lng,T.lng,P.lng),R=Math.max(v.lng,A.lng,T.lng,P.lng),W=Math.min(v.lat,A.lat,T.lat,P.lat),Y=Math.max(v.lat,A.lat,T.lat,P.lat);const te=Math.pow(2,-this.zoom)/16*270,ne=this.projection.name==="globe"?1:4,re=(ie,q,ee,ae,ce)=>{const xe=(ie+ee)/2,be=(q+ae)/2,ve=new s.Point(xe,be),{lng:Ie,lat:Ce}=this.pointLocation3D(ve),Re=Math.max(0,B-Ie,W-Ce,Ie-R,Ce-Y);B=Math.min(B,Ie),R=Math.max(R,Ie),W=Math.min(W,Ce),Y=Math.max(Y,Ce),(ce<ne||Re>te)&&(re(ie,q,xe,be,ce+1),re(xe,be,ee,ae,ce+1))};if(re(u,o,y,o,1),re(y,o,y,m,1),re(y,m,u,m,1),re(u,m,u,o,1),this.projection.name==="globe"){const[ie,q]=s.polesInViewport(this);ie?(Y=90,R=180,B=-180):q&&(W=-90,R=180,B=-180)}return new s.LngLatBounds(new s.LngLat(B,W),new s.LngLat(R,Y))}_getBoundsRectangular(o,u){const{top:m,left:y}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,T=new s.Point(y,m),P=new s.Point(A,m),B=new s.Point(A,v),R=new s.Point(y,v);let W=this.pointCoordinate(T,o),Y=this.pointCoordinate(P,o);const te=this.pointCoordinate(B,u),ne=this.pointCoordinate(R,u),re=(ie,q)=>(q.y-ie.y)/(q.x-ie.x);return W.y>1&&Y.y>=0?W=new s.MercatorCoordinate((1-ne.y)/re(ne,W)+ne.x,1):W.y<0&&Y.y<=1&&(W=new s.MercatorCoordinate(-ne.y/re(ne,W)+ne.x,0)),Y.y>1&&W.y>=0?Y=new s.MercatorCoordinate((1-te.y)/re(te,Y)+te.x,1):Y.y<0&&W.y<=1&&(Y=new s.MercatorCoordinate(-te.y/re(te,Y)+te.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(W)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(te))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=o.visibleDemTiles.reduce((m,y)=>{if(y.dem){const v=y.dem.tree;m.min=Math.min(m.min,v.minimums[0]),m.max=Math.max(m.max,v.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*o.exaggeration(),u.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-u*(1-this._horizonShift);return o?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,u){return this.projection.createTileMatrix(this,u,o)}calculateDistanceTileData(o){const u=o.key,m=this._distanceTileDataCache;if(m[u])return m[u];const y=o.canonical,v=1/this.height,A=this.cameraWorldSize,T=A/this.zoomScale(y.z),P=(y.x+Math.pow(2,y.z)*o.wrap)*T,B=y.y*T,R=this.point;R.x*=A/this.worldSize,R.y*=A/this.worldSize;const W=this.angle,Y=Math.sin(-W),te=-Math.cos(-W);return m[u]={bearing:[Y,te],center:[(R.x-P)*v,(R.y-B)*v],scale:T/s.EXTENT*v},m[u]}calculateFogTileMatrix(o){const u=o.key,m=this._fogTileMatrixCache;if(m[u])return m[u];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return s.multiply(y,this.worldToFogMatrix,y),m[u]=new Float32Array(y),m[u]}calculateProjMatrix(o,u=!1){const m=o.key,y=u?this._alignedProjMatrixCache:this._projMatrixCache;if(y[m])return y[m];const v=this.calculatePosMatrix(o,this.worldSize);return s.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,v),y[m]=new Float32Array(v),y[m]}calculatePixelsToTileUnitsMatrix(o){const u=o.tileID.key,m=this._pixelsToTileUnitsCache;if(m[u])return m[u];const y=function(v,A){const{scale:T}=v.tileTransform,P=T*s.EXTENT/(v.tileSize*Math.pow(2,A.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return B=new Float32Array(4),Y=(R=A.inverseAdjustmentMatrix)[1],te=R[2],ne=R[3],ie=(W=[P,P])[1],B[0]=R[0]*(re=W[0]),B[1]=Y*re,B[2]=te*ie,B[3]=ne*ie,B;var B,R,W,Y,te,ne,re,ie}(o,this);return m[u]=y,m[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,u=s.fromScaling([],[o,o,o]);return s.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const u=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),y=this._camera.forward(),v=s.mercatorZfromAltitude(1,this._center.lat);m[2]/=v,y[2]/=v,s.normalize(y,y);const A=o.raycast(m,y,o.exaggeration());if(A){const T=s.scaleAndAdd([],m,y,A),P=new s.MercatorCoordinate(T[0],T[1],s.mercatorZfromAltitude(T[2],s.latFromMercatorY(T[1]))),B=(P.z+s.length([P.x-m[0],P.y-m[1],P.z-m[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const u=this._elevation,m=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(m),v=u.getAtPointOrZero(new s.MercatorCoordinate(...y)),A=this.pixelsPerMeter/this.worldSize*v,T=this._minimumHeightOverTerrain(),P=y[2]-A;if(P<=T)if(P<0||o){const B=this.locationCoordinate(this._center,this._centerAltitude),R=[y[0],y[1],B.z-y[2]],W=s.length(R);R[2]-=(T-P)/this._pixelsPerMercatorPixel;const Y=s.length(R);if(Y===0)return;s.scale$2(R,R,W/Y*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],B.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const Y=this.center;return Y.lat=s.clamp(Y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(Y.lng=s.clamp(Y.lng,this.minLng,this.maxLng)),this.center=Y,void(this._constraining=!1)}const u=this._unmodified,{x:m,y}=this.point;let v=0,A=m,T=y;const P=this.width/2,B=this.height/2,R=this.worldMinY*this.scale,W=this.worldMaxY*this.scale;if(y-B<R&&(T=R+B),y+B>W&&(T=W-B),W-R<this.height&&(v=Math.max(v,this.height/(W-R)),T=(W+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Y=this.worldMinX*this.scale,te=this.worldMaxX*this.scale,ne=this.worldSize/2-(Y+te)/2;A=(m+ne+this.worldSize)%this.worldSize-ne,A-P<Y&&(A=Y+P),A+P>te&&(A=te-P),te-Y<this.width&&(v=Math.max(v,this.width/(te-Y)),A=(te+Y)/2)}A===m&&T===y||(this.center=this.unproject(new s.Point(A,T))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const m=Kc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?u:1,v=this._camera.getWorldToCamera(this.worldSize,y),A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);A[8]=2*-o.x/this.width,A[9]=2*o.y/this.height;let T=s.mul([],A,v);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),ve=s.identity([]);s.translate(ve,ve,[be.x*this.worldSize,be.y*this.worldSize,0]),s.multiply(ve,ve,Ia(this)),s.translate(ve,ve,[-be.x*this.worldSize,-be.y*this.worldSize,0]),s.multiply(T,T,ve),this.inverseAdjustmentMatrix=function(Ie){const Ce=Ia(Ie,!0);return Se([],[Ce[0],Ce[1],Ce[4],Ce[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],T,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=T,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const P=s.invert([],A);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const B=new Float32Array(16);s.identity(B),s.scale(B,B,[1,-1,1]),s.rotateX(B,B,this._pitch),s.rotateZ(B,B,this.angle);const R=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),W=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;R[8]=2*-o.x/this.width,R[9]=2*(o.y+W)/this.height,this.skyboxMatrix=s.multiply(B,R,B);const Y=this.point,te=Y.x,ne=Y.y,re=this.width%2/2,ie=this.height%2/2,q=Math.cos(this.angle),ee=Math.sin(this.angle),ae=te-Math.round(te)+q*re+ee*ie,ce=ne-Math.round(ne)+q*ie+ee*re,xe=new Float64Array(T);if(s.translate(xe,xe,[ae>.5?ae-1:ae,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=xe,T=s.create(),s.scale(T,T,[this.width/2,-this.height/2,1]),s.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=s.create(),s.scale(T,T,[1,-1,1]),s.translate(T,T,[-1,-1,0]),s.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=s.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=T,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(be,be,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=T;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,v=[o,o,u];s.scale$2(v,v,y),s.scale$2(m,m,-1),s.multiply$2(m,m,v);const A=s.create();s.translate(A,A,m),s.scale(A,A,v),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,u,y)}_computeCameraPosition(o){const u=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),y=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-o/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-m[0]*v,y.y/this.worldSize-m[1]*v,o/this.worldSize*this._centerAltitude-m[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],y=o[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(v=Math.min((u-m)/y,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,o,v),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,u=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),v=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),T=Math.max((o[2]-v)/Math.cos(m),A),P=this._zoomFromMercatorZ(T);s.scaleAndAdd(o,o,u,T),this._pitch=s.clamp(m,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(y,-Math.PI,Math.PI),this._setZoom(s.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let u=0,m=s.GLOBE_ZOOM_THRESHOLD_MAX,y=0,v=1/0;for(;m-u>1e-6&&m>u;){const A=u+.5*(m-u),T=this.tileSize*Math.pow(2,A),P=this.getCameraToCenterDistance(this.projection,A,T),B=this.scaleZoom(P/(o*this.tileSize)),R=Math.abs(A-B);R<v&&(v=R,y=A),A<B?u=A:m=A}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,u){const m=Math.min(o.x,u.x),y=Math.max(o.x,u.x),v=Math.min(o.y,u.y),A=Math.max(o.y,u.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new s.Point(m,v),new s.Point(y,A),new s.Point(m,A),new s.Point(y,v)],P=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const R of T){const W=this.pointRayIntersection(R);if(W.t<0)return!0;const Y=this.rayIntersectionCoordinate(W);if(Y.x<P||Y.y<0||Y.x>B||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.Point(0,0),new s.Point(this.width,this.height))}zoomDeltaToMovement(o,u){const m=s.length(s.sub([],this._camera.position,o)),y=this._zoomFromMercatorZ(m)+u;return m-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([u,m,y],v){const A=[u,m,y,1];s.transformMat4$1(A,A,v);const T=A[3]=Math.max(A[3],1e-6);return A[0]/=T,A[1]/=T,A[2]/=T,A}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.Point(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,o))}}getCameraToCenterDistance(o,u=this.zoom,m=this.worldSize){const y=Kc(o,u,this.width,this.height,1024),v=o.pixelSpaceConversion(this.center.lat,m,y);return .5/Math.tan(.5*this._fov)*this.height*v}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(o,o,this.globeMatrix),o}}function Pa(d,o){let u=!1,m=null;const y=()=>{m=null,u&&(d(),m=setTimeout(y,o),u=!1)};return()=>(u=!0,m||y(),m)}class Yh{constructor(o){this._hashName=o&&encodeURIComponent(o),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Pa(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,s.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const u=Ul(o);if(this._hashName){const m=this._hashName;let y=!1;const v=s.window.location.hash.slice(1).split("&").map(A=>{const T=A.split("=")[0];return T===m?(y=!0,`${T}=${u}`):A}).filter(A=>A);return y||v.push(`${m}=${u}`),`#${v.join("&")}`}return`#${u}`}_getCurrentHash(){const o=s.window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(u=m)}),(u&&u[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(m=>isNaN(m))){const m=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(u[3]||0):o.getBearing();return o.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:m,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,o)}}function Ul(d,o){const u=d.getCenter(),m=Math.round(100*d.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),A=Math.round(u.lng*v)/v,T=Math.round(u.lat*v)/v,P=d.getBearing(),B=d.getPitch();let R=o?`/${A}/${T}/${m}`:`${m}/${T}/${A}`;return(P||B)&&(R+="/"+Math.round(10*P)/10),B&&(R+=`/${Math.round(B)}`),R}const Vl={linearity:.3,easing:s.bezier(0,0,.3,1)},Jc=s.extend({deceleration:2500,maxSpeed:1400},Vl),Qc=s.extend({deceleration:20,maxSpeed:1400},Vl),bt=s.extend({deceleration:1e3,maxSpeed:360},Vl),eo=s.extend({deceleration:1e3,maxSpeed:90},Vl);class If{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,u=s.exported.now();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)u.zoom+=v.zoomDelta||0,u.bearing+=v.bearingDelta||0,u.pitch+=v.pitchDelta||0,v.panDelta&&u.pan._add(v.panDelta),v.around&&(u.around=v.around),v.pinchAround&&(u.pinchAround=v.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(u.pan.mag()){const v=$l(u.pan.mag(),m,s.extend({},Jc,o||{}));y.offset=u.pan.mult(v.amount/u.pan.mag()),y.center=this._map.transform.center,jl(y,v)}if(u.zoom){const v=$l(u.zoom,m,Qc);y.zoom=this._map.transform.zoom+v.amount,jl(y,v)}if(u.bearing){const v=$l(u.bearing,m,bt);y.bearing=this._map.transform.bearing+s.clamp(v.amount,-179,179),jl(y,v)}if(u.pitch){const v=$l(u.pitch,m,eo);y.pitch=this._map.transform.pitch+v.amount,jl(y,v)}if(y.zoom||y.bearing){const v=u.pinchAround===void 0?u.around:u.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function jl(d,o){(!d.duration||d.duration<o.duration)&&(d.duration=o.duration,d.easing=o.easing)}function $l(d,o,u){const{maxSpeed:m,linearity:y,deceleration:v}=u,A=s.clamp(d*y/(o/1e3),-m,m),T=Math.abs(A)/(v*y);return{easing:u.easing,duration:1e3*T,amount:A*(T/2)}}class zn extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,m,y={}){const v=le(u.getCanvasContainer(),m),A=u.unproject(v);super(o,s.extend({point:v,lngLat:A,originalEvent:m},y)),this._defaultPrevented=!1,this.target=u}}class Wl extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,m){const y=o==="touchend"?m.changedTouches:m.touches,v=pe(u.getCanvasContainer(),y),A=v.map(P=>u.unproject(P)),T=v.reduce((P,B,R,W)=>P.add(B.div(W.length)),new s.Point(0,0));super(o,{points:v,point:T,lngLats:A,lngLat:u.unproject(T),originalEvent:m}),this._defaultPrevented=!1}}class eu extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,m){super(o,{originalEvent:m}),this._defaultPrevented=!1}}class Jh{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new eu(o.type,this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new zn(o.type,this._map,o))}mouseup(o){this._map.fire(new zn(o.type,this._map,o))}preclick(o){const u=s.extend({},o);u.type="preclick",this._map.fire(new zn(u.type,this._map,u))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(o),this._map.fire(new zn(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new zn(o.type,this._map,o))}mouseover(o){this._map.fire(new zn(o.type,this._map,o))}mouseout(o){this._map.fire(new zn(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Wl(o.type,this._map,o))}touchmove(o){this._map.fire(new Wl(o.type,this._map,o))}touchend(o){this._map.fire(new Wl(o.type,this._map,o))}touchcancel(o){this._map.fire(new Wl(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tu{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new zn(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new zn(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kf{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&o.button===0&&(Z(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;const m=u,y=this._startPos,v=this._lastPos;if(!y||!v||v.equals(m)||!this._box&&m.dist(y)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=L("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const A=Math.min(y.x,m.x),T=Math.max(y.x,m.x),P=Math.min(y.y,m.y),B=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${P}px)`,this._box.style.width=T-A+"px",this._box.style.height=B-P+"px")})}mouseupWindow(o,u){if(!this._active)return;const m=this._startPos,y=u;if(m&&o.button===0){if(this.reset(),J(),m.x!==y.x||m.y!==y.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:v=>v.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),U(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new s.Event(o,{originalEvent:u}))}}function ru(d,o){const u={};for(let m=0;m<d.length;m++)u[d[m].identifier]=o[m];return u}class za{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,u,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const v=new s.Point(0,0);for(const A of y)v._add(A);return v.div(y.length)}(u),this.touches=ru(m,u)))}touchmove(o,u,m){if(this.aborted||!this.centroid)return;const y=ru(m,u);for(const v in this.touches){const A=y[v];(!A||A.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(o,u,m){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Qh{constructor(o){this.singleTap=new za(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,u,m){this.singleTap.touchstart(o,u,m)}touchmove(o,u,m){this.singleTap.touchmove(o,u,m)}touchend(o,u,m){const y=this.singleTap.touchend(o,u,m);if(y){const v=o.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(y)<30;if(v&&A||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class u_{constructor(){this._zoomIn=new Qh({numTouches:1,numTaps:2}),this._zoomOut=new Qh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,m){this._zoomIn.touchstart(o,u,m),this._zoomOut.touchstart(o,u,m)}touchmove(o,u,m){this._zoomIn.touchmove(o,u,m),this._zoomOut.touchmove(o,u,m)}touchend(o,u,m){const y=this._zoomIn.touchend(o,u,m),v=this._zoomOut.touchend(o,u,m);return y?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(y)},{originalEvent:o})}):v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(v)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Pf={0:1,2:2};class Da{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,u){return!1}_move(o,u){return{}}mousedown(o,u){if(this._lastPoint)return;const m=ye(o);this._correctButton(o,m)&&(this._lastPoint=u,this._eventButton=m)}mousemoveWindow(o,u){const m=this._lastPoint;if(m){if(o.preventDefault(),this._eventButton!=null&&function(y,v){const A=Pf[v];return y.buttons===void 0||(y.buttons&A)!==A}(o,this._eventButton))this.reset();else if(this._moved||!(u.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(m,u)}}mouseupWindow(o){this._lastPoint&&ye(o)===this._eventButton&&(this._moved&&J(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ed extends Da{mousedown(o,u){super.mousedown(o,u),this._lastPoint&&(this._active=!0)}_correctButton(o,u){return u===0&&!o.ctrlKey}_move(o,u){return{around:u,panDelta:u.sub(o)}}}class td extends Da{_correctButton(o,u){return u===0&&o.ctrlKey||u===2}_move(o,u){const m=.8*(u.x-o.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(o){o.preventDefault()}}class rd extends Da{_correctButton(o,u){return u===0&&o.ctrlKey||u===2}_move(o,u){const m=-.5*(u.y-o.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(o){o.preventDefault()}}class nu{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)}touchstart(o,u,m){return this._calculateTransform(o,u,m)}touchmove(o,u,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,u,m)}}touchend(o,u,m){this._calculateTransform(o,u,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,m){m.length>0&&(this._active=!0);const y=ru(m,u),v=new s.Point(0,0),A=new s.Point(0,0);let T=0;for(const B in y){const R=y[B],W=this._touches[B];W&&(v._add(R),A._add(R.sub(W)),T++,y[B]=R)}if(this._touches=y,T<this._minTouches||!A.mag())return;const P=A.div(T);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(T),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ql{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,u,m){return{}}touchstart(o,u,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,m){const y=this._firstTwoTouches;if(!y)return;o.preventDefault();const[v,A]=y,T=Gl(m,u,v),P=Gl(m,u,A);if(!T||!P)return;const B=this._aroundCenter?null:T.add(P).div(2);return this._move([T,P],B,o)}touchend(o,u,m){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,A=Gl(m,u,y),T=Gl(m,u,v);A&&T||(this._active&&J(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Gl(d,o,u){for(let m=0;m<d.length;m++)if(d[m].identifier===u)return o[m]}function nd(d,o){return Math.log(d/o)/Math.LN2}class zf extends ql{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){const m=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(nd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:nd(this._distance,m),pinchAround:u}}}function id(d,o){return 180*d.angleWith(o)/Math.PI}class Df extends ql{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u){const m=this._vector;if(this._vector=o[0].sub(o[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:id(this._vector,m),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const u=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const y=id(o,m);return Math.abs(y)<u}}function _s(d){return Math.abs(d.y)>Math.abs(d.x)}class Mf extends ql{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,_s(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,m){const y=this._lastPoints;if(!y)return;const v=o[0].sub(y[0]),A=o[1].sub(y[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(v,A,m.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(v.y+A.y)/2*-.5})}gestureBeginsVertically(o,u,m){if(this._valid!==void 0)return this._valid;const y=o.mag()>=2,v=u.mag()>=2;if(!y&&!v)return;if(!y||!v)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const A=o.y>0==u.y>0;return _s(o)&&_s(u)&&A}}const Rf={panStep:100,bearingStep:15,pitchStep:10};class h_{constructor(){const o=Rf;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,m=0,y=0,v=0,A=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?m=-1:(o.preventDefault(),v=-1);break;case 39:o.shiftKey?m=1:(o.preventDefault(),v=1);break;case 38:o.shiftKey?y=1:(o.preventDefault(),A=-1);break;case 40:o.shiftKey?y=-1:(o.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:T=>{const P=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:Bf,zoom:u?Math.round(P)+u*(o.shiftKey?2:1):P,bearing:T.getBearing()+m*this._bearingStep,pitch:T.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-A*this._panStep],center:T.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bf(d){return d*(2-d)}const od=4.000244140625;class Lf{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=o.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const m=s.exported.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,u!==0&&u%od==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(y*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=le(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>od?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&B!==0&&(B=1/B);const R=u(),W=Math.pow(2,R),Y=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):W;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(Y*B))),this._type==="wheel"&&(this._startZoom=R,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:u(),y=this._startZoom,v=this._easing;let A,T=!1;if(this._type==="wheel"&&y&&v){const P=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),B=v(P);A=s.number(y,m,B),P<1?this._frameId||(this._frameId=!0):T=!0}else A=m,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:A-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=s.ease;if(this._prevEase){const m=this._prevEase,y=(s.exported.now()-m.start)/m.duration,v=m.easing(y+.01)-m.easing(y),A=.27/Math.sqrt(v*v+1e-4)*.01,T=Math.sqrt(.0729-A*A);u=s.bezier(A,T,.25,1)}return this._prevEase={start:s.exported.now(),duration:o,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Ff{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Hn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,u){return o.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(o.shiftKey?-1:1),around:m.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class d_{constructor(){this._tap=new Qh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,u,m){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=u[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(o,u,m))}touchmove(o,u,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=u[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,o.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(o,u,m)}touchend(o,u,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(o,u,m)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Of{constructor(o,u,m){this._el=o,this._mousePan=u,this._touchPan=m}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class p_{constructor(o,u,m){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=u,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class f_{constructor(o,u,m,y){this._el=o,this._touchZoom=u,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Bi=d=>d.zoom||d.drag||d.pitch||d.rotate;class Nf extends s.Event{}class m_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,u){const m=s.sub([],u,o);this.radius=s.length(m[2]<0?s.div([],m,this.constants):[m[0],m[1],0])}projectRay(o){s.div(o,o,this.constants),s.normalize(o,o),s.mul$1(o,o,this.constants);const u=s.scale$2([],o,this.radius);if(u[2]>0){const m=s.scale$2([],[0,0,1],s.dot(u,[0,0,1])),y=s.scale$2([],s.normalize([],[u[0],u[1],0]),this.radius),v=s.add([],u,s.scale$2([],s.sub([],s.add([],y,m),u),2));u[0]=v[0],u[1]=v[1]}return u}}function to(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Eo{constructor(o,u){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new If(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new m_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),s.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[y,v,A]of this._listeners)y.addEventListener(v,y===s.window.document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[o,u,m]of this._listeners)o.removeEventListener(u,o===s.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(o){const u=this._map,m=u.getCanvasContainer();this._add("mapEvent",new Jh(u,o));const y=u.boxZoom=new kf(u,o);this._add("boxZoom",y);const v=new u_,A=new Hn;u.doubleClickZoom=new Ff(A,v),this._add("tapZoom",v),this._add("clickZoom",A);const T=new d_;this._add("tapDragZoom",T);const P=u.touchPitch=new Mf(u);this._add("touchPitch",P);const B=new td(o),R=new rd(o);u.dragRotate=new p_(o,B,R),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const W=new ed(o),Y=new nu(u,o);u.dragPan=new Of(m,W,Y),this._add("mousePan",W),this._add("touchPan",Y,["touchZoom","touchRotate"]);const te=new Df,ne=new zf;u.touchZoomRotate=new f_(m,ne,te,T),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),this._add("blockableMapEvent",new tu(u));const re=u.scrollZoom=new Lf(u,this);this._add("scrollZoom",re,["mousePan"]);const ie=u.keyboard=new h_;this._add("keyboard",ie);for(const q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[q]&&u[q].enable(o[q])}_add(o,u,m){this._handlers.push({handlerName:o,handler:u,allowed:m}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bi(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,u,m){for(const y in o)if(y!==m&&(!u||u.indexOf(y)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const u=[];for(const m of o)this._el.contains(m.target)&&u.push(m);return u}handleEvent(o,u){this._updatingCamera=!0;const m=o.type==="renderFrame",y=m?void 0:o,v={needsRenderFrame:!1},A={},T={},P=o.touches?this._getMapTouches(o.touches):void 0,B=P?pe(this._el,P):m?void 0:le(this._el,o);for(const{handlerName:Y,handler:te,allowed:ne}of this._handlers){if(!te.isEnabled())continue;let re;this._blockedByActive(T,ne,Y)?te.reset():te[u||o.type]&&(re=te[u||o.type](o,B,P),this.mergeHandlerResult(v,A,re,Y,y),re&&re.needsRenderFrame&&this._triggerRenderFrame()),(re||te.isActive())&&(T[Y]=te)}const R={};for(const Y in this._previousActiveHandlers)T[Y]||(R[Y]=y);this._previousActiveHandlers=T,(Object.keys(R).length||to(v))&&(this._changes.push([v,A,R]),this._triggerRenderFrame()),(Object.keys(T).length||to(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=v;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))}mergeHandlerResult(o,u,m,y,v){if(!m)return;s.extend(o,m);const A={handlerName:y,originalEvent:m.originalEvent||v};m.zoomDelta!==void 0&&(u.zoom=A),m.panDelta!==void 0&&(u.drag=A),m.pitchDelta!==void 0&&(u.pitch=A),m.bearingDelta!==void 0&&(u.rotate=A)}_applyChanges(){const o={},u={},m={};for(const[y,v,A]of this._changes)y.panDelta&&(o.panDelta=(o.panDelta||new s.Point(0,0))._add(y.panDelta)),y.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(o.around=y.around),y.aroundCoord!==void 0&&(o.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(o.pinchAround=y.pinchAround),y.noInertia&&(o.noInertia=y.noInertia),s.extend(u,v),s.extend(m,A);this._updateMapTransform(o,u,m),this._changes=[]}_updateMapTransform(o,u,m){const y=this._map,v=y.transform,A=ee=>[ee.x,ee.y,ee.z];if((ee=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!to(o)){const ee=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",ee!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&y._stop(!0),!to(o))return void this._fireEvents(u,m,!0);let{panDelta:T,zoomDelta:P,bearingDelta:B,pitchDelta:R,around:W,aroundCoord:Y,pinchAround:te}=o;v._isCameraConstrained&&(P>0&&(P=0),v._isCameraConstrained=!1),te!==void 0&&(W=te),(P||(ee=>u[ee]&&!this._eventsInProgress[ee])("drag"))&&W&&(this._dragOrigin=A(v.pointCoordinate3D(W)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),W=W||y.transform.centerPoint,B&&(v.bearing+=B),R&&(v.pitch+=R),v._updateCameraState();const ne=[0,0,0];if(T)if(v.projection.name==="mercator"){const ee=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(W).dir),ae=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(W.sub(T)).dir);ne[0]=ae[0]-ee[0],ne[1]=ae[1]-ee[1]}else{const ee=v.pointCoordinate(W);if(v.projection.name==="globe"){T=T.rotate(-v.angle);const ae=v._pixelsPerMercatorPixel/v.worldSize;ne[0]=-T.x*s.mercatorScale(s.latFromMercatorY(ee.y))*ae,ne[1]=-T.y*s.mercatorScale(v.center.lat)*ae}else{const ae=v.pointCoordinate(W.sub(T));ee&&ae&&(ne[0]=ae.x-ee.x,ne[1]=ae.y-ee.y)}}const re=v.zoom,ie=[0,0,0];if(P){const ee=A(Y||v.pointCoordinate3D(W)),ae={dir:s.normalize([],s.sub([],ee,v._camera.position))};if(ae.dir[2]<0){const ce=v.zoomDeltaToMovement(ee,P);s.scale$2(ie,ae.dir,ce)}}const q=s.add(ne,ne,ie);v._translateCameraConstrained(q),P&&Math.abs(v.zoom-re)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,m,!0)}_fireEvents(o,u,m){const y=Bi(this._eventsInProgress),v=Bi(o),A={};for(const R in o){const{originalEvent:W}=o[R];this._eventsInProgress[R]||(A[`${R}start`]=W),this._eventsInProgress[R]=o[R]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const R in A)this._fireEvent(R,A[R]);v&&this._fireEvent("move",v.originalEvent);for(const R in o){const{originalEvent:W}=o[R];this._fireEvent(R,W)}const T={};let P;for(const R in this._eventsInProgress){const{handlerName:W,originalEvent:Y}=this._eventsInProgress[R];this._handlersById[W].isActive()||(delete this._eventsInProgress[R],P=u[W]||Y,T[`${R}end`]=P)}for(const R in T)this._fireEvent(R,T[R]);const B=Bi(this._eventsInProgress);if(m&&(y||v)&&!B){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;R?(W(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:P})):(this._map.fire(new s.Event("moveend",{originalEvent:P})),W(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new s.Event(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Nf("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Gs="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class iu extends s.Evented{constructor(o,u){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}panBy(o,u,m){return o=s.Point.convert(o).mult(-1),this.panTo(this.transform.center,s.extend({offset:o},u),m)}panTo(o,u,m){return this.easeTo(s.extend({center:o},u),m)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,m){return this.easeTo(s.extend({zoom:o},u),m)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,m){return this.easeTo(s.extend({bearing:o},u),m)}resetNorth(o,u){return this.rotateTo(0,s.extend({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}cameraForBounds(o,u){o=s.LngLatBounds.convert(o);const m=u&&u.bearing||0,y=u&&u.pitch||0,v=o.getNorthWest(),A=o.getSouthEast();return this._cameraForBounds(this.transform,v,A,m,y,u)}_extendCameraOptions(o){const u={top:0,bottom:0,right:0,left:0};if(typeof(o=s.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const m=o.padding;o.padding={top:m,bottom:m,right:m,left:m}}return o.padding=s.extend(u,o.padding),o}_minimumAABBFrustumDistance(o,u){const m=u.max[0]-u.min[0],y=u.max[1]-u.min[1];return m/y>o.aspect?m/(2*Math.tan(.5*o.fovX)*o.aspect):y/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,u,m,y,v,A){const T=o.clone(),P=this._extendCameraOptions(A);T.bearing=y,T.pitch=v;const B=s.LngLat.convert(u),R=s.LngLat.convert(m),W=.5*(B.lat+R.lat),Y=.5*(B.lng+R.lng),te=s.latLngToECEF(W,Y),ne=s.normalize([],te),re=s.normalize([],s.cross([],ne,[0,1,0])),ie=s.cross([],re,ne),q=[re[0],re[1],re[2],0,ie[0],ie[1],ie[2],0,ne[0],ne[1],ne[2],0,0,0,0,1],ee=[te,s.latLngToECEF(B.lat,B.lng),s.latLngToECEF(R.lat,B.lng),s.latLngToECEF(R.lat,R.lng),s.latLngToECEF(B.lat,R.lng),s.latLngToECEF(W,B.lng),s.latLngToECEF(W,R.lng),s.latLngToECEF(B.lat,Y),s.latLngToECEF(R.lat,Y)];let ae=s.Aabb.fromPoints(ee.map(Qe=>[s.dot(re,Qe),s.dot(ie,Qe),s.dot(ne,Qe)]));const ce=s.transformMat4([],ae.center,q);s.squaredLength(ce)===0&&s.set(ce,0,0,1),s.normalize(ce,ce),s.scale$2(ce,ce,s.GLOBE_RADIUS),T.center=s.ecefToLatLng(ce);const xe=T.getWorldToCameraMatrix(),be=s.invert(new Float64Array(16),xe);ae=s.Aabb.applyTransform(ae,s.multiply([],xe,q)),s.transformMat4(ce,ce,xe);const ve=.5*(ae.max[2]-ae.min[2]),Ie=this._minimumAABBFrustumDistance(T,ae),Ce=s.scale$2([],[0,0,1],ve),Re=s.add(Ce,ce,Ce),it=Ie+(T.pitch===0?0:s.distance(ce,Re)),ze=T.globeCenterInViewSpace,Ze=s.sub([],ce,[ze[0],ze[1],ze[2]]);s.normalize(Ze,Ze),s.scale$2(Ze,Ze,it);const Fe=s.add([],ce,Ze);s.transformMat4(Fe,Fe,be);const nt=s.earthRadius/s.GLOBE_RADIUS,Me=s.length(Fe),He=s.mercatorZfromAltitude(Math.max(Me*nt-s.earthRadius,Number.EPSILON),0),at=Math.min(T.zoomFromMercatorZAdjusted(He),P.maxZoom);return at>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(T.setProjection({name:"mercator"}),T.zoom=at,this._cameraForBounds(T,u,m,y,v,A)):{center:T.center,zoom:at,bearing:y,pitch:v}}queryTerrainElevation(o,u){const m=this.transform.elevation;return m?(u=s.extend({},{exaggerated:!0},u),m.getAtPoint(s.MercatorCoordinate.fromLngLat(o),null,u.exaggerated)):null}_cameraForBounds(o,u,m,y,v,A){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,u,m,y,v,A);const T=o.clone(),P=this._extendCameraOptions(A),B=T.padding;T.bearing=y,T.pitch=v;const R=s.LngLat.convert(u),W=s.LngLat.convert(m),Y=new s.LngLat(R.lng,W.lat),te=new s.LngLat(W.lng,R.lat),ne=T.project(R),re=T.project(W),ie=this.queryTerrainElevation(R),q=this.queryTerrainElevation(W),ee=this.queryTerrainElevation(Y),ae=this.queryTerrainElevation(te),ce=[[ne.x,ne.y,Math.min(ie||0,q||0,ee||0,ae||0)],[re.x,re.y,Math.max(ie||0,q||0,ee||0,ae||0)]];let xe=s.Aabb.fromPoints(ce);const be=T.getWorldToCameraMatrix(),ve=s.invert(new Float64Array(16),be);xe=s.Aabb.applyTransform(xe,be);const Ie=s.sub([],xe.max,xe.min),Ce=B.left||0,Re=B.right||0,it=B.bottom||0,ze=B.top||0,{left:Ze,right:Fe,top:nt,bottom:Me}=P.padding,He=.5*(Ce+Re),at=.5*(ze+it),Qe=Math.min(T.scaleZoom(T.scale*Math.min((T.width-(Ce+Re+Ze+Fe))/Ie[0],(T.height-(it+ze+Me+nt))/Ie[1])),P.maxZoom),lt=T.scale/T.zoomScale(Qe);xe=new s.Aabb([xe.min[0]-(Ze+He)*lt,xe.min[1]-(Me+at)*lt,xe.min[2]],[xe.max[0]+(Fe+He)*lt,xe.max[1]+(nt+at)*lt,xe.max[2]]);const kt=.5*Ie[2],Nt=this._minimumAABBFrustumDistance(T,xe),At=[0,0,1,0];s.transformMat4$1(At,At,be),s.normalize$2(At,At);const Bt=s.scale$2([],At,Nt+kt),er=s.add([],xe.center,Bt),Yt=(typeof P.offset.x=="number"&&typeof P.offset.y=="number"?new s.Point(P.offset.x,P.offset.y):s.Point.convert(P.offset)).rotate(-s.degToRad(y));xe.center[0]-=Yt.x*lt,xe.center[1]+=Yt.y*lt,s.transformMat4(xe.center,xe.center,ve),s.transformMat4(er,er,ve);const It=[xe.center[0],xe.center[1],er[2]*T.pixelsPerMeter];s.scale$2(It,It,1/T.worldSize);const _r=s.lngFromMercatorX(It[0]),wr=s.latFromMercatorY(It[1]),Er=Math.min(T._zoomFromMercatorZ(It[2]),P.maxZoom),Sr=new s.LngLat(_r,wr);return T.mercatorFromTransition&&Er<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(T.setProjection({name:"globe"}),T.zoom=Er,this._cameraForBounds(T,u,m,y,v,A)):{center:Sr,zoom:Er,bearing:y,pitch:v}}fitBounds(o,u,m){const y=this.cameraForBounds(o,u);return this._fitInternal(y,u,m)}fitScreenCoordinates(o,u,m,y,v){const A=s.Point.convert(o),T=s.Point.convert(u),P=new s.Point(Math.min(A.x,T.x),Math.min(A.y,T.y)),B=new s.Point(Math.max(A.x,T.x),Math.max(A.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,T))return this;const R=this.transform.pointLocation3D(P),W=this.transform.pointLocation3D(B),Y=this.transform.pointLocation3D(new s.Point(P.x,B.y)),te=this.transform.pointLocation3D(new s.Point(B.x,P.y)),ne=[Math.min(R.lng,W.lng,Y.lng,te.lng),Math.min(R.lat,W.lat,Y.lat,te.lat)],re=[Math.max(R.lng,W.lng,Y.lng,te.lng),Math.max(R.lat,W.lat,Y.lat,te.lat)],ie=y&&y.pitch?y.pitch:this.getPitch(),q=this._cameraForBounds(this.transform,ne,re,m,ie,y);return this._fitInternal(q,y,v)}_fitInternal(o,u,m){return o?(delete(u=s.extend(o,u)).padding,u.linear?this.easeTo(u,m):this.flyTo(u,m)):this}jumpTo(o,u){this.stop();const m=o.preloadOnly?this.transform.clone():this.transform;let y=!1,v=!1,A=!1;return"zoom"in o&&m.zoom!==+o.zoom&&(y=!0,m.zoom=+o.zoom),o.center!==void 0&&(m.center=s.LngLat.convert(o.center)),"bearing"in o&&m.bearing!==+o.bearing&&(v=!0,m.bearing=+o.bearing),"pitch"in o&&m.pitch!==+o.pitch&&(A=!0,m.pitch=+o.pitch),o.padding==null||m.isPaddingEqual(o.padding)||(m.padding=o.padding),o.preloadOnly?(this._preloadTiles(m),this):(this.fire(new s.Event("movestart",u)).fire(new s.Event("move",u)),y&&this.fire(new s.Event("zoomstart",u)).fire(new s.Event("zoom",u)).fire(new s.Event("zoomend",u)),v&&this.fire(new s.Event("rotatestart",u)).fire(new s.Event("rotate",u)).fire(new s.Event("rotateend",u)),A&&this.fire(new s.Event("pitchstart",u)).fire(new s.Event("pitch",u)).fire(new s.Event("pitchend",u)),this.fire(new s.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(Gs),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,u){const m=this.transform;if(!m.projection.supportsFreeCamera)return s.warnOnce(Gs),this;this.stop();const y=m.zoom,v=m.pitch,A=m.bearing;m.setFreeCameraOptions(o);const T=y!==m.zoom,P=v!==m.pitch,B=A!==m.bearing;return this.fire(new s.Event("movestart",u)).fire(new s.Event("move",u)),T&&this.fire(new s.Event("zoomstart",u)).fire(new s.Event("zoom",u)).fire(new s.Event("zoomend",u)),B&&this.fire(new s.Event("rotatestart",u)).fire(new s.Event("rotate",u)).fire(new s.Event("rotateend",u)),P&&this.fire(new s.Event("pitchstart",u)).fire(new s.Event("pitch",u)).fire(new s.Event("pitchend",u)),this.fire(new s.Event("moveend",u)),this}easeTo(o,u){this._stop(!1,o.easeId),((o=s.extend({offset:[0,0],duration:500,easing:s.ease},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const m=this.transform,y=this.getZoom(),v=this.getBearing(),A=this.getPitch(),T=this.getPadding(),P="zoom"in o?+o.zoom:y,B="bearing"in o?this._normalizeBearing(o.bearing,v):v,R="pitch"in o?+o.pitch:A,W="padding"in o?o.padding:m.padding,Y=s.Point.convert(o.offset);let te,ne,re;if(m.projection.name==="globe"){const Ce=s.MercatorCoordinate.fromLngLat(m.center),Re=Y.rotate(-m.angle);Ce.x+=Re.x/m.worldSize,Ce.y+=Re.y/m.worldSize;const it=Ce.toLngLat(),ze=s.LngLat.convert(o.center||it);this._normalizeCenter(ze),te=m.centerPoint.add(Re),ne=new s.Point(Ce.x,Ce.y).mult(m.worldSize),re=new s.Point(s.mercatorXfromLng(ze.lng),s.mercatorYfromLat(ze.lat)).mult(m.worldSize).sub(ne)}else{te=m.centerPoint.add(Y);const Ce=m.pointLocation(te),Re=s.LngLat.convert(o.center||Ce);this._normalizeCenter(Re),ne=m.project(Ce),re=m.project(Re).sub(ne)}const ie=m.zoomScale(P-y);let q,ee;o.around&&(q=s.LngLat.convert(o.around),ee=m.locationPoint(q));const ae=this._zooming||P!==y,ce=this._rotating||v!==B,xe=this._pitching||R!==A,be=!m.isPaddingEqual(W),ve=Ce=>Re=>{if(ae&&(Ce.zoom=s.number(y,P,Re)),ce&&(Ce.bearing=s.number(v,B,Re)),xe&&(Ce.pitch=s.number(A,R,Re)),be&&(Ce.interpolatePadding(T,W,Re),te=Ce.centerPoint.add(Y)),q)Ce.setLocationAtPoint(q,ee);else{const it=Ce.zoomScale(Ce.zoom-y),ze=P>y?Math.min(2,ie):Math.max(.5,ie),Ze=Math.pow(ze,1-Re),Fe=Ce.unproject(ne.add(re.mult(Re*Ze)).mult(it));Ce.setLocationAtPoint(Ce.renderWorldCopies?Fe.wrap():Fe,te)}return o.preloadOnly||this._fireMoveEvents(u),Ce};if(o.preloadOnly){const Ce=this._emulate(ve,o.duration,m);return this._preloadTiles(Ce),this}const Ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=ce,this._pitching=xe,this._padding=be,this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,Ie),this._ease(ve(m),Ce=>{m.recenterOnTerrain(),this._afterEase(u,Ce)},o),this}_prepareEase(o,u,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||m.moving||this.fire(new s.Event("movestart",o)),this._zooming&&!m.zooming&&this.fire(new s.Event("zoomstart",o)),this._rotating&&!m.rotating&&this.fire(new s.Event("rotatestart",o)),this._pitching&&!m.pitching&&this.fire(new s.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new s.Event("move",o)),this._zooming&&this.fire(new s.Event("zoom",o)),this._rotating&&this.fire(new s.Event("rotate",o)),this._pitching&&this.fire(new s.Event("pitch",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new s.Event("zoomend",o)),y&&this.fire(new s.Event("rotateend",o)),v&&this.fire(new s.Event("pitchend",o)),this.fire(new s.Event("moveend",o))}flyTo(o,u){if(this._prefersReducedMotion(o)){const Qe=s.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qe,u)}this.stop(),o=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},o);const m=this.transform,y=this.getZoom(),v=this.getBearing(),A=this.getPitch(),T=this.getPadding(),P="zoom"in o?s.clamp(+o.zoom,m.minZoom,m.maxZoom):y,B="bearing"in o?this._normalizeBearing(o.bearing,v):v,R="pitch"in o?+o.pitch:A,W="padding"in o?o.padding:m.padding,Y=m.zoomScale(P-y),te=s.Point.convert(o.offset);let ne=m.centerPoint.add(te);const re=m.pointLocation(ne),ie=s.LngLat.convert(o.center||re);this._normalizeCenter(ie);const q=m.project(re),ee=m.project(ie).sub(q);let ae=o.curve;const ce=Math.max(m.width,m.height),xe=ce/Y,be=ee.mag();if("minZoom"in o){const Qe=s.clamp(Math.min(o.minZoom,y,P),m.minZoom,m.maxZoom),lt=ce/m.zoomScale(Qe-y);ae=Math.sqrt(lt/be*2)}const ve=ae*ae;function Ie(Qe){const lt=(xe*xe-ce*ce+(Qe?-1:1)*ve*ve*be*be)/(2*(Qe?xe:ce)*ve*be);return Math.log(Math.sqrt(lt*lt+1)-lt)}function Ce(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Re(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const it=Ie(0);let ze=function(Qe){return Re(it)/Re(it+ae*Qe)},Ze=function(Qe){return ce*((Re(it)*(Ce(lt=it+ae*Qe)/Re(lt))-Ce(it))/ve)/be;var lt},Fe=(Ie(1)-it)/ae;if(Math.abs(be)<1e-6||!isFinite(Fe)){if(Math.abs(ce-xe)<1e-6)return this.easeTo(o,u);const Qe=xe<ce?-1:1;Fe=Math.abs(Math.log(xe/ce))/ae,Ze=function(){return 0},ze=function(lt){return Math.exp(Qe*ae*lt)}}o.duration="duration"in o?+o.duration:1e3*Fe/("screenSpeed"in o?+o.screenSpeed/ae:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const nt=v!==B,Me=R!==A,He=!m.isPaddingEqual(W),at=Qe=>lt=>{const kt=lt*Fe,Nt=1/ze(kt);Qe.zoom=lt===1?P:y+Qe.scaleZoom(Nt),nt&&(Qe.bearing=s.number(v,B,lt)),Me&&(Qe.pitch=s.number(A,R,lt)),He&&(Qe.interpolatePadding(T,W,lt),ne=Qe.centerPoint.add(te));const At=lt===1?ie:Qe.unproject(q.add(ee.mult(Ze(kt))).mult(Nt));return Qe.setLocationAtPoint(Qe.renderWorldCopies?At.wrap():At,ne),Qe._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(u),Qe};if(o.preloadOnly){const Qe=this._emulate(at,o.duration,m);return this._preloadTiles(Qe),this}return this._zooming=!0,this._rotating=nt,this._pitching=Me,this._padding=He,this._prepareEase(u,!1),this._ease(at(m),()=>this._afterEase(u),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,u)}if(!o){const m=this.handlers;m&&m.stop(!1)}return this}_ease(o,u,m){m.animate===!1||m.duration===0?(o(1),u()):(this._easeStart=s.exported.now(),this._easeOptions=m,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,u){o=s.wrap(o,-180,180);const m=Math.abs(o-u);return Math.abs(o-360-u)<m&&(o-=360),Math.abs(o+360-u)<m&&(o+=360),o}_normalizeCenter(o){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const m=o.lng-u.center.lng;o.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&s.exported.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,u,m){const y=Math.ceil(15*u/1e3),v=[],A=o(m.clone());for(let T=0;T<=y;T++){const P=A(T/y);v.push(P.clone())}return v}}class Et{constructor(o={}){this.options=o,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const u=this.options&&this.options.compact;return this._map=o,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=L("button","mapboxgl-ctrl-attrib-button",this._container),L("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,u){const m=this._map._getUIString(`AttributionControl.${u}`);o.setAttribute("aria-label",m),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(o){const m=u.reduce((y,v,A)=>(v.value&&(y+=`${v.key}=${v.value}${A<u.length-1?"&":""}`),y),"?");o.href=`${s.config.FEEDBACK_URL}/${m}#${Ul(this._map,!0)}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const u=this._map.style._sourceCaches;for(const y in u){const v=u[y];if(v.used){const A=v.getSource();A.attribution&&o.indexOf(A.attribution)<0&&o.push(A.attribution)}}o.sort((y,v)=>y.length-v.length),o=o.filter((y,v)=>{for(let A=v+1;A<o.length;A++)if(o[A].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const m=o.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,o.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class sd{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=L("div","mapboxgl-ctrl");const u=L("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const u in o){const m=o[u].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class ad{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){const u=this._currentlyRunning,m=u?this._queue.concat(u):this._queue;for(const y of m)if(y.id===o)return void(y.cancelled=!0)}run(o=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const m of u)if(!m.cancelled&&(m.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ma(d,o,u){if(d=new s.LngLat(d.lng,d.lat),o){const m=new s.LngLat(d.lng-360,d.lat),y=new s.LngLat(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-u.center.lng)/360),A=u.locationPoint(d).distSqr(o),T=o.x<0||o.y<0||o.x>u.width||o.y>u.height;u.locationPoint(m).distSqr(o)<A&&(T||Math.abs(m.lng-u.center.lng)<v)?d=m:u.locationPoint(y).distSqr(o)<A&&(T||Math.abs(y.lng-u.center.lng)<v)&&(d=y)}for(;Math.abs(d.lng-u.center.lng)>180;){const m=u.locationPoint(d);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;d.lng>u.center.lng?d.lng-=360:d.lng+=360}return d}const Hs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class yt extends s.Evented{constructor(o,u){if(super(),(o instanceof s.window.HTMLElement||u)&&(o=s.extend({element:o},u)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=o&&o.occludedOpacity||.2,o&&o.element)this._element=o.element,this._offset=s.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=L("div");const y=41,v=27,A=V("svg",{display:"block",height:y*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${y}`},this._element),T=V("radialGradient",{id:"shadowGradient"},V("defs",{},A));V("stop",{offset:"10%","stop-opacity":.4},T),V("stop",{offset:"100%","stop-opacity":.05},T),V("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),V("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),V("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),V("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=s.Point.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const m=this._element.classList;for(const y in Hs)m.remove(`mapboxgl-marker-anchor-${y}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const u=o.code,m=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(o){const u=o.originalEvent.target,m=this._element;this._popup&&(u===m||m.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,u=this._pos;if(!o||!u)return!1;const m=o.unproject(u),y=o.getFreeCameraOptions();if(!y.position)return!1;const v=y.position.toLngLat();return v.distanceTo(m)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const u=this._pos;if(!u||u.x<0||u.x>o.transform.width||u.y<0||u.y>o.transform.height)return void this._clearFadeTimer();const m=o.unproject(u);let y;o._showingGlobe()&&s.isLngLatBehindGlobe(o.transform,this._lngLat)?y=0:(y=1-o._queryFogOpacity(m),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Hs[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const o=this._pos,u=this._map,m=this.getPitchAlignment();if(!u||!o||m!=="map")return"";if(!u._showingGlobe()){const P=u.getPitch();return P?`rotateX(${P}deg)`:""}const y=s.radToDeg(s.globeTiltAtLngLat(u.transform,this._lngLat)),v=o.sub(s.globeCenterToScreenPoint(u.transform)),A=Math.abs(v.x)+Math.abs(v.y);if(A===0)return"";const T=y/A;return`rotateX(${-v.y*T}deg) rotateY(${v.x*T}deg)`}_calculateZTransform(){const o=this._pos,u=this._map;if(!u||!o)return"";let m=0;const y=this.getRotationAlignment();if(y==="map")if(u._showingGlobe()){const v=u.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),A=u.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);m=s.radToDeg(Math.atan2(A.y,A.x))-90}else m=-u.getBearing();else if(y==="horizon"){const v=s.smoothstep(4,6,u.getZoom()),A=s.globeCenterToScreenPoint(u.transform);A.y+=v*u.transform.height;const T=o.sub(A),P=s.radToDeg(Math.atan2(T.y,T.x));m=(P>90?P-270:P+90)*(1-v)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(o){s.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Ma(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),o===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=s.Point.convert(o),this._update(),this}_onMove(o){const u=this._map;if(!u)return;const m=this._pointerdownPos,y=this._positionDelta;if(m&&y){if(!this._isDragging){const v=this._clickTolerance||u._clickTolerance;if(o.point.dist(m)<v)return;this._isDragging=!0}this._pos=o.point.sub(y),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(o){const u=this._map,m=this._pos;u&&m&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(m),this._pointerdownPos=o.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const u=this._map;return u&&(o?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ld={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},g_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Uf(d=new s.Point(0,0),o="bottom"){if(typeof d=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(o){case"top":return new s.Point(0,d);case"top-left":return new s.Point(u,u);case"top-right":return new s.Point(-u,u);case"bottom":return new s.Point(0,-d);case"bottom-left":return new s.Point(u,-u);case"bottom-right":return new s.Point(-u,-u);case"left":return new s.Point(d,0);case"right":return new s.Point(-d,0)}return new s.Point(0,0)}return d instanceof s.Point||Array.isArray(d)?s.Point.convert(d):s.Point.convert(d[o]||[0,0])}class cd{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const u=s.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,u,m){this._start=this.getValue(u),this._end=o,this._startTime=u,this._endTime=u+m}}const Vf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},jf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},__={showCompass:!0,showZoom:!0,visualizePitch:!1};class y_{constructor(o,u,m=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new td({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,m&&(this.mousePitch=new rd({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(o,u){this.mouseRotate.mousedown(o,u),this.mousePitch&&this.mousePitch.mousedown(o,u),Z()}move(o,u){const m=this.map,y=this.mouseRotate.mousemoveWindow(o,u),v=y&&y.bearingDelta;if(v&&m.setBearing(m.getBearing()+v),this.mousePitch){const A=this.mousePitch.mousemoveWindow(o,u),T=A&&A.pitchDelta;T&&m.setPitch(m.getPitch()+T)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){U(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(s.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),le(this.element,o)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,le(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pe(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=pe(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ud={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},hd={maxWidth:100,unit:"metric"},dd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ra={version:s.version,supported:C,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends iu{constructor(d){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(d=s.extend({},jf,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(d.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ka(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new ad,this._domRenderTaskQueue=new ad,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Vf,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new cd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=s.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Eo(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new Yh(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,s.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new Et({customAttribution:d.customAttribution})),this._logoControl=new sd,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new s.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new s.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(d,o){if(o===void 0&&(o=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=d.onAdd(this);this._controls.push(d);const m=this._controlPositions[o];return o.indexOf("bottom")!==-1?m.insertBefore(u,m.firstChild):m.appendChild(u),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(d);return o>-1&&this._controls.splice(o,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new s.Event("movestart",d)).fire(new s.Event("move",d)),this.fire(new s.Event("resize",d)),o&&this.fire(new s.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(s.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?s.window.navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(o=>o==="auto"?s.window.navigator.language:o):d}setLanguage(d){const o=this._parseLanguage(d);if(!this.style||o===this._language)return this;this._language=o,this.style._reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,o=d.projection.name;let u;o==="globe"&&d.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),u=!0):o==="mercator"&&d.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,o){return this._updateProjection(d||o||{name:"mercator"})}_updateProjection(d){let o;if(o=d.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),o){this.painter.clearBackgroundTiles();for(const u in this.style._sourceCaches)this.style._sourceCaches[u].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(s.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(s.Point.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,o,u){if(d==="mouseenter"||d==="mouseover"){let m=!1;const y=A=>{const T=o.filter(B=>this.getLayer(B)),P=T.length?this.queryRenderedFeatures(A.point,{layers:T}):[];P.length?m||(m=!0,u.call(this,new zn(d,this,A.originalEvent,{features:P}))):m=!1},v=()=>{m=!1};return{layers:new Set(o),listener:u,delegates:{mousemove:y,mouseout:v}}}if(d==="mouseleave"||d==="mouseout"){let m=!1;const y=A=>{const T=o.filter(P=>this.getLayer(P));(T.length?this.queryRenderedFeatures(A.point,{layers:T}):[]).length?m=!0:m&&(m=!1,u.call(this,new zn(d,this,A.originalEvent)))},v=A=>{m&&(m=!1,u.call(this,new zn(d,this,A.originalEvent)))};return{layers:new Set(o),listener:u,delegates:{mousemove:y,mouseout:v}}}{const m=y=>{const v=o.filter(T=>this.getLayer(T)),A=v.length?this.queryRenderedFeatures(y.point,{layers:v}):[];A.length&&(y.features=A,u.call(this,y),delete y.features)};return{layers:new Set(o),listener:u,delegates:{[d]:m}}}}on(d,o,u){if(u===void 0)return super.on(d,o);Array.isArray(o)||(o=[o]);const m=this._createDelegatedListener(d,o,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(d,o,u){if(u===void 0)return super.once(d,o);Array.isArray(o)||(o=[o]);const m=this._createDelegatedListener(d,o,u);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(d,o,u){if(u===void 0)return super.off(d,o);o=new Set(Array.isArray(o)?o:[o]);const m=(v,A)=>{if(v.size!==A.size)return!1;for(const T of v)if(!A.has(T))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[d]:void 0;return y&&(v=>{for(let A=0;A<v.length;A++){const T=v[A];if(T.listener===u&&m(T.layers,o)){for(const P in T.delegates)this.off(P,T.delegates[P]);return v.splice(A,1),this}}})(y),this}queryRenderedFeatures(d,o){return this.style?(o!==void 0||d===void 0||d instanceof s.Point||Array.isArray(d)||(o=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(d,o){return this.style.querySourceFeatures(d,o)}isPointOnSurface(d){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&s.warnOnce(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.Point.convert(d))}setStyle(d,o){return(o=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(d,o))}_getUIString(d){const o=this._locale[d];if(o==null)throw new Error(`Missing UI string '${d}'`);return o}_updateStyle(d,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new bo(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new bo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,o){if(typeof d=="string"){const u=this._requestManager.normalizeStyleURL(d),m=this._requestManager.transformRequest(u,s.ResourceType.Style);s.getJSON(m,(y,v)=>{y?this.fire(new s.ErrorEvent(y)):v&&this._updateDiff(v,o)})}else typeof d=="object"&&this._updateDiff(d,o)}_updateDiff(d,o){try{this.style.setState(d)&&this._update(!0)}catch(u){s.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(d,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(d,o){return this._lazyInitEmptyStyle(),this.style.addSource(d,o),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const o in d){const u=d[o]._tiles;for(const m in u){const y=u[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(d,o,u){this._lazyInitEmptyStyle(),this.style.addSourceType(d,o,u)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,o,{pixelRatio:u=1,sdf:m=!1,stretchX:y,stretchY:v,content:A}={}){if(this._lazyInitEmptyStyle(),o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap){const{width:T,height:P,data:B}=s.exported.getImageData(o);this.style.addImage(d,{data:new s.RGBAImage({width:T,height:P},B),pixelRatio:u,stretchX:y,stretchY:v,content:A,sdf:m,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:P}=o,B=o;this.style.addImage(d,{data:new s.RGBAImage({width:T,height:P},new Uint8Array(B.data)),pixelRatio:u,stretchX:y,stretchY:v,content:A,sdf:m,version:0,userImage:B}),B.onAdd&&B.onAdd(this,d)}}updateImage(d,o){const u=this.style.getImage(d);if(!u)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap?s.exported.getImageData(o):o,{width:y,height:v}=m;y!==void 0&&v!==void 0?y===u.data.width&&v===u.data.height?(u.data.replace(m.data,!(o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap)),this.style.updateImage(d,u)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${v})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,o){s.getImage(this._requestManager.transformRequest(d,s.ResourceType.Image),(u,m)=>{o(u,m instanceof s.window.HTMLImageElement?s.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(d,o){return this._lazyInitEmptyStyle(),this.style.addLayer(d,o),this._update(!0)}moveLayer(d,o){return this.style.moveLayer(d,o),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,o,u){return this.style.setLayerZoomRange(d,o,u),this._update(!0)}setFilter(d,o,u={}){return this.style.setFilter(d,o,u),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,o,u,m={}){return this.style.setPaintProperty(d,o,u,m),this._update(!0)}getPaintProperty(d,o){return this.style.getPaintProperty(d,o)}setLayoutProperty(d,o,u,m={}){return this.style.setLayoutProperty(d,o,u,m),this._update(!0)}getLayoutProperty(d,o){return this.style.getLayoutProperty(d,o)}setLight(d,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(d),this.transform):0}setFeatureState(d,o){return this.style.setFeatureState(d,o),this._update()}removeFeatureState(d,o){return this.style.removeFeatureState(d,o),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let u,m,y,v=this._container;for(;v&&(!m||!y);){const A=s.window.getComputedStyle(v).transform;A&&A!=="none"&&(u=A.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(m=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(y=u[3])),v=v.parentElement}this._containerWidth=m?Math.abs(d/m):d,this._containerHeight=y?Math.abs(o/y):o}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=L("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=L("div","mapboxgl-canvas-container",d);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=L("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=L("div","mapboxgl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=L("div",`mapboxgl-ctrl-${y}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,o){const u=s.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(d),this._canvas.height=u*Math.ceil(o),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${o}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const o=this._markers.indexOf(d);o!==-1&&this._markers.splice(o,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const o=this._popups.indexOf(d);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const d=s.extend({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._useWebGL2&&this._canvas.getContext("webgl2",d),u=o||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);u?(this._useWebGL2&&!o&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(u,!0),this.painter=new Ca(u,this.transform,!!o),this.on("data",m=>{m.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(u)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let o;const u=this.painter.context.extTimerQuery,m=s.exported.now();if(this.listens("gpu-timing-frame")&&(o=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const T=this.transform.zoom,P=this.transform.pitch,B=s.exported.now(),R=new s.EvaluationParameters(T,{now:B,fadeDuration:y,pitch:P,transition:this.style.getTransition()});this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const T=s.exported.now()-m;u.endQueryEXT(u.TIME_ELAPSED_EXT,o),setTimeout(()=>{const P=u.getQueryObjectEXT(o,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(o),this.fire(new s.Event("gpu-timing-frame",{cpuTime:T,gpuTime:P})),s.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const T=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(T);this.fire(new s.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const T=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(T);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(A||this._repaint)this.triggerRepaint();else{const T=!this.isMoving()&&this.loaded();if(T&&(v=this._updateAverageElevation(m,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),T&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const o of this._markers)d&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!d||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(d,o=!1){const u=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);if((o||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const m=this.transform.averageElevation;let y=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=d;const A=Math.abs(m-y);if(A>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(y),u(y);this._averageElevation.easeTo(y,d,300)}else if(A>1e-4)return this._averageElevation.jumpTo(y),u(y)}return!!this._averageElevation.isEasing(d)&&u(this._averageElevation.getValue(d))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===s.AUTH_ERR_MSG||d.status===401)){const o=this.painter.context.gl;s.storeAuthState(o,!1),this._logoControl instanceof sd&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const u=this.painter.context.gl,m=u.createFramebuffer();function y(v){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,v,0);const A=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,A),A}return u.bindFramebuffer(u.FRAMEBUFFER,m),this._canvasPixelComparison(y(d),o.canvasCopies.map(y),o.timeStamps)}_canvasPixelComparison(d,o,u){let m=u[1]-u[0];const y=d.length/4;for(let v=0;v<o.length;v++){const A=o[v];let T=0;for(let P=0;P<A.length;P+=4)A[P]===d[P]&&A[P+1]===d[P+1]&&A[P+2]===d[P+2]&&A[P+3]===d[P+3]&&(T+=1);m+=(u[v+2]-u[v+1])*(1-T/y)}return m}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=s.exported.frame(o=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(o)}))}_preloadTiles(d){const o=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(o,(u,m)=>u._preloadTiles(d,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,o){s.setCacheLimits(d,o)}get version(){return s.version}},NavigationControl:class{constructor(d){this.options=s.extend({},__,d),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),L("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),L("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:o}):u.resetNorth({},{originalEvent:o}))}),this._compassIcon=L("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const o=d.getZoom(),u=o===d.getMaxZoom(),m=o===d.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new y_(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,o){const u=L("button",d,this._container);return u.type="button",u.addEventListener("click",o),u}_setButtonTitle(d,o){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${o}`);d.setAttribute("aria-label",u),d.firstElementChild&&d.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends s.Evented{constructor(d){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},ud,d),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Pa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const o=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,d(u)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(u=>o(u.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(d){const o=this._map.getMaxBounds(),u=d.coords;return!!o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",d)),this._finish()}}_updateCamera(d){const o=new s.LngLat(d.coords.longitude,d.coords.latitude),u=d.coords.accuracy,m=this._map.getBearing(),y=s.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(u),y,{geolocateSource:!0})}_updateMarker(d){if(d){const o=new s.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,o=s.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,u=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=L("button","mapboxgl-ctrl-geolocate",this._container),L("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L("div","mapboxgl-user-location"),this._dotElement.appendChild(L("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(L("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new yt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=L("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Et,ScaleControl:class{constructor(d){this.options=s.extend({},hd,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,o=this._map,u=o._containerHeight/2,m=o._containerWidth/2-d/2,y=o.unproject([m,u]),v=o.unproject([m+d,u]),A=y.distanceTo(v);if(this.options.unit==="imperial"){const T=3.2808*A;T>5280?this._setScale(d,T/5280,"mile"):this._setScale(d,T,"foot")}else this.options.unit==="nautical"?this._setScale(d,A/1852,"nautical-mile"):A>=1e3?this._setScale(d,A/1e3,"kilometer"):this._setScale(d,A,"meter")}_setScale(d,o,u){this._map._requestDomTask(()=>{const m=function(v){const A=Math.pow(10,`${Math.floor(v)}`.length-1);let T=v/A;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(P){const B=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*B)/B}(T),A*T}(o),y=m/o;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(m):`${m}&nbsp;${dd[u]}`,this._container.style.width=d*y+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof s.window.HTMLElement?this._container=d.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=L("button","mapboxgl-ctrl-fullscreen",this._controlContainer);L("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(d){super(),this.options=s.extend(Object.create(ld),d),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=s.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(s.window.document.createTextNode(d))}setHTML(d){const o=s.window.document.createDocumentFragment(),u=s.window.document.createElement("body");let m;for(u.innerHTML=d;m=u.firstChild,m;)o.appendChild(m);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=L("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(d),this.options.closeButton){const u=this._closeButton=L("button","mapboxgl-popup-close-button",o);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let o;return this._classList.delete(d)?o=!1:(this._classList.add(d),o=!0),this._updateClassList(),o}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const o=this._map,u=this._container,m=this._pos;if(!o||!u||!m)return"bottom";const y=u.offsetWidth,v=u.offsetHeight,A=m.x<y/2,T=m.x>o.transform.width-y/2;if(m.y+d<v)return A?"top-left":T?"top-right":"top";if(m.y>o.transform.height-v){if(A)return"bottom-left";if(T)return"bottom-right"}return A?"left":T?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),d.className=o.join(" ")}_update(d){const o=this._map,u=this._content;if(!o||!this._lngLat&&!this._trackPointer||!u)return;let m=this._container;if(m||(m=this._container=L("div","mapboxgl-popup",o.getContainer()),this._tip=L("div","mapboxgl-popup-tip",m),m.appendChild(u)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ma(this._lngLat,this._pos,o.transform)),!this._trackPointer||d){const y=this._pos=this._trackPointer&&d?d:o.project(this._lngLat),v=Uf(this.options.offset),A=this._anchor=this._getAnchor(v.y),T=Uf(this.options.offset,A),P=y.add(T).round();o._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${Hs[A]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&o._showingGlobe()){const y=s.isLngLatBehindGlobe(o.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(g_);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:yt,Style:bo,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Af,Evented:s.Evented,config:s.config,prewarm:function(){ga().acquire(yo)},clearPrewarmedResources:function(){const d=ti;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(yo),ti=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(d){s.config.ACCESS_TOKEN=d},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(d){s.config.API_URL=d},get workerCount(){return kn.workerCount},set workerCount(d){kn.workerCount=d},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){s.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){s.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Ra});var b=f;return b})})(nz);var bb=nz.exports;const uN=s1(bb),hN=JD({__proto__:null,default:uN},[bb]);var jt={},ug={},Vg={},xl={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SANITIZED_VALUES={YES_VALUE:"y",NO_VALUE:"n"};const r=new Set(["https:","http:"]);class a{build(){return this._url}appendDefaultParameters(C){for(const k of C.keys()){const M=C.get(k);M&&!this._url.searchParams.has(k)&&this._url.searchParams.append(k,M)}return this}appendUserOptions(C){for(const k of Object.keys(C)){if(C[k]===null||C[k]===void 0)continue;const M=this._optionNames[k];if(!M)continue;const L=this.sanitizeParameterValue(M,C[k]);this._url.searchParams.append(M,L)}return this}appendCustomParams(C){for(const k of C)this._url.searchParams.set(k.name,k.value);return this}setToken(C){if(this._token)throw new Error(`The token has already been set to ${this._token}`);if(!C)return this;this._token=C;const k=this._url.toString().substring(this._url.origin.length);return this._url=new URL(`${this._url.origin}/vizportal/api/web/v1/auth/embed/target`),this._url.searchParams.append("token",C),this._url.searchParams.append("target",k),this}sanitizeValue(C){const k=String(C);switch(k){case"true":return t.SANITIZED_VALUES.YES_VALUE;case"false":return t.SANITIZED_VALUES.NO_VALUE;default:return k}}}t.EmbeddingUrlBuilder=a;function c(S){f(S)}t.validateUrl=c;function f(S){const C=S.protocol;if(!r.has(C))throw new Error(`Invalid protocol in URL '${S}'. The protocols supported are ${Array.from(r).join(", ")}.`)}function _(S){const k=s(new URL(S.toString())).pathname.split("/").filter(M=>M);return k.length===0?"":k[0]==="site"?k[1]:k[0]==="pulse"&&k[1]==="site"?k[2]:""}t.getSiteIdForPulse=_;function b(S){const k=s(new URL(S.toString())).pathname.split("/").filter(M=>M);return k.length===0||k[0]!=="t"||k.length<2?"":k[1]}t.getSiteId=b;function s(S){let C=S.toString();return C=C.replace("/#/site/","/t/").replace("/#/","/"),new URL(C)}t.canonicalizeVizPortalRoutingHashes=s})(xl);Object.defineProperty(Vg,"__esModule",{value:!0});const dN=Or,Ka=ho,oz=$r,sz=xl;function pN(t,r,a,c){const f=t.split("?")[0];let _;try{_=new URL(f),sz.validateUrl(_)}catch(S){throw new oz.TableauError(dN.EmbeddingErrorCodes.InvalidUrl,S.message)}const b=fN(_,a),s=new az(_).appendDefaultParameters(b).appendUserOptions(r).appendCustomParams(c);return r.iframeAuth&&s.setToken(r.token),s.build()}Vg.createAskDataUrl=pN;function fN(t,r){const a=new Map,c=`${Ka.INTERNAL_CONTRACT_VERSION.major}.${Ka.INTERNAL_CONTRACT_VERSION.minor}.${Ka.INTERNAL_CONTRACT_VERSION.fix}`;a.set(Ka.AskDataOptionNames.ApiInternalVersion,c);const f=oz.ApiVersion.Instance.formattedValue;return a.set(Ka.AskDataOptionNames.ApiExternalVersion,f),a.set(Ka.AskDataOptionNames.ApiID,`embhost${r}`),a.set(Ka.AskDataOptionNames.AskDataWebComponent,"true"),a}class az extends sz.EmbeddingUrlBuilder{constructor(r){super(),this._url=r,this._optionNames=Ka.AskDataOptionNames}sanitizeParameterValue(r,a){return this.sanitizeValue(a)}}Vg.EmbeddingAskDataUrlBuilder=az;var Ic={},wb={},mN=gt&&gt.__awaiter||function(t,r,a,c){function f(_){return _ instanceof a?_:new a(function(b){b(_)})}return new(a||(a=Promise))(function(_,b){function s(k){try{C(c.next(k))}catch(M){b(M)}}function S(k){try{C(c.throw(k))}catch(M){b(M)}}function C(k){k.done?_(k.value):f(k.value).then(s,S)}C((c=c.apply(t,r||[])).next())})};Object.defineProperty(wb,"__esModule",{value:!0});class gN{constructor(){this.queue=[],this.pending=0,this.concurrency=1}add(r){return new Promise((c,f)=>{this.queue.push(()=>mN(this,void 0,void 0,function*(){try{const _=yield r();c(_)}catch(_){f(_)}finally{this.pending--,this.poll()}}))})}poll(){if(this.pending<this.concurrency&&this.queue.length>0){const r=this.queue.shift();this.pending++,r()}}size(){return this.queue.length}}wb.PromiseQueue=gN;Object.defineProperty(Ic,"__esModule",{value:!0});const _N=wb;class Yp{static authRequired(r,a){if(!a)return!0;try{const c=new URL(r);if(this.signedInOrigins.has(c.origin))return!1}catch{return!0}return!0}static updateSignedInOrigin(r,a){if(a)try{const c=new URL(r);this.signedInOrigins.add(c.origin)}catch{return}}static clearOrigin(r,a){if(a&&r)try{const c=new URL(r);this.signedInOrigins.delete(c.origin)}catch{return}}static registerWebComponent(r){const a=this.embeddingIndex;return this.webComponents.set(a,r),this.embeddingIndex++,a}static unregisterWebComponent(r){this.webComponents.delete(r)}static getWebComponents(){const r=new Map;return this.webComponents.forEach((a,c)=>{r.set(c,a)}),r}static synchronizeRender(r){const a=this.queue.add(r);return this.queue.poll(),a}static clear(){this.webComponents.clear()}}Ic.WebComponentManager=Yp;Yp.embeddingIndex=0;Yp.webComponents=new Map;Yp.queue=new _N.PromiseQueue;Yp.signedInOrigins=new Set;var Jp={},Eb={};Object.defineProperty(Eb,"__esModule",{value:!0});class yN{constructor(r,a){this._errorCode=r,this._message=a}get message(){return this._message}get errorCode(){return this._errorCode}}Eb.VizLoadErrorEvent=yN;var Qp={};Object.defineProperty(Qp,"__esModule",{value:!0});class lz{}Qp.HtmlElementHelpers=lz;lz.getContentSize=t=>{const r=window.getComputedStyle(t),a=parseInt(r.paddingLeft,10)||0,c=parseInt(r.paddingTop,10)||0,f=parseInt(r.paddingRight,10)||0,_=parseInt(r.paddingBottom,10)||0,b=t.clientWidth-Math.round(a+f),s=t.clientHeight-Math.round(c+_);return{width:b,height:s}};(function(t){var r=gt&&gt.__awaiter||function(L,V,O,j){function H(Z){return Z instanceof O?Z:new O(function(U){U(Z)})}return new(O||(O=Promise))(function(Z,U){function $(pe){try{le(j.next(pe))}catch(ye){U(ye)}}function J(pe){try{le(j.throw(pe))}catch(ye){U(ye)}}function le(pe){pe.done?Z(pe.value):H(pe.value).then($,J)}le((j=j.apply(L,V||[])).next())})},a;Object.defineProperty(t,"__esModule",{value:!0});const c=Or,f=$r,_=Eb,b=Qp,s=Ic;var S;(function(L){L.Skip="skip",L.Success="success",L.Failure="failure"})(S=t.TableauAuthResponse||(t.TableauAuthResponse={}));const C={allowTransparency:"allowTransparency",allowFullScreen:"allowFullScreen",style:"style",class:"class",loading:"loading"};t.getLocalizedTitle=L=>{const V={en:"Data Visualization","en-GB":"Data Visualisation",fr:"Visualisation de donnes",es:"Visualizacin de datos",it:"Visualizzazione dati",pt:"Visualizao de dados",ja:" ",de:"Datenvisualisierung",ko:" ","zh-CN":"","zh-TW":""};return V[L]||V[L.substr(0,2)]||V.en};const k=(a=globalThis.HTMLElement,a??class{attachShadow(L){}});class M extends k{constructor(){super(),this._initialized=!1,this._embeddingIdCounter=0,this._fixedSize=!1,this.attachShadow({mode:"open"})}disconnectedCallback(){var V,O;this._iframe&&((V=this.shadowRoot)===null||V===void 0||V.removeChild(this._iframe)),this._iframeStyle&&((O=this.shadowRoot)===null||O===void 0||O.removeChild(this._iframeStyle)),s.WebComponentManager.clearOrigin(this.src,this.forceTokenSync),s.WebComponentManager.unregisterWebComponent(this._embeddingIdCounter),this._initialized=!1}connectedCallback(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{this.initialize()}):this.initialize()}attributeChangedCallback(V,O,j){if(!(!O&&O===j)){if(V===c.WebComponentAttributes.Width||V===c.WebComponentAttributes.Height){this.setFrameSize();return}V===c.WebComponentAttributes.Token&&O&&O!==j&&s.WebComponentManager.clearOrigin(this.src,this.forceTokenSync),s.WebComponentManager.synchronizeRender(this.updateRenderingIfInitialized.bind(this,this.src))}}static get observedAttributes(){return Object.values(c.WebComponentAttributes)}initialize(){this._initialized||(this.style.display="flex",this.setupFrame(),this.registerAttributeAuthErrorEvent(),s.WebComponentManager.synchronizeRender(this.updateRendering.bind(this,this.src)))}get fixedSize(){return this._fixedSize}readCustomParamsFromChildren(){const V=[];return Array.from(this.children).forEach(O=>{O.localName===c.WebComponentChildElements.CustomParameter&&O.getAttribute(c.WebComponentChildElementAttributes.Name)&&O.getAttribute(c.WebComponentChildElementAttributes.Value)&&V.push({name:O.getAttribute(c.WebComponentChildElementAttributes.Name),value:O.getAttribute(c.WebComponentChildElementAttributes.Value)})}),V}getIframeStyleChild(){let V;for(const O of Array.from(this.children))if(O.localName===c.WebComponentChildElements.IframeStyle){if(V)throw new f.TableauError(c.EmbeddingErrorCodes.InternalError,`Only one ${c.WebComponentChildElements.IframeStyle} child element is supported. Please combine your styles.`);V=O}return V}setupFrame(){var V;this._iframe=document.createElement("iframe");const O=navigator.language,j=t.getLocalizedTitle(O);if(this._iframe.setAttribute("title",j),this._iframe.setAttribute(C.allowTransparency,"true"),this._iframe.setAttribute(C.allowFullScreen,"true"),this.iframeAttributeLoading&&this._iframe.setAttribute("loading",this.iframeAttributeLoading),this._iframe.style.margin="0px",this._iframe.style.padding="0px",this._iframe.style.border="none",this._iframe.style.position="relative",this._iframe.id=this.id,this._iframe.name=this.id,this.setFrameSize(),this.iframeAttributeStyle){const H=this._iframe.getAttribute(C.style);this._iframe.setAttribute(C.style,`${H} ${this.iframeAttributeStyle}`)}if(this.iframeAttributeClass&&this._iframe.setAttribute(C.class,this.iframeAttributeClass),this.shadowRoot){const H=this.getIframeStyleChild();if(H){H.style.display="none";const Z=(V=H.textContent)===null||V===void 0?void 0:V.trim();Z&&(this._iframeStyle=document.createElement("style"),this._iframeStyle.textContent=Z,this.shadowRoot.appendChild(this._iframeStyle))}this.shadowRoot.appendChild(this._iframe)}}setFrameSize(){this._iframe&&(this._iframe.style.height=this.height,this._iframe.style.width=this.width)}computeElementSize(){const V=this.getPixelAttribute(c.WebComponentAttributes.Height),O=this.getPixelAttribute(c.WebComponentAttributes.Width);if(V&&O)return this._fixedSize=!0,{height:V,width:O};if(this.parentElement){const{height:j,width:H}=b.HtmlElementHelpers.getContentSize(this.parentElement);if(j&&H)return this._fixedSize=!0,{height:`${j}px`,width:`${H}px`}}return this._fixedSize=!1,{height:M.AttributeDefaults.height,width:M.AttributeDefaults.width}}get src(){return this.getAttribute(c.WebComponentAttributes.Src)}set src(V){V&&this.setAttribute(c.WebComponentAttributes.Src,V)}get forceTokenSync(){return this.hasAttribute(c.WebComponentAttributes.ForceTokenSync)}set forceTokenSync(V){V?this.setAttribute(c.WebComponentAttributes.ForceTokenSync,""):this.removeAttribute(c.WebComponentAttributes.ForceTokenSync)}get width(){return this.computeElementSize().width}set width(V){this.setAttribute(c.WebComponentAttributes.Width,V)}get height(){return this.computeElementSize().height}set height(V){this.setAttribute(c.WebComponentAttributes.Height,V)}get debug(){return this.hasAttribute(c.WebComponentAttributes.Debug)}set debug(V){V?this.setAttribute(c.WebComponentAttributes.Debug,""):this.removeAttribute(c.WebComponentAttributes.Debug)}get token(){const V=this.getAttribute(c.WebComponentAttributes.Token);if(V)return V}set token(V){V?this.setAttribute(c.WebComponentAttributes.Token,V):this.removeAttribute(c.WebComponentAttributes.Token)}get iframeAuth(){return this.hasAttribute(c.WebComponentAttributes.IframeAuth)}set iframeAuth(V){V?this.setAttribute(c.WebComponentAttributes.IframeAuth,""):this.removeAttribute(c.WebComponentAttributes.IframeAuth)}get iframeAttributeLoading(){const V=this.getAttribute(c.EmbeddedIframeAttributes.Loading);if(V)return V}set iframeAttributeLoading(V){var O,j;V?(this.setAttribute(c.EmbeddedIframeAttributes.Loading,V),(O=this._iframe)===null||O===void 0||O.setAttribute(C.loading,V)):(this.removeAttribute(c.EmbeddedIframeAttributes.Loading),(j=this._iframe)===null||j===void 0||j.removeAttribute(C.loading))}get iframeAttributeStyle(){const V=this.getAttribute(c.EmbeddedIframeAttributes.Style);if(V)return V}set iframeAttributeStyle(V){var O,j;V?(this.setAttribute(c.EmbeddedIframeAttributes.Style,V),(O=this._iframe)===null||O===void 0||O.setAttribute(C.style,V)):(this.removeAttribute(c.EmbeddedIframeAttributes.Style),(j=this._iframe)===null||j===void 0||j.removeAttribute(C.style))}get iframeAttributeClass(){const V=this.getAttribute(c.EmbeddedIframeAttributes.Class);if(V)return V}set iframeAttributeClass(V){var O,j;V?(this.setAttribute(c.EmbeddedIframeAttributes.Class,V),(O=this._iframe)===null||O===void 0||O.setAttribute(C.class,V)):(this.removeAttribute(c.EmbeddedIframeAttributes.Class),(j=this._iframe)===null||j===void 0||j.removeAttribute(C.class))}getPixelAttribute(V){const O=this.getAttribute(V);return O&&O!==""?isNaN(Number(O))?O:`${Math.round(Number(O))}px`:""}get iframe(){return this._iframe}registerAttributeAuthErrorEvent(){this.getWebComponentAttributeEvents().forEach(V=>{const[O,j]=V;this.registerCallback(O,j)})}getWebComponentAttributeEvents(){return[[c.WebComponentAttributes.OnVizLoadError,c.EmbeddingTableauEventType.VizLoadError]]}registerCallback(V,O){const j=this.getAttribute(V);j&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(j)&&window[j]&&this.addEventListener(O,window[j])}auth(V){return r(this,void 0,void 0,function*(){try{if(!this.src||!this.token||this.iframeAuth||!s.WebComponentManager.authRequired(this.src,this.forceTokenSync))return S.Skip;const H=`${new URL(this.src).origin.toString()}/vizportal/api/web/v1/auth/embed/signin`,Z={siteName:V,jwt:this.token},U={method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify(Z)},$=yield fetch(H,U);if($.ok)return s.WebComponentManager.updateSignedInOrigin(this.src,this.forceTokenSync),S.Success;const le=yield $.text(),pe={statusCode:$.status,errorMessage:le};return this.isFallbackToRedirectAuthNeeded(pe)?(this.iframeAuth=!0,console.debug("Auth Fallback trigger"),S.Failure):(this.raiseVizLoadErrorNotification(c.EmbeddingErrorCodes.AuthFailed,pe),S.Failure)}catch(O){return this.raiseVizLoadErrorNotification(c.EmbeddingErrorCodes.UnknownAuthError,O),S.Failure}})}isFallbackToRedirectAuthNeeded(V){try{if(V.statusCode===404)return!0;if(V.statusCode===401){let O=JSON.parse(V.errorMessage).result.errors;if(O&&O.length>0&&O[0].code===67)return!0}return!1}catch(O){return console.error("Parsing error: "+O),!1}}raiseIframeSrcUpdatedNotification(){this.dispatchEvent(new CustomEvent(c.EmbeddingTableauEventType.IframeSrcUpdated))}raiseVizLoadErrorNotification(V,O){try{console.error(O);const j=new _.VizLoadErrorEvent(V,JSON.stringify(O));this.dispatchEvent(new CustomEvent(c.EmbeddingTableauEventType.VizLoadError,{detail:j}))}catch{const H=new _.VizLoadErrorEvent(c.EmbeddingErrorCodes.UnknownAuthError,"");this.dispatchEvent(new CustomEvent(c.EmbeddingTableauEventType.VizLoadError,{detail:H}))}}}t.TableauWebComponent=M,M.AttributeDefaults={width:"800px",height:"600px"}})(Jp);var ZA=gt&&gt.__awaiter||function(t,r,a,c){function f(_){return _ instanceof a?_:new a(function(b){b(_)})}return new(a||(a=Promise))(function(_,b){function s(k){try{C(c.next(k))}catch(M){b(M)}}function S(k){try{C(c.throw(k))}catch(M){b(M)}}function C(k){k.done?_(k.value):f(k.value).then(s,S)}C((c=c.apply(t,r||[])).next())})};Object.defineProperty(ug,"__esModule",{value:!0});const xi=Or,xN=Vg,vN=xl,XA=Ic,KA=Jp;class bN extends KA.TableauWebComponent{constructor(){super()}static get observedAttributes(){return[...super.observedAttributes,...Object.values(xi.AskDataAttributes)]}updateRenderingIfInitialized(r){return ZA(this,void 0,void 0,function*(){if(this._initialized)return XA.WebComponentManager.unregisterWebComponent(this._embeddingIdCounter),this.updateRendering(r)})}updateRendering(r){return ZA(this,void 0,void 0,function*(){try{if(this._initialized=!0,!r){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if((yield this.auth(vN.getSiteId(r)))===KA.TableauAuthResponse.Failure){console.debug("Authentication failed.");return}if(!this.src){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if(!this.iframe){console.debug("No iframe available to update the src.");return}const c=this.readCustomParamsFromChildren();this._embeddingIdCounter=XA.WebComponentManager.registerWebComponent(this);const f=xN.createAskDataUrl(this.src,this.constructOptions(),this._embeddingIdCounter,c).toString();this.iframe.src=f,this.raiseIframeSrcUpdatedNotification();return}catch(a){console.warn(a)}})}constructOptions(){return{origin:this.origin,showEmbed:this.showEmbed,showPin:this.showPin,showSave:this.showSave,showShare:this.showShare,token:this.token,iframeAuth:this.iframeAuth,debug:this.debug}}get origin(){const r=this.getAttribute(xi.AskDataAttributes.Origin);return r||void 0}set origin(r){r?this.setAttribute(xi.AskDataAttributes.Origin,r):this.removeAttribute(xi.AskDataAttributes.Origin)}get showEmbed(){return this.hasAttribute(xi.AskDataAttributes.ShowEmbed)}set showEmbed(r){r?this.setAttribute(xi.AskDataAttributes.ShowEmbed,""):this.removeAttribute(xi.AskDataAttributes.ShowEmbed)}get showPin(){return this.hasAttribute(xi.AskDataAttributes.ShowPin)}set showPin(r){r?this.setAttribute(xi.AskDataAttributes.ShowPin,""):this.removeAttribute(xi.AskDataAttributes.ShowPin)}get showShare(){return this.hasAttribute(xi.AskDataAttributes.ShowShare)}set showShare(r){r?this.setAttribute(xi.AskDataAttributes.ShowShare,""):this.removeAttribute(xi.AskDataAttributes.ShowShare)}get showSave(){return this.hasAttribute(xi.AskDataAttributes.ShowSave)}set showSave(r){r?this.setAttribute(xi.AskDataAttributes.ShowSave,""):this.removeAttribute(xi.AskDataAttributes.ShowSave)}}ug.TableauAskData=bN;var hg={},Sb={},Ab={};Object.defineProperty(Ab,"__esModule",{value:!0});const mx=$r;class wN{constructor(r){this._registryId=r}getAbstractQueryWithDataModel(){return mx.ApiServiceRegistry.get(this._registryId).getService("EmbeddingVizApiService").getEmbeddingAbstractQueryAsync()}getVizStateWithDataModel(){return mx.ApiServiceRegistry.get(this._registryId).getService("EmbeddingVizApiService").getEmbeddingVizStateWithDataModelAsync()}setVizStateWithDataModel(r){return mx.ApiServiceRegistry.get(this._registryId).getService("EmbeddingVizApiService").setEmbeddingVizStateWithDataModelAsync(r)}}Ab.AuthoringWorksheetImpl=wN;var Tb={};Object.defineProperty(Tb,"__esModule",{value:!0});class EN{constructor(r){this._authoringWorksheetImpl=r}getAbstractQueryWithDataModelAsync(){return this._authoringWorksheetImpl.getAbstractQueryWithDataModel()}getVizStateWithDataModelAsync(){return this._authoringWorksheetImpl.getVizStateWithDataModel()}setVizStateWithDataModelAsync(r){return this._authoringWorksheetImpl.setVizStateWithDataModel(r)}}Tb.AuthoringWorksheet=EN;var SN=gt&&gt.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var a in t)Object.hasOwnProperty.call(t,a)&&(r[a]=t[a]);return r.default=t,r};Object.defineProperty(Sb,"__esModule",{value:!0});const YA=SN(Or),AN=$r,TN=Ab,CN=Tb;class IN{constructor(r,a){this._workbookImpl=r,this._registryId=a}get activeSheet(){if(this._workbookImpl.activeSheet.sheetType===YA.SheetType.Worksheet){const r=new TN.AuthoringWorksheetImpl(this._registryId);return new CN.AuthoringWorksheet(r)}throw new AN.TableauError(YA.EmbeddingErrorCodes.InvalidSheetType,"Worksheet type not yet supported in Authoring")}}Sb.AuthoringWorkbook=IN;var Cb={},cz={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});const r=xl;t.VizUrlMode={Viewing:"views",Authoring:"authoring"};class a{constructor(f,_){this._url=f,this._segments=_}get mode(){return this._segments.mode}get siteId(){return this._segments.siteId}get workbookId(){return this._segments.workbookId}get sheetId(){return this._segments.sheetId}get customView(){return this._segments.customView}static create(f){const _=r.canonicalizeVizPortalRoutingHashes(new URL(f.toString())),b=a._parsePathName(_.pathname);return _.pathname=a._buildPathName(b),new a(_,b)}toURL(){return new URL(this.toString())}toString(){return this._url.toString()}withMode(f){if(this._segments.mode===f)return this;const _=this._getSegmentsForMode(f);return this._makeVizUrlFromPathSegments(_)}withCustomView(f){var _;if(f.luid===((_=this.customView)===null||_===void 0?void 0:_.luid)&&f.name===this.customView.name)return this;const b=this._getSegmentsForMode(this.mode);return b.customView=f,this._makeVizUrlFromPathSegments(b)}withSheetId(f){if(this.sheetId===f)return this;const _=Object.assign(Object.assign({},this._segments),{sheetId:f});return this._makeVizUrlFromPathSegments(_)}withWorkbookId(f){if(this.workbookId===f)return this;const _=Object.assign(Object.assign({},this._segments),{workbookId:f});return this._makeVizUrlFromPathSegments(_)}_getSegmentsForMode(f){return f===t.VizUrlMode.Authoring&&(this._segments.customView=void 0),Object.assign(Object.assign({},this._segments),{mode:f})}_makeVizUrlFromPathSegments(f){const _=a._buildPathName(f),b=new URL(this._url.toString());return b.pathname=_,new a(b,f)}static _parsePathName(f){var _,b,s;const S=f.split("/").filter(j=>j);if(S.length===0)throw new Error("Invalid path name");let C;if(S[0]==="t"){if(S.length<2)throw new Error(`Invalid site in path '${f}'`);C=S[1],S.splice(0,2)}const k=S.shift();if(!k)throw new Error(`Missing mode in path '${f}'`);const M=k;if(!Object.values(t.VizUrlMode).includes(M))throw new Error(`Invalid Viz Url Mode '${k}' in path '${f}'`);if(S.length===0)throw new Error(`Missing workbook/sheet name in path '${f}'`);const L=(_=S.shift(),_??""),V=S.shift();if(S.length!==0&&S.length!==2)throw new Error(`Invalid path name: unknown parts after sheet id: '${f}'`);let O;if(S.length===2){const j=(b=S.shift(),b??""),H=(s=S.shift(),s??"");O={luid:j,name:H}}return{mode:M,siteId:C,workbookId:L,sheetId:V,customView:O}}static _buildPathName(f){const _=[];return f.siteId&&(_.push("t"),_.push(f.siteId)),_.push(f.mode),f.workbookId&&_.push(f.workbookId),f.sheetId&&_.push(f.sheetId),f.customView&&f.mode===t.VizUrlMode.Viewing&&(_.push(f.customView.luid),_.push(f.customView.name)),_.join("/")}}t.VizUrl=a})(cz);(function(t){Object.defineProperty(t,"__esModule",{value:!0});const r=Or,a=ho,c=$r,f=xl,_=cz;var b;(function(M){M[M.Viewing=0]="Viewing",M[M.Authoring=1]="Authoring"})(b=t.EmbeddingUrlMode||(t.EmbeddingUrlMode={}));const s=new Map([[b.Viewing,_.VizUrlMode.Viewing],[b.Authoring,_.VizUrlMode.Authoring]]);class S extends f.EmbeddingUrlBuilder{constructor(L){super(),this._url=L,this._optionNames=a.VizOptionNames}appendFilters(L){for(const V of L)this._url.searchParams.append(V.field,V.value);return this}appendParams(L){for(const V of L)this._url.searchParams.append(V.name,V.value);return this}sanitizeParameterValue(L,V){let O;switch(L){case a.VizOptionNames.hideTabs:O=this.sanitizeValue(!V);break;case a.VizOptionNames.toolbar:O=this.sanitizeValue(V===r.Toolbar.Hidden?!1:V);break;default:O=this.sanitizeValue(V);break}return O}}t.EmbeddingVizUrlBuilder=S;function C(M,L,V,O,j,H,Z){if(!M)throw new c.TableauError(r.EmbeddingErrorCodes.InternalError,"We should not have attempted to render the component without a src");const U=s.get(L);if(!U)throw new c.TableauError(r.EmbeddingErrorCodes.InternalError,`'${L}' is not yet supported.`);const $=M.split("?")[0];let J;try{J=new URL($),f.validateUrl(J)}catch(ye){throw new c.TableauError(r.EmbeddingErrorCodes.InvalidUrl,ye.message)}try{J=_.VizUrl.create($).withMode(U).toURL()}catch{}const le=k(J,O),pe=new S(J).appendDefaultParameters(le).appendUserOptions(V).appendFilters(j).appendParams(H).appendCustomParams(Z);return V.iframeAuth&&pe.setToken(V.token),pe.build()}t.createVizUrl=C;function k(M,L){const V=new Map;V.set(a.VizOptionNames.Embed,f.SANITIZED_VALUES.YES_VALUE),V.set(a.VizOptionNames.ApiID,`embhost${L}`),M.hostname==="public.tableau.com"&&V.set(a.VizOptionNames.ShowVizHome,f.SANITIZED_VALUES.NO_VALUE);const O=`${a.INTERNAL_CONTRACT_VERSION.major}.${a.INTERNAL_CONTRACT_VERSION.minor}.${a.INTERNAL_CONTRACT_VERSION.fix}`;V.set(a.VizOptionNames.ApiInternalVersion,O);const j=c.ApiVersion.Instance.formattedValue;return V.set(a.VizOptionNames.ApiExternalVersion,j),V.set(a.VizOptionNames.NavType,"0"),V.set(a.VizOptionNames.NavSrc,"Opt"),V}})(Cb);var mh={},Ib={},kb={};Object.defineProperty(kb,"__esModule",{value:!0});class kN{constructor(r){this._vizSize=r}get vizSize(){return this._vizSize}}kb.FirstVizSizeKnownEvent=kN;var Pb={};Object.defineProperty(Pb,"__esModule",{value:!0});class PN{constructor(r,a){this._oldSheetName=r,this._newSheetName=a}get oldSheetName(){return this._oldSheetName}get newSheetName(){return this._newSheetName}}Pb.TabSwitchedEvent=PN;var zb={};Object.defineProperty(zb,"__esModule",{value:!0});class zN{constructor(r,a){this._canRedo=r,this._canUndo=a}get canRedo(){return this._canRedo}get canUndo(){return this._canUndo}}zb.ToolbarStateChangedEvent=zN;var Db={},DN=gt&&gt.__awaiter||function(t,r,a,c){function f(_){return _ instanceof a?_:new a(function(b){b(_)})}return new(a||(a=Promise))(function(_,b){function s(k){try{C(c.next(k))}catch(M){b(M)}}function S(k){try{C(c.throw(k))}catch(M){b(M)}}function C(k){k.done?_(k.value):f(k.value).then(s,S)}C((c=c.apply(t,r||[])).next())})},MN=gt&&gt.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var a in t)Object.hasOwnProperty.call(t,a)&&(r[a]=t[a]);return r.default=t,r};Object.defineProperty(Db,"__esModule",{value:!0});const na=MN(Or),Ym=ho,Gr=$r;class RN extends Gr.WorkbookImpl{constructor(r,a){super(),this._registryId=a,this._publishedSheetsInfo=[],this._customViews=new Map,this._name=r.workbookName,this._canDownloadWorkbook=r.canDownloadWorkbook,this.initializeWorkbook(r)}get activeSheet(){return this._activeSheetImpl}get publishedSheetsInfo(){return this._publishedSheetsInfo}get name(){return this._name}get canDownloadWorkbook(){return this._canDownloadWorkbook}get pendingTabSwitchPromise(){return this._pendingTabSwitchPromise}get pendingShowCustomViewPromise(){return this._pendingShowCustomViewPromise}clearPendingShowCustomViewPromise(){this._pendingShowCustomViewPromise=void 0}get activeCustomView(){return this._currentCustomView}activateSheetAsync(r){Gr.ErrorHelpers.verifyParameter(r,"sheetNameOrIndex");let a=this.convertSheetIndexToSheetName(r);return Gr.ErrorHelpers.verifyParameterType(a,"string","sheetNameOrIndex"),this.validatePublishedSheet(a)||this.verifyDashboardSheets(a),this._activeSheetImpl&&a===this._activeSheetImpl.name?new Promise((_,b)=>{_(this)}):(Gr.ApiServiceRegistry.get(this._registryId).getService("viz-service").activateSheetAsync(a),new Promise((_,b)=>{this._pendingTabSwitchPromise={resolve:_,reject:b}}))}getParametersAsync(){return Gr.ApiServiceRegistry.get(this._registryId).getService("parameters-service").getAllParametersAsync()}changeParameterValueAsync(r,a){return DN(this,void 0,void 0,function*(){Gr.ErrorHelpers.verifyParameter(r,"parameterName");const f=yield Gr.ApiServiceRegistry.get(this._registryId).getService("parameters-service").findParameterByNameAsync(r);if(f)return f.changeValueAsync(a).then(()=>f)})}updateExistingActiveSheetReferences(r){if(this._activeSheetImpl){if(this._activeSheetImpl.name===r)return;this._activeSheetImpl.active=!1,this._publishedSheetsInfo.forEach((a,c)=>{a.name===this._activeSheetImpl.name&&(a.active=!1)})}}processCustomViews(r,a){var c;const f=(c=a.currentView)===null||c===void 0?void 0:c.luid;let _=[];switch(r){case Ym.NotificationId.CustomViewsLoaded:case Ym.NotificationId.CustomViewSaved:{if(this.refreshCustomViewCache(a),f){const b=this._customViews.get(f);b&&_.push(b)}break}case Ym.NotificationId.CustomViewRemoved:{let b=new Map(this._customViews);this._customViews.clear(),a.customViewsList.map(s=>{this._customViews.set(s.luid,new Gr.CustomViewImpl(s,this._registryId)),b.delete(s.luid)});for(let s of b.values())_.push(s);break}case Ym.NotificationId.CustomViewSetDefault:{this.refreshCustomViewCache(a);const b=a.customViewsList.find(s=>s.isDefault);b&&_.push(new Gr.CustomViewImpl(b,this._registryId));break}}return this._currentCustomView=f?this._customViews.get(f):void 0,_}refreshCustomViewCache(r){this._customViews.clear(),r.customViewsList.map(a=>{this._customViews.set(a.luid,new Gr.CustomViewImpl(a,this._registryId))})}revertAllAsync(){return Gr.ApiServiceRegistry.get(this._registryId).getService("ToolbarService").revertAllAsync()}getCustomViewsAsync(){return Gr.ApiServiceRegistry.get(this._registryId).getService("viz-service").getCustomViewsAsync()}showCustomViewAsync(r){return Gr.ApiServiceRegistry.get(this._registryId).getService("viz-service").showCustomViewAsync(r),new Promise((f,_)=>{this._pendingShowCustomViewPromise={resolve:f,reject:_}})}removeCustomViewAsync(r){return Gr.ApiServiceRegistry.get(this._registryId).getService("viz-service").removeCustomViewAsync(r)}saveCustomViewAsync(r){return Gr.ApiServiceRegistry.get(this._registryId).getService("viz-service").saveCustomViewAsync(r)}setActiveCustomViewAsDefaultAsync(){return Gr.ApiServiceRegistry.get(this._registryId).getService("viz-service").setActiveCustomViewAsDefaultAsync()}initializeWorkbook(r){r.publishedSheets.forEach((a,c)=>{const f=Gr.SheetUtils.getSheetSizeFromSizeConstraints(a.sizeConstraint),_=a.name===r.currWorksheetName,b=!1,s=Gr.SheetUtils.getSheetTypeEnum(a.sheetType),S=new Gr.SheetInfoImpl(a.name,s,f,c,_,b,a.url);if(this._publishedSheetsInfo.push(S),_)switch(S.sheetType){case na.SheetType.Worksheet:{const C={worksheet:S.name};this._activeSheetImpl=new Gr.WorksheetImpl(S,this._registryId,C,null,null);break}case na.SheetType.Dashboard:{const C={sheetName:S.name,isDashboard:!0};this._activeSheetImpl=new Gr.DashboardImpl(S,r.dashboardZones,C,this._registryId,null);break}case na.SheetType.Story:{if(!r.story)throw new Gr.TableauError(na.SharedErrorCodes.ServerError,"Unable to receive story information from Tableau");this._activeSheetImpl=new Gr.StoryImpl(S,r.story,r.publishedSheets,this._registryId);break}default:throw new Gr.TableauError(na.SharedErrorCodes.ServerError,"Invalid SheetType")}})}convertSheetIndexToSheetName(r){if(typeof r=="number"){const a=r;if(this.publishedSheetsInfo[a])return this.publishedSheetsInfo[a].name;throw new Gr.TableauError(na.EmbeddingErrorCodes.IndexOutOfRange,`Index ${a} is out of range.`)}return r}validatePublishedSheet(r){return this.publishedSheetsInfo.find(c=>c.name===r)!==void 0}verifyDashboardSheets(r){if(this._activeSheetImpl.sheetType===na.SheetType.Dashboard){let a=this._activeSheetImpl,c=a.worksheetsImpl.findIndex(f=>f.name===r);if(c!==-1){if(a.worksheetsImpl[c].hidden)throw new Gr.TableauError(na.SharedErrorCodes.ServerError,"Cannot activate hidden sheet");return}}throw new Gr.TableauError(na.EmbeddingErrorCodes.SheetNotInWorkbook,"Sheet is not found in Workbook")}}Db.EmbeddingWorkbookImpl=RN;var Jm={},Qm={},e0={},t0={},r0={},n0={},JA;function Mb(){if(JA)return n0;JA=1;var t=gt&&gt.__importStar||function(_){if(_&&_.__esModule)return _;var b={};if(_!=null)for(var s in _)Object.hasOwnProperty.call(_,s)&&(b[s]=_[s]);return b.default=_,b};Object.defineProperty(n0,"__esModule",{value:!0});const r=t(Or),a=$r,c=Gg();let f=class{constructor(b,s){this._sheetImpl=b,this._workbookImpl=s}get isHidden(){return this._sheetImpl.hidden}get isActive(){return this._sheetImpl.active}get name(){return this._sheetImpl.name}get sheetType(){return this._sheetImpl.sheetType}get size(){if(a.SheetUtils.isValidSheetSize(this._sheetImpl.size))return this._sheetImpl.size;throw new a.TableauError(r.EmbeddingErrorCodes.NotImplemented,"Not implemented")}get url(){if(this.isHidden)throw new a.TableauError(r.EmbeddingErrorCodes.NoUrlForHiddenWorksheet,"No URL for hidden worksheet");return this._sheetImpl.url}get index(){return this._sheetImpl.index}get workbook(){return new c.Workbook(this._workbookImpl)}changeSizeAsync(b){return this._sheetImpl.changeSizeAsync(b)}};return n0.Sheet=f,n0}var i0={},o0={},s0={},QA;function uz(){if(QA)return s0;QA=1,Object.defineProperty(s0,"__esModule",{value:!0});const t=Rb();let r=class{constructor(c,f){this._storyPointInfoImpl=c,this._workbookImpl=f}get index(){return this._storyPointInfoImpl.index}get caption(){return this._storyPointInfoImpl.caption}get active(){return this._storyPointInfoImpl.active}get updated(){return this._storyPointInfoImpl.updated}get parentStory(){return new t.Story(this._storyPointInfoImpl.parentStory,this._workbookImpl)}};return s0.StoryPointInfo=r,s0}var eT;function Rb(){if(eT)return o0;eT=1;var t=gt&&gt.__importStar||function(s){if(s&&s.__esModule)return s;var S={};if(s!=null)for(var C in s)Object.hasOwnProperty.call(s,C)&&(S[C]=s[C]);return S.default=s,S};Object.defineProperty(o0,"__esModule",{value:!0});const r=t(Or),a=$r,c=Mb(),f=jg(),_=uz();let b=class extends c.Sheet{constructor(S,C){super(S,C),this._storyImpl=S}get activeStoryPoint(){if(!this._storyImpl.activeStoryPoint)throw new a.TableauError(r.EmbeddingErrorCodes.ImplementationError,"Active story point has not been initialized");return new f.StoryPoint(this._storyImpl.activeStoryPoint,this._workbookImpl)}get storyPointsInfo(){return this._storyImpl.storyPointsInfo.map(S=>new _.StoryPointInfo(S,this._workbookImpl))}activateNextStoryPointAsync(){return this._storyImpl.activateNextStoryPointAsync().then(S=>new f.StoryPoint(S,this._workbookImpl))}activatePreviousStoryPointAsync(){return this._storyImpl.activatePreviousStoryPointAsync().then(S=>new f.StoryPoint(S,this._workbookImpl))}activateStoryPointAsync(S){return this._storyImpl.activateStoryPointAsync(S).then(C=>new f.StoryPoint(C,this._workbookImpl))}revertStoryPointAsync(S){return this._storyImpl.revertStoryPointAsync(S).then(C=>new _.StoryPointInfo(C,this._workbookImpl))}};return o0.Story=b,o0}var tT;function jg(){if(tT)return i0;tT=1;var t=gt&&gt.__importStar||function(s){if(s&&s.__esModule)return s;var S={};if(s!=null)for(var C in s)Object.hasOwnProperty.call(s,C)&&(S[C]=s[C]);return S.default=s,S};Object.defineProperty(i0,"__esModule",{value:!0});const r=t(Or),a=$r,c=Wg(),f=Rb(),_=$g();let b=class{constructor(S,C){this._storyPointImpl=S,this._workbookImpl=C}get index(){return this._storyPointImpl.index}get caption(){return this._storyPointImpl.caption}get active(){return this._storyPointImpl.active}get updated(){return this._storyPointImpl.updated}get containedSheet(){const S=this._storyPointImpl.containedSheet;if(S)switch(S.sheetType){case r.SheetType.Worksheet:return new _.Worksheet(S,this._workbookImpl);case r.SheetType.Dashboard:return new c.Dashboard(S,this._workbookImpl);case r.SheetType.Story:throw new a.TableauError(r.EmbeddingErrorCodes.ImplementationError,"A story cannot contain another story");default:throw new a.TableauError(r.EmbeddingErrorCodes.ImplementationError,"Unable to initialize contained sheet")}}get parentStory(){return new f.Story(this._storyPointImpl.parentStory,this._workbookImpl)}};return i0.StoryPoint=b,i0}var rT;function $g(){if(rT)return r0;rT=1,Object.defineProperty(r0,"__esModule",{value:!0});const t=Wg(),r=Mb(),a=jg();let c=class extends r.Sheet{constructor(_,b){super(_,b),this._worksheetImpl=_}get parentDashboard(){return this._worksheetImpl.parentDashboard==null?null:new t.Dashboard(this._worksheetImpl.parentDashboard,this._workbookImpl)}get parentStoryPoint(){return this._worksheetImpl.parentStoryPoint==null?null:new a.StoryPoint(this._worksheetImpl.parentStoryPoint,this._workbookImpl)}getDataSourcesAsync(){return this._worksheetImpl.getDataSourcesAsync()}getSummaryDataAsync(_){return this._worksheetImpl.getSummaryDataAsync(_)}getSummaryDataReaderAsync(_,b){return this._worksheetImpl.getSummaryDataReaderAsync(_,b)}getSummaryColumnsInfoAsync(){return this._worksheetImpl.getSummaryColumnsInfoAsync()}getUnderlyingDataAsync(_){return console.warn("Worksheet.getUnderlyingDataAsync is deprecated. Please use Worksheet.getUnderlyingTablesAsync and Worksheet.getUnderlyingTableDataAsync"),this._worksheetImpl.getUnderlyingDataAsync(_)}getUnderlyingTablesAsync(){return this._worksheetImpl.getUnderlyingTablesAsync()}getUnderlyingTableDataAsync(_,b){return this._worksheetImpl.getUnderlyingTableDataAsync(_,b)}getUnderlyingTableDataReaderAsync(_,b,s){return this._worksheetImpl.getUnderlyingTableDataReaderAsync(_,b,s)}getFiltersAsync(){return this._worksheetImpl.getFiltersAsync()}applyFilterAsync(_,b,s,S){return this._worksheetImpl.applyFilterAsync(_,b,s,S)}applyRangeFilterAsync(_,b){return this._worksheetImpl.applyRangeFilterAsync(_,b)}clearFilterAsync(_){return this._worksheetImpl.clearFilterAsync(_)}applyRelativeDateFilterAsync(_,b){return this._worksheetImpl.applyRelativeDateFilterAsync(_,b)}applyHierarchicalFilterAsync(_,b,s,S){return this._worksheetImpl.applyHierarchicalFilterAsync(_,b,s,S)}clearSelectedMarksAsync(){return this._worksheetImpl.clearSelectedMarksAsync()}getSelectedMarksAsync(){return this._worksheetImpl.getSelectedMarksAsync()}annotateMarkAsync(_,b){return this._worksheetImpl.annotateMarkAsync(_,b)}getAnnotationsAsync(){return this._worksheetImpl.getAnnotationsAsync()}removeAnnotationAsync(_){return this._worksheetImpl.removeAnnotationAsync(_)}selectMarksByValueAsync(_,b){return this._worksheetImpl.selectMarksByValueAsync(_,b)}appendContextMenuAsync(_,b){return this._worksheetImpl.appendContextMenuAsync(_,b)}removeContextMenuAsync(_,b){return this._worksheetImpl.removeContextMenuAsync(_,b)}executeContextMenuAsync(_,b){return this._worksheetImpl.executeContextMenuAsync(_,b)}renameContextMenuAsync(_,b,s){return this._worksheetImpl.renameContextMenuAsync(_,b,s)}getVisualSpecificationAsync(){return this._worksheetImpl.getVisualSpecificationAsync()}addMarksCardFieldsAsync(_,b,s,S){return this._worksheetImpl.addMarksCardFieldsAsync(_,b,s,S)}moveMarksCardFieldAsync(_,b,s,S){return this._worksheetImpl.moveMarksCardFieldAsync(_,b,s,S)}spliceMarksCardFieldsAsync(_,b,s,S,C){return this._worksheetImpl.spliceMarksCardFieldsAsync(_,b,s,S,C)}};return r0.Worksheet=c,r0}var nT;function BN(){if(nT)return t0;nT=1,Object.defineProperty(t0,"__esModule",{value:!0});const t=Wg(),r=$g();let a=class{constructor(f,_){this._dashboardObjectImpl=f,this._workbookImpl=_}get dashboard(){return new t.Dashboard(this._dashboardObjectImpl.dashboardImpl,this._workbookImpl)}get type(){return this._dashboardObjectImpl.type}get position(){return this._dashboardObjectImpl.position}get size(){return this._dashboardObjectImpl.size}get worksheet(){if(this._dashboardObjectImpl.worksheetImpl)return new r.Worksheet(this._dashboardObjectImpl.worksheetImpl,this._workbookImpl)}get name(){return this._dashboardObjectImpl.name}get isFloating(){return this._dashboardObjectImpl.isFloating}get isVisible(){return this._dashboardObjectImpl.isVisible}get id(){return this._dashboardObjectImpl.id}};return t0.DashboardObject=a,t0}var iT;function Wg(){if(iT)return e0;iT=1,Object.defineProperty(e0,"__esModule",{value:!0});const t=BN(),r=Mb(),a=jg(),c=$g();let f=class extends r.Sheet{constructor(b,s){super(b,s),this._dashboardImpl=b,b.initializeWithPublicInterfaces()}get objects(){return this._dashboardImpl.objects.map(b=>new t.DashboardObject(b,this._workbookImpl))}get worksheets(){return this._dashboardImpl.worksheetsImpl.map(b=>new c.Worksheet(b,this._workbookImpl))}get parentStoryPoint(){return this._dashboardImpl.parentStoryPoint==null?null:new a.StoryPoint(this._dashboardImpl.parentStoryPoint,this._workbookImpl)}getFiltersAsync(){return this._dashboardImpl.getFiltersAsync()}applyFilterAsync(b,s,S,C){return this._dashboardImpl.applyFilterAsync(b,s,S,C)}};return e0.Dashboard=f,e0}var qg={};Object.defineProperty(qg,"__esModule",{value:!0});class LN{constructor(r){this.parameterImpl=r}get name(){return this.parameterImpl.name}get currentValue(){return this.parameterImpl.currentValue}get dataType(){return this.parameterImpl.dataType}get allowableValues(){return this.parameterImpl.allowableValues}get id(){return this.parameterImpl.id}changeValueAsync(r){return this.parameterImpl.changeValueAsync(r)}}qg.Parameter=LN;var a0={},oT;function FN(){if(oT)return a0;oT=1;var t=gt&&gt.__importStar||function(_){if(_&&_.__esModule)return _;var b={};if(_!=null)for(var s in _)Object.hasOwnProperty.call(_,s)&&(b[s]=_[s]);return b.default=_,b};Object.defineProperty(a0,"__esModule",{value:!0});const r=t(Or),a=$r,c=Gg();let f=class{constructor(b,s){this._sheetInfoImpl=b,this._workbookImpl=s}get name(){return this._sheetInfoImpl.name}get sheetType(){return this._sheetInfoImpl.sheetType}get index(){if(this._sheetInfoImpl.index!==void 0)return this._sheetInfoImpl.index;throw new a.TableauError(r.EmbeddingErrorCodes.ImplementationError,"index not implemented")}get isActive(){return this._sheetInfoImpl.isActive?this._sheetInfoImpl.isActive:!1}get isHidden(){return this._sheetInfoImpl.isHidden?this._sheetInfoImpl.isHidden:!1}get workbook(){return new c.Workbook(this._workbookImpl)}get url(){return this._sheetInfoImpl.url?this._sheetInfoImpl.url:""}get size(){if(a.SheetUtils.isValidSheetSize(this._sheetInfoImpl.sheetSize))return this._sheetInfoImpl.sheetSize;throw new a.TableauError(r.EmbeddingErrorCodes.NotImplemented,"Not implemented")}};return a0.SheetInfo=f,a0}var sT;function Gg(){if(sT)return Qm;sT=1;var t=gt&&gt.__importStar||function(k){if(k&&k.__esModule)return k;var M={};if(k!=null)for(var L in k)Object.hasOwnProperty.call(k,L)&&(M[L]=k[L]);return M.default=k,M};Object.defineProperty(Qm,"__esModule",{value:!0});const r=t(Or),a=$r,c=dz(),f=Wg(),_=qg,b=FN(),s=Rb(),S=$g();let C=class{constructor(M){this._workbookImpl=M}get activeSheet(){switch(this._workbookImpl.activeSheet.sheetType){case r.SheetType.Worksheet:return new S.Worksheet(this._workbookImpl.activeSheet,this._workbookImpl);case r.SheetType.Dashboard:return new f.Dashboard(this._workbookImpl.activeSheet,this._workbookImpl);case r.SheetType.Story:return new s.Story(this._workbookImpl.activeSheet,this._workbookImpl);default:throw new a.TableauError(r.EmbeddingErrorCodes.ImplementationError,"Unable to initialize ActiveSheet")}}get publishedSheetsInfo(){return this._workbookImpl.publishedSheetsInfo.map(M=>new b.SheetInfo(M,this._workbookImpl))}get name(){return this._workbookImpl.name}get activeCustomView(){if(this._workbookImpl.activeCustomView)return new c.CustomView(this._workbookImpl.activeCustomView,this._workbookImpl)}activateSheetAsync(M){return this._workbookImpl.activateSheetAsync(M).then(L=>(this._workbookImpl!==L&&(this._workbookImpl=L),this.activeSheet))}revertAllAsync(){return this._workbookImpl.revertAllAsync()}getCustomViewsAsync(){return this._workbookImpl.getCustomViewsAsync().then(M=>M.map(L=>new c.CustomView(L,this._workbookImpl)))}showCustomViewAsync(M){return this._workbookImpl.showCustomViewAsync(M).then(L=>L?new c.CustomView(L,this._workbookImpl):void 0)}removeCustomViewAsync(M){return this._workbookImpl.removeCustomViewAsync(M).then(L=>new c.CustomView(L,this._workbookImpl))}saveCustomViewAsync(M){return this._workbookImpl.saveCustomViewAsync(M).then(L=>new c.CustomView(L,this._workbookImpl))}setActiveCustomViewAsDefaultAsync(){return this._workbookImpl.setActiveCustomViewAsDefaultAsync()}getParametersAsync(){return this._workbookImpl.getParametersAsync().then(M=>M.map(L=>new _.Parameter(L)))}changeParameterValueAsync(M,L){return this._workbookImpl.changeParameterValueAsync(M,L).then(V=>{if(V)return new _.Parameter(V);throw new a.TableauError(r.EmbeddingErrorCodes.InvalidParameter,`Invalid parameter:  ${M}`)})}};return Qm.Workbook=C,Qm}var aT;function dz(){if(aT)return Jm;aT=1,Object.defineProperty(Jm,"__esModule",{value:!0});const t=Gg();let r=class hz{constructor(c,f){this._customViewImpl=c,this._workbookImpl=f}get name(){return this._customViewImpl.name}set name(c){this._customViewImpl.name=c}get shared(){return this._customViewImpl.shared}set shared(c){this._customViewImpl.shared=c}get default(){return this._customViewImpl.isDefault}set default(c){this._customViewImpl.isDefault=c}get ownerName(){return this._customViewImpl.ownerName}get url(){return this._customViewImpl.url}get workbook(){return new t.Workbook(this._workbookImpl)}saveAsync(){return this._customViewImpl.saveAsync().then(c=>new hz(c,this._workbookImpl))}};return Jm.CustomView=r,Jm}var Bb={};Object.defineProperty(Bb,"__esModule",{value:!0});class ON{constructor(r,a){this._sheetSize=r,this._chromeHeight=a}get sheetSize(){return this._sheetSize}get chromeHeight(){return this._chromeHeight}}Bb.VizSize=ON;var ef={},gh={},Lb={};Object.defineProperty(Lb,"__esModule",{value:!0});const NN=ho,UN=$r;class VN extends UN.ServiceImplBase{get serviceName(){return"authentication"}setAuthToken(r){const a={authToken:r};return this.execute(NN.VerbId.Authenticate,a).then(c=>{})}}Lb.AuthServiceImpl=VN;var Fb={};Object.defineProperty(Fb,"__esModule",{value:!0});const lT=Or,zs=ho,gx=$r;class jN extends gx.ServiceImplBase{get serviceName(){return"EmbeddingVizApiService"}getEmbeddingVizStateWithDataModelAsync(){const r=zs.VerbId.GetVizStateWithDataModel,a={[zs.ParameterId.FunctionName]:"getVizStateWithDataModel"};return this.execute(r,a).then(c=>{const f=c.result;return this.checkForErrorParameter(f),{vizStateWithDataModel:f[zs.ParameterId.VizAPIStateWithDataModel]}})}checkForErrorParameter(r){if(r[zs.ParameterId.VizAPIStateWarningMsg])throw new gx.TableauError(lT.ErrorCodes.InternalError,r[zs.ParameterId.VizAPIStateWarningMsg])}setEmbeddingVizStateWithDataModelAsync(r){const a=zs.VerbId.SetVizStateWithDataModel,c={[zs.ParameterId.FunctionName]:"setVizStateWithDataModel",[zs.ParameterId.VizAPIStateWithDataModel]:r.vizStateWithDataModel};return this.execute(a,c).then(f=>{if(Object.keys(f.result).length!==0){const _=f.result;throw new gx.TableauError(lT.ErrorCodes.InternalError,_)}})}getEmbeddingAbstractQueryAsync(){const r=zs.VerbId.GetEmbeddingAbstractQueryWithDataModel,a={[zs.ParameterId.FunctionName]:"getEmbeddingAbstractQuery"};return this.execute(r,a).then(c=>c.result)}}Fb.EmbeddingVizApiServiceImpl=jN;var Ob={};Object.defineProperty(Ob,"__esModule",{value:!0});const $N=$r;class WN extends $N.NotificationServiceImplBase{get serviceName(){return"initialization-service"}}Ob.InitializationServiceImpl=WN;var Nb={};Object.defineProperty(Nb,"__esModule",{value:!0});const mn=ho,qN=$r;class GN extends qN.ServiceImplBase{get serviceName(){return"ToolbarService"}revertAllAsync(){const r=mn.VerbId.RevertWorkbook,a={[mn.ParameterId.FunctionName]:"revertAllAsync"};return this.execute(r,a).then(c=>{})}redoAsync(){const r=mn.VerbId.Redo,a={[mn.ParameterId.FunctionName]:"redoAsync"};return this.execute(r,a).then(c=>{})}undoAsync(){const r=mn.VerbId.Undo,a={[mn.ParameterId.FunctionName]:"undoAsync"};return this.execute(r,a).then(c=>{})}exportImageAsync(){const r=mn.VerbId.ExportImage,a={[mn.ParameterId.FunctionName]:"exportImageAsync"};return this.execute(r,a).then(c=>{})}setAutoUpdateAsync(r){const a=mn.VerbId.SetAutoUpdate,c={[mn.ParameterId.FunctionName]:"setAutoUpdateAsync",[mn.ParameterId.State]:r};return this.execute(a,c).then(()=>{})}displayDownloadWorkbookDialogAsync(){const r=mn.VerbId.DownloadWorkbook,a={[mn.ParameterId.FunctionName]:"displayDialogAsync(Workbook)"};return this.execute(r,a).then(c=>{})}displayExportPdfDialogAsync(){const r=mn.VerbId.ExportPdf,a={[mn.ParameterId.FunctionName]:"displayDialogAsync(ExportPDF)"};return this.execute(r,a).then(c=>{})}displayExportPowerpointDialogAsync(){const r=mn.VerbId.ExportPowerpoint,a={[mn.ParameterId.FunctionName]:"displayDialogAsync(ExportPowerPoint)"};return this.execute(r,a).then(c=>{})}displayExportDataDialogAsync(){const r=mn.VerbId.ExportData,a={[mn.ParameterId.FunctionName]:"displayDialogAsync(ExportData)"};return this.execute(r,a).then(c=>{})}displayExportCrosstabDialogAsync(){const r=mn.VerbId.ExportCrosstab,a={[mn.ParameterId.FunctionName]:"displayDialogAsync(ExportCrossTab)"};return this.execute(r,a).then(c=>{})}displayShareDialogAsync(){const r=mn.VerbId.Share,a={[mn.ParameterId.FunctionName]:"displayDialogAsync(Share)"};return this.execute(r,a).then(c=>{})}}Nb.ToolbarServiceImpl=GN;Object.defineProperty(gh,"__esModule",{value:!0});const $u=$r,HN=Lb,ZN=Fb,XN=Ob,KN=Nb;function YN(t,r){const a=$u.ApiServiceRegistry.get(r);a.registerService(new $u.ClientInfoServiceImpl(t,r)),a.registerService(new ZN.EmbeddingVizApiServiceImpl(t,r)),a.registerService(new $u.SizeServiceImpl(t,r)),a.registerService(new $u.StoryActivationServiceImpl(t,r)),a.registerService(new KN.ToolbarServiceImpl(t,r))}gh.registerAllEmbeddingServices=YN;function JN(t,r){$u.ApiServiceRegistry.get(r).registerService(new XN.InitializationServiceImpl(t))}gh.registerInitializationEmbeddingServices=JN;function QN(t,r){$u.ApiServiceRegistry.get(r).registerService(new HN.AuthServiceImpl(t,r))}gh.registerAuthServices=QN;Object.defineProperty(ef,"__esModule",{value:!0});var pz=gh;ef.registerAllEmbeddingServices=pz.registerAllEmbeddingServices;ef.registerInitializationEmbeddingServices=pz.registerInitializationEmbeddingServices;var _x=gt&&gt.__awaiter||function(t,r,a,c){function f(_){return _ instanceof a?_:new a(function(b){b(_)})}return new(a||(a=Promise))(function(_,b){function s(k){try{C(c.next(k))}catch(M){b(M)}}function S(k){try{C(c.throw(k))}catch(M){b(M)}}function C(k){k.done?_(k.value):f(k.value).then(s,S)}C((c=c.apply(t,r||[])).next())})},eU=gt&&gt.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var a in t)Object.hasOwnProperty.call(t,a)&&(r[a]=t[a]);return r.default=t,r};Object.defineProperty(Ib,"__esModule",{value:!0});const yr=eU(Or),ku=YD,jn=ho,Vr=$r,tU=Jp,rU=kb,nU=Pb,iU=zb,cT=Db,oU=dz(),sU=Bb,uT=ef,aU=gh,lU=Qp;class cU{constructor(r,a,c,f){if(this._viz=r,this._iframe=a,this._frameUrl=c,this._embeddingId=f,this._automaticUpdatesArePaused=!1,this._resizeEventType="resize",!this._iframe)throw new Vr.TableauError(yr.EmbeddingErrorCodes.InternalError,"Iframe has not been created yet")}get workbookImpl(){return this._workbookImpl}get iframe(){return this._iframe}get embeddingId(){return this._embeddingId}get exportScenariosForPdfAndPowerPoint(){return{currentSheetName:this._workbookImpl.activeSheet.name,exportableSheetNamesFromDashboard:this.exportableSheetNamesFromDashboard,exportableSheetNamesFromWorkbook:this.exportableSheetNamesFromWorkbook}}get exportableSheetNamesFromDashboard(){const r=this._workbookImpl.activeSheet;return r&&r.sheetType===yr.SheetType.Dashboard?r.getWorksheetNamesFromZones():[]}get exportableSheetNamesFromWorkbook(){const r=[];if(this._workbookImpl)for(const a of this._workbookImpl.publishedSheetsInfo)r.push(a.name);return r}get automaticUpdatesArePaused(){return this._automaticUpdatesArePaused}set automaticUpdatesArePaused(r){this._automaticUpdatesArePaused=r}getVisualIdForSheetName(r){var a,c,f;const _=this._workbookImpl.activeSheet;switch(_.sheetType){case yr.SheetType.Worksheet:if(_.name===r)return _.visualId;break;case yr.SheetType.Dashboard:{const b=_;for(const s of b.getWorksheetNamesFromZones())if(s===r)return{worksheet:s,dashboard:b.name};break}case yr.SheetType.Story:{const b=_,s=(a=b.activeStoryPoint)===null||a===void 0?void 0:a.containedSheet;if(s&&s.sheetType===yr.SheetType.Worksheet&&s.name===r){const S=Object.assign({},s.visualId);return S.dashboard=S.worksheet,S.storyboard=b.name,S.storyPointID=(c=b.activeStoryPoint)===null||c===void 0?void 0:c.storyPointId,S}else if(s&&s.sheetType===yr.SheetType.Dashboard){const S=s;for(const C of S.getWorksheetNamesFromZones())if(C===r)return{worksheet:C,dashboard:S.name,storyboard:b.name,storyPointID:(f=b.activeStoryPoint)===null||f===void 0?void 0:f.storyPointId}}break}default:throw new Vr.TableauError(yr.SharedErrorCodes.ServerError,"Invalid SheetType")}throw new Vr.TableauError(yr.SharedErrorCodes.InvalidParameter,"sheetName parameter must belong to a worksheet within the current view")}get exportableWorksheetNames(){var r;const a=this._workbookImpl.activeSheet;switch(a.sheetType){case yr.SheetType.Worksheet:return[a.name];case yr.SheetType.Dashboard:return a.getWorksheetNamesFromZones();case yr.SheetType.Story:{const c=(r=a.activeStoryPoint)===null||r===void 0?void 0:r.containedSheet;if(c&&c.sheetType===yr.SheetType.Worksheet)return[c.name];if(c&&c.sheetType===yr.SheetType.Dashboard)return c.getWorksheetNamesFromZones();break}}return[]}initializeViz(){const r=this._iframe.contentWindow;if(!r)throw new Vr.TableauError(yr.EmbeddingErrorCodes.InternalError,"Iframe has not been created yet");try{this._messenger=new jn.CrossFrameMessenger(window,r,this._frameUrl.origin),this._dispatcher=new Vr.CrossFrameDispatcher(this._messenger),uT.registerInitializationEmbeddingServices(this._dispatcher,this.embeddingId),aU.registerAuthServices(this._dispatcher,this.embeddingId);const a=Vr.ApiServiceRegistry.get(this.embeddingId).getService("initialization-service"),c=a.registerHandler(jn.NotificationId.FirstVizSizeKnown,()=>!0,_=>{this.handleVizSizeKnownEvent(_),c()}),f=a.registerHandler(jn.NotificationId.VizInteractive,()=>!0,_=>{this.handleVizInteractiveEvent(_),f()});a.registerHandler(jn.NotificationId.ReadyToReceiveAuthToken,()=>!0,()=>{this._viz.dispatchEvent(new CustomEvent(yr.EmbeddingTableauEventType.ReadyToReceiveAuthToken,{}))}),a.registerHandler(jn.NotificationId.ToolbarStateChanged,()=>!0,_=>this.handleToolbarStateEvent(_)),a.registerHandler(jn.NotificationId.TabSwitched,()=>!0,_=>this.handleTabSwitch(_)),a.registerHandler(jn.NotificationId.CustomViewsLoaded,()=>!0,_=>this.handleCustomViews(_)),a.registerHandler(jn.NotificationId.CustomViewRemoved,()=>!0,_=>this.handleCustomViewRemoved(_)),a.registerHandler(jn.NotificationId.CustomViewSaved,()=>!0,_=>this.handleCustomViewSaved(_)),a.registerHandler(jn.NotificationId.CustomViewSetDefault,()=>!0,_=>this.handleCustomViewSetDefault(_)),this._messenger.startListening()}catch{throw new Vr.TableauError(yr.EmbeddingErrorCodes.InternalError,"Unexpected error during initialization.")}}dispose(){this._messenger&&this._messenger.stopListening(),this.removeWindowResizeHandler()}getCurrentSrcAsync(){return Vr.ApiServiceRegistry.get(this.embeddingId).getService("viz-service").getCurrentSrcAsync()}revertAllAsync(){return Vr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService").revertAllAsync()}redoAsync(){return Vr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService").redoAsync()}undoAsync(){return Vr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService").undoAsync()}refreshDataAsync(){return Vr.ApiServiceRegistry.get(this.embeddingId).getService("data-source-service").refreshAsync()}pauseAutomaticUpdatesAsync(){return this._automaticUpdatesArePaused?Promise.resolve():this.setAutoUpdateAsync(!1)}resumeAutomaticUpdatesAsync(){return this._automaticUpdatesArePaused?this.setAutoUpdateAsync(!0):Promise.resolve()}toggleAutomaticUpdatesAsync(){return this.setAutoUpdateAsync(this._automaticUpdatesArePaused)}exportImageAsync(){return Vr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService").exportImageAsync()}exportCrosstabAsync(r,a){return _x(this,void 0,void 0,function*(){yield Vr.ApiServiceRegistry.get(this.embeddingId).getService("export-service").exportCrosstabAsync(r,a,this.exportableWorksheetNames,this._workbookImpl.activeSheet.sheetType)})}exportDataAsync(r,a=Vr.ExportHelpers.DefaultDataOptions){return Vr.ApiServiceRegistry.get(this.embeddingId).getService("export-service").exportDataAsync(this.getVisualIdForSheetName(r),a)}exportPowerPointAsync(r=[]){return _x(this,void 0,void 0,function*(){const a=Vr.ApiServiceRegistry.get(this.embeddingId).getService("export-service"),c=this.exportScenariosForPdfAndPowerPoint;r.length===0&&r.push(c.currentSheetName),yield a.exportPowerPointAsync(r,c)})}exportPDFAsync(r=[],a=Vr.ExportHelpers.DefaultPDFOptions){return _x(this,void 0,void 0,function*(){const c=Vr.ApiServiceRegistry.get(this.embeddingId).getService("export-service"),f=this.exportScenariosForPdfAndPowerPoint;r.length===0&&r.push(f.currentSheetName),yield c.exportPDFAsync(r,a,f)})}displayDialogAsync(r){const a=Vr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService");switch(r){case ku.TableauDialogType.ExportWorkbook:if(!this.workbookImpl.canDownloadWorkbook)throw new Vr.TableauError(yr.EmbeddingErrorCodes.DownloadWorkbookNotAllowed,"Download workbook is not allowed");return a.displayDownloadWorkbookDialogAsync();case ku.TableauDialogType.ExportPDF:return a.displayExportPdfDialogAsync();case ku.TableauDialogType.ExportPowerPoint:return a.displayExportPowerpointDialogAsync();case ku.TableauDialogType.ExportData:return a.displayExportDataDialogAsync();case ku.TableauDialogType.ExportCrossTab:return a.displayExportCrosstabDialogAsync();case ku.TableauDialogType.Share:return a.displayShareDialogAsync();default:throw new Vr.TableauError(yr.EmbeddingErrorCodes.UnknownDialogType,"Unknown dialog type")}}setAuthToken(r){Vr.ApiServiceRegistry.get(this.embeddingId).getService("authentication").setAuthToken(r)}setAutoUpdateAsync(r){return Vr.ApiServiceRegistry.get(this.embeddingId).getService("ToolbarService").setAutoUpdateAsync(r).then(()=>{this._automaticUpdatesArePaused=!r})}isVersionCompatible(r){return r?jn.VersionLessThan(jn.INTERNAL_CONTRACT_VERSION,r)||jn.VersionEqualTo(jn.INTERNAL_CONTRACT_VERSION,r):!1}updateIframeTitle(r){this._iframe.setAttribute("title",tU.getLocalizedTitle(navigator.language)+": "+r.workbookName+": "+r.currWorksheetName)}handleVizInteractiveEvent(r){if(!this._viz.disableVersionCheck&&!this.isVersionCompatible(r.platformVersion))throw this._messenger.stopListening(),new Vr.TableauError(yr.EmbeddingErrorCodes.IncompatibleVersionError,"The version of the Embedding library is not compatible with the version of Tableau. The visualization will load, but the Embedding API methods and events are not available.");this.updateIframeTitle(r),Vr.registerAllSharedServices(this._dispatcher,this.embeddingId),uT.registerAllEmbeddingServices(this._dispatcher,this.embeddingId),this._viz.initializeEvents(),this._workbookImpl=new cT.EmbeddingWorkbookImpl(r,this.embeddingId);let a=[];this._customViewsTemp&&(a=this._workbookImpl.processCustomViews(jn.NotificationId.CustomViewsLoaded,this._customViewsTemp)),this._viz.dispatchEvent(new CustomEvent(yr.EmbeddingTableauEventType.FirstInteractive)),this._customViewsTemp&&(this.sendCustomViewEvents(yr.EmbeddingTableauEventType.CustomViewLoaded,a),this._customViewsTemp=null)}handleVizSizeKnownEvent(r){const a=Vr.SheetUtils.getSheetSizeFromSizeConstraints(r.sheetSize);this._vizSize=new sU.VizSize(a,r.chromeHeight);const c=new rU.FirstVizSizeKnownEvent(this._vizSize);this._viz.dispatchEvent(new CustomEvent(yr.EmbeddingTableauEventType.FirstVizSizeKnown,{detail:c})),!this._viz.fixedSize&&(this.resize(),this.addWindowResizeHandler())}resize(){const{height:r,width:a}=this.calculateLayoutSize();r!==this._vizSize.chromeHeight&&(this._iframe.style.height=r+"px",this._iframe.style.width=a+"px")}calculateLayoutSize(){const r=this._viz.parentElement?lU.HtmlElementHelpers.getContentSize(this._viz.parentElement):{height:0,width:0},{chromeHeight:a,sheetSize:c}=this._vizSize;let f=0,_=0;const b=c.minSize||{height:0,width:0},s=c.maxSize||{height:0,width:0};if(c.behavior===yr.SheetSizeBehavior.Exactly)f=s.width,_=s.height+a;else{let S,C,k,M;switch(c.behavior){case yr.SheetSizeBehavior.Range:S=b.width,C=s.width,k=b.height+a,M=s.height+a,f=Math.max(S,Math.min(C,r.width)),_=Math.max(k,Math.min(M,r.height));break;case yr.SheetSizeBehavior.AtLeast:S=b.width,k=b.height+a,f=Math.max(S,r.width),_=Math.max(k,r.height);break;case yr.SheetSizeBehavior.AtMost:C=s.width,M=s.height+a,f=Math.min(C,r.width),_=Math.min(M,r.height);break;case yr.SheetSizeBehavior.Automatic:f=r.width,_=Math.max(r.height,a);break;default:throw new Vr.TableauError(yr.EmbeddingErrorCodes.InvalidSizeBehavior,"Unknown SheetSizeBehavior for viz: "+c.behavior)}}return{height:_,width:f}}removeWindowResizeHandler(){this._windowResizeHandler&&window.removeEventListener(this._resizeEventType,this._windowResizeHandler)}addWindowResizeHandler(){this._windowResizeHandler||(this._windowResizeHandler=this.resize.bind(this),window.addEventListener(this._resizeEventType,this._windowResizeHandler))}handleToolbarStateEvent(r){const a=new iU.ToolbarStateChangedEvent(r.toolbarState.canRedo,r.toolbarState.canUndo);this._viz.dispatchEvent(new CustomEvent(yr.EmbeddingTableauEventType.ToolbarStateChanged,{detail:a}))}handleTabSwitch(r){if(!this._workbookImpl||!r.oldSheetName)return;this.updateIframeTitle(r);const a=this._workbookImpl.pendingTabSwitchPromise;this._workbookImpl.updateExistingActiveSheetReferences(r.currWorksheetName),this._workbookImpl=new cT.EmbeddingWorkbookImpl(r,this.embeddingId),a&&a.resolve(this._workbookImpl);const c=new nU.TabSwitchedEvent(r.oldSheetName,r.currWorksheetName);this._viz.dispatchEvent(new CustomEvent(yr.EmbeddingTableauEventType.TabSwitched,{detail:c}))}handleCustomViews(r){if(!this._workbookImpl)this._customViewsTemp=r;else{const a=this._workbookImpl.processCustomViews(jn.NotificationId.CustomViewsLoaded,r),c=this._workbookImpl.pendingShowCustomViewPromise;if(c){const f=a[0];c.resolve(f),this._workbookImpl.clearPendingShowCustomViewPromise()}this.sendCustomViewEvents(yr.EmbeddingTableauEventType.CustomViewLoaded,a)}}handleCustomViewRemoved(r){const a=this._workbookImpl.processCustomViews(jn.NotificationId.CustomViewRemoved,r);this.sendCustomViewEvents(yr.EmbeddingTableauEventType.CustomViewRemoved,a)}handleCustomViewSaved(r){const a=this._workbookImpl.processCustomViews(jn.NotificationId.CustomViewSaved,r);this.sendCustomViewEvents(yr.EmbeddingTableauEventType.CustomViewSaved,a)}handleCustomViewSetDefault(r){const a=this._workbookImpl.processCustomViews(jn.NotificationId.CustomViewSetDefault,r);this.sendCustomViewEvents(yr.EmbeddingTableauEventType.CustomViewSetDefault,a)}sendCustomViewEvents(r,a){for(let c of a){const f={customView:new oU.CustomView(c,this._workbookImpl)};this._viz.dispatchEvent(new CustomEvent(r,{detail:f}))}}}Ib.VizImpl=cU;var hT=gt&&gt.__awaiter||function(t,r,a,c){function f(_){return _ instanceof a?_:new a(function(b){b(_)})}return new(a||(a=Promise))(function(_,b){function s(k){try{C(c.next(k))}catch(M){b(M)}}function S(k){try{C(c.throw(k))}catch(M){b(M)}}function C(k){k.done?_(k.value):f(k.value).then(s,S)}C((c=c.apply(t,r||[])).next())})},uU=gt&&gt.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var a in t)Object.hasOwnProperty.call(t,a)&&(r[a]=t[a]);return r.default=t,r};Object.defineProperty(mh,"__esModule",{value:!0});const ii=uU(Or),hU=ho,dT=$r,dU=Ib,pU=xl,pT=Ic,fT=Jp;class fz extends fT.TableauWebComponent{disconnectedCallback(){super.disconnectedCallback(),this._vizImpl&&this._vizImpl.dispose()}static get observedAttributes(){return[...super.observedAttributes,...Object.values(ii.VizSharedAttributes)]}updateRenderingIfInitialized(r){return hT(this,void 0,void 0,function*(){if(this._initialized)return this._vizImpl&&this._vizImpl.dispose(),pT.WebComponentManager.unregisterWebComponent(this._embeddingIdCounter),this.updateRendering(r)})}updateRendering(r){return hT(this,void 0,void 0,function*(){try{if(this._initialized=!0,!r){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if((yield this.auth(pU.getSiteId(r)))===fT.TableauAuthResponse.Failure){console.debug("Authentication failed.");return}if(!this.src){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if(!this.iframe){console.debug("No iframe available to update the src.");return}this._embeddingIdCounter=pT.WebComponentManager.registerWebComponent(this),this.registerAttributeEvents();const c=this.createFrameUrlWithParams();this._vizImpl=this.createAndInitializeVizImpl(c),this.iframe.src=c.toString(),this.raiseIframeSrcUpdatedNotification();return}catch(a){console.debug(a)}})}createAndInitializeVizImpl(r){const a=new dU.VizImpl(this,this.iframe,r,this._embeddingIdCounter);return a.initializeViz(),a}registerAttributeEvents(){this.getAttributeEvents().forEach(r=>{const[a,c]=r;this.registerCallback(a,c)})}initializeEvents(){let r;try{r=dT.ApiServiceRegistry.get(this.vizImpl.embeddingId).getService("notification-service")}catch{throw new dT.TableauError(ii.EmbeddingErrorCodes.EventInitializationError,"Event initialization failed")}const a=this.getRegisteredEvents();for(const[c,f,_]of a)r.registerHandler(c,f,_)}getRegisteredEvents(){return[[hU.NotificationId.EditInDesktopButtonClicked,()=>!0,()=>this.dispatchEvent(new CustomEvent(ii.EmbeddingTableauEventType.EditInDesktopButtonClicked))]]}get touchOptimize(){return this.hasAttribute(ii.VizSharedAttributes.TouchOptimize)}set touchOptimize(r){r?this.setAttribute(ii.VizSharedAttributes.TouchOptimize,""):this.removeAttribute(ii.VizSharedAttributes.TouchOptimize)}get vizImpl(){return this._vizImpl}get hideEditInDesktopButton(){return this.hasAttribute(ii.VizSharedAttributes.HideEditInDesktopButton)}set hideEditInDesktopButton(r){r?this.setAttribute(ii.VizSharedAttributes.HideEditInDesktopButton,""):this.removeAttribute(ii.VizSharedAttributes.HideEditInDesktopButton)}get suppressDefaultEditBehavior(){return this.hasAttribute(ii.VizSharedAttributes.SuppressDefaultEditBehavior)}set suppressDefaultEditBehavior(r){r?this.setAttribute(ii.VizSharedAttributes.SuppressDefaultEditBehavior,""):this.removeAttribute(ii.VizSharedAttributes.SuppressDefaultEditBehavior)}get disableVersionCheck(){return this.hasAttribute(ii.VizSharedAttributes.DisableVersionCheck)}set disableVersionCheck(r){r?this.setAttribute(ii.VizSharedAttributes.DisableVersionCheck,""):this.removeAttribute(ii.VizSharedAttributes.DisableVersionCheck)}getCurrentSrcAsync(){return this.vizImpl.getCurrentSrcAsync()}resize(){this.vizImpl.resize()}}mh.TableauVizBase=fz;fz.VizAttributeDefaults={device:ii.DeviceType.Default,toolbar:ii.Toolbar.Bottom};function fU(t){if(!t||t.length<1)return"";const r=t.toLowerCase();return r[0].toUpperCase()+r.substring(1)}mh.attributeToEnumKey=fU;var mU=gt&&gt.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var a in t)Object.hasOwnProperty.call(t,a)&&(r[a]=t[a]);return r.default=t,r};Object.defineProperty(hg,"__esModule",{value:!0});const En=mU(Or),yx=ho,gU=Sb,mT=Cb,_U=mh;class yU extends _U.TableauVizBase{static get observedAttributes(){return[...super.observedAttributes,...Object.values(En.VizAuthoringAttributes)]}getAttributeEvents(){return[[En.VizSharedAttributes.OnEditInDesktopButtonClicked,En.EmbeddingTableauEventType.EditInDesktopButtonClicked],[En.VizSharedAttributes.OnFirstInteractive,En.EmbeddingTableauEventType.FirstInteractive],[En.VizSharedAttributes.OnFirstVizSizeKnown,En.EmbeddingTableauEventType.FirstVizSizeKnown],[En.VizAuthoringAttributes.OnWorkbookPublished,En.EmbeddingTableauEventType.WorkbookPublished],[En.VizAuthoringAttributes.OnWorkbookPublishedAs,En.EmbeddingTableauEventType.WorkbookPublishedAs],[En.VizAuthoringAttributes.OnWorkbookReadyToClose,En.EmbeddingTableauEventType.WorkbookReadyToClose],[En.VizAttributes.OnReadyToReceiveAuthToken,En.EmbeddingTableauEventType.ReadyToReceiveAuthToken]]}createFrameUrlWithParams(){const r=this.constructVizqlOptions(),a=this.readCustomParamsFromChildren();return mT.createVizUrl(this.src,mT.EmbeddingUrlMode.Authoring,r,this._embeddingIdCounter,[],[],a)}constructVizqlOptions(){return{token:this.token,touchOptimize:this.touchOptimize,hideEditInDesktopButton:this.hideEditInDesktopButton,suppressDefaultEditBehavior:this.suppressDefaultEditBehavior,hideCloseButton:this.hideCloseButton,debug:this.debug,iframeAuth:this.iframeAuth}}getRegisteredEvents(){return super.getRegisteredEvents().concat([[yx.NotificationId.WorkbookPublished,()=>!0,()=>this.dispatchEvent(new CustomEvent(En.EmbeddingTableauEventType.WorkbookPublished))],[yx.NotificationId.WorkbookPublishedAs,()=>!0,r=>this.handleWorkbookPublishedAsEvent(r)],[yx.NotificationId.WorkbookReadyToClose,()=>!0,()=>this.dispatchEvent(new CustomEvent(En.EmbeddingTableauEventType.WorkbookReadyToClose))]])}handleWorkbookPublishedAsEvent(r){const a={newUrl:r.newUrl};this.dispatchEvent(new CustomEvent(En.EmbeddingTableauEventType.WorkbookPublishedAs,{detail:a}))}set hideCloseButton(r){r?this.setAttribute(En.VizAuthoringAttributes.HideCloseButton,""):this.removeAttribute(En.VizAuthoringAttributes.HideCloseButton)}get hideCloseButton(){return this.hasAttribute(En.VizAuthoringAttributes.HideCloseButton)}get workbook(){return new gU.AuthoringWorkbook(this.vizImpl.workbookImpl,this.vizImpl.embeddingId)}setAuthToken(r){this.vizImpl.setAuthToken(r)}}hg.TableauAuthoringViz=yU;var l0={},c0={},Ub={};Object.defineProperty(Ub,"__esModule",{value:!0});class xU{constructor(r,a){this._width=r,this._height=a}get width(){return this._width}get height(){return this._height}}Ub.FirstPulseMetricSizeKnownEvent=xU;var Vb={};Object.defineProperty(Vb,"__esModule",{value:!0});class vU{constructor(r,a,c){this._message=r,this._httpStatus=a,this._messageVisibility=c}get message(){return this._message}get httpStatus(){return this._httpStatus}get messageVisibility(){return this._messageVisibility}}Vb.PulseErrorEvent=vU;var jb={},bU=gt&&gt.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var a in t)Object.hasOwnProperty.call(t,a)&&(r[a]=t[a]);return r.default=t,r};Object.defineProperty(jb,"__esModule",{value:!0});const wU=bU(Or),gT=$r;class EU{constructor(r,a){this._fieldNames=r,this._embeddingId=a}get fieldNames(){return this._fieldNames}getFiltersAsync(){return gT.ApiServiceRegistry.get(this._embeddingId).getService("PulseService").getFiltersAsync().then(a=>{const c=[],f=[];for(const _ of this._fieldNames){const b=a.find(s=>s.fieldName===_);b?c.push(b):f.push(_)}if(f.length)throw new gT.TableauError(wU.EmbeddingErrorCodes.FilterMissingOrNotImplemented,`Cannot find filter(s): ${f.join(", ")}.`);return c})}}jb.PulseFiltersChangedEvent=EU;var $b={};Object.defineProperty($b,"__esModule",{value:!0});class SU{constructor(r,a,c,f,_,b,s){this._id=r,this._characterization=a,this._markup=c,this._question=f,this._score=_,this._type=b,this._version=s}get id(){return this._id}get characterization(){return this._characterization}get markup(){return this._markup}get question(){return this._question}get score(){return this._score}get type(){return this._type}get version(){return this._version}}$b.PulseInsightDiscoveredEvent=SU;var Wb={};Object.defineProperty(Wb,"__esModule",{value:!0});class AU{constructor(r){this._timeDimension=r}get timeDimension(){return this._timeDimension}}Wb.PulseTimeDimensionChangedEvent=AU;var qb={};Object.defineProperty(qb,"__esModule",{value:!0});class TU{constructor(r,a,c){this._oldUrl=r,this._newUrl=a,this._context=c}get oldUrl(){return this._oldUrl}get newUrl(){return this._newUrl}get context(){return this._context}}qb.PulseUrlChangedEvent=TU;var u0={},Hg={},CU=gt&&gt.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var a in t)Object.hasOwnProperty.call(t,a)&&(r[a]=t[a]);return r.default=t,r};Object.defineProperty(Hg,"__esModule",{value:!0});const _T=CU(Or),yT=$r;class mz{constructor(r,a,c,f){this._fieldName=r,this._filterType=a,this._metricId=c,this._registryId=f}get fieldName(){return this._fieldName}get filterType(){return this._filterType}get metricId(){return this._metricId}}Hg.PulseFilter=mz;class IU extends mz{constructor(r,a,c,f,_,b,s){super(r,c,a,f),this._appliedValues=_,this._isExcludeMode=b,this._isAllSelected=s}get isAllSelected(){return this._isAllSelected}get appliedValues(){return this._appliedValues}get isExcludeMode(){return this._isExcludeMode}getDomainAsync(r,a,c,f){return f||(f=_T.FilterDomainType.Relevant),yT.ErrorHelpers.verifyEnumValue(f,_T.FilterDomainType,"Contract.FilterDomainType"),yT.ApiServiceRegistry.get(this._registryId).getService("PulseService").getCategoricalDomainAsync(this._fieldName,f,r,a,c)}}Hg.CategoricalPulseFilter=IU;var xT;function kU(){if(xT)return u0;xT=1,Object.defineProperty(u0,"__esModule",{value:!0});const t=Or,r=ho,a=$r,c=xz(),f=Hg;let _=class extends a.ServiceImplBase{get serviceName(){return"PulseService"}applyFiltersAsync(s){const S=r.VerbId.ApplyPulseFilters,C={[r.ParameterId.PulseFilters]:s};if(!Array.isArray(s))throw new a.TableauError(c.ErrorCodes.InvalidParameter,"filters parameter for applyFiltersAsync must be an array");for(const k of s){if(!Array.isArray(k.values))throw new a.TableauError(c.ErrorCodes.InvalidParameter,"filter values for applyFiltersAsync must be an array");if(!k.updateType||!Object.values(r.FilterUpdateType).includes(k.updateType))throw new a.TableauError(c.ErrorCodes.InvalidParameter,"filter updateType for applyFiltersAsync must be a valid update type");if(!k.options)throw new a.TableauError(c.ErrorCodes.InvalidParameter,"filter options object for applyFiltersAsync must be provided");if(![!0,!1].includes(k.options.isExcludeMode))throw new a.TableauError(c.ErrorCodes.InvalidParameter,"filter options.isExcludeMode for applyFiltersAsync must be a boolean")}return this.execute(S,C).then(k=>s.map(M=>M.fieldName))}getTimeDimensionAsync(){const s=r.VerbId.GetPulseTimeDimension,S={};return this.execute(s,S).then(C=>{const{timeDimension:k}=C.result;if(!k)throw new a.TableauError(c.ErrorCodes.InvalidTimeDimension,"Unable to determine the currently applied time dimension.");if(!a.ErrorHelpers.isValidEnumValue(k,t.PulseTimeDimension)){const M=[`The current time dimension is '${k}', which is not a known value of the Contract.PulseTimeDimension enum.`,"You may need to update your version of the Tableau Embedding API.",`Valid values are: ${Object.keys(t.PulseTimeDimension).join(", ")}`];console.warn(M.join(" "))}return k})}applyTimeDimensionAsync(s){a.ErrorHelpers.verifyEnumValue(s,t.PulseTimeDimension,"Contract.PulseTimeDimension");const S=r.VerbId.ApplyPulseTimeDimension,C={[r.ParameterId.PulseTimeDimension]:s};return this.execute(S,C).then(k=>{})}getCategoricalDomainAsync(s,S,C,k,M){a.ErrorHelpers.verifyStringParameter(s,"fieldName"),a.ErrorHelpers.verifyEnumValue(S,t.FilterDomainType,"Contract.FilterDomainType");const L=r.VerbId.GetPulseCategoricalDomain,V={[r.ParameterId.PulseFieldName]:s,[r.ParameterId.PulseFilterDomainType]:S,[r.ParameterId.PulseFilterDomainSearchTerm]:C};return k!==void 0&&(V[r.ParameterId.PulsePageSize]=k),M!==void 0&&(V[r.ParameterId.PulseNextPageToken]=M),this.execute(L,V).then(O=>O.result)}getFiltersAsync(){const s=r.VerbId.GetPulseFilters,S={};return this.execute(s,S).then(C=>{const k=C.result;return this.convertDomainFilters(k)})}clearFiltersAsync(s){const S=r.VerbId.ClearPulseFilters,C={[r.ParameterId.PulseFieldNames]:s};if(!Array.isArray(s))throw new a.TableauError(c.ErrorCodes.InvalidParameter,"fieldNames parameter for clearFiltersAsync must be an array");return this.execute(S,C).then(k=>s)}clearAllFiltersAsync(){const s=r.VerbId.ClearAllPulseFilters,S={};return this.execute(s,S).then(C=>{})}convertDomainFilters(s){const S=[];return s.forEach(C=>{switch(C.filterType){case t.FilterType.Categorical:{const k=C;if(k)S.push(this.convertCategoricalFilter(k));else throw new Error("Invalid Categorical Filter");break}}}),S}convertCategoricalFilter(s){return new f.CategoricalPulseFilter(s.fieldName,s.metricId,t.FilterType.Categorical,this._registryId,s.appliedValues,s.isExcludeMode,s.isAllSelected)}};return u0.PulseServiceImpl=_,u0}var vT;function PU(){if(vT)return c0;vT=1;var t=gt&&gt.__importStar||function(O){if(O&&O.__esModule)return O;var j={};if(O!=null)for(var H in O)Object.hasOwnProperty.call(O,H)&&(j[H]=O[H]);return j.default=O,j};Object.defineProperty(c0,"__esModule",{value:!0});const r=t(Or),a=ho,c=$r,f=Ub,_=Vb,b=jb,s=$b,S=Wb,C=qb,k=ef,M=kU(),L=Qp;let V=class{constructor(j,H,Z,U,$,J){if(this._pulse=j,this._iframe=H,this._frameUrl=Z,this._timeDimension=U,this._filters=$,this._embeddingId=J,this._resizeEventType="resize",!this._iframe)throw new c.TableauError(r.EmbeddingErrorCodes.InternalError,"Iframe has not been created yet");this._shouldDispatchMetricSizeKnownEvent=!U&&!$.length}get iframe(){return this._iframe}get embeddingId(){return this._embeddingId}initialize(){const j=this._iframe.contentWindow;if(!j)throw new c.TableauError(r.EmbeddingErrorCodes.InternalError,"Iframe has not been created yet");try{this._messenger=new a.CrossFrameMessenger(window,j,this._frameUrl.origin),this._dispatcher=new c.CrossFrameDispatcher(this._messenger),k.registerInitializationEmbeddingServices(this._dispatcher,this.embeddingId);const H=c.ApiServiceRegistry.get(this.embeddingId).getService("initialization-service"),Z=H.registerHandler(a.NotificationId.FirstPulseMetricSizeKnown,()=>this._shouldDispatchMetricSizeKnownEvent,U=>{this.handlePulseMetricSizeKnownEvent(U),Z()});H.registerHandler(a.NotificationId.PulseInteractive,()=>!0,U=>{this.handlePulseInteractiveEvent(U)}),H.registerHandler(a.NotificationId.PulseError,()=>!0,U=>{this.handlePulseErrorEvent(U)}),H.registerHandler(a.NotificationId.PulseUrlChanged,()=>!0,U=>{this.handlePulseUrlChangedEvent(U)}),H.registerHandler(a.NotificationId.PulseTimeDimensionChanged,()=>!0,U=>{this.handlePulseTimeDimensionChangedEvent(U)}),H.registerHandler(a.NotificationId.PulseInsightDiscovered,()=>!0,U=>{this.handlePulseInsightDiscoveredEvent(U)}),H.registerHandler(a.NotificationId.PulseFiltersChanged,()=>!0,U=>{this.handlePulseFiltersChangedEvent(U)}),this._messenger.startListening()}catch{throw new c.TableauError(r.EmbeddingErrorCodes.InternalError,"Unexpected error during initialization.")}}dispose(){this._messenger&&this._messenger.stopListening(),this.removeWindowResizeHandler()}updateIframeTitle(j){this._iframe.setAttribute("title",j.iframeTitle)}handlePulseMetricSizeKnownEvent(j){const H=new f.FirstPulseMetricSizeKnownEvent(j.width,j.height);this._pulse.dispatchEvent(new CustomEvent(r.EmbeddingTableauEventType.FirstPulseMetricSizeKnown,{detail:H})),!this._pulse.fixedSize&&(this.resize(),this.addWindowResizeHandler())}resize(){const{height:j,width:H}=this.calculateLayoutSize();this._iframe.style.height=j+"px",this._iframe.style.width=H+"px"}calculateLayoutSize(){return this._pulse.parentElement?L.HtmlElementHelpers.getContentSize(this._pulse.parentElement):{height:0,width:0}}removeWindowResizeHandler(){this._windowResizeHandler&&window.removeEventListener(this._resizeEventType,this._windowResizeHandler)}addWindowResizeHandler(){this._windowResizeHandler||(this._windowResizeHandler=this.resize.bind(this),window.addEventListener(this._resizeEventType,this._windowResizeHandler))}handlePulseInteractiveEvent(j){if(c.ApiServiceRegistry.get(this.embeddingId).registerService(new M.PulseServiceImpl(this._dispatcher,this.embeddingId)),c.ApiServiceRegistry.get(this.embeddingId).registerService(new c.NotificationServiceImpl(this._dispatcher)),this._timeDimension){this.applyTimeDimensionAsync(this._timeDimension),this._timeDimension=void 0;return}if(this._filters.length){this.applyFiltersAsync(this._filters.map(H=>({fieldName:H.field,values:H.value.split(","),updateType:r.FilterUpdateType.Replace,options:{isExcludeMode:!1}}))),this._filters=[];return}this._iframe.style.visibility="visible",this.updateIframeTitle(j),this._shouldDispatchMetricSizeKnownEvent=!0,this._pulse.dispatchEvent(new CustomEvent(r.EmbeddingTableauEventType.FirstInteractive))}handlePulseErrorEvent(j){const H=new _.PulseErrorEvent(j.message,j.httpStatus,j.messageVisibility);this._pulse.dispatchEvent(new CustomEvent(r.EmbeddingTableauEventType.PulseError,{detail:H}))}handlePulseUrlChangedEvent(j){const H=new C.PulseUrlChangedEvent(j.oldUrl,j.newUrl,j.context);this._pulse.dispatchEvent(new CustomEvent(r.EmbeddingTableauEventType.PulseUrlChanged,{detail:H}))}handlePulseTimeDimensionChangedEvent(j){const H=new S.PulseTimeDimensionChangedEvent(j.timeDimension);this._pulse.dispatchEvent(new CustomEvent(r.EmbeddingTableauEventType.PulseTimeDimensionChanged,{detail:H}))}handlePulseInsightDiscoveredEvent(j){const H=new s.PulseInsightDiscoveredEvent(j.id,j.characterization,j.markup,j.question,j.score,j.type,j.version);this._pulse.dispatchEvent(new CustomEvent(r.EmbeddingTableauEventType.PulseInsightDiscovered,{detail:H}))}handlePulseFiltersChangedEvent(j){const H=new b.PulseFiltersChangedEvent(j.fieldNames,this.embeddingId);this._pulse.dispatchEvent(new CustomEvent(r.EmbeddingTableauEventType.PulseFiltersChanged,{detail:H}))}applyFiltersAsync(j){return c.ApiServiceRegistry.get(this.embeddingId).getService("PulseService").applyFiltersAsync(j)}getTimeDimensionAsync(){return c.ApiServiceRegistry.get(this.embeddingId).getService("PulseService").getTimeDimensionAsync()}applyTimeDimensionAsync(j){return c.ApiServiceRegistry.get(this.embeddingId).getService("PulseService").applyTimeDimensionAsync(j)}getFiltersAsync(){return c.ApiServiceRegistry.get(this.embeddingId).getService("PulseService").getFiltersAsync()}clearFiltersAsync(j){return c.ApiServiceRegistry.get(this.embeddingId).getService("PulseService").clearFiltersAsync(j)}clearAllFiltersAsync(){return c.ApiServiceRegistry.get(this.embeddingId).getService("PulseService").clearAllFiltersAsync()}};return c0.PulseImpl=V,c0}var Zg={};Object.defineProperty(Zg,"__esModule",{value:!0});const zU=Or,Ya=ho,gz=$r,_z=xl;function DU(t,r,a){const c=t.split("?")[0];let f;try{f=new URL(c),_z.validateUrl(f)}catch(s){throw new gz.TableauError(zU.EmbeddingErrorCodes.InvalidUrl,s.message)}const _=MU();return new yz(f).appendDefaultParameters(_).appendUserOptions(r).appendCustomParams(a).build()}Zg.createPulseUrl=DU;function MU(t){const r=new Map,a=`${Ya.INTERNAL_CONTRACT_VERSION.major}.${Ya.INTERNAL_CONTRACT_VERSION.minor}.${Ya.INTERNAL_CONTRACT_VERSION.fix}`;r.set(Ya.PulseOptionNames.ApiInternalVersion,a),r.set(Ya.PulseOptionNames.embed,"y");const c=gz.ApiVersion.Instance.formattedValue;return r.set(Ya.PulseOptionNames.ApiExternalVersion,c),r.set(Ya.PulseOptionNames.PulseWebComponent,"true"),r}class yz extends _z.EmbeddingUrlBuilder{constructor(r){super(),this._url=r,this._optionNames=Ya.PulseOptionNames}sanitizeParameterValue(r,a){return this.sanitizeValue(a)}}Zg.EmbeddingPulseUrlBuilder=yz;var bT;function wT(){if(bT)return l0;bT=1;var t=gt&&gt.__awaiter||function(k,M,L,V){function O(j){return j instanceof L?j:new L(function(H){H(j)})}return new(L||(L=Promise))(function(j,H){function Z(J){try{$(V.next(J))}catch(le){H(le)}}function U(J){try{$(V.throw(J))}catch(le){H(le)}}function $(J){J.done?j(J.value):O(J.value).then(Z,U)}$((V=V.apply(k,M||[])).next())})};Object.defineProperty(l0,"__esModule",{value:!0});const r=Or,a=$r,c=PU(),f=Zg,_=xl,b=Ic,s=mh,S=Jp;let C=class extends S.TableauWebComponent{constructor(){super(),this._preInitFilters=[]}disconnectedCallback(){super.disconnectedCallback(),this._preInitFilters=[],this._pulseImpl&&this._pulseImpl.dispose()}getAttributeEvents(){return[[r.PulseAttributes.OnFirstInteractive,r.EmbeddingTableauEventType.FirstInteractive],[r.PulseAttributes.OnFirstPulseMetricSizeKnown,r.EmbeddingTableauEventType.FirstPulseMetricSizeKnown],[r.PulseAttributes.OnPulseUrlError,r.EmbeddingTableauEventType.PulseError],[r.PulseAttributes.OnPulseFiltersChanged,r.EmbeddingTableauEventType.PulseFiltersChanged],[r.PulseAttributes.OnPulseInsightDiscovered,r.EmbeddingTableauEventType.PulseInsightDiscovered],[r.PulseAttributes.OnPulseTimeDimensionChanged,r.EmbeddingTableauEventType.PulseTimeDimensionChanged],[r.PulseAttributes.OnPulseUrlChanged,r.EmbeddingTableauEventType.PulseUrlChanged]]}static get observedAttributes(){return[...super.observedAttributes,...Object.values(r.PulseAttributes)]}updateRenderingIfInitialized(M){return t(this,void 0,void 0,function*(){if(this._initialized)return this._pulseImpl&&this._pulseImpl.dispose(),b.WebComponentManager.unregisterWebComponent(this._embeddingIdCounter),this.updateRendering(M)})}updateRendering(M){return t(this,void 0,void 0,function*(){try{if(this._initialized=!0,!M){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if(!this.token&&!this.isTokenOptional){console.debug(`A token needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if((yield this.auth(_.getSiteIdForPulse(M)))===S.TableauAuthResponse.Failure){console.debug("Authentication failed.");return}if(!this.src){console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);return}if(!this.iframe){console.debug("No iframe available to update the src.");return}const V=this.readCustomParamsFromChildren();this._embeddingIdCounter=b.WebComponentManager.registerWebComponent(this),this.registerAttributeEvents();const O=f.createPulseUrl(this.src,this.constructOptions(),V),j=this.readFiltersFromChild().concat(this._preInitFilters);this._pulseImpl=this.createAndInitializePulseImpl(O,j),(this.timeDimension||j.length)&&(this.iframe.style.visibility="hidden"),this.iframe.src=O.toString(),this.raiseIframeSrcUpdatedNotification();return}catch(L){console.warn(L)}})}createAndInitializePulseImpl(M,L){const V=new c.PulseImpl(this,this.iframe,M,this.timeDimension,L,this._embeddingIdCounter);return V.initialize(),V}registerAttributeEvents(){this.getAttributeEvents().forEach(M=>{const[L,V]=M;this.registerCallback(L,V)})}readFiltersFromChild(){const M=[];return[].forEach.call(this.children,L=>{L.localName===r.PulseChildElements.PulseFilter&&L.getAttribute(r.PulseChildElementAttributes.Field)&&L.getAttribute(r.PulseChildElementAttributes.Value)&&M.push({field:L.getAttribute(r.PulseChildElementAttributes.Field),value:L.getAttribute(r.PulseChildElementAttributes.Value)})}),M}readThemeParametersFromChild(){const M=[];return[].forEach.call(this.children,L=>{if(L.localName===r.PulseChildElements.ThemeParameter){const V=L.getAttribute(r.PulseChildElementAttributes.Name),O=L.getAttribute(r.PulseChildElementAttributes.Value),j=L.getAttribute(r.PulseChildElementAttributes.Type);V&&O&&M.push({name:V,value:O,type:j})}}),M}getThemeString(){const M=this.themeObj;if(M)try{return btoa(JSON.stringify(M))}catch{return}}constructOptions(){const M={token:this.token,theme:this.getThemeString()};return this.disableExploreFilter&&(M.disableExploreFilter=this.disableExploreFilter),this.layout&&this.layout!==r.PulseLayout.Default&&(M.layout=this.layout),M}get disableExploreFilter(){return this.hasAttribute(r.PulseAttributes.DisableExploreFilter)}set disableExploreFilter(M){M?this.setAttribute(r.PulseAttributes.DisableExploreFilter,""):this.removeAttribute(r.PulseAttributes.DisableExploreFilter)}get layout(){const M=s.attributeToEnumKey(this.getAttribute(r.PulseAttributes.Layout)),L=r.PulseLayout[M];return L||r.PulseLayout.Default}set layout(M){M?this.setAttribute(r.PulseAttributes.Layout,M):this.removeAttribute(r.PulseAttributes.Layout)}get themeObj(){var M;let L;for(const{name:V,value:O,type:j}of this.readThemeParametersFromChild())L=L??{},j?(L[j]=(M=L[j],M??{}),L[j][V]=O):L[V]=O;return L}get timeDimension(){const M=this.getAttribute(r.PulseAttributes.TimeDimension);if(M)return a.ErrorHelpers.verifyEnumValue(M,r.PulseTimeDimension,"Contract.PulseTimeDimension"),r.PulseTimeDimension[M]}set timeDimension(M){M?(a.ErrorHelpers.verifyEnumValue(M,r.PulseTimeDimension,"Contract.PulseTimeDimension"),this.setAttribute(r.PulseAttributes.TimeDimension,M)):this.removeAttribute(r.PulseAttributes.TimeDimension)}get isTokenOptional(){return this.hasAttribute(r.PulseAttributes.TokenOptional)}set isTokenOptional(M){M?this.setAttribute(r.PulseAttributes.TokenOptional,""):this.removeAttribute(r.PulseAttributes.TokenOptional)}addFilter(M,L){this._preInitFilters.push({field:M,value:L}),b.WebComponentManager.synchronizeRender(this.updateRenderingIfInitialized.bind(this,this.src))}resize(){this._pulseImpl.resize()}applyFilterAsync(M,L,V,O){return this.applyFiltersAsync([{fieldName:M,values:L,updateType:V,options:O}]).then(j=>j[0])}applyFiltersAsync(M){return this._pulseImpl.applyFiltersAsync(M)}getTimeDimensionAsync(){return this._pulseImpl.getTimeDimensionAsync()}applyTimeDimensionAsync(M){return this._pulseImpl.applyTimeDimensionAsync(M)}getFiltersAsync(){return this._pulseImpl.getFiltersAsync()}clearFilterAsync(M){return this.clearFiltersAsync([M]).then(L=>L[0])}clearFiltersAsync(M){return this._pulseImpl.clearFiltersAsync(M)}clearAllFiltersAsync(){return this._pulseImpl.clearAllFiltersAsync()}};return l0.TableauPulse=C,l0}var dg={},Gb={},_h={},Hb={};Object.defineProperty(Hb,"__esModule",{value:!0});class RU{constructor(r,a){this._sheet=a}get sheet(){return this._sheet}}Hb.TableauSheetEvent=RU;Object.defineProperty(_h,"__esModule",{value:!0});const BU=Hb;class LU extends BU.TableauSheetEvent{constructor(r,a){super(r,a),this._worksheet=a}get worksheet(){return this._worksheet}}_h.TableauWorksheetEvent=LU;Object.defineProperty(Gb,"__esModule",{value:!0});const FU=Or,OU=_h;class NU extends OU.TableauWorksheetEvent{constructor(r,a){super(FU.EmbeddingTableauEventType.CustomMarkContextMenuEvent,r),this._contextMenuId=a}getContextMenuId(){return this._contextMenuId}getSelectedMarksAsync(){return this.worksheet.getSelectedMarksAsync()}}Gb.CustomMarkContextMenuEvent=NU;var Zb={};Object.defineProperty(Zb,"__esModule",{value:!0});const ET=Or,UU=$r,VU=_h;class jU extends VU.TableauWorksheetEvent{constructor(r,a,c){super(ET.EmbeddingTableauEventType.FilterChanged,r),this._fieldName=a,this._fieldId=c}get fieldName(){return this._fieldName}get fieldId(){return this._fieldId}getFilterAsync(){return this.worksheet.getFiltersAsync().then(r=>{const a=this.fieldId?r.find(c=>c.fieldId===this.fieldId,this):r.find(c=>c.fieldName===this.fieldName,this);if(!a)throw new UU.TableauError(ET.EmbeddingErrorCodes.FilterMissingOrNotImplemented,`Cannot find filter: ${this._fieldName}.`);return a})}}Zb.FilterChangedEvent=jU;var Xb={};Object.defineProperty(Xb,"__esModule",{value:!0});const $U=Or,WU=_h;class qU extends WU.TableauWorksheetEvent{constructor(r){super($U.EmbeddingTableauEventType.MarkSelectionChanged,r)}getMarksAsync(){return this.worksheet.getSelectedMarksAsync()}}Xb.MarksSelectedEvent=qU;var Kb={};Object.defineProperty(Kb,"__esModule",{value:!0});const GU=Or,ST=$r,HU=qg;class ZU{constructor(r,a){this._globalFieldName=r,this._embeddingId=a}getParameterAsync(){return ST.ApiServiceRegistry.get(this._embeddingId).getService("parameters-service").findParameterByGlobalFieldNameAsync(this._globalFieldName).then(a=>{if(a===void 0)throw new ST.TableauError(GU.EmbeddingErrorCodes.MissingParameter,`Cannot find parameter: ${this._globalFieldName}`);return new HU.Parameter(a)})}}Kb.ParameterChangedEvent=ZU;var Yb={};Object.defineProperty(Yb,"__esModule",{value:!0});const XU=jg(),KU=uz();class YU{constructor(r,a,c){this._oldStoryPointInfoImpl=r,this._currStoryPointImpl=a,this._workbookImpl=c}get oldStoryPointInfo(){return new KU.StoryPointInfo(this._oldStoryPointInfoImpl,this._workbookImpl)}get newStoryPoint(){return new XU.StoryPoint(this._currStoryPointImpl,this._workbookImpl)}}Yb.StoryPointSwitchedEvent=YU;var Jb={};Object.defineProperty(Jb,"__esModule",{value:!0});const JU=Or,QU=_h;class eV extends QU.TableauWorksheetEvent{constructor(r){super(JU.EmbeddingTableauEventType.SummaryDataChanged,r)}}Jb.SummaryDataChangedEvent=eV;var Qb={};Object.defineProperty(Qb,"__esModule",{value:!0});class tV{constructor(r,a){this._url=r,this._target=a}get url(){return this._url}get target(){return this._target}}Qb.UrlActionEvent=tV;var rV=gt&&gt.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var a in t)Object.hasOwnProperty.call(t,a)&&(r[a]=t[a]);return r.default=t,r};Object.defineProperty(dg,"__esModule",{value:!0});const vt=rV(Or),Xa=ho,op=$r,nV=Gb,iV=Zb,oV=Xb,sV=Kb,aV=Yb,lV=Jb,cV=Qb,AT=Cb,uV=Gg(),hV=Ic,sp=mh;let dV=class extends sp.TableauVizBase{constructor(){super(...arguments),this.preInitFilters=[]}readFiltersFromChild(){const r=[];return[].forEach.call(this.children,a=>{a.localName===vt.VizChildElements.VizFilter&&a.getAttribute(vt.VizChildElementAttributes.Field)&&a.getAttribute(vt.VizChildElementAttributes.Value)!==void 0&&r.push({field:a.getAttribute(vt.VizChildElementAttributes.Field),value:a.getAttribute(vt.VizChildElementAttributes.Value)})}),r}readParametersFromChild(){const r=[];return[].forEach.call(this.children,a=>{a.localName===vt.VizChildElements.VizParameter&&a.getAttribute(vt.VizChildElementAttributes.Name)&&a.getAttribute(vt.VizChildElementAttributes.Value)&&r.push({name:a.getAttribute(vt.VizChildElementAttributes.Name),value:a.getAttribute(vt.VizChildElementAttributes.Value)})}),r}static get observedAttributes(){return[...super.observedAttributes,...Object.values(vt.VizAttributes)]}disconnectedCallback(){this.preInitFilters=[],super.disconnectedCallback()}createFrameUrlWithParams(){const r=this.constructVizqlOptions(),a=this.readFiltersFromChild().concat(this.preInitFilters),c=this.readParametersFromChild(),f=this.readCustomParamsFromChildren();return AT.createVizUrl(this.src,AT.EmbeddingUrlMode.Viewing,r,this._embeddingIdCounter,a,c,f)}constructVizqlOptions(){return{disableUrlActionsPopups:this.disableUrlActionsPopups,hideTabs:this.hideTabs,toolbar:this.toolbar,instanceIdToClone:this.instanceIdToClone,device:this.device,token:this.token,touchOptimize:this.touchOptimize,hideEditButton:this.hideEditButton,hideEditInDesktopButton:this.hideEditInDesktopButton,suppressDefaultEditBehavior:this.suppressDefaultEditBehavior,debug:this.debug,iframeAuth:this.iframeAuth}}getAttributeEvents(){return[[vt.VizAttributes.OnCustomMarkContextMenuEvent,vt.EmbeddingTableauEventType.CustomMarkContextMenuEvent],[vt.VizAttributes.OnEditButtonClicked,vt.EmbeddingTableauEventType.EditButtonClicked],[vt.VizSharedAttributes.OnEditInDesktopButtonClicked,vt.EmbeddingTableauEventType.EditInDesktopButtonClicked],[vt.VizAttributes.OnFilterChanged,vt.EmbeddingTableauEventType.FilterChanged],[vt.VizSharedAttributes.OnFirstInteractive,vt.EmbeddingTableauEventType.FirstInteractive],[vt.VizSharedAttributes.OnFirstVizSizeKnown,vt.EmbeddingTableauEventType.FirstVizSizeKnown],[vt.VizAttributes.OnMarkSelectionChanged,vt.EmbeddingTableauEventType.MarkSelectionChanged],[vt.VizAttributes.OnParameterChanged,vt.EmbeddingTableauEventType.ParameterChanged],[vt.VizAttributes.OnTabSwitched,vt.EmbeddingTableauEventType.TabSwitched],[vt.VizAttributes.OnToolbarStateChanged,vt.EmbeddingTableauEventType.ToolbarStateChanged],[vt.VizAttributes.OnUrlAction,vt.EmbeddingTableauEventType.UrlAction],[vt.VizAttributes.OnCustomViewLoaded,vt.EmbeddingTableauEventType.CustomViewLoaded],[vt.VizAttributes.OnCustomViewRemoved,vt.EmbeddingTableauEventType.CustomViewRemoved],[vt.VizAttributes.OnCustomViewSaved,vt.EmbeddingTableauEventType.CustomViewSaved],[vt.VizAttributes.OnCustomViewSetDefault,vt.EmbeddingTableauEventType.CustomViewSetDefault],[vt.VizAttributes.OnStoryPointSwitched,vt.EmbeddingTableauEventType.StoryPointSwitched],[vt.VizAttributes.OnSummaryDataChanged,vt.EmbeddingTableauEventType.SummaryDataChanged],[vt.VizAttributes.OnReadyToReceiveAuthToken,vt.EmbeddingTableauEventType.ReadyToReceiveAuthToken]]}getRegisteredEvents(){return super.getRegisteredEvents().concat([[Xa.NotificationId.SelectedMarksChanged,r=>this.shouldNotifyEvent(r),r=>this.handleSelectedMarksChangedEvent(r)],[Xa.NotificationId.FilterChanged,r=>this.shouldNotifyEvent(r.visualId),r=>this.handleFilterChangedEvent(r)],[Xa.NotificationId.EditButtonClicked,()=>!0,()=>this.handleEditButtonClicked()],[Xa.NotificationId.CustomMarkContextMenuClicked,r=>this.shouldNotifyEvent(r.visualId),r=>this.handleCustomMarkClickedContextMenuEvent(r)],[Xa.NotificationId.ParameterChanged,()=>!0,r=>this.handleParameterChangedEvent(r)],[Xa.NotificationId.UrlAction,()=>!0,r=>this.handleUrlAction(r)],[Xa.NotificationId.StoryPointSwitched,()=>!0,r=>this.handleStoryPointSwitch(r)],[Xa.NotificationId.SummaryDataChanged,r=>this.shouldNotifyEvent(r.visualId),r=>this.handleSummaryDataChangedEvent(r)]])}shouldNotifyEvent(r){switch(this.workbook.activeSheet.sheetType){case vt.SheetType.Worksheet:return this.workbook.activeSheet.name===r.worksheet;case vt.SheetType.Dashboard:return this.workbook.activeSheet.worksheets.filter(f=>f.name===r.worksheet).length===1;case vt.SheetType.Story:{const c=this.workbook.activeSheet.activeStoryPoint.containedSheet;return c?c.sheetType===vt.SheetType.Worksheet?c.name===r.worksheet:c.sheetType===vt.SheetType.Dashboard?c.worksheets.filter(b=>b.name===r.worksheet).length===1:!1:!1}default:return!1}}handleSelectedMarksChangedEvent(r){const a=new oV.MarksSelectedEvent(this.getWorksheetForNotificationHandler(r));this.dispatchEvent(new CustomEvent(vt.EmbeddingTableauEventType.MarkSelectionChanged,{detail:a}))}handleFilterChangedEvent(r){const a=new iV.FilterChangedEvent(this.getWorksheetForNotificationHandler(r.visualId),r.fieldName,r.fieldId);this.dispatchEvent(new CustomEvent(vt.EmbeddingTableauEventType.FilterChanged,{detail:a}))}handleSummaryDataChangedEvent(r){const a=new lV.SummaryDataChangedEvent(this.getWorksheetForNotificationHandler(r.visualId));this.dispatchEvent(new CustomEvent(vt.EmbeddingTableauEventType.SummaryDataChanged,{detail:a}))}handleEditButtonClicked(){this.dispatchEvent(new CustomEvent(vt.EmbeddingTableauEventType.EditButtonClicked))}handleCustomMarkClickedContextMenuEvent(r){const a=new nV.CustomMarkContextMenuEvent(this.getWorksheetForNotificationHandler(r.visualId),r.contextMenuId);this.dispatchEvent(new CustomEvent(vt.EmbeddingTableauEventType.CustomMarkContextMenuEvent,{detail:a}))}handleParameterChangedEvent(r){const a=new sV.ParameterChangedEvent(r,this.vizImpl.embeddingId);this.dispatchEvent(new CustomEvent(vt.EmbeddingTableauEventType.ParameterChanged,{detail:a}))}handleUrlAction(r){const a=new cV.UrlActionEvent(r.url,r.target);this.dispatchEvent(new CustomEvent(vt.EmbeddingTableauEventType.UrlAction,{detail:a}))}handleStoryPointSwitch(r){const a=this.vizImpl.workbookImpl.activeSheet,c=a.storyPointsInfo.find(f=>f.active===!0);if(a.activeStoryPoint&&c&&a.activeStoryPoint.index!==r.index){a.updateStory(r);const f=new aV.StoryPointSwitchedEvent(c,a.activeStoryPoint,this.vizImpl.workbookImpl);this.dispatchEvent(new CustomEvent(vt.EmbeddingTableauEventType.StoryPointSwitched,{detail:f}))}}getWorksheetForNotificationHandler(r){let a;switch(this.workbook.activeSheet.sheetType){case vt.SheetType.Worksheet:{a=this.workbook.activeSheet;break}case vt.SheetType.Dashboard:{const f=this.workbook.activeSheet.worksheets.filter(_=>_.name===r.worksheet);if(f.length===1)a=f[0];else throw new op.TableauError(vt.EmbeddingErrorCodes.IndexOutOfRange,"Worksheet not found");break}case vt.SheetType.Story:{const f=this.workbook.activeSheet.activeStoryPoint.containedSheet;if(!f)throw new op.TableauError(vt.EmbeddingErrorCodes.IndexOutOfRange,"Worksheet not found");if(f.sheetType===vt.SheetType.Worksheet)a=f;else if(f.sheetType===vt.SheetType.Dashboard){const b=f.worksheets.filter(s=>s.name===r.worksheet);if(b.length===1)a=b[0];else throw new op.TableauError(vt.EmbeddingErrorCodes.IndexOutOfRange,"Worksheet not found")}else throw new op.TableauError(vt.EmbeddingErrorCodes.ImplementationError,"Could not find sheetType");break}default:throw new op.TableauError(vt.EmbeddingErrorCodes.ImplementationError,"Could not find sheetType")}return a}get disableUrlActionsPopups(){return this.hasAttribute(vt.VizAttributes.DisableUrlActionsPopups)}set disableUrlActionsPopups(r){r?this.setAttribute(vt.VizAttributes.DisableUrlActionsPopups,""):this.removeAttribute(vt.VizAttributes.DisableUrlActionsPopups)}get hideTabs(){return this.hasAttribute(vt.VizAttributes.HideTabs)}set hideTabs(r){r?this.setAttribute(vt.VizAttributes.HideTabs,""):this.removeAttribute(vt.VizAttributes.HideTabs)}get toolbar(){const r=sp.attributeToEnumKey(this.getAttribute(vt.VizAttributes.Toolbar)),a=vt.Toolbar[r];return a||sp.TableauVizBase.VizAttributeDefaults.toolbar}set toolbar(r){r&&this.setAttribute(vt.VizAttributes.Toolbar,r)}get instanceIdToClone(){const r=this.getAttribute(vt.VizAttributes.InstanceIdToClone);if(r)return r}set instanceIdToClone(r){r?this.setAttribute(vt.VizAttributes.InstanceIdToClone,r):this.removeAttribute(vt.VizAttributes.InstanceIdToClone)}get device(){const r=sp.attributeToEnumKey(this.getAttribute(vt.VizAttributes.Device)),a=vt.DeviceType[r];return a||sp.TableauVizBase.VizAttributeDefaults.device}set device(r){this.setAttribute(vt.VizAttributes.Device,r)}get hideEditButton(){return this.hasAttribute(vt.VizAttributes.HideEditButton)}set hideEditButton(r){r?this.setAttribute(vt.VizAttributes.HideEditButton,""):this.removeAttribute(vt.VizAttributes.HideEditButton)}get automaticUpdatesArePaused(){return this.vizImpl.automaticUpdatesArePaused}pauseAutomaticUpdatesAsync(){return this.vizImpl.pauseAutomaticUpdatesAsync()}resumeAutomaticUpdatesAsync(){return this.vizImpl.resumeAutomaticUpdatesAsync()}toggleAutomaticUpdatesAsync(){return this.vizImpl.toggleAutomaticUpdatesAsync()}revertAllAsync(){return this.vizImpl.revertAllAsync()}refreshDataAsync(){return this.vizImpl.refreshDataAsync()}exportImageAsync(){return this.vizImpl.exportImageAsync()}exportCrosstabAsync(r,a){return this.vizImpl.exportCrosstabAsync(r,a)}exportDataAsync(r,a){return this.vizImpl.exportDataAsync(r,a)}exportPowerPointAsync(r){return this.vizImpl.exportPowerPointAsync(r)}exportPDFAsync(r,a){return this.vizImpl.exportPDFAsync(r,a)}displayDialogAsync(r){return this.vizImpl.displayDialogAsync(r)}redoAsync(){return this.vizImpl.redoAsync()}undoAsync(){return this.vizImpl.undoAsync()}setAuthToken(r){this.vizImpl.setAuthToken(r)}addFilter(r,a){this.preInitFilters.push({field:r,value:a}),hV.WebComponentManager.synchronizeRender(this.updateRenderingIfInitialized.bind(this,this.src))}get workbook(){return new uV.Workbook(this.vizImpl.workbookImpl)}};dg.TableauViz=dV;var TT;function xz(){if(TT)return jt;TT=1,Object.defineProperty(jt,"__esModule",{value:!0});const t=Or,r=$r,a=ug,c=hg,f=wT(),_=dg,b=typeof VERSION_IS_ALPHA<"u"?VERSION_IS_ALPHA:!1;r.ApiVersion.SetVersionNumber(typeof API_VERSION_NUMBER<"u"?API_VERSION_NUMBER:"0.0.0",b);function s(j,H){if(!(typeof window>"u"))try{window.customElements.get(j)?console.warn(`Custom element '${j}' is already defined.`):window.customElements.define(j,H)}catch(Z){console.error(`Error defining custom element '${j}':`,Z)}}function S(){return typeof window>"u"?!1:"customElements"in window}S()?(s("tableau-viz",_.TableauViz),s("tableau-authoring-viz",c.TableauAuthoringViz),s("tableau-ask-data",a.TableauAskData),s("tableau-pulse",f.TableauPulse)):console.error("Custom Elements API is not supported in this browser.");const C=Object.assign(Object.assign({},t.EmbeddingErrorCodes),t.SharedErrorCodes);jt.ErrorCodes=C;var k=Or;jt.AnalyticsObjectType=k.AnalyticsObjectType,jt.AnnotationType=k.AnnotationType,jt.ApiMenuType=k.ApiMenuType,jt.ClassNameKey=k.ClassNameKey,jt.ColumnType=k.ColumnType,jt.CrosstabFileFormat=k.CrosstabFileFormat,jt.DashboardLayoutChange=k.DashboardLayoutChange,jt.DashboardObjectType=k.DashboardObjectType,jt.DataType=k.DataType,jt.DateRangeType=k.DateRangeType,jt.DeviceType=k.DeviceType,jt.EmbeddedIframeAttributes=k.EmbeddedIframeAttributes,jt.EncodingType=k.EncodingType,jt.FieldAggregationType=k.FieldAggregationType,jt.FieldRoleType=k.FieldRoleType,jt.FileFormats=k.FileFormats,jt.FilterDomainType=k.FilterDomainType,jt.FilterNullOption=k.FilterNullOption,jt.FilterType=k.FilterType,jt.FilterUpdateType=k.FilterUpdateType,jt.HierarchicalLevelSelectionState=k.HierarchicalLevelSelectionState,jt.IncludeDataValuesOption=k.IncludeDataValuesOption,jt.MarkType=k.MarkType,jt.ParameterValueType=k.ParameterValueType,jt.PeriodType=k.PeriodType,jt.PrintOrientation=k.PrintOrientation,jt.PrintPageSize=k.PrintPageSize,jt.PrintScaling=k.PrintScaling,jt.PulseAttributes=k.PulseAttributes,jt.PulseErrorMessageVisibility=k.PulseErrorMessageVisibility,jt.PulseLayout=k.PulseLayout,jt.PulseTimeDimension=k.PulseTimeDimension,jt.QuickTableCalcType=k.QuickTableCalcType,jt.SelectionUpdateType=k.SelectionUpdateType,jt.SheetSizeBehavior=k.SheetSizeBehavior,jt.SheetType=k.SheetType,jt.SortDirection=k.SortDirection,jt.TableauDialogType=k.TableauDialogType,jt.TableauEventType=k.EmbeddingTableauEventType,jt.Toolbar=k.Toolbar,jt.TrendLineModelType=k.TrendLineModelType,jt.VizAttributes=k.VizAttributes,jt.VizAuthoringAttributes=k.VizAuthoringAttributes,jt.VizSharedAttributes=k.VizSharedAttributes,jt.WebComponentAttributes=k.WebComponentAttributes;var M=ug;jt.TableauAskData=M.TableauAskData;var L=hg;jt.TableauAuthoringViz=L.TableauAuthoringViz;var V=wT();jt.TableauPulse=V.TableauPulse;var O=dg;return jt.TableauViz=O.TableauViz,jt}var xx=xz(),vz={exports:{}};function pV(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var vx={exports:{}};const fV={},mV=Object.freeze(Object.defineProperty({__proto__:null,default:fV},Symbol.toStringTag,{value:"Module"})),gV=hC(mV);var CT;function xr(){return CT||(CT=1,function(t,r){(function(a,c){t.exports=c()})(gt,function(){var a=a||function(c,f){var _;if(typeof window<"u"&&window.crypto&&(_=window.crypto),typeof self<"u"&&self.crypto&&(_=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(_=globalThis.crypto),!_&&typeof window<"u"&&window.msCrypto&&(_=window.msCrypto),!_&&typeof gt<"u"&&gt.crypto&&(_=gt.crypto),!_&&typeof pV=="function")try{_=gV}catch{}var b=function(){if(_){if(typeof _.getRandomValues=="function")try{return _.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof _.randomBytes=="function")try{return _.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function U(){}return function($){var J;return U.prototype=$,J=new U,U.prototype=null,J}}(),S={},C=S.lib={},k=C.Base=function(){return{extend:function(U){var $=s(this);return U&&$.mixIn(U),(!$.hasOwnProperty("init")||this.init===$.init)&&($.init=function(){$.$super.init.apply(this,arguments)}),$.init.prototype=$,$.$super=this,$},create:function(){var U=this.extend();return U.init.apply(U,arguments),U},init:function(){},mixIn:function(U){for(var $ in U)U.hasOwnProperty($)&&(this[$]=U[$]);U.hasOwnProperty("toString")&&(this.toString=U.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),M=C.WordArray=k.extend({init:function(U,$){U=this.words=U||[],$!=f?this.sigBytes=$:this.sigBytes=U.length*4},toString:function(U){return(U||V).stringify(this)},concat:function(U){var $=this.words,J=U.words,le=this.sigBytes,pe=U.sigBytes;if(this.clamp(),le%4)for(var ye=0;ye<pe;ye++){var Te=J[ye>>>2]>>>24-ye%4*8&255;$[le+ye>>>2]|=Te<<24-(le+ye)%4*8}else for(var Se=0;Se<pe;Se+=4)$[le+Se>>>2]=J[Se>>>2];return this.sigBytes+=pe,this},clamp:function(){var U=this.words,$=this.sigBytes;U[$>>>2]&=4294967295<<32-$%4*8,U.length=c.ceil($/4)},clone:function(){var U=k.clone.call(this);return U.words=this.words.slice(0),U},random:function(U){for(var $=[],J=0;J<U;J+=4)$.push(b());return new M.init($,U)}}),L=S.enc={},V=L.Hex={stringify:function(U){for(var $=U.words,J=U.sigBytes,le=[],pe=0;pe<J;pe++){var ye=$[pe>>>2]>>>24-pe%4*8&255;le.push((ye>>>4).toString(16)),le.push((ye&15).toString(16))}return le.join("")},parse:function(U){for(var $=U.length,J=[],le=0;le<$;le+=2)J[le>>>3]|=parseInt(U.substr(le,2),16)<<24-le%8*4;return new M.init(J,$/2)}},O=L.Latin1={stringify:function(U){for(var $=U.words,J=U.sigBytes,le=[],pe=0;pe<J;pe++){var ye=$[pe>>>2]>>>24-pe%4*8&255;le.push(String.fromCharCode(ye))}return le.join("")},parse:function(U){for(var $=U.length,J=[],le=0;le<$;le++)J[le>>>2]|=(U.charCodeAt(le)&255)<<24-le%4*8;return new M.init(J,$)}},j=L.Utf8={stringify:function(U){try{return decodeURIComponent(escape(O.stringify(U)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(U){return O.parse(unescape(encodeURIComponent(U)))}},H=C.BufferedBlockAlgorithm=k.extend({reset:function(){this._data=new M.init,this._nDataBytes=0},_append:function(U){typeof U=="string"&&(U=j.parse(U)),this._data.concat(U),this._nDataBytes+=U.sigBytes},_process:function(U){var $,J=this._data,le=J.words,pe=J.sigBytes,ye=this.blockSize,Te=ye*4,Se=pe/Te;U?Se=c.ceil(Se):Se=c.max((Se|0)-this._minBufferSize,0);var Ae=Se*ye,Ne=c.min(Ae*4,pe);if(Ae){for(var Ue=0;Ue<Ae;Ue+=ye)this._doProcessBlock(le,Ue);$=le.splice(0,Ae),J.sigBytes-=Ne}return new M.init($,Ne)},clone:function(){var U=k.clone.call(this);return U._data=this._data.clone(),U},_minBufferSize:0});C.Hasher=H.extend({cfg:k.extend(),init:function(U){this.cfg=this.cfg.extend(U),this.reset()},reset:function(){H.reset.call(this),this._doReset()},update:function(U){return this._append(U),this._process(),this},finalize:function(U){U&&this._append(U);var $=this._doFinalize();return $},blockSize:16,_createHelper:function(U){return function($,J){return new U.init(J).finalize($)}},_createHmacHelper:function(U){return function($,J){return new Z.HMAC.init(U,J).finalize($)}}});var Z=S.algo={};return S}(Math);return a})}(vx)),vx.exports}var bx={exports:{}},IT;function Xg(){return IT||(IT=1,function(t,r){(function(a,c){t.exports=c(xr())})(gt,function(a){return function(c){var f=a,_=f.lib,b=_.Base,s=_.WordArray,S=f.x64={};S.Word=b.extend({init:function(C,k){this.high=C,this.low=k}}),S.WordArray=b.extend({init:function(C,k){C=this.words=C||[],k!=c?this.sigBytes=k:this.sigBytes=C.length*8},toX32:function(){for(var C=this.words,k=C.length,M=[],L=0;L<k;L++){var V=C[L];M.push(V.high),M.push(V.low)}return s.create(M,this.sigBytes)},clone:function(){for(var C=b.clone.call(this),k=C.words=this.words.slice(0),M=k.length,L=0;L<M;L++)k[L]=k[L].clone();return C}})}(),a})}(bx)),bx.exports}var wx={exports:{}},kT;function _V(){return kT||(kT=1,function(t,r){(function(a,c){t.exports=c(xr())})(gt,function(a){return function(){if(typeof ArrayBuffer=="function"){var c=a,f=c.lib,_=f.WordArray,b=_.init,s=_.init=function(S){if(S instanceof ArrayBuffer&&(S=new Uint8Array(S)),(S instanceof Int8Array||typeof Uint8ClampedArray<"u"&&S instanceof Uint8ClampedArray||S instanceof Int16Array||S instanceof Uint16Array||S instanceof Int32Array||S instanceof Uint32Array||S instanceof Float32Array||S instanceof Float64Array)&&(S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength)),S instanceof Uint8Array){for(var C=S.byteLength,k=[],M=0;M<C;M++)k[M>>>2]|=S[M]<<24-M%4*8;b.call(this,k,C)}else b.apply(this,arguments)};s.prototype=_}}(),a.lib.WordArray})}(wx)),wx.exports}var Ex={exports:{}},PT;function yV(){return PT||(PT=1,function(t,r){(function(a,c){t.exports=c(xr())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.WordArray,b=c.enc;b.Utf16=b.Utf16BE={stringify:function(S){for(var C=S.words,k=S.sigBytes,M=[],L=0;L<k;L+=2){var V=C[L>>>2]>>>16-L%4*8&65535;M.push(String.fromCharCode(V))}return M.join("")},parse:function(S){for(var C=S.length,k=[],M=0;M<C;M++)k[M>>>1]|=S.charCodeAt(M)<<16-M%2*16;return _.create(k,C*2)}},b.Utf16LE={stringify:function(S){for(var C=S.words,k=S.sigBytes,M=[],L=0;L<k;L+=2){var V=s(C[L>>>2]>>>16-L%4*8&65535);M.push(String.fromCharCode(V))}return M.join("")},parse:function(S){for(var C=S.length,k=[],M=0;M<C;M++)k[M>>>1]|=s(S.charCodeAt(M)<<16-M%2*16);return _.create(k,C*2)}};function s(S){return S<<8&4278255360|S>>>8&16711935}}(),a.enc.Utf16})}(Ex)),Ex.exports}var Sx={exports:{}},zT;function kc(){return zT||(zT=1,function(t,r){(function(a,c){t.exports=c(xr())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.WordArray,b=c.enc;b.Base64={stringify:function(S){var C=S.words,k=S.sigBytes,M=this._map;S.clamp();for(var L=[],V=0;V<k;V+=3)for(var O=C[V>>>2]>>>24-V%4*8&255,j=C[V+1>>>2]>>>24-(V+1)%4*8&255,H=C[V+2>>>2]>>>24-(V+2)%4*8&255,Z=O<<16|j<<8|H,U=0;U<4&&V+U*.75<k;U++)L.push(M.charAt(Z>>>6*(3-U)&63));var $=M.charAt(64);if($)for(;L.length%4;)L.push($);return L.join("")},parse:function(S){var C=S.length,k=this._map,M=this._reverseMap;if(!M){M=this._reverseMap=[];for(var L=0;L<k.length;L++)M[k.charCodeAt(L)]=L}var V=k.charAt(64);if(V){var O=S.indexOf(V);O!==-1&&(C=O)}return s(S,C,M)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function s(S,C,k){for(var M=[],L=0,V=0;V<C;V++)if(V%4){var O=k[S.charCodeAt(V-1)]<<V%4*2,j=k[S.charCodeAt(V)]>>>6-V%4*2,H=O|j;M[L>>>2]|=H<<24-L%4*8,L++}return _.create(M,L)}}(),a.enc.Base64})}(Sx)),Sx.exports}var Ax={exports:{}},DT;function xV(){return DT||(DT=1,function(t,r){(function(a,c){t.exports=c(xr())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.WordArray,b=c.enc;b.Base64url={stringify:function(S,C){C===void 0&&(C=!0);var k=S.words,M=S.sigBytes,L=C?this._safe_map:this._map;S.clamp();for(var V=[],O=0;O<M;O+=3)for(var j=k[O>>>2]>>>24-O%4*8&255,H=k[O+1>>>2]>>>24-(O+1)%4*8&255,Z=k[O+2>>>2]>>>24-(O+2)%4*8&255,U=j<<16|H<<8|Z,$=0;$<4&&O+$*.75<M;$++)V.push(L.charAt(U>>>6*(3-$)&63));var J=L.charAt(64);if(J)for(;V.length%4;)V.push(J);return V.join("")},parse:function(S,C){C===void 0&&(C=!0);var k=S.length,M=C?this._safe_map:this._map,L=this._reverseMap;if(!L){L=this._reverseMap=[];for(var V=0;V<M.length;V++)L[M.charCodeAt(V)]=V}var O=M.charAt(64);if(O){var j=S.indexOf(O);j!==-1&&(k=j)}return s(S,k,L)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function s(S,C,k){for(var M=[],L=0,V=0;V<C;V++)if(V%4){var O=k[S.charCodeAt(V-1)]<<V%4*2,j=k[S.charCodeAt(V)]>>>6-V%4*2,H=O|j;M[L>>>2]|=H<<24-L%4*8,L++}return _.create(M,L)}}(),a.enc.Base64url})}(Ax)),Ax.exports}var Tx={exports:{}},MT;function Pc(){return MT||(MT=1,function(t,r){(function(a,c){t.exports=c(xr())})(gt,function(a){return function(c){var f=a,_=f.lib,b=_.WordArray,s=_.Hasher,S=f.algo,C=[];(function(){for(var j=0;j<64;j++)C[j]=c.abs(c.sin(j+1))*4294967296|0})();var k=S.MD5=s.extend({_doReset:function(){this._hash=new b.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(j,H){for(var Z=0;Z<16;Z++){var U=H+Z,$=j[U];j[U]=($<<8|$>>>24)&16711935|($<<24|$>>>8)&4278255360}var J=this._hash.words,le=j[H+0],pe=j[H+1],ye=j[H+2],Te=j[H+3],Se=j[H+4],Ae=j[H+5],Ne=j[H+6],Ue=j[H+7],je=j[H+8],Ct=j[H+9],zt=j[H+10],Ut=j[H+11],sr=j[H+12],Ge=j[H+13],St=j[H+14],ft=j[H+15],Ve=J[0],Je=J[1],et=J[2],tt=J[3];Ve=M(Ve,Je,et,tt,le,7,C[0]),tt=M(tt,Ve,Je,et,pe,12,C[1]),et=M(et,tt,Ve,Je,ye,17,C[2]),Je=M(Je,et,tt,Ve,Te,22,C[3]),Ve=M(Ve,Je,et,tt,Se,7,C[4]),tt=M(tt,Ve,Je,et,Ae,12,C[5]),et=M(et,tt,Ve,Je,Ne,17,C[6]),Je=M(Je,et,tt,Ve,Ue,22,C[7]),Ve=M(Ve,Je,et,tt,je,7,C[8]),tt=M(tt,Ve,Je,et,Ct,12,C[9]),et=M(et,tt,Ve,Je,zt,17,C[10]),Je=M(Je,et,tt,Ve,Ut,22,C[11]),Ve=M(Ve,Je,et,tt,sr,7,C[12]),tt=M(tt,Ve,Je,et,Ge,12,C[13]),et=M(et,tt,Ve,Je,St,17,C[14]),Je=M(Je,et,tt,Ve,ft,22,C[15]),Ve=L(Ve,Je,et,tt,pe,5,C[16]),tt=L(tt,Ve,Je,et,Ne,9,C[17]),et=L(et,tt,Ve,Je,Ut,14,C[18]),Je=L(Je,et,tt,Ve,le,20,C[19]),Ve=L(Ve,Je,et,tt,Ae,5,C[20]),tt=L(tt,Ve,Je,et,zt,9,C[21]),et=L(et,tt,Ve,Je,ft,14,C[22]),Je=L(Je,et,tt,Ve,Se,20,C[23]),Ve=L(Ve,Je,et,tt,Ct,5,C[24]),tt=L(tt,Ve,Je,et,St,9,C[25]),et=L(et,tt,Ve,Je,Te,14,C[26]),Je=L(Je,et,tt,Ve,je,20,C[27]),Ve=L(Ve,Je,et,tt,Ge,5,C[28]),tt=L(tt,Ve,Je,et,ye,9,C[29]),et=L(et,tt,Ve,Je,Ue,14,C[30]),Je=L(Je,et,tt,Ve,sr,20,C[31]),Ve=V(Ve,Je,et,tt,Ae,4,C[32]),tt=V(tt,Ve,Je,et,je,11,C[33]),et=V(et,tt,Ve,Je,Ut,16,C[34]),Je=V(Je,et,tt,Ve,St,23,C[35]),Ve=V(Ve,Je,et,tt,pe,4,C[36]),tt=V(tt,Ve,Je,et,Se,11,C[37]),et=V(et,tt,Ve,Je,Ue,16,C[38]),Je=V(Je,et,tt,Ve,zt,23,C[39]),Ve=V(Ve,Je,et,tt,Ge,4,C[40]),tt=V(tt,Ve,Je,et,le,11,C[41]),et=V(et,tt,Ve,Je,Te,16,C[42]),Je=V(Je,et,tt,Ve,Ne,23,C[43]),Ve=V(Ve,Je,et,tt,Ct,4,C[44]),tt=V(tt,Ve,Je,et,sr,11,C[45]),et=V(et,tt,Ve,Je,ft,16,C[46]),Je=V(Je,et,tt,Ve,ye,23,C[47]),Ve=O(Ve,Je,et,tt,le,6,C[48]),tt=O(tt,Ve,Je,et,Ue,10,C[49]),et=O(et,tt,Ve,Je,St,15,C[50]),Je=O(Je,et,tt,Ve,Ae,21,C[51]),Ve=O(Ve,Je,et,tt,sr,6,C[52]),tt=O(tt,Ve,Je,et,Te,10,C[53]),et=O(et,tt,Ve,Je,zt,15,C[54]),Je=O(Je,et,tt,Ve,pe,21,C[55]),Ve=O(Ve,Je,et,tt,je,6,C[56]),tt=O(tt,Ve,Je,et,ft,10,C[57]),et=O(et,tt,Ve,Je,Ne,15,C[58]),Je=O(Je,et,tt,Ve,Ge,21,C[59]),Ve=O(Ve,Je,et,tt,Se,6,C[60]),tt=O(tt,Ve,Je,et,Ut,10,C[61]),et=O(et,tt,Ve,Je,ye,15,C[62]),Je=O(Je,et,tt,Ve,Ct,21,C[63]),J[0]=J[0]+Ve|0,J[1]=J[1]+Je|0,J[2]=J[2]+et|0,J[3]=J[3]+tt|0},_doFinalize:function(){var j=this._data,H=j.words,Z=this._nDataBytes*8,U=j.sigBytes*8;H[U>>>5]|=128<<24-U%32;var $=c.floor(Z/4294967296),J=Z;H[(U+64>>>9<<4)+15]=($<<8|$>>>24)&16711935|($<<24|$>>>8)&4278255360,H[(U+64>>>9<<4)+14]=(J<<8|J>>>24)&16711935|(J<<24|J>>>8)&4278255360,j.sigBytes=(H.length+1)*4,this._process();for(var le=this._hash,pe=le.words,ye=0;ye<4;ye++){var Te=pe[ye];pe[ye]=(Te<<8|Te>>>24)&16711935|(Te<<24|Te>>>8)&4278255360}return le},clone:function(){var j=s.clone.call(this);return j._hash=this._hash.clone(),j}});function M(j,H,Z,U,$,J,le){var pe=j+(H&Z|~H&U)+$+le;return(pe<<J|pe>>>32-J)+H}function L(j,H,Z,U,$,J,le){var pe=j+(H&U|Z&~U)+$+le;return(pe<<J|pe>>>32-J)+H}function V(j,H,Z,U,$,J,le){var pe=j+(H^Z^U)+$+le;return(pe<<J|pe>>>32-J)+H}function O(j,H,Z,U,$,J,le){var pe=j+(Z^(H|~U))+$+le;return(pe<<J|pe>>>32-J)+H}f.MD5=s._createHelper(k),f.HmacMD5=s._createHmacHelper(k)}(Math),a.MD5})}(Tx)),Tx.exports}var Cx={exports:{}},RT;function bz(){return RT||(RT=1,function(t,r){(function(a,c){t.exports=c(xr())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.WordArray,b=f.Hasher,s=c.algo,S=[],C=s.SHA1=b.extend({_doReset:function(){this._hash=new _.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(k,M){for(var L=this._hash.words,V=L[0],O=L[1],j=L[2],H=L[3],Z=L[4],U=0;U<80;U++){if(U<16)S[U]=k[M+U]|0;else{var $=S[U-3]^S[U-8]^S[U-14]^S[U-16];S[U]=$<<1|$>>>31}var J=(V<<5|V>>>27)+Z+S[U];U<20?J+=(O&j|~O&H)+1518500249:U<40?J+=(O^j^H)+1859775393:U<60?J+=(O&j|O&H|j&H)-1894007588:J+=(O^j^H)-899497514,Z=H,H=j,j=O<<30|O>>>2,O=V,V=J}L[0]=L[0]+V|0,L[1]=L[1]+O|0,L[2]=L[2]+j|0,L[3]=L[3]+H|0,L[4]=L[4]+Z|0},_doFinalize:function(){var k=this._data,M=k.words,L=this._nDataBytes*8,V=k.sigBytes*8;return M[V>>>5]|=128<<24-V%32,M[(V+64>>>9<<4)+14]=Math.floor(L/4294967296),M[(V+64>>>9<<4)+15]=L,k.sigBytes=M.length*4,this._process(),this._hash},clone:function(){var k=b.clone.call(this);return k._hash=this._hash.clone(),k}});c.SHA1=b._createHelper(C),c.HmacSHA1=b._createHmacHelper(C)}(),a.SHA1})}(Cx)),Cx.exports}var Ix={exports:{}},BT;function ew(){return BT||(BT=1,function(t,r){(function(a,c){t.exports=c(xr())})(gt,function(a){return function(c){var f=a,_=f.lib,b=_.WordArray,s=_.Hasher,S=f.algo,C=[],k=[];(function(){function V(Z){for(var U=c.sqrt(Z),$=2;$<=U;$++)if(!(Z%$))return!1;return!0}function O(Z){return(Z-(Z|0))*4294967296|0}for(var j=2,H=0;H<64;)V(j)&&(H<8&&(C[H]=O(c.pow(j,1/2))),k[H]=O(c.pow(j,1/3)),H++),j++})();var M=[],L=S.SHA256=s.extend({_doReset:function(){this._hash=new b.init(C.slice(0))},_doProcessBlock:function(V,O){for(var j=this._hash.words,H=j[0],Z=j[1],U=j[2],$=j[3],J=j[4],le=j[5],pe=j[6],ye=j[7],Te=0;Te<64;Te++){if(Te<16)M[Te]=V[O+Te]|0;else{var Se=M[Te-15],Ae=(Se<<25|Se>>>7)^(Se<<14|Se>>>18)^Se>>>3,Ne=M[Te-2],Ue=(Ne<<15|Ne>>>17)^(Ne<<13|Ne>>>19)^Ne>>>10;M[Te]=Ae+M[Te-7]+Ue+M[Te-16]}var je=J&le^~J&pe,Ct=H&Z^H&U^Z&U,zt=(H<<30|H>>>2)^(H<<19|H>>>13)^(H<<10|H>>>22),Ut=(J<<26|J>>>6)^(J<<21|J>>>11)^(J<<7|J>>>25),sr=ye+Ut+je+k[Te]+M[Te],Ge=zt+Ct;ye=pe,pe=le,le=J,J=$+sr|0,$=U,U=Z,Z=H,H=sr+Ge|0}j[0]=j[0]+H|0,j[1]=j[1]+Z|0,j[2]=j[2]+U|0,j[3]=j[3]+$|0,j[4]=j[4]+J|0,j[5]=j[5]+le|0,j[6]=j[6]+pe|0,j[7]=j[7]+ye|0},_doFinalize:function(){var V=this._data,O=V.words,j=this._nDataBytes*8,H=V.sigBytes*8;return O[H>>>5]|=128<<24-H%32,O[(H+64>>>9<<4)+14]=c.floor(j/4294967296),O[(H+64>>>9<<4)+15]=j,V.sigBytes=O.length*4,this._process(),this._hash},clone:function(){var V=s.clone.call(this);return V._hash=this._hash.clone(),V}});f.SHA256=s._createHelper(L),f.HmacSHA256=s._createHmacHelper(L)}(Math),a.SHA256})}(Ix)),Ix.exports}var kx={exports:{}},LT;function vV(){return LT||(LT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),ew())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.WordArray,b=c.algo,s=b.SHA256,S=b.SHA224=s.extend({_doReset:function(){this._hash=new _.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var C=s._doFinalize.call(this);return C.sigBytes-=4,C}});c.SHA224=s._createHelper(S),c.HmacSHA224=s._createHmacHelper(S)}(),a.SHA224})}(kx)),kx.exports}var Px={exports:{}},FT;function wz(){return FT||(FT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Xg())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.Hasher,b=c.x64,s=b.Word,S=b.WordArray,C=c.algo;function k(){return s.create.apply(s,arguments)}var M=[k(1116352408,3609767458),k(1899447441,602891725),k(3049323471,3964484399),k(3921009573,2173295548),k(961987163,4081628472),k(1508970993,3053834265),k(2453635748,2937671579),k(2870763221,3664609560),k(3624381080,2734883394),k(310598401,1164996542),k(607225278,1323610764),k(1426881987,3590304994),k(1925078388,4068182383),k(2162078206,991336113),k(2614888103,633803317),k(3248222580,3479774868),k(3835390401,2666613458),k(4022224774,944711139),k(264347078,2341262773),k(604807628,2007800933),k(770255983,1495990901),k(1249150122,1856431235),k(1555081692,3175218132),k(1996064986,2198950837),k(2554220882,3999719339),k(2821834349,766784016),k(2952996808,2566594879),k(3210313671,3203337956),k(3336571891,1034457026),k(3584528711,2466948901),k(113926993,3758326383),k(338241895,168717936),k(666307205,1188179964),k(773529912,1546045734),k(1294757372,1522805485),k(1396182291,2643833823),k(1695183700,2343527390),k(1986661051,1014477480),k(2177026350,1206759142),k(2456956037,344077627),k(2730485921,1290863460),k(2820302411,3158454273),k(3259730800,3505952657),k(3345764771,106217008),k(3516065817,3606008344),k(3600352804,1432725776),k(4094571909,1467031594),k(275423344,851169720),k(430227734,3100823752),k(506948616,1363258195),k(659060556,3750685593),k(883997877,3785050280),k(958139571,3318307427),k(1322822218,3812723403),k(1537002063,2003034995),k(1747873779,3602036899),k(1955562222,1575990012),k(2024104815,1125592928),k(2227730452,2716904306),k(2361852424,442776044),k(2428436474,593698344),k(2756734187,3733110249),k(3204031479,2999351573),k(3329325298,3815920427),k(3391569614,3928383900),k(3515267271,566280711),k(3940187606,3454069534),k(4118630271,4000239992),k(116418474,1914138554),k(174292421,2731055270),k(289380356,3203993006),k(460393269,320620315),k(685471733,587496836),k(852142971,1086792851),k(1017036298,365543100),k(1126000580,2618297676),k(1288033470,3409855158),k(1501505948,4234509866),k(1607167915,987167468),k(1816402316,1246189591)],L=[];(function(){for(var O=0;O<80;O++)L[O]=k()})();var V=C.SHA512=_.extend({_doReset:function(){this._hash=new S.init([new s.init(1779033703,4089235720),new s.init(3144134277,2227873595),new s.init(1013904242,4271175723),new s.init(2773480762,1595750129),new s.init(1359893119,2917565137),new s.init(2600822924,725511199),new s.init(528734635,4215389547),new s.init(1541459225,327033209)])},_doProcessBlock:function(O,j){for(var H=this._hash.words,Z=H[0],U=H[1],$=H[2],J=H[3],le=H[4],pe=H[5],ye=H[6],Te=H[7],Se=Z.high,Ae=Z.low,Ne=U.high,Ue=U.low,je=$.high,Ct=$.low,zt=J.high,Ut=J.low,sr=le.high,Ge=le.low,St=pe.high,ft=pe.low,Ve=ye.high,Je=ye.low,et=Te.high,tt=Te.low,ir=Se,Zt=Ae,vr=Ne,Xt=Ue,qn=je,cr=Ct,Ot=zt,li=Ut,Br=sr,tn=Ge,gr=St,An=ft,Bo=Ve,ei=Je,Fn=et,Zi=tt,Tn=0;Tn<80;Tn++){var Cn,On,Xi=L[Tn];if(Tn<16)On=Xi.high=O[j+Tn*2]|0,Cn=Xi.low=O[j+Tn*2+1]|0;else{var Fs=L[Tn-15],Ki=Fs.high,In=Fs.low,mo=(Ki>>>1|In<<31)^(Ki>>>8|In<<24)^Ki>>>7,fs=(In>>>1|Ki<<31)^(In>>>8|Ki<<24)^(In>>>7|Ki<<25),go=L[Tn-2],Si=go.high,Yi=go.low,Lo=(Si>>>19|Yi<<13)^(Si<<3|Yi>>>29)^Si>>>6,Ji=(Yi>>>19|Si<<13)^(Yi<<3|Si>>>29)^(Yi>>>6|Si<<26),_o=L[Tn-7],Fo=_o.high,ms=_o.low,Os=L[Tn-16],de=Os.high,X=Os.low;Cn=fs+ms,On=mo+Fo+(Cn>>>0<fs>>>0?1:0),Cn=Cn+Ji,On=On+Lo+(Cn>>>0<Ji>>>0?1:0),Cn=Cn+X,On=On+de+(Cn>>>0<X>>>0?1:0),Xi.high=On,Xi.low=Cn}var K=Br&gr^~Br&Bo,ue=tn&An^~tn&ei,_e=ir&vr^ir&qn^vr&qn,Ee=Zt&Xt^Zt&cr^Xt&cr,Pe=(ir>>>28|Zt<<4)^(ir<<30|Zt>>>2)^(ir<<25|Zt>>>7),ke=(Zt>>>28|ir<<4)^(Zt<<30|ir>>>2)^(Zt<<25|ir>>>7),we=(Br>>>14|tn<<18)^(Br>>>18|tn<<14)^(Br<<23|tn>>>9),Le=(tn>>>14|Br<<18)^(tn>>>18|Br<<14)^(tn<<23|Br>>>9),ct=M[Tn],dt=ct.high,st=ct.low,Rt=Zi+Le,Ft=Fn+we+(Rt>>>0<Zi>>>0?1:0),Rt=Rt+ue,Ft=Ft+K+(Rt>>>0<ue>>>0?1:0),Rt=Rt+st,Ft=Ft+dt+(Rt>>>0<st>>>0?1:0),Rt=Rt+Cn,Ft=Ft+On+(Rt>>>0<Cn>>>0?1:0),Vt=ke+Ee,Kt=Pe+_e+(Vt>>>0<ke>>>0?1:0);Fn=Bo,Zi=ei,Bo=gr,ei=An,gr=Br,An=tn,tn=li+Rt|0,Br=Ot+Ft+(tn>>>0<li>>>0?1:0)|0,Ot=qn,li=cr,qn=vr,cr=Xt,vr=ir,Xt=Zt,Zt=Rt+Vt|0,ir=Ft+Kt+(Zt>>>0<Rt>>>0?1:0)|0}Ae=Z.low=Ae+Zt,Z.high=Se+ir+(Ae>>>0<Zt>>>0?1:0),Ue=U.low=Ue+Xt,U.high=Ne+vr+(Ue>>>0<Xt>>>0?1:0),Ct=$.low=Ct+cr,$.high=je+qn+(Ct>>>0<cr>>>0?1:0),Ut=J.low=Ut+li,J.high=zt+Ot+(Ut>>>0<li>>>0?1:0),Ge=le.low=Ge+tn,le.high=sr+Br+(Ge>>>0<tn>>>0?1:0),ft=pe.low=ft+An,pe.high=St+gr+(ft>>>0<An>>>0?1:0),Je=ye.low=Je+ei,ye.high=Ve+Bo+(Je>>>0<ei>>>0?1:0),tt=Te.low=tt+Zi,Te.high=et+Fn+(tt>>>0<Zi>>>0?1:0)},_doFinalize:function(){var O=this._data,j=O.words,H=this._nDataBytes*8,Z=O.sigBytes*8;j[Z>>>5]|=128<<24-Z%32,j[(Z+128>>>10<<5)+30]=Math.floor(H/4294967296),j[(Z+128>>>10<<5)+31]=H,O.sigBytes=j.length*4,this._process();var U=this._hash.toX32();return U},clone:function(){var O=_.clone.call(this);return O._hash=this._hash.clone(),O},blockSize:1024/32});c.SHA512=_._createHelper(V),c.HmacSHA512=_._createHmacHelper(V)}(),a.SHA512})}(Px)),Px.exports}var zx={exports:{}},OT;function bV(){return OT||(OT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Xg(),wz())})(gt,function(a){return function(){var c=a,f=c.x64,_=f.Word,b=f.WordArray,s=c.algo,S=s.SHA512,C=s.SHA384=S.extend({_doReset:function(){this._hash=new b.init([new _.init(3418070365,3238371032),new _.init(1654270250,914150663),new _.init(2438529370,812702999),new _.init(355462360,4144912697),new _.init(1731405415,4290775857),new _.init(2394180231,1750603025),new _.init(3675008525,1694076839),new _.init(1203062813,3204075428)])},_doFinalize:function(){var k=S._doFinalize.call(this);return k.sigBytes-=16,k}});c.SHA384=S._createHelper(C),c.HmacSHA384=S._createHmacHelper(C)}(),a.SHA384})}(zx)),zx.exports}var Dx={exports:{}},NT;function wV(){return NT||(NT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Xg())})(gt,function(a){return function(c){var f=a,_=f.lib,b=_.WordArray,s=_.Hasher,S=f.x64,C=S.Word,k=f.algo,M=[],L=[],V=[];(function(){for(var H=1,Z=0,U=0;U<24;U++){M[H+5*Z]=(U+1)*(U+2)/2%64;var $=Z%5,J=(2*H+3*Z)%5;H=$,Z=J}for(var H=0;H<5;H++)for(var Z=0;Z<5;Z++)L[H+5*Z]=Z+(2*H+3*Z)%5*5;for(var le=1,pe=0;pe<24;pe++){for(var ye=0,Te=0,Se=0;Se<7;Se++){if(le&1){var Ae=(1<<Se)-1;Ae<32?Te^=1<<Ae:ye^=1<<Ae-32}le&128?le=le<<1^113:le<<=1}V[pe]=C.create(ye,Te)}})();var O=[];(function(){for(var H=0;H<25;H++)O[H]=C.create()})();var j=k.SHA3=s.extend({cfg:s.cfg.extend({outputLength:512}),_doReset:function(){for(var H=this._state=[],Z=0;Z<25;Z++)H[Z]=new C.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(H,Z){for(var U=this._state,$=this.blockSize/2,J=0;J<$;J++){var le=H[Z+2*J],pe=H[Z+2*J+1];le=(le<<8|le>>>24)&16711935|(le<<24|le>>>8)&4278255360,pe=(pe<<8|pe>>>24)&16711935|(pe<<24|pe>>>8)&4278255360;var ye=U[J];ye.high^=pe,ye.low^=le}for(var Te=0;Te<24;Te++){for(var Se=0;Se<5;Se++){for(var Ae=0,Ne=0,Ue=0;Ue<5;Ue++){var ye=U[Se+5*Ue];Ae^=ye.high,Ne^=ye.low}var je=O[Se];je.high=Ae,je.low=Ne}for(var Se=0;Se<5;Se++)for(var Ct=O[(Se+4)%5],zt=O[(Se+1)%5],Ut=zt.high,sr=zt.low,Ae=Ct.high^(Ut<<1|sr>>>31),Ne=Ct.low^(sr<<1|Ut>>>31),Ue=0;Ue<5;Ue++){var ye=U[Se+5*Ue];ye.high^=Ae,ye.low^=Ne}for(var Ge=1;Ge<25;Ge++){var Ae,Ne,ye=U[Ge],St=ye.high,ft=ye.low,Ve=M[Ge];Ve<32?(Ae=St<<Ve|ft>>>32-Ve,Ne=ft<<Ve|St>>>32-Ve):(Ae=ft<<Ve-32|St>>>64-Ve,Ne=St<<Ve-32|ft>>>64-Ve);var Je=O[L[Ge]];Je.high=Ae,Je.low=Ne}var et=O[0],tt=U[0];et.high=tt.high,et.low=tt.low;for(var Se=0;Se<5;Se++)for(var Ue=0;Ue<5;Ue++){var Ge=Se+5*Ue,ye=U[Ge],ir=O[Ge],Zt=O[(Se+1)%5+5*Ue],vr=O[(Se+2)%5+5*Ue];ye.high=ir.high^~Zt.high&vr.high,ye.low=ir.low^~Zt.low&vr.low}var ye=U[0],Xt=V[Te];ye.high^=Xt.high,ye.low^=Xt.low}},_doFinalize:function(){var H=this._data,Z=H.words;this._nDataBytes*8;var U=H.sigBytes*8,$=this.blockSize*32;Z[U>>>5]|=1<<24-U%32,Z[(c.ceil((U+1)/$)*$>>>5)-1]|=128,H.sigBytes=Z.length*4,this._process();for(var J=this._state,le=this.cfg.outputLength/8,pe=le/8,ye=[],Te=0;Te<pe;Te++){var Se=J[Te],Ae=Se.high,Ne=Se.low;Ae=(Ae<<8|Ae>>>24)&16711935|(Ae<<24|Ae>>>8)&4278255360,Ne=(Ne<<8|Ne>>>24)&16711935|(Ne<<24|Ne>>>8)&4278255360,ye.push(Ne),ye.push(Ae)}return new b.init(ye,le)},clone:function(){for(var H=s.clone.call(this),Z=H._state=this._state.slice(0),U=0;U<25;U++)Z[U]=Z[U].clone();return H}});f.SHA3=s._createHelper(j),f.HmacSHA3=s._createHmacHelper(j)}(Math),a.SHA3})}(Dx)),Dx.exports}var Mx={exports:{}},UT;function EV(){return UT||(UT=1,function(t,r){(function(a,c){t.exports=c(xr())})(gt,function(a){/** @preserve
			(c) 2012 by Cdric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(c){var f=a,_=f.lib,b=_.WordArray,s=_.Hasher,S=f.algo,C=b.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),k=b.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),M=b.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),L=b.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),V=b.create([0,1518500249,1859775393,2400959708,2840853838]),O=b.create([1352829926,1548603684,1836072691,2053994217,0]),j=S.RIPEMD160=s.extend({_doReset:function(){this._hash=b.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(pe,ye){for(var Te=0;Te<16;Te++){var Se=ye+Te,Ae=pe[Se];pe[Se]=(Ae<<8|Ae>>>24)&16711935|(Ae<<24|Ae>>>8)&4278255360}var Ne=this._hash.words,Ue=V.words,je=O.words,Ct=C.words,zt=k.words,Ut=M.words,sr=L.words,Ge,St,ft,Ve,Je,et,tt,ir,Zt,vr;et=Ge=Ne[0],tt=St=Ne[1],ir=ft=Ne[2],Zt=Ve=Ne[3],vr=Je=Ne[4];for(var Xt,Te=0;Te<80;Te+=1)Xt=Ge+pe[ye+Ct[Te]]|0,Te<16?Xt+=H(St,ft,Ve)+Ue[0]:Te<32?Xt+=Z(St,ft,Ve)+Ue[1]:Te<48?Xt+=U(St,ft,Ve)+Ue[2]:Te<64?Xt+=$(St,ft,Ve)+Ue[3]:Xt+=J(St,ft,Ve)+Ue[4],Xt=Xt|0,Xt=le(Xt,Ut[Te]),Xt=Xt+Je|0,Ge=Je,Je=Ve,Ve=le(ft,10),ft=St,St=Xt,Xt=et+pe[ye+zt[Te]]|0,Te<16?Xt+=J(tt,ir,Zt)+je[0]:Te<32?Xt+=$(tt,ir,Zt)+je[1]:Te<48?Xt+=U(tt,ir,Zt)+je[2]:Te<64?Xt+=Z(tt,ir,Zt)+je[3]:Xt+=H(tt,ir,Zt)+je[4],Xt=Xt|0,Xt=le(Xt,sr[Te]),Xt=Xt+vr|0,et=vr,vr=Zt,Zt=le(ir,10),ir=tt,tt=Xt;Xt=Ne[1]+ft+Zt|0,Ne[1]=Ne[2]+Ve+vr|0,Ne[2]=Ne[3]+Je+et|0,Ne[3]=Ne[4]+Ge+tt|0,Ne[4]=Ne[0]+St+ir|0,Ne[0]=Xt},_doFinalize:function(){var pe=this._data,ye=pe.words,Te=this._nDataBytes*8,Se=pe.sigBytes*8;ye[Se>>>5]|=128<<24-Se%32,ye[(Se+64>>>9<<4)+14]=(Te<<8|Te>>>24)&16711935|(Te<<24|Te>>>8)&4278255360,pe.sigBytes=(ye.length+1)*4,this._process();for(var Ae=this._hash,Ne=Ae.words,Ue=0;Ue<5;Ue++){var je=Ne[Ue];Ne[Ue]=(je<<8|je>>>24)&16711935|(je<<24|je>>>8)&4278255360}return Ae},clone:function(){var pe=s.clone.call(this);return pe._hash=this._hash.clone(),pe}});function H(pe,ye,Te){return pe^ye^Te}function Z(pe,ye,Te){return pe&ye|~pe&Te}function U(pe,ye,Te){return(pe|~ye)^Te}function $(pe,ye,Te){return pe&Te|ye&~Te}function J(pe,ye,Te){return pe^(ye|~Te)}function le(pe,ye){return pe<<ye|pe>>>32-ye}f.RIPEMD160=s._createHelper(j),f.HmacRIPEMD160=s._createHmacHelper(j)}(),a.RIPEMD160})}(Mx)),Mx.exports}var Rx={exports:{}},VT;function tw(){return VT||(VT=1,function(t,r){(function(a,c){t.exports=c(xr())})(gt,function(a){(function(){var c=a,f=c.lib,_=f.Base,b=c.enc,s=b.Utf8,S=c.algo;S.HMAC=_.extend({init:function(C,k){C=this._hasher=new C.init,typeof k=="string"&&(k=s.parse(k));var M=C.blockSize,L=M*4;k.sigBytes>L&&(k=C.finalize(k)),k.clamp();for(var V=this._oKey=k.clone(),O=this._iKey=k.clone(),j=V.words,H=O.words,Z=0;Z<M;Z++)j[Z]^=1549556828,H[Z]^=909522486;V.sigBytes=O.sigBytes=L,this.reset()},reset:function(){var C=this._hasher;C.reset(),C.update(this._iKey)},update:function(C){return this._hasher.update(C),this},finalize:function(C){var k=this._hasher,M=k.finalize(C);k.reset();var L=k.finalize(this._oKey.clone().concat(M));return L}})})()})}(Rx)),Rx.exports}var Bx={exports:{}},jT;function SV(){return jT||(jT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),ew(),tw())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.Base,b=f.WordArray,s=c.algo,S=s.SHA256,C=s.HMAC,k=s.PBKDF2=_.extend({cfg:_.extend({keySize:128/32,hasher:S,iterations:25e4}),init:function(M){this.cfg=this.cfg.extend(M)},compute:function(M,L){for(var V=this.cfg,O=C.create(V.hasher,M),j=b.create(),H=b.create([1]),Z=j.words,U=H.words,$=V.keySize,J=V.iterations;Z.length<$;){var le=O.update(L).finalize(H);O.reset();for(var pe=le.words,ye=pe.length,Te=le,Se=1;Se<J;Se++){Te=O.finalize(Te),O.reset();for(var Ae=Te.words,Ne=0;Ne<ye;Ne++)pe[Ne]^=Ae[Ne]}j.concat(le),U[0]++}return j.sigBytes=$*4,j}});c.PBKDF2=function(M,L,V){return k.create(V).compute(M,L)}}(),a.PBKDF2})}(Bx)),Bx.exports}var Lx={exports:{}},$T;function vl(){return $T||($T=1,function(t,r){(function(a,c,f){t.exports=c(xr(),bz(),tw())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.Base,b=f.WordArray,s=c.algo,S=s.MD5,C=s.EvpKDF=_.extend({cfg:_.extend({keySize:128/32,hasher:S,iterations:1}),init:function(k){this.cfg=this.cfg.extend(k)},compute:function(k,M){for(var L,V=this.cfg,O=V.hasher.create(),j=b.create(),H=j.words,Z=V.keySize,U=V.iterations;H.length<Z;){L&&O.update(L),L=O.update(k).finalize(M),O.reset();for(var $=1;$<U;$++)L=O.finalize(L),O.reset();j.concat(L)}return j.sigBytes=Z*4,j}});c.EvpKDF=function(k,M,L){return C.create(L).compute(k,M)}}(),a.EvpKDF})}(Lx)),Lx.exports}var Fx={exports:{}},WT;function Qn(){return WT||(WT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),vl())})(gt,function(a){a.lib.Cipher||function(c){var f=a,_=f.lib,b=_.Base,s=_.WordArray,S=_.BufferedBlockAlgorithm,C=f.enc;C.Utf8;var k=C.Base64,M=f.algo,L=M.EvpKDF,V=_.Cipher=S.extend({cfg:b.extend(),createEncryptor:function(Ae,Ne){return this.create(this._ENC_XFORM_MODE,Ae,Ne)},createDecryptor:function(Ae,Ne){return this.create(this._DEC_XFORM_MODE,Ae,Ne)},init:function(Ae,Ne,Ue){this.cfg=this.cfg.extend(Ue),this._xformMode=Ae,this._key=Ne,this.reset()},reset:function(){S.reset.call(this),this._doReset()},process:function(Ae){return this._append(Ae),this._process()},finalize:function(Ae){Ae&&this._append(Ae);var Ne=this._doFinalize();return Ne},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function Ae(Ne){return typeof Ne=="string"?Se:pe}return function(Ne){return{encrypt:function(Ue,je,Ct){return Ae(je).encrypt(Ne,Ue,je,Ct)},decrypt:function(Ue,je,Ct){return Ae(je).decrypt(Ne,Ue,je,Ct)}}}}()});_.StreamCipher=V.extend({_doFinalize:function(){var Ae=this._process(!0);return Ae},blockSize:1});var O=f.mode={},j=_.BlockCipherMode=b.extend({createEncryptor:function(Ae,Ne){return this.Encryptor.create(Ae,Ne)},createDecryptor:function(Ae,Ne){return this.Decryptor.create(Ae,Ne)},init:function(Ae,Ne){this._cipher=Ae,this._iv=Ne}}),H=O.CBC=function(){var Ae=j.extend();Ae.Encryptor=Ae.extend({processBlock:function(Ue,je){var Ct=this._cipher,zt=Ct.blockSize;Ne.call(this,Ue,je,zt),Ct.encryptBlock(Ue,je),this._prevBlock=Ue.slice(je,je+zt)}}),Ae.Decryptor=Ae.extend({processBlock:function(Ue,je){var Ct=this._cipher,zt=Ct.blockSize,Ut=Ue.slice(je,je+zt);Ct.decryptBlock(Ue,je),Ne.call(this,Ue,je,zt),this._prevBlock=Ut}});function Ne(Ue,je,Ct){var zt,Ut=this._iv;Ut?(zt=Ut,this._iv=c):zt=this._prevBlock;for(var sr=0;sr<Ct;sr++)Ue[je+sr]^=zt[sr]}return Ae}(),Z=f.pad={},U=Z.Pkcs7={pad:function(Ae,Ne){for(var Ue=Ne*4,je=Ue-Ae.sigBytes%Ue,Ct=je<<24|je<<16|je<<8|je,zt=[],Ut=0;Ut<je;Ut+=4)zt.push(Ct);var sr=s.create(zt,je);Ae.concat(sr)},unpad:function(Ae){var Ne=Ae.words[Ae.sigBytes-1>>>2]&255;Ae.sigBytes-=Ne}};_.BlockCipher=V.extend({cfg:V.cfg.extend({mode:H,padding:U}),reset:function(){var Ae;V.reset.call(this);var Ne=this.cfg,Ue=Ne.iv,je=Ne.mode;this._xformMode==this._ENC_XFORM_MODE?Ae=je.createEncryptor:(Ae=je.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==Ae?this._mode.init(this,Ue&&Ue.words):(this._mode=Ae.call(je,this,Ue&&Ue.words),this._mode.__creator=Ae)},_doProcessBlock:function(Ae,Ne){this._mode.processBlock(Ae,Ne)},_doFinalize:function(){var Ae,Ne=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(Ne.pad(this._data,this.blockSize),Ae=this._process(!0)):(Ae=this._process(!0),Ne.unpad(Ae)),Ae},blockSize:128/32});var $=_.CipherParams=b.extend({init:function(Ae){this.mixIn(Ae)},toString:function(Ae){return(Ae||this.formatter).stringify(this)}}),J=f.format={},le=J.OpenSSL={stringify:function(Ae){var Ne,Ue=Ae.ciphertext,je=Ae.salt;return je?Ne=s.create([1398893684,1701076831]).concat(je).concat(Ue):Ne=Ue,Ne.toString(k)},parse:function(Ae){var Ne,Ue=k.parse(Ae),je=Ue.words;return je[0]==1398893684&&je[1]==1701076831&&(Ne=s.create(je.slice(2,4)),je.splice(0,4),Ue.sigBytes-=16),$.create({ciphertext:Ue,salt:Ne})}},pe=_.SerializableCipher=b.extend({cfg:b.extend({format:le}),encrypt:function(Ae,Ne,Ue,je){je=this.cfg.extend(je);var Ct=Ae.createEncryptor(Ue,je),zt=Ct.finalize(Ne),Ut=Ct.cfg;return $.create({ciphertext:zt,key:Ue,iv:Ut.iv,algorithm:Ae,mode:Ut.mode,padding:Ut.padding,blockSize:Ae.blockSize,formatter:je.format})},decrypt:function(Ae,Ne,Ue,je){je=this.cfg.extend(je),Ne=this._parse(Ne,je.format);var Ct=Ae.createDecryptor(Ue,je).finalize(Ne.ciphertext);return Ct},_parse:function(Ae,Ne){return typeof Ae=="string"?Ne.parse(Ae,this):Ae}}),ye=f.kdf={},Te=ye.OpenSSL={execute:function(Ae,Ne,Ue,je,Ct){if(je||(je=s.random(64/8)),Ct)var zt=L.create({keySize:Ne+Ue,hasher:Ct}).compute(Ae,je);else var zt=L.create({keySize:Ne+Ue}).compute(Ae,je);var Ut=s.create(zt.words.slice(Ne),Ue*4);return zt.sigBytes=Ne*4,$.create({key:zt,iv:Ut,salt:je})}},Se=_.PasswordBasedCipher=pe.extend({cfg:pe.cfg.extend({kdf:Te}),encrypt:function(Ae,Ne,Ue,je){je=this.cfg.extend(je);var Ct=je.kdf.execute(Ue,Ae.keySize,Ae.ivSize,je.salt,je.hasher);je.iv=Ct.iv;var zt=pe.encrypt.call(this,Ae,Ne,Ct.key,je);return zt.mixIn(Ct),zt},decrypt:function(Ae,Ne,Ue,je){je=this.cfg.extend(je),Ne=this._parse(Ne,je.format);var Ct=je.kdf.execute(Ue,Ae.keySize,Ae.ivSize,Ne.salt,je.hasher);je.iv=Ct.iv;var zt=pe.decrypt.call(this,Ae,Ne,Ct.key,je);return zt}})}()})}(Fx)),Fx.exports}var Ox={exports:{}},qT;function AV(){return qT||(qT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Qn())})(gt,function(a){return a.mode.CFB=function(){var c=a.lib.BlockCipherMode.extend();c.Encryptor=c.extend({processBlock:function(_,b){var s=this._cipher,S=s.blockSize;f.call(this,_,b,S,s),this._prevBlock=_.slice(b,b+S)}}),c.Decryptor=c.extend({processBlock:function(_,b){var s=this._cipher,S=s.blockSize,C=_.slice(b,b+S);f.call(this,_,b,S,s),this._prevBlock=C}});function f(_,b,s,S){var C,k=this._iv;k?(C=k.slice(0),this._iv=void 0):C=this._prevBlock,S.encryptBlock(C,0);for(var M=0;M<s;M++)_[b+M]^=C[M]}return c}(),a.mode.CFB})}(Ox)),Ox.exports}var Nx={exports:{}},GT;function TV(){return GT||(GT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Qn())})(gt,function(a){return a.mode.CTR=function(){var c=a.lib.BlockCipherMode.extend(),f=c.Encryptor=c.extend({processBlock:function(_,b){var s=this._cipher,S=s.blockSize,C=this._iv,k=this._counter;C&&(k=this._counter=C.slice(0),this._iv=void 0);var M=k.slice(0);s.encryptBlock(M,0),k[S-1]=k[S-1]+1|0;for(var L=0;L<S;L++)_[b+L]^=M[L]}});return c.Decryptor=f,c}(),a.mode.CTR})}(Nx)),Nx.exports}var Ux={exports:{}},HT;function CV(){return HT||(HT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Qn())})(gt,function(a){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return a.mode.CTRGladman=function(){var c=a.lib.BlockCipherMode.extend();function f(s){if((s>>24&255)===255){var S=s>>16&255,C=s>>8&255,k=s&255;S===255?(S=0,C===255?(C=0,k===255?k=0:++k):++C):++S,s=0,s+=S<<16,s+=C<<8,s+=k}else s+=1<<24;return s}function _(s){return(s[0]=f(s[0]))===0&&(s[1]=f(s[1])),s}var b=c.Encryptor=c.extend({processBlock:function(s,S){var C=this._cipher,k=C.blockSize,M=this._iv,L=this._counter;M&&(L=this._counter=M.slice(0),this._iv=void 0),_(L);var V=L.slice(0);C.encryptBlock(V,0);for(var O=0;O<k;O++)s[S+O]^=V[O]}});return c.Decryptor=b,c}(),a.mode.CTRGladman})}(Ux)),Ux.exports}var Vx={exports:{}},ZT;function IV(){return ZT||(ZT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Qn())})(gt,function(a){return a.mode.OFB=function(){var c=a.lib.BlockCipherMode.extend(),f=c.Encryptor=c.extend({processBlock:function(_,b){var s=this._cipher,S=s.blockSize,C=this._iv,k=this._keystream;C&&(k=this._keystream=C.slice(0),this._iv=void 0),s.encryptBlock(k,0);for(var M=0;M<S;M++)_[b+M]^=k[M]}});return c.Decryptor=f,c}(),a.mode.OFB})}(Vx)),Vx.exports}var jx={exports:{}},XT;function kV(){return XT||(XT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Qn())})(gt,function(a){return a.mode.ECB=function(){var c=a.lib.BlockCipherMode.extend();return c.Encryptor=c.extend({processBlock:function(f,_){this._cipher.encryptBlock(f,_)}}),c.Decryptor=c.extend({processBlock:function(f,_){this._cipher.decryptBlock(f,_)}}),c}(),a.mode.ECB})}(jx)),jx.exports}var $x={exports:{}},KT;function PV(){return KT||(KT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Qn())})(gt,function(a){return a.pad.AnsiX923={pad:function(c,f){var _=c.sigBytes,b=f*4,s=b-_%b,S=_+s-1;c.clamp(),c.words[S>>>2]|=s<<24-S%4*8,c.sigBytes+=s},unpad:function(c){var f=c.words[c.sigBytes-1>>>2]&255;c.sigBytes-=f}},a.pad.Ansix923})}($x)),$x.exports}var Wx={exports:{}},YT;function zV(){return YT||(YT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Qn())})(gt,function(a){return a.pad.Iso10126={pad:function(c,f){var _=f*4,b=_-c.sigBytes%_;c.concat(a.lib.WordArray.random(b-1)).concat(a.lib.WordArray.create([b<<24],1))},unpad:function(c){var f=c.words[c.sigBytes-1>>>2]&255;c.sigBytes-=f}},a.pad.Iso10126})}(Wx)),Wx.exports}var qx={exports:{}},JT;function DV(){return JT||(JT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Qn())})(gt,function(a){return a.pad.Iso97971={pad:function(c,f){c.concat(a.lib.WordArray.create([2147483648],1)),a.pad.ZeroPadding.pad(c,f)},unpad:function(c){a.pad.ZeroPadding.unpad(c),c.sigBytes--}},a.pad.Iso97971})}(qx)),qx.exports}var Gx={exports:{}},QT;function MV(){return QT||(QT=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Qn())})(gt,function(a){return a.pad.ZeroPadding={pad:function(c,f){var _=f*4;c.clamp(),c.sigBytes+=_-(c.sigBytes%_||_)},unpad:function(c){for(var f=c.words,_=c.sigBytes-1,_=c.sigBytes-1;_>=0;_--)if(f[_>>>2]>>>24-_%4*8&255){c.sigBytes=_+1;break}}},a.pad.ZeroPadding})}(Gx)),Gx.exports}var Hx={exports:{}},eC;function RV(){return eC||(eC=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Qn())})(gt,function(a){return a.pad.NoPadding={pad:function(){},unpad:function(){}},a.pad.NoPadding})}(Hx)),Hx.exports}var Zx={exports:{}},tC;function BV(){return tC||(tC=1,function(t,r){(function(a,c,f){t.exports=c(xr(),Qn())})(gt,function(a){return function(c){var f=a,_=f.lib,b=_.CipherParams,s=f.enc,S=s.Hex,C=f.format;C.Hex={stringify:function(k){return k.ciphertext.toString(S)},parse:function(k){var M=S.parse(k);return b.create({ciphertext:M})}}}(),a.format.Hex})}(Zx)),Zx.exports}var Xx={exports:{}},rC;function LV(){return rC||(rC=1,function(t,r){(function(a,c,f){t.exports=c(xr(),kc(),Pc(),vl(),Qn())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.BlockCipher,b=c.algo,s=[],S=[],C=[],k=[],M=[],L=[],V=[],O=[],j=[],H=[];(function(){for(var $=[],J=0;J<256;J++)J<128?$[J]=J<<1:$[J]=J<<1^283;for(var le=0,pe=0,J=0;J<256;J++){var ye=pe^pe<<1^pe<<2^pe<<3^pe<<4;ye=ye>>>8^ye&255^99,s[le]=ye,S[ye]=le;var Te=$[le],Se=$[Te],Ae=$[Se],Ne=$[ye]*257^ye*16843008;C[le]=Ne<<24|Ne>>>8,k[le]=Ne<<16|Ne>>>16,M[le]=Ne<<8|Ne>>>24,L[le]=Ne;var Ne=Ae*16843009^Se*65537^Te*257^le*16843008;V[ye]=Ne<<24|Ne>>>8,O[ye]=Ne<<16|Ne>>>16,j[ye]=Ne<<8|Ne>>>24,H[ye]=Ne,le?(le=Te^$[$[$[Ae^Te]]],pe^=$[$[pe]]):le=pe=1}})();var Z=[0,1,2,4,8,16,32,64,128,27,54],U=b.AES=_.extend({_doReset:function(){var $;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var J=this._keyPriorReset=this._key,le=J.words,pe=J.sigBytes/4,ye=this._nRounds=pe+6,Te=(ye+1)*4,Se=this._keySchedule=[],Ae=0;Ae<Te;Ae++)Ae<pe?Se[Ae]=le[Ae]:($=Se[Ae-1],Ae%pe?pe>6&&Ae%pe==4&&($=s[$>>>24]<<24|s[$>>>16&255]<<16|s[$>>>8&255]<<8|s[$&255]):($=$<<8|$>>>24,$=s[$>>>24]<<24|s[$>>>16&255]<<16|s[$>>>8&255]<<8|s[$&255],$^=Z[Ae/pe|0]<<24),Se[Ae]=Se[Ae-pe]^$);for(var Ne=this._invKeySchedule=[],Ue=0;Ue<Te;Ue++){var Ae=Te-Ue;if(Ue%4)var $=Se[Ae];else var $=Se[Ae-4];Ue<4||Ae<=4?Ne[Ue]=$:Ne[Ue]=V[s[$>>>24]]^O[s[$>>>16&255]]^j[s[$>>>8&255]]^H[s[$&255]]}}},encryptBlock:function($,J){this._doCryptBlock($,J,this._keySchedule,C,k,M,L,s)},decryptBlock:function($,J){var le=$[J+1];$[J+1]=$[J+3],$[J+3]=le,this._doCryptBlock($,J,this._invKeySchedule,V,O,j,H,S);var le=$[J+1];$[J+1]=$[J+3],$[J+3]=le},_doCryptBlock:function($,J,le,pe,ye,Te,Se,Ae){for(var Ne=this._nRounds,Ue=$[J]^le[0],je=$[J+1]^le[1],Ct=$[J+2]^le[2],zt=$[J+3]^le[3],Ut=4,sr=1;sr<Ne;sr++){var Ge=pe[Ue>>>24]^ye[je>>>16&255]^Te[Ct>>>8&255]^Se[zt&255]^le[Ut++],St=pe[je>>>24]^ye[Ct>>>16&255]^Te[zt>>>8&255]^Se[Ue&255]^le[Ut++],ft=pe[Ct>>>24]^ye[zt>>>16&255]^Te[Ue>>>8&255]^Se[je&255]^le[Ut++],Ve=pe[zt>>>24]^ye[Ue>>>16&255]^Te[je>>>8&255]^Se[Ct&255]^le[Ut++];Ue=Ge,je=St,Ct=ft,zt=Ve}var Ge=(Ae[Ue>>>24]<<24|Ae[je>>>16&255]<<16|Ae[Ct>>>8&255]<<8|Ae[zt&255])^le[Ut++],St=(Ae[je>>>24]<<24|Ae[Ct>>>16&255]<<16|Ae[zt>>>8&255]<<8|Ae[Ue&255])^le[Ut++],ft=(Ae[Ct>>>24]<<24|Ae[zt>>>16&255]<<16|Ae[Ue>>>8&255]<<8|Ae[je&255])^le[Ut++],Ve=(Ae[zt>>>24]<<24|Ae[Ue>>>16&255]<<16|Ae[je>>>8&255]<<8|Ae[Ct&255])^le[Ut++];$[J]=Ge,$[J+1]=St,$[J+2]=ft,$[J+3]=Ve},keySize:256/32});c.AES=_._createHelper(U)}(),a.AES})}(Xx)),Xx.exports}var Kx={exports:{}},nC;function FV(){return nC||(nC=1,function(t,r){(function(a,c,f){t.exports=c(xr(),kc(),Pc(),vl(),Qn())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.WordArray,b=f.BlockCipher,s=c.algo,S=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],C=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],k=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],M=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],L=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],V=s.DES=b.extend({_doReset:function(){for(var Z=this._key,U=Z.words,$=[],J=0;J<56;J++){var le=S[J]-1;$[J]=U[le>>>5]>>>31-le%32&1}for(var pe=this._subKeys=[],ye=0;ye<16;ye++){for(var Te=pe[ye]=[],Se=k[ye],J=0;J<24;J++)Te[J/6|0]|=$[(C[J]-1+Se)%28]<<31-J%6,Te[4+(J/6|0)]|=$[28+(C[J+24]-1+Se)%28]<<31-J%6;Te[0]=Te[0]<<1|Te[0]>>>31;for(var J=1;J<7;J++)Te[J]=Te[J]>>>(J-1)*4+3;Te[7]=Te[7]<<5|Te[7]>>>27}for(var Ae=this._invSubKeys=[],J=0;J<16;J++)Ae[J]=pe[15-J]},encryptBlock:function(Z,U){this._doCryptBlock(Z,U,this._subKeys)},decryptBlock:function(Z,U){this._doCryptBlock(Z,U,this._invSubKeys)},_doCryptBlock:function(Z,U,$){this._lBlock=Z[U],this._rBlock=Z[U+1],O.call(this,4,252645135),O.call(this,16,65535),j.call(this,2,858993459),j.call(this,8,16711935),O.call(this,1,1431655765);for(var J=0;J<16;J++){for(var le=$[J],pe=this._lBlock,ye=this._rBlock,Te=0,Se=0;Se<8;Se++)Te|=M[Se][((ye^le[Se])&L[Se])>>>0];this._lBlock=ye,this._rBlock=pe^Te}var Ae=this._lBlock;this._lBlock=this._rBlock,this._rBlock=Ae,O.call(this,1,1431655765),j.call(this,8,16711935),j.call(this,2,858993459),O.call(this,16,65535),O.call(this,4,252645135),Z[U]=this._lBlock,Z[U+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function O(Z,U){var $=(this._lBlock>>>Z^this._rBlock)&U;this._rBlock^=$,this._lBlock^=$<<Z}function j(Z,U){var $=(this._rBlock>>>Z^this._lBlock)&U;this._lBlock^=$,this._rBlock^=$<<Z}c.DES=b._createHelper(V);var H=s.TripleDES=b.extend({_doReset:function(){var Z=this._key,U=Z.words;if(U.length!==2&&U.length!==4&&U.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var $=U.slice(0,2),J=U.length<4?U.slice(0,2):U.slice(2,4),le=U.length<6?U.slice(0,2):U.slice(4,6);this._des1=V.createEncryptor(_.create($)),this._des2=V.createEncryptor(_.create(J)),this._des3=V.createEncryptor(_.create(le))},encryptBlock:function(Z,U){this._des1.encryptBlock(Z,U),this._des2.decryptBlock(Z,U),this._des3.encryptBlock(Z,U)},decryptBlock:function(Z,U){this._des3.decryptBlock(Z,U),this._des2.encryptBlock(Z,U),this._des1.decryptBlock(Z,U)},keySize:192/32,ivSize:64/32,blockSize:64/32});c.TripleDES=b._createHelper(H)}(),a.TripleDES})}(Kx)),Kx.exports}var Yx={exports:{}},iC;function OV(){return iC||(iC=1,function(t,r){(function(a,c,f){t.exports=c(xr(),kc(),Pc(),vl(),Qn())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.StreamCipher,b=c.algo,s=b.RC4=_.extend({_doReset:function(){for(var k=this._key,M=k.words,L=k.sigBytes,V=this._S=[],O=0;O<256;O++)V[O]=O;for(var O=0,j=0;O<256;O++){var H=O%L,Z=M[H>>>2]>>>24-H%4*8&255;j=(j+V[O]+Z)%256;var U=V[O];V[O]=V[j],V[j]=U}this._i=this._j=0},_doProcessBlock:function(k,M){k[M]^=S.call(this)},keySize:256/32,ivSize:0});function S(){for(var k=this._S,M=this._i,L=this._j,V=0,O=0;O<4;O++){M=(M+1)%256,L=(L+k[M])%256;var j=k[M];k[M]=k[L],k[L]=j,V|=k[(k[M]+k[L])%256]<<24-O*8}return this._i=M,this._j=L,V}c.RC4=_._createHelper(s);var C=b.RC4Drop=s.extend({cfg:s.cfg.extend({drop:192}),_doReset:function(){s._doReset.call(this);for(var k=this.cfg.drop;k>0;k--)S.call(this)}});c.RC4Drop=_._createHelper(C)}(),a.RC4})}(Yx)),Yx.exports}var Jx={exports:{}},oC;function NV(){return oC||(oC=1,function(t,r){(function(a,c,f){t.exports=c(xr(),kc(),Pc(),vl(),Qn())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.StreamCipher,b=c.algo,s=[],S=[],C=[],k=b.Rabbit=_.extend({_doReset:function(){for(var L=this._key.words,V=this.cfg.iv,O=0;O<4;O++)L[O]=(L[O]<<8|L[O]>>>24)&16711935|(L[O]<<24|L[O]>>>8)&4278255360;var j=this._X=[L[0],L[3]<<16|L[2]>>>16,L[1],L[0]<<16|L[3]>>>16,L[2],L[1]<<16|L[0]>>>16,L[3],L[2]<<16|L[1]>>>16],H=this._C=[L[2]<<16|L[2]>>>16,L[0]&4294901760|L[1]&65535,L[3]<<16|L[3]>>>16,L[1]&4294901760|L[2]&65535,L[0]<<16|L[0]>>>16,L[2]&4294901760|L[3]&65535,L[1]<<16|L[1]>>>16,L[3]&4294901760|L[0]&65535];this._b=0;for(var O=0;O<4;O++)M.call(this);for(var O=0;O<8;O++)H[O]^=j[O+4&7];if(V){var Z=V.words,U=Z[0],$=Z[1],J=(U<<8|U>>>24)&16711935|(U<<24|U>>>8)&4278255360,le=($<<8|$>>>24)&16711935|($<<24|$>>>8)&4278255360,pe=J>>>16|le&4294901760,ye=le<<16|J&65535;H[0]^=J,H[1]^=pe,H[2]^=le,H[3]^=ye,H[4]^=J,H[5]^=pe,H[6]^=le,H[7]^=ye;for(var O=0;O<4;O++)M.call(this)}},_doProcessBlock:function(L,V){var O=this._X;M.call(this),s[0]=O[0]^O[5]>>>16^O[3]<<16,s[1]=O[2]^O[7]>>>16^O[5]<<16,s[2]=O[4]^O[1]>>>16^O[7]<<16,s[3]=O[6]^O[3]>>>16^O[1]<<16;for(var j=0;j<4;j++)s[j]=(s[j]<<8|s[j]>>>24)&16711935|(s[j]<<24|s[j]>>>8)&4278255360,L[V+j]^=s[j]},blockSize:128/32,ivSize:64/32});function M(){for(var L=this._X,V=this._C,O=0;O<8;O++)S[O]=V[O];V[0]=V[0]+1295307597+this._b|0,V[1]=V[1]+3545052371+(V[0]>>>0<S[0]>>>0?1:0)|0,V[2]=V[2]+886263092+(V[1]>>>0<S[1]>>>0?1:0)|0,V[3]=V[3]+1295307597+(V[2]>>>0<S[2]>>>0?1:0)|0,V[4]=V[4]+3545052371+(V[3]>>>0<S[3]>>>0?1:0)|0,V[5]=V[5]+886263092+(V[4]>>>0<S[4]>>>0?1:0)|0,V[6]=V[6]+1295307597+(V[5]>>>0<S[5]>>>0?1:0)|0,V[7]=V[7]+3545052371+(V[6]>>>0<S[6]>>>0?1:0)|0,this._b=V[7]>>>0<S[7]>>>0?1:0;for(var O=0;O<8;O++){var j=L[O]+V[O],H=j&65535,Z=j>>>16,U=((H*H>>>17)+H*Z>>>15)+Z*Z,$=((j&4294901760)*j|0)+((j&65535)*j|0);C[O]=U^$}L[0]=C[0]+(C[7]<<16|C[7]>>>16)+(C[6]<<16|C[6]>>>16)|0,L[1]=C[1]+(C[0]<<8|C[0]>>>24)+C[7]|0,L[2]=C[2]+(C[1]<<16|C[1]>>>16)+(C[0]<<16|C[0]>>>16)|0,L[3]=C[3]+(C[2]<<8|C[2]>>>24)+C[1]|0,L[4]=C[4]+(C[3]<<16|C[3]>>>16)+(C[2]<<16|C[2]>>>16)|0,L[5]=C[5]+(C[4]<<8|C[4]>>>24)+C[3]|0,L[6]=C[6]+(C[5]<<16|C[5]>>>16)+(C[4]<<16|C[4]>>>16)|0,L[7]=C[7]+(C[6]<<8|C[6]>>>24)+C[5]|0}c.Rabbit=_._createHelper(k)}(),a.Rabbit})}(Jx)),Jx.exports}var Qx={exports:{}},sC;function UV(){return sC||(sC=1,function(t,r){(function(a,c,f){t.exports=c(xr(),kc(),Pc(),vl(),Qn())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.StreamCipher,b=c.algo,s=[],S=[],C=[],k=b.RabbitLegacy=_.extend({_doReset:function(){var L=this._key.words,V=this.cfg.iv,O=this._X=[L[0],L[3]<<16|L[2]>>>16,L[1],L[0]<<16|L[3]>>>16,L[2],L[1]<<16|L[0]>>>16,L[3],L[2]<<16|L[1]>>>16],j=this._C=[L[2]<<16|L[2]>>>16,L[0]&4294901760|L[1]&65535,L[3]<<16|L[3]>>>16,L[1]&4294901760|L[2]&65535,L[0]<<16|L[0]>>>16,L[2]&4294901760|L[3]&65535,L[1]<<16|L[1]>>>16,L[3]&4294901760|L[0]&65535];this._b=0;for(var H=0;H<4;H++)M.call(this);for(var H=0;H<8;H++)j[H]^=O[H+4&7];if(V){var Z=V.words,U=Z[0],$=Z[1],J=(U<<8|U>>>24)&16711935|(U<<24|U>>>8)&4278255360,le=($<<8|$>>>24)&16711935|($<<24|$>>>8)&4278255360,pe=J>>>16|le&4294901760,ye=le<<16|J&65535;j[0]^=J,j[1]^=pe,j[2]^=le,j[3]^=ye,j[4]^=J,j[5]^=pe,j[6]^=le,j[7]^=ye;for(var H=0;H<4;H++)M.call(this)}},_doProcessBlock:function(L,V){var O=this._X;M.call(this),s[0]=O[0]^O[5]>>>16^O[3]<<16,s[1]=O[2]^O[7]>>>16^O[5]<<16,s[2]=O[4]^O[1]>>>16^O[7]<<16,s[3]=O[6]^O[3]>>>16^O[1]<<16;for(var j=0;j<4;j++)s[j]=(s[j]<<8|s[j]>>>24)&16711935|(s[j]<<24|s[j]>>>8)&4278255360,L[V+j]^=s[j]},blockSize:128/32,ivSize:64/32});function M(){for(var L=this._X,V=this._C,O=0;O<8;O++)S[O]=V[O];V[0]=V[0]+1295307597+this._b|0,V[1]=V[1]+3545052371+(V[0]>>>0<S[0]>>>0?1:0)|0,V[2]=V[2]+886263092+(V[1]>>>0<S[1]>>>0?1:0)|0,V[3]=V[3]+1295307597+(V[2]>>>0<S[2]>>>0?1:0)|0,V[4]=V[4]+3545052371+(V[3]>>>0<S[3]>>>0?1:0)|0,V[5]=V[5]+886263092+(V[4]>>>0<S[4]>>>0?1:0)|0,V[6]=V[6]+1295307597+(V[5]>>>0<S[5]>>>0?1:0)|0,V[7]=V[7]+3545052371+(V[6]>>>0<S[6]>>>0?1:0)|0,this._b=V[7]>>>0<S[7]>>>0?1:0;for(var O=0;O<8;O++){var j=L[O]+V[O],H=j&65535,Z=j>>>16,U=((H*H>>>17)+H*Z>>>15)+Z*Z,$=((j&4294901760)*j|0)+((j&65535)*j|0);C[O]=U^$}L[0]=C[0]+(C[7]<<16|C[7]>>>16)+(C[6]<<16|C[6]>>>16)|0,L[1]=C[1]+(C[0]<<8|C[0]>>>24)+C[7]|0,L[2]=C[2]+(C[1]<<16|C[1]>>>16)+(C[0]<<16|C[0]>>>16)|0,L[3]=C[3]+(C[2]<<8|C[2]>>>24)+C[1]|0,L[4]=C[4]+(C[3]<<16|C[3]>>>16)+(C[2]<<16|C[2]>>>16)|0,L[5]=C[5]+(C[4]<<8|C[4]>>>24)+C[3]|0,L[6]=C[6]+(C[5]<<16|C[5]>>>16)+(C[4]<<16|C[4]>>>16)|0,L[7]=C[7]+(C[6]<<8|C[6]>>>24)+C[5]|0}c.RabbitLegacy=_._createHelper(k)}(),a.RabbitLegacy})}(Qx)),Qx.exports}var ev={exports:{}},aC;function VV(){return aC||(aC=1,function(t,r){(function(a,c,f){t.exports=c(xr(),kc(),Pc(),vl(),Qn())})(gt,function(a){return function(){var c=a,f=c.lib,_=f.BlockCipher,b=c.algo;const s=16,S=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],C=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var k={pbox:[],sbox:[]};function M(H,Z){let U=Z>>24&255,$=Z>>16&255,J=Z>>8&255,le=Z&255,pe=H.sbox[0][U]+H.sbox[1][$];return pe=pe^H.sbox[2][J],pe=pe+H.sbox[3][le],pe}function L(H,Z,U){let $=Z,J=U,le;for(let pe=0;pe<s;++pe)$=$^H.pbox[pe],J=M(H,$)^J,le=$,$=J,J=le;return le=$,$=J,J=le,J=J^H.pbox[s],$=$^H.pbox[s+1],{left:$,right:J}}function V(H,Z,U){let $=Z,J=U,le;for(let pe=s+1;pe>1;--pe)$=$^H.pbox[pe],J=M(H,$)^J,le=$,$=J,J=le;return le=$,$=J,J=le,J=J^H.pbox[1],$=$^H.pbox[0],{left:$,right:J}}function O(H,Z,U){for(let ye=0;ye<4;ye++){H.sbox[ye]=[];for(let Te=0;Te<256;Te++)H.sbox[ye][Te]=C[ye][Te]}let $=0;for(let ye=0;ye<s+2;ye++)H.pbox[ye]=S[ye]^Z[$],$++,$>=U&&($=0);let J=0,le=0,pe=0;for(let ye=0;ye<s+2;ye+=2)pe=L(H,J,le),J=pe.left,le=pe.right,H.pbox[ye]=J,H.pbox[ye+1]=le;for(let ye=0;ye<4;ye++)for(let Te=0;Te<256;Te+=2)pe=L(H,J,le),J=pe.left,le=pe.right,H.sbox[ye][Te]=J,H.sbox[ye][Te+1]=le;return!0}var j=b.Blowfish=_.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var H=this._keyPriorReset=this._key,Z=H.words,U=H.sigBytes/4;O(k,Z,U)}},encryptBlock:function(H,Z){var U=L(k,H[Z],H[Z+1]);H[Z]=U.left,H[Z+1]=U.right},decryptBlock:function(H,Z){var U=V(k,H[Z],H[Z+1]);H[Z]=U.left,H[Z+1]=U.right},blockSize:64/32,keySize:128/32,ivSize:64/32});c.Blowfish=_._createHelper(j)}(),a.Blowfish})}(ev)),ev.exports}(function(t,r){(function(a,c,f){t.exports=c(xr(),Xg(),_V(),yV(),kc(),xV(),Pc(),bz(),ew(),vV(),wz(),bV(),wV(),EV(),tw(),SV(),vl(),Qn(),AV(),TV(),CV(),IV(),kV(),PV(),zV(),DV(),MV(),RV(),BV(),LV(),FV(),OV(),NV(),UV(),VV())})(gt,function(a){return a})})(vz);var P0=vz.exports;const jV="4a143a9e-352c-4fd6-ae5b-d441fec00548",$V="80036f56-0856-4e2e-9730-d0863faca68f",WV="Q+coMcrzSPBIv2ksoBFHt6TCasWLUnYdJTWmBaizybg=",qV="tech-team@ruralinnovation.us",GV=10,HV=["tableau:views:embed"];function tv(t){let r=t instanceof Uint8Array?new TextDecoder("utf8").decode(t):P0.enc.Base64.stringify(t);return r=r.replace(/=+$/,""),r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),r}function ZV(t,r,a,c,f){const _={alg:"HS256",typ:"JWT",iss:c,kid:r};console.log("Encode header:",_);const b=P0.enc.Utf8.parse(JSON.stringify(_)),s=tv(b),S={sub:t,aud:"tableau",nbf:Math.round(new Date().getTime()/1e3)-100,jti:new Date().getTime().toString(),iss:c,scp:f,exp:Math.round(new Date().getTime()/1e3)+GV*60};console.log("Encode claimSet:",S);const C=P0.enc.Utf8.parse(JSON.stringify(S)),k=tv(C),M=s+"."+k;console.log("Encode token (encoded header + encoded claimSet):",M);const L=P0.HmacSHA256(M,a);console.log("Base64 encode signature:",L);const V=tv(L),O=M+"."+V;return console.log(O),O}function lC({attach_content:t=!0,content:r,content_selector:a,content_timeout:c}){const f="tableau-viz-container";let _=!1;function b(s){if(console.log("Ready to attach content:",t,a,c),a!==null&&!_){const S=document.getElementsByClassName(f)[0];S&&S!==null&&typeof S.insertAdjacentElement=="function"&&(s!==null&&s.childNodes!==null&&s.childNodes.length>0&&setTimeout(C=>{console.log(`Will append content to ${S.className}: `,s),s.childNodes.forEach(k=>{if(k.nodeType===1){const M=k;C.insertAdjacentElement("beforeend",M)}})},53,S),_=!0)}}return wt.useEffect(()=>{a!==null&&c!==null&&setTimeout(function(){const s=typeof r=="function"?r():null;if(console.log("viz_content:",s),s!==null){const S=s==null?void 0:s.querySelector(a);console.log("viz:",S),S.token=ZV(qV,$V,WV,jV,HV),new Promise((C,k)=>{console.log("About to reference @tableau/embedding-api..."),S.addEventListener(xx.TableauEventType.FirstInteractive,()=>{console.log("Viz is interactive!"),C()}),S.addEventListener(xx.TableauEventType.VizLoadError,M=>{const L=JSON.parse(M.detail.message),O=`ca-error-${JSON.parse(L.errorMessage).result.errors[0].code}`;console.log("Error",O,L),k(O)})}).then(C=>{var L,V;let k,M;((L=S.workbook.activeSheet)==null?void 0:L.sheetType)===((V=xx.SheetType)==null?void 0:V.Dashboard)?(k=S.workbook.activeSheet,M=k==null?void 0:k.worksheets.find(O=>O.name==="Replace-Name-of-Worksheet")):M=S.workbook.activeSheet,console.log("Tableau Viz Dashboard: ",k),console.log("Tableau Viz Worksheet: ",M)}),t&&S!==null?b(s):_=!0}},c+1e3)},[]),wt.createElement("div",{className:f})}const rv="pk.eyJ1IjoicnVyYWxpbm5vIiwiYSI6ImNqeHl0cW0xODBlMm0zY2x0dXltYzRuazUifQ.zZBovoCHzLIW0wCZveEKzA",cC="/examples/cori.data.rin/rin_service_areas.geojson";function XV({app_id:t,attach_content:r=!1,content:a,content_selector:c,content_timeout:f}){var O;const _=wt.useContext(vP),[b,s]=wt.useState(!0);function S(){f&&f!==null&&setTimeout(function(){if(!b){const j=document.getElementById(t);if(j){const H=typeof a=="function"?a():null;H!==null&&H.childNodes!==null&&H.childNodes.length>0&&(console.log(`Will append content to ${t}: `,H),setTimeout(Z=>{H.childNodes.forEach(U=>{if(U.nodeType===1){const $=U;Z.insertAdjacentElement("beforeend",$)}})},53,j),s(!0))}}},f+1e3)}wt.useEffect(()=>{console.log("Viz content loaded:",b,c,f,a()),r?S():s(!0)},[]);const C=wt.useRef(null),k=wt.useMemo(()=>(j,H,Z,U)=>{const $=new bb.Popup;return U.hasOwnProperty(Z)?($.setLngLat([j,H]),$.setText(U[Z])):$.setText("Hello world!"),$},[]);let M=!1;function L(j,H,Z,U,$,J,le){return console.log(`Set marker (${le[J]+"-marker"}): `,C),wt.createElement(bP,{ref:j,longitude:H,latitude:Z,color:U,popup:$(H,Z,J,le),key:le[J]+"-marker"})}wt.useEffect(()=>{if(_&&!_.data.hasOwnProperty("placeData")&&!M){console.log("Initial place data fetch..."),console.log(cC),M=!0;const j=window.document.getElementById("info-wrapper");j!==null&&(j.style.opacity="1.0",j.style.position="absolute",j.style.background=`rgba(46, 60, 67, 0.5) url('${_.baseURL}/images/loading.gif') no-repeat fixed center`,j.style.backgroundSize="20px"),_.setData({...(_==null?void 0:_.data)||{},placeData:null}),_==null||_.apiClient.get(cC).then(H=>{H&&H.hasOwnProperty("data")&&(_.setData({..._.data,placeData:H.data.features}),M=!1,j!==null&&(j.style.opacity="0.0",j.style.pointerEvents="none",setTimeout(()=>{j.style.background="transparent"},533)))}).catch(H=>{console.error("Error fetching data:",H),M=!1,j!==null&&(j.style.opacity="0.0",j.style.pointerEvents="none",setTimeout(()=>{j.style.background="transparent"},533))})}},[_==null?void 0:_.data]);const V=[];return wt.createElement(wt.Fragment,null,wt.createElement("div",{className:"slippy-map"},wt.createElement(A8,{mapboxAccessToken:rv,initialViewState:{latitude:40,longitude:-99,pitch:45,zoom:4},style:{width:600,height:400},mapStyle:`https://api.mapbox.com/styles/v1/ruralinno/cl010e7b7001p15pe3l0306hv?access_token=${rv}`},!!(_!=null&&_.data)&&!!((O=_==null?void 0:_.data)!=null&&O.placeData)&&_.data.placeData.length>0&&!!C&&typeof C!==void 0&&_.data.placeData.filter(j=>{const H=j.properties.rin_community.toString();return V.filter(Z=>Z===H).length<1?(V.push(H),!0):!1}).map(j=>{console.log(j.properties.rin_community);const H=typeof j.geometry.coordinates[0]=="number"?j.geometry.coordinates[0]:0,Z=typeof j.geometry.coordinates[1]=="number"?j.geometry.coordinates[1]:0;return L(C,H,Z,"#16343e",k,"rin_community",j.properties)}),wt.createElement(qO,{mapboxAccessToken:rv,position:"top-right"}),wt.createElement(C8,{position:"top-right"}),wt.createElement(T8,{position:"top-right"}),wt.createElement(I8,{position:"bottom-left",unit:"imperial"}))),wt.createElement("div",{id:"info-wrapper",style:{pointerEvents:"none",position:"absolute",top:0,left:0,minWidth:"100vw",minHeight:"100vh",transition:"opacity 5.05s ease-in-out 0.025s",opacity:"initial",background:"transparent",backgroundSize:"20px",zIndex:100}}),!!b&&!!c&&!!f&&(r?wt.createElement(lC,{attach_content:r,content:()=>a(),content_selector:c,content_timeout:f+1e3}):wt.createElement("div",null,wt.createElement(lC,{attach_content:r,content:()=>a(),content_selector:c,content_timeout:f+1e3}))))}const KV="https://cori-risi-apps.s3.amazonaws.com",uC=333;function YV(t,r){const a=document.getElementById(t)||document.createElement("div"),c=document.createElement("div");a.id=t,document.getElementById("loader")!==null&&document.getElementById("loader").remove();for(const f of a.childNodes){const _=f;f.nodeType===1&&c.appendChild(_)}r!==null&&setTimeout(function(){document.querySelector(r)!==null&&c.appendChild(document.querySelector(r))},uC),console.log("Found embedded content:",c),wk(a).render(wt.createElement(wt.StrictMode,null,wt.createElement(ZF,{baseURL:KV},wt.createElement(XV,{app_id:t,attach_content:!0,content:()=>r!==null&&document.querySelector(r)!==null?document.querySelector(r).parentElement:c,content_selector:r,content_timeout:uC}))))}YV("app","tableau-viz, tableau-authoring-viz");
